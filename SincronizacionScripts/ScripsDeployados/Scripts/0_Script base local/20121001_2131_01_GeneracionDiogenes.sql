/****** Object:  Table [dbo].[WEB_Sincronizacion_DatosPersonales_20120210]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_Sincronizacion_DatosPersonales_20120210]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[WEB_Sincronizacion_DatosPersonales_20120210](
	[nro_documento] [int] NOT NULL,
	[id_modificacion] [int] IDENTITY(1,1) NOT NULL,
	[Realizada] [bit] NOT NULL,
	[fecha] [smalldatetime] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[ESTR_GET_Sectores_Por_Nombre]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ESTR_GET_Sectores_Por_Nombre]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ESTR_GET_Sectores_Por_Nombre]
	@Nombre varchar(200)
AS

SELECT  Codigo,Descripcion 
FROM dbo.Tabla_Areas_Estructura
WHERE 	Baja = 0 AND
	Descripcion like  @Nombre +''%'' AND
	right(codigo,5) <> ''00000''






' 
END
GO
/****** Object:  StoredProcedure [dbo].[InsertarAutorizacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[InsertarAutorizacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[InsertarAutorizacion]
@Legajo  int,
@Dias int
AS
	Insert into dbo.Tmp_Authorizaciones_Net
	(legajo, dias)
	values
	(@Legajo, @Dias)

' 
END
GO
/****** Object:  Table [dbo].[RH_Sectores]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_Sectores]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[RH_Sectores](
	[Id] [smallint] NOT NULL,
	[Descripcion] [varchar](50) NULL,
 CONSTRAINT [PK_RH_Sectores] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Firmantes]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Firmantes]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Firmantes](
	[Id] [int] NOT NULL,
	[Area] [int] NOT NULL,
	[Area2] [int] NULL,
	[Area3] [int] NULL,
	[Id_Interna] [int] NOT NULL,
	[Nro_Documento] [int] NOT NULL,
	[Id_Titulo] [smallint] NOT NULL,
	[Id_Tratamiento] [smallint] NOT NULL,
	[Cargo] [smallint] NOT NULL,
	[Cargo2] [smallint] NULL,
	[Cargo3] [smallint] NULL,
	[Baja] [bit] NOT NULL,
	[Fecha_Baja] [smalldatetime] NULL,
	[Ctr] [bit] NOT NULL,
	[FacT] [bit] NOT NULL,
	[AAdm] [bit] NOT NULL,
	[Bajas] [bit] NULL,
	[ddjjRecibo] [bit] NULL,
 CONSTRAINT [PK_Tabla_Firmantes] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[Leer_Sincro_WebRH]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Leer_Sincro_WebRH]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[Leer_Sincro_WebRH]
 
AS
--
---- MIGRACION DE PASES SOLICITADOS DESDE EL WEB 
--	INSERT INTO [dbo].[PLA_Pases_Solicitados]
--	([Id_Interna], [Area_Actual], [Area_Nueva], 
--	[fecha_Solicitud], [Estado], [Solicito], 
--	[Fecha_pase], [Ultima_modificacion],
--	[id])
--
--	SELECT 
--	[DP].[Id_Interna], [SWRHP].[Id_Area_Origen], [SWRHP].[Id_Area_Destino],
--	[SWRHP].[Fecha_Hora_Solicitud], [SWRHP].[Estado_pase], [SWRHP].[Usuario_Solicitud],
--	[SWRHP].[Fecha_Pase], [SWRHP].[id_modificacion], 
--	[SWRHP].[id_pase]
--
--	FROM [Sincro_WebRH].[dbo].[SWRH_Tmp_Pases] [SWRHP]
--	INNER JOIN [dbo].[Datos_Personales] [DP]
--		ON [DP].[Nro_Documento] = [SWRHP].[Nro_Documento]
--	LEFT JOIN [dbo].[WEB_Sincronizacion_Pases] [WSP]
--		ON [WSP].[id_modificacion] = [SWRHP].[id_modificacion]
--	LEFT JOIN [dbo].[PLA_Pases_Solicitados] [PS]
--		ON [PS].[id] = [SWRHP].[id_Pase]
--	WHERE 
--		[WSP].[id_pase] IS NULL AND
--		[PS].[id] IS NULL
--
--	UPDATE dbo.WEB_Sincronizacion_Pases
--	SET realizada = 1
--	WHERE id_modificacion in
--	(Select id FROM Sincro_WebRh.dbo.SWRH_Pases_Recibidos)
--
--
--
--
----PARTES
--INSERT INTO dbo.ASIS_PARTES_WEB (id_area, fecha)
--
--SELECT aaa.area, aaa.fecha FROM 
--[Sincro_WebRH].[dbo].[SWRH_Asistencias_Areas] AAA
--LEFT JOIN dbo.ASIS_PARTES_WEB APW ON
--AAA.area = APW.id_area and
--AAA.fecha = APW.fecha
--WHERE AAA.area is null
--
--
---- MIGRAC. DE LAS INASISTENCIAS DEL PERSONAL DEL PARTE DIARIO (DETALLE)
--	CREATE TABLE #Detalle
--		([Id] [int] identity(1,1), 
--		[Id_Area] [int] NOT NULL ,
--		[Fecha] [smalldatetime] NOT NULL ,
--		[id_interna] [int] NOT NULL ,
--		[Asistencia] [smallint] NOT NULL,
--		[Desde] [smalldatetime] NOT NULL,
--		[Hasta] [smalldatetime] NOT NULL,
--		[usuario] [int] NOT NULL)
--	
--	INSERT INTO #Detalle 
--		([id_area], [fecha], [id_interna], 
--		[asistencia], [Desde], [Hasta], [usuario])
--	
--	SELECT  [AI].[Area], [AI].[Fecha], [DP].[id_interna],
--		[AI].[Asistencia], [AI].[Desde], [AI].[Hasta], [AI].[Id_Usuario]
--	
--	FROM [Sincro_WebRH].[dbo].[SWRH_Asistencias_Ingresadas] [AI]
--	INNER JOIN [dbo].[Datos_Personales] [DP]
--		ON [DP].[Nro_Documento] = [AI].[Nro_Documento]
--
--
--	--INNER JOIN [dbo].[ASIS_Parte_Cabecera] [PC]
--	--	ON [PC].[Id_area] = [AI].[Area]
--	--	AND [PC].[Fecha] = [AI].[Fecha]
--	 
--/*	DECLARE @MaxIdAsistencia int
--	SET @MaxIdAsistencia = (SELECT max(Id_Detalle) FROM [dbo].[ASIS_Parte_Detalle])
--	IF @MaxIdAsistencia IS NULL BEGIN
--		SET @MaxIdAsistencia = 1
--	END
--*/	 
--	--LOOP HECHO PARA INSERTAR REGISTRO POR REGISTRO DEBIDO AL TRIGGER
--	DECLARE @Cont int
--	DECLARE @Cant int
--
--	DECLARE @LastId int
--	SET @LastId = (SELECT MAX(Id) FROM #Detalle)
--	SET @cont = 1
--	 
--/*	WHILE @cont <= @LastId
--	BEGIN
--		INSERT INTO [dbo].[ASIS_Parte_Detalle]
--		([id_detalle], [id_area], [fecha], 
--		[id_interna], [asistencia])
--		
--		SELECT  
--		@MaxIdAsistencia + @cont, [AI].[id_area], [AI].[fecha],
--		[AI].[id_interna], [AI].[Asistencia]
--	
--		FROM #Detalle AI
--		LEFT JOIN [dbo].[ASIS_Parte_Detalle] APD
--			ON [AI].[id_interna] = [APD].[id_interna]
--			AND [AI].[asistencia]   = [APD].[asistencia]
--			AND [AI].[fecha] = [APD].[fecha]
--		WHERE [APD].[id_detalle] IS NULL
--		AND [AI].[id] = @cont
--	
--		SET @cont = @cont + 1
--	END
--*/	 
--	DECLARE @MaxIdSolicit int
--	SET @MaxIdSolicit = (SELECT MAX(id) FROM dbo.ASIS_Solicitudes_licencia_web)
--	IF @MaxIdSolicit IS NULL 
--	BEGIN
--		SET @MaxIdSolicit = 1
--	END
--	 
---- MIGRACION DE LAS SOLICITUDES DE LICENCIAS DE LA WEB
--	INSERT INTO [dbo].[ASIS_Solicitudes_Licencia_Web] 
--	([id], [id_interna], [concepto], [desde], [hasta], [usuario], [fecha_solicitud], [id_area])
--
--	SELECT [TMP].[id] + @MaxIdSolicit, [TMP].[id_interna], [TMP].[Asistencia], [TMP].[Desde], 
--	[TMP].[Hasta], [TMP].[usuario], [TMP].[Fecha], [TMP].[id_area]
--	
--	FROM #Detalle [TMP]
--
--	LEFT JOIN [dbo].[ASIS_Solicitudes_Licencia_Web] [LAN] ON
--		[LAN].[id_interna] = [TMP].[id_interna] AND
--		[LAN].[concepto] = [TMP].[Asistencia]    --CON ESTO ME ASEGURO QUE NO SE DUPLIQUE
--
--	LEFT JOIN [dbo].[Licencias_Solicitadas] [LAN_LS] ON
--		[LAN_LS].[id_interna] = [TMP].[id_interna] AND
--		[LAN_LS].[concepto] = [TMP].[Asistencia] AND
--		(convert(smalldatetime,(floor(cast([LAN_LS].[Desde] as float)))) BETWEEN convert(smalldatetime,(floor(cast([TMP].[Desde] as float))))  AND convert(smalldatetime,(floor(cast([TMP].[Hasta] as float)))) OR
--		 convert(smalldatetime,(floor(cast([LAN_LS].[Hasta] as float)))) BETWEEN convert(smalldatetime,(floor(cast([TMP].[Desde] as float))))  AND convert(smalldatetime,(floor(cast([TMP].[Hasta] as float))))) --CON ESTO ME ASEGURO QUE NO VENGAN LAS YA ACEPTADAS
--
--	LEFT JOIN [dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas] [LAN_LR] ON
--		[LAN_LR].[id_interna] = [TMP].[id_interna] AND
--		[LAN_LR].[concepto] = [TMP].[Asistencia] AND
--		(convert(smalldatetime,(floor(cast([LAN_LR].[Desde] as float)))) = convert(smalldatetime,(floor(cast([TMP].[Desde] as float)))) OR
--                 convert(smalldatetime,(floor(cast([LAN_LR].[Hasta] as float)))) = convert(smalldatetime,(floor(cast([TMP].[Hasta] as float))))) --CON ESTO ME ASEGURO QUE NO VENGAN LAS RECHAZADAS)
--
--	WHERE [LAN].[id] IS NULL AND [LAN_LS].[id] IS NULL AND [LAN_LR].[id] IS NULL
--	
--
--	DROP TABLE #Detalle
--
---- MIGRACION DE AGENTES INCORPORADOS
--	 
--	INSERT INTO [dbo].[PLA_Agentes_Incorporados]
--	([ID], [Area], [Doc], [Apellido], [Nombre], [Funcion], 
--	[Planta], [Usuario_solicito_incorporacion],
--	[fecha_solicitud_incorporacion], [estado], [modificable], 
--	[usuario_cancelo], [fecha_cancelacion], [telefono],
--	[modalidad])
--	
--	SELECT  
--	[TMP].[id], [TMP].[area], [TMP].[Doc], [TMP].[Apellido], [TMP].[Nombre], [TMP].[Funcion],
--	[TMP].[Planta], [TMP].[Usuario_solicito_incorporacion],
--	[TMP].[fecha_solicitud_incorporacion], [TMP].[Estado], [TMP].[Modificable],
--	[TMP].[usuario_cancelo], [TMP].[fecha_cancelacion], [TMP].[te],
--	[TMP].[modalidad_trabajo]
--	
--	FROM [Sincro_WebRH].[dbo].[SWRH_Agentes_Incorporados] [TMP]
--	LEFT JOIN [dbo].[PLA_Agentes_Incorporados] [LAN]
--		ON [TMP].[id] = [LAN].[id]
--	WHERE [LAN].[id] IS NULL
--
----LICENCIAS INTERRUMPIDAS
--	 INSERT INTO [dbo].[ASIS_Interrupcion_Licencias]
--	 SELECT *
--	 FROM [Sincro_WebRH].[dbo].[SWRH_Licencias_Actuales_Interrumpidas]
--	 
----SINCRONIZACION USUARIOS
--	UPDATE [dbo].[Web_Sincronizacion_Usuarios]
--	SET [Realizada] = 1
--	WHERE 
--	[Realizada] = 0 --
--	AND [Id_Modificacion] IN (SELECT [id_modificacion] FROM [Sincro_WebRH].[dbo].[SWRH_Modificaciones_Usuarios])--
----SINCRONIZACION USUARIOS AREAS
--	UPDATE [dbo].[Web_Sincronizacion_UsuariosAreas]
--	SET [Realizada] = 1
--	WHERE 
--	[Realizada] = 0 
--	AND [Id_Modificacion] IN (SELECT [id_modificacion] FROM [Sincro_WebRH].[dbo].[SWRH_Modificaciones_Usuarios_Areas])
-- 
----SINCRONIZACION AREAS
--	UPDATE [dbo].[Web_Sincronizacion_Areas]
--	SET [Realizada] = 1--	WHERE 
--	[Realizada] = 0 
--	AND [Id_Modificacion] IN (SELECT [id_modificacion] FROM [Sincro_WebRH].[dbo].[SWRH_Modificaciones_Areas])
--
----SINCRONIZACION PLANTAS
--	UPDATE [dbo].[Web_Sincronizacion_Plantas]
--	SET [Realizada] = 1
--	WHERE 
--	[Realizada] = 0 
--	AND [Id_Modificacion] IN (SELECT [id_modificacion] FROM [Sincro_WebRH].[dbo].[SWRH_Modificaciones_Plantas])
--
----SINCRONIZACION CONCEPTOS LICENCIAS
--	UPDATE [dbo].[Web_Sincronizacion_Conceptos_Licencias]
--	SET [Realizada] = 1
--	WHERE 
--	[Realizada] = 0 
--	AND [Id_Modificacion] IN (SELECT [id_modificacion] FROM [Sincro_WebRH].[dbo].[SWRH_Modificaciones_Conceptos_Licencias])
--
----SINCRONIZACION DATOS PERSONALES
--	UPDATE [dbo].[WEB_Sincronizacion_DatosPersonales]
--	SET [Realizada] = 1
--	WHERE 
--	[Realizada] = 0 
--	AND [Id_Modificacion] IN (SELECT [id_modificacion] FROM [Sincro_WebRH].[dbo].[SWRH_Modificaciones_Datos_Personales])
--
----SINCRONIZACION SALDOS LICENCIAS
--	UPDATE [dbo].[WEB_Sincronizacion_SaldosLicencias]
--	SET [Realizada] = 1
--	WHERE 
--	[Realizada] = 0 
--	AND [Id_Modificacion] IN (SELECT [id_modificacion] FROM [Sincro_WebRH].[dbo].[SWRH_Modificaciones_Saldos_Licencias])
--
----SINCRONIZACION SALDOS FUNCIONES
--	UPDATE [dbo].[WEB_Sincronizacion_Funciones]
--	SET [Realizada] = 1
--	WHERE 
--	[Realizada] = 0 
--	AND [Id_Modificacion] IN (SELECT [id_modificacion] FROM [Sincro_WebRH].[dbo].[SWRH_Modificaciones_Funciones])
--
' 
END
GO
/****** Object:  Table [dbo].[LEG_Desglose_Area_20120210]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_Area_20120210]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Desglose_Area_20120210](
	[Id] [int] NOT NULL,
	[Id_interna] [int] NOT NULL,
	[Documento] [int] NOT NULL,
	[Id_area] [int] NOT NULL,
	[Desde] [datetime] NOT NULL,
	[Jurisdiccion] [varchar](25) NULL,
	[Organismo] [varchar](25) NULL,
	[Folio] [char](10) NULL,
	[Acto_Tipo] [smallint] NULL,
	[Acto_Nro] [varchar](10) NULL,
	[Acto_Fecha] [datetime] NULL,
	[Usuario] [smallint] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Antiguedad_En_Meses]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Antiguedad_En_Meses]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE    FUNCTION [dbo].[Fx_Antiguedad_En_Meses] (@A Char(8))  
RETURNS  smallint

BEGIN 

declare @Años smallint
declare @Mes smallint
declare @dia  smallint

set @años = cast(left(@a,2) as smallint) * 12
set @Mes = cast(  right(left(@a,5),2) as smallint) 
set @dia = cast (right(@a,2) as smallint)

IF @dia >= 15 BEGIN
	set @mes = @mes +1
END



RETURN @años + @mes  




END


' 
END
GO
/****** Object:  Table [dbo].[LEG_Bloqueos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Bloqueos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Bloqueos](
	[Id_Usuario] [smallint] NULL,
	[Legajo] [int] NULL,
	[Fecha] [datetime] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[WEB_Sincronizacion_SaldosLicencias_20120210]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_Sincronizacion_SaldosLicencias_20120210]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[WEB_Sincronizacion_SaldosLicencias_20120210](
	[Id_interna] [int] NOT NULL,
	[Id_Concepto] [smallint] NOT NULL,
	[id_modificacion] [int] IDENTITY(1,1) NOT NULL,
	[realizada] [bit] NOT NULL,
	[fecha] [smalldatetime] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tmp_Authorizaciones_Net]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tmp_Authorizaciones_Net]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tmp_Authorizaciones_Net](
	[legajo] [int] NOT NULL,
	[dias] [int] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Feriados]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Feriados]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Feriados](
	[Id] [smallint] NULL,
	[Fecha] [smalldatetime] NULL,
	[Año] [int] NULL,
	[Periodico] [bit] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Sexo]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Sexo]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Sexo](
	[Id] [smallint] NOT NULL,
	[Descripcion] [nvarchar](50) NULL,
 CONSTRAINT [PK_Tabla_Sexo] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Autorizaciones_Licencias_20120210]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Autorizaciones_Licencias_20120210]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Autorizaciones_Licencias_20120210](
	[Id_Interna] [int] NOT NULL,
	[Dias_Autorizados] [smallint] NOT NULL,
	[Id_Concepto_Licencia] [smallint] NOT NULL,
	[Periodo] [smallint] NOT NULL,
	[Id] [int] NOT NULL,
	[Dias_Tomados] [smallint] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Instituciones_Educativas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Instituciones_Educativas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Instituciones_Educativas](
	[Id] [int] NOT NULL,
	[Nivel] [smallint] NOT NULL,
	[Descripcion] [varchar](255) NULL,
	[Baja] [bit] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[MNS_Notas_Ingresadas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MNS_Notas_Ingresadas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[MNS_Notas_Ingresadas](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Fecha] [char](10) NOT NULL,
	[Hora] [char](5) NOT NULL,
	[Solicito] [varchar](100) NOT NULL,
	[Motivo] [varchar](200) NOT NULL,
	[Detalle] [text] NOT NULL,
	[AsignadaA] [smallint] NULL,
	[FechaSistema] [smalldatetime] NOT NULL,
	[UsuarioSistema] [smallint] NOT NULL,
 CONSTRAINT [PK_MNS_Notas_Ingresadas] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Autorizaciones_Licencias_bk_20101220]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Autorizaciones_Licencias_bk_20101220]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Autorizaciones_Licencias_bk_20101220](
	[Id_Interna] [int] NOT NULL,
	[Dias_Autorizados] [smallint] NOT NULL,
	[Id_Concepto_Licencia] [smallint] NOT NULL,
	[Periodo] [smallint] NOT NULL,
	[Id] [int] NOT NULL,
	[Dias_Tomados] [smallint] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[CTR_Antiguedad_Grado_Reconocidas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Antiguedad_Grado_Reconocidas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CTR_Antiguedad_Grado_Reconocidas](
	[Id_interna] [int] NOT NULL,
	[Tipo] [char](1) NOT NULL,
	[Id] [int] NOT NULL,
	[Desde] [datetime] NULL,
	[Hasta] [datetime] NULL,
	[FechaCorte] [datetime] NULL,
	[FechaProceso] [datetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Seleccion_Contrato_Memo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Seleccion_Contrato_Memo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Seleccion_Contrato_Memo]        
 @memo int ,  
 @usuario int    
     
as        

set nocount on
        
create table #tempo        
(        
nro_documento int,       
apellido varchar(100),
nombre varchar(100),
nivel varchar(100),
tipo_contrato varchar(50),        
area varchar(200),
fecha_memo varchar(14),
fecha smalldatetime,
area_usuario varchar(200)        
)   


insert into #tempo
select         
c.Nro_Documento,        
dp.Apellido,        
dp.Nombre,        
        
case when C.nivel is not null then                    
 TN.nivel                
else                    
 FC.descripcion                
end nivel,                  
        
case C.tipo_contrato    
  WHEN ''1'' then ''D. 1421/02''    
 WHEN ''2'' then ''D. 1184/01''    
 ELSE tc.descripcion    
END tipo_contrato,     
    
                                                
ta.descripcion Area,        
        
convert(varchar(10),memo)  +''/''+ convert(char(4),year(fecha)) fecha_memo,        
        
fecha,

NULL    
    
        
from dbo.ctr_seleccion_contratos cs        
        
inner join dbo.ctr_contratos c        
 on c.id_contrato = cs.id_contrato        
        
inner join dbo.datos_personales dp        
 on c.nro_documento = dp.nro_documento         
        
inner join dbo.tabla_areas ta        
 on ta.id = cs.id_area        
                                                
inner join dbo.Tabla_Resoluciones_Contratos TC                                     
 on TC.id = c.tipo_contrato                                                  
                                          
left join dbo.tabla_niveles TN                                                  
 on tn.id = c.nivel                        
                                                                                         
left join dbo.Tabla_Funciones_Contratos FC                
 on FC.id = C.funcion                
        

where memo = @memo     
 and cs.usuario = @usuario  
           
    

UPDATE t
SET area_usuario = ta.descripcion
from #tempo t


INNER JOIN dbo.rh_usuarios_detalles ud        
 on ud.Id_Usuario = @usuario

INNER JOIN dbo.datos_personales dp        
 on dp.nro_documento = ud.mail  
  
INNER JOIN dbo.vw_desglose_area da        
 on da.documento = dp.nro_documento        
        
INNER JOIN dbo.tabla_areas ta        
 on ta.id = da.id_area  


  
select 
nro_documento,       
apellido ,
nombre ,
nivel ,
tipo_contrato,        
area,
fecha_memo,
fecha,
area_usuario 
from #tempo
order by apellido, nombre    
' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Estudios_Extensiones]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Estudios_Extensiones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

create procedure [dbo].[RPT_LEG_Estudios_Extensiones]
	@NroDocumento int
AS

SET NOCOUNT ON
create table #Registros
	(C0 varchar(500),
	C1 varchar(500)  ,
	C2 varchar(500)  ,
	C3 varchar(500)  ,
	C4 varchar(500)  ,
	C5 varchar(10) )

INSERT INTO #Registros (c0,c1,c2,c3,c4,c5)
SELECT	rtrim(''Especialidades: Maq/Pal          Idioma/Palabras                     Oficio                          Conocimiento                        Folio''),
	rtrim(TTM.Descripcion + '' / '' + cast(P_Min_Maq as char)) MaquinaPalabras,  
	rtrim(TI.Descripcion + '' / '' + cast(P_Min_Idi as char)) IdiomaPalabras,  
	ISNULL(E.Oficio,'''') Oficio,  
	ISNULL(E.Conocimiento,'''') Conocimiento,  
	E.Folio  
FROM 	dbo.LEG_Estudios_Especialidades E  
LEFT JOIN dbo.Tabla_Estudios_Tipo_Maquina TTM  
	ON TTM.Id = E.Tipo_Maqui  
LEFT JOIN dbo.Tabla_Idiomas TI  
	ON TI.Id = E.Id_Idioma  
WHERE 	E.Doc_Tit = @NroDocumento 
	AND E.DatoDeBaja = 0 
	AND E.DatoNoImprime = 0
ORDER BY Folio   





INSERT INTO #Registros (c0,c1,c2,c3,c4,c5)
SELECT	rtrim(''Idiomas:        Idioma                      Habla                              Lee                                 Escribe                               Folio''),
	TI.Descripcion Idioma,  
	TNIA.Descripcion Habla,  
	TNIL.Descripcion Lee,  
	TNIE.Descripcion Escribe,  
	E.Folio  
FROM 	dbo.LEG_Estudios_Idiomas E    
INNER JOIN dbo.Tabla_Idiomas TI  
	ON TI.Id = E.Id_Idioma  
INNER JOIN dbo.Tabla_Nivel_Idioma TNIA  
	ON TNIA.Id = E.Habla  
INNER JOIN dbo.Tabla_Nivel_Idioma TNIL  
	ON TNIL.Id = E.Lee  
INNER JOIN dbo.Tabla_Nivel_Idioma TNIE  
	ON TNIE.Id = E.Escribe  
WHERE 	E.Nro_Doc = @NroDocumento
	AND E.DatoDeBaja = 0 
	AND E.DatoNoImprime = 0
ORDER BY Idioma  




INSERT INTO #Registros (c0,c1,c2,c3,c4,c5)
SELECT	rtrim(''Otros Estudios: Título                    Institucion                         Ingreso                            Egreso                             Folio'') ,
	E.Titulo Titulo,  
	E.Establecimiento Institucion,  
	convert(char(10),E.Fecha_Ingreso,103) Fecha_ingreso,  
	convert(char(10),E.Fecha_Egreso,103) Fecha_Egreso,  
	E.Folio_Nro Folio  
FROM 	dbo.LEG_Estudios_Otros E    
WHERE 	E.Nro_Doc = @NroDocumento
	AND E.DatoDeBaja = 0 
	AND E.DatoNoImprime = 0
ORDER BY Fecha_Ingreso  

Select c0,c1,c2,c3,c4,c5 from #registros

drop table #registros


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_PersonasCredencialAsignable]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_PersonasCredencialAsignable]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CRED_Get_PersonasCredencialAsignable]
@IdTipoCredencial smallint
as

select p.Id, pr.Documento Documento, pr.Apellido Apellido, pr.Nombre Nombres ,  o.Descripcion Organismo, d.FolioDesde FolioDesde, d.Foliohasta FolioHasta, o.ImagenCredencial AS ImagenCredencialOrganismo, o.TemplateWord AS TemplateWordOrganismo
from dbo.CRED_Personas p, dbo.CRED_PersonasCredencialAsignable pca, dbo.CRED_PedidoAltaPersonas pap,
	dbo.CRED_Organismos o, dbo.CRED_PersonasRelevadas pr, dbo.CRED_TiposCredenciales tc, dbo.CRED_Documentos d 
where p.Id = pca.IdPersona 
	  and p.Id = pap.IdPersona
	  and p.Documento = pr.Documento
	  and pap.IdOrganismo = o.Id
	  and pca.IdTipoCredencial = tc.Id
	  and pap.IdDocumento = d.Id
	  and tc.Id = @IdTipoCredencial
	


' 
END
GO
/****** Object:  Table [dbo].[MED_Diagnosticos_Licencias]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_Diagnosticos_Licencias]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[MED_Diagnosticos_Licencias](
	[Id] [int] NOT NULL,
	[Id_Licencia] [int] NOT NULL,
	[Id_Diagnostico] [smallint] NOT NULL,
	[Regreso] [bit] NOT NULL,
	[Id_Atencion] [int] NULL,
 CONSTRAINT [PK_MED_DIAGNOSTICOS_LICENCIAS] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  UserDefinedFunction [dbo].[FxCalcula_Edad]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[FxCalcula_Edad]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'



CREATE     FUNCTION [dbo].[FxCalcula_Edad] (@Fecha_Nacimiento datetime, @Hasta_Fecha datetime)
	RETURNS int --varchar(5000)

AS  
BEGIN 
DECLARE @EDAD INT		

	SET @EDAD = (YEAR(@hasta_fecha) - YEAR(@FECHA_NACIMIENTO))
	IF MONTH(@fecha_nacimiento) > month(@hasta_fecha) begin
		set @edad = @edad - 1
	END
	IF (MONTH(@fecha_nacimiento) = month(@hasta_fecha)) and
	   (day(@fecha_nacimiento) > day(@hasta_fecha))	 begin
		set @edad = @edad - 1
	END

	return @EDAD 
	
	

END





' 
END
GO
/****** Object:  Table [dbo].[Tabla_Areas_Geograficas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Areas_Geograficas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Areas_Geograficas](
	[idArea] [int] NULL,
	[idProvinciaAfip] [int] NULL,
	[tipo] [char](3) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Historico_Domicilio_Personal]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Historico_Domicilio_Personal]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Historico_Domicilio_Personal](
	[Fecha_Comunicacion] [smalldatetime] NOT NULL,
	[Calle] [varchar](50) NOT NULL,
	[Número] [int] NOT NULL,
	[Piso] [varchar](50) NULL,
	[Dpto] [varchar](50) NULL,
	[Casa] [varchar](10) NULL,
	[Manzana] [varchar](10) NULL,
	[Barrio] [varchar](20) NULL,
	[Torre] [varchar](10) NULL,
	[UF] [varchar](10) NULL,
	[Localidad] [int] NOT NULL,
	[Codigo_Postal] [varchar](50) NOT NULL,
	[Partido_Dpto] [varchar](50) NULL,
	[Provincia] [varchar](50) NULL,
	[Telefono] [varchar](20) NULL,
	[Correo_Electronico] [varchar](50) NULL,
	[Folio] [char](10) NOT NULL,
	[Id_Interna] [int] NOT NULL,
	[Nro_Doc] [int] NOT NULL,
	[ID_Domicilio] [int] NOT NULL,
	[Usuario] [smallint] NULL,
	[DatoDeBaja] [bit] NULL,
	[Operacion] [char](1) NULL,
	[Fecha_Operacion] [datetime] NULL,
	[Correo_Electronico_MDS] [varchar](50) NULL,
	[Telefono2] [varchar](50) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Datos_Familiares]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Datos_Familiares]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Datos_Familiares](
	[Apellido] [varchar](40) NOT NULL,
	[Nombre] [nvarchar](50) NOT NULL,
	[Parentesco] [smallint] NOT NULL,
	[Sexo] [smallint] NOT NULL,
	[Fecha_Nacimiento] [datetime] NULL,
	[Nacionalidad] [smallint] NOT NULL,
	[Fam_Docum_Tipo] [smallint] NOT NULL,
	[Fam_Docum_Nrodoc] [int] NULL,
	[Fam_CI] [int] NULL,
	[Fam_CI_expedido_por] [nvarchar](50) NULL,
	[Fam_otrotipo] [nvarchar](20) NULL,
	[Fam_otrotipo_expedido_por] [nvarchar](50) NULL,
	[Tel1] [varchar](15) NULL,
	[Tel2] [varchar](15) NULL,
	[Tel3] [varchar](15) NULL,
	[Lugar] [nvarchar](50) NULL,
	[Fecha] [smalldatetime] NULL,
	[Fecha_Fallecimiento] [datetime] NULL,
	[Lugar_Fallecimiento_informe] [nvarchar](50) NULL,
	[Fecha_Fallecimiento_informe] [datetime] NULL,
	[Folio_Nro] [char](10) NULL,
	[Id_Interna] [int] NOT NULL,
	[Doc_Titular] [int] NOT NULL,
	[Escolaridad] [smallint] NULL,
	[ACargoDesde] [datetime] NULL,
	[ACargoHasta] [datetime] NULL,
	[discapacitado] [bit] NOT NULL,
	[adoptado] [bit] NOT NULL,
	[fecha_baja] [smalldatetime] NULL,
	[motivo_baja] [smallint] NULL,
	[idfam] [int] NOT NULL,
	[Usuario] [smallint] NOT NULL,
	[Cert_Nacimiento] [bit] NULL,
	[Cert_Matrimonio] [bit] NULL,
 CONSTRAINT [PK_Datos_Familiares] PRIMARY KEY CLUSTERED 
(
	[Id_Interna] ASC,
	[idfam] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Comprobante_Descripcion]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Comprobante_Descripcion]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Comprobante_Descripcion](
	[ID] [int] NOT NULL,
	[Descripcion] [varchar](50) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[PLA_Confirmar_Recibo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_Confirmar_Recibo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[PLA_Confirmar_Recibo]
	@id_interna int,
	@mes smallint,
	@año smallint,
	@usuario smallint
as


update dbo.PLA_Recibos
Set 	confirmado = 1,
	usuario = @usuario
where id_interna = @id_interna
and mes = @mes and
año = @año




' 
END
GO
/****** Object:  Table [dbo].[Tabla_Grado_Letras]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Grado_Letras]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Grado_Letras](
	[Grado] [smallint] NULL,
	[Letra] [char](10) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Primer_Dependencia_Area]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Primer_Dependencia_Area]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_Primer_Dependencia_Area]  (@Id_Area int)  
RETURNS int  AS

BEGIN
	declare @tmp table (Id int)

	insert into @tmp
	select  id_area
	from tabla_areas_estructura
	where right(codigo,5) = ''00000'' AND
		codigo < (select codigo from tabla_areas_estructura where id_area = @id_area and right(rtrim(codigo),5) <> ''00000'') and
		id_area <> @id_area 
	order  by codigo 

	

	RETURN 	isnull((select top 1 id from @tmp order by id desc),0)

END






' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Listar_Dependencias_Areas_activas]    Script Date: 07/19/2012 19:45:11 ******/
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Listar_Dependencias_Areas_activas]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_Listar_Dependencias_Areas_activas]  (@Area int)  
RETURNS @RptD TABLE (Codigo int)  AS

BEGIN

	Declare @nivel int
	Declare @Codigo varchar(24)

	set @codigo = (select top 1 codigo from tabla_areas_estructura where id_area = @Area and right(codigo,5)=''00000'')
	
	IF RIGHT(LEFT(@codigo,19),3) >= ''001''  BEGIN
		set @Nivel = 19
	END
	ELSE IF RIGHT(LEFT(@codigo,16),3) >= ''001''  BEGIN
		set @Nivel = 16
	END 
	ELSE IF RIGHT(LEFT(@codigo,13),3) >= ''001''  BEGIN
		set @Nivel = 13
	END
	ELSE IF RIGHT(LEFT(@codigo,10),3) >= ''001''  BEGIN
		set @Nivel = 10
	END
	ELSE IF RIGHT(LEFT(@codigo,7),3) >= ''001''  BEGIN
		set @Nivel = 7
	END
	ELSE IF RIGHT(LEFT(@codigo,4),2) >= ''001''  BEGIN
		set @Nivel = 4
	END


	insert @Rptd	
	select distinct id_area from tabla_areas_estructura 	where left(codigo,@nivel) = left(@codigo,@nivel)	 and baja = 0

	RETURN

END












' 
END
GO
/****** Object:  Table [dbo].[CTR_Contratos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Contratos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CTR_Contratos](
	[Id_Contrato] [int] NOT NULL,
	[Id_Domicilio] [int] NOT NULL,
	[Nro_Documento] [int] NOT NULL,
	[Tipo_Contrato] [smallint] NOT NULL,
	[Nro_Contrato] [char](11) NOT NULL,
	[Desde] [smalldatetime] NOT NULL,
	[Hasta] [smalldatetime] NOT NULL,
	[Nivel] [smallint] NULL,
	[Grado] [smallint] NULL,
	[Funcion] [smallint] NULL,
	[Rango] [smallint] NULL,
	[Monto] [money] NULL,
	[Id_Area] [int] NOT NULL,
	[Firmado] [bit] NOT NULL,
	[Impreso] [bit] NOT NULL,
	[Fecha_Impresion] [smalldatetime] NULL,
	[Fecha_Dia_Impresion] [smalldatetime] NULL,
	[Exp_Nro] [varchar](30) NULL,
	[Aprobado] [bit] NOT NULL,
	[Acto_Tipo] [smallint] NULL,
	[Acto_Nro] [varchar](20) NULL,
	[Acto_Fecha] [smalldatetime] NULL,
	[Acto_Firmante] [smallint] NULL,
	[Contrato_Firmante] [smallint] NULL,
	[Baja] [bit] NOT NULL,
	[Excepcion] [bit] NOT NULL,
	[Enmienda] [bit] NOT NULL,
	[Salvado] [bit] NOT NULL,
	[Fecha_Salvado] [smalldatetime] NULL,
	[Usuario_Salvado] [smallint] NULL,
	[Observacion] [varchar](200) NULL,
	[Estado] [char](1) NULL,
	[Conserva_Area] [bit] NULL,
	[Usuario] [smallint] NULL,
	[Reservado] [bit] NULL,
	[Alta_Prov_Leg] [bit] NULL,
	[Usua_Alta_Prov_Leg] [smallint] NULL,
	[Fecha_Alta_Prov_Leg] [smalldatetime] NULL,
 CONSTRAINT [PK_CTR_Contratos] PRIMARY KEY CLUSTERED 
(
	[Id_Contrato] ASC,
	[Nro_Contrato] ASC,
	[Nro_Documento] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Capacitacion]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Capacitacion]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Capacitacion](
	[Jurisdicción] [nvarchar](50) NULL,
	[Organismo] [nvarchar](50) NOT NULL,
	[Tema] [nvarchar](100) NOT NULL,
	[Establecimiento] [nvarchar](50) NULL,
	[DependeDe] [nvarchar](50) NULL,
	[Fecha_Desde] [datetime] NOT NULL,
	[Fecha_Hasta] [datetime] NULL,
	[Folio_Nro] [char](10) NULL,
	[Id_Interna] [int] NOT NULL,
	[Id_Capacitacion] [int] NOT NULL,
	[Doc_Titular] [int] NOT NULL,
	[Horas] [smallint] NULL,
	[DatoDeBaja] [bit] NULL,
	[datonoimprime] [bit] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[LocalidadesAFIPbckp2012_03_13]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LocalidadesAFIPbckp2012_03_13]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LocalidadesAFIPbckp2012_03_13](
	[idLocalidad] [int] NULL,
	[codigopostal] [int] NULL,
	[nombrelocalidad] [varchar](255) NULL,
	[id_provincia] [int] NULL,
	[baja] [bit] NULL,
	[ID_Partido] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  View [dbo].[VW_Tmp_Planilla_Asistencia]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/****** Object:  Table [dbo].[recibos_temp]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[recibos_temp]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[recibos_temp](
	[Id_Recibo] [int] NOT NULL,
	[Id_interna] [int] NOT NULL,
	[Mes] [smallint] NOT NULL,
	[Año] [smallint] NOT NULL,
	[Concepto] [nvarchar](50) NOT NULL,
	[Aporte] [varchar](10) NULL,
	[Descuento] [varchar](10) NULL,
	[TipoConcepto] [varchar](2) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Seleccion_Contrato_Memo2]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Seleccion_Contrato_Memo2]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[CTR_GET_Seleccion_Contrato_Memo2]      
 @memo int,  
 @usuario int      
as
set nocount on      
      
DECLARE @string varchar(1000)    
DECLARE @string1 varchar(100)    
DECLARE @string2 varchar(100)    
DECLARE @string3 varchar(50)    
    
    
SET @string = ''correspondiente al período comprendido desde el 01/01/2011 hasta el 31/12/2011.''    
SET @string1 = ''Apellido y Nombre, consta de''           
SET @string2 = ''personas, en''           
SET @string3 = ''páginas.''    
    
    
create table #tempo      
(      
renovar char(1),      
renovacion varchar(50),      
lugar varchar(300),      
nro_documento int,      
responsable varchar(200),      
id_tipo_contrato int,      
tipo_contrato varchar(50),      
cantidad int,      
total int,      
paginas int,      
fecha_memo varchar(14)      
)      
      
INSERT INTO #tempo      
(      
renovar,      
renovacion,      
lugar,      
nro_documento,      
responsable,      
id_tipo_contrato,      
tipo_contrato,      
cantidad,      
total,      
paginas,      
fecha_memo      
)      
      
Select        
 renovar,      
      
 case when c.renovar=''R'' then                                                
   ''Renovación''                                                
 else                                                
   ''No Renovación''                                
 end renovacion,      
      
 NULL lugar,      
      
 dp.nro_documento,      
                             
 dp.apellido +'', ''+ dp.nombre,       
      
 ct.tipo_contrato,      
      
 rc.descripcion tipo_contrato,      
      
 0,      
      
 0,      
       
 paginas,      
      
 convert(varchar(10),@memo) +''/''+ convert(varchar(4),year(fecha))       
      
from dbo.CTR_Seleccion_Contratos c      
      
INNER JOIN dbo.ctr_contratos ct      
 on ct.id_contrato = c.id_contrato      
      
INNER JOIN dbo.Tabla_Resoluciones_Contratos rc      
 on rc.id = ct.tipo_contrato      
      
INNER JOIN dbo.rh_usuarios_detalles ud      
 on ud.Id_Usuario = c.usuario       
      
INNER JOIN dbo.datos_personales dp      
 on dp.nro_documento = ud.mail      
      
where memo = @memo      
 and c.usuario = @usuario  
      
      
UPDATE t      
SET lugar = ta.descripcion      
from #tempo t      
      
INNER JOIN dbo.vw_desglose_area da      
 on da.documento = t.nro_documento      
      
INNER JOIN dbo.tabla_areas ta      
 on ta.id = da.id_area      
      
      
      
UPDATE t      
set cantidad = (select count(*)      
  from #tempo t1      
  where t.renovar = t1.renovar      
   and t.id_tipo_contrato = t1.id_tipo_contrato      
  group by renovar, id_tipo_contrato)      
from #tempo t      
      
      
UPDATE #tempo      
SET total = (select count(*) from #tempo)      
      
      
select distinct      
renovar,      
renovacion,     
renovacion +'' ''+ @string renovacion_string ,    
lugar,      
nro_documento,      
responsable,      
id_tipo_contrato,      
tipo_contrato,      
cantidad,      
total,      
paginas,      
fecha_memo,    
@string1 +'' ''+ convert(varchar(10),total) +'' ''+ @string2 +'' ''+ convert(varchar(10),paginas) +'' ''+ @string3 final_string    
from #tempo

' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Calcula_Dias_Licencia_Antiguedad]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Calcula_Dias_Licencia_Antiguedad]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_Calcula_Dias_Licencia_Antiguedad] (@Ant varchar(10))  
RETURNS int AS  
BEGIN 

	Declare @Dias int

	set @dias =0
	Declare @AA int
	Declare @MM int
	Declare @DD int

	set @AA = cast(left ( @ant,2) as int)
	set @MM = cast( right( left ( @ant,5),2) as int)
	set @DD = cast(right ( @ant,2) as int)

	if @AA = 0 and @MM < 3 begin 
		set @Dias =0  
	end
	else
	begin
		if @AA =0 begin
		--CALCULA PROPORCIONAL 
			if @DD >15 begin set @MM = @mm +1 end
			set @Dias = (select  dias_correspondientes /12 from vw_dias_licencia_ordinaria where años_antiguedad =0) * @mm
		end
		else
		begin
		-- buscar en tabla
		set @dias = (select  top 1 dias_correspondientes from vw_dias_licencia_ordinaria where años_antiguedad <= @AA order by años_antiguedad desc)   
		end

				
		
	end


	
	
	return @dias

END



' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Split]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Split]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'



CREATE  FUNCTION [dbo].[Fx_Split] (@Cadena varchar(60),@Delimitador varchar(1),@Posicion int)
returns varchar(60) AS
BEGIN

DECLARE @String varchar(60)
DECLARE @Pos int
DECLARE @Numero int
DECLARE @NextString  varchar(60)





SET @String = @Cadena
SET @String = @String + @Delimitador
SET @Pos = charindex(@Delimitador,@String)
SET @Numero = 0

WHILE @Numero<>@Posicion
Begin
		
	SET @NextString = substring(@String,1,@Pos - 1)	
	SET @String = substring(@String,@Pos+1,len(@String))
	SET @Pos = charindex(@Delimitador,@String)
	SET @Numero = @Numero + 1

END

RETURN @NextString 
END



' 
END
GO
/****** Object:  Table [dbo].[CTR_Facturas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Facturas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CTR_Facturas](
	[Id_Factura] [int] NOT NULL,
	[Documento] [int] NOT NULL,
	[Fecha_Factura] [smalldatetime] NOT NULL,
	[Nro_Factura] [char](13) NOT NULL,
	[Fecha_Recibida] [smalldatetime] NOT NULL,
	[Monto_Factura] [money] NOT NULL,
	[Fecha_Pase_Cont] [smalldatetime] NULL,
	[Area] [int] NOT NULL,
	[Firmante] [smallint] NULL,
	[Anulada] [bit] NULL,
	[Observacion] [varchar](200) NULL,
	[Usuario_Anula] [int] NULL,
	[Nro_Pase_Cont] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[LEG_DDJJ_Cargos_20120210]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_DDJJ_Cargos_20120210]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_DDJJ_Cargos_20120210](
	[Nro_Documento] [int] NOT NULL,
	[Año] [smallint] NOT NULL,
	[UsuarioRecepciono] [smallint] NOT NULL,
	[FechaRecepciono] [smalldatetime] NOT NULL,
	[Folio] [varchar](10) NULL,
	[Id_Comprobante] [int] NULL,
	[Id] [int] IDENTITY(1,1) NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Sumar_Antiguedad]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Sumar_Antiguedad]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE          FUNCTION [dbo].[Fx_Sumar_Antiguedad] (@Ant1 varchar(10), @Ant2 varchar(10))  
RETURNS  varchar(10) AS 
BEGIN 
	Declare @AntT varchar(10)
	set @Antt =''''
	
	Declare @D int
	declare @m int
	declare @A int

	set @D = cast(right(@Ant1,2) as int) + cast(right(@Ant2,2) as int)

	set @M = cast(            left(right(@Ant1,5),2)           as int) + cast(      left(right(@Ant2,5),2)  as int)
	
	set @A = cast(left(@Ant1,2) as int) + cast(left(@Ant2,2) as int)

	if cast(@d as int)> 30 begin  
		set @M = cast(@m as int) +1 
		set @D = cast(@d as int) - 30
	end
	if @M > 12 begin  
		set @A = cast (@a as int) +1 
		set @m = cast (@m as int) -12
	end


	 set  @Antt  = ( select case when @a < 10 then
			   ''0'' 
			else
			''''
		      end 
		     +  cast(@a as varchar) +''-'' + 
		     case when @m < 10 then
			 ''0''
			else ''''
		     end
			+ cast(@m  as varchar) +''-'' + 
		      case when @d < 10 then
				''0''
			else ''''
			end +
			cast(@d as varchar) )




	

	return @AntT 

END' 
END
GO
/****** Object:  Table [dbo].[MED_ObservacionesPA]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_ObservacionesPA]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[MED_ObservacionesPA](
	[Nro_Documento] [int] NULL,
	[ObservacionesPA] [text] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Cod_Barras]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Cod_Barras]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Cod_Barras](
	[Id_Codigo] [int] NOT NULL,
	[Cadena_Id] [varchar](50) NULL,
	[Col_Concat] [int] NULL,
	[Cant_Pag] [int] NULL,
	[ID_Comprobante] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Fam_Escolaridad]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Fam_Escolaridad]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Fam_Escolaridad](
	[id] [smallint] NOT NULL,
	[Descripcion] [varchar](20) NULL,
 CONSTRAINT [PK_Tabla_Fam_Escolaridad] PRIMARY KEY NONCLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Historico_Datos_Familiares]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Historico_Datos_Familiares]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Historico_Datos_Familiares](
	[Apellido] [nvarchar](50) NOT NULL,
	[Nombre] [nvarchar](50) NOT NULL,
	[Parentesco] [smallint] NULL,
	[Sexo] [smallint] NOT NULL,
	[Fecha_Nacimiento] [datetime] NULL,
	[Nacionalidad] [smallint] NULL,
	[Fam_Docum_Tipo] [smallint] NULL,
	[Fam_Docum_Nrodoc] [int] NULL,
	[Fam_CI] [int] NULL,
	[Fam_CI_expedido_por] [nvarchar](50) NULL,
	[Fam_otrotipo] [nvarchar](20) NULL,
	[Fam_otrotipo_expedido_por] [nvarchar](50) NULL,
	[Tel1] [varchar](15) NULL,
	[Tel2] [varchar](15) NULL,
	[Tel3] [varchar](15) NULL,
	[Lugar] [nvarchar](50) NULL,
	[Fecha] [datetime] NULL,
	[Fecha_Fallecimiento] [datetime] NULL,
	[Lugar_Fallecimiento_informe] [nvarchar](50) NULL,
	[Fecha_Fallecimiento_informe] [datetime] NULL,
	[Folio_Nro] [char](10) NULL,
	[Id_Interna] [int] NOT NULL,
	[Doc_Titular] [int] NOT NULL,
	[Escolaridad] [smallint] NULL,
	[ACargoDesde] [datetime] NULL,
	[ACargoHasta] [datetime] NULL,
	[discapacitado] [bit] NOT NULL,
	[adoptado] [bit] NOT NULL,
	[fecha_baja] [datetime] NULL,
	[motivo_baja] [smallint] NULL,
	[idfam] [int] NULL,
	[Usuario] [smallint] NULL,
	[Cert_Nacimiento] [bit] NULL,
	[Cert_Matrimonio] [bit] NULL,
	[Operacion] [char](1) NULL,
	[Fecha_Operacion] [datetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[RELEVA_GET_ContratosxMonto]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RELEVA_GET_ContratosxMonto]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[RELEVA_GET_ContratosxMonto]
	@m1 int,
	@m2 int
as
select nro_documento from ctr_contratos
where tipo_contrato=2
and monto between @m1 and @m2
and baja=0
and aprobado=1

order by nro_documento


' 
END
GO
/****** Object:  Table [dbo].[LEG_DDJJ_Cargos_Backup20090805]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_DDJJ_Cargos_Backup20090805]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_DDJJ_Cargos_Backup20090805](
	[Nro_Documento] [int] NOT NULL,
	[Año] [smallint] NOT NULL,
	[UsuarioRecepciono] [smallint] NOT NULL,
	[FechaRecepciono] [smalldatetime] NOT NULL,
	[Folio] [varchar](10) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CContrato]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CContrato]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CContrato](
	[Legajo] [int] NOT NULL,
	[Id] [smallint] NOT NULL,
	[Nro_Contrato] [varchar](15) NULL,
	[Tipo_Contrato] [smallint] NULL,
	[Desde] [smalldatetime] NULL,
	[Hasta] [smalldatetime] NULL,
	[Acta_nro] [varchar](10) NULL,
	[Exp_nro] [varchar](20) NULL,
	[Acto_tipo] [smallint] NULL,
	[Acto_nro] [char](10) NULL,
	[Acto_Fecha] [smalldatetime] NULL,
	[Nivel] [smallint] NULL,
	[Grado] [smallint] NULL,
	[Funcion] [smallint] NULL,
	[Rango] [smallint] NULL,
	[monto] [money] NULL,
	[Id_Area] [int] NULL,
	[ID_Secretaria] [int] NULL,
	[Firmado] [smallint] NULL,
	[Impreso] [bit] NULL,
	[FechaBaja] [smalldatetime] NULL,
	[Baja] [bit] NULL,
	[Id_Firma] [int] NULL,
	[Aprobado] [bit] NULL,
	[Observacion] [text] NULL,
	[Motivo_Baja] [smallint] NULL,
	[Excepcion] [smallint] NULL,
	[Enmienda] [smallint] NULL,
	[Acto_Firmante] [int] NULL,
	[fecha_impresion] [smalldatetime] NULL,
	[Estado] [char](1) NULL,
	[Conserva_Area] [bit] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Limite_Tarjeta_Banco]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Limite_Tarjeta_Banco]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Limite_Tarjeta_Banco](
	[Codigo] [varchar](2) NULL,
	[Importe] [int] NULL,
	[Baja] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[LIQ_Nro_Cuenta_Nacion]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_Nro_Cuenta_Nacion]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LIQ_Nro_Cuenta_Nacion](
	[Id] [int] NULL,
	[Proceso] [char](2) NULL,
	[Servicio] [varchar](4) NULL,
	[Sucur_Bco] [int] NULL,
	[id_banco] [int] NULL,
	[Moneda] [char](1) NULL,
	[Limite_Tarjeta] [int] NULL,
	[Documento] [int] NULL,
	[Id_Estado_Civil_Bco] [smallint] NULL,
	[Id_Dom_Pago] [int] NULL,
	[CBU] [varchar](22) NULL,
	[Tarjeta_Debito] [varchar](19) NULL,
	[Tarjeta_1er_Titular] [varchar](19) NULL,
	[Tarjeta_2do_Titular] [varchar](19) NULL,
	[Exportado] [bit] NULL,
	[Usua_Ingre] [smallint] NULL,
	[Fecha_Ingre] [smalldatetime] NULL,
	[Usua_Envia] [smallint] NULL,
	[Fecha_Envia] [smalldatetime] NULL,
	[Usua_Reci] [smallint] NULL,
	[Fecha_Reci] [smalldatetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CEstudios]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CEstudios]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CEstudios](
	[Legajo] [int] NOT NULL,
	[Id] [int] NOT NULL,
	[ID_nivel] [smallint] NULL,
	[ID_Institucion] [smallint] NULL,
	[Insititucion] [varchar](100) NULL,
	[Carrera] [varchar](50) NULL,
	[Titulo] [varchar](50) NULL,
	[Finalizado] [bit] NOT NULL,
	[Ultimo_Año] [char](4) NULL,
	[Mat_Aprob] [char](4) NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_CEstudios] PRIMARY KEY CLUSTERED 
(
	[Legajo] ASC,
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Pases_Solicitados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Pases_Solicitados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ASIS_GET_Pases_Solicitados]
	@Estado smallint=0
as

SELECT ps.id_interna,
	dp.apellido +'', ''+ dp.nombre,
	ta.descripcion AreaActual,
	ta2.descripcion AreaNueva,
	ps.fecha_solicitud,
	ps.estado,
	ps.solicito,
	ps.reviso

FROM dbo.Pases_Solicitados PS
	inner join tabla_Areas TA
		on ta.id = ps.area_actual
	inner join tabla_Areas TA2
		on ta2.id = ps.area_nueva
	inner join datos_personales Dp
		on dp.id_interna = ps.id_interna

WHERE estado = @estado


' 
END
GO
/****** Object:  Table [dbo].[aux_poranyo]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[aux_poranyo]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[aux_poranyo](
	[DNI] [float] NULL,
	[Año] [float] NULL,
	[autorizados] [float] NULL,
	[F4] [nvarchar](255) NULL,
	[F5] [nvarchar](255) NULL,
	[F6] [nvarchar](255) NULL,
	[id_interna] [int] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[MNS_Motivos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MNS_Motivos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[MNS_Motivos](
	[id] [smallint] NOT NULL,
	[Descripcion] [varchar](100) NOT NULL,
 CONSTRAINT [PK_MNS_Motivos] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Contrato_Tempranos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Contrato_Tempranos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CTR_GET_Contrato_Tempranos]  
 @id_cont int  
as  
  
select Fecha_Alta_Prov_Leg from ctr_contratos  
where  Alta_Prov_Leg=1  AND  
 aprobado=0  AND  
 baja=0   AND  
 Id_Contrato = @Id_Cont  
  
  
  


' 
END
GO
/****** Object:  Table [dbo].[Liq_Nro_Cuenta_Activa]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Liq_Nro_Cuenta_Activa]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Liq_Nro_Cuenta_Activa](
	[id] [int] NULL,
	[Documento] [int] NULL,
	[CBU] [varchar](22) NULL,
	[Fecha_Alta] [smalldatetime] NULL,
	[Usua_Alta] [int] NULL,
	[Fecha_Baja] [smalldatetime] NULL,
	[Usua_Baja] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CContrato_Funciones]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CContrato_Funciones]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CContrato_Funciones](
	[ID] [int] NOT NULL,
	[ID_Nivel] [smallint] NOT NULL,
	[CargaHsSemLetras] [varchar](20) NULL,
	[CargaHsSemNro] [smallint] NULL,
	[Funcion] [varchar](50) NULL,
	[Objeto] [text] NULL,
 CONSTRAINT [PK_CContrato_Funciones] PRIMARY KEY NONCLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Recepcion_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Recepcion_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Recepcion_Contratos]
	@Compro_Envio int = 0, --0: todos, 1: Enviado, 2: No Enviado
	@usuario int = 0 --Se agrego para que no tire error pero no funciona. 
						--GER: 14/11/2011

as
set nocount on

create table #tempo
(
apellido varchar(100),
nombre varchar(100),
Id_Contrato int,
Compro_Recepcion int,
Compro_Recepcion_Fecha char(10),
Compro_Recepcion_Usuario varchar(20),
Compro_Envio int,
Compro_Envio_Fecha char(10),
Compro_Envio_Usuario varchar(20)
)

INSERT INTO #tempo
select  dp.apellido,
	dp.nombre,
	rc.Id_Contrato,
	rc.Compro_Recepcion,
	convert(char(10),rc.Compro_Recepcion_Fecha,103),
	u.nombre,
	isnull(rc.Compro_Envio,''0'') Compro_Envio, 
	isnull(convert(char(10),rc.Compro_Envio_Fecha,103),'''') Compro_Envio_Fecha,
	isnull(u2.nombre,'''') nombre

from dbo.CTR_Recepcion_Contratos rc

inner join ctr_contratos cc
	on cc.id_contrato = rc.id_contrato

inner join datos_personales dp
	on dp.nro_documento = cc.nro_documento

left join rh_usuarios u
	on u.id = rc.Compro_Recepcion_Usuario

left join rh_usuarios u2
	on u2.id = rc.Compro_Envio_Usuario



--TODOS
if @Compro_Envio = 0
begin
	select apellido,
		nombre,
		Id_Contrato,
		Compro_Recepcion,
		Compro_Recepcion_Fecha,
		Compro_Recepcion_Usuario,
		Compro_Envio,
		Compro_Envio_Fecha,
		Compro_Envio_Usuario
	from #tempo
	order by Compro_Recepcion, apellido, nombre
end


--ENVIADOS
if @Compro_Envio = 1
begin
	select apellido,
		nombre,
		Id_Contrato,
		Compro_Recepcion,
		Compro_Recepcion_Fecha,
		Compro_Recepcion_Usuario,
		Compro_Envio,
		Compro_Envio_Fecha,
		Compro_Envio_Usuario
	from #tempo
	where Compro_Envio <> 0
	order by Compro_Recepcion, apellido, nombre
end


--NO ENVIADOS
if @Compro_Envio = 2
begin
	select apellido,
		nombre,
		Id_Contrato,
		Compro_Recepcion,
		Compro_Recepcion_Fecha,
		Compro_Recepcion_Usuario,
		Compro_Envio,
		Compro_Envio_Fecha,
		Compro_Envio_Usuario
	from #tempo
	where Compro_Envio = 0
	order by Compro_Recepcion, apellido, nombre
end






' 
END
GO
/****** Object:  Table [dbo].[LEG_Desglose_UR]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_UR]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Desglose_UR](
	[Id] [int] NOT NULL,
	[Id_interna] [int] NOT NULL,
	[Documento] [int] NULL,
	[Id_area] [bigint] NULL,
	[Cant_UR] [int] NULL,
	[Desde] [datetime] NULL,
	[Hasta] [datetime] NULL,
	[Acto_Tipo] [smallint] NULL,
	[Acto_Nro] [varchar](10) NULL,
	[Acto_Fecha] [datetime] NULL,
	[Acto_Tipo_Baja] [smallint] NULL,
	[Acto_Nro_Baja] [varchar](10) NULL,
	[Acto_Fecha_Baja] [datetime] NULL,
	[Baja] [bit] NOT NULL,
	[Usuario] [smallint] NULL,
	[Acto_Firmante] [int] NULL,
	[Acto_Firmante_Baja] [int] NULL,
	[Exp_Nro] [varchar](30) NULL,
	[Tipo_UR] [int] NULL,
	[Estado] [char](2) NULL,
	[Motivo_Baja] [int] NULL,
	[Fecha_Baja] [datetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[PLA_Recibos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_Recibos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[PLA_Recibos](
	[Id_Recibo] [int] NOT NULL,
	[Id_Interna] [int] NOT NULL,
	[mes] [smallint] NOT NULL,
	[año] [smallint] NOT NULL,
	[Cuil] [varchar](13) NULL,
	[Id_Oficina] [smallint] NULL,
	[Nro_Orden] [smallint] NULL,
	[Nivel] [char](1) NULL,
	[grado] [char](2) NULL,
	[F_Ingreso] [datetime] NULL,
	[SBruto] [float] NULL,
	[SNeto] [float] NULL,
	[NroCta] [varchar](10) NULL,
	[Banco] [varchar](20) NULL,
	[F_Deposito] [datetime] NULL,
	[confirmado] [bit] NULL,
	[Usuario] [smallint] NULL,
	[SDescuentos] [float] NULL,
	[Impreso] [bit] NOT NULL,
	[Entregado] [bit] NOT NULL,
	[Recibido] [bit] NOT NULL,
	[TipoLiquidacion] [varchar](2) NULL,
	[OpcionJubilatoria] [varchar](2) NULL,
	[AFJP] [varchar](10) NULL,
	[liquidacion] [int] NULL,
 CONSTRAINT [PK_PLA_Recibos] PRIMARY KEY CLUSTERED 
(
	[Id_Recibo] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Estudios_Niveles]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Niveles]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Estudios_Niveles](
	[Id] [smallint] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[Cod_Gest_Pub] [char](1) NULL,
	[Baja] [bit] NOT NULL,
	[Orden] [smallint] NOT NULL,
 CONSTRAINT [PK_Tabla_Estudios_Niveles] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Tipo_Cuenta_Banco]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Tipo_Cuenta_Banco]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Tipo_Cuenta_Banco](
	[Id_Banco] [int] NULL,
	[Id_Tipo_Cuenta] [int] NULL,
	[Descripcion] [varchar](20) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[MED_Analisis]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_Analisis]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[MED_Analisis](
	[Nro_Documento] [int] NOT NULL,
	[IdAnalisis] [int] NOT NULL,
	[FechaSolicitud] [smalldatetime] NULL,
	[FechaRecepcion] [smalldatetime] NULL,
	[SP] [bit] NULL,
	[Repite] [bit] NULL,
	[Observaciones] [text] NULL,
	[IdApto] [int] NULL,
	[IdAtencion] [int] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Funciones_Cargos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Funciones_Cargos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Funciones_Cargos](
	[Id] [smallint] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](50) NULL,
	[Baja] [bit] NOT NULL,
	[CertificadoAntiguedad] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Funciones_Cargos] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[EVAL_Categorias]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_Categorias]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[EVAL_Categorias](
	[id_nivel] [smallint] NOT NULL,
	[deficiente] [smallint] NOT NULL,
	[regular] [smallint] NOT NULL,
	[bueno] [smallint] NOT NULL,
	[destacado] [smallint] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[CTR_Contratos_Bajas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Contratos_Bajas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CTR_Contratos_Bajas](
	[Nro_Documento] [int] NOT NULL,
	[Id_Contrato] [int] NOT NULL,
	[Acto_Tipo] [smallint] NULL,
	[Acto_Nro] [char](10) NULL,
	[Acto_Fecha] [smalldatetime] NULL,
	[Acto_Firmante] [int] NULL,
	[Motivo_Baja] [smallint] NULL,
	[Fecha_Baja] [smalldatetime] NULL,
	[Usuario] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Domicilio_Laboral]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Domicilio_Laboral]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Domicilio_Laboral](
	[Fecha_Comunicacion] [smalldatetime] NOT NULL,
	[Calle] [varchar](50) NOT NULL,
	[Número] [int] NOT NULL,
	[Piso] [varchar](5) NULL,
	[Dpto] [varchar](5) NULL,
	[Casa] [varchar](10) NULL,
	[Manzana] [varchar](10) NULL,
	[Barrio] [varchar](20) NULL,
	[Torre] [varchar](10) NULL,
	[UF] [varchar](10) NULL,
	[Codigo_Postal] [int] NOT NULL,
	[Localidad] [int] NOT NULL,
	[Id_Interna] [int] NOT NULL,
	[Nro_Doc] [int] NOT NULL,
	[ID_Domicilio] [int] NOT NULL,
	[Usuario] [smallint] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Provincias]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Provincias]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Provincias](
	[idProvincia] [smallint] NOT NULL,
	[nombreProvincia] [varchar](20) NOT NULL,
	[codAFIP] [smallint] NOT NULL,
	[Cod_Bco] [tinyint] NULL,
	[Cod_Bco_Nacion] [char](2) NULL,
 CONSTRAINT [PK_Provincias] PRIMARY KEY CLUSTERED 
(
	[codAFIP] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY],
 CONSTRAINT [IX_Provincias] UNIQUE NONCLUSTERED 
(
	[idProvincia] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[ASIS_Observaciones_Cardex]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Observaciones_Cardex]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ASIS_Observaciones_Cardex](
	[Nro_Documento] [int] NOT NULL,
	[Periodo] [int] NOT NULL,
	[Observaciones] [varchar](1500) NOT NULL,
 CONSTRAINT [PK_ASIS_Observaciones_Cardex] PRIMARY KEY CLUSTERED 
(
	[Nro_Documento] ASC,
	[Periodo] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[MED_Embarazadas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_Embarazadas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[MED_Embarazadas](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Nro_Documento] [int] NOT NULL,
	[FechaProbable] [smalldatetime] NOT NULL,
	[ObservacionesPreParto] [text] NULL,
	[FechaParto] [smalldatetime] NULL,
	[ObservacionesPosParto] [text] NULL,
	[IdLicencia] [int] NULL,
	[Baja] [bit] NOT NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Dias_Maximos_Licencias]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Dias_Maximos_Licencias]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ASIS_GET_Dias_Maximos_Licencias]
	@Concepto smallint
AS
Select 	DiasMensuales,
	DiasConsecutivos
FROM 	dbo.Tabla_Conceptos_Licencias
WHERE 	id_Concepto = @Concepto AND
	Baja = 0



' 
END
GO
/****** Object:  Table [dbo].[CTR_Facturas_Detalle]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Facturas_Detalle]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CTR_Facturas_Detalle](
	[Id_Factura] [int] NULL,
	[Mes_Factura] [int] NULL,
	[Año_Factura] [int] NULL,
	[Monto_Factura] [money] NULL,
	[Anulada] [bit] NULL,
	[Id_Contrato] [int] NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Renovacion_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Renovacion_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'  
CREATE    PROCEDURE [dbo].[CTR_GET_Renovacion_Contratos]       
 @Area_Real int=null,                      
 @Area_Cont int=null,                      
 @Contrato int=null,                  
 @Hasta_Cont smalldatetime = null,                  
 @Certificado char(1),  
 @IdUsuario int                 
                      
AS                      
SET NOCOUNT ON                      
                      
 create table #t                      
(nro_contrato varchar(11),              
 nro_documento int,                  
 t_id_contrato int,      
 Id_Calculo int)                      
                         
 create table #t2                      
(nro_documento int)                      
              
 create table #tempo              
(Id_Contrato int,                      
 nro_documento int,                      
 Apellido varchar(100),                      
 Nombre varchar(100),                       
 Id_Area_Contrato int ,                      
 Area_Contrato varchar(400),                      
 Id_Area_Real int,                      
 Area_Real varchar(400),                      
 Id_tipo_Contrato int,                      
 Tipo_Contrato varchar(100),                       
 Desde smalldatetime,                      
 Hasta smalldatetime,                      
 id_nivel int,                      
 nivel char(1),                      
 Id_grado int,                      
 grado char(2),                              
 Id_Funcion int,                      
 Funcion varchar(100),                      
 id_rango int,                      
 Rango varchar(100),                      
 monto money,                              
 Reservado char(2),                            
 nro_contrato char(11),                      
 Estado char(1),                      
 Id_domicilio int,                      
 contrato_firmante int,                      
 observacion varchar(300),                      
 firmante varchar(300),                      
 id_interna int,      
 id_calculo int)                     
              
              
insert into #t                      
  select max(nro_contrato), nro_documento, id_contrato, NULL                       
  from dbo.ctr_contratos                       
  where aprobado=1  and                      
   Baja=0 and                      
   Impreso = 1 and                      
   Firmado = 1 AND                      
   (id_area = @Area_Cont or @Area_Cont is null) and                      
   (tipo_contrato = @Contrato  or @Contrato is null)              
   group by nro_documento , id_contrato                     
                 
insert into #t2                      
  select nro_documento from dbo.ctr_contratos                      
    where (estado=''R'' or estado=''E'') and baja=0 and aprobado=0                      
        
        
delete from #t               
where nro_documento in (select nro_documento from #t2)                       
               
         
update #t      
set Id_Calculo = idcalculo      
from #t       
left join dbo.CTR_Antiguedad_Certificados      
 on t_id_contrato = idcontrato       
      
      
IF @certificado = ''S''                   
BEGIN                  
  --Filtro por los contratos que tienen certificado                  
  delete from #t                   
  where Id_Calculo is null      
END                  
        
IF @certificado = ''N''                   
BEGIN                   
  --Filtro por los contratos que no tienen certificado                   
   delete from #t                   
   where Id_Calculo is not null      
END                  
                 
  
------GER-190711 Filtro por area del usuario    
DELETE #t    
where nro_contrato not in (    
 select  t.nro_contrato    
 from #t t    
 INNER JOIN ctr_contratos c    
 ON c.nro_contrato = t.nro_contrato      
 INNER JOIN dbo.VW_Desglose_Area DA        
 on DA.Documento = c.Nro_Documento         
 INNER JOIN dbo.RH_Usuarios_Areas UA        
 on UA.Id_Usuario = @IdUsuario AND        
 (UA.Id_Area = DA.Id_Area or Ua.id_area = 0))    
------GER-190711   
  
            
insert into #tempo              
select  C.Id_Contrato,                      
 C.nro_documento,                      
 DP.Apellido,                      
 DP.Nombre,                      
 c.id_area Id_Area_Contrato,                      
 NULL, --TA.descripcion Area_Contrato,                      
 NULL, --da.id_area Id_Area_Real,                      
 NULL, --TA2.descripcion Area_Real,                      
 TC.id Id_tipo_Contrato,                      
 TC.descripcion Tipo_Contrato,                        
 convert (varchar(10), C.[Desde],103) Desde ,                      
 convert (varchar(10), C.[Hasta],103) Hasta,                      
 c.nivel id_nivel,                      
 tn.nivel,                 
 c.grado Id_grado,                      
 tg.grado,                          
 c.funcion Id_Funcion,                      
 fc.descripcion Funcion,                      
 c.rango id_rango,                      
 r.Descripcion Rango,                      
 c.monto,                         
 case when c.reservado=1 then                      
  ''SI''                      
 else                      
  ''NO''                      
 end Reservado,                            
 c.nro_contrato,                      
 c.Estado,                     
 d.Id_domicilio,                      
 c.contrato_firmante,                      
 c.observacion,                      
 DPF.apellido firmante,                      
 dp.id_interna,      
 t.Id_Calculo                    
                      
From  dbo.CTR_Contratos C                      
                      
left join dbo.tabla_funciones_contratos FC  --1184                      
on fc.id=c.funcion                      
                      
inner join dbo.Datos_Personales DP                      
on DP.nro_documento = C.nro_documento                      
                      
LEFT join dbo.domicilio_personal D                      
on d.nro_doc=c.nro_documento and d.id_domicilio = (select max(id_domicilio) from domicilio_personal where nro_doc = c.nro_documento)                      
                      
left join dbo.Tabla_Resoluciones_Contratos TC                      
 on TC.id = C.tipo_contrato                 
                      
-- -- -- -- -- LEFT join dbo.tabla_areas TA                      
-- -- -- -- --  on TA.id = c.id_area                              
-- -- -- -- -- LEFT join dbo.vw_desglose_area da                      
-- -- -- -- --  on da.documento  = c.nro_documento                            
-- -- -- -- -- LEFT join dbo.tabla_areas TA2                      
-- -- -- -- --  on TA2.id = da.id_area                      
                      
-- -- -- -- -- --left join dbo.cfirmantes_contratos cfc                      
-- -- -- -- -- -- on cfc.id=C.Contrato_Firmante                      
              
LEFT join dbo.Tabla_Firmantes cfc                  
 on cfc.id = C.Contrato_Firmante                  
LEFT join dbo.datos_personales DPF                  
 on cfc.nro_documento=DPF.nro_documento                  
              
left join dbo.tabla_niveles TN                      
 on tn.id=c.nivel                      
                      
left join dbo.tabla_grados TG                      
 on tg.id=c.grado                      
                      
-- -- -- -- left join dbo.tabla_grado_letras TGL                      
-- -- -- --  on tgl.grado=tg.grado                      
                      
left join dbo.ccontrato_funciones CCF  --1421                      
on ccf.id_nivel=tn.id                      
                      
left join dbo.tabla_rangos R                      
 on r.id=c.rango                      
                      
INNER JOIN #t t                      
on t.nro_contrato = c.nro_contrato                      
                      
          
              
update #tempo              
set  Area_Contrato = TA.descripcion,                      
  Id_Area_Real = da.id_area,                      
  Area_Real = TA2.descripcion              
from #tempo t              
               
LEFT join dbo.tabla_areas TA                      
 on TA.id = t.Id_Area_Contrato                     
              
LEFT join dbo.vw_desglose_area da                      
 on da.documento  = t.nro_documento                     
                      
LEFT join dbo.tabla_areas TA2                      
 on TA2.id = da.id_area                 
                      
              
select distinct *     
from #tempo       
Where (Id_Area_Real = @area_real or @area_real is null)                    
and (hasta <= @hasta_cont or @hasta_cont is null)                   
order by Apellido, Nombre               
              
              
              
drop table #t                      
drop table #t2                      
drop table #tempo                      
        
      ' 
END
GO
/****** Object:  Table [dbo].[Sanciones]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Sanciones]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Sanciones](
	[Jurisdicción] [nvarchar](50) NULL,
	[Organismo] [nvarchar](50) NULL,
	[Acto_Tipo] [int] NULL,
	[Acto_Nro] [nvarchar](10) NULL,
	[Fecha] [smalldatetime] NULL,
	[Medida] [nvarchar](50) NULL,
	[Motivo] [nvarchar](100) NULL,
	[Fecha_Cumplimiento_desde] [smalldatetime] NULL,
	[Fecha_Cumplimiento_Hasta] [smalldatetime] NULL,
	[Folio_Nro] [char](10) NOT NULL,
	[Id_Interna] [int] NOT NULL,
	[Id] [int] NOT NULL,
	[DatoDeBaja] [bit] NULL,
	[datonoimprime] [bit] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Antiguedad]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Antiguedad]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Antiguedad](
	[Ant_estado] [char](8) NULL,
	[Ant_privada] [char](8) NULL,
	[Ant_total] [char](8) NULL,
	[Resta_ant_min] [char](8) NULL,
	[Id_interna] [int] NULL,
	[Legajo] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[MED_Conceptos_Licencias]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_Conceptos_Licencias]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create PROCEDURE [dbo].[MED_Conceptos_Licencias]
AS
SELECT  Id_Concepto,
	RTRIM(cast(Nro_Articulo as char)) + '' '' + RTRIM(UPPER(Concepto)) Concepto,
	Descripcion
FROM 	dbo.Tabla_Conceptos_Licencias
WHERE 	Licencia_Medica = 1 AND
	Baja = 0
ORDER BY concepto
' 
END
GO
/****** Object:  Table [dbo].[LEG_Licencias_Autorizadas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Licencias_Autorizadas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Licencias_Autorizadas](
	[Id_interna] [int] NULL,
	[Año] [smallint] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Historico_Legajo_Bajas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Historico_Legajo_Bajas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Historico_Legajo_Bajas](
	[Id_Interna] [int] NOT NULL,
	[Nro_Doc] [int] NULL,
	[Fecha_Baja] [datetime] NOT NULL,
	[Motivo_Baja] [smallint] NOT NULL,
	[Usuario] [smallint] NULL,
	[Acto_Tipo] [smallint] NULL,
	[Acto_Nro] [char](10) NULL,
	[Acto_Fecha] [smalldatetime] NULL,
	[Acto_Firmante] [int] NULL,
	[Ingreso_Ministerio] [datetime] NULL,
	[Operacion] [char](1) NULL,
	[Fecha] [datetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[TMP_RPT_Indice_Documentos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[TMP_RPT_Indice_Documentos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[TMP_RPT_Indice_Documentos](
	[id_interna] [int] NULL,
	[JUR] [varchar](50) NULL,
	[ORG] [varchar](50) NULL,
	[TIPO] [varchar](65) NULL,
	[FOLIO] [char](10) NULL,
	[desde] [datetime] NULL,
	[hasta] [datetime] NULL,
	[Desde2] [char](10) NULL,
	[Hasta2] [char](10) NULL,
	[Intervino] [varchar](50) NULL,
	[Desglose] [varchar](50) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  View [dbo].[VW_tabla_funciones_contratos]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_tabla_funciones_contratos]'))
EXEC dbo.sp_executesql @statement = N'create view [dbo].[VW_tabla_funciones_contratos]
AS

SELect Id, Descripcion 
from dbo.tabla_funciones_contratos

'
GO
/****** Object:  Table [dbo].[CTR_Expedientes_Anexados]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Expedientes_Anexados]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CTR_Expedientes_Anexados](
	[Id_Contrato] [int] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Medicos_Enfermedades_PreExistentes]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Medicos_Enfermedades_PreExistentes]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Medicos_Enfermedades_PreExistentes](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](200) NOT NULL,
	[Baja] [bit] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Servicios_Jubilatorios]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Servicios_Jubilatorios]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Servicios_Jubilatorios](
	[Caja] [varchar](15) NULL,
	[Afiliacion_Nro] [varchar](30) NULL,
	[Fecha_Desde] [datetime] NULL,
	[Fecha_Hasta] [datetime] NULL,
	[Cantidad_años] [smallint] NULL,
	[Cantidad_meses] [smallint] NULL,
	[Cantidad_dias] [smallint] NULL,
	[Folio] [char](10) NOT NULL,
	[Id_Interna] [int] NOT NULL,
	[Doc_Titular] [int] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Historico_Tabla_Areas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Historico_Tabla_Areas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Historico_Tabla_Areas](
	[id] [int] NOT NULL,
	[descripcion] [varchar](200) NULL,
	[Baja] [bit] NOT NULL,
	[Fecha_Desde] [smalldatetime] NULL,
	[Presenta_DDJJ] [smallint] NULL,
	[Usuario] [smallint] NULL,
	[Operacion] [char](1) NULL,
	[Fecha] [datetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Existencia_Folio]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Existencia_Folio]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[LEG_GET_Existencia_Folio]
	@id_interna int,
	@Folio varchar(10)=null
AS

--Domicilio PERSONAL
select folio
FROM Domicilio_personal
WHERE id_interna = @id_interna  AND (folio = @Folio or @Folio is null)

union

--Domicilio FAMILIARES
select folio
FROM dbo.Domicilio_familiares D
WHERE id_interno = @id_interna  AND (folio = @Folio or @Folio is null)

union

--DESIGNACIONES
select folio
from designaciones D
WHERE 	id_interna = @id_interna  AND (folio = @Folio or @Folio is null)

union

--CARRERA ADMINISTRATIVA
select folio
from carrera_administrativa C
WHERE 	id_interna = @id_interna  AND (folio = @Folio or @Folio is null)

union 

--FELICITACIONES
select Folio_nro 
FROM dbo.felicitaciones
WHERE 	id_interna = @id_interna  AND (folio_nro = @Folio or @Folio is null)

union 

--EMBARGOS
select folio
from embargos
WHERE 	id_interna = @id_interna  AND (folio = @Folio or @Folio is null)

union

--Estudiios realizados
select folio_nro
from estudios_realizados ER
WHERE 	id_interna = @id_interna  AND (folio_nro = @Folio or @Folio is null)

union

--estudios_idiomas
select  folio
from estudios_Idiomas
WHERE 	id_interna = @id_interna  AND (folio = @Folio or @Folio is null)

union

--estudios_ESPECIALIDADES
select folio
from estudios_especilidades
WHERE 	id_interna = @id_interna  AND (folio = @Folio or @Folio is null)

union


--OTROS ESTUDIOS
select folio_nro
from estudios_otros
WHERE 	id_interna = @id_interna  AND (folio_nro = @Folio or @Folio is null)

union

--LICENCIAS
select folio
from licencias
WHERE 	id_interna = @id_interna  AND (folio = @Folio or @Folio is null)

union

--OTROS DATOS
select folio
from otros_datos
WHERE 	id_interna = @id_interna  AND (folio = @Folio or @Folio is null)

union

--PASIVIDAD
select folio_nro
from pasividad
WHERE 	id_interna = @id_interna  AND (folio_nro = @Folio or @Folio is null)

union

--CAPACITACION
select folio_nro
from capacitacion
WHERE 	id_interna = @id_interna  AND (folio_nro = @Folio or @Folio is null)

union

--CALIFICACIONES
select folio
from calificaciones
WHERE 	id_interna = @id_interna  AND (folio = @Folio or @Folio is null)

union

-- OTROS SERVICIOS
select folio
from dbo.otros_servicios
WHERE 	id_interna = @id_interna  AND (folio = @Folio or @Folio is null)

union

-- SERVICIOS ADM PUBLICA
select folio
from dbo.servicios_adm_publica
WHERE 	id_interna = @id_interna  AND (folio = @Folio or @Folio is null)

union

--OTROS DOC AGREGADOS
select Fojafrom  dbo.Otros_Indice_Documentos
WHERE 	id_interna = @id_interna  AND (foja = @Folio or @Folio is null)


union

--PSICOFISICOS
select Folio_nro
from  dbo.Psicofisico
WHERE 	id_interna = @id_interna  AND (folio_nro = @Folio or @Folio is null)





' 
END
GO
/****** Object:  Table [dbo].[Tabla_Sinapa]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Sinapa]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Sinapa](
	[Id] [smallint] NOT NULL,
	[Nivel] [varchar](2) NOT NULL,
	[Grado] [smallint] NOT NULL,
	[Remuneracion_Fija] [money] NULL,
	[Remuneracion_Var] [money] NULL,
	[Baja] [bit] NOT NULL,
	[Desde] [smalldatetime] NULL,
 CONSTRAINT [PK_Tabla_Sinapa] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Areas_Estructura_BKP_121108]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Areas_Estructura_BKP_121108]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Areas_Estructura_BKP_121108](
	[codigo] [char](24) NOT NULL,
	[Id_area] [int] NOT NULL,
	[Descripcion] [varchar](200) NOT NULL,
	[Baja] [bit] NOT NULL,
	[Acto_Baja] [smallint] NULL,
	[Acto_Nro] [varchar](10) NULL,
	[Acto_Fecha] [datetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_Nivel_Formulario]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_Nivel_Formulario]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <24/04/2008>
-- Description:	<Trae el formulario vigente para un nivel de evaluacion>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_GET_Nivel_Formulario]
	@id_nivel int
AS
BEGIN
	SET NOCOUNT ON;

	SELECT id_formulario
	FROM dbo.EVAL_Formularios
	WHERE id_nivel = @id_nivel AND baja = 0
END


' 
END
GO
/****** Object:  Table [dbo].[Tabla_Tipos_Designaciones]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Tipos_Designaciones]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Tipos_Designaciones](
	[Id] [int] NOT NULL,
	[Descripcion] [varchar](30) NULL,
	[Baja] [bit] NULL,
	[EsIngreso] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Tipo_Designaciones] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_Niveles_Evaluacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_Niveles_Evaluacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <24/04/2008>
-- Description:	<Trae todos los Niveles de Evaluacion>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_GET_Niveles_Evaluacion]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT id_nivel, Descripcion, Detalle
	FROM dbo.EVAL_Niveles
END

' 
END
GO
/****** Object:  Table [dbo].[Log_WEB]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Log_WEB]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Log_WEB](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[idusuario] [int] NULL,
	[fecha] [smalldatetime] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Autorizaciones_Licencias_bk_041207]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Autorizaciones_Licencias_bk_041207]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Autorizaciones_Licencias_bk_041207](
	[Id_Interna] [int] NOT NULL,
	[Dias_Autorizados] [smallint] NOT NULL,
	[Id_Concepto_Licencia] [smallint] NOT NULL,
	[Periodo] [smallint] NOT NULL,
	[Id] [int] NOT NULL,
	[Dias_Tomados] [smallint] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Psicofisico]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Psicofisico]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Psicofisico](
	[Jurisdiccion] [varchar](50) NULL,
	[Organismo] [varchar](50) NULL,
	[Fecha] [smalldatetime] NULL,
	[Motivo] [nvarchar](50) NULL,
	[Resultado] [varchar](100) NULL,
	[Org_Expidió] [varchar](50) NULL,
	[Folio_Nro] [char](10) NOT NULL,
	[Id_Interna] [int] NOT NULL,
	[Id_Psicofisico] [int] NOT NULL,
	[DatoDeBaja] [bit] NULL,
	[datonoimprime] [bit] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Lugar_Trabajo_UR]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Lugar_Trabajo_UR]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[RPT_LEG_Lugar_Trabajo_UR]               
as                
set nocount on            
                  
CREATE TABLE #Tempo          
( Documento int,           
  Id_Area_UR int,          
  Area_UR varchar(200),          
  Cant_Area_UR int,           
  Id_Sec int,      
  Secretaria varchar(200),                  
  cant_ur int,          
  igual int )          
          
CREATE TABLE #listado          
( codigo_UR char(24),  
  Id_Area_UR int,        
  Area_UR varchar(200),                  
  Suma_Total_Utilizadas int,          
  Suma_Misma_Utilizadas int,          
  Suma_Otras_Utilizadas int,          
  codigo_SEC char(24),  
  Id_Area_Prestada int,      
  Area_Prestada varchar(200),          
  Suma_Area_Prestada int,          
  Libres int,          
  Cantidad_Total_Area int,    
  Fecha smalldatetime)          
          
CREATE TABLE #Suma_UR_Prestadas          
( Area_UR varchar(200),                  
  cantidad int)          
          
CREATE TABLE #Suma_UR_Misma          
( Area_UR varchar(200),                  
  cantidad int)          
          
CREATE TABLE #Libres
( id_area int,
  Libres int)

insert into #Libres
select ur.id_area, (cantidad - sum(cant_ur)) libres
from leg_desglose_ur ur, Tabla_URetributivas tu
where ur.estado <> ''B''
	and ur.id_area = tu.id_area
group by ur.id_area, cantidad


        
INSERT INTO #Tempo          
SELECT  ur.Documento,           
 ur.Id_Area Id_Area_UR,           
 ta.Descripcion Area_UR,          
 isnull(cantidad,0) Cant_Area_UR,        
 0,          
 TADep.Descripcion  Secretaria,                  
 isnull(cant_ur,0),          
 case when ta.Descripcion = TADep.Descripcion then           
 ''0''          
 else           
 ''1''          
 end igual          
FROM dbo.leg_desglose_ur ur          
INNER JOIN dbo.Tabla_URetributivas tur          
 ON ur.id_area = tur.id_area          
LEFT join dbo.vw_desglose_area da                      
 on ur.documento = da.documento                                      
LEFT join dbo.tabla_areas TA                      
 on ur.id_area = ta.id                  
inner join dbo.Tabla_Areas TADep                
  ON TADep.id = dbo.Fx_Primer_Nivel_Dependencia_Area (da.Id_Area)           
WHERE estado <> ''B''          
ORDER BY ur.Secretaria, ur.documento          
          
      
UPDATE t      
set id_sec = ta.id      
from #tempo t      
LEFT join dbo.tabla_areas TA                      
 on t.secretaria = ta.descripcion      
     
 
INSERT INTO #listado          
Select  0 codigo_UR,  
 Id_Area_UR,      
 area_ur ,          
 0 Suma_Total_Utilizadas,          
 0 Suma_Misma_Utilizadas,          
 0 Suma_Otras_Utilizadas,           
 0 codigo_SEC,     
 id_sec,       
 secretaria,           
 isnull(sum(isnull(cant_ur,0)),0) cantidad_usadas,          
 0 Libres,           
 isnull(Cant_Area_UR,0) Cantidad_Total_Area,    
 getdate() fecha    
from #tempo          
where igual = 1          
group by id_sec, secretaria, Id_Area_UR, area_ur, Cant_Area_UR       
order by id_sec          
--group by Id_Area_UR, area_ur, id_sec, secretaria, Cant_Area_UR       
--order by Id_Area_UR          
          

INSERT INTO #listado          
Select  0 codigo_UR,  
 Id_Area_UR,      
 area_ur ,          
 0 Suma_Total_Utilizadas,          
 0 Suma_Misma_Utilizadas,          
 0 Suma_Otras_Utilizadas,           
 0 codigo_SEC,     
 id_sec,       
 secretaria,           
 isnull(sum(isnull(cant_ur,0)),0) cantidad_usadas,          
 0 Libres,           
 isnull(Cant_Area_UR,0) Cantidad_Total_Area,    
 getdate() fecha          
from #tempo      
where igual = 0      
 and secretaria not in (select Area_Prestada from #listado )      
group by id_sec, secretaria, Id_Area_UR, area_ur, Cant_Area_UR       
order by id_sec 
-- group by Id_Area_UR, area_ur, id_sec, secretaria, Cant_Area_UR         
-- order by Id_Area_UR          
      

INSERT INTO #Suma_UR_Prestadas          
Select secretaria, isnull(sum(isnull(cant_ur,0)),0)          
from #tempo          
where igual = 1          
group by secretaria          
order by secretaria    
          
        
INSERT INTO #Suma_UR_Misma          
Select secretaria, isnull(sum(isnull(cant_ur,0)),0)          
from #tempo          
where igual = 0          
group by secretaria          
order by secretaria          
    
    
    
UPDATE L          
SET Suma_Misma_Utilizadas = (select isnull(cantidad,0)          
			    FROM #Suma_UR_Misma p          
			    where l.area_prestada = p.area_ur)          
FROM #listado l          
          
          
UPDATE L          
SET Suma_Otras_Utilizadas = (select isnull(cantidad,0)          
			    FROM #Suma_UR_Prestadas p          
			    where l.area_prestada = p.area_ur)          
FROM #listado l          
          
          
UPDATE L          
SET Suma_Total_Utilizadas = isnull(Suma_Otras_Utilizadas,0) + isnull(Suma_Misma_Utilizadas,0)          
FROM #listado l          
          
          
UPDATE L          
SET libres = (select li.libres
		from #libres li
		where li.id_area in (select distinct Id_Area_Prestada from #listado)
			and l.Id_Area_Prestada = li.id_area)
from #listado l


--UPDATE L          
--SET libres = isnull(Cantidad_Total_Area,0) - isnull(Suma_Total_Utilizadas,0)          
-- FROM #listado l          
        
UPDATE #listado      
set  	Id_Area_UR = null,      
 	Area_UR=null,   
	Suma_Area_Prestada = null
from #listado      
where area_ur = area_prestada      
      
UPDATE L  
set Codigo_UR = LEFT(codigo,19)  
FROM #listado L  
 inner join dbo.Tabla_Areas_Estructura ta  
  on L.Id_Area_UR = ta.id_area  
   
  
UPDATE L  
set Codigo_sec = LEFT(codigo,19)  
FROM #listado L  
 inner join dbo.Tabla_Areas_Estructura ta  
  on L.id_Area_Prestada = ta.id_area 

Select   codigo_sec,   
 id_Area_Prestada,       
 Area_Prestada ,          
 Suma_Area_Prestada ,  
 codigo_UR,   
 Id_Area_UR,        
 Area_UR ,          
 Suma_Total_Utilizadas ,          
 Suma_Misma_Utilizadas ,          
 Suma_Otras_Utilizadas ,          
 Libres ,          
 Cantidad_Total_Area,    
 convert(char(10),getdate(),103) fecha         
from #listado        
--where Area_UR is not null       
order by codigo_SEC, codigo_UR         
      
        
-- drop table #tempo      
-- drop table #listado      
-- drop table #Suma_UR_Prestadas      
-- drop table #Suma_UR_misma      
-- drop table #libres






' 
END
GO
/****** Object:  Table [dbo].[MED_Atenciones_08022012]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_Atenciones_08022012]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[MED_Atenciones_08022012](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Nro_Documento] [int] NULL,
	[FechaAtencion] [smalldatetime] NOT NULL,
	[VolverEnDias] [smallint] NULL,
	[PresionDia] [smallint] NULL,
	[PresionHora] [varchar](5) NULL,
	[PresionDiastolica] [smallint] NULL,
	[PresionSistolica] [smallint] NULL,
	[IdDiagnostico] [smallint] NOT NULL,
	[Observaciones] [varchar](500) NULL,
	[IdLicencia] [int] NULL,
	[Baja] [bit] NULL,
	[ConsultorioExterno] [bit] NOT NULL,
	[IdUsuario] [smallint] NULL,
	[regresa] [int] NULL,
	[regreso] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[LEG_Documentacion_Legajo_Intimacion]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo_Intimacion]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Documentacion_Legajo_Intimacion](
	[Id_interna] [int] NOT NULL,
	[Foto] [bit] NOT NULL,
	[PresentoAptoMedico] [smallint] NOT NULL,
	[Decreto_894] [bit] NOT NULL,
	[FotocDNI] [bit] NOT NULL,
	[Cuadernillo] [bit] NOT NULL,
	[FotocObraSocial] [bit] NOT NULL,
	[Titulo] [smallint] NOT NULL,
	[CertifServAnt] [bit] NOT NULL,
	[AcreditEstadoCivil] [bit] NOT NULL,
	[CV] [bit] NOT NULL,
	[ActasNacimientoPresenta] [bit] NOT NULL,
	[ActasNacimientoCantidad] [smallint] NULL,
	[FotocDNIHijosPresenta] [bit] NOT NULL,
	[FotocDNIHijosCantidad] [smallint] NULL,
	[AntecedentesPenales] [bit] NOT NULL,
	[ComprobCUIT] [bit] NOT NULL,
	[OpcionJ] [bit] NOT NULL,
	[InfoSumaria] [smallint] NOT NULL,
	[Observaciones] [text] NULL,
	[DDJJCtr1] [bit] NOT NULL,
	[DDJJCtr2] [bit] NOT NULL,
	[DDJJCtr3] [bit] NOT NULL,
	[Id_Reclamo] [int] IDENTITY(1,1) NOT NULL,
	[FechaIntimacion] [smalldatetime] NULL,
	[Id_Usuario] [smallint] NULL,
	[FechaRecepcion] [smalldatetime] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
END
GO
/****** Object:  UserDefinedFunction [dbo].[FX_Antiguedad_Licencias_Sin_Goce]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[FX_Antiguedad_Licencias_Sin_Goce]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[FX_Antiguedad_Licencias_Sin_Goce] (@id_interna int)  
RETURNS varchar(10) AS  
BEGIN 
declare @antiguedad varchar(10)

Set @antiguedad = (SELECT dbo.fx_calcula_antiguedad (convert(datetime,''01/01/1900''), dateadd (d, sum(datediff(d,ls.desde,ls.hasta)),''01/01/1900'')) 
	FROM licencias_solicitadas LS
	INNER join dbo.tabla_conceptos_licencias TCL
		ON TCL.id_concepto = ls.concepto
	INNER join dbo.designaciones_fechas DF
		ON df.id_interna = ls.id_interna
	WHERE  	tcl.GeneraDerechoOrdinaria =0 AND
		ls.desde >= df.fecha_Min AND
		ls.id_interna = @id_interna and
		tcl.goce_haberes <> 1)

return @antiguedad



END
' 
END
GO
/****** Object:  Table [dbo].[CRED_PersonasRelevadasHistorica]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_PersonasRelevadasHistorica]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_PersonasRelevadasHistorica](
	[Fecha_ocurrencia] [datetime] NOT NULL,
	[Documento] [int] NOT NULL,
	[Apellido] [varchar](50) NOT NULL,
	[Nombre] [varchar](50) NOT NULL,
	[Lugar_de_trabajo] [varchar](8) NOT NULL,
	[Telefono] [varchar](26) NOT NULL,
	[Email_mds] [varchar](60) NOT NULL,
	[Email_personal] [varchar](60) NOT NULL,
	[Fecha_comunicacion] [smalldatetime] NULL,
	[IdBaja] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Ambitos_Antiguedad]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Ambitos_Antiguedad]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Ambitos_Antiguedad](
	[Id] [smallint] NOT NULL,
	[Descripcion] [varchar](25) NOT NULL,
	[Baja] [bit] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Funciones_Rangos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Funciones_Rangos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Funciones_Rangos](
	[Id] [int] NOT NULL,
	[Id_Funciones] [int] NULL,
	[Id_Rando] [int] NULL,
	[Monto_hasta] [smallint] NULL,
 CONSTRAINT [PK_Tabla_Funciones_Rangos] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Informe_UR]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Informe_UR]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[RPT_LEG_Informe_UR]  
  
as  
  
set nocount on  
  
create table #tempo  
(  Codigo char(19),  
 Id_Area int,  
 Area varchar(200),  
 Total_UR int,  
 UR_Ocupadas int,  
 Libre int,  
 fecha smalldatetime,  
 Sum_Total int,  
 Sum_Ocupada int,  
 Sum_Libre int  
)  
  
  
INSERT INTO #tempo  
SELECT  0,   
 tur.id_area,   
 ta.descripcion,   
 cantidad,   
 sum(cant_ur),   
 (cantidad -  sum(cant_ur)),  
 getdate(),  
 0,  
 0,  
 0  
FROM leg_desglose_ur tu  
  
INNER JOIN dbo.Tabla_Areas ta  
 ON ta.id = tu.id_area  
  
INNER JOIN dbo.Tabla_URetributivas tur  
 ON tu.id_area = tur.id_area  
  
WHERE tu.baja = 0

GROUP BY ta.descripcion, tur.Id_Area, cantidad  
  
  
UPDATE T  
set Codigo = LEFT(ta.codigo,19)      
FROM #tempo T      
inner join dbo.Tabla_Areas_Estructura ta      
 on T.id_Area = ta.id_area    
  
  
UPDATE T  
set sum_total = (select sum(Total_UR) from #tempo)  
FROM #tempo T      
  
UPDATE T  
set Sum_Ocupada = (select sum(UR_Ocupadas) from #tempo)  
FROM #tempo T      
  
UPDATE T  
set sum_libre = (select sum(Libre) from #tempo)  
FROM #tempo T      
  
  
select  Codigo ,  
 Area ,  
 Total_UR ,  
 UR_Ocupadas ,  
 Libre,  
 convert(char(10),getdate(),103) fecha,  
 Sum_Total ,  
 Sum_Ocupada ,  
 Sum_Libre  
from #tempo  
order by codigo  
  
  

' 
END
GO
/****** Object:  Table [dbo].[CRED_DomiciliosHistorica]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_DomiciliosHistorica]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_DomiciliosHistorica](
	[Fecha_ocurrencia] [datetime] NOT NULL,
	[id] [int] NOT NULL,
	[Documento] [int] NOT NULL,
	[Calle] [varchar](50) NOT NULL,
	[Numero] [varchar](6) NOT NULL,
	[Piso] [varchar](3) NOT NULL,
	[Depto] [varchar](255) NOT NULL,
	[Casa] [varchar](20) NOT NULL,
	[Manzana] [varchar](20) NOT NULL,
	[Torre] [varchar](20) NOT NULL,
	[Uf] [varchar](20) NOT NULL,
	[Codigo_postal] [varchar](12) NOT NULL,
	[Localidad] [varchar](60) NOT NULL,
	[Barrio] [varchar](50) NOT NULL,
	[IdLocalidad] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_DistritosMilitares]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_DistritosMilitares]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_DistritosMilitares](
	[Id] [smallint] NOT NULL,
	[Descripcion] [varchar](25) NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_DistritosMilitares] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Legajos_No_Firman]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Legajos_No_Firman]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Legajos_No_Firman](
	[id_interna] [int] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Goce_Sueldo_Licencia]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Goce_Sueldo_Licencia]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Goce_Sueldo_Licencia](
	[Id] [smallint] NOT NULL,
	[Descripcion] [nvarchar](50) NULL,
 CONSTRAINT [PK_Tabla_Goce_Sueldo_Licencia] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Nivel_Idioma]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Nivel_Idioma]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Nivel_Idioma](
	[Id] [smallint] NOT NULL,
	[Descripcion] [nvarchar](50) NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Nivel_Idioma] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  UserDefinedFunction [dbo].[fx_get_vacaciones_por_años_de_antiguedad]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[fx_get_vacaciones_por_años_de_antiguedad]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: ''02/12/2008''
-- Description:	Devuelve la cantidad de dias de vacaciones correspondientes segun una cantidad de años
-- =============================================
CREATE FUNCTION [dbo].[fx_get_vacaciones_por_años_de_antiguedad]
(
	@fecha_min smalldatetime,
	@antiguedad_anterior char(8),
	@fecha_calculo smalldatetime
)
RETURNS int
AS
BEGIN
	return
		(select top 1 dias_correspondientes 
		from dbo.tabla_dias_licencia_ordinaria 
		where dbo.fx_cumplio_antiguedad (años_antiguedad, @fecha_min, @antiguedad_anterior, @fecha_calculo) = 1 
		order by años_antiguedad desc)
END
' 
END
GO
/****** Object:  Table [dbo].[Tabla_Motivos_Baja]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Motivos_Baja]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Motivos_Baja](
	[Id] [smallint] NOT NULL,
	[Descripcion] [nvarchar](50) NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Motivos_Baja] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_UPD_Seleccion_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_UPD_Seleccion_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CTR_UPD_Seleccion_Contratos]    
 @Memo int,                                      
 @renovar char(1),  
 @usuario int
as    
    

create table #Cod_Area                        
(id_area int)                    

insert into #cod_area                        
select Id_Area                 
from RH_USUARIOS_AREAS                
where Id_Usuario = @usuario   


UPDATE dbo.CTR_Seleccion_Contratos                       
set    Memo = @Memo,    
 fecha = getdate(),  
 usuario = @usuario    
where renovar = @renovar  
 	and memo = 0
	and id_area in (select id_area from #Cod_Area)

' 
END
GO
/****** Object:  Table [dbo].[PLA_Formulario_DDJJ]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_Formulario_DDJJ]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[PLA_Formulario_DDJJ](
	[Id] [int] NULL,
	[Legajo] [int] NULL,
	[Mes] [smallint] NULL,
	[Año] [smallint] NULL,
	[Area_Actual] [int] NULL,
	[Area_Certifica] [int] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[SEG_SEGUROS_ACTIVOS]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[SEG_SEGUROS_ACTIVOS]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[SEG_SEGUROS_ACTIVOS](
	[Id_Interna] [int] NOT NULL,
	[Tipo_Seguro] [int] NOT NULL,
 CONSTRAINT [PK_SEG_SEGUROS_ACTIVOS] PRIMARY KEY CLUSTERED 
(
	[Id_Interna] ASC,
	[Tipo_Seguro] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[ctr_contratos_02_05_2008]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ctr_contratos_02_05_2008]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ctr_contratos_02_05_2008](
	[Id_Contrato] [int] NOT NULL,
	[Id_Domicilio] [int] NOT NULL,
	[Nro_Documento] [int] NOT NULL,
	[Tipo_Contrato] [smallint] NOT NULL,
	[Nro_Contrato] [char](11) NOT NULL,
	[Desde] [smalldatetime] NOT NULL,
	[Hasta] [smalldatetime] NOT NULL,
	[Nivel] [smallint] NULL,
	[Grado] [smallint] NULL,
	[Funcion] [smallint] NULL,
	[Rango] [smallint] NULL,
	[Monto] [money] NULL,
	[Id_Area] [int] NOT NULL,
	[Firmado] [bit] NOT NULL,
	[Impreso] [bit] NOT NULL,
	[Fecha_Impresion] [smalldatetime] NULL,
	[Fecha_Dia_Impresion] [smalldatetime] NULL,
	[Exp_Nro] [varchar](30) NULL,
	[Aprobado] [bit] NOT NULL,
	[Acto_Tipo] [smallint] NULL,
	[Acto_Nro] [varchar](20) NULL,
	[Acto_Fecha] [smalldatetime] NULL,
	[Acto_Firmante] [smallint] NULL,
	[Contrato_Firmante] [smallint] NULL,
	[Baja] [bit] NOT NULL,
	[Excepcion] [bit] NOT NULL,
	[Enmienda] [bit] NOT NULL,
	[Salvado] [bit] NOT NULL,
	[Fecha_Salvado] [smalldatetime] NULL,
	[Usuario_Salvado] [smallint] NULL,
	[Observacion] [varchar](200) NULL,
	[Estado] [char](1) NULL,
	[Conserva_Area] [bit] NULL,
	[Usuario] [smallint] NULL,
	[Reservado] [bit] NULL,
	[Alta_Prov_Leg] [bit] NULL,
	[Usua_Alta_Prov_Leg] [smallint] NULL,
	[Fecha_Alta_Prov_Leg] [smalldatetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[_TMP_DIAS]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[_TMP_DIAS]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[_TMP_DIAS](
	[id] [int] IDENTITY(135300,1) NOT NULL,
	[id_interna] [int] NOT NULL,
	[dias_autorizados] [int] NOT NULL,
	[id_concepto_licencia] [int] NOT NULL,
	[periodo] [int] NOT NULL,
	[dias_tomados] [int] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Tarea_Desempeñada]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Tarea_Desempeñada]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Tarea_Desempeñada](
	[Id] [int] NOT NULL,
	[Descripcion] [varchar](100) NOT NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_Funciones] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[_TMP_DIAS2]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[_TMP_DIAS2]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[_TMP_DIAS2](
	[id] [int] IDENTITY(135300,1) NOT NULL,
	[id_interna] [int] NOT NULL,
	[dias_autorizados] [int] NOT NULL,
	[id_concepto_licencia] [int] NOT NULL,
	[periodo] [int] NOT NULL,
	[dias_tomados] [int] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[PLA_Recibos_Migrados]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_Recibos_Migrados]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[PLA_Recibos_Migrados](
	[Archivo] [varchar](50) NULL,
	[Cant_Registros] [smallint] NULL,
	[Fecha_Carga] [datetime] NULL,
	[Usuario] [smallint] NULL,
	[liquidacion] [int] NULL,
	[tipo_liquidacion] [int] NULL,
	[mes] [smallint] NULL,
	[año] [smallint] NULL,
	[descripcion] [varchar](255) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Para_Generar_Memo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Para_Generar_Memo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Para_Generar_Memo]   
 @usuario int    
as    
    
set nocount on  
  
create table #tempo    
(    
pendiente int,    
renovar int,    
no_renovar int  
)    
    
create table #Cod_Area                            
(id_area int)                        
                          
 insert into #cod_area                            
 select Id_Area                     
 from RH_USUARIOS_AREAS                    
 where Id_Usuario = @usuario                    
    
    
insert into #tempo    
 select 0, count(*), 0  
 from dbo.ctr_seleccion_contratos    
 where renovar=''R''    
  and id_area in (select id_area from #cod_area)    
  and memo = 0
  
UPDATE #tempo    
SET no_renovar = (select count(*)  
   from dbo.ctr_seleccion_contratos    
  where renovar=''N''    
  and id_area in (select id_area from #cod_area)
  and memo = 0)  
  

UPDATE #tempo    
SET pendiente = (select count(*)                                    
  from dbo.ctr_contratos c                                        
  inner join dbo.vw_desglose_area da                                        
   on  da.documento = c.nro_documento                                       
  where  c.baja=0                   
   and c.nro_contrato = (select max(nro_contrato) from dbo.ctr_contratos c2 where c2.nro_documento = c.nro_documento and exp_nro is not null)                                      
   and da.id_area in (select id_area from #cod_area)  
   and id_contrato not in (select id_contrato from dbo.ctr_seleccion_contratos))  
  
  
select  pendiente,   
 renovar ,  
 no_renovar   
from #tempo  

' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Calcula_Antiguedad]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Calcula_Antiguedad]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE    FUNCTION [dbo].[Fx_Calcula_Antiguedad] (@F1 datetime ,@F2 datetime)  
RETURNS  varchar(10)

BEGIN 


declare @Ant varchar(10)
set @Ant ='' ''
declare @d1 [int]
declare @d2 [int]
declare @m1 [int]
declare @m2 [int]

declare @dia [int]

declare @dia1 [int]
declare @dia2 [int]

declare @mes [int]
declare @año  [int]





set @m1 = month(@f1)
set @m2 = month(@f2)
set @d1 = day(@f1)
set @d2 = day(@f2)

	set @año =  year (@f2) - year(@f1)

	if @m1 = 2 begin 
		set @dia1 = 28
	end
	if @m1 = 1 begin 
		set @dia1 = 31
	end
	if @m1 = 3 begin 
		set @dia1 = 31
	end
	if @m1 = 5 begin 
		set @dia1 = 31
	end
	if @m1 = 7 begin 
		set @dia1 = 31
	end
	if @m1 = 8 begin 
		set @dia1 = 31
	end
	if @m1 = 10 begin 
		set @dia1 = 31
	end
	if @m1 = 12 begin 
		set @dia1 = 31
	end
	if @m1 = 4 begin 
		set @dia1 = 30
	end
	if @m1 = 6 begin 
		set @dia1 = 30
	end
	if @m1 = 9 begin 
		set @dia1 = 30
	end
	if @m1 = 11 begin 
		set @dia1 = 30
	end


	if @m1 <= @m2  begin
		set @mes = @m2 - @m1
	end
	if  @m1 > @m2  begin
		set @año = @año -1
		set @mes = (12 - @m1) + @m2
	end 


	if @d1 <= @d2 begin
		set @dia = (@d2-@d1) + 1 
	end
	if @d1 > @d2 begin
		if @mes = 0 begin
			set @mes = 12 --@mes -1
			set @año = @año - 1
		end
		if @mes <> 0 begin
			set @mes = @mes -1
		end
		set @dia =(@dia1 - @d1) + @d2 + 1
	end


-- SI MES 2  = 28 DIAS -> SUMAR mes

-- SI MES 2 =  28 -s SUMAR 3 DIAS (SI ES BISIESTO --> 2 DIAS)

	If @m2 = 2 begin
		If @dia >= 28 begin
			set @mes = @mes +1
			set @dia =0
		End 
	End 

	

	if @dia >= 30 begin
		set @mes = @mes +1
		set @dia =0
	end

	if @mes = 12 begin
		set  @mes =0
		set @año = @año +1
	end	

	 set @Ant = ( select case when @año < 10 then
			   ''0'' 
			else
			''''
		      end 
		     +  cast(@año as varchar) +''-'' + 
		     case when @mes < 10 then
			 ''0''
			else ''''
		     end
			+ cast(@mes  as varchar) +''-'' + 
		      case when @dia < 10 then
				''0''
			else ''''
			end +
			cast(@dia as varchar) )

	if @f2 < @f1 begin
		set @ant = ''00-00-00''
	end
	RETURN isnull(@ant,''00-00-00'')
--	return @ant



END











' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_GET_Carga_Recibo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_GET_Carga_Recibo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'





CREATE procedure [dbo].[PLA_GET_Carga_Recibo]
	@id_interna int=null,
	@mes smallint=null,
	@año smallint=null
as
SELECT r.id_interna
from dbo.PLA_Recibos r
where	r.Id_Interna = @id_interna and
	r.mes = @mes and
	r.año = @año



' 
END
GO
/****** Object:  Table [dbo].[LEG_Desglose_Planta_20120210]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_Planta_20120210]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Desglose_Planta_20120210](
	[Id] [int] NOT NULL,
	[Id_interna] [int] NOT NULL,
	[Documento] [int] NOT NULL,
	[Id_Planta] [smallint] NOT NULL,
	[Desig_Planta] [tinyint] NULL,
	[Desde] [datetime] NOT NULL,
	[Jurisdiccion] [varchar](25) NULL,
	[Organismo] [varchar](25) NULL,
	[Folio] [char](10) NULL,
	[Acto_Tipo] [smallint] NULL,
	[Acto_Nro] [varchar](10) NULL,
	[Acto_Fecha] [datetime] NULL,
	[Usuario] [smallint] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Saldo_Factura_Modif]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Saldo_Factura_Modif]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[CTR_GET_Saldo_Factura_Modif]
 @doc int,
 @nro_Fact char(13)

AS
set nocount on
create table #Saldos -- CARGA TODOS LOS CONTRATOS Y SU MONTO MENSUAL
	(id int identity(1,1),
	desde datetime,	
	hasta datetime, 
	monto money,
	id_contrato int,
	nro_contrato char(11))

insert into #saldos 
SELECT desde, 
	case when cb.fecha_baja is null then
		case when cc.hasta > getdate() then
			cast(''30/'' +  cast(month(getdate()) as varchar)  +''/''+ cast(year(getdate())as varchar)  as datetime)
		else
			cc.hasta
		end
	else
		cb.fecha_baja
	end,
	cc.monto,
	cc.id_contrato,
	cc.nro_contrato 
FROM dbo.ctr_contratos CC
LEFT JOIN dbo.ctr_contratos_bajas  CB
	on cb.id_contrato = cc.id_contrato
where aprobado = 1 And
cc.nro_documento = @doc 
and year(cc.desde) > 2005


create table #Resultados -- GUARDA CtaCte
	(mes int,
	año int,
	montop money,	
	id_contrato int,
	nro_contrato char(11))

declare @Fi datetime
declare @Ff datetime
declare @id int
set @id = 1
Set @Fi  = (select desde from #saldos where id = @Id)
Set @Ff  = (select hasta from #saldos where id = @Id)

while @id <= (select count(desde) from #Saldos) BEGIN -- CANTIDAD DE CONTRATOS
	
	WHILE 	@fi <= @ff BEGIN --MESES DE CADA CONTRATO
		INSERT INTO #resultados
		SELECT 	month(@fi), 
			year(@fi),
			case when day(desde) > 1 and (month(desde) = month(@fi)) then		
				(monto  / 30) * (30 - day(desde)+1)
			else
				case when day(hasta) < 30 and ((month(@fi) = month(@ff) and year(@fi) = year(@ff))) then		
					(monto  / 30) * (day(hasta))
				else
					monto
				end
			end,
			id_contrato,
			nro_contrato
		FROM #Saldos where id = @Id
		Set @fi = dateadd(month,1,@fi)
	END	
	set @Id = @Id + 1
	Set @Fi  = (select desde from #saldos where id = @Id)
	Set @Ff  = (select hasta from #saldos where id = @Id)

END	


create table #Facturas -- GUARDA FACTURAS
	(mes_factura int,
	año_factura int,
	id_cont int,
	monto_factura money)

insert into #facturas
select 	fd.mes_factura,
	fd.año_factura,
--	fd.id_contrato,
	f.documento,
	sum(fd.monto_factura)Suma_monto_Factura
from ctr_facturas f
inner join ctr_facturas_detalle fd
	on f.id_factura=fd.id_factura 
where f.documento=@doc and f.anulada=0 and nro_factura=@nro_fact
group by fd.mes_factura, fd.año_factura, f.documento --, fd.id_contrato


create table #Monto_Facturas -- GUARDA MONTO FACTURAS ORIG.
	(mes_factura int,
	año_factura int,
	Id_cont int,
	monto_factura_total_imputado money)

insert into #Monto_Facturas
select 	fd.mes_factura,
	fd.año_factura,
--	fd.id_contrato,
	f.documento,	
	sum(fd.monto_factura)
from ctr_facturas f
inner join ctr_facturas_detalle fd
	on f.id_factura=fd.id_factura 
where f.documento=@doc and f.anulada=0 
group by fd.mes_factura,fd.año_factura, f.documento  --,fd.id_contrato



select 	mes Mes_Cont, 
	año Año_Cont, 
	round(sum(montop),0) Monto_Cont,
	round(sum(isnull(monto_factura,0)),0)Monto_Factura, 
	round(monto_factura_total_imputado - sum(isnull(monto_factura,0)),0) monto_otras_facturas,
	round(sum(montop - isnull(monto_factura,0))- (monto_factura_total_imputado - sum(isnull(monto_factura,0))),0)  saldo_mes,
	r.id_contrato,
	r.nro_contrato,
	ttr.descripcion acto_tipo,
	cc.acto_nro	

FROM  #resultados r 
inner join ctr_contratos CC
	on CC.id_contrato = r.id_contrato
left join #facturas f
	on r.mes = f.mes_factura and r.año = f.año_factura and  cc.nro_documento = f.id_cont --r.id_contrato=f.id_cont
left join #monto_facturas mf
	on r.mes = mf.mes_factura and r.año = mf.año_factura and cc.nro_documento = mf.id_cont --r.id_contrato=mf.id_cont
left join dbo.Tabla_Tipos_Resoluciones TTR
	on ttr.id=cc.acto_tipo

--where montop - isnull(monto_factura,0)<>0
group by r.mes,
	r.año,
	monto_factura_total_imputado,
	r.id_contrato,
	r.nro_contrato,
	ttr.descripcion,
	cc.acto_nro	


drop table #Saldos
drop table #resultados
drop table #facturas
drop table #monto_facturas



' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[fx_dame_antiguedad_anterior_correspondiente]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[fx_dame_antiguedad_anterior_correspondiente]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: ''03/12/2008''
-- Description:	Devuelve la antiguedad que corresponda para el calculo de vacaciones segun cuando entro
-- =============================================
CREATE FUNCTION [dbo].[fx_dame_antiguedad_anterior_correspondiente]
(
	@fecha_min smalldatetime,
	@fecha_limite smalldatetime,
	@antiguedad_total char(8),
	@antiguedad_estado char(8)
)
RETURNS char(8)
AS
BEGIN
	declare @ant_correspondiente char(8)
	if @fecha_min < @fecha_limite 
	begin
		set @ant_correspondiente = @antiguedad_total
	end
	else
	begin
		set @ant_correspondiente = @antiguedad_estado
	end
	return @ant_correspondiente
END
' 
END
GO
/****** Object:  Table [dbo].[Autorizaciones_Licencias_temp]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Autorizaciones_Licencias_temp]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Autorizaciones_Licencias_temp](
	[Id_Interna] [int] NOT NULL,
	[Dias_Autorizados] [smallint] NOT NULL,
	[Id_Concepto_Licencia] [smallint] NOT NULL,
	[Periodo] [smallint] NOT NULL,
	[Id] [int] IDENTITY(140740,1) NOT NULL,
	[Dias_Tomados] [smallint] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Tipo_Expedientes]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Tipo_Expedientes]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Tipo_Expedientes](
	[Id] [int] NULL,
	[Descripcion] [varchar](10) NULL,
	[Baja] [bit] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[MED_ADD_Diagnosticos_Licencias]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_ADD_Diagnosticos_Licencias]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create   PROCEDURE [dbo].[MED_ADD_Diagnosticos_Licencias]         
@Id_Licencia int,       
@Regreso bit,       
@Diagnostico smallint = null,        
@Atencion int =null   
AS        
        
DECLARE @existe int        
SET @existe = (SELECT id FROM dbo.MED_DIAGNOSTICOS_LICENCIAS WHERE id_licencia = @id_licencia)        
        
IF NOT @existe IS NULL BEGIN        
   UPDATE dbo.MED_DIAGNOSTICOS_LICENCIAS       
   SET regreso = @regreso,        
      id_diagnostico = @diagnostico,        
      id_atencion=@atencion  
  WHERE id_licencia = @id_licencia        
END       
ELSE       
BEGIN        
   DECLARE @Max_Id int        
   SET @Max_Id = (SELECT MAX(ID) + 1 FROM dbo.MED_DIAGNOSTICOS_LICENCIAS)        
    if @Max_Id is null begin        
      set @Max_Id=1        
     end        
      
   INSERT INTO dbo.MED_DIAGNOSTICOS_LICENCIAS (id, id_licencia, id_diagnostico, regreso, id_atencion)        
   VALUES (@Max_Id, @id_licencia, @diagnostico, @regreso, @atencion)        
END        



' 
END
GO
/****** Object:  Table [dbo].[Tabla_Dias_Licencia_Ordinaria]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Dias_Licencia_Ordinaria]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Dias_Licencia_Ordinaria](
	[Años_Antiguedad] [smallint] NOT NULL,
	[Dias_Correspondientes] [smallint] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Cargos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Cargos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Cargos](
	[Id] [smallint] NOT NULL,
	[Descripcion] [varchar](30) NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_tabla_Cargos] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CTR_Contratos_Tmp_Impresion]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Contratos_Tmp_Impresion]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CTR_Contratos_Tmp_Impresion](
	[Id_Contrato] [int] NOT NULL,
	[Id_Domicilio] [int] NULL,
	[Nro_Documento] [int] NOT NULL,
	[Tipo_Contrato] [smallint] NOT NULL,
	[Nro_Contrato] [char](11) NOT NULL,
	[Desde] [smalldatetime] NULL,
	[Hasta] [smalldatetime] NULL,
	[Nivel] [smallint] NULL,
	[Grado] [smallint] NULL,
	[Funcion] [smallint] NULL,
	[Rango] [smallint] NULL,
	[Monto] [money] NULL,
	[Id_Area] [int] NULL,
	[Firmado] [bit] NULL,
	[Impreso] [bit] NULL,
	[Fecha_Impresion] [smalldatetime] NULL,
	[Fecha_Dia_Impresion] [smalldatetime] NULL,
	[Exp_Nro] [char](17) NULL,
	[Aprobado] [bit] NOT NULL,
	[Acto_Tipo] [smallint] NULL,
	[Acto_Nro] [varchar](20) NULL,
	[Acto_Fecha] [smalldatetime] NULL,
	[Acto_Firmante] [smallint] NULL,
	[Contrato_Firmante] [smallint] NULL,
	[Baja] [bit] NULL,
	[Excepcion] [bit] NULL,
	[Enmienda] [bit] NULL,
	[Salvado] [bit] NULL,
	[Fecha_Salvado] [smalldatetime] NULL,
	[Usuario_Salvado] [smallint] NULL,
	[Observacion] [varchar](200) NULL,
	[Estado] [char](1) NULL,
	[Conserva_Area] [bit] NULL,
	[Usuario] [smallint] NULL,
	[Reservado] [bit] NOT NULL,
	[Alta_Prov_Leg] [bit] NULL,
	[Usua_Alta_Prov_Leg] [smallint] NULL,
	[Fecha_Alta_Prov_Leg] [smalldatetime] NULL,
	[OrdenImpresion] [smallint] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_GET_IdArea_Fecha]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_GET_IdArea_Fecha]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_GET_IdArea_Fecha]  (@id_interna int, @fecha datetime)  
RETURNS   Int  AS  
BEGIN 

Return (	SELECT TOP 1	id_area 
	FROM dbo.leg_desglose_area
	
	WHERE Id_interna = @Id_interna and  desde <=  @fecha
	Order by desde desc)


END



' 
END
GO
/****** Object:  StoredProcedure [dbo].[LIQ_Get_Listado_Bco]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_Get_Listado_Bco]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE    PROCEDURE [dbo].[LIQ_Get_Listado_Bco]

AS

SELECT nc.[Id], 
	nc.[Legajo], 
	nc.[Id_Interna], 
	nc.[CIA], 
	nc.[Tipo_Cta], 
	nc.[Nro_Cta], 
	nc.[Sueldo], 
	nc.[Id_Banco],
	nc.nro_cta,
	dp.apellido, 
	dp.nombre,
	dp.cuil_nro
	
from liq_nro_cuenta NC

inner join datos_personales dp
	on dp.nro_documento=nc.legajo

where nc.exportado=0 and (nro_cta is null or nro_cta='''')



' 
END
GO
/****** Object:  Table [dbo].[Tabla_Designacion]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Designacion]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Designacion](
	[id] [int] NULL,
	[Descripcion] [varchar](50) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Embargos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Embargos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Embargos](
	[Exped_Nro] [varchar](20) NOT NULL,
	[Exped_Fecha] [smalldatetime] NOT NULL,
	[Fuero] [varchar](50) NOT NULL,
	[Juzgado] [varchar](50) NOT NULL,
	[Secretaria] [varchar](50) NOT NULL,
	[Autos] [varchar](50) NOT NULL,
	[Monto] [int] NOT NULL,
	[Trabado_Fecha] [smalldatetime] NOT NULL,
	[Levantado_Fecha] [smalldatetime] NULL,
	[Folio] [char](10) NOT NULL,
	[Id_Interna] [int] NOT NULL,
	[Legajo] [int] NOT NULL,
	[Id_Embargo] [int] NOT NULL,
	[DatoDeBaja] [bit] NULL,
	[datonoimprime] [bit] NULL,
 CONSTRAINT [PK_Embargos] PRIMARY KEY NONCLUSTERED 
(
	[Legajo] ASC,
	[Id_Embargo] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_ObservCardex]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_ObservCardex]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE  PROCEDURE [dbo].[ASIS_GET_ObservCardex] 
@Nro_Documento int,
@periodo int
AS
SELECT * From dbo.Asis_Observaciones_Cardex 
where Nro_Documento = @Nro_Documento and Periodo = @periodo
' 
END
GO
/****** Object:  Table [dbo].[Historico_CTR_Contratos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Historico_CTR_Contratos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Historico_CTR_Contratos](
	[Id_Contrato] [int] NOT NULL,
	[Id_Domicilio] [int] NULL,
	[Nro_Documento] [int] NOT NULL,
	[Tipo_Contrato] [smallint] NOT NULL,
	[Nro_Contrato] [char](11) NOT NULL,
	[Desde] [smalldatetime] NULL,
	[Hasta] [smalldatetime] NULL,
	[Nivel] [smallint] NULL,
	[Grado] [smallint] NULL,
	[Funcion] [smallint] NULL,
	[Rango] [smallint] NULL,
	[Monto] [money] NULL,
	[Id_Area] [int] NULL,
	[Firmado] [bit] NULL,
	[Impreso] [bit] NULL,
	[Fecha_Impresion] [smalldatetime] NULL,
	[Fecha_Dia_Impresion] [smalldatetime] NULL,
	[Exp_Nro] [varchar](30) NULL,
	[Aprobado] [bit] NOT NULL,
	[Acto_Tipo] [smallint] NULL,
	[Acto_Nro] [varchar](20) NULL,
	[Acto_Fecha] [smalldatetime] NULL,
	[Acto_Firmante] [smallint] NULL,
	[Contrato_Firmante] [smallint] NULL,
	[Baja] [bit] NULL,
	[Excepcion] [bit] NULL,
	[Enmienda] [bit] NULL,
	[Salvado] [bit] NULL,
	[Fecha_Salvado] [smalldatetime] NULL,
	[Usuario_Salvado] [smallint] NULL,
	[Observacion] [varchar](200) NULL,
	[Estado] [char](1) NULL,
	[Conserva_Area] [bit] NULL,
	[Usuario] [smallint] NULL,
	[Reservado] [bit] NULL,
	[Alta_Prov_Leg] [bit] NULL,
	[Usua_Alta_Prov_Leg] [smallint] NULL,
	[Fecha_Alta_Prov_Leg] [smalldatetime] NULL,
	[Operacion] [char](1) NULL,
	[Fecha_Operacion] [smalldatetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Historico_Datos_Personales]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Historico_Datos_Personales]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Historico_Datos_Personales](
	[Id_Interna] [int] NOT NULL,
	[Apellido] [varchar](40) NOT NULL,
	[Nombre] [varchar](60) NOT NULL,
	[Tipo_Planta] [int] NULL,
	[Sexo] [smallint] NOT NULL,
	[Fecha_Nacimiento] [smalldatetime] NULL,
	[Lugar_Nacimiento] [varchar](50) NULL,
	[Nacionalidad] [smallint] NOT NULL,
	[Fecha_Ingreso_Pais] [smalldatetime] NULL,
	[Carta_Ciudadania] [varchar](50) NULL,
	[Juzgado] [varchar](100) NULL,
	[Secretario] [varchar](100) NULL,
	[Fecha_Juzgado] [smalldatetime] NULL,
	[Cuil_Nro] [varchar](15) NULL,
	[Tipo_Documento] [int] NOT NULL,
	[Nro_Documento] [int] NOT NULL,
	[Distrito_Militar] [smallint] NULL,
	[Clase] [int] NULL,
	[Cedula_Identidad] [char](11) NULL,
	[Expedida_por] [varchar](50) NULL,
	[Regimen_Jubilatorio] [smallint] NULL,
	[Denominacion] [smallint] NULL,
	[Estado_Civil] [smallint] NULL,
	[Fecha_Matrimonio] [smalldatetime] NULL,
	[Fecha_Matrimonio_2da] [smalldatetime] NULL,
	[Grupo_Sanguineo] [varchar](2) NULL,
	[Factor_Sanguineo] [varchar](20) NULL,
	[Credencial] [varchar](20) NULL,
	[Obra_Social] [smallint] NULL,
	[Nro_Afiliado] [varchar](50) NULL,
	[Usuario] [smallint] NULL,
	[VisibleLegajos] [bit] NULL,
	[VisibleContratos] [bit] NULL,
	[BajaLegajos] [bit] NULL,
	[BajaContratos] [bit] NULL,
	[Operacion] [char](1) NULL,
	[Fecha_Operacion] [datetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Documentacion_Legajo]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Documentacion_Legajo]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Documentacion_Legajo](
	[Id_interna] [int] NOT NULL,
	[Foto] [bit] NOT NULL,
	[Apto] [bit] NOT NULL,
	[DDJJ] [bit] NOT NULL,
	[Decreto] [bit] NOT NULL,
	[Doc] [bit] NOT NULL,
	[Titulo] [bit] NOT NULL,
	[Serv] [bit] NOT NULL,
	[Matrimonio] [bit] NOT NULL,
	[Hjios] [bit] NOT NULL,
	[DNI_Hijos] [bit] NOT NULL,
	[OpcionJ] [bit] NOT NULL,
	[CUIT] [bit] NOT NULL,
	[ObraSocial] [bit] NOT NULL,
	[Cuaderno] [bit] NOT NULL,
	[Resolucion] [bit] NOT NULL,
	[Contrato] [bit] NOT NULL,
	[Sumaria] [bit] NOT NULL,
	[Penales] [bit] NOT NULL,
	[CV] [bit] NOT NULL,
	[Observaciones] [ntext] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[autorizaciones_licencias_bk_10122008]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[autorizaciones_licencias_bk_10122008]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[autorizaciones_licencias_bk_10122008](
	[Id_Interna] [int] NOT NULL,
	[Dias_Autorizados] [smallint] NOT NULL,
	[Id_Concepto_Licencia] [smallint] NOT NULL,
	[Periodo] [smallint] NOT NULL,
	[Id] [int] NOT NULL,
	[Dias_Tomados] [smallint] NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[WEB_Password_UPD]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_Password_UPD]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



create procedure [dbo].[WEB_Password_UPD]
	@idUsuario smallint,
	@password varchar(150)
AS
UPDATE dbo.WEB_Passwords
SET password = @password
WHERE idUsuario = @idUsuario
' 
END
GO
/****** Object:  View [dbo].[VW_Tabla_Desglose_Designacion]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/****** Object:  Table [dbo].[CDatos_Personales]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CDatos_Personales]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CDatos_Personales](
	[Legajo] [int] NOT NULL,
	[Apellido] [varchar](20) NULL,
	[Nombre] [varchar](25) NULL,
	[Tipo_doc] [smallint] NULL,
	[Estado_Civil] [smallint] NULL,
	[CUIT] [varchar](13) NULL,
	[Telefono] [varchar](15) NULL,
	[Mail] [varchar](100) NULL,
	[Opc_Jub] [smallint] NULL,
	[AFJP] [smallint] NULL,
	[Baja] [bit] NOT NULL,
	[FechaBaja] [smalldatetime] NULL,
	[Send_Legajos] [bit] NOT NULL,
	[Fecha_Nac] [smalldatetime] NULL,
	[Sexo] [smallint] NOT NULL,
	[Nacionalidad] [smallint] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Estudios_Especilidades]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Estudios_Especilidades]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Estudios_Especilidades](
	[Tipo_maqui] [char](20) NULL,
	[P_Min_Maq] [smallint] NULL,
	[Idiomas] [char](20) NULL,
	[P_Min_Idi] [smallint] NULL,
	[Doc_Tit] [int] NOT NULL,
	[Id_interna] [int] NOT NULL,
	[Folio] [char](10) NULL,
	[id_estudio] [int] NULL,
	[DatoDeBaja] [bit] NULL,
	[DatoNoImprime] [bit] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Max_NroContrato]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Max_NroContrato]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_GET_Max_NroContrato]
	@doc int
AS
SELECT  max(nro_contrato) nro_contrato
FROM 	dbo.ctr_contratos
WHERE 	nro_documento = @doc

' 
END
GO
/****** Object:  Table [dbo].[Tabla_Rangos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Rangos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Rangos](
	[Id] [int] NOT NULL,
	[Descripcion] [varchar](50) NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Rangos] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[ESTR_UPD_Pase_Dependencia]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ESTR_UPD_Pase_Dependencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[ESTR_UPD_Pase_Dependencia]
	@AreaOriginal char(24),
	@AreaDestino char(24)

AS

	UPDATE dbo.Tabla_Areas_Estructura
	SET Codigo = @AreaDestino
	WHERE Codigo = @AreaOriginal


' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_GET_IdPlanta_Fecha]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_GET_IdPlanta_Fecha]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_GET_IdPlanta_Fecha]  (@id_interna int, @fecha datetime)  
RETURNS   int  AS  
BEGIN 

Return (	SELECT TOP 1	id_planta
	FROM dbo.leg_desglose_Planta 
	WHERE Id_interna = @Id_interna and  desde <=  @fecha
	Order by desde desc)


END



' 
END
GO
/****** Object:  Table [dbo].[Otros_Datos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Otros_Datos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Otros_Datos](
	[Jurisdiccion] [varchar](50) NULL,
	[Organismo] [varchar](50) NULL,
	[Fecha] [datetime] NULL,
	[Detalle] [varchar](250) NULL,
	[Id_Interna] [int] NOT NULL,
	[Doc_Titular] [int] NOT NULL,
	[Nro_Orden] [int] NULL,
	[Folio] [char](10) NULL,
	[Motivo] [varchar](20) NULL,
	[DatoDeBaja] [bit] NULL,
	[DatoNoImprime] [bit] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[PLA_Pases_Solicitados_BACKUP20090714]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_Pases_Solicitados_BACKUP20090714]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[PLA_Pases_Solicitados_BACKUP20090714](
	[id] [int] NOT NULL,
	[id_interna] [int] NOT NULL,
	[Area_Actual] [int] NOT NULL,
	[Area_Nueva] [int] NOT NULL,
	[Fecha_Solicitud] [datetime] NOT NULL,
	[Estado] [smallint] NOT NULL,
	[Solicito] [smallint] NOT NULL,
	[Reviso] [smallint] NULL,
	[Fecha_Pase] [datetime] NOT NULL,
	[Motivo_Rechazo] [varchar](200) NULL,
	[RechazoImpreso] [bit] NOT NULL,
	[Ultima_Modificacion] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Certificados_Escolaridad]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Certificados_Escolaridad]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Certificados_Escolaridad](
	[id_interna] [int] NULL,
	[id_fam] [smallint] NULL,
	[Tipo_Cert] [char](1) NULL,
	[Fecha] [smalldatetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Saldo_Factura]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Saldo_Factura]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[CTR_GET_Saldo_Factura]
@doc int
AS

set nocount on
-- CARGA TODOS LOS CONTRATOS Y SU MONTO MENSUAL
create table #Saldos 
	(id int identity(1,1),
	desde datetime,	
	hasta datetime, 
	monto money,
	id_contrato int,
	nro_contrato char(11))

insert into #saldos 
SELECT desde, 
	case when cb.fecha_baja is null then
		case when cc.hasta > getdate() then
			cast(''30/'' +  cast(month(getdate()) as varchar)  +''/''+ cast(year(getdate())as varchar)  as datetime)
		else
			cc.hasta
		end
	else
		cb.fecha_baja
	end,
	cc.monto,
	cc.id_contrato,
	cc.nro_contrato
FROM dbo.ctr_contratos CC
LEFT JOIN dbo.ctr_contratos_bajas  CB
	on cb.id_contrato = cc.id_contrato

where 
aprobado = 1 
AND cc.nro_documento = @doc 
AND year(cc.desde) > 2005


-- GUARDA CtaCte
create table #Resultados 
	(mes int,
	año int,
	montop money,
	id_contrato int,
	nro_contrato char(11))

declare @Fi datetime
declare @Ff datetime
declare @id int
set @id = 1
Set @Fi  = (select desde from #saldos where id = @Id)
Set @Ff  = (select hasta from #saldos where id = @Id)

while @id <= (select count(desde) from #Saldos) BEGIN -- CANTIDAD DE CONTRATOS
	
	WHILE 	@fi <= @ff BEGIN --MESES DE CADA CONTRATO
		INSERT INTO #resultados
		SELECT 	month(@fi), 
			year(@fi),

			case when day(s.desde) > 1 and (month(s.desde) = month(@fi)) then		
				case when fd.monto_factura is null then	
					(s.monto  / 30) * (30-day(s.desde)+1) 
				else
					(s.monto  / 30) * (30-day(s.desde)+1) - fd.monto_factura
				end
			else
				case when day(s.hasta) < 30 and ((month(@fi) = month(@ff) and year(@fi) = year(@ff))) then		
					case when fd.monto_factura is null then	
						(s.monto  / 30) * (day(s.hasta)) 
					else
						(s.monto  / 30) * (day(s.hasta)) - Fd.Monto_factura
					end
				else
					case when fd.monto_factura is null then	
						s.monto 
					else
						s.monto - fd.monto_factura
					end
				end
			end,
			/*
			case when fd.monto_factura is null then	
				 s.monto
			else			
				s.monto - fd.monto_factura
			end
			*/
			s.id_contrato,
			S.nro_contrato
		FROM #Saldos s
		INNER JOIN CTR_Contratos CC
			on CC.id_Contrato = s.id_contrato
		
		LEFT JOIN ctr_facturas F 
			ON f.documento = cc.nro_documento AND
			month(@fi) = (select month(fd.mes_factura) from CTR_FACTURAS_DETALLE fd where year(@fi) = year(fd.año_factura) and f.anulada = 0)

		LEFT JOIN CTR_FACTURAS_DETALLE FD
			on  fd.id_factura = f.id_factura AND 
			(month(@fi) = fd.mes_factura and 
			year(@fi) = fd.año_factura) and
			fd.anulada = 0
		/*
		LEFT JOIN ctr_facturas F 
			ON f.documento = cc.nro_documento AND
			(month(@fi) = month(f.Fecha_factura) and 
			year(@fi) = year(f.Fecha_factura)) and
			f.anulada = 0

		LEFT JOIN CTR_FACTURAS_DETALLE FD
			on  fd.id_factura = f.id_factura AND 
			(month(@fi) = fd.mes_factura and 
			year(@fi) = fd.año_factura) and
			fd.anulada = 0
		*/
		where id = @Id
		Set @fi = dateadd(month,1,@fi)
	END	
	set @Id = @Id + 1
	Set @Fi  = (select desde from #saldos where id = @Id)
	Set @Ff  = (select hasta from #saldos where id = @Id)

END	


-- GUARDA FACTURAS
create table #Facturas 
	(mes_factura int,
	año_factura int,
	id_cont char(11),
	monto_factura money)

insert into #facturas
select fd.mes_factura, fd.año_factura, fd.id_contrato, sum(fd.monto_factura)
from dbo.ctr_facturas f
inner join ctr_facturas_detalle fd
	on fd.id_factura=f.id_factura
where f.documento = @doc and f.anulada=0
group by fd.mes_factura,fd.año_factura,fd.id_contrato


-- SQL FINAL
select 	mes Mes_Cont, 
	año Año_Cont, 
	round(sum(montop),0)Monto_Cont,
	sum(isnull(monto_factura,0))Monto_Factura, 
	round(sum(montop - isnull(monto_factura,0)),0) saldo_mes,
	r.Id_Contrato,
	r.nro_contrato,
	TTR.descripcion acto_tipo,
	c.acto_nro	

FROM  #resultados r 
left join #facturas f
	on r.mes = f.mes_factura and 
	   r.año = f.año_factura and 
	   r.id_contrato=f.id_cont
INNER JOIN CTR_Contratos c
	on c.id_contrato=r.id_contrato
left join dbo.Tabla_Tipos_Resoluciones TTR
	on ttr.id=c.acto_tipo

where montop - isnull(monto_factura,0)>=0
group by r.mes,r.año ,r.Id_Contrato,r.nro_contrato,	
	TTR.descripcion ,c.acto_nro


drop table #Saldos
drop table #resultados
drop table #facturas



' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[FxGet_Min_Desde]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[FxGet_Min_Desde]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE  FUNCTION [dbo].[FxGet_Min_Desde] (@doc int)  
 RETURNS smalldatetime   
  
AS    
BEGIN   
DECLARE @Fecha_Ini smalldatetime    
  
 SET @Fecha_ini = (select min(desde) from ctr_contratos   
   where nro_documento=@doc)  
  
 return @Fecha_Ini   
END  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Max_Memo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Max_Memo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create  procedure [dbo].[CTR_GET_Max_Memo]

as  
  
select isnull(max(memo),0) + 1 Memo
from  dbo.CTR_Seleccion_Contratos  
' 
END
GO
/****** Object:  Table [dbo].[Tabla_Medicos_Practicas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Medicos_Practicas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Medicos_Practicas](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](100) NOT NULL,
	[Baja] [bit] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[ASIS_Solicitudes_Licencia_Web_BACKUP20090715]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web_BACKUP20090715]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ASIS_Solicitudes_Licencia_Web_BACKUP20090715](
	[id] [int] NOT NULL,
	[id_interna] [int] NOT NULL,
	[concepto] [smallint] NOT NULL,
	[desde] [smalldatetime] NOT NULL,
	[hasta] [smalldatetime] NOT NULL,
	[usuario] [smallint] NOT NULL,
	[fecha_solicitud] [smalldatetime] NOT NULL,
	[id_area] [int] NULL,
	[baja] [bit] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[CTR_Seleccion_Contratos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Seleccion_Contratos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CTR_Seleccion_Contratos](
	[Memo] [int] NULL,
	[Id_Contrato] [char](11) NULL,
	[Observacion] [varchar](200) NULL,
	[Renovar] [char](1) NULL,
	[fecha] [smalldatetime] NULL,
	[usuario] [int] NULL,
	[fecha_rrhh] [smalldatetime] NULL,
	[usuario_rrhh] [int] NULL,
	[id_area] [int] NULL,
	[paginas] [int] NULL,
	[nro_documento] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CRED_TiposDocumentos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_TiposDocumentos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_TiposDocumentos](
	[Id] [smallint] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [PK__CRED_TiposDocume__529ACA88] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[PLA_Recibos_Migrados_111108]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_Recibos_Migrados_111108]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[PLA_Recibos_Migrados_111108](
	[Archivo] [varchar](50) NULL,
	[Cant_Registros] [smallint] NULL,
	[Fecha_Carga] [datetime] NULL,
	[Usuario] [smallint] NULL,
	[liquidacion] [int] NULL,
	[tipo_liquidacion] [int] NULL,
	[mes] [smallint] NULL,
	[año] [smallint] NULL,
	[descripcion] [varchar](255) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CTR_Tempo_Renovacion]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Tempo_Renovacion]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CTR_Tempo_Renovacion](
	[id] [int] NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_Evaluador_Agente]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_Evaluador_Agente]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <10/03/2008>
-- Description:	<Trae el evaluador directamente asignado como excepcion de un agente para el periodo>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_GET_Evaluador_Agente]
	@id_agente int, @id_periodo int
AS
BEGIN
	SET NOCOUNT ON;
	
	SELECT id_evaluador 
	FROM dbo.EVAL_Evaluadores_Agentes 
	WHERE id_agente = @id_agente And id_periodo = @id_periodo
END


' 
END
GO
/****** Object:  Table [dbo].[LEG_Impresiones_DDJJ_Cargos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Impresiones_DDJJ_Cargos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Impresiones_DDJJ_Cargos](
	[Documento] [int] NOT NULL,
	[Fecha_Impresion] [datetime] NOT NULL,
	[Usuario_Impresion] [smallint] NOT NULL,
	[Año] [smallint] NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[IMP_Estudios_Idiomas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[IMP_Estudios_Idiomas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[IMP_Estudios_Idiomas]
	@id_interna int
as

insert into dbo.IMP_EStudios_Idiomas
select 
id_estudio,
(select descripcion from [dbo].tabla_idiomas TI where TI.id = EI.idioma) Idioma,
(select descripcion from [dbo].tabla_nivel_idioma TI where TI.id = EI.habla) Habla, 
(select descripcion from [dbo].tabla_nivel_idioma TI where TI.id = EI.escribe) Escribe, 
(select descripcion from [dbo].tabla_nivel_idioma TI where TI.id = EI.Lee) Lee,
EI.folio

from [dbo].Estudios_Idiomas EI
where 	
[Id_Interna] = @Id_Interna



' 
END
GO
/****** Object:  Table [dbo].[TMP_CONTRATOS_LEGAJOS_BKP_20071127]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[TMP_CONTRATOS_LEGAJOS_BKP_20071127]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[TMP_CONTRATOS_LEGAJOS_BKP_20071127](
	[Legajo] [int] NOT NULL,
	[Fecha] [smalldatetime] NULL,
	[Envio] [varchar](15) NULL,
	[Recibido] [varchar](15) NULL,
	[Motivo] [varchar](50) NULL,
	[Referencia] [int] NULL,
	[Id] [int] NOT NULL,
	[Aprobado] [smallint] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[LEG_Otros_Servicios]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Otros_Servicios]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Otros_Servicios](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[Institucion] [varchar](30) NOT NULL,
	[Domicilio] [varchar](50) NOT NULL,
	[Cargo] [smallint] NOT NULL,
	[Remun] [bit] NOT NULL,
	[Fecha_Desde] [smalldatetime] NULL,
	[Fecha_Hasta] [smalldatetime] NULL,
	[Causa_Egreso] [varchar](50) NULL,
	[Id_Interna] [int] NOT NULL,
	[Documento] [int] NOT NULL,
	[Folio] [char](10) NOT NULL,
	[Caja] [varchar](50) NULL,
	[afiliado] [varchar](50) NULL,
	[DatoDeBaja] [bit] NULL,
	[Datonoimprime] [bit] NULL,
 CONSTRAINT [PK_LEG_Otros_Servicios] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[WEB_Sincronizacion_UsuariosAreas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_Sincronizacion_UsuariosAreas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[WEB_Sincronizacion_UsuariosAreas](
	[id] [int] NOT NULL,
	[id_usuario] [smallint] NOT NULL,
	[id_area] [int] NOT NULL,
	[id_modificacion] [int] IDENTITY(1,1) NOT NULL,
	[realizada] [bit] NOT NULL,
	[fecha] [smalldatetime] NOT NULL,
 CONSTRAINT [PK_WEB_Sincronizacion_UsuariosAreas] PRIMARY KEY CLUSTERED 
(
	[id_modificacion] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[Calcula_Edad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Calcula_Edad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[Calcula_Edad]
	@Fecha_Nacimiento datetime

as
if month(convert(char(10),getdate(),103)) < month(@Fecha_Nacimiento) begin

	select YEAR(convert(char(10),getdate(),103)) - YEAR(@Fecha_Nacimiento)-1 Edad
end
else
	select YEAR(convert(char(10),getdate(),103)) - YEAR(@Fecha_Nacimiento) Edad


	


' 
END
GO
/****** Object:  StoredProcedure [dbo].[GEN_GET_Agentes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GEN_GET_Agentes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[GEN_GET_Agentes] @id_interna_evaluador int 
AS

SELECT  DP.id_Interna, 
	DP.Apellido, 
	DP.Nombre, 
	TA.id, 
	TA.Descripcion, 
	CASE WHEN CAC.Nivel_Formulario IS NULL THEN NA.nivel ELSE CAC.Nivel_Formulario END Nivel, 
	TG.grado, 
	NA.Nivel Nivel_FRM, 
	CAC.Fecha ultima_evaluacion, 
	CAC.id_calificacion
FROM dbo.EVAL_EVALUADORES_AGENTES EAG
INNER JOIN dbo.VW_DESGLOSE_AREA VWDA ON
	EAG.Id_Agente = VWDA.Id_Interna
INNER JOIN dbo.TABLA_AREAS TA ON
	VWDA.id_area = TA.id
INNER JOIN dbo.DATOS_PERSONALES DP ON
	DP.id_interna = EAG.id_Agente
INNER JOIN dbo.VW_Desglose_NivelGrado VWNG ON
	 VWNG.id_interna = DP.id_interna
INNER JOIN dbo.Tabla_Niveles TN ON
	VWNG.id_Nivel = TN.id
INNER JOIN dbo.Tabla_Grados TG ON
	VWNG.id_Grado = TG.id
LEFT JOIN dbo.EVAL_Niveles_Agentes NA ON
	NA.id_Agente = DP.Id_Interna
LEFT JOIN dbo.EVAL_Calificaciones_Agentes_Cabecera CAC ON 
	CAC.Id_Interna_Agente = DP.id_Interna
WHERE 	EAG.id_evaluador = @id_interna_evaluador AND 
	EAG.Id_Agente NOT IN (SELECT id_Interna FROM dbo.Legajo_bajas) AND
	(CAC.Actual = 1 or CAC.Actual is null)

UNION ALL

SELECT  DP.id_interna,  
	DP.Apellido, 
	DP.Nombre, 
	TA.id, 
	TA.Descripcion, 
	CASE WHEN CAC.Nivel_Formulario IS NULL THEN NA.nivel ELSE CAC.Nivel_Formulario END Nivel, 
	TG.grado, 
	NA.Nivel Nivel_FRM, 
	CAC.Fecha ultima_evaluacion,
	CAC.id_calificacion
FROM dbo.EVAL_EVALUADORES_AREAS EAR
INNER JOIN dbo.TABLA_AREAS_ESTRUCTURA TARE1 ON
	TARE1.Id_Area = EAR.Id_Area
INNER JOIN dbo.TABLA_AREAS_ESTRUCTURA TARE2 ON
	LEFT(TARE1.Id_Area,16) = LEFT(TARE2.Id_Area,16)
INNER JOIN dbo.VW_DESGLOSE_AREA VWDA ON
	TARE2.id_Area = VWDA.id_Area
INNER JOIN dbo.DATOS_PERSONALES DP ON
	VWDA.id_Interna = DP.id_Interna
INNER JOIN dbo.TABLA_AREAS TA ON
	TA.id = VWDA.id_area
LEFT JOIN dbo.EVAL_EVALUADORES_AGENTES EAG ON
	EAG.id_agente = DP.id_interna
INNER JOIN dbo.VW_Desglose_NivelGrado VWNG ON
	 VWNG.id_interna = DP.id_interna
INNER JOIN dbo.Tabla_Niveles TN ON
	VWNG.id_Nivel = TN.id
INNER JOIN dbo.Tabla_Grados TG ON
	VWNG.id_Grado = TG.id
LEFT JOIN dbo.EVAL_Niveles_Agentes NA ON
	NA.id_Agente = DP.Id_Interna
LEFT JOIN dbo.EVAL_Calificaciones_Agentes_Cabecera CAC ON 
	CAC.Id_Interna_Agente = DP.id_Interna
WHERE EAR.id_evaluador = @id_interna_evaluador AND
	EAG.Id_Agente IS NULL AND 
	EAG.Id_Agente NOT IN (SELECT id_Interna FROM dbo.Legajo_bajas) AND
	(CAC.Actual = 1 or CAC.Actual is null)


' 
END
GO
/****** Object:  Table [dbo].[L_IMP_Estudios_Especilidades]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[L_IMP_Estudios_Especilidades]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[L_IMP_Estudios_Especilidades](
	[Tipo_maqui] [char](20) NULL,
	[P_Min_Maq] [smallint] NULL,
	[Idiomas] [char](20) NULL,
	[P_Min_Idi] [smallint] NULL,
	[Id_interna] [int] NOT NULL,
	[Folio] [char](10) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[LocalidadesAFIP]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LocalidadesAFIP]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LocalidadesAFIP](
	[idLocalidad] [int] NULL,
	[codigopostal] [int] NULL,
	[nombrelocalidad] [varchar](255) NULL,
	[id_provincia] [int] NULL,
	[baja] [bit] NULL,
	[ID_Partido] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Funciones]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Funciones]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Funciones](
	[id] [smallint] NOT NULL,
	[descripcion] [varchar](10) NULL,
	[importe] [money] NULL,
	[baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Funciones] PRIMARY KEY NONCLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CRED_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Usuarios]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_Usuarios](
	[IdUsuario] [smallint] IDENTITY(1,1) NOT NULL,
	[Nombre] [varchar](30) NULL,
	[Nick] [varchar](20) NULL,
	[Clave] [varchar](200) NULL,
 CONSTRAINT [PK__CRED_Usuarios__711F51A8] PRIMARY KEY CLUSTERED 
(
	[IdUsuario] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY],
 CONSTRAINT [UQ__Cred_usuarios__6172F9C4] UNIQUE NONCLUSTERED 
(
	[Nick] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[EVAL_Preguntas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_Preguntas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[EVAL_Preguntas](
	[id_pregunta] [smallint] NOT NULL,
	[id_formulario] [smallint] NOT NULL,
	[Orden] [smallint] NOT NULL,
	[factor] [varchar](8) NOT NULL,
	[id_concepto] [smallint] NOT NULL,
	[Enunciado] [varchar](500) NOT NULL,
	[Rpta1] [varchar](500) NOT NULL,
	[Rpta2] [varchar](500) NOT NULL,
	[Rpta3] [varchar](500) NULL,
	[Rpta4] [varchar](500) NULL,
	[Rpta5] [varchar](500) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[RPT_EVAL_Formulario_Resultado]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_EVAL_Formulario_Resultado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE procedure [dbo].[RPT_EVAL_Formulario_Resultado]
	@Nivel smallint,
	@Id_Interna int
AS
SELECT	[id_Concepto] Concepto,
	ad.opcion-1 Puntos,
	deficiente,
	regular,
	bueno,
	destacado,
	(select count(*) from dbo.EVAL_Conceptos where nivel = @nivel) Registros
		
FROM dbo.EVAL_Conceptos C
INNER JOIN dbo.EVAL_Calificaciones_Agentes_Cabecera AC
	on AC.Id_interna_Agente = @Id_Interna and
	Actual = 1
INNER JOIN dbo.EVAL_Calificaciones_Agentes_Detalle AD
	ON AD.Id_Calificacion = AC.Id_Calificacion AND
	AD.Concepto = C.Id_Concepto  
INNER JOIN dbo.EVAL_Categorias cat
	ON cat.nivel = @Nivel
WHERE 
	c.[Nivel]  = @Nivel











' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Max_NroContrato_Aprobado]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Max_NroContrato_Aprobado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[CTR_GET_Max_NroContrato_Aprobado]
	@doc int
AS
SELECT  convert(char(10),Hasta,103) Hasta, id_contrato
FROM 	dbo.ctr_contratos
WHERE 	nro_contrato=(select max(nro_contrato)
			from ctr_contratos
			where nro_documento = @doc
			and aprobado=1
			and baja=0 )

' 
END
GO
/****** Object:  Table [dbo].[CNro_Cuenta]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CNro_Cuenta]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CNro_Cuenta](
	[Id] [int] NULL,
	[Legajo] [int] NULL,
	[CIA] [char](3) NULL,
	[Tipo_Cta] [smallint] NULL,
	[Nro_Cta] [char](20) NULL,
	[Sueldo] [int] NULL,
	[Id_Banco] [smallint] NULL,
	[Exportado] [smallint] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Conceptos_Recibos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Conceptos_Recibos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Conceptos_Recibos](
	[Id] [int] NOT NULL,
	[Codigo] [varchar](6) NOT NULL,
	[Descripcion] [varchar](50) NULL,
	[Aportes] [bit] NOT NULL,
	[Baja] [bit] NOT NULL,
	[Seguro] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Conceptos_Recibos] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Regimen_Escalafonario]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Regimen_Escalafonario]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Regimen_Escalafonario](
	[Id] [int] NOT NULL,
	[Regimen] [nvarchar](30) NULL,
	[baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Regimen_Escalafonario] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[MNS_DEL_Usuarios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MNS_DEL_Usuarios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[MNS_DEL_Usuarios]
AS

TRUNCATE TABLE dbo.MNS_Asignables




' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[fx_antiguedad_correspondiente]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[fx_antiguedad_correspondiente]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: ''03/12/2008''
-- Description:	Devuelve la antiguedad que corresponda para el calculo de vacaciones segun cuando entro
-- =============================================
CREATE FUNCTION [dbo].[fx_antiguedad_correspondiente]
(
	@fecha_min smalldatetime,
	@fecha_limite smalldatetime,
	@antiguedad_total char(8),
	@antiguedad_estado char(8)
)
RETURNS char(8)
AS
BEGIN
	declare @ant_correspondiente char(8)
	if @fecha_min < @fecha_limite 
	begin
		set @ant_correspondiente = @antiguedad_total
	end
	else
	begin
		set @ant_correspondiente = @antiguedad_estado
	end
	return @ant_correspondiente
END
' 
END
GO
/****** Object:  Table [dbo].[Tabla_Meses_Grados_Funciones]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Meses_Grados_Funciones]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Meses_Grados_Funciones](
	[Nivel] [smallint] NOT NULL,
	[Grado] [smallint] NOT NULL,
	[Meses] [smallint] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[LIQ_GET_Datos_Banco_Nacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_GET_Datos_Banco_Nacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[LIQ_GET_Datos_Banco_Nacion]                                              
       @Opcion int                                          
as                                              
                                          
set nocount on                                          
                                             
create table #tempo                                          
(Nro_documento int ,                                          
NomApe varchar(100) ,                                               
id_area int ,                                              
area varchar(500),                                                    
localidad varchar(200),                                               
Id_dom_pago int ,                                              
Calle_dom varchar(100) ,                                                
Nro_dom int ,                                                
Piso_dom varchar(5) ,                                                
dpto_dom  varchar(10) ,                                          
calle_area varchar(100) ,                                               
nro_area int ,                                              
piso_area varchar(5) ,                                              
dpto_area varchar(5) ,                                               
Tipo_Planta int ,                                              
planta varchar(50) ,                                              
nivel char(5) ,                                              
grado char(5) ,                                              
funcion varchar(50) ,                                              
rango varchar(50) ,                                               
monto float ,                                              
id_estado_civil int ,                                              
Estado_civil varchar(50) ,                                          
          
Proceso char(2),          
Servicio varchar(4),          
Sucur_Bco int,          
id_banco int,          
Moneda char(1),          
Limite_Tarjeta int,          
letra_EC char(1),          
CBU varchar(22),          
Tarjeta_Debito varchar(19),          
Tarjeta_1er_Titular varchar(19),          
Tarjeta_2do_Titular varchar(19),          
exportado bit,                
cuil varchar(15),        
id_interna int)                                          
                                          
                                          
insert into #tempo                                          
select distinct * from dbo.VW_LIQ_Datos_Banco_Nacion                 

delete from #tempo
where Nro_documento in (select documento from dbo.Liq_Nro_Cuenta_Activa where Fecha_Baja is null)
                                                                    
update #tempo                                         
set  id_area= ta.id,                                              
area= ta.Descripcion ,                                        
--Id_dom_pago= null,                                        
calle_area= ltrim(rtrim(tad.calle)),                                         
nro_area=ltrim(rtrim(tad.nro)) ,                                        
piso_area=ltrim(rtrim(tad.piso)) ,                                        
dpto_area=ltrim(rtrim(tad.dpto))                                         
from #tempo t                                        
                                        
left join dbo.vw_desglose_area da                                              
 on t.nro_documento = da.documento                                              
                                              
LEFT join dbo.tabla_areas TA                                              
 on TA.id = da.id_area                                              
                                              
LEFT join dbo.tabla_areas_detalle TAD                                              
 on tad.id_area=TA.id                                         
                                        
                                        
--PARA INCORPORAR A BANCO (0)                                        
if @Opcion=0 begin                                          
  select * from #tempo t                                        
   where  t.nro_documento not in (select documento from liq_nro_cuenta_nacion)                                              
 order by t.NomApe          
end                                          
                                        
                                        
--FALTAN DATOS DE BANCO (1)                  
if @Opcion=1 begin                                         
                                      
 update #tempo           
 set Proceso = l.proceso,        
  Servicio = l.servicio,        
  Moneda = l.moneda,        
  Limite_Tarjeta = l.Limite_Tarjeta,        
  id_estado_civil = l.Id_Estado_Civil_Bco,                                      
  CBU = l.CBU,                                      
  id_banco = l.Id_Banco,                                      
  Sucur_bco = l.Sucur_Bco,                                                                 
  Id_dom_pago = l.Id_Dom_Pago,                                      
  exportado = l.Exportado                                      
 from #tempo t                                      
  inner join liq_nro_cuenta_nacion l                                        
  on l.documento=t.nro_documento                                        
        
                                         
 select *   
 from #tempo t                                          
  inner join liq_nro_cuenta_nacion l                                        
  on l.documento=t.nro_documento                                        
 where  ((l.Tarjeta_Debito='''' or l.Tarjeta_Debito is null or l.Tarjeta_Debito=''0'')        
  OR (l.Tarjeta_1er_Titular='''' or l.Tarjeta_1er_Titular is null or l.Tarjeta_1er_Titular=''0'')        
  OR (l.Tarjeta_2do_Titular='''' or l.Tarjeta_2do_Titular is null or l.Tarjeta_2do_Titular=''0''))        
  and (l.Id_Dom_Pago is null OR l.Id_Dom_Pago = 0)         
 order by t.id_area                  
end                                          
                                        
                                      
--LISTOS PARA ENVIAR (2)              
if @Opcion=2 begin                                         
                     
 update #tempo                                       
 set Proceso = l.proceso,        
  Servicio = l.servicio,        
  Moneda = l.moneda,        
  Limite_Tarjeta = l.Limite_Tarjeta,        
  id_estado_civil = l.Id_Estado_Civil_Bco,                                      
  CBU = l.CBU,                                      
  id_banco = l.Id_Banco,                                      
  Sucur_bco = l.Sucur_Bco,                                                                
  Id_dom_pago = l.Id_Dom_Pago,                                      
  exportado = l.Exportado                                        
 from #tempo t                                      
  inner join liq_nro_cuenta_nacion l                                        
  on l.documento=t.nro_documento                                        
                                      
 select *   
 from #tempo t                                          
  inner join liq_nro_cuenta_nacion l                                        
  on l.documento=t.nro_documento                                        
 where   ((l.Tarjeta_Debito='''' or l.Tarjeta_Debito is null or l.Tarjeta_Debito=''0'')        
  OR (l.Tarjeta_1er_Titular='''' or l.Tarjeta_1er_Titular is null or l.Tarjeta_1er_Titular=''0'')        
  OR (l.Tarjeta_2do_Titular='''' or l.Tarjeta_2do_Titular is null or l.Tarjeta_2do_Titular=''0''))                                         
  and l.Id_Banco is not null                                                                           
  and abs(l.Id_Dom_Pago)>0                                    
  and l.exportado=0                                     
 order by t.NomApe                                                
end                                          
                                        
  
--ENVIADOS            
if @Opcion=3 begin                                         
                                      
 update #tempo                                       
 set Proceso = l.proceso,        
  Servicio = l.servicio,        
  Moneda = l.moneda,        
  Limite_Tarjeta = l.Limite_Tarjeta,        
  id_estado_civil = l.Id_Estado_Civil_Bco,                                      
  CBU = l.CBU,  
  Tarjeta_Debito = l.Tarjeta_Debito,  
  Tarjeta_1er_Titular = l.Tarjeta_1er_Titular,                              
  id_banco = l.Id_Banco,                                      
  Sucur_bco = l.Sucur_Bco,                                                                
  Id_dom_pago = l.Id_Dom_Pago,                                      
  exportado = l.Exportado                                        
 from #tempo t                                      
  inner join liq_nro_cuenta_nacion l                                        
  on l.documento=t.nro_documento                               
                                      
 select *   
 from #tempo t                                          
  inner join liq_nro_cuenta_nacion l                                        
  on l.documento=t.nro_documento                                        
 where   ((l.Tarjeta_Debito='''' or l.Tarjeta_Debito is null or l.Tarjeta_Debito=''0'')        
  OR (l.Tarjeta_1er_Titular='''' or l.Tarjeta_1er_Titular is null or l.Tarjeta_1er_Titular=''0'')        
  /*OR (l.Tarjeta_2do_Titular='''' or l.Tarjeta_2do_Titular is null or l.Tarjeta_2do_Titular=''0'')*/)                                         
  and l.Id_Banco is not null                                                                           
  and abs(l.Id_Dom_Pago)>0                                    
  and l.exportado=1                                     
 order by t.NomApe     
                                            
end                                  
    
                                
                                  
--CON CUENTA                               
if @Opcion=4 begin                                         
                                      
 update #tempo                                       
 set Proceso = l.proceso,        
  Servicio = l.servicio,        
  Moneda = l.moneda,        
  Limite_Tarjeta = l.Limite_Tarjeta,        
  id_estado_civil = l.Id_Estado_Civil_Bco,                                      
  CBU = l.CBU,  
  Tarjeta_Debito = l.Tarjeta_Debito,  
  Tarjeta_1er_Titular = l.Tarjeta_1er_Titular,                              
  id_banco = l.Id_Banco,                                      
  Sucur_bco = l.Sucur_Bco,                                                                
  Id_dom_pago = l.Id_Dom_Pago,                                      
  exportado = l.Exportado                                        
 from #tempo t                                      
  inner join liq_nro_cuenta_nacion l                                        
  on l.documento=t.nro_documento                                       
                                         
                                      
 select *   
 from #tempo t                                          
  inner join liq_nro_cuenta_nacion l                                        
  on l.documento=t.nro_documento                                        
 where   ((l.Tarjeta_Debito<>'''' /*or l.Tarjeta_Debito is not null or l.Tarjeta_Debito<>''0''*/)        
  OR (l.Tarjeta_1er_Titular<>'''' /*or l.Tarjeta_1er_Titular is not null or l.Tarjeta_1er_Titular<>''0''*/)        
  /*OR (l.Tarjeta_2do_Titular<>'''' or l.Tarjeta_2do_Titular is not null or l.Tarjeta_2do_Titular<>''0'')*/)                                         
  and l.Id_Banco is not null                                                                           
  and abs(l.Id_Dom_Pago)>0                                    
  and l.exportado=1                                     
 order by t.NomApe                                              
end                                  ' 
END
GO
/****** Object:  Table [dbo].[RH_Config_Mostrar_Controles]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_Config_Mostrar_Controles]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[RH_Config_Mostrar_Controles](
	[Control] [varchar](20) NULL,
	[Formulario] [varchar](100) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CTR_UPD_Marca_Excepcion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_UPD_Marca_Excepcion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_UPD_Marca_Excepcion]
@Id_Cont char(11)
AS
If (select excepcion from CTR_Contratos where Id_Contrato=@id_Cont)=0 begin
	Update CTR_Contratos set Excepcion=1 where id_Contrato=@id_Cont
end
else
begin
 	Update CTR_Contratos set Excepcion=0 where id_Contrato=@id_Cont
end
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CGet_Contrato_Activo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CGet_Contrato_Activo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[CGet_Contrato_Activo]
	@nro_documento int
as
select * from ctr_contratos
where nro_documento=@nro_documento and baja=0


' 
END
GO
/****** Object:  Table [dbo].[Tabla_Areas_Estructura]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Areas_Estructura]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Areas_Estructura](
	[codigo] [char](24) NOT NULL,
	[Id_area] [int] NOT NULL,
	[Descripcion] [varchar](200) NOT NULL,
	[Baja] [bit] NOT NULL,
	[Acto_Baja] [smallint] NULL,
	[Acto_Nro] [varchar](10) NULL,
	[Acto_Fecha] [datetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CTR_Recepcion_Contratos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Recepcion_Contratos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CTR_Recepcion_Contratos](
	[Id] [int] NULL,
	[Id_Contrato] [int] NULL,
	[Compro_Recepcion] [int] NULL,
	[Compro_Recepcion_Fecha] [smalldatetime] NULL,
	[Compro_Recepcion_Usuario] [int] NULL,
	[Compro_Envio] [int] NULL,
	[Compro_Envio_Fecha] [smalldatetime] NULL,
	[Compro_Envio_Usuario] [int] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[LIQ_Nro_Cuenta_Nacion_backup]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_Nro_Cuenta_Nacion_backup]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LIQ_Nro_Cuenta_Nacion_backup](
	[Id] [int] NULL,
	[Proceso] [char](2) NULL,
	[Servicio] [varchar](4) NULL,
	[Sucur_Bco] [int] NULL,
	[id_banco] [int] NULL,
	[Moneda] [char](1) NULL,
	[Limite_Tarjeta] [int] NULL,
	[Documento] [int] NULL,
	[Id_Estado_Civil_Bco] [smallint] NULL,
	[Id_Dom_Pago] [int] NULL,
	[CBU] [varchar](22) NULL,
	[Tarjeta_Debito] [varchar](19) NULL,
	[Tarjeta_1er_Titular] [varchar](19) NULL,
	[Tarjeta_2do_Titular] [varchar](19) NULL,
	[Exportado] [bit] NULL,
	[Usua_Ingre] [smallint] NULL,
	[Fecha_Ingre] [smalldatetime] NULL,
	[Usua_Envia] [smallint] NULL,
	[Fecha_Envia] [smalldatetime] NULL,
	[Usua_Reci] [smallint] NULL,
	[Fecha_Reci] [smalldatetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[ASIS_Planillas_Recibidas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Planillas_Recibidas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ASIS_Planillas_Recibidas](
	[Agente] [int] NULL,
	[Area] [int] NULL,
	[Periodo] [varchar](7) NULL,
	[Recepciono] [smallint] NULL,
	[Fecha_Recepcion] [smalldatetime] NULL,
 CONSTRAINT [IX_ASIS_Planillas_Recibidas] UNIQUE NONCLUSTERED 
(
	[Agente] ASC,
	[Area] ASC,
	[Periodo] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Areas_Detalle]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Areas_Detalle]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Areas_Detalle](
	[Id_Area] [int] NOT NULL,
	[Tratamiento_Area] [smallint] NULL,
	[Codigo_Dependencia] [int] NOT NULL,
	[Calle] [varchar](255) NULL,
	[Nro] [varchar](5) NULL,
	[Piso] [varchar](3) NULL,
	[Dpto] [varchar](3) NULL,
	[Localidad] [int] NULL,
	[Codigo_Postal] [int] NULL,
	[Tratamiento] [smallint] NULL,
	[Tratamiento_Titulo] [smallint] NULL,
	[Contacto] [varchar](255) NULL,
	[Telefono] [varchar](20) NULL,
	[Fax] [varchar](20) NULL,
	[Baja] [bit] NOT NULL,
	[Usuario] [smallint] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[MNS_Solicitantes]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MNS_Solicitantes]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[MNS_Solicitantes](
	[Id] [int] NOT NULL,
	[Solicitante] [varchar](100) NOT NULL,
 CONSTRAINT [PK_MNS_Solicitantes] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CON_MED_Embarazos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CON_MED_Embarazos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CON_MED_Embarazos]            
AS
set nocount on
        
--Consulta con fecha de parto 30 dias antes. 
CREATE TABLE #tempo
(
 Nro_Documento int,    
 Id_Interna int,          
 Apellido varchar(60),
 Nombre varchar(60),         
 Fecha_Parto char(10),
 Id_Lic int
)


INSERT INTO #tempo
SELECT
 dp.Nro_Documento,    
 dp.Id_Interna,          
 dp.Apellido,          
 dp.Nombre,           
 convert(char(10),MA.Fecha_Parto,103) Fecha_Parto,
 ma.IdLicencia

FROM dbo.MED_Atenciones  MA                                     
    
INNER JOIN dbo.datos_personales dp          
 ON dp.nro_documento = MA.nro_documento   
       

WHERE   (MA.Fecha_Parto between getdate() and getdate() + 30)        
  and baja = 0  

ORDER BY dp.apellido, dp.nombre Desc 


DELETE #tempo
where Id_Interna in 
(
select t.Id_Interna 
from licencias_solicitadas l
 inner join #tempo t
	on t.Id_Interna = l.Id_Interna

  inner join dbo.MED_Atenciones  MA --modificado DT
  on t.nro_documento = MA.nro_documento  --modificado DT

where l.Concepto = 9 --10G
and MA.Fecha_Parto between l.desde and l.hasta    --modificado DT
)


select 
Nro_Documento,
Apellido,
Nombre,
Fecha_Parto
from #tempo
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Buscar_Contrato_Por_Nivel_GER]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Buscar_Contrato_Por_Nivel_GER]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Buscar_Contrato_Por_Nivel_GER]    
@IdNivel int,     
@Documento int,     
@FechaCorte smalldatetime    
as    
set nocount on    
    
    
DECLARE @IDContrato int    
    
create table #tempo    
(     
IDContrato int,    
Documento int,    
Nivel int,    
Grado int,    
FechaDesdeMas2 smalldatetime,    
FechaDesdeMenos2 smalldatetime,    
FechaHastaMas2 smalldatetime,    
FechaHastaMenos2 smalldatetime    
)    
    
insert into #tempo    
select  ID_Contrato,    
        Nro_Documento,    
        Nivel,    
        Grado,    
        Desde + 2,      
        Desde - 2,    
        Hasta + 2,      
        Hasta - 2     
from CTR_Contratos      
where Nro_Documento = @Documento     
and Nivel = @IdNivel     
and (Baja=0    
 OR (BAJA = 1 and Aprobado = 1))    
    
    
select ''tempo'',
IDContrato , 
Documento ,    
Nivel ,    
Grado ,    
FechaDesdeMenos2 ,    
FechaDesdeMas2 ,    
FechaHastaMenos2, 
FechaHastaMas2 ,    
@FechaCorte 
from #tempo  

  
SET @IDContrato = (select max(IDContrato)     
from #tempo    
where ((@FechaCorte between FechaDesdeMenos2 and FechaDesdeMas2)    
OR (@FechaCorte between FechaHastaMenos2 and FechaHastaMas2)))    
    
    
select t.IdContrato Id_Contrato, t.nivel, t.grado, g.Grado Grado_Descrip    
from #tempo t    
    
INNER JOIN tabla_grados g    
 ON g.id = t.grado    
    
where IdContrato = @IDContrato     
/*    
create table #tempo2    
(fecha smalldatetime)    
    
insert into #tempo2    
exec dbo.CTR_GET_Primer_Fecha_Nivel @IDContrato    
    
    
select convert(char(10),fecha,103) fecha from #tempo2    
*/ ' 
END
GO
/****** Object:  StoredProcedure [dbo].[ABM_Acto_Adm]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ABM_Acto_Adm]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE  Procedure [dbo].[ABM_Acto_Adm]
	@Operacion as smallint,
	@id smallint,
	@Descripcion varchar(50)=null
as
--ALTA
if @operacion =1 begin
	set @id = (select max(id)+1 from  dbo.Tabla_Tipos_Resoluciones)
	if @id is null begin
		set @id =1
	end
	insert into dbo.Tabla_Tipos_Resoluciones
	(id,descripcion)
	values (@id,@descripcion)
end

--MODIFICA
If @operacion =2 begin
	update dbo.Tabla_Tipos_Resoluciones
	set 	descripcion = @descripcion
	where id = @id
end

IF @Operacion =3 begin
	update dbo.Tabla_Tipos_Resoluciones
	set 	Baja = 1
	where id = @id

end
' 
END
GO
/****** Object:  Table [dbo].[LEG_Tabla_Tipo_URetributivas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Tabla_Tipo_URetributivas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Tabla_Tipo_URetributivas](
	[Id] [int] NULL,
	[Descripcion] [varchar](100) NULL,
	[baja] [bit] NULL,
	[tipo] [char](3) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[table_doc_borrar]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[table_doc_borrar]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[table_doc_borrar](
	[doc] [int] NULL
) ON [PRIMARY]
END
GO
/****** Object:  View [dbo].[VW_GET_Exp_Pendientes_Aprobacion]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_GET_Exp_Pendientes_Aprobacion]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_GET_Exp_Pendientes_Aprobacion]
as
select Exp_Nro,count(*)Cant 
from ctr_contratos
where aprobado=0 
and firmado=1
and impreso=1
and baja=0
and exp_nro is not null
group by exp_nro 



'
GO
/****** Object:  Table [dbo].[Tabla_Sucursales_Banco]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Sucursales_Banco]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Sucursales_Banco](
	[CodBancoBCRA] [int] NULL,
	[CodSucursalBCRA] [int] NULL,
	[CodSucursalINTERNA] [int] NULL,
	[Denominacion] [varchar](50) NULL,
	[Direccion] [varchar](100) NULL,
	[Localidad] [varchar](50) NULL,
	[Provincia] [varchar](50) NULL,
	[CP] [varchar](50) NULL,
	[Telefonos] [varchar](100) NULL,
	[Observaciones] [varchar](100) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Autorizaciones_Licencias_BK150509]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Autorizaciones_Licencias_BK150509]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Autorizaciones_Licencias_BK150509](
	[Id_Interna] [int] NOT NULL,
	[Dias_Autorizados] [smallint] NOT NULL,
	[Id_Concepto_Licencia] [smallint] NOT NULL,
	[Periodo] [smallint] NOT NULL,
	[Id] [int] NOT NULL,
	[Dias_Tomados] [smallint] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[CRED_HistoricoCredencialesAsignablesAPersonas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_HistoricoCredencialesAsignablesAPersonas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_HistoricoCredencialesAsignablesAPersonas](
	[IdPersona] [int] NOT NULL,
	[IdTipoCredencial] [smallint] NOT NULL,
	[fecha] [smalldatetime] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_UPD_Entrega_Recibo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_UPD_Entrega_Recibo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[PLA_UPD_Entrega_Recibo]  
 @Id_Recibo int  
AS  
UPDATE dbo.PLA_Recibos  
SET Entregado = 1  
WHERE Id_Recibo = @Id_Recibo  

' 
END
GO
/****** Object:  Table [dbo].[Historico_Licencias_Solicitadas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Historico_Licencias_Solicitadas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Historico_Licencias_Solicitadas](
	[Id] [int] NOT NULL,
	[Id_Interna] [int] NOT NULL,
	[Concepto] [smallint] NOT NULL,
	[Periodo] [smallint] NOT NULL,
	[Desde] [smalldatetime] NOT NULL,
	[Hasta] [smalldatetime] NOT NULL,
	[Autorizacion] [smallint] NOT NULL,
	[Autorizo_Descuento] [varchar](100) NULL,
	[Dias_Descuento] [varchar](4) NULL,
	[Goce] [smallint] NOT NULL,
	[Observaciones] [varchar](100) NULL,
	[Id_Area] [int] NOT NULL,
	[Informo] [varchar](50) NOT NULL,
	[Id_Tabla_Autorizacion] [int] NOT NULL,
	[Dias_A_Tomar] [smallint] NOT NULL,
	[Fh_Fin_Antes_Interr] [smalldatetime] NULL,
	[Motivo_Interrupcion] [varchar](200) NULL,
	[usuario] [smallint] NOT NULL,
	[Operacion] [char](1) NULL,
	[Fecha_operacion] [smalldatetime] NULL,
	[informo_a_liquidacion] [bit] NULL,
	[informo_Fecha] [smalldatetime] NULL,
	[informo_usuario] [smallint] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Articulos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Articulos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Articulos](
	[Nro_Articulo] [varchar](5) NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [PK_Tabla_Articulos] PRIMARY KEY CLUSTERED 
(
	[Nro_Articulo] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Impresion_Anexos_Certificacion_Resolucion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Impresion_Anexos_Certificacion_Resolucion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Impresion_Anexos_Certificacion_Resolucion]              
 @Expediente varchar(30),              
 @Marca char(1)              
AS              
    
set nocount on    
              
create table #tempo    
(    
Apellido varchar(40),    
Nombre varchar(60),    
Documento varchar(10),    
Nivel varchar(100),    
Grado varchar(100),    
MontoMensual int,    
Desde smalldatetime,    
Hasta smalldatetime,    
Tipo int,    
Secretaria varchar(200),    
Resolucion varchar(200),  
Estado char(1),  
Aprobado smallint,  
Contrato varchar(15)   
)    
    
insert into #tempo    
  
  
SELECT  dp.Apellido,               
 dp.nombre,              
 --DI.Descripcion + '' '' + cast(dp.Nro_Documento as varchar) Documento,              
 cast(dp.Nro_Documento as varchar) Documento,              
 CASE WHEN TN.Nivel IS NULL THEN              
    rtrim(ltrim(TFC.Descripcion))              
 ELSE              
    rtrim(ltrim(TN.Nivel))              
 END Nivel,              
 CASE WHEN TN.Nivel IS NULL THEN              
    rtrim(ltrim(Tr.Descripcion))    
 ELSE              
    rtrim(ltrim(TG.Grado))    
 END Grado,              
 CASE WHEN TN.Nivel IS NULL THEN              
  c.monto               
 ELSE              
--  TS.Remuneracion_Fija  --MLD:09/08/07: Modificaicon tabla SINAPA             
  dbo.Fx_Monto_Sinapa (tn.nivel, tg.grado, c.desde)          
 END MontoMensual,              
              
-- CASE WHEN TN.Nivel IS NULL THEN              
 -- c.monto * datediff(month,desde,hasta)              
-- ELSE              
 -- TS.Remuneracion_Fija * datediff(month,desde,hasta)              
-- END Monto,              
 convert(char(10),c.Desde,103) Desde,              
 convert(char(10),hasta,103) Hasta,              
 ttc.SendLegajos Tipo,              
               
 case when @marca=1 then              
  --AREA CONTRATO              
  isnull(Te2.descripcion,'''')               
 else              
  --AREA DESGLOSE              
  isnull(Te3.descripcion,'''')               
 end Secretaria ,             
 null,  
 c.estado,  
 c.aprobado,  
 c.nro_contrato    
              
FROM dbo.Ctr_Contratos C              
              
INNER JOIN dbo.Datos_Personales Dp              
 on DP.Nro_Documento = C.Nro_Documento              
LEFT JOIN dbo.Tabla_Niveles TN              
 on TN.Id = c.Nivel              
LEFT JOIN dbo.Tabla_Grados TG              
 on TG.Id = c.Grado              
LEFT JOIN dbo.Tabla_Rangos TR              
 on TR.id = C.Rango              
LEFT JOIN dbo.Tabla_Funciones_Contratos TFC              
 on TFC.Id = C.Funcion              
              
INNER JOIN dbo.Tabla_DocIdentidad DI              
 on DI.Id = dp.Tipo_documento              
              
INNER JOIN dbo.Tabla_Resoluciones_Contratos TRC              
 on TRC.id = C.Tipo_Contrato              
              
Inner join dbo.Tabla_tipos_Contratos TTC              
 on TTC.id = TRC.Tipo_Contrato              
              
--LEFT JOIN dbo.Tabla_Sinapa TS     --MLD: 09/08/07 Modifiacion SINAPA          
-- on (TS.Nivel = tn.nivel) AND              
--    (TS.grado = tg.grado)                
              
LEFT JOIN dbo.CTR_Expedientes_Anexados EA              
 ON EA.Id_Contrato = C.Id_Contrato              
              
 LEFT JOIN dbo.tabla_areas_estructura TE              
  ON TE.id_area=c.id_area and right(te.codigo,5)<>''00000''              
               
 LEFT JOIN dbo.tabla_areas_estructura TE2              
  on te2.codigo=(left(te.codigo,10)+''00000000000000'')              
              
--LEFT join dbo.tabla_areas TA              
-- on TA.id = da.id_area              
               
 LEFT join dbo.vw_desglose_area da              
  on c.nro_documento = da.documento              
              
 LEFT join dbo.tabla_areas TA              
  on TA.id = da.id_area               
              
 LEFT JOIN dbo.tabla_areas_estructura TE4              
  ON TE4.id_area=da.id_area and right(te4.codigo,5)<>''00000''              
              
 LEFT JOIN dbo.tabla_areas_estructura TE3              
  on te3.codigo=(left(te4.codigo,10)+''00000000000000'')              
              
WHERE  rtrim(C.Exp_nro) = @Expediente   
--AND C.Baja = 0 AND              
-- C.Aprobado =0 AND              
-- EA.Id_Contrato IS NULL                         
    
   
UPDATE t    
set Resolucion = ttr.descripcion +'' N° ''+ rtrim(ltrim(isnull(c.acto_nro,0))) +''/''+ isnull(right(year(c.acto_fecha),2),''-'')  
  
from #tempo t    
  
LEFT join dbo.Ctr_Contratos c     
 on c.nro_documento = t.documento    
    
LEFT join dbo.tabla_tipos_resoluciones TTR        
 on TTR.id = c.acto_tipo     
    
where  c.nro_contrato in (select max(nro_contrato) from dbo.ctr_contratos     
      where nro_documento = t.documento and aprobado=1)    
      
select * from #tempo    
Order by apellido,nombre              
            
              
              
              
              
            
          
        
        
      
    
    
    
    
    
  

' 
END
GO
/****** Object:  Table [dbo].[PLA_Agentes_Incorporados]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_Agentes_Incorporados]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[PLA_Agentes_Incorporados](
	[id] [int] NOT NULL,
	[area] [int] NOT NULL,
	[Doc] [int] NULL,
	[Apellido] [varchar](80) NOT NULL,
	[Nombre] [varchar](80) NULL,
	[Funcion] [int] NULL,
	[Planta] [int] NULL,
	[Usuario_solicito_incorporacion] [int] NOT NULL,
	[fecha_solicitud_incorporacion] [smalldatetime] NOT NULL,
	[Estado] [varchar](50) NOT NULL,
	[Modificable] [bit] NOT NULL,
	[usuario_cancelo] [int] NULL,
	[fecha_cancelacion] [smalldatetime] NULL,
	[Telefono] [varchar](50) NULL,
	[modalidad] [varchar](100) NULL,
	[confirmado] [bit] NULL,
 CONSTRAINT [PK_PLA_Agentes_Incorporados] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[LEG_Desglose_UR_Reemplazos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_UR_Reemplazos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Desglose_UR_Reemplazos](
	[Documento] [int] NULL,
	[id_UR_a_reempla] [int] NULL,
	[Id_UR_nueva] [int] NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_ADD_Antiguedad_Reconocida_Calculo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ADD_Antiguedad_Reconocida_Calculo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

create procedure [dbo].[CTR_ADD_Antiguedad_Reconocida_Calculo]
	@Id_Calculo int,
	@Nro_Documento int,
	@Tipo char(1),
	@Id_Antiguedad int,
	@Desde datetime,
	@Hasta Datetime,
	@FechaCorte datetime,
	@UsuarioProceso smallint
AS
INSERT INTO dbo.CTR_Antiguedad_Reconocida_Grado
VALUES (@Id_Calculo,
	@Nro_documento,
	@Tipo,
	@Id_Antiguedad,
	@Desde,
	@Hasta,
	@FechaCorte,
	Getdate(),
	@UsuarioProceso)

' 
END
GO
/****** Object:  Table [dbo].[Perfiles]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Perfiles]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Perfiles](
	[Id_Usuario] [smallint] NOT NULL,
	[Id_Acceso] [smallint] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[_Autorizaciones_Hoy]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[_Autorizaciones_Hoy]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[_Autorizaciones_Hoy](
	[DNI] [float] NULL,
	[Año] [float] NULL,
	[autorizados] [float] NULL,
	[id_interna] [int] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Doc_Contrato]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Doc_Contrato]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Doc_Contrato](
	[Id] [smallint] NULL,
	[Tipo_Contrato] [smallint] NULL,
	[Nom_Doc] [varchar](50) NULL,
	[DDJJ] [varchar](50) NULL,
	[Enmienda] [bit] NOT NULL,
	[Anexo] [varchar](200) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Bajas_Personas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Bajas_Personas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Bajas_Personas](
	[id] [smallint] NOT NULL,
	[descripcion] [varchar](50) NULL,
	[baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Bajas_Personas] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[tmp2_autorizaciones_licencias]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[tmp2_autorizaciones_licencias]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[tmp2_autorizaciones_licencias](
	[id_interna] [int] NULL,
	[dias_autorizados] [int] NULL,
	[id_concepto_licencia] [int] NULL,
	[periodo] [int] NULL,
	[id] [int] IDENTITY(108294,1) NOT NULL,
	[dias_tomados] [int] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[TMP_Dotacion_Area]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[TMP_Dotacion_Area]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[TMP_Dotacion_Area](
	[Id] [smallint] NULL,
	[Area] [int] NULL,
	[Secretaria] [varchar](200) NULL,
	[SubSecretaria] [varchar](200) NULL,
	[Dirección] [varchar](200) NULL,
	[Permanente] [smallint] NULL,
	[Transitoria] [smallint] NULL,
	[Gabinete] [smallint] NULL,
	[Contratada] [smallint] NULL,
	[Externa] [smallint] NULL,
	[Direccion2] [varchar](200) NULL,
	[direccion3] [varchar](200) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Desglose_UR_Reemplazos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Desglose_UR_Reemplazos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_GET_Desglose_UR_Reemplazos]              
 @Documento int = null,      
 @id int = 0,  
 @Operacion char(1) -- T: ESTA EN TRAMITE LA UR / A: ESTA APROBADA Y MUESTRO SI TIENE A QUIEN REEMPLAZO (Historia)        
AS              
         
set nocount on    
    
create table #tempo    
(Marca char(1),    
 Id  int,        
 Id_area  bigint,         
 Cant_UR  int,    
 Desc_Area varchar (200),    
 documento int)    
    
  
IF @Operacion = ''T''   
BEGIN    
	 INSERT INTO #tempo    
	 SELECT '''', ur.id, ur.Id_Area, ur.cant_ur, ta.descripcion Desc_Area, ur.documento     
	  FROM  dbo.LEG_Desglose_UR UR            
	  INNER JOIN dbo.Tabla_Areas TA            
	    ON TA.id = UR.Id_Area            
	  INNER JOIN dbo.LEG_Tabla_Tipo_URetributivas TUR        
	   ON TUR.id = ur.tipo_ur        
	  WHERE   ur.baja = 0        
	   and ur.estado = ''A''     
	   and ur.documento = @Documento           
	  ORDER BY convert(datetime,Desde) Desc     
END  
ELSE  
BEGIN  
	INSERT INTO #tempo
	SELECT '''', urr.id_UR_a_reempla, ur.Id_Area, ur.cant_ur, ta.descripcion Desc_Area, ur.documento     
	FROM  dbo.LEG_Desglose_UR UR            
	INNER JOIN dbo.Tabla_Areas TA            
	ON TA.id = UR.Id_Area            
	INNER JOIN dbo.LEG_Tabla_Tipo_URetributivas TUR        
	ON TUR.id = ur.tipo_ur   
	INNER JOIN dbo.LEG_Desglose_UR_reemplazos urr            
	ON ur.id = urr.Id_UR_nueva  
	WHERE   ur.documento = @Documento           
	and urr.Id_UR_nueva = @id  
	ORDER BY convert(datetime,Desde) Desc   
END  
  
    
UPDATE t    
set marca = ''X''    
from #tempo t    
 INNER JOIN dbo.LEG_Desglose_UR_Reemplazos R            
 on t.documento = r.documento    
   and t.id = r.id_UR_a_reempla   
where r.id_UR_nueva = @id      
    
    
  
select   Marca,    
  Id,        
  Id_area,         
  Cant_UR,    
  Desc_Area,    
  documento   
from #tempo    
  
  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Funciones_Certificados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Funciones_Certificados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


create procedure [dbo].[CTR_GET_Funciones_Certificados]
	@IdNivel smallint
AS
SELECT Id, Descripcion
FROM dbo.Tabla_Cargos TFC
INNER JOIN dbo.Tabla_Relacion_Funcion_Nivel RFN
	on RFN.IdFuncion = TFC.Id
WHERE Baja =0 AND 
	RFN.IdNIvel = @IdNivel


' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_CTR_Envio_Contratos]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_CTR_Envio_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[RPT_CTR_Envio_Contratos]  
 @Compro_Envio int  
as  


SET NOCOUNT ON


CREATE TABLE #Tabla
(
nro_documento int null,
apellido varchar(40) null,  
nombre varchar(60) null,  
Compro_Envio int null,  
Compro_Envio_Fecha char(10) null,  
descripcion varchar(200) null,  
nivel varchar(5) null,  
grado varchar(5) null
)

INSERT INTO #Tabla
select  cc.nro_documento,
 dp.apellido, 
 dp.nombre,  
 rc.Compro_Envio,  
 convert(char(10),rc.Compro_Envio_Fecha,103) Compro_Envio_Fecha,  
 NULL, --ta.descripcion,  
 n.nivel,  
 g.grado
  
from dbo.CTR_Recepcion_Contratos rc  
  
inner join ctr_contratos cc  
 on cc.id_contrato = rc.id_contrato  
  
inner join datos_personales dp  
 on dp.nro_documento = cc.nro_documento  
  
--inner join vw_desglose_area da  
-- on cc.nro_documento = da.documento  
--  
--inner join tabla_areas ta  
-- on da.id_area = ta.id  
  
inner join tabla_niveles n  
 on n.id = cc.nivel  
  
inner join tabla_grados g  
 on g.id = cc.grado  
  
where Compro_Envio =  @Compro_Envio  


UPDATE t
set descripcion = ta.descripcion
FROM #Tabla t

inner join vw_desglose_area da  
 on t.nro_documento = da.documento  
  
inner join tabla_areas ta  
 on da.id_area = ta.id  


select t.apellido +'', ''+ t.nombre apellido_nombre,   
 t.Compro_Envio,  
 t.Compro_Envio_Fecha,  
 t.descripcion,  
 t.nivel,  
 t.grado 
from #Tabla t
order by apellido, nombre  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_GET_Licencias_Pendientes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_Licencias_Pendientes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'  
CREATE PROCEDURE [dbo].[MED_GET_Licencias_Pendientes]      
 @id_interna int      
AS      
SET NOCOUNT ON    

DECLARE @desde smalldatetime
DECLARE @hasta smalldatetime
SET @desde = convert(smalldatetime, ''01/01/''+convert(char(4),year(getdate())))
SET @hasta = convert(smalldatetime, ''31/12/''+convert(char(4),year(getdate())))

create table #tempo    
(    
concepto int,    
desde smalldatetime,    
hasta smalldatetime,    
dias int    
)    
    
--MUESTRO SOLO EL AÑO ACTUAL PARA 10A
insert into #tempo    
Select Concepto,      
	desde,
	hasta,   
	0 
--CASE WHEN year(desde) = year(getdate()) and (year(hasta) = year(getdate()) OR year(hasta) = year(getdate()) + 1 ) THEN                  
--  desde                  
-- --ELSE CASE   
-- WHEN year(desde) = year(getdate()) - 1 and year(hasta) = year(getdate()) THEN                  
--        convert(smalldatetime,''01/01/''+ convert(char(4),year(getdate())))    
-- --end    
-- ELSE  
-- desde  
-- END desde,     
--    
--CASE WHEN (year(desde) = year(getdate()) OR year(desde) = year(getdate()) - 1)  and year(hasta) = year(getdate()) THEN                  
--  hasta                  
---- ELSE CASE   
--WHEN year(desde) = year(getdate()) and year(hasta) = year(getdate()) + 1 THEN                  
--        convert(smalldatetime,''31/12/''+ convert(char(4),year(getdate())))    
-- --end  
--ELSE  
-- hasta    
-- END hasta,    
   
from dbo.Licencias_Solicitadas      
where id_interna = @id_interna     
 and concepto = 2 --10A    
 and desde > @desde
 and hasta < @hasta

UPDATE #tempo    
SET dias =  DATEDIFF(day, desde, hasta) +1     
    

--MUESTRO TODOS PARA 10C
insert into #tempo    
Select Concepto,    
 desde,    
 hasta,     
 Dias_A_Tomar    
from dbo.Licencias_Solicitadas      
where id_interna = @id_interna     
and Concepto = 4  --10C  
     
    
delete from #tempo where dias is null    
    
select concepto, sum(dias) dias
from #tempo    
group by concepto  
  ' 
END
GO
/****** Object:  Table [dbo].[ASIS_Partes_Pendientes]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Partes_Pendientes]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ASIS_Partes_Pendientes](
	[Id_Area] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[Presentado] [bit] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[WEB_Passwords_ADD]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_Passwords_ADD]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

create procedure [dbo].[WEB_Passwords_ADD]
 @idUsuario smallint,
 @password varchar(150)
AS
INSERT INTO dbo.WEB_Passwords
VALUES (@idUsuario, @password)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[adm_buscar_string]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[adm_buscar_string]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROC [dbo].[adm_buscar_string]  
@string varchar(50),  
@asignado char(1) = NULL, /*ROP-> Para que consulte solo los asignados a algun modulo .*/  
@modu char(6) = NULL  
as  
IF substring(@string,1,1) <> ''%''   
SELECT @string = ''%'' + @string  
IF right(@string,1) <> ''%''   
select @string = @string + ''%''  
if isnull(@asignado,''N'') = ''N''  
            SELECT distinct so.name   
            FROM sysobjects so, syscomments sc  
            WHERE so.id = sc.id  
  
            AND sc.text like @string  
  
            order by so.name  
  
else  
  
            /*SP*/  
  
            SELECT distinct so.name   
  
            FROM sysobjects so, syscomments sc ,  opcion_permi p  
  
            WHERE so.id = sc.id  
  
            AND sc.text like @string  
  
            AND so.name = p.obje  
  
            AND so.type != ''TR''  
  
            and (p.siste = @modu or @modu is null)  
  
   
  
            union  
  
            /*Triggers*/  
  
            SELECT distinct so.name   
  
            FROM sysobjects so, syscomments sc, tablas t  
  
            WHERE so.id = sc.id  
  
            AND sc.text like @string  
  
            AND object_name(so.parent_obj) = t.tabla  
  
            AND so.type = ''TR''  
  
            and (t.modu = @modu or @modu is null)  
  
  



' 
END
GO
/****** Object:  Table [dbo].[Tabla_Certificados_Antiguedad]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Certificados_Antiguedad]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Certificados_Antiguedad](
	[Id] [smallint] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[Baja] [bit] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  UserDefinedFunction [dbo].[FxMontos_Facturas]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[FxMontos_Facturas]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'


create    FUNCTION [dbo].[FxMontos_Facturas] (@legajo int, @año int)

	RETURNS varchar(5000)

AS  
BEGIN 
declare @i int
declare @cadena varchar (5000)
set @i=1
set @cadena=''''

while @i <= 12
	 begin
	if (select mes_factura from cfacturas where mes_factura =@i and legajo = @legajo and año_factura =@año)is null 
		select @cadena = @cadena + ''0'' +'',''
	else
		select @cadena = @cadena +convert(varchar, (select monto from cfacturas where mes_factura =@i and legajo = @legajo and año_factura =@año) ) +'',''	
	
	set @i = @i + 1
	end 

	RETURN @CADENA

END








' 
END
GO
/****** Object:  Table [dbo].[Tabla_Tipos_Contratos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Tipos_Contratos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Tipos_Contratos](
	[Id] [smallint] NOT NULL,
	[Descripcion] [varchar](50) NULL,
	[SendLegajos] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Tipos_Contratos] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Cred_LugaresDeTrabajo]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Cred_LugaresDeTrabajo]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Cred_LugaresDeTrabajo](
	[id] [smallint] IDENTITY(1,1) NOT NULL,
	[OficinaN] [int] NOT NULL,
	[Denominacion] [varchar](250) NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Estudios_Areas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Areas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Estudios_Areas](
	[id] [smallint] NULL,
	[Descripcion] [varchar](200) NULL,
	[Baja] [bit] NULL,
 CONSTRAINT [IX_Tabla_Estudios_Areas] UNIQUE NONCLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[PLA_GET_Impresion_Recibos_Haberes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_GET_Impresion_Recibos_Haberes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[PLA_GET_Impresion_Recibos_Haberes]                 
                    
--@Mes smallint,                    
--@Año smallint,                  
 @CodigoArea varchar(24) =NULL,                
 @liquidacion int = null,    
 @Impresos bit = NULL,    
 @orden int = 1,                
 @Documento int = null  
AS                    
          
set nocount on          
    
create table #t          
(          
Id_Recibo int,                     
apellido varchar(100),                
nombre varchar(100),                
Id_interna int,            
nro_documento int,          
Area varchar(500),    
codigo_area char(24),    
Nro_Orden smallint,
DescripcionLiquidacion varchar(500)       
)          
          
insert into #t          
SELECT   distinct Id_Recibo,                    
 Dp.Apellido ,    
 DP.Nombre ,                
 R.Id_interna,          
 dp.nro_documento,          
 NULL,    
 NULL,    
 Nro_Orden,
convert(char(4),RM.año) +''/''+ convert(char(2),RM.mes) +'' - ''+ RM.descripcion DescripcionLiquidacion

         
FROM dbo.PLA_Recibos R                    
INNER JOIN dbo.PLA_Recibos_Migrados RM
	ON RM.Liquidacion = R.Liquidacion
 inner JOIN dbo.Datos_Personales DP                    
  on right(left(dp.Cuil_Nro,10),8) =  right(left(R.cuil,11),8)   -- on DP.Id_Interna = R.Id_Interna                    
        
WHERE   --(Mes = @Mes) AND                    
        --(Año = @Año) AND          
 (R.liquidacion = @liquidacion or @liquidacion is null)    
    AND (R.Impreso = @Impresos OR @Impresos IS NULL)                
AND (dp.Nro_documento = @Documento OR @Documento IS NULL)  
    
Update t          
set Area = TA.Descripcion,    
    codigo_area =   ea.codigo    
from #t t          
          
INNER JOIN dbo.VW_Desglose_Area DA                
 ON DA.Documento = t.Nro_Documento                
INNER JOIN dbo.Tabla_Areas TA                
 on TA.Id = DA.Id_Area        
INNER JOIN dbo.Tabla_Areas_Estructura ea        
 on TA.Id = ea.Id_area        
    
where (DA.Id_Area in (select distinct id_Area FROM dbo.Tabla_Areas_Estructura AE                
   WHERE (AE.Codigo = @codigoarea AND right(@CodigoArea,5) <> ''00000'') OR                
   (left(AE.Codigo,19) = left(@codigoArea,19) AND right(@CodigoArea,5) = ''00000'') ) OR @CodigoArea IS NULL)          
          
          
IF @orden = 1     
BEGIN    
 select  Id_Recibo ,                     
 Apellido +'', ''+ Nombre Agente,              
 Id_interna int,            
 Area,    
 codigo_area,    
 Nro_Orden ,
DescripcionLiquidacion         
 from #t                
 ORDER BY Id_Recibo --Fabian: 31/10/2008 --> R.Id_interna                   
END       
               
    
IF @orden = 2    
BEGIN    
 select  Id_Recibo ,                     
 Apellido +'', ''+ Nombre Agente,    
 Id_interna int,            
 Area,    
 codigo_area,    
 Nro_Orden ,
DescripcionLiquidacion         
 from #t                
 ORDER BY Apellido, Nombre     
END       
    
IF @orden = 3    
BEGIN    
 select  Id_Recibo ,                     
 Apellido +'', ''+ Nombre Agente,    
 Id_interna int,            
 Area,    
 codigo_area,    
 Nro_Orden  ,
DescripcionLiquidacion        
 from #t                
 ORDER BY codigo_area, apellido, nombre     
END       
    
                
              
            
          
          
          
        
      
    
  
  




' 
END
GO
/****** Object:  Table [dbo].[Tabla_Estudios_Especialidades]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Especialidades]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Estudios_Especialidades](
	[id] [int] NULL,
	[Descripcion] [varchar](200) NULL,
	[Baja] [bit] NULL,
 CONSTRAINT [IX_Tabla_Estudios_Especialidades] UNIQUE NONCLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CTR_ADD_Antiguedad_Certificado_Asignacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ADD_Antiguedad_Certificado_Asignacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create procedure [dbo].[CTR_ADD_Antiguedad_Certificado_Asignacion]
	@Idcertificado int,
	@IdContrato int,
	@Usuario smallint
AS
UPDATE  dbo.CTR_Antiguedad_Certificados
SET 	IdContrato = @IdContrato,
	FechaAsignacion = getdate(),
	UsuarioAsignacion = @Usuario
WHERE IdCertificado = @IdCertificado
	
' 
END
GO
/****** Object:  Table [dbo].[Tabla_Nomina_Bancos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Nomina_Bancos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Nomina_Bancos](
	[Codigo] [int] NULL,
	[Descripcion] [varchar](100) NULL,
	[Nro_Cta_Empresa] [varchar](20) NULL,
	[Baja] [smallint] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CTR_ADD_Antiguedad_Certificados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ADD_Antiguedad_Certificados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[CTR_ADD_Antiguedad_Certificados]  
	@IdCalculo int,
	@Nivel varchar(5),
	@Grado varchar(5),
	@Funcion varchar(200),
	@FechaCertificado smalldatetime,
	@Antiguedad smallint,
	@TipoCertificado smallint
AS
set nocount on
INSERT INTO dbo.CTR_Antiguedad_Certificados 
(IdCalculo, Nivel, Grado, Funcion, FechaCertificado, Antiguedad, TipoCertificado)
VALUES (@IdCalculo, @Nivel, @Grado, @Funcion, @FechaCertificado, @Antiguedad, @TipoCertificado)

select max(IdCertificado) IdCertificado from dbo.CTR_antiguedad_Certificados
' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_DEL_Desglose_FE]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_DEL_Desglose_FE]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[LEG_DEL_Desglose_FE]
	@Id_Interna int,
	@Documento int,
	@Acto_tipo_Baja smallint,
	@Acto_Nro_Baja varchar(10),
	@Acto_Fecha_Baja datetime,
	@Usuario smallint
AS
UPDATE dbo.LEG_Desglose_FE 
SET 	baja =1,
	acto_tipo_baja = @Acto_tipo_baja,
	acto_nro_baja = @acto_nro_baja,
	acto_fecha_baja = @acto_fecha_baja,
	hasta = case when hasta is null then getdate() else hasta end,
	usuario = @Usuario
where	documento =@documento and
	baja =0	



' 
END
GO
/****** Object:  Table [dbo].[Tabla_Estudios_Facultades]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Facultades]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Estudios_Facultades](
	[id] [int] NULL,
	[descripcion] [varchar](200) NULL,
	[Baja] [bit] NULL,
 CONSTRAINT [IX_Tabla_Estudios_Facultades] UNIQUE NONCLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO

/****** Object:  StoredProcedure [dbo].[CTR_GET_Contratos_Tramite]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Contratos_Tramite]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE  PROCEDURE [dbo].[CTR_GET_Contratos_Tramite]            
             
 @Area_Real int = null,            
 @Area_Cont int = null,            
 @Contrato int = null,            
 @Exp varchar(30) = null,        
 @fecha smalldatetime = null,         
 @orden char(1) = 1,      
 @Sin_Imp int = null,      
 @sin_Firma int = null,       
 @Sin_Exp int = null , 
 @IdUsuario smallint = null   --GER-110711    
            
AS            
SET NOCOUNT ON            
            
 create table #t            
  (nro_contrato varchar(11))            
             
 insert into #t            
 select max(nro_contrato)             
 from dbo.ctr_contratos c              
 where Aprobado=0  and            
  Baja=0 and            
  (c.id_area = @Area_Cont or @Area_Cont is null) and            
  (tipo_contrato = @Contrato  or @Contrato is null) and             
  (exp_nro = @Exp  or @Exp is null)              
 group by nro_documento            
         
------GER-110711 Filtro por area del usuario
DELETE #t
where nro_contrato not in (
	select  t.nro_contrato
	from #t t
	INNER JOIN ctr_contratos c
	ON c.nro_contrato = t.nro_contrato  
	INNER JOIN dbo.VW_Desglose_Area DA    
	on DA.Documento = c.Nro_Documento     
	INNER JOIN dbo.RH_Usuarios_Areas UA    
	on UA.Id_Usuario = @IdUsuario AND    
	(UA.Id_Area = DA.Id_Area or Ua.id_area = 0))
------GER-110711        

create table #tempo            
(Id_Contrato int,                    
 nro_documento int,                    
 Apellido varchar(100),                    
 Nombre varchar(100),                     
 Id_Area_Contrato int ,                    
 Area_Contrato varchar(400),                    
 Id_Area_Real int,                    
 Area_Real varchar(400),                    
 Id_tipo_Contrato int,                    
 Tipo_Contrato varchar(100),                     
 Desde smalldatetime,                    
 Hasta smalldatetime,                    
 id_nivel int,                    
 nivel char(1),                    
 Id_grado int,                    
 grado char(2),                            
 Id_Funcion int,                    
 Funcion varchar(100),                    
 id_rango int,                    
 Rango varchar(100),                    
 monto money,                            
 Reservado char(2),                          
 nro_contrato char(11),                    
 Estado char(1),                    
 Id_domicilio int,                    
 contrato_firmante int,                    
 observacion varchar(300),                    
 firmante varchar(300),                    
 impreso bit,      
 firmado bit,      
 exp_nro varchar(30),      
 Alta_Prov_Leg bit,          
 Usua_Alta_Prov_Leg smallint,           
 Fecha_Alta_Prov_Leg smalldatetime,      
 baja bit)                   
       
insert into #Tempo          
select        
 C.Id_Contrato,            
 C.nro_documento,            
 DP.Apellido,            
 DP.Nombre,            
 c.id_area Id_Area_Contrato,            
 ''null'' Area_Contrato, --TA.descripcion Area_Contrato,            
  null Id_Area_Real,  --da.id_area Id_Area_Real,            
 ''null'' Area_Real,     --TA2.descripcion Area_Real,            
 TC.id Id_tipo_Contrato,            
 TC.descripcion Tipo_Contrato,             
 convert (char(10), C.[Desde],103) Desde ,            
 convert (char(10), C.[Hasta],103) Hasta,            
 c.nivel id_nivel,            
 tn.nivel,            
 c.grado Id_grado,            
 tg.grado,            
 c.funcion Id_Funcion,            
 fc.descripcion Funcion,            
 c.rango id_rango,            
 r.Descripcion Rango,            
 c.monto,            
 case when c.reservado=1 then            
  ''SI''            
 else            
  ''NO''            
 end Reservado,            
 c.nro_contrato,            
 c.Estado,            
 d.Id_domicilio,            
 c.contrato_firmante,            
 c.observacion,            
 dpf.apellido firmante,            
 c.impreso,            
 c.firmado,            
 c.exp_nro,          
 c.Alta_Prov_Leg,          
 c.Usua_Alta_Prov_Leg,           
 c.Fecha_Alta_Prov_Leg,      
 c.baja            
        
From  dbo.CTR_Contratos C            
            
left join dbo.tabla_funciones_contratos FC  --1184            
 on fc.id=c.funcion            
            
inner join dbo.Datos_Personales DP            
 on DP.nro_documento = C.nro_documento            
            
LEFT join dbo.domicilio_personal D            
 on d.nro_doc=c.nro_documento and d.id_domicilio = (select max(id_domicilio) from domicilio_personal where nro_doc = c.nro_documento)            
            
left join dbo.Tabla_Resoluciones_Contratos TC            
 on TC.id = C.tipo_contrato            
            
-- -- -- -- -- LEFT join dbo.tabla_areas TA                      
-- -- -- -- --  on TA.id = c.id_area                             
-- -- -- -- -- LEFT join dbo.vw_desglose_area da                      
-- -- -- -- --  on da.documento  = c.nro_documento                            
-- -- -- -- -- LEFT join dbo.tabla_areas TA2                      
-- -- -- -- --  on TA2.id = da.id_area                      
                      
-- -- -- -- -- --left join dbo.cfirmantes_contratos cfc                      
-- -- -- -- -- -- on cfc.id=C.Contrato_Firmante                
      
LEFT join dbo.Tabla_Firmantes cfc                  
 on cfc.id = C.Contrato_Firmante                  
LEFT join dbo.datos_personales DPF                  
 on cfc.nro_documento=DPF.nro_documento             
            
left join dbo.tabla_niveles TN            
 on tn.id=c.nivel            
            
left join dbo.tabla_grados TG            
 on tg.id=c.grado            
            
left join dbo.tabla_grado_letras TGL            
 on tgl.grado=tg.grado            
            
left join dbo.ccontrato_funciones CCF  --1421            
 on ccf.id_nivel=tn.id            
            
left join dbo.tabla_rangos R            
 on r.id=c.rango            
            
INNER JOIN #t t            
 on t.nro_contrato = c.nro_contrato            
            
--Where (da.id_area = @area_real or @area_real is null)              
--AND (c.desde >= @fecha or @fecha is null)                   
--AND C.Baja  = 0     -- MLD: 22-01-07             
            
      
update #tempo              
set   Area_Contrato = TA.descripcion,                      
   Id_Area_Real = da.id_area,                      
   Area_Real = TA2.descripcion              
from #tempo t              
              
LEFT join dbo.tabla_areas TA                      
 on TA.id = t.Id_Area_Contrato                     
              
LEFT join dbo.vw_desglose_area da                      
 on da.documento  = t.nro_documento                     
                      
LEFT join dbo.tabla_areas TA2                      
 on TA2.id = da.id_area           
      
      
      
IF @orden=1        
BEGIN        
  select *       
  from #tempo        
  Where   (Id_Area_Real = @area_real or @area_real is null)              
      AND (desde >= @fecha or @fecha is null)                   
      AND  Baja  = 0     -- MLD: 22-01-07        
      AND (impreso = @sin_imp or @sin_imp is null)      
      AND (firmado = @sin_firma or @sin_firma is null)      
      AND((Exp_nro IS NULL and @Sin_Exp = 0) OR      
   (Exp_nro iS NOT NULL And @Sin_Exp = 1) OR       
   (@Sin_exp IS NULL))                 
  order by Apellido, Nombre             
END        
        
IF @orden=2        
BEGIN        
  select *       
  from #tempo        
  Where   (Id_Area_Real = @area_real or @area_real is null)              
      AND (desde >= @fecha or @fecha is null)                   
      AND  Baja  = 0     -- MLD: 22-01-07             
      AND (impreso = @sin_imp or @sin_imp is null)      
      AND (firmado = @sin_firma or @sin_firma is null)       
           AND((Exp_nro IS NULL and @Sin_Exp = 0) OR      
   (Exp_nro iS NOT NULL And @Sin_Exp = 1) OR       
   (@Sin_exp IS NULL))           
  order by  Id_Area_Real, Apellido, Nombre             
END        
        
IF @orden=3        
BEGIN        
 select *       
 from #tempo        
 Where   (Id_Area_Real = @area_real or @area_real is null)              
  AND (desde >= @fecha or @fecha is null)                   
  AND  Baja  = 0     -- MLD: 22-01-07         
         AND (impreso = @sin_imp or @sin_imp is null)      
         AND (firmado = @sin_firma or @sin_firma is null)       
       AND((Exp_nro IS NULL and @Sin_Exp = 0) OR      
   (Exp_nro iS NOT NULL And @Sin_Exp = 1) OR       
   (@Sin_exp IS NULL))         
  order by Id_Area_Contrato, Apellido, Nombre             
END        
        
        
drop table #t            
drop table #tempo            
      
    
    ' 
END
GO
/****** Object:  Table [dbo].[Tipo_de_Planta]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tipo_de_Planta]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tipo_de_Planta](
	[Id] [smallint] NOT NULL,
	[Descripcion] [varchar](50) NULL,
	[baja] [bit] NOT NULL,
	[Tipo] [char](1) NULL,
	[firma_recibos] [bit] NULL,
 CONSTRAINT [PK_Tipo_de_Planta] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[MED_Apto_Medico]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_Apto_Medico]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[MED_Apto_Medico](
	[IdApto] [int] IDENTITY(1,1) NOT NULL,
	[IdTipoApto] [smallint] NOT NULL,
	[Nro_Documento] [int] NOT NULL,
	[Desde] [smalldatetime] NOT NULL,
	[Cant_Dias] [smallint] NOT NULL,
	[Observaciones] [varchar](300) NULL,
	[Obs_Discapacidad] [varchar](255) NULL,
	[Id_Discapacidad] [int] NULL,
	[Porcen_Discapacidad] [int] NULL,
	[Baja] [bit] NOT NULL,
	[IdUsuario] [smallint] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Parentesco]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Parentesco]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Parentesco](
	[Id] [smallint] NOT NULL,
	[Descripcion] [nvarchar](50) NOT NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Parentesco] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Relacion_Funcion_Nivel]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Relacion_Funcion_Nivel]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Relacion_Funcion_Nivel](
	[IdNivel] [smallint] NOT NULL,
	[IdFuncion] [smallint] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  View [dbo].[VW_Tabla_Areas_Estructura]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Areas_Estructura]'))
EXEC dbo.sp_executesql @statement = N'


CREATE   VIEW [dbo].[VW_Tabla_Areas_Estructura]
AS
SELECT     TOP 100 PERCENT codigo, Descripcion, id_area
FROM         dbo.Tabla_Areas_Estructura
WHERE     (Baja = 0)
ORDER BY codigo



'
GO
/****** Object:  Table [dbo].[Tabla_Moneda_Banco]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Moneda_Banco]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Moneda_Banco](
	[Id_Banco] [int] NULL,
	[Id_Moneda] [int] NULL,
	[Descripcion] [varchar](20) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Contratos_Aprobados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Contratos_Aprobados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CTR_GET_Contratos_Aprobados]
	
	@Area_Real int=null,
	@Area_Cont int=null,
	@Contrato int=null

AS
SET NOCOUNT ON

	create table #t
		(nro_contrato varchar(11))
	
	insert into #t
	select max(nro_contrato) 
	from dbo.ctr_contratos 
	where	Aprobado=1  and
		Baja=0 and
		(id_area = @Area_Cont or @Area_Cont is null) and
		(tipo_contrato = @Contrato  or @Contrato is null) 
	group by nro_documento
	


select  --C.Id_Contrato,
	C.nro_documento Documento,
	DP.Apellido,
	DP.Nombre,
	c.id_area Id_Area_Contrato,
	TA.descripcion Area_Contrato,
	da.id_area Id_Area_Real,
	TA2.descripcion Area_Real,
--	TC.id Id_tipo_Contrato,
	TC.descripcion [Tipo Contrato],	

	convert (char(10), C.[Desde],103) Desde ,
	convert (char(10), C.[Hasta],103) Hasta,

--	c.nivel id_nivel,
	tn.nivel Nivel,
--	c.grado Id_grado,
	tg.grado Grado,
	
--	c.funcion Id_Funcion,
	fc.descripcion Funcion,
--	c.rango id_rango,
	r.Descripcion Rango,
	c.monto Monto,
	
	case when c.reservado=1 then
		''SI''
	else
		''NO''
	end Reservado,

	c.nro_contrato [Nro Contrato],
	c.Estado,
--	d.Id_domicilio,
--	c.contrato_firmante,
	c.observacion Observacion,
	cfc.apellido Firmante,
	case when c.impreso=1 then
		''SI''
	else
		''NO''
	end Impreso,
	case when c.firmado=1 then
		''SI''
	else
		''NO''
	end Firmado,
	c.exp_nro [Nro Expediente]


From  dbo.CTR_Contratos	C

left join dbo.tabla_funciones_contratos FC  --1184
	on fc.id=c.funcion

inner join dbo.Datos_Personales DP
	on DP.nro_documento = C.nro_documento

LEFT join dbo.domicilio_personal D
	on d.nro_doc=c.nro_documento and d.id_domicilio = (select max(id_domicilio) from domicilio_personal where nro_doc = c.nro_documento)

left join dbo.Tabla_Resoluciones_Contratos TC
	on TC.id = C.tipo_contrato

LEFT join dbo.tabla_areas TA
	on TA.id = c.id_area

LEFT join dbo.vw_desglose_area da
	on c.nro_documento = da.documento

LEFT join dbo.tabla_areas TA2
	on TA2.id = da.id_area

left join dbo.cfirmantes_contratos cfc
	on cfc.id=C.Contrato_Firmante

left join dbo.tabla_niveles TN
	on tn.id=c.nivel

left join dbo.tabla_grados TG
	on tg.id=c.grado

left join dbo.tabla_grado_letras TGL
	on tgl.grado=tg.grado

left join dbo.ccontrato_funciones CCF  --1421
	on ccf.id_nivel=tn.id

left join dbo.tabla_rangos R
	on r.id=c.rango

INNER JOIN #t t
	on t.nro_contrato = c.nro_contrato

Where  	(da.id_area = @area_real or @area_real is null)  
	
order by DP.Apellido, dp.nombre 

drop table #t
' 
END
GO
/****** Object:  View [dbo].[WEB_Tabla_Conceptos_Licencias]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[WEB_Tabla_Conceptos_Licencias]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[WEB_Tabla_Conceptos_Licencias]
as

SELECT 	nro_articulo [Articulo], 
	concepto [Concepto], 
	[Descripcion], 
	[Dias_Autorizados], 
	id_concepto [Id], 
	[Acumulativa] 
FROM dbo.Tabla_Conceptos_Licencias

'
GO
/****** Object:  Table [dbo].[Designaciones]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Designaciones]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Designaciones](
	[Jurisdiccion] [varchar](50) NOT NULL,
	[Organismo] [varchar](50) NOT NULL,
	[Area] [int] NULL,
	[Acto_Tipo] [smallint] NOT NULL,
	[Acto_Nro] [varchar](10) NOT NULL,
	[Acto_Fecha] [datetime] NOT NULL,
	[Motivo] [int] NOT NULL,
	[Folio] [char](10) NOT NULL,
	[Id_Planta] [smallint] NULL,
	[Id_Grado] [smallint] NULL,
	[Id_Cargo] [smallint] NULL,
	[Id_Interna] [int] NOT NULL,
	[Nro_Doc] [int] NOT NULL,
	[Fecha_desde] [datetime] NOT NULL,
	[Fecha_hasta] [datetime] NULL,
	[Id_Designacion] [int] NOT NULL,
	[Id_Nivel] [smallint] NULL,
	[Tipo_Designacion] [int] NOT NULL,
	[Usuario] [smallint] NULL,
	[DatoDeBaja] [bit] NULL,
	[DatoNoImprime] [bit] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[tmp_autorizaciones_licencias]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[tmp_autorizaciones_licencias]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[tmp_autorizaciones_licencias](
	[id_interna] [int] NULL,
	[dias_autorizados] [int] NULL,
	[id_concepto_licencia] [int] NULL,
	[periodo] [int] NULL,
	[id] [int] NULL,
	[dias_tomados] [int] NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_UPD_Antiguedad_Certificado_Impreso]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_UPD_Antiguedad_Certificado_Impreso]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

create procedure [dbo].[CTR_UPD_Antiguedad_Certificado_Impreso]
	@IdCertificado int
As
UPDATE dbo.CTR_Antiguedad_Certificados
SET Impreso = 1
WHERE IdCertificado = @IdCertificado

' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_GET_IdNivel_Fecha]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_GET_IdNivel_Fecha]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_GET_IdNivel_Fecha]  (@id_interna int, @fecha datetime)  
RETURNS  int  AS  
BEGIN 

Return (	SELECT TOP 1	Id_Nivel
	FROM dbo.leg_desglose_NivelGrado 
	WHERE Id_interna = @Id_interna and  desde <=  @fecha
	Order by desde desc)


END

' 
END
GO
/****** Object:  Table [dbo].[Tabla_Estudios_Tipo_Maquina]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Tipo_Maquina]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Estudios_Tipo_Maquina](
	[Id] [smallint] NOT NULL,
	[Descripcion] [varchar](50) NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Estudios_Tipo_Maquina] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Modulos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Modulos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Modulos](
	[Id] [smallint] NOT NULL,
	[Caption] [varchar](50) NULL,
	[Descripcion] [char](20) NULL,
 CONSTRAINT [PK_Modulos] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[EVAL_Evaluaciones]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_Evaluaciones]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[EVAL_Evaluaciones](
	[id_evaluacion] [int] IDENTITY(1,1) NOT NULL,
	[fecha] [smalldatetime] NOT NULL,
	[id_evaluado] [int] NOT NULL,
	[id_evaluador] [int] NOT NULL,
	[id_formulario] [smallint] NOT NULL,
	[id_Periodo] [int] NOT NULL,
	[estado] [smallint] NOT NULL,
	[baja] [bit] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[EVAL_Evaluaciones_Detalle]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_Evaluaciones_Detalle]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[EVAL_Evaluaciones_Detalle](
	[id_evaluacion] [int] NOT NULL,
	[id_pregunta] [smallint] NOT NULL,
	[opcion_elegida] [smallint] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Tabla_Configuracion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Tabla_Configuracion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Tabla_Configuracion]

as

select * 
from CTR_Tabla_Configuracion



' 
END
GO
/****** Object:  Table [dbo].[Tabla_Estudios_Titulos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Titulos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Estudios_Titulos](
	[id] [int] NOT NULL,
	[Descripcion] [varchar](200) NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Estudios_Titulos] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY],
 CONSTRAINT [IX_Tabla_Estudios_Titulos] UNIQUE NONCLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[RPT_PLA_Recibo_Impresion]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_PLA_Recibo_Impresion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create procedure [dbo].[RPT_PLA_Recibo_Impresion]
	@Id_Recibo int
AS
UPDATE dbo.PLA_Recibos
SET Impreso = 1
WHERE Id_Recibo = @Id_Recibo

' 
END
GO
/****** Object:  Table [dbo].[Tabla_Temporal_Dotacion_Completa]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Temporal_Dotacion_Completa]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Temporal_Dotacion_Completa](
	[id_interna] [numeric](18, 0) NULL,
	[nro_documento] [numeric](18, 0) NULL,
	[id_Planta] [int] NULL,
	[Id_Designacion_Planta] [int] NULL,
	[id_area] [int] NULL,
	[id_nivel] [int] NULL,
	[id_grado] [smallint] NULL,
	[Id_Contrato] [numeric](18, 0) NULL,
	[hostId] [numeric](18, 0) NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[Get_Area_Agente]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Get_Area_Agente]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[Get_Area_Agente] 
@id_interna  int 
AS
SELECT id_area 
FROM dbo.VW_Desglose_Area 
WHERE id_interna = @id_interna 




' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_PLA_Recibos_Haberes_Detalle]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_PLA_Recibos_Haberes_Detalle]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[RPT_PLA_Recibos_Haberes_Detalle]           
@Id_Recibo int          
AS          
SET NOCOUNT ON      
    
Create table #Temp      
( 
Concepto varchar(20),      
Aporte float,      
Descuento float,      
Descripcion varchar(200)
)      
       
INSERT INTO #Temp            
SELECT               
 rtrim(Concepto) +''  ''+ rtrim(TipoConcepto) Concepto,         
      
 CASE WHEN Aporte = 0 THEN        
  null    
 ELSE        
  rtrim(Aporte)        
 END Aporte,         
         
 CASE WHEN Descuento = 0 THEN        
  null      
 ELSE        
  rtrim(Descuento)         
 END Descuento,         
      
CASE 
	when rtrim(Concepto) = ''276'' then OS.SIGLA      
	when rtrim(Concepto) +''  ''+ rtrim(TipoConcepto) = ''121  P'' then ''HORAS EXTRAS 50%''
	when rtrim(Concepto) +''  ''+ rtrim(TipoConcepto) = ''121  T'' then ''HORAS EXTRAS 100%''
	else  
  CR.Descripcion         
END Deescripcion   
        
FROM dbo.PLA_Recibos_Detalle   RD        
LEFT JOIN dbo.Tabla_Conceptos_Recibos CR        
 on CR.Codigo = RD.Concepto        
      
LEFT JOIN dbo.Datos_Personales DP      
 ON DP.Id_Interna = RD.Id_interna      
LEFT JOIN dbo.LEG_ObraSocial LOS      
 ON LOS.Documento = DP.Nro_Documento AND      
     LOS.bBaja = 0 AND       
    Habilitada_ReciboHaberes = 1      
LEFT JOIN GEN_ObraSocial OS       
 ON OS.id = LOS.idObraSocial       
       
WHERE Id_Recibo = @Id_Recibo          
ORDER BY cast(Concepto as int)      
      
    
declare @i int      
Declare @Agregar int      
set @Agregar =  20 - (select count(*) from #temp)      
      
      
set @i = 1      
while @i <=  @Agregar BEGIN      
 insert into #temp      
 select ''     '',NULL, NULL, NULL    
 set @i = @i +1      
END      

select * from #temp      
          
drop table #temp      
      
      
      
      
      
      
' 
END
GO
/****** Object:  Table [dbo].[CTR_Tabla_Configuracion]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Tabla_Configuracion]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CTR_Tabla_Configuracion](
	[Fecha_Impresion_Dia] [bit] NULL,
	[Fecha_Impresion] [smalldatetime] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[PLA_Certificantes_DDJJ]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_Certificantes_DDJJ]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[PLA_Certificantes_DDJJ](
	[Documento] [int] NOT NULL,
	[Certificante] [bit] NOT NULL,
	[NoCertificar] [bit] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Estudios_Universidades]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Universidades]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Estudios_Universidades](
	[id] [int] NOT NULL,
	[descripcion] [varchar](200) NOT NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Estudios_Universidades] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY],
 CONSTRAINT [IX_Tabla_Estudios_Universidades] UNIQUE NONCLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[PLA_Recibos_Detalle]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_Recibos_Detalle]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[PLA_Recibos_Detalle](
	[Id_Recibo] [int] NOT NULL,
	[Id_interna] [int] NOT NULL,
	[Mes] [smallint] NOT NULL,
	[Año] [smallint] NOT NULL,
	[Concepto] [nvarchar](50) NOT NULL,
	[Aporte] [float] NULL,
	[Descuento] [float] NULL,
	[TipoConcepto] [varchar](2) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[LEG_Certificados_Escolaridad]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Certificados_Escolaridad]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Certificados_Escolaridad](
	[Id_Interna] [int] NULL,
	[Id_Familiar] [int] NULL,
	[Nivel_Escolaridad] [smallint] NULL,
	[Tipo_Certificado] [varchar](50) NULL,
	[Fecha_Certificado] [datetime] NULL,
	[Fecha_Presentacion] [datetime] NULL,
	[Usuario] [smallint] NULL,
	[id] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  View [dbo].[VW_CON_Listado_Antiguedades]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/****** Object:  Table [dbo].[Historico_Tabla_Areas_Estructura]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Historico_Tabla_Areas_Estructura]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Historico_Tabla_Areas_Estructura](
	[Codigo] [char](24) NULL,
	[Id_area] [int] NULL,
	[Descripcion] [varchar](200) NULL,
	[Desde] [datetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Oficinas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Oficinas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Oficinas](
	[id] [smallint] NOT NULL,
	[descripcion] [varchar](50) NULL,
	[Baja] [bit] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Domicilio_Familiares]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Domicilio_Familiares]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Domicilio_Familiares](
	[Id_Interno] [int] NULL,
	[doc_titular] [int] NULL,
	[FechaComunicacion] [datetime] NULL,
	[Nro_Doc] [int] NULL,
	[Calle] [char](40) NULL,
	[Nro] [smallint] NULL,
	[Piso] [char](5) NULL,
	[Dpto] [char](5) NULL,
	[Casa] [char](5) NULL,
	[Manzana] [char](5) NULL,
	[Barrio] [char](40) NULL,
	[Torre] [varchar](10) NULL,
	[UF] [varchar](10) NULL,
	[Localidad] [varchar](50) NULL,
	[Codigo_postal] [varchar](50) NULL,
	[Partido_Dpto] [varchar](50) NULL,
	[Provincia] [varchar](50) NULL,
	[Telefono] [varchar](20) NULL,
	[Correo_Electronico] [varchar](50) NULL,
	[Folio] [char](10) NULL,
	[Orden] [int] NULL,
	[Grabado] [int] NULL,
	[ID_FAM] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[EVAL_Plantas_Periodos_Evaluacion]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_Plantas_Periodos_Evaluacion]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[EVAL_Plantas_Periodos_Evaluacion](
	[id_planta] [smallint] NOT NULL,
	[id_periodo] [int] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[PLA_Pases_Solicitados]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_Pases_Solicitados]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[PLA_Pases_Solicitados](
	[id] [int] NOT NULL,
	[id_interna] [int] NOT NULL,
	[Area_Actual] [int] NOT NULL,
	[Area_Nueva] [int] NOT NULL,
	[Fecha_Solicitud] [datetime] NOT NULL,
	[Estado] [smallint] NOT NULL,
	[Solicito] [smallint] NOT NULL,
	[Reviso] [smallint] NULL,
	[Fecha_Pase] [datetime] NOT NULL,
	[Motivo_Rechazo] [varchar](200) NULL,
	[RechazoImpreso] [bit] NOT NULL,
	[Ultima_Modificacion] [int] NULL,
 CONSTRAINT [PK_PLA_Pases_Solicitados] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[VIA_GetMediosDeTransporte]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[VIA_GetMediosDeTransporte]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author: German 
-- ALTER  date: 22/04/2009
-- Description:	Trae todas los medios de transporte
-- =============================================

CREATE PROCEDURE [dbo].[VIA_GetMediosDeTransporte]
	-- Add the parameters for the stored procedure here
AS
BEGIN
	SET NOCOUNT ON;
	SELECT 
		Id, Nombre
	FROM
		dbo.VIA_MediosDeTransporte
END


' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_GET_Recibos_Con_Diferencias]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_GET_Recibos_Con_Diferencias]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create PROCEDURE [dbo].[PLA_GET_Recibos_Con_Diferencias]  
 @liquidacion int  
as  
set nocount on  
  
CREATE TABLE #tempo  
(  
Id_Recibo int,  
Id_Interna int,  
mes smallint,  
año smallint,  
Cuil varchar(13),  
SBruto float,  
SDescuentos float,  
SNeto float,  
liquidacion int,  
DetalleBruto float,  
DetalleDescuento float,    
NetoCalculado float,  
NetoDetalleCalculado float  
)  
  
INSERT INTO #tempo  
SELECT RECIBOS.Id_Recibo,  
       RECIBOS.Id_Interna,  
       RECIBOS.mes,  
       RECIBOS.año,  
       RECIBOS.Cuil,  
  RECIBOS.SBruto,  
  RECIBOS.SDescuentos,  
  RECIBOS.SNeto,  
  RECIBOS.liquidacion,  
  sum (DETALLE.Aporte) as DetalleBruto,  
  sum (DETALLE.Descuento) as DetalleDescuento,    
  (RECIBOS.SBruto - RECIBOS.SDescuentos) as NetoCalculado,  
  sum (DETALLE.Aporte) - sum (DETALLE.Descuento) as NetoDetalleCalculado  
    
FROM dbo.PLA_Recibos RECIBOS  
LEFT JOIN dbo.PLA_Recibos_Detalle DETALLE  
 ON RECIBOS.Id_Recibo = DETALLE.Id_Recibo  
  
where RECIBOS.liquidacion = @liquidacion  
  
group by RECIBOS.Id_Recibo,  
  RECIBOS.Id_Interna,  
  RECIBOS.mes,  
  RECIBOS.SBruto,  
  RECIBOS.SDescuentos,  
  RECIBOS.SNeto,  
  RECIBOS.año,  
  RECIBOS.Cuil,  
  RECIBOS.liquidacion  
  
  
select *   
from #tempo  
where ((DetalleBruto - DetalleDescuento) - SNeto) > 0.1' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Desglose_FE]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Desglose_FE]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[LEG_ADD_Desglose_FE]
	@Id_Interna int,
	@Documento int,
	@Nivel_FE int,
	@Tipo_FE tinyint,
	@Desde datetime,
	@Hasta datetime=null,
	@Acto_tipo smallint,
	@Acto_Nro varchar(10),
	@Acto_Fecha datetime,
	@Usuario smallint,
	@Tratamiento smallint,
	@Id_area int
AS
DECLARE @Id int
SET @Id = (select max(id)+1 from dbo.LEG_Desglose_FE)
IF @Id is null BEGIN
	SET @Id = 1
END

INSERT INTO dbo.LEG_Desglose_FE 
	(id, 
	id_interna,
	documento,
	nivel_fe,
	tipo_fe,
	desde,
	hasta,
	acto_tipo,	acto_nro,
	acto_fecha,
	usuario,
	Tratamiento,
	Id_Area)
VALUES	(@id,
	@id_interna,
	@Documento,
	@Nivel_FE,
	@Tipo_Fe,
	@Desde,
	@Hasta,
	@Acto_tipo,
	@Acto_nro,
	@Acto_fecha,
	@Usuario,
	@Tratamiento,
	@Id_Area)






' 
END
GO
/****** Object:  StoredProcedure [dbo].[ESTR_GET_ReIncorporar_Areas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ESTR_GET_ReIncorporar_Areas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[ESTR_GET_ReIncorporar_Areas]
AS	
SELECT	TA.Descripcion, 
	TA.Id_area,
	TTR.Descripcion Acto_Tipo,
	TA.Acto_Nro,
	TA.Acto_Fecha
FROM dbo.Tabla_Areas_Estructura TA
INNER JOIN dbo.Tabla_Tipos_Resoluciones TTR
	on TTR.Id = TA.Acto_Baja
WHERE TA.Baja = 1
	


' 
END
GO
/****** Object:  Table [dbo].[MED_Atenciones_Practicas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_Atenciones_Practicas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[MED_Atenciones_Practicas](
	[IdAtencion] [int] NULL,
	[IdPractica] [int] NULL,
	[Baja] [bit] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[VIA_GetZonas]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[VIA_GetZonas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin 
-- Create date: 22/04/2009
-- Description:	Trae Todas las Zonas
-- =============================================
CREATE PROCEDURE [dbo].[VIA_GetZonas]
	-- Add the parameters for the stored procedure here
AS
BEGIN
	SET NOCOUNT ON;
	SELECT 
		Id, Nombre
	FROM
		dbo.VIA_Zonas
	ORDER BY 
		Nombre
END

' 
END
GO
/****** Object:  Table [dbo].[EVAL_SubEvaluadores]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_SubEvaluadores]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[EVAL_SubEvaluadores](
	[idEvaluador] [int] NOT NULL,
	[idSubEvaluador] [int] NOT NULL,
	[idPeriodo] [int] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_ADD_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ADD_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[CTR_ADD_Contratos]
	(@Id_Domicilio_2 	[int]=NULL,
	 @Nro_Documento_3 	[int]=NULL,
	 @Tipo_Contrato_4 	[smallint]=NULL,
	 @Nro_Contrato_5 	[char](11)=NULL,
	 @Desde_6 	[smalldatetime]=NULL,
	 @Hasta_7 	[smalldatetime]=NULL,
	 @Nivel_8 	[smallint]=NULL,
	 @Grado_9 	[smallint]=NULL,
	 @Funcion_10 	[smallint]=NULL,
	 @Rango_11 	[smallint]=NULL,
	 @Monto_12 	[money]=NULL,
	 @Id_Area_13 	[int]=NULL,
	 @Contrato_Firmante_24 	[smallint]=NULL,
	 @Excepcion_26 	[bit]=NULL,
	 @Enmienda_27 	[bit]=NULL,
	 @Observacion_31 	[varchar](200)=NULL,
	 @Estado_32 	[char](1)=NULL,
	@Conserva_Area bit=NULL,
	@Usuario smallint=NULL,
	@Salvado bit=0)

AS 
Declare	 @Id_Contrato_1 [int]
set  @Id_Contrato_1 = (select max(Id_Contrato)+1 from  [dbo].[CTR_Contratos] )		
if @Id_Contrato_1 is null begin
	set @Id_Contrato_1 =1
end

INSERT INTO [dbo].[CTR_Contratos] 
	 ( [Id_Contrato],
	 [Id_Domicilio],
	 [Nro_Documento],
	 [Tipo_Contrato],
	 [Nro_Contrato],
	 [Desde],
	 [Hasta],
	 [Nivel],
	 [Grado],
	 [Funcion],
	 [Rango],
	 [Monto],
	 [Id_Area],
	 [Contrato_Firmante],
	 [Excepcion],
	 [Enmienda],
	 [Observacion],
	 [Estado],
	Conserva_Area,
	Usuario) 
 
VALUES 
	( @Id_Contrato_1,
	 @Id_Domicilio_2,
	 @Nro_Documento_3,
	 @Tipo_Contrato_4,
	 @Nro_Contrato_5,
	 @Desde_6,
	 @Hasta_7,
	 @Nivel_8,
	 @Grado_9,
	 @Funcion_10,
	 @Rango_11,
	 @Monto_12,
	 @Id_Area_13,
	 @Contrato_Firmante_24,
	 @Excepcion_26,
	 @Enmienda_27,
	 @Observacion_31,
	 @Estado_32,
	@Conserva_Area,
	@Usuario)


' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Restar_Antiguedad]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Restar_Antiguedad]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE   FUNCTION [dbo].[Fx_Restar_Antiguedad] (@Ant2 varchar(10), @Ant1 varchar(10))  
RETURNS  varchar(10) AS 
BEGIN 
	Declare @AntT varchar(10)
	set @Antt =''''
	
	Declare @D int
	declare @m int
	declare @A int
	
	DECLARE @MES1 INT
	DECLARE @MES2 INT

if @ant1 <> ''00-00-00''	BEGIN

	SET @MES1 = cast(left(right(@Ant1,5),2)  as int)
	SET @MES2 = cast(left(right(@Ant2,5),2) as int)
	
	--IF @MES1 = 0 BEGIN 
--		SET @MES1=12 
--	END
	IF @MES2 = 0 BEGIN 
		SET @MES2=12 
	END

	set @D = cast(right(@Ant2,2) as int) - cast(right(@Ant1,2) as int)	

	set @A = cast(left(@Ant2,2) as int) - cast(left(@Ant1,2) as int)

--	set @M = cast(left(right(@Ant2,5),2) as int) - cast(left(right(@Ant1,5),2)  as int)
	set @M = @MES2 - @MES1


--	IF @MES2 < @MES1 BEGIN
	--	SET @A  =  @A -1
--	END


	if cast(@d as int)>= 30 begin  
		set @M = cast(@m as int) +1 
		set @D = cast(@d as int) - 30
	end
	if @M > 12 begin  
		set @A = cast (@a as int) +1 
		set @m = cast (@m as int) - 12
	end
	if cast(@d as int)< 0 begin  
		set @d =0
		SET @M = @M - 1
	end
	if cast(@m as int)< 0 begin  
		set @m = 12 + @M
		SET @A = @A - 1
	end
	if cast(@a as int)< 0 begin  
		set @a=0
	end
	
	 set  @Antt  = ( select case when @a < 10 then
			   ''0'' 
			else
			''''
		      end 
		     +  cast(@a as varchar) +''-'' + 
		     case when @m < 10 then
			 ''0''
			else ''''
		     end
			+ cast(@m  as varchar) +''-'' + 
		      case when @d < 10 then
				''0''
			else ''''
			end +
			cast(@d as varchar) )


END
ELSE BEGIN
	Set  @AntT  = @Ant2 

END

	

	return @AntT 




END




/*


CREATE   FUNCTION dbo.Fx_Restar_Antiguedad (@Ant2 varchar(10), @Ant1 varchar(10))  
RETURNS  varchar(10) AS 
BEGIN 
	Declare @AntT varchar(10)
	set @Antt =''''
	
	Declare @D int
	declare @m int
	declare @A int
	
	DECLARE @MES1 INT
	DECLARE @MES2 INT



	SET @MES1 = cast(left(right(@Ant1,5),2)  as int)
	SET @MES2 = cast(left(right(@Ant2,5),2) as int)
	
	IF @MES1 = 0 BEGIN 
		SET @MES1=12 
	END
	IF @MES2 = 0 BEGIN 
		SET @MES2=12 
	END

	set @D = cast(right(@Ant2,2) as int) - cast(right(@Ant1,2) as int)	

	set @A = cast(left(@Ant2,2) as int) - cast(left(@Ant1,2) as int)

--	set @M = cast(left(right(@Ant2,5),2) as int) - cast(left(right(@Ant1,5),2)  as int)
	set @M = @MES2 - @MES1


	IF @MES2  > @MES1 BEGIN
		SET @A  =  @A -1
	END


	if cast(@d as int)>= 30 begin  
		set @M = cast(@m as int) +1 
		set @D = cast(@d as int) - 30
	end
	if @M > 12 begin  
		set @A = cast (@a as int) +1 
		set @m = cast (@m as int) - 12
	end
	if cast(@d as int)< 0 begin  
		set @d =0
		SET @M = @M - 1
	end
	if cast(@m as int)< 0 begin  
		set @m = 12 + @M
		SET @A = @A - 1
	end
	if cast(@a as int)< 0 begin  
		set @a=0
	end
	
	 set  @Antt  = ( select case when @a < 10 then
			   ''0'' 
			else
			''''
		      end 
		     +  cast(@a as varchar) +''-'' + 
		     case when @m < 10 then
			 ''0''
			else ''''
		     end
			+ cast(@m  as varchar) +''-'' + 
		      case when @d < 10 then
				''0''
			else ''''
			end +
			cast(@d as varchar) )




	

	return @AntT 

END


*/




' 
END
GO
/****** Object:  Table [dbo].[RELACION]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RELACION]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[RELACION](
	[Id_Area_Viejo] [int] NULL,
	[Id_area] [int] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[CTR_Antiguedad_Certificados]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Antiguedad_Certificados]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CTR_Antiguedad_Certificados](
	[IdCertificado] [int] IDENTITY(1,1) NOT NULL,
	[IdCalculo] [int] NOT NULL,
	[Nivel] [varchar](5) NOT NULL,
	[Grado] [varchar](5) NOT NULL,
	[Funcion] [varchar](200) NOT NULL,
	[FechaCertificado] [smalldatetime] NOT NULL,
	[Antiguedad] [smallint] NOT NULL,
	[TipoCertificado] [smallint] NOT NULL,
	[Impreso] [bit] NOT NULL,
	[IdContrato] [int] NULL,
	[FechaAsignacion] [smalldatetime] NULL,
	[UsuarioAsignacion] [smallint] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Liq_Nro_Cuenta]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Liq_Nro_Cuenta]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Liq_Nro_Cuenta](
	[Id] [int] NULL,
	[Documento] [int] NULL,
	[Id_Estado_Civil_Bco] [smallint] NULL,
	[Tipo_Cta] [char](1) NULL,
	[Nro_Cta] [varchar](11) NULL,
	[Sueldo] [int] NULL,
	[CBU] [varchar](22) NULL,
	[Id_Banco] [smallint] NULL,
	[Sucur_Bco] [int] NULL,
	[Estado_Civil_Bco] [char](1) NULL,
	[Id_Dom_Pago] [int] NULL,
	[Exportado] [bit] NULL,
	[Usua_Ingre] [smallint] NULL,
	[Fecha_Ingre] [smalldatetime] NULL,
	[Usua_Envia] [smallint] NULL,
	[Fecha_Envia] [smalldatetime] NULL,
	[Usua_Reci] [smallint] NULL,
	[Fecha_Reci] [smalldatetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CTR_ELIMINAR_Contrato]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ELIMINAR_Contrato]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CTR_ELIMINAR_Contrato]
	 @Id_Contrato int
AS
DELETE FROM CTR_Contratos
WHERE Id_Contrato = @Id_Contrato

' 
END
GO
/****** Object:  Table [dbo].[Tabla_Parametros]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Parametros]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Parametros](
	[tipo] [varchar](50) NULL,
	[Valor] [varchar](50) NULL,
	[Descripcion] [varchar](250) NULL,
	[Modulo] [varchar](50) NULL,
	[Usuario] [smallint] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CTR_Antiguedad_Reconocida_Grado]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Antiguedad_Reconocida_Grado]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CTR_Antiguedad_Reconocida_Grado](
	[Id_Calculo] [int] NOT NULL,
	[Nro_Documento] [int] NOT NULL,
	[Tipo] [char](1) NOT NULL,
	[Id_Antiguedad] [int] NOT NULL,
	[Desde] [datetime] NULL,
	[Hasta] [datetime] NULL,
	[FechaCorte] [datetime] NULL,
	[FechaProceso] [datetime] NULL,
	[UsuarioProceso] [smallint] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[ASIS_Solicitudes_Licencia_Web_BACKUP20090714]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web_BACKUP20090714]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ASIS_Solicitudes_Licencia_Web_BACKUP20090714](
	[id] [int] NOT NULL,
	[id_interna] [int] NOT NULL,
	[concepto] [smallint] NOT NULL,
	[desde] [smalldatetime] NOT NULL,
	[hasta] [smalldatetime] NOT NULL,
	[usuario] [smallint] NOT NULL,
	[fecha_solicitud] [smalldatetime] NOT NULL,
	[id_area] [int] NULL,
	[baja] [bit] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[CTR_Doc_Presentados]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Doc_Presentados]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CTR_Doc_Presentados](
	[Documento] [int] NULL,
	[Id_Doc] [smallint] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Accesos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Accesos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Accesos](
	[Id] [smallint] NOT NULL,
	[Mnu] [varchar](100) NOT NULL,
	[Descripcion] [varchar](100) NULL,
	[Id_Modulo] [smallint] NULL,
 CONSTRAINT [IX_Accesos] UNIQUE NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[calcula_antiguedad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[calcula_antiguedad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[calcula_antiguedad]
@f1 [smalldatetime],
@f2  [smalldatetime]

AS
declare @d1 [int]
declare @d2 [int]
declare @m1 [int]
declare @m2 [int]

declare @dia [int]

declare @dia1 [int]
declare @dia2 [int]

declare @mes [int]
declare @año  [int]

set @m1 = month(@f1)
set @m2 = month(@f2)
set @d1 = day(@f1)
set @d2 = day(@f2)

	set @año =  year (@f2) - year(@f1)

	if @m1 = 2 begin 
		set @dia1 = 28
	end
	if @m1 = 1 begin 
		set @dia1 = 31
	end
	if @m1 = 3 begin 
		set @dia1 = 31
	end
	if @m1 = 5 begin 
		set @dia1 = 31
	end
	if @m1 = 7 begin 
		set @dia1 = 31
	end
	if @m1 = 8 begin 
		set @dia1 = 31
	end
	if @m1 = 10 begin 
		set @dia1 = 31
	end
	if @m1 = 12 begin 
		set @dia1 = 31
	end
	if @m1 = 4 begin 
		set @dia1 = 30
	end
	if @m1 = 6 begin 
		set @dia1 = 30
	end
	if @m1 = 9 begin 
		set @dia1 = 30
	end
	if @m1 = 11 begin 
		set @dia1 = 30
	end


	if @m1 <= @m2  begin
		set @mes = @m2 - @m1
	end
	if  @m1 > @m2  begin
		set @año = @año -1
		set @mes = (12 - @m1) + @m2
	end 


	if @d1 <= @d2 begin
		set @dia = @d2-@d1
	end
	if @d1 > @d2 begin
		set @mes = @mes -1
		set @dia =(@dia1 - @d1)+@d2
	end

	if @dia = 30 begin
		set @mes = @mes +1
		set @dia =0
	end

	if @mes = 12 begin
		set  @mes =0
		set @año = @año +1
	end	

select @año año, @mes mes, @dia dia,
cast(@año as varchar) +''-'' + cast(@mes  as varchar) +''-'' + cast(@dia as varchar) ant_concat



' 
END
GO
/****** Object:  Table [dbo].[ASIS_Prorrogas_Licencias]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Prorrogas_Licencias]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ASIS_Prorrogas_Licencias](
	[Fecha_Prorroga] [smalldatetime] NULL,
	[Descripcion] [varchar](50) NULL,
	[Numero] [smallint] NULL,
	[Prorroga_Desde] [smallint] NULL,
	[Prorroga_Hasta] [smallint] NULL,
	[Periodo_Usufructo] [smallint] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_GET_DescArea_Fecha]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_GET_DescArea_Fecha]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_GET_DescArea_Fecha]  (@id_interna int, @fecha datetime)  
RETURNS   varchar(200)  AS  
BEGIN 

Return (	SELECT TOP 1	ta.descripcion
	FROM dbo.leg_desglose_area DA
	INNER JOIN dbo.Tabla_Areas TA
		on ta.id = da.id_area
	WHERE Id_interna = @Id_interna and  desde <=  @fecha
	Order by cast(desde as datetime) desc)


END




' 
END
GO
/****** Object:  Table [dbo].[Tabla_Incremento]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Incremento]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Incremento](
	[Id] [int] NULL,
	[Descripcion] [varchar](50) NULL,
	[Monto] [money] NULL,
	[Baja] [bit] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_URetributivas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_URetributivas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_URetributivas](
	[Id_Area] [bigint] NULL,
	[Cantidad] [int] NULL,
	[Baja] [bit] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Perfiles_Permisos_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Perfiles_Permisos_Usuarios]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Perfiles_Permisos_Usuarios](
	[id_usuario] [int] NOT NULL,
	[id_acceso] [smallint] NOT NULL,
	[permisos] [char](3) NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Reparticiones]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Reparticiones]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Reparticiones](
	[Id] [int] NULL,
	[Descripcion] [varchar](100) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  View [dbo].[VW_Doc_Presentados]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Seleccion_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Seleccion_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Seleccion_Contratos]                                      
--@Dependencia char(24) = null,                                      
 @area int = null,                
 @estado int = null,                
 @tipo_cont int = null,        
 @renovar char(1)= null,            
 @memo int = null,    
 @usuario int= null,                
 @orden int= null                
as                                    
set nocount on                              
                                
create table #T                                
(id_tipo_contrato int,                                    
tipo_contrato varchar(50),                                      
Nro_Documento int,                                         
Apellido varchar(100),                                        
Nombre varchar(100),                                        
Nro_Contrato varchar(11),                                         
Desde smalldatetime,                                         
Hasta smalldatetime,                                         
Estado varchar(10),                                        
id_nivel int,                                      
nivel varchar(50),      
Id_Area_Real int,                                       
Area_Real varchar(300),                                      
exp_nro varchar(30),                                    
id_contrato int,                                    
aprobado int,                                    
renovar char(1),                          
Id_Area_Contrato int,              
Memo int)                                
                                
                  
--create table #Cod_Area                          
--(id_area int)                        
-- if not @area is null                         
-- begin                          
--    insert into #cod_area                   
--  select * from dbo.fx_listar_dependencias_areas (@area)                        
-- end                          
-- else                        
--  if not @dependencia is null                          
--  begin                          
--    insert into #cod_area                          
--    select * from dbo.fx_listar_areas_dependencia  (@dependencia)                          
--  end                          
-- else                        
-- begin                          
--  insert into #cod_area                          
--  select id from dbo.tabla_areas                        
-- end                   
                  
                  
create table #Cod_Area                          
(id_area int)                      
                        
if not @area is null                         
begin                          
 insert into #cod_area                    
 values (@area)                        
end                          
else                        
begin                          
 insert into #cod_area                          
 select Id_Area                   
 from RH_USUARIOS_AREAS                  
 where Id_Usuario = @usuario                  
end                          
                  
                  
insert into #T                                    
select                                  
tc.id id_tipo_contrato,                                    
tc.descripcion tipo_contrato,                                      
c.Nro_Documento,                                         
Apellido,                                        
Nombre,                                        
Nro_Contrato,                                         
convert(char(10),c.Desde,103) Desde,                                         
convert(char(10),c.Hasta,103) Hasta,                                         
case when aprobado=1 then                                        
 ''Aprobado''                                        
else                                        
 ''En Tramite''                                        
end Estado,                                        
      
case when C.nivel is not null then          
 c.Nivel       
else          
 c.funcion   
end id_nivel,        
      
case when C.nivel is not null then          
 TN.nivel      
else          
 FC.descripcion      
end nivel,        
      
null, --da.id_area Id_Area_Real,                     
null, --TA2.descripcion Area_Real,                                      
c.exp_nro,                                    
c.id_contrato,                                    
c.aprobado,                                    
isnull(s.renovar, @renovar) renovar,                  
c.id_area Id_Area_Contrato,              
isnull(s.Memo,0)memo              
                          
                          
from dbo.ctr_contratos c                                        
                                             
inner join dbo.datos_personales DP                                        
 on DP.nro_documento = c.nro_documento                                        
                                      
inner join dbo.Tabla_Resoluciones_Contratos TC                           
 on TC.id = c.tipo_contrato                                        
                                
left join dbo.tabla_niveles TN                                        
 on tn.id = c.nivel              
                                       
left join dbo.ctr_seleccion_contratos S                                    
 on s.id_contrato = c.id_contrato          
                                      
left join dbo.Tabla_Funciones_Contratos FC      
 on FC.id = C.funcion      
      
      
      
where  c.baja=0                   
 and (c.tipo_contrato = @tipo_cont OR @tipo_cont is null) --(1421)=1 / (1184)=2        
 and c.nro_contrato = (select max(nro_contrato) from dbo.ctr_contratos c2 where c2.nro_documento = c.nro_documento and exp_nro is not null)                                      
 and (c.aprobado = @estado or @estado is null)                        
 and  (          
 (s.renovar = @renovar AND @renovar = ''R'' and s.memo=0)          
 OR (s.renovar = @renovar AND @renovar = ''N'' and s.memo=0)          
 OR (s.renovar  is null AND @renovar = ''P'')      
 OR (s.renovar = ''R'' and @renovar = ''E'' and (s.memo = @memo OR s.memo <> 0))     
 OR (s.renovar = ''N'' and @renovar = ''V'' and (s.memo = @memo OR s.memo <> 0))     
 )          
-- and ((c.desde between @desde and @hasta) or (@desde is null or @hasta is null))                                      
-- and ((c.hasta between @desde and @hasta) or (@desde is null or @hasta is null))                                         
-- and c.id_contrato not in (select id_contrato from dbo.ctr_seleccion_contratos where memo <> 0 and renovar = @renovar)                                     
                                
                          
update #T                                
set    Id_Area_Real = da.id_area ,                                       
 Area_Real = TA2.descripcion                                   
from #T t                                     
                          
inner join dbo.tabla_areas TA                           
 on TA.id = t.Id_Area_Contrato                             
                          
inner join dbo.vw_desglose_area da                                        
 on  da.documento = t.nro_documento                                       
                                        
inner join dbo.tabla_areas TA2                                        
 on TA2.id = da.id_area                                        
                          
inner join dbo.Tabla_Areas_Estructura E                          
 on E.id_area = da.id_area                          
                          
                        
IF @orden = 0                        
BEGIN                        
 select *                  
 from #t t                  
 inner join #Cod_Area ca                  
 on ca.id_area = t.id_area_real                  
 order by apellido, nombre                  
END                        
ELSE                        
BEGIN                        
 select *                  
 from #t t                  
 inner join #Cod_Area ca                  
 on ca.id_area = t.id_area_real                  
 order by id_area_real, apellido, nombre                  
END                        
      
    
  

' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Dias_del_Mes]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Dias_del_Mes]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_Dias_del_Mes] (@Mes int)  
RETURNS int  AS  
BEGIN 

Declare @Dia1 int

	if @mes  = 2 begin 
		set @dia1 = 28
	end
	if @mes = 1 begin 
		set @dia1 = 31
	end
	if @mes = 3 begin 
		set @dia1 = 31
	end
	if @mes = 5 begin 
		set @dia1 = 31
	end
	if @mes = 7 begin 
		set @dia1 = 31
	end
	if @mes = 8 begin 
		set @dia1 = 31
	end
	if @mes = 10 begin 
		set @dia1 = 31
	end
	if @mes = 12 begin 
		set @dia1 = 31
	end
	if @mes = 4 begin 
		set @dia1 = 30
	end
	if @mes = 6 begin 
		set @dia1 = 30
	end
	if @mes = 9 begin 
		set @dia1 = 30
	end
	if @mes = 11 begin 
		set @dia1 = 30
	end

	RETURN @dia1
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[LIQ_GET_Datos_Banco]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_GET_Datos_Banco]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LIQ_GET_Datos_Banco]                                  
       @Opcion int                              
as                                  
                              
set nocount on                              
                                 
create table #tempo                              
(Nro_documento int ,                              
NomApe varchar(100) ,                                   
id_area int ,                                  
area varchar(500),                                        
localidad varchar(200),                                   
Id_dom_pago int ,                                  
Calle_dom varchar(100) ,                                    
Nro_dom int ,                                    
Piso_dom varchar(5) ,                                    
dpto_dom  varchar(10) ,                              
calle_area varchar(100) ,                                   
nro_area int ,                                  
piso_area varchar(5) ,                                  
dpto_area varchar(5) ,                                   
Tipo_Planta int ,                                  
planta varchar(50) ,                                  
nivel char(5) ,                                  
grado char(5) ,                                  
funcion varchar(50) ,                                  
rango varchar(50) ,                                   
monto float ,                                  
id_estado_civil int ,                                  
Estado_civil varchar(50) ,                              
letra_EC char(1) ,                           
Id_Tipo_Cuenta smallint,                             
Tipo_Cuenta char(1) ,                              
Nro_cuenta char(10) ,                              
CBU varchar(22) ,                              
id_banco smallint ,                              
Sucur_bco int ,                             
exportado bit,    
cuil varchar(15))                              
                              
                              
insert into #tempo                              
select * from dbo.VW_LIQ_Datos_Banco     
              
                                                        
update #tempo                             
set  id_area= ta.id,                                  
  area= ta.Descripcion ,                            
  --Id_dom_pago= null,                            
 calle_area= ltrim(rtrim(tad.calle)),                             
 nro_area=ltrim(rtrim(tad.nro)) ,                            
 piso_area=ltrim(rtrim(tad.piso)) ,                            
 dpto_area=ltrim(rtrim(tad.dpto))                             
from #tempo t                            
                            
left join dbo.vw_desglose_area da                                  
 on t.nro_documento = da.documento                                  
                                  
LEFT join dbo.tabla_areas TA                                  
 on TA.id = da.id_area                                  
                                  
LEFT join dbo.tabla_areas_detalle TAD                                  
 on tad.id_area=TA.id                             
                            
                            
--PARA INCORPORAR A BANCO (0)                            
if @Opcion=0 begin                              
  select * from #tempo t                            
   where  t.nro_documento not in (select documento from liq_nro_cuenta)                                  
 order by t.NomApe                                  
end                              
                            
                            
--FALTAN DATOS DE BANCO (1)                           
if @Opcion=1 begin                             
                          
   update #tempo                           
     set id_estado_civil = l.Id_Estado_Civil_Bco,                          
  Id_Tipo_Cuenta = l.Tipo_Cta,                          
  Nro_cuenta = l.Nro_Cta,                          
  monto = l.Sueldo,                          
  CBU = l.CBU,                          
  id_banco = l.Id_Banco,                          
  Sucur_bco = l.Sucur_Bco,                          
  letra_EC = l.Estado_Civil_Bco,                          
  Id_dom_pago = l.Id_Dom_Pago,                          
  exportado = l.Exportado                          
   from #tempo t                          
  inner join liq_nro_cuenta l                            
     on l.documento=t.nro_documento                            
                             
   select * from #tempo t                              
     inner join liq_nro_cuenta l                            
       on l.documento=t.nro_documento                            
   where  ( abs(l.Sueldo)<=0                             
    or l.Id_Banco is null                             
    or l.Tipo_Cta is null                             
    or abs(l.Id_Dom_Pago)<=0 )              
 and (nro_cta='''' or nro_cta is null or nro_cta=0)                               
                  
   order by t.id_area                                
end                              
                            
                            
--LISTOS PARA ENVIAR (2)  
if @Opcion=2 begin                             
                          
   update #tempo                           
     set id_estado_civil = l.Id_Estado_Civil_Bco,                          
  Id_Tipo_Cuenta = l.Tipo_Cta,                          
  Nro_cuenta = l.Nro_Cta,                          
  monto = l.Sueldo,                          
  CBU = l.CBU,                          
  id_banco = l.Id_Banco,                          
  Sucur_bco = l.Sucur_Bco,                          
  letra_EC = l.Estado_Civil_Bco,                          
  Id_dom_pago = l.Id_Dom_Pago,                          
  exportado = l.Exportado                          
   from #tempo t                          
  inner join liq_nro_cuenta l                            
     on l.documento=t.nro_documento                            
                             
                          
   select * from #tempo t                              
     inner join liq_nro_cuenta l                            
       on l.documento=t.nro_documento                            
   where   abs(l.Sueldo)>0                             
    and l.Id_Banco is not null                             
   and l.Tipo_Cta is not null                             
    and abs(l.Id_Dom_Pago)>0                        
    and l.exportado=0                         
   order by t.NomApe                                  
end                              
                            
                            
--ENVIADOS                      
if @Opcion=3 begin                             
                          
   update #tempo                           
 set id_estado_civil = l.Id_Estado_Civil_bco,                          
  Id_Tipo_Cuenta = l.Tipo_Cta,                          
  Nro_cuenta = l.Nro_Cta,                          
  monto = l.Sueldo,                          
  CBU = l.CBU,                          
  id_banco = l.Id_Banco,                          
  Sucur_bco = l.Sucur_Bco,                          
  letra_EC = l.Estado_Civil_Bco,                          
  Id_dom_pago = l.Id_Dom_Pago,                          
  exportado = l.Exportado                          
   from #tempo t                          
  inner join liq_nro_cuenta l                            
     on l.documento=t.nro_documento                            
                             
                          
   select * from #tempo t                              
     inner join liq_nro_cuenta l                            
       on l.documento=t.nro_documento                            
   where   abs(l.Sueldo)>0                             
    and l.Id_Banco is not null                             
    and l.Tipo_Cta is not null                             
    and abs(l.Id_Dom_Pago)>0                        
    and l.exportado=1                      
    and (l.nro_cta='''' or l.nro_cta is null or l.nro_cta=0)                               
    and (l.cbu='''' or l.cbu is null or l.cbu=0)                       
    and (l.sucur_bco='''' or l.sucur_bco is null or l.sucur_bco=0)                       
   order by t.NomApe                                   
end                      
                      
                      
--CON CUENTA                   
if @Opcion=4 begin                             
                          
   update #tempo                           
     set id_estado_civil = l.Id_Estado_Civil_bco,                          
  Id_Tipo_Cuenta = l.Tipo_Cta,                          
  Nro_cuenta = l.Nro_Cta,                          
  monto = l.Sueldo,                          
  CBU = l.CBU,                    
  id_banco = l.Id_Banco,                          
  Sucur_bco = l.Sucur_Bco,                          
  letra_EC = l.Estado_Civil_Bco,                          
  Id_dom_pago = l.Id_Dom_Pago,                          
  exportado = l.Exportado                          
   from #tempo t                          
  inner join liq_nro_cuenta l                            
     on l.documento=t.nro_documento                            
                             
                          
   select * from #tempo t                              
     inner join liq_nro_cuenta l                            
       on l.documento=t.nro_documento                            
   where   abs(l.Sueldo)>0                             
    and l.Id_Banco is not null                             
    and l.Tipo_Cta is not null                             
    and abs(l.Id_Dom_Pago)>0                        
    and l.exportado=1                      
    and (l.nro_cta<>'''' or l.nro_cta is not null or l.nro_cta<>0)                               
    and l.cbu is not null                      
    and l.sucur_bco is not null                       
   order by t.NomApe                                  
end                      
                      
                            
drop table #tempo                            
            
          
        
      
    
  
  

' 
END
GO
/****** Object:  Table [dbo].[MED_Atenciones]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_Atenciones]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[MED_Atenciones](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Nro_Documento] [int] NULL,
	[FechaAtencion] [smalldatetime] NOT NULL,
	[VolverEnDias] [smallint] NULL,
	[PresionDia] [smallint] NULL,
	[PresionHora] [varchar](5) NULL,
	[PresionDiastolica] [smallint] NULL,
	[PresionSistolica] [smallint] NULL,
	[IdDiagnostico] [smallint] NOT NULL,
	[Observaciones] [varchar](500) NULL,
	[IdLicencia] [int] NULL,
	[Baja] [bit] NULL,
	[ConsultorioExterno] [bit] NOT NULL,
	[IdUsuario] [smallint] NULL,
	[regresa] [int] NULL,
	[regreso] [int] NULL,
	[fecha_parto] [smalldatetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[GER]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GER]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[GER]

--@a varchar(5000)

as

create table #T
(
id_a int,
cadena varchar(5000),
marca char(1)
)

insert into #t
select id_area, null, 0 from tabla_areas_estructura
where baja = 0


declare @id_1 int

while (select count(1) from #t where marca = 0) > 0
begin
	select top 1 @id_1 = id_a
	from #t
	where marca = 0

	print ''AREA: '' + convert(varchar(10),@id_1)
	
	update #t
	set cadena = dbo.FxCadena_Dependencia_test (@id_1)
	where id_a = @id_1


	update #t
	set marca = 1
	where id_a = @id_1
	
end

select * from #T




' 
END
GO
/****** Object:  Table [dbo].[CFirmantes_Contratos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CFirmantes_Contratos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CFirmantes_Contratos](
	[Id] [int] NOT NULL,
	[Secretaria] [int] NULL,
	[Apellido] [varchar](100) NULL,
	[Cargo] [varchar](200) NULL,
	[Direccion] [varchar](200) NULL,
	[Baja] [bit] NOT NULL,
	[Firma_Contrato] [bit] NULL,
 CONSTRAINT [PK_CFirmantes_Contratos] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Desglose_Area]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Desglose_Area]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_GET_Desglose_Area]    
    
as    
    
/*  
Este SP llena el area con el desde y el hasta de cada persona.  
  
ESTE SP SE LLAMA DE ASIS_GET_Planillas_Firmas_Faltantes  
ahi esta creada la tabla temporal  
*/  
  
--create table #tempo_Area    
--(    
--id int identity ,    
--documento int,    
--id_area int,    
--desde smalldatetime,    
--hasta smalldatetime,    
--desdeAM varchar(6),    
--hastaAM varchar(6),    
--marca int    
--)    
    
insert into #tempo_Area    
select
Documento,    
Id_area,    
Desde,    
null,    
substring(convert(char(10),Desde,103),7,4) + substring(convert(char(10),Desde,103),4,2),    
null,    
0     
from LEG_Desglose_Area    
order by documento, desde    
    
DECLARE @doc int    
DECLARE @docprox int    
DECLARE @minid int    

DECLARE @año char(4)   
DECLARE @mes char(2)
    
WHILE (SELECT count(*) FROM #tempo_Area WHERE marca = 0) > 0             
BEGIN    
     
 SET @minid = (select min(id) from #tempo_Area where marca = 0)    
 SET @doc = (select documento from #tempo_Area where id = @minid )    
 SET @docprox = (select documento from #tempo_Area where id = @minid + 1 )    
     
 IF (@doc = @docprox)    
 BEGIN    
  update #tempo_Area    
   set hasta = (select desde from #tempo_Area where id = @minid + 1 ),    
   hastaAM = (select desdeAM from #tempo_Area where id = @minid + 1 ),    
   marca = 1    
  where id = @minid    
 END    
 ELSE    
 BEGIN     
  update #tempo_Area    
   set marca = 1    
  where id = @minid    
 END    
    
END    


select @año = year(getdate()) + 3
select @mes = month(getdate())

  update #tempo_Area    
   set hastaAM = @año + @mes
  where hastaAM is null

    
--select * from #tempo_Area    

' 
END
GO
/****** Object:  Table [dbo].[Felicitaciones]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Felicitaciones]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Felicitaciones](
	[Jurisdicción] [nvarchar](50) NOT NULL,
	[Organismo] [nvarchar](50) NOT NULL,
	[Concepto] [nvarchar](100) NOT NULL,
	[MotivadaPor] [nvarchar](100) NULL,
	[Acto_Tipo] [smallint] NULL,
	[Acto_Nro] [nvarchar](10) NULL,
	[Fecha] [smalldatetime] NOT NULL,
	[Folio_Nro] [char](10) NOT NULL,
	[Id_Interna] [int] NOT NULL,
	[Id_Felicitaciones] [int] NULL,
	[DatoDeBaja] [bit] NULL,
	[datonoimprime] [bit] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[EVAL_DEL_EVALUADOR_AGENTE ]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_DEL_EVALUADOR_AGENTE ]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <17/03/2008>
-- Description:	<Elimina la excepcion agente-evaluador>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_DEL_EVALUADOR_AGENTE ]
	@id_agente int, @id_periodo int
AS
BEGIN
	SET NOCOUNT ON;
	
	DELETE FROM dbo.EVAL_Evaluadores_Agentes
	WHERE id_agente = @id_agente and id_periodo = @id_periodo

END

' 
END
GO
/****** Object:  Table [dbo].[PLA_Pases_Solicitados_BACKUP20090715]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_Pases_Solicitados_BACKUP20090715]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[PLA_Pases_Solicitados_BACKUP20090715](
	[id] [int] NOT NULL,
	[id_interna] [int] NOT NULL,
	[Area_Actual] [int] NOT NULL,
	[Area_Nueva] [int] NOT NULL,
	[Fecha_Solicitud] [datetime] NOT NULL,
	[Estado] [smallint] NOT NULL,
	[Solicito] [smallint] NOT NULL,
	[Reviso] [smallint] NULL,
	[Fecha_Pase] [datetime] NOT NULL,
	[Motivo_Rechazo] [varchar](200) NULL,
	[RechazoImpreso] [bit] NOT NULL,
	[Ultima_Modificacion] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[licencias_solicitadas_bk_141107]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[licencias_solicitadas_bk_141107]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[licencias_solicitadas_bk_141107](
	[Id] [int] NOT NULL,
	[Id_Interna] [int] NOT NULL,
	[Concepto] [smallint] NOT NULL,
	[Periodo] [smallint] NOT NULL,
	[Desde] [smalldatetime] NOT NULL,
	[Hasta] [smalldatetime] NOT NULL,
	[Autorizacion] [smallint] NOT NULL,
	[Autorizo_Descuento] [varchar](100) NULL,
	[Dias_Descuento] [varchar](4) NULL,
	[Goce] [smallint] NOT NULL,
	[Observaciones] [varchar](100) NULL,
	[Id_Area] [int] NOT NULL,
	[Informo] [varchar](50) NOT NULL,
	[Id_Tabla_Autorizacion] [int] NOT NULL,
	[Dias_A_Tomar] [smallint] NOT NULL,
	[FH_FIN_ANTES_INTERR] [smalldatetime] NULL,
	[Motivo_Interrupcion] [varchar](200) NULL,
	[Usuario] [smallint] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Estado_Contrato]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Estado_Contrato]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_GET_Estado_Contrato]
	@Id_Contrato int
AS
Select Estado
from Ctr_Contratos
where Id_Contrato = @Id_Contrato

' 
END
GO
/****** Object:  Table [dbo].[Setup]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Setup]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Setup](
	[Validar] [bit] NOT NULL,
	[Fecha] [char](20) NULL,
	[Texto] [char](20) NULL,
	[Nro] [smallint] NOT NULL,
	[Cuil] [varchar](15) NULL,
	[Actualizar] [bit] NOT NULL,
	[Path_Exe] [varchar](250) NULL,
	[Doc] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[TMP_CONTRATOS_LEGAJOS]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[TMP_CONTRATOS_LEGAJOS]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[TMP_CONTRATOS_LEGAJOS](
	[Legajo] [int] NOT NULL,
	[Fecha] [smalldatetime] NULL,
	[Envio] [varchar](15) NULL,
	[Recibido] [varchar](15) NULL,
	[Motivo] [varchar](50) NULL,
	[Referencia] [int] NULL,
	[Id] [int] NOT NULL,
	[Aprobado] [smallint] NULL,
 CONSTRAINT [PK_TMP_CONTRATOS_LEGAJOS] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_FechaActual]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_FechaActual]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CRED_Get_FechaActual]
	
AS

SELECT 
	GETDATE() FechaActual

' 
END
GO
/****** Object:  Table [dbo].[autorizaciones_licencias_bk_141107]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[autorizaciones_licencias_bk_141107]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[autorizaciones_licencias_bk_141107](
	[Id_Interna] [int] NOT NULL,
	[Dias_Autorizados] [smallint] NOT NULL,
	[Id_Concepto_Licencia] [smallint] NOT NULL,
	[Periodo] [smallint] NOT NULL,
	[Id] [int] NOT NULL,
	[Dias_Tomados] [smallint] NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_DEL_Evaluador_Unidad_Evaluacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_DEL_Evaluador_Unidad_Evaluacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <04/04/2008>
-- Description:	<Borra un evaluador de un area en el periodo indicado>
-- =============================================
--[EVAL_GET_Unidades_Evaluacion] 1, 1

CREATE PROCEDURE [dbo].[EVAL_DEL_Evaluador_Unidad_Evaluacion]
	@id_area int, @id_periodo int
AS
BEGIN
	SET NOCOUNT ON;

	DELETE FROM dbo.EVAL_Evaluadores_Areas WHERE id_area = @id_area and id_periodo = @id_periodo

END
' 
END
GO
/****** Object:  Table [dbo].[Tabla_Medicos_Discapacidad]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Medicos_Discapacidad]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Medicos_Discapacidad](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](100) NOT NULL,
	[Baja] [bit] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[ASIS_Partes_Web]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Partes_Web]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ASIS_Partes_Web](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[id_area] [int] NOT NULL,
	[fecha] [smalldatetime] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Conceptos_Licencias_BACKUP20090716]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Conceptos_Licencias_BACKUP20090716]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Conceptos_Licencias_BACKUP20090716](
	[Nro_Articulo] [varchar](5) NOT NULL,
	[Concepto] [varchar](5) NOT NULL,
	[Descripcion] [varchar](60) NOT NULL,
	[Dias_Autorizados] [smallint] NOT NULL,
	[id_Concepto] [smallint] NOT NULL,
	[Acumulativa] [bit] NOT NULL,
	[Goce_Haberes] [smallint] NOT NULL,
	[Es_Ordinaria] [bit] NOT NULL,
	[Anual] [bit] NOT NULL,
	[Dias_Habiles] [bit] NULL,
	[Send_Legajos] [bit] NULL,
	[Licencia_Medica] [bit] NULL,
	[Regresa_Medica] [bit] NULL,
	[GeneraDerechoOrdinaria] [bit] NULL,
	[Baja] [bit] NOT NULL,
	[DiasMensuales] [smallint] NOT NULL,
	[DiasConsecutivos] [smallint] NOT NULL,
	[Usuario] [smallint] NOT NULL,
	[PathFormularioWeb] [varchar](90) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[LEG_Servicios_Adm_Publica]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Servicios_Adm_Publica]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Servicios_Adm_Publica](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Ambito] [smallint] NOT NULL,
	[Jurisdiccion] [varchar](50) NOT NULL,
	[Organismo] [varchar](50) NOT NULL,
	[Cargo] [smallint] NOT NULL,
	[Remunerativo] [bit] NULL,
	[Fecha_Desde] [datetime] NOT NULL,
	[Fecha_Hasta] [datetime] NOT NULL,
	[Causa_Egreso] [varchar](100) NULL,
	[Folio] [char](10) NOT NULL,
	[Id_Interna] [int] NOT NULL,
	[Doc_Titular] [int] NOT NULL,
	[Caja] [varchar](50) NULL,
	[Afiliado] [varchar](50) NULL,
	[DatoDeBaja] [bit] NULL,
	[datonoimprime] [bit] NULL,
	[Ctr_Cert] [bit] NULL,
	[Usuario] [smallint] NULL,
	[Fecha_Carga] [datetime] NULL,
 CONSTRAINT [PK_LEG_Servicios_Adm_Publica] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Pasividad]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Pasividad]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Pasividad](
	[Caja_Jubilación] [nvarchar](50) NULL,
	[Nro_Beneficio_Jubilación] [nvarchar](25) NULL,
	[Fecha_Jub] [datetime] NULL,
	[Caja_de_Retiro] [nvarchar](50) NULL,
	[Nro_Beneficio_Retiro] [nvarchar](25) NULL,
	[Fecha_Retiro] [datetime] NULL,
	[Caja_de_Pensión] [nvarchar](50) NULL,
	[Nro_Beneficio_Pensión] [nvarchar](25) NULL,
	[Pension_Fecha] [datetime] NULL,
	[Folio_Nro] [char](10) NULL,
	[Id_Interna] [int] NOT NULL,
	[Nro_doc] [int] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Doc_Presentados]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Doc_Presentados]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Doc_Presentados](
	[Id] [smallint] NOT NULL,
	[Descripcion] [varchar](100) NULL,
	[Posicion] [smallint] NULL,
	[Baja] [bit] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CTR_Get_Temporal_Experiencias_Reconocidas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Get_Temporal_Experiencias_Reconocidas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE  procedure [dbo].[CTR_Get_Temporal_Experiencias_Reconocidas]      
 @operacion int = 0,
 @hostid varchar(10)      
as      
      
IF @operacion = 0  
BEGIN   
 select Id,
   Desde,      
   Hasta,      
   DesdeNuevo,      
   HastaNuevo,      
   Meses,      
   Orden,      
   Tipo       
 from dbo.CTR_Temporal_Experiencias_Reconocidas  
 where hostid = @hostid  
 order by desde, hasta desc  
END  
  
  
IF @operacion = 1  
BEGIN   
 select  top 1  
   Id,      
   Desde,      
   Hasta,      
   DesdeNuevo,      
   HastaNuevo,      
   Meses,      
   Orden,      
   Tipo       
 from dbo.CTR_Temporal_Experiencias_Reconocidas    
 where tipo = ''M'' 
 and hostid = @hostid   
 order by desde, hasta desc  
END  
  
  

' 
END
GO
/****** Object:  Table [dbo].[Tabla_Medicos_Analisis]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Medicos_Analisis]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Medicos_Analisis](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](200) NOT NULL,
	[Baja] [bit] NULL,
	[Obligatorio] [bit] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CRED_PersonasRelevadasHistorica_BIS]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_PersonasRelevadasHistorica_BIS]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_PersonasRelevadasHistorica_BIS](
	[Fecha_ocurrencia] [datetime] NOT NULL,
	[Documento] [int] NOT NULL,
	[Apellido] [varchar](50) NOT NULL,
	[Nombre] [varchar](50) NOT NULL,
	[Lugar_de_trabajo] [varchar](8) NOT NULL,
	[Telefono] [varchar](26) NOT NULL,
	[Email_mds] [varchar](60) NOT NULL,
	[Email_personal] [varchar](60) NOT NULL,
	[Fecha_comunicacion] [smalldatetime] NULL,
	[IdBaja] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Funciones_Contratos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Funciones_Contratos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Funciones_Contratos](
	[Id] [smallint] NOT NULL,
	[Descripcion] [varchar](50) NULL,
	[baja] [bit] NOT NULL,
	[Objeto] [text] NULL,
 CONSTRAINT [PK_Tabla_Funciones_Contratos] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Periodos_Goce]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Periodos_Goce]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Periodos_Goce](
	[Id_Concepto] [smallint] NOT NULL,
	[CantDias] [smallint] NOT NULL,
	[Id_Goce] [smallint] NOT NULL,
	[Id] [int] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Domicilio_Pago_Banco]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Domicilio_Pago_Banco]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Domicilio_Pago_Banco](
	[Id_DomPago] [int] NULL,
	[Denominacion] [varchar](100) NULL,
	[Calle] [varchar](50) NULL,
	[Numero] [varchar](5) NULL,
	[Piso] [varchar](2) NULL,
	[Unidad] [varchar](2) NULL,
	[Localidad] [varchar](50) NULL,
	[CP] [varchar](5) NULL,
	[Contacto] [varchar](100) NULL,
	[Telefono] [varchar](50) NULL,
	[Fax] [varchar](50) NULL,
	[Cantidad_Agentes] [smallint] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Situaciones_Especiales]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Situaciones_Especiales]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Situaciones_Especiales](
	[Jurisdicción] [varchar](50) NULL,
	[Organismo] [varchar](50) NULL,
	[Situación] [varchar](50) NULL,
	[Motivo] [varchar](50) NULL,
	[Dest_Jurisdicc] [varchar](50) NULL,
	[Dest_Org] [varchar](50) NULL,
	[Fecha_Desde] [smalldatetime] NULL,
	[Fecha_Hasta] [smalldatetime] NULL,
	[Tipo_Acto] [smallint] NULL,
	[Acto_Nro] [varchar](50) NULL,
	[Fecha_Acto] [smalldatetime] NULL,
	[Folio_Nro] [char](10) NOT NULL,
	[Id_Interna] [int] NOT NULL,
	[Id_Situaciones] [int] NOT NULL,
	[DatoDeBaja] [bit] NULL,
	[datonoimprime] [bit] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[MED_DEL_Atencion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_DEL_Atencion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[MED_DEL_Atencion]
	@IdAtencion int
AS
UPDATE dbo.MED_Atenciones
SET Baja = 1
WHERE Id = @IdAtencion
' 
END
GO
/****** Object:  View [dbo].[VW_Funciones_Contratos]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Funciones_Contratos]'))
EXEC dbo.sp_executesql @statement = N'


CREATE   VIEW [dbo].[VW_Funciones_Contratos]
AS 

SELECT [Tabla_Funciones_Contratos].[Id], 
[Tabla_Funciones_Contratos].[Descripcion],
Tabla_Funciones_Contratos.objeto
FROM dbo.[Tabla_Funciones_Contratos]
where baja =0



'
GO
/****** Object:  Table [dbo].[Tabla_Medicos_Diagnosticos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Medicos_Diagnosticos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Medicos_Diagnosticos](
	[Id] [smallint] IDENTITY(1,1) NOT NULL,
	[Codigo] [varchar](5) NULL,
	[Descripcion] [varchar](600) NOT NULL,
	[Baja] [bit] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CRED_DomiciliosHistorica_BIS]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_DomiciliosHistorica_BIS]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_DomiciliosHistorica_BIS](
	[Fecha_ocurrencia] [datetime] NOT NULL,
	[id] [int] NOT NULL,
	[Documento] [int] NOT NULL,
	[Calle] [varchar](50) NOT NULL,
	[Numero] [varchar](6) NOT NULL,
	[Piso] [varchar](3) NOT NULL,
	[Depto] [varchar](255) NOT NULL,
	[Casa] [varchar](20) NOT NULL,
	[Manzana] [varchar](20) NOT NULL,
	[Torre] [varchar](20) NOT NULL,
	[Uf] [varchar](20) NOT NULL,
	[Codigo_postal] [varchar](12) NOT NULL,
	[Localidad] [varchar](60) NOT NULL,
	[Barrio] [varchar](50) NOT NULL,
	[IdLocalidad] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[PLA_Recibos_111108]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_Recibos_111108]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[PLA_Recibos_111108](
	[Id_Recibo] [int] NOT NULL,
	[Id_Interna] [int] NOT NULL,
	[mes] [smallint] NOT NULL,
	[año] [smallint] NOT NULL,
	[Cuil] [varchar](13) NULL,
	[Id_Oficina] [smallint] NULL,
	[Nro_Orden] [smallint] NULL,
	[Nivel] [char](1) NULL,
	[grado] [char](2) NULL,
	[F_Ingreso] [datetime] NULL,
	[SBruto] [varchar](10) NULL,
	[SNeto] [varchar](10) NULL,
	[NroCta] [varchar](10) NULL,
	[Banco] [varchar](20) NULL,
	[F_Deposito] [datetime] NULL,
	[confirmado] [bit] NULL,
	[Usuario] [smallint] NULL,
	[SDescuentos] [varchar](10) NULL,
	[Impreso] [bit] NOT NULL,
	[Entregado] [bit] NOT NULL,
	[Recibido] [bit] NOT NULL,
	[TipoLiquidacion] [varchar](2) NULL,
	[OpcionJubilatoria] [varchar](2) NULL,
	[AFJP] [varchar](10) NULL,
	[liquidacion] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[PLA_Recibos_Detalle_111108]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_Recibos_Detalle_111108]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[PLA_Recibos_Detalle_111108](
	[Id_Recibo] [int] NOT NULL,
	[Id_interna] [int] NOT NULL,
	[Mes] [smallint] NOT NULL,
	[Año] [smallint] NOT NULL,
	[Concepto] [nvarchar](50) NOT NULL,
	[Aporte] [varchar](10) NULL,
	[Descuento] [varchar](10) NULL,
	[TipoConcepto] [varchar](2) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Medicos_Aptos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Medicos_Aptos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Medicos_Aptos](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[Baja] [bit] NULL,
	[DiasValido] [smallint] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[MED_DEL_Enfermedades_Preexistentes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_DEL_Enfermedades_Preexistentes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[MED_DEL_Enfermedades_Preexistentes]  
 @Nro_Documento int,
 @IdEnfermedad int  
as  
  
DELETE dbo.MED_Enfermedades_Preexistentes  
where 	Nro_documento = @Nro_Documento  AND
	Enfermedad = @IdEnfermedad

  
' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_Evaluador_Unidad_Evaluacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_Evaluador_Unidad_Evaluacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <10/03/2008>
-- Description:	<Trae el evaluador de un area para un determinado periodo>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_GET_Evaluador_Unidad_Evaluacion]
	@id_area int, @id_periodo int
AS
BEGIN
	SET NOCOUNT ON;

	select id_evaluador
	from dbo.EVAL_Evaluadores_Areas
	where id_area = @id_area and id_periodo = @id_periodo
END

' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_Evaluados_Evaluador]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_Evaluados_Evaluador]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[EVAL_GET_Evaluados_Evaluador] 
@id_evaluador int, @id_periodo int
AS

SELECT id_agente id_evaluado
FROM dbo.EVAL_Evaluadores_Agentes EA
WHERE id_evaluador = @id_evaluador and id_periodo = @id_periodo


' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_GET_PasesRechazos_Impresion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_GET_PasesRechazos_Impresion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE  PROCEDURE [dbo].[PLA_GET_PasesRechazos_Impresion]
AS
SELECT	PS.documento, 
	DP.Apellido +'', ''+ DP.Nombre Apellido,
	TAO.Descripcion De,
	TAD.Descripcion A,
	isnull(Motivo_Rechazo,''Sin Motivo'') Motivo,
	PS.Id,
	Fecha_Pase
FROM 	dbo.PLA_Pases_Solicitados PS
INNER JOIN dbo.Datos_Personales DP
	on DP.Nro_Documento = PS.Documento
INNER JOIN dbo.Tabla_Areas TAO
	on TAO.id = PS.Area_Actual
INNER JOIN dbo.Tabla_Areas TAD
	on TAD.id = PS.Area_Nueva
WHERE	Estado = 2 AND
	RechazoImpreso = 0

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_ADD_Temporal_Experiencias_Reconocidas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ADD_Temporal_Experiencias_Reconocidas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CTR_ADD_Temporal_Experiencias_Reconocidas]  
  
@tipo char(1),  
@orden int,  
@desde datetime,  
@hasta datetime,  
@FechaCorte datetime,
@HostId varchar(10)  
  
as  
  
 insert into dbo.CTR_Temporal_Experiencias_Reconocidas (Orden,Tipo, Desde, Hasta, Hostid)                   
 values(@orden,@tipo, @desde, @hasta, @HostId)  
  
/*  
IF (convert(char(10),@desde,103) < convert(char(10),@FechaCorte,103))  
BEGIN  
 IF((convert(char(10),@desde,103) < convert(char(10),@FechaCorte,103))   
  AND (convert(char(10),@FechaCorte,103) < convert(char(10),@hasta,103)))  
 BEGIN  
  SET @hasta = @FechaCorte  
 END  
  
 insert into dbo.CTR_Temporal_Experiencias_Reconocidas (Orden,Tipo, Desde, Hasta)                   
 values(@orden, @tipo, @desde, @hasta)   
  
END  
*/  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_Formulario]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_Formulario]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <26/03/2008>
-- Description:	<Trae los tipos de planta por los que paso un agente en un periodo>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_GET_Formulario]
	@id_formulario int
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
	EP.Orden, EP.id_pregunta, EP.id_concepto, EP.Enunciado, EP.Factor,
	EN.id_nivel, EN.descripcion descripcion_nivel, EN.detalle detalle_nivel,
	EP.Rpta1, EP.Rpta2, EP.Rpta3, EP.Rpta4, EP.Rpta5, CP.descripcion concepto

	FROM dbo.Eval_formularios EV
	INNER JOIN dbo.Eval_preguntas EP
		on EP.id_formulario = EV.id_formulario
	INNER JOIN dbo.Eval_Niveles EN
		on EN.id_nivel = EV.id_nivel
    INNER JOIN dbo.Eval_Conceptos_Preguntas CP
        on CP.id_concepto = EP.id_concepto
	WHERE EP.Id_Formulario = @id_formulario
	ORDER BY EP.Orden
	

END
--select * from eval_preguntas order by id_formulario
--select * from dbo.eval_formularios
' 
END
GO
/****** Object:  Table [dbo].[TMP_LEG_Servicios_Jubilatorios]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[TMP_LEG_Servicios_Jubilatorios]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[TMP_LEG_Servicios_Jubilatorios](
	[id_interna] [int] NOT NULL,
	[Corresponde] [varchar](7) NOT NULL,
	[caja] [varchar](50) NULL,
	[afiliado] [varchar](50) NULL,
	[no_computa] [varchar](9) NULL,
	[Antiguedad] [varchar](10) NULL,
	[Ant_total] [char](8) NULL,
	[DesdeOriginal] [char](10) NULL,
	[HastaOriginal] [char](10) NULL,
	[AntiguedadAReconocer] [varchar](10) NULL,
	[FechaMinisterio] [varchar](10) NULL,
	[AntiguedadMin] [varchar](10) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Usuarios_Traspaso]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Usuarios_Traspaso]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Usuarios_Traspaso](
	[Id_Usuario] [smallint] NULL,
	[Id_Modulo] [smallint] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Estudios_Otros]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Estudios_Otros]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Estudios_Otros](
	[id_establecimiento] [int] NULL,
	[Establecimeinto] [varchar](50) NULL,
	[Depende_de] [varchar](50) NULL,
	[Titulo] [varchar](50) NULL,
	[Expedido_por] [varchar](50) NULL,
	[Fecha_ingreso] [datetime] NULL,
	[Fecha_egreso] [datetime] NULL,
	[Fecha] [datetime] NULL,
	[Folio_Nro] [char](10) NULL,
	[Id_Interna] [int] NOT NULL,
	[Nro_Doc] [int] NOT NULL,
	[Cant_Horas_Totales] [smallint] NULL,
	[Cant_Horas_Cursadas] [smallint] NULL,
	[Cant_Materias_Totales] [smallint] NULL,
	[Cant_Materias_Aprob] [smallint] NULL,
	[Evaluacion_Final] [smallint] NULL,
	[Tesis_Nota] [smallint] NULL,
	[Tesis_Tema] [char](30) NULL,
	[id_estudio] [int] NULL,
	[DatoDeBaja] [bit] NULL,
	[DatoNoImprime] [bit] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[cred_historicocredencialesasignablesapersonas_20120514]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[cred_historicocredencialesasignablesapersonas_20120514]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[cred_historicocredencialesasignablesapersonas_20120514](
	[IdPersona] [int] NOT NULL,
	[IdTipoCredencial] [smallint] NOT NULL,
	[fecha] [smalldatetime] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[IMP_Estudios_Secundarios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[IMP_Estudios_Secundarios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[IMP_Estudios_Secundarios]
  @id_interna int,
  @operacion bit

as
if @operacion = 0 begin

	insert into dbo.imp_estudios_secundarios
	Select  id_interna, 
		Certificado_Expedido_por ,
		Fecha_Egreso, 
		folio_nro
	
	from [dbo].Estudios_Realizados 
	where  	[Id_Interna] =  @Id_Interna  AND 
		[Nivel] = 3

end

if @operacion = 1 begin
	delete from  dbo.imp_estudios_secundarios
	where id_interna = @id_interna
end


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_DEL_Temporal_Experiencias_Reconocidas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_DEL_Temporal_Experiencias_Reconocidas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CTR_DEL_Temporal_Experiencias_Reconocidas]  
@hostid varchar(10)
  
as  
  
DELETE FROM dbo.CTR_Temporal_Experiencias_Reconocidas WHERE hostid = @hostid

' 
END
GO
/****** Object:  Table [dbo].[Antiguedad_bak_26112007]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Antiguedad_bak_26112007]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Antiguedad_bak_26112007](
	[Ant_estado] [char](8) NULL,
	[Ant_privada] [char](8) NULL,
	[Ant_total] [char](8) NULL,
	[Resta_ant_min] [char](8) NULL,
	[Id_interna] [int] NULL,
	[Legajo] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CDomicilio]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CDomicilio]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CDomicilio](
	[Legajo] [int] NOT NULL,
	[Calle] [varchar](50) NULL,
	[Nro] [char](5) NULL,
	[Ppiso] [char](5) NULL,
	[Dpto] [char](5) NULL,
	[CP] [smallint] NULL,
	[ID_localidad] [smallint] NULL,
	[Id_provincia] [smallint] NULL,
 CONSTRAINT [PK_CDomicilio] PRIMARY KEY NONCLUSTERED 
(
	[Legajo] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[LEG_Administracion_Folios]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Administracion_Folios]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Administracion_Folios](
	[Id_Interna] [int] NOT NULL,
	[Folio] [char](10) NOT NULL,
	[UsuarioIntervino] [smallint] NOT NULL,
	[FechaIntervino] [datetime] NOT NULL,
	[UsuarioDesglose] [smallint] NULL,
	[FechaDesglose] [datetime] NULL,
	[MotivoDesglose] [varchar](50) NULL,
	[Desglosado] [bit] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Buscar_Contrato_Por_Nivel]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Buscar_Contrato_Por_Nivel]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Buscar_Contrato_Por_Nivel]    
@IdNivel int,           
@Documento int,           
@FechaCorte smalldatetime          
as          
set nocount on          
          
          
DECLARE @IDContrato int          
          
create table #tempo          
(           
IDContrato int,          
Documento int,          
Nivel int,          
Grado int,          
FechaDesdeMas2 smalldatetime,          
FechaDesdeMenos2 smalldatetime,          
FechaHastaMas2 smalldatetime,          
FechaHastaMenos2 smalldatetime          
)          
          
insert into #tempo          
select  ID_Contrato,          
        Nro_Documento,          
        Nivel,          
  Grado,          
        Desde + 2,            
        Desde - 2,          
        Hasta + 2,            
        Hasta - 2           
from CTR_Contratos            
where Nro_Documento = @Documento           
and Nivel = @IdNivel           
and (Baja=0          
 OR (BAJA = 1 and Aprobado = 1))          
      
--Si no tiene contrato devuelvo 0          
IF (select count(*) from #tempo) = 0      
BEGIN      
 select ''0'' Id_Contrato, ''0'' nivel, ''0'' grado, ''0'' Grado_Descrip       
 Return      
END      
      
      
SET @IDContrato = (select max(IDContrato)           
from #tempo          
--where @FechaCorte between FechaDesdeMenos2 and FechaHastaMas2)      
where ((@FechaCorte between FechaDesdeMenos2 and FechaDesdeMas2)          
OR (@FechaCorte between FechaHastaMenos2 and FechaHastaMas2)))          
          
          
select t.IdContrato Id_Contrato, t.nivel, t.grado, g.Grado Grado_Descrip          
from #tempo t             
 INNER JOIN tabla_grados g          
  ON g.id = t.grado          
where IdContrato = @IDContrato          
       
      
/*          
create table #tempo2          
(fecha smalldatetime)              
      
insert into #tempo2          
exec dbo.CTR_GET_Primer_Fecha_Nivel @IDContrato          
          
select convert(char(10),fecha,103) fecha from #tempo2          
*/ ' 
END
GO
/****** Object:  Table [dbo].[CTR_Contratos_Reservas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Contratos_Reservas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CTR_Contratos_Reservas](
	[Id_Contrato] [int] NULL,
	[IdMotivo] [smallint] NULL,
	[FechaReserva] [datetime] NULL,
	[UsuarioReserva] [smallint] NULL
) ON [PRIMARY]
END
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Get_Años_de_antiguedad]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Get_Años_de_antiguedad]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'
CREATE FUNCTION [dbo].[Fx_Get_Años_de_antiguedad] (@F1 char(8))  
RETURNS  smallint
BEGIN 
declare @return_value smallint

set @return_value = cast(left(@F1,2) as int)

RETURN isnull(@return_value,0)
END' 
END
GO
/****** Object:  Table [dbo].[WEB_GruposConceptosLicencia]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_GruposConceptosLicencia]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[WEB_GruposConceptosLicencia](
	[idGrupo] [int] NOT NULL,
	[descripcion] [varchar](150) NOT NULL,
	[detalle] [varchar](1100) NOT NULL,
 CONSTRAINT [PK_WEB_GruposConceptosLicencia] PRIMARY KEY CLUSTERED 
(
	[idGrupo] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[WEB_Sincronizacion_Areas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_Sincronizacion_Areas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[WEB_Sincronizacion_Areas](
	[id_Area] [int] NOT NULL,
	[id_Modificacion] [int] IDENTITY(1,1) NOT NULL,
	[Realizada] [bit] NOT NULL,
	[fecha] [smalldatetime] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_ReportesAsignacionPersonas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_ReportesAsignacionPersonas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		FC
-- Create date: 05/01/2012
-- Descripción:	
-- =============================================
create procedure [dbo].[CRED_ReportesAsignacionPersonas]
as
	BEGIN
		Select * FROM dbo.CRED_Vista_AsignacionesPorPersona
	END
' 
END
GO
/****** Object:  Table [dbo].[CRED_TiposCredenciales]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_TiposCredenciales]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_TiposCredenciales](
	[Id] [smallint] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](30) NOT NULL,
 CONSTRAINT [PK__CRED_TiposCreden__5B301089] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[ESTR_GET_Proximo_Codigo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ESTR_GET_Proximo_Codigo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[ESTR_GET_Proximo_Codigo]
	@Nivel smallint,
	@Codigo char(24)
AS
--MINISTERIO
IF @Nivel = 0 BEGIN
	SELECT max(left(codigo,2))+1 codigo
	FROM dbo.Tabla_Areas_Estructura
END
--UNIDAD MINISTRO
IF @nivel = 1 BEGIN
	SELECT max(right(left(codigo,4),2))+1 codigo
	FROM dbo.Tabla_Areas_Estructura
	WHERE left(codigo,2) = left(@codigo,2)
END
--SECRETARIA
IF @nivel = 2 BEGIN
	SELECT max(right(left(codigo,7),3))+1 codigo
	FROM dbo.Tabla_Areas_Estructura
	WHERE left(codigo,4) = left(@codigo,4)
END
--SubSECRETARIA
IF @nivel = 3 BEGIN
	SELECT max(right(left(codigo,10),3))+1 codigo
	FROM dbo.Tabla_Areas_Estructura
	WHERE left(codigo,7) = left(@codigo,7)
END--DIRECCION GENERAL
IF @nivel = 4 BEGIN
	SELECT max(right(left(codigo,13),3))+1 codigo
	FROM dbo.Tabla_Areas_Estructura
	WHERE left(codigo,10) = left(@codigo,10)
END
--DIRECCION
IF @nivel = 5 BEGIN
	SELECT max(right(left(codigo,16),3))+1 codigo
	FROM dbo.Tabla_Areas_Estructura
	WHERE left(codigo,13) = left(@codigo,13)
END
--COORDINACION
IF @nivel = 6 BEGIN
	SELECT max(right(left(codigo,19),3))+1 codigo
	FROM dbo.Tabla_Areas_Estructura
	WHERE left(codigo,16) = left(@codigo,16)
END
--AREA
IF @nivel = 7 BEGIN
--	SELECT max(right(codigo,5))+1 codigo
	SELECT max(id_area)+1 codigo
	FROM dbo.Tabla_Areas_Estructura
END




' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Calcula_Dias_tomadosPrueba]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Calcula_Dias_tomadosPrueba]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'

CREATE  FUNCTION [dbo].[Fx_Calcula_Dias_tomadosPrueba] (@i int,
@p smallint, @c smallint)  
RETURNS int AS  
BEGIN 

	Declare @Dias int
SELECT @Dias = SUM(dias_a_tomar) FROM dbo.Licencias_Solicitadas
WHERE id_interna = @i AND concepto = @c AND periodo = @p	
	return COALESCE(@dias, 0)

END

' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_PERIODOS_EVALUACION]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_PERIODOS_EVALUACION]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <10/03/2008>
-- Description:	<Trae todos los periodos de evaluacion existentes>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_GET_PERIODOS_EVALUACION]
AS
BEGIN
	SET NOCOUNT ON;

	select id, descripcion
	from dbo.EVAL_Periodos_Evaluacion
	order by desde
END


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Servicios_Adm_Publica]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Servicios_Adm_Publica]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[LEG_GET_Servicios_Adm_Publica]
	@id int
AS

select  ambito, 
	jurisdiccion, 
	organismo, 
	cargo, 
	remunerativo, 
	fecha_desde, 
	fecha_hasta, 
	causa_egreso, 
	folio, 
	id_interna, 
	doc_titular,
	caja,
	afiliado,
	no_computa,
	id,
	datodebaja,
	datonoimprime,
	ctr_cert

from 	[dbo].servicios_adm_publica sap
where 	sap.id_interna=@id and datodebaja = 0
order by folio




' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Get_Dias_Vacaciones]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Get_Dias_Vacaciones]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: ''02/12/2008''
-- Description:	Me da los dias de vacaciones que corresponden a una antiguedad
-- =============================================
CREATE FUNCTION [dbo].[Fx_Get_Dias_Vacaciones]
(
	@fecha_min smalldatetime,
	@fecha_calculo smalldatetime,
	@antiguedad_anterior char(10)
)
RETURNS smallint
AS
BEGIN
return 
	dbo.fx_get_dias_vacaciones_segun_años_de_antiguedad
	(
		dbo.fx_get_años_de_antiguedad
		(
			dbo.fx_get_antiguedad_total_a_hoy (@fecha_min, @fecha_calculo, @antiguedad_anterior)
		)
	)

END
' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Get_Meses_de_antiguedad]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Get_Meses_de_antiguedad]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_Get_Meses_de_antiguedad] (@F1 char(8))  
RETURNS  smallint
BEGIN 
declare @return_value smallint

set @return_value = cast(left(right(@F1,5),2) as int)

RETURN isnull(@return_value,0)
END' 
END
GO
/****** Object:  Table [dbo].[WEB_Sincronizacion_Funciones]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_Sincronizacion_Funciones]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[WEB_Sincronizacion_Funciones](
	[id_funcion] [smallint] NOT NULL,
	[id_modificacion] [int] IDENTITY(1,1) NOT NULL,
	[realizada] [bit] NOT NULL,
	[fecha] [smalldatetime] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[PLA_Recibos_Recibidos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_Recibos_Recibidos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[PLA_Recibos_Recibidos](
	[id] [int] NULL,
	[id_comprobante] [int] NULL,
	[id_recibo] [int] NULL,
	[doc_firmante] [int] NULL,
	[id_cargo] [int] NULL,
	[id_area] [int] NULL,
	[fecha_alta] [smalldatetime] NULL,
	[usuario] [int] NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[IMP_Estudios_Primarios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[IMP_Estudios_Primarios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[IMP_Estudios_Primarios]
  @id_interna int,
  @operacion bit

as
if @operacion = 0 begin
	insert into dbo.imp_estudios_primarios
	Select  id_interna, 
		Certificado_Expedido_por ,
		Fecha_Egreso, 
		folio_nro
	
	from [dbo].Estudios_Realizados 
	where  	[Id_Interna] =  @Id_Interna  AND 
		[Nivel] = 2
end

if @operacion =1 begin
	delete from dbo.imp_estudios_primarios
	where id_interna = @id_interna
end



' 
END
GO
/****** Object:  Table [dbo].[CTR_Errores_Certificados]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Errores_Certificados]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CTR_Errores_Certificados](
	[fecha] [smalldatetime] NULL,
	[id_contrato] [int] NULL,
	[error] [varchar](100) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Get_Dias_de_antiguedad]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Get_Dias_de_antiguedad]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_Get_Dias_de_antiguedad] (@F1 char(8))  
RETURNS  smallint
BEGIN 
declare @return_value smallint

set @return_value = cast(right(@F1,2) as int)

RETURN isnull(@return_value, 0)
END' 
END
GO
/****** Object:  Table [dbo].[WEB_Sincronizacion_Plantas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_Sincronizacion_Plantas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[WEB_Sincronizacion_Plantas](
	[Id_Planta] [smallint] NOT NULL,
	[id_modificacion] [int] IDENTITY(1,1) NOT NULL,
	[Realizada] [bit] NOT NULL,
	[fecha] [smalldatetime] NOT NULL,
 CONSTRAINT [PK_WEB_Sincronizacion_Plantas] PRIMARY KEY CLUSTERED 
(
	[id_modificacion] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[MED_GET_Enfermedades_Preexistentes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_Enfermedades_Preexistentes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create  PROCEDURE [dbo].[MED_GET_Enfermedades_Preexistentes]     
	@Nro_Documento int 
AS    
SELECT  E.Enfermedad IdEnfermedad,  
 	TE.Descripcion  DescripcionEnfermedad
FROM dbo.MED_Enfermedades_Preexistentes E  
INNER JOIN dbo.Tabla_Medicos_Enfermedades_PreExistentes  TE  
	ON TE.Id = E.Enfermedad
WHERE nro_documento = @nro_documento  
    
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Consulta_Errores_Renovacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Consulta_Errores_Renovacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE    PROCEDURE [dbo].[CTR_GET_Consulta_Errores_Renovacion]      
 @Area_Real int=null,              
 @Area_Cont int=null,              
 @Contrato int=null,          
 @Hasta_Cont smalldatetime = null,          
 @Certificado char(1)= null             
              
AS              
SET NOCOUNT ON              
              
 create table #t              
(nro_contrato varchar(11),      
nro_documento int,          
t_id_contrato int)              
                 
 create table #t2              
(nro_documento int)              
      
 create table #tempo      
(Id_Contrato int,              
 nro_documento int,              
 Apellido varchar(100),              
 Nombre varchar(100),               
 Id_Area_Contrato int ,              
 Area_Contrato varchar(400),              
 Id_Area_Real int,              
 Area_Real varchar(400),              
 Id_tipo_Contrato int,              
 Tipo_Contrato varchar(100),               
 Desde smalldatetime,              
 Hasta smalldatetime,              
 id_nivel int,              
 nivel char(1),              
 Id_grado int,              
 grado char(2),                      
 Id_Funcion int,              
 Funcion varchar(100),              
 id_rango int,              
 Rango varchar(100),              
 monto money,                      
 Reservado char(2),                    
 nro_contrato char(11),              
 Estado char(1),              
 Id_domicilio int,              
 contrato_firmante int,              
 observacion varchar(300),              
 firmante varchar(300),              
 id_interna int)             
      
      
insert into #t              
  select max(nro_contrato), nro_documento, id_contrato               
  from dbo.ctr_contratos               
  where aprobado=1  and              
   Baja=0 and              
   Impreso = 1 and              
   Firmado = 1 AND              
   (id_area = @Area_Cont or @Area_Cont is null) and              
   (tipo_contrato = @Contrato  or @Contrato is null)      
   group by nro_documento , id_contrato             
         
insert into #t2              
  select nro_documento from dbo.ctr_contratos              
    where (estado=''R'' or estado=''E'') and baja=0 and aprobado=0              


delete from #t       
where nro_documento in (select nro_documento from #t2)               
        

IF @certificado = ''S''           
BEGIN          
 --Filtro por los contratos que tienen certificado          
 delete from #t           
 where t_id_contrato not in (select idcontrato from dbo.CTR_Antiguedad_Certificados)          
END          

IF @certificado = ''N''           
BEGIN           
 --Filtro por los contratos que no tienen certificado           
  delete from #t           
  where t_id_contrato in (select idcontrato from dbo.CTR_Antiguedad_Certificados)          
END          
         
              
insert into #tempo      
select  C.Id_Contrato,              
 C.nro_documento,              
 DP.Apellido,              
 DP.Nombre,              
 c.id_area Id_Area_Contrato,              
 NULL, --TA.descripcion Area_Contrato,              
 NULL, --da.id_area Id_Area_Real,              
 NULL, --TA2.descripcion Area_Real,              
 TC.id Id_tipo_Contrato,              
 TC.descripcion Tipo_Contrato,                
 convert (varchar(10), C.[Desde],103) Desde ,              
 convert (varchar(10), C.[Hasta],103) Hasta,              
 c.nivel id_nivel,              
 tn.nivel,              
 c.grado Id_grado,              
 tg.grado,                  
 c.funcion Id_Funcion,              
 fc.descripcion Funcion,              
 c.rango id_rango,              
 r.Descripcion Rango,              
 c.monto,                 
 case when c.reservado=1 then              
  ''SI''              
 else              
  ''NO''              
 end Reservado,                    
 c.nro_contrato,              
 c.Estado,              
 d.Id_domicilio,              
 c.contrato_firmante,              
 c.observacion,              
 DPF.apellido firmante,              
 dp.id_interna              
              
From  dbo.CTR_Contratos C              
              
left join dbo.tabla_funciones_contratos FC  --1184              
on fc.id=c.funcion              
              
inner join dbo.Datos_Personales DP              
on DP.nro_documento = C.nro_documento              
              
LEFT join dbo.domicilio_personal D              
on d.nro_doc=c.nro_documento and d.id_domicilio = (select max(id_domicilio) from domicilio_personal where nro_doc = c.nro_documento)              
              
left join dbo.Tabla_Resoluciones_Contratos TC              
 on TC.id = C.tipo_contrato         
              
-- -- -- -- -- LEFT join dbo.tabla_areas TA              
-- -- -- -- --  on TA.id = c.id_area                      
-- -- -- -- -- LEFT join dbo.vw_desglose_area da              
-- -- -- -- --  on da.documento  = c.nro_documento                    
-- -- -- -- -- LEFT join dbo.tabla_areas TA2              
-- -- -- -- --  on TA2.id = da.id_area              
              
-- -- -- -- -- --left join dbo.cfirmantes_contratos cfc              
-- -- -- -- -- -- on cfc.id=C.Contrato_Firmante              
      
LEFT join dbo.Tabla_Firmantes cfc          
 on cfc.id = C.Contrato_Firmante          
LEFT join dbo.datos_personales DPF          
 on cfc.nro_documento=DPF.nro_documento          
      
left join dbo.tabla_niveles TN              
 on tn.id=c.nivel              
              
left join dbo.tabla_grados TG              
 on tg.id=c.grado              
              
-- -- -- -- left join dbo.tabla_grado_letras TGL              
-- -- -- --  on tgl.grado=tg.grado              
              
left join dbo.ccontrato_funciones CCF  --1421              
on ccf.id_nivel=tn.id              
              
left join dbo.tabla_rangos R              
 on r.id=c.rango              
              
INNER JOIN #t t              
on t.nro_contrato = c.nro_contrato              
              
  
update #tempo      
set  Area_Contrato = TA.descripcion,              
  Id_Area_Real = da.id_area,              
  Area_Real = TA2.descripcion      
from #tempo t      
       
LEFT join dbo.tabla_areas TA              
 on TA.id = t.Id_Area_Contrato             
      
LEFT join dbo.vw_desglose_area da              
 on da.documento  = t.nro_documento             
              
LEFT join dbo.tabla_areas TA2              
 on TA2.id = da.id_area         
              
      
select t.Nro_Documento, t.Apellido, t.Nombre, t.Id_Contrato, convert(char(10),e.fecha,103) Fecha_Proceso, e.Error
from #tempo T
inner join dbo.ctr_errores_certificados E
	on T.Id_Contrato = E.id_contrato
order by Apellido, Nombre       
      
            
drop table #t              
drop table #t2              
drop table #tempo              

' 
END
GO
/****** Object:  Table [dbo].[CRED_Organismos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Organismos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_Organismos](
	[Id] [smallint] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[ImagenCredencial] [varchar](150) NULL,
	[TemplateWord] [varchar](150) NULL,
 CONSTRAINT [PK__CRED_Organismos__60E8E9DF] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_Unidades_Evaluacion_Evaluador]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_Unidades_Evaluacion_Evaluador]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[EVAL_GET_Unidades_Evaluacion_Evaluador]
@id_evaluador int, @id_periodo int as

SELECT id_area 
FROM dbo.EVAL_Evaluadores_Areas
WHERE id_evaluador = @id_evaluador AND id_periodo = @id_periodo


' 
END
GO
/****** Object:  StoredProcedure [dbo].[IMP_Estudios_Realizados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[IMP_Estudios_Realizados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[IMP_Estudios_Realizados]
	@id_interna int
as

insert into dbo.imp_Estudios_realizados
select	Establecimeinto,
	Depende_de,
	Titulo,
	Expedido_por,
	Fecha,
	Tesis_Tema,
	Cant_Horas_Totales,
	Cant_Horas_Cursadas,
	Cant_Materias_Totales,
	Cant_Materias_Aprob,
	Tesis_Nota
from [dbo].Estudios_Otros
where  Id_Interna  =@Id_Interna

UNION

-- nivel 4 o superior
Select Facultad	,
	Depende_de,
	Titulo,
	Exped_Revalid_Por,
	Fecha_Egreso,
	'''',
	0,
	0,
	Cant_Materias_Totales,
	Cant_Materias_Aprob,
	0

from [dbo].Estudios_Realizados  ER
inner join tabla_nivel_estudios NE
	on NE.id = er.nivel

where  ([Id_Interna] =  @Id_Interna) AND ne.cod_gest_pub in (''T'', ''U'')


' 
END
GO
/****** Object:  Table [dbo].[WEB_Sincronizacion_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_Sincronizacion_Usuarios]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[WEB_Sincronizacion_Usuarios](
	[id_Usuario] [smallint] NOT NULL,
	[Id_Modificacion] [int] IDENTITY(1,1) NOT NULL,
	[Realizada] [bit] NOT NULL,
	[fecha] [smalldatetime] NOT NULL,
 CONSTRAINT [PK_WEB_Sincronizacion_Usuarios] PRIMARY KEY CLUSTERED 
(
	[Id_Modificacion] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Niveles]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Niveles]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Niveles](
	[Id] [smallint] NOT NULL,
	[Nivel] [varchar](5) NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Niveles] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[MED_UPD_Atencion_Licencia]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_UPD_Atencion_Licencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[MED_UPD_Atencion_Licencia]
	@IdAtencion int,
	@IdLicencia int
AS
UPDATE dbo.MED_Atenciones
SET IdLicencia = @IdLicencia
WHERE Id = @IdAtencion

' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_INS_Periodo_Evaluacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_INS_Periodo_Evaluacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <18/03/2008>
-- Description:	<Da de alta la cabecera de un periodo de evaluacion>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_INS_Periodo_Evaluacion]
@desde smalldatetime, 
@hasta smalldatetime, 
@descripcion varchar(100),
@id_interna_coordinador int,
@baja bit,
@id_generado int output
AS

BEGIN
	SET NOCOUNT ON;
	

	insert into dbo.EVAL_Periodos_Evaluacion
	(desde, hasta, descripcion, id_interna_coordinador, baja)
	values
	(@desde, @hasta, @descripcion, @id_interna_coordinador, @baja)

	set @id_generado = (select max(id) from dbo.EVAL_Periodos_Evaluacion)
END


' 
END
GO
/****** Object:  Table [dbo].[Partidos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Partidos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Partidos](
	[Partido] [smallint] NOT NULL,
	[Codigo] [varchar](3) NULL,
	[Descripcion] [varchar](40) NULL,
	[Cod_Prov] [smallint] NULL,
	[Baja] [varchar](1) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[PLA_ADD_PLANTELES_LEGAJOS]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_ADD_PLANTELES_LEGAJOS]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[PLA_ADD_PLANTELES_LEGAJOS]
	@Descripcion varchar(50),
	@Id_Interna int,
	@Envio smallint
as
DECLARE @Id int
set @id = (Select max(id)+1 from dbo.TMP_PLANTELES_LEGAJOS)
if @id is null begin
	set @id = 1
end

INSERT INTO dbo.TMP_PLANTELES_LEGAJOS (id,descripcion,id_interna,envio,fecha_envio)
VALUES (@id,
	@Descripcion ,
	@Id_Interna ,
	@Envio,
	getdate())	

	
	



' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_ReportesPedidosDeAltas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_ReportesPedidosDeAltas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		FC
-- Create date: 05/01/2012
-- Descripción:	
-- =============================================
create procedure [dbo].[CRED_ReportesPedidosDeAltas]
as
	BEGIN
		Select * FROM dbo.CRED_ConsultaPedidoDeAltas
	END
' 
END
GO
/****** Object:  Table [dbo].[Tabla_Grados]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Grados]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Grados](
	[Id] [smallint] NOT NULL,
	[Grado] [varchar](5) NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Grados] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[GU_Facturas_Guarderia]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GU_Facturas_Guarderia]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[GU_Facturas_Guarderia](
	[id_interna] [int] NOT NULL,
	[Periodo] [varchar](7) NOT NULL,
	[Fecha_Factura] [datetime] NOT NULL,
	[comprobante] [varchar](11) NOT NULL,
	[CUIT] [varchar](11) NOT NULL,
	[importe] [money] NOT NULL,
	[Observaciones] [text] NULL,
	[Usuario] [smallint] NOT NULL,
	[FechaCarga] [datetime] NOT NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[EVAL_SET_EVALUADOR_AGENTE]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_SET_EVALUADOR_AGENTE]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <13/03/2008>
-- Description:	<Trae los datos de un periodo>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_SET_EVALUADOR_AGENTE]
	@id_agente int, @id_evaluador int, @id_periodo int
AS
BEGIN
	SET NOCOUNT ON;

	DELETE FROM dbo.Eval_Evaluadores_Agentes
	WHERE id_agente = @id_agente and id_periodo = @id_periodo

	INSERT INTO dbo.Eval_Evaluadores_Agentes
	(id_agente, id_evaluador, id_periodo)

	VALUES
	(@id_agente, @id_evaluador, @id_periodo)
END

' 
END
GO
/****** Object:  Table [dbo].[Antec_Militares]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Antec_Militares]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Antec_Militares](
	[Cumplido] [varchar](20) NOT NULL,
	[Fuerza_Armada] [varchar](50) NULL,
	[Fecha_Baja] [smalldatetime] NULL,
	[Causa] [varchar](50) NULL,
	[Cumplido_en] [varchar](50) NULL,
	[Exalumno_de] [varchar](50) NULL,
	[Nombre_Escuela] [varchar](50) NULL,
	[Paso_Reserva] [varchar](50) NULL,
	[Reserva_Perm_de] [varchar](50) NULL,
	[Años_Servicio] [smallint] NULL,
	[Meses_Servicio] [smallint] NULL,
	[Ultimo_Destino] [varchar](50) NULL,
	[Ultimo_Cargo] [varchar](50) NULL,
	[Grado_Reserva] [varchar](50) NULL,
	[Id_Interna] [int] NOT NULL,
	[Legajo] [int] NOT NULL,
 CONSTRAINT [PK_Antec Militares] PRIMARY KEY NONCLUSTERED 
(
	[Id_Interna] ASC,
	[Legajo] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CRED_ConceptoRelacion]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_ConceptoRelacion]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_ConceptoRelacion](
	[Id] [smallint] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
 CONSTRAINT [PK__CRED_ConceptoRel__66A1C335] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Listar_Dependencias_Areas]    Script Date: 07/19/2012 19:45:11 ******/
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Listar_Dependencias_Areas]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_Listar_Dependencias_Areas]  (@Area int)  
RETURNS @RptD TABLE (Codigo int)  AS

BEGIN

	Declare @nivel int
	Declare @Codigo varchar(24)

	set @codigo = (select top 1 codigo from tabla_areas_estructura where id_area = @Area and right(codigo,5)=''00000'')
	
	IF RIGHT(LEFT(@codigo,19),3) >= ''001''  BEGIN
		set @Nivel = 19
	END
	ELSE IF RIGHT(LEFT(@codigo,16),3) >= ''001''  BEGIN
		set @Nivel = 16
	END 
	ELSE IF RIGHT(LEFT(@codigo,13),3) >= ''001''  BEGIN
		set @Nivel = 13
	END
	ELSE IF RIGHT(LEFT(@codigo,10),3) >= ''001''  BEGIN
		set @Nivel = 10
	END
	ELSE IF RIGHT(LEFT(@codigo,7),3) >= ''001''  BEGIN
		set @Nivel = 7
	END
	ELSE IF RIGHT(LEFT(@codigo,4),2) >= ''001''  BEGIN
		set @Nivel = 4
	END


	insert @Rptd	
	select distinct id_area from tabla_areas_estructura 	where left(codigo,@nivel) = left(@codigo,@nivel)	

	RETURN

END









' 
END
GO
/****** Object:  Table [dbo].[GU_Recibos_Haberes]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GU_Recibos_Haberes]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[GU_Recibos_Haberes](
	[id_interna] [int] NOT NULL,
	[Fecha] [datetime] NULL,
	[Monto] [varchar](6) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[EVAL_SET_Evaluador_Area]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_SET_Evaluador_Area]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <04/04/2008>
-- Description:	<Asigna un evaluador a un area>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_SET_Evaluador_Area]
	@id_area int, @id_evaluador int, @id_periodo int
AS
BEGIN
	SET NOCOUNT ON;

	DELETE FROM dbo.Eval_Evaluadores_Areas
	WHERE id_area = @id_area and id_periodo = @id_periodo

	INSERT INTO dbo.Eval_Evaluadores_Areas
	(id_area, id_evaluador, id_periodo)

	VALUES
	(@id_area, @id_evaluador, @id_periodo)
END

' 
END
GO
/****** Object:  Table [dbo].[Tabla_Resoluciones_Contratos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Resoluciones_Contratos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Resoluciones_Contratos](
	[Id] [smallint] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[Tipo_Contrato] [smallint] NOT NULL,
	[Monto_Desde] [money] NOT NULL,
	[Monto_Hasta] [money] NOT NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Resoluciones_Contratos] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[ZZZZ_LAN_a_WEB]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ZZZZ_LAN_a_WEB]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ZZZZ_LAN_a_WEB]
AS

-- lan a aduana
exec sincro_rh.dbo.Cargar_Sincro_RH_noche

-- aduana a web
exec webrh.dbo.Leer_Sincro_RH



' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Solicitudes_Periodo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Solicitudes_Periodo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ASIS_GET_Solicitudes_Periodo] 
@id_interna int,
@concepto int,
@Desde smalldatetime,
@Hasta smalldatetime
AS

SELECT 
COUNT (*) [cantidadSolicitudes]
FROM [dbo].[ASIS_Solicitudes_Licencia_Web] [SW]

WHERE	[SW].[id_interna] = @id_interna 
	AND [Desde] = @Desde
	AND [Hasta] = @Hasta
	AND [Concepto] = @concepto

' 
END
GO
/****** Object:  Table [dbo].[CFacturas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CFacturas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CFacturas](
	[Id] [smallint] NULL,
	[Legajo] [int] NULL,
	[Id_contrato] [smallint] NULL,
	[Cuil] [char](14) NULL,
	[Mes_factura] [smallint] NULL,
	[Año_factura] [int] NULL,
	[Nro_factura] [varchar](20) NULL,
	[Fecha_factura] [smalldatetime] NULL,
	[Fecha_recibida] [smalldatetime] NULL,
	[Fecha_pase] [smalldatetime] NULL,
	[Nro_pase] [int] NULL,
	[Nro_resolucion] [varchar](30) NULL,
	[Acto_tipo] [smallint] NULL,
	[Monto] [money] NULL,
	[Anulada] [smallint] NULL,
	[Observacion_Anulada] [text] NULL,
	[Id_Area] [int] NULL,
	[Id_Secretaria] [int] NULL,
	[Id_Firma] [smallint] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Nacionalidad]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Nacionalidad]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Nacionalidad](
	[Id] [smallint] NOT NULL,
	[Descripcion] [varchar](50) NULL,
	[Naturaliza] [bit] NOT NULL,
	[Baja] [bit] NOT NULL,
	[Arg] [bit] NULL,
	[Codigo_Banco_Nacion] [char](2) NULL,
 CONSTRAINT [PK_Tabla_Nacionalidad] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[ZZZZ_WEB_a_LAN]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ZZZZ_WEB_a_LAN]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ZZZZ_WEB_a_LAN]
AS
--web a aduana
exec sincro_webrh.dbo.Cargar_Sincro_WebRH

-- aduana a lan
exec db_rrhh.dbo.Leer_Sincro_WebRH



' 
END
GO
/****** Object:  Table [dbo].[GU_Cert_Nacimiento]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GU_Cert_Nacimiento]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[GU_Cert_Nacimiento](
	[id_interna] [int] NOT NULL,
	[id_Fam] [int] NOT NULL,
	[Id] [int] NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[MED_UPD_Licencia_X_Atencion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_UPD_Licencia_X_Atencion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[MED_UPD_Licencia_X_Atencion]
	@IdAtencion int,
	@IdLicencia int
AS
	UPDATE	dbo.MED_Atenciones
	SET 	IdLicencia = @IdLicencia
	WHERE 	Id = @IdAtencion




' 
END
GO
/****** Object:  View [dbo].[VW_Tipos_Resoluciones]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tipos_Resoluciones]'))
EXEC dbo.sp_executesql @statement = N'


CREATE   VIEW [dbo].[VW_Tipos_Resoluciones]
AS
SELECT top 100 percent *
FROM Tabla_Tipos_Resoluciones
where baja =0

order by Descripcion





'
GO
/****** Object:  Table [dbo].[PLA_Tipo_Liquidacion]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_Tipo_Liquidacion]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[PLA_Tipo_Liquidacion](
	[Id] [int] NULL,
	[Descripcion] [varchar](100) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Desglose_FE]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Desglose_FE]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_GET_Desglose_FE]
	@Documento int,
	@Id_Interna int
AS
SELECT 	nivel_fe,
	tipo_fe,
	desde,
	isnull(hasta,'''') hasta,
	case when baja =1 then
		acto_tipo_baja
	else
		acto_tipo
	end Acto_Tipo,
	case when baja =1 then
		acto_nro_baja
	else
		acto_nro
	end Acto_Nro,
	case when baja =1 then
		isnull(acto_fecha_baja,'''')
	else
		isnull(acto_fecha,'''')
	end Acto_fecha,
	baja,
	Tratamiento,
	Id_area
FROM 	dbo.LEG_Desglose_FE
WHERE 	documento = @documento AND
	id = (select max(id) from dbo.LEG_Desglose_FE where documento = @Documento)
	





' 
END
GO
/****** Object:  Table [dbo].[GU_DDJJ_Guarderia]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GU_DDJJ_Guarderia]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[GU_DDJJ_Guarderia](
	[id_interna] [int] NOT NULL,
	[id_fam] [int] NOT NULL,
	[Guarderia] [varchar](100) NOT NULL,
	[Horario] [varchar](10) NULL,
	[Fecha] [datetime] NULL,
	[CUIT] [varchar](11) NOT NULL,
	[Calle] [varchar](50) NOT NULL,
	[Nro] [smallint] NULL,
	[Piso] [varchar](2) NULL,
	[Dpto] [varchar](2) NULL,
	[CP] [int] NOT NULL,
	[Localidad] [int] NOT NULL,
	[Telefono] [varchar](20) NULL,
	[FechaPresentacion] [datetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[RH_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_Usuarios]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[RH_Usuarios](
	[Id] [smallint] NOT NULL,
	[Nombre] [char](15) NOT NULL,
	[Password] [varchar](60) NOT NULL,
	[Vence_Passw] [smalldatetime] NOT NULL,
	[Baja] [bit] NOT NULL,
	[Fecha_Baja] [smalldatetime] NULL,
	[Actualizar_Passw] [bit] NOT NULL,
	[Administrador] [bit] NOT NULL,
 CONSTRAINT [PK_RH_Usuarios] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY],
 CONSTRAINT [IX_RH_Usuarios] UNIQUE NONCLUSTERED 
(
	[Nombre] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[EVAL_UPD_Periodo_Evaluacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_UPD_Periodo_Evaluacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <27/03/2008>
-- Description:	<Modifica los datos de un periodo de evaluacion>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_UPD_Periodo_Evaluacion]
@id_periodo int, 
@desde smalldatetime, 
@hasta smalldatetime, 
@descripcion varchar(100), 
@id_interna_coordinador int,
@baja bit

AS

BEGIN
	SET NOCOUNT ON;
	
	update dbo.EVAL_Periodos_Evaluacion
	set desde = @desde,
	hasta = @hasta,
	descripcion = @descripcion,
	id_interna_coordinador = @id_interna_coordinador,
	baja = @baja
	where id = @id_periodo
	
END


' 
END
GO
/****** Object:  Table [dbo].[EVAL_Conceptos_Preguntas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_Conceptos_Preguntas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[EVAL_Conceptos_Preguntas](
	[id_concepto] [smallint] NOT NULL,
	[descripcion] [varchar](100) NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Estudios_Realizados]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Estudios_Realizados]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Estudios_Realizados](
	[Nivel] [smallint] NOT NULL,
	[id_establecimiento] [smallint] NOT NULL,
	[Certificado_Expedido_por] [varchar](50) NULL,
	[Fecha_Ingreso] [datetime] NULL,
	[Fecha_Egreso] [datetime] NULL,
	[Facultad] [varchar](100) NULL,
	[Depende_de] [varchar](100) NULL,
	[Titulo] [varchar](100) NULL,
	[Exped_Revalid_Por] [varchar](100) NULL,
	[Matricula_Nro] [varchar](50) NULL,
	[Folio_Nro] [char](10) NOT NULL,
	[Id_Interna] [int] NOT NULL,
	[Nro_Doc] [int] NOT NULL,
	[Cant_Materias_Totales] [smallint] NULL,
	[Cant_Materias_Aprob] [smallint] NULL,
	[id_estudio] [int] NOT NULL,
	[Completo] [bit] NOT NULL,
	[DatoDeBaja] [bit] NULL,
	[DatoNoImprime] [bit] NULL,
 CONSTRAINT [PK_Estudios_Realizados] PRIMARY KEY CLUSTERED 
(
	[id_estudio] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[EVAL_Evaluadores_Agentes]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_Evaluadores_Agentes]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[EVAL_Evaluadores_Agentes](
	[Id] [int] NOT NULL,
	[id_agente] [int] NOT NULL,
	[id_evaluador] [int] NOT NULL,
	[id_periodo] [int] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[cred_personasrelevadas_bkp]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[cred_personasrelevadas_bkp]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[cred_personasrelevadas_bkp](
	[Documento] [int] NOT NULL,
	[Apellido] [varchar](50) NOT NULL,
	[Nombre] [varchar](50) NOT NULL,
	[Lugar_de_trabajo] [varchar](8) NOT NULL,
	[Telefono] [varchar](26) NOT NULL,
	[Email_mds] [varchar](60) NOT NULL,
	[Email_personal] [varchar](60) NOT NULL,
	[Fecha_comunicacion] [smalldatetime] NULL,
	[IdBaja] [int] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[TMP_FACTURACION_CONTRATO]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[TMP_FACTURACION_CONTRATO]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[TMP_FACTURACION_CONTRATO](
	[legajo] [int] NULL,
	[id_contrato] [smallint] NULL,
	[id_sec] [int] NULL,
	[id_dep] [int] NULL,
	[id_firma] [int] NULL,
	[envio] [varchar](20) NULL,
	[recibio] [varchar](20) NULL,
	[Fecha_envio] [smalldatetime] NULL,
	[Fecha_recibida] [smalldatetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Agrupamiento]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Agrupamiento]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Agrupamiento](
	[id] [smallint] NOT NULL,
	[descripcion] [varchar](20) NULL,
	[baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Agrupamiento] PRIMARY KEY NONCLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Desglose_UR]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Desglose_UR]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_GET_Desglose_UR]        
 @Documento int,        
 @estado char(2)        
AS        
    
SET NOCOUNT ON    
    
create table #Tempo     
(Id  int,    
Id_interna int,    
Documento int,     
Id_area  bigint,     
Desc_Area varchar (200),    
Cant_UR  int,     
Desde  datetime,    
Hasta  datetime,    
Acto_Tipo varchar(20),    
Acto_Nro varchar (10),    
Acto_Fecha datetime,    
Acto_Tipo_Baja varchar(20),
Acto_Nro_Baja varchar (10),    
Acto_Fecha_Baja datetime,    
Baja  bit,    
Usuario  smallint,    
Acto_Firmante varchar(100),    
Acto_Firmante_Baja varchar(100),    
Exp_Nro varchar(30),    
Id_Tipo_UR int,  
Tipo_UR varchar(100),  
estado char (2))    
    
    
 INSERT INTO #Tempo    
 SELECT  UR.id,        
  ur.Id_interna,    
  ur.Documento,    
   UR.id_area,        
   ta.descripcion Desc_Area,        
   UR.cant_ur,        
  isnull(UR.desde,'''') Desde,        
  isnull(UR.hasta,'''') Hasta,        
  isnull(tr1.descripcion,'''') Acto_Tipo,        
  isnull(UR.acto_nro,''''),        
  isnull(UR.acto_fecha,'''') Acto_Fecha,    
  isnull(tr2.descripcion,'''') Acto_Tipo_Baja,    
  isnull(UR.Acto_Nro_Baja,''''),    
  isnull(UR.Acto_Fecha_Baja,'''') Acto_Fecha_Baja,    
  UR.Baja,    
  UR.Usuario,    
  isnull(ttt.Descripcion +'' ''+ DPF.Apellido +'' ''+ DPF.Nombre  ,'''') Acto_Firmante,    
  isnull(tttB.Descripcion +'' ''+ DPFB.Apellido +'' ''+ DPFB.Nombre  ,'''') Acto_Firmante_Baja,    
  isnull(UR.Exp_Nro,'''') Exp_Nro,  
  ur.Tipo_UR id_Tipo_UR, 
  tur.descripcion Tipo_UR,   
  UR.estado  
 FROM  dbo.LEG_Desglose_UR UR        
 INNER JOIN dbo.Tabla_Areas TA        
   	ON TA.id = UR.Id_Area        
 INNER JOIN dbo.LEG_Tabla_Tipo_URetributivas TUR    
  	ON TUR.id = ur.tipo_ur    
 LEFT join dbo.tabla_tipos_resoluciones TR1    
 	on TR1.id = ur.acto_tipo 
 LEFT join dbo.tabla_tipos_resoluciones TR2    
 	on TR2.id = ur.acto_tipo_baja 

LEFT join dbo.Tabla_Firmantes TFC    
 on TFC.id = ur.Acto_Firmante    
LEFT join dbo.datos_personales DPF    
 on TFC.nro_documento = DPF.nro_documento    
LEFT join dbo.tabla_tratamientos TT    
 on TT.id = tfc.id_tratamiento    
LEFT join dbo.tabla_tratamientos_titulos TTT    
 on TTT.id = tfc.id_titulo

LEFT join dbo.Tabla_Firmantes TFCB    
 on TFCB.id = ur.Acto_Firmante_Baja    
LEFT join dbo.datos_personales DPFB    
 on TFCB.nro_documento = DPFB.nro_documento    
LEFT join dbo.tabla_tratamientos TTB    
 on TTB.id = TFCB.id_tratamiento    
LEFT join dbo.tabla_tratamientos_titulos TTTB    
 on TTTB.id = TFCB.id_titulo

 WHERE   documento = @Documento       
 ORDER BY convert(datetime,Desde) Desc        
    
    
--APROBADAS    
IF @estado = ''A''     
BEGIN     
 SELECT  * FROM #Tempo     
 WHERE  baja = 0    
 and estado = ''A''  
 RETURN    
END    
    
    
--NO APROBADAS        
IF @estado = ''NA''     
BEGIN     
 SELECT * FROM #Tempo     
 WHERE  baja = 0    
 and estado = ''NA''  
 RETURN    
END    
        
      
--APROBADAS    
IF @estado = ''B''     
BEGIN     
 SELECT * FROM #Tempo     
 WHERE  baja = 1    
 RETURN    
END    
    
    
--TODAS    
IF @estado = ''T''     
BEGIN     
 SELECT * FROM #Tempo     
 RETURN    
END    
  





' 
END
GO
/****** Object:  StoredProcedure [dbo].[GET_HostId]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GET_HostId]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[GET_HostId]
as

Select Host_Id() HostId
' 
END
GO
/****** Object:  Table [dbo].[EVAL_Evaluadores_Areas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_Evaluadores_Areas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[EVAL_Evaluadores_Areas](
	[id] [int] NOT NULL,
	[id_area] [int] NOT NULL,
	[id_evaluador] [int] NOT NULL,
	[id_periodo] [int] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Log_RRHH]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Log_RRHH]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Log_RRHH](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[idusuario] [int] NULL,
	[fecha] [smalldatetime] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[cred_domicilios_bkp]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[cred_domicilios_bkp]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[cred_domicilios_bkp](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[Documento] [int] NOT NULL,
	[Calle] [varchar](50) NOT NULL,
	[Numero] [varchar](6) NOT NULL,
	[Piso] [varchar](3) NOT NULL,
	[Depto] [varchar](255) NOT NULL,
	[Casa] [varchar](20) NOT NULL,
	[Manzana] [varchar](20) NOT NULL,
	[Torre] [varchar](20) NOT NULL,
	[Uf] [varchar](20) NOT NULL,
	[Codigo_postal] [varchar](12) NOT NULL,
	[Localidad] [varchar](60) NOT NULL,
	[Barrio] [varchar](50) NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[EVAL_Formularios]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_Formularios]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[EVAL_Formularios](
	[id_formulario] [smallint] NOT NULL,
	[id_nivel] [smallint] NOT NULL,
	[baja] [bit] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_DEL_Limpiar_Expediente]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_DEL_Limpiar_Expediente]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_DEL_Limpiar_Expediente]
	@Id [int]
	
AS
UPDATE dbo.CTR_Contratos  
SET Exp_Nro=NULL
WHERE  Id_contrato = @id

' 
END
GO
/****** Object:  Table [dbo].[Autorizaciones_Licencias_tmp]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Autorizaciones_Licencias_tmp]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Autorizaciones_Licencias_tmp](
	[Id_Interna] [int] NOT NULL,
	[Dias_Autorizados] [smallint] NOT NULL,
	[Id_Concepto_Licencia] [smallint] NOT NULL,
	[Periodo] [smallint] NOT NULL,
	[Id] [int] IDENTITY(77298,1) NOT NULL,
	[Dias_Tomados] [smallint] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Otros_Indice_Documentos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Otros_Indice_Documentos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Otros_Indice_Documentos](
	[Jurisdicción] [varchar](50) NOT NULL,
	[Organismo] [varchar](50) NOT NULL,
	[Tipo] [varchar](50) NULL,
	[Foja] [char](10) NOT NULL,
	[Fecha_Agregado] [datetime] NOT NULL,
	[Agr_Intervino] [nvarchar](25) NULL,
	[Des_Fecha] [datetime] NULL,
	[Des_Intervino] [varchar](50) NULL,
	[Id_Interna] [int] NOT NULL,
	[Legajo] [int] NULL,
	[Id] [int] NULL,
	[DatoDeBaja] [bit] NULL,
	[DatoNoImprime] [bit] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CRED_Localidades]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Localidades]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_Localidades](
	[Id] [smallint] NOT NULL,
	[codigo_postal] [smallint] NOT NULL,
	[id_localidad] [smallint] NOT NULL,
	[nombre_localidad] [varchar](50) NOT NULL,
 CONSTRAINT [PK__CRED_Localidades__6F370936] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[MED_Enfermedades_Preexistentes]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_Enfermedades_Preexistentes]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[MED_Enfermedades_Preexistentes](
	[Nro_Documento] [int] NULL,
	[Enfermedad] [int] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Usuarios_Modulos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Usuarios_Modulos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Usuarios_Modulos](
	[Id_Usuario] [smallint] NOT NULL,
	[Id_Modulo] [smallint] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[CTR_Temporal_Experiencias_Reconocidas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Temporal_Experiencias_Reconocidas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CTR_Temporal_Experiencias_Reconocidas](
	[HostId] [varchar](10) NULL,
	[Id] [int] NULL,
	[Desde] [datetime] NULL,
	[Hasta] [datetime] NULL,
	[DesdeNuevo] [datetime] NULL,
	[HastaNuevo] [datetime] NULL,
	[Meses] [int] NULL,
	[Orden] [int] NULL,
	[Tipo] [char](1) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[EVAL_Niveles]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_Niveles]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[EVAL_Niveles](
	[id_nivel] [smallint] NOT NULL,
	[Descripcion] [varchar](50) NOT NULL,
	[Detalle] [varchar](500) NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[RPT_EVAL_Formulario_Desempeño]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_EVAL_Formulario_Desempeño]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[RPT_EVAL_Formulario_Desempeño]
	@Nivel smallint,
	@Id_Interna int
AS
SELECT
	[id_Concepto] ,
	c.Concepto,
	[Enunciado],
	[Opcion1] ,
	[Opcion2] ,
	[Opcion3] ,
	[Opcion4] ,
	[Opcion5] ,
	c.Concepto +'': ''+ enunciado Descripcion,
	case when opcion = 1 then
		''X''
	else
		''''
	end R1,
	case when opcion = 2 then
		''X''
	else
		''''
	end R2,
	case when opcion = 3 then
		''X''
	else
		''''
	end R3,
	case when opcion = 4 then
		''X''
	else
		''''
	end R4,
	case when opcion = 5 then
		''X''
	else
		''''
	end R5
FROM dbo.EVAL_Conceptos C
INNER JOIN dbo.EVAL_Calificaciones_Agentes_Cabecera AC
	on AC.Id_interna_Agente = @Id_Interna and
	Actual = 1
INNER JOIN dbo.EVAL_Calificaciones_Agentes_Detalle AD
	ON AD.Id_Calificacion = AC.Id_Calificacion AND
	AD.Concepto = C.Id_Concepto  
WHERE 
	[Nivel]  = @Nivel




' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[fx_son_fechas_cercanas]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[fx_son_fechas_cercanas]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'-- =============================================  
-- Author:  Agustin  
-- Create date: ''02/02/2012''  
-- Description: devuelve si la fecha uno esta en +/- 5 dias de la fecha dos  
-- =============================================  
CREATE FUNCTION [dbo].[fx_son_fechas_cercanas]  
(  
 @fecha1 smalldatetime,  
 @fecha2 smalldatetime  
)  
RETURNS bit  
AS  
BEGIN  
   
 if @fecha1 is null begin return 0 end  
  
 declare @resultado bit   
  
 if (@fecha1 >= @fecha2 - 5 and @fecha1 <= @fecha2 + 5)  
 begin  
  set @resultado = 1  
 end else begin  
  set @resultado = 0  
 end  
  
 return @resultado  
END  ' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Listar_Areas_Dependencia]    Script Date: 07/19/2012 19:45:11 ******/
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Listar_Areas_Dependencia]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_Listar_Areas_Dependencia]  (@Codigo char(24))  
RETURNS @RptD TABLE (Codigo int)  AS

BEGIN

	Declare @nivel int
--	Declare @Codigo varchar(24)

--	set @codigo = (select top 1 codigo from tabla_areas_estructura where id_area = @Area and right(codigo,5)=''00000'')
	
	IF RIGHT(LEFT(@codigo,19),3) >= ''001''  BEGIN
		set @Nivel = 19
	END
	ELSE IF RIGHT(LEFT(@codigo,16),3) >= ''001''  BEGIN
		set @Nivel = 16
	END 
	ELSE IF RIGHT(LEFT(@codigo,13),3) >= ''001''  BEGIN
		set @Nivel = 13
	END
	ELSE IF RIGHT(LEFT(@codigo,10),3) >= ''001''  BEGIN
		set @Nivel = 10
	END
	ELSE IF RIGHT(LEFT(@codigo,7),3) >= ''001''  BEGIN
		set @Nivel = 7
	END
	ELSE IF RIGHT(LEFT(@codigo,4),2) >= ''001''  BEGIN
		set @Nivel = 4
	END


	insert @Rptd	
	select distinct id_area from tabla_areas_estructura 	where left(codigo,@nivel) = left(@codigo,@nivel)	

	RETURN

END










' 
END
GO
/****** Object:  Table [dbo].[GEN_ObraSocial]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GEN_ObraSocial]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[GEN_ObraSocial](
	[Id] [smallint] NOT NULL,
	[Sigla] [varchar](50) NULL,
	[Nombre] [varchar](200) NULL,
	[RNOS] [varchar](50) NULL,
	[Baja] [bit] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[WEB_Sincronizacion_Pases]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_Sincronizacion_Pases]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[WEB_Sincronizacion_Pases](
	[Id_Pase] [int] NOT NULL,
	[Id_modificacion] [int] IDENTITY(1,1) NOT NULL,
	[Realizada] [bit] NOT NULL,
	[fecha] [smalldatetime] NOT NULL,
 CONSTRAINT [PK_WEB_Sincronizacion_Pases] PRIMARY KEY CLUSTERED 
(
	[Id_modificacion] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Licencias]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Licencias]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Licencias](
	[Jurisdicción] [varchar](50) NULL,
	[Organismo] [varchar](50) NULL,
	[Año] [smallint] NULL,
	[Lic_Ord_Dias] [smallint] NULL,
	[Lic_Ord_Año] [smallint] NULL,
	[Licencia_Especial_Concepto] [varchar](50) NULL,
	[Licencia_Especial_Motivo] [varchar](50) NULL,
	[Lic_Esp_Dias] [smallint] NULL,
	[Regimen_Tipo] [nvarchar](25) NULL,
	[Regimen_Nro] [nvarchar](15) NULL,
	[Folio] [char](10) NULL,
	[Id_Interna] [int] NOT NULL,
	[Legajo] [int] NULL,
	[id] [smallint] NULL,
	[Concepto_Licencia] [smallint] NULL,
	[id_autorizacion] [int] NULL,
	[Fecha_Inicio] [smalldatetime] NULL,
	[Fecha_Fin] [smalldatetime] NULL,
	[DatoDeBaja] [bit] NULL,
	[datonoimprime] [bit] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[ASIS_Interrupcion_Licencias]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Interrupcion_Licencias]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ASIS_Interrupcion_Licencias](
	[Documento] [int] NULL,
	[Fecha] [smalldatetime] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[CRED_Parametros]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Parametros]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_Parametros](
	[Id] [smallint] IDENTITY(1,1) NOT NULL,
	[Codigo] [smallint] NOT NULL,
	[Valor] [varchar](50) NOT NULL,
 CONSTRAINT [PK__CRED_Parametros__74EFE28C] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Tipos_Resoluciones]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Tipos_Resoluciones]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Tipos_Resoluciones](
	[id] [smallint] NOT NULL,
	[descripcion] [varchar](20) NULL,
	[Baja] [bit] NOT NULL,
	[abrebiatura] [varchar](15) NULL,
 CONSTRAINT [PK_Tabla_Tipos_Resoluciones] PRIMARY KEY NONCLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Tratamientos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Tratamientos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Tratamientos](
	[Id] [int] NULL,
	[Descripcion] [varchar](50) NULL,
	[Baja] [bit] NULL,
	[Tipo] [char](1) NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_GET_IdGrado_Fecha]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_GET_IdGrado_Fecha]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_GET_IdGrado_Fecha]  (@id_interna int, @fecha datetime)  
RETURNS   int AS  
BEGIN 

Return (	SELECT TOP 1	Id_Grado
	FROM dbo.leg_desglose_NivelGrado 
	WHERE Id_interna = @Id_interna and  desde <=  @fecha
	Order by desde desc)


END

' 
END
GO
/****** Object:  Table [dbo].[LEG_ObraSocial]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ObraSocial]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_ObraSocial](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[Documento] [int] NOT NULL,
	[idObraSocial] [smallint] NOT NULL,
	[nroAfiliado] [varchar](30) NOT NULL,
	[fhDesde] [smalldatetime] NOT NULL,
	[folio] [char](10) NOT NULL,
	[Habilitada_ReciboHaberes] [bit] NOT NULL,
	[usuarioProceso] [int] NOT NULL,
	[fhProceso] [smalldatetime] NOT NULL,
	[bBaja] [bit] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Motivos_Reservas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Motivos_Reservas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Motivos_Reservas](
	[Id] [smallint] NULL,
	[Descripcion] [varchar](100) NULL,
	[Baja] [bit] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_ObraSocial]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_ObraSocial]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_ObraSocial](
	[Id] [smallint] NOT NULL,
	[Sigla] [varchar](50) NULL,
	[Nombre] [varchar](200) NULL,
	[RNOS] [varchar](50) NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_ObraSocial] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CRED_Accesos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Accesos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_Accesos](
	[Id] [smallint] IDENTITY(1,1) NOT NULL,
	[Nombre] [varchar](100) NULL,
 CONSTRAINT [PK__CRED_Accesos__76D82AFE] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Motivos_Causas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Motivos_Causas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Motivos_Causas](
	[Id] [int] NOT NULL,
	[Descripcion] [varchar](50) NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Motivos_Causas] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Tratamientos_Titulos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Tratamientos_Titulos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Tratamientos_Titulos](
	[Id] [int] NULL,
	[Descripcion] [varchar](50) NULL,
	[Baja] [bit] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Control_Contrato_Firmar]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Control_Contrato_Firmar]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE  procedure [dbo].[CTR_GET_Control_Contrato_Firmar]
 @Contrato int,    
 @orden int    
as    

set nocount on    

create table #tempo
(Contrato varchar(5),    
 Nro_Contrato char(11),    
 Fecha_Dia_Impresion smalldatetime,    
 Tipo_Contrato varchar(50),    
 Nivel varchar(5),    
 Grado varchar(5),    
 Funcion  varchar(50),    
 Rango  varchar(50),        
 Monto float ,
 cantidad int   
)

insert into #tempo
select  case when OrdenImpresion = @orden then      
    ''Leido''    
  else      
    ''''    
  end Contrato,    
 Nro_Contrato,    
 Fecha_Dia_Impresion,    
 tc.Descripcion Tipo_Contrato,    
 tn.Nivel,    
 tg.Grado,    
 tf.descripcion Funcion,    
 trg.descripcion Rango,    
 Monto,
 null    
    
from dbo.CTR_Contratos_Tmp_Impresion c    
    
inner join dbo.Tabla_Resoluciones_Contratos TC      
 on TC.id = c.tipo_contrato      
      
LEFT join dbo.tabla_niveles TN      
 on TN.id = C.nivel      
      
LEFT join dbo.tabla_grados TG      
 on TG.id = c.grado      
         
LEFT join dbo.tabla_funciones_contratos TF      
 on TF.id = c.funcion      
    
LEFT join dbo.tabla_rangos TRG      
 on TRG.id = c.rango      
    
where id_contrato = @Contrato    
    

update #tempo
set cantidad = (select count(*) from #tempo)


select * from #tempo
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_UPD_Fecha_impresion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_UPD_Fecha_impresion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_UPD_Fecha_impresion]
	@Id_Contrato int,
	@fecha char(10)
as

--GUARDO FECHA DE IMPRESION EN CTR
update ctr_contratos
set fecha_impresion=@Fecha
where id_contrato=@Id_Contrato



' 
END
GO
/****** Object:  Table [dbo].[CBajas_Contratos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CBajas_Contratos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CBajas_Contratos](
	[Legajo] [int] NULL,
	[Id] [int] NULL,
	[Acto_Tipo] [smallint] NULL,
	[Acto_Nro] [char](10) NULL,
	[Acto_Fecha] [smalldatetime] NULL,
	[Acto_Firmante] [int] NULL,
	[Motivo_Baja] [smallint] NULL,
	[Fecha_Baja] [smalldatetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[Funciones_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Funciones_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[Funciones_Contratos]

	@operacion smallint,
	@Id int,
	@Descripcion varchar(50),
	@Objeto text

as
if @operacion = 1 begin
	set @id = (select max(id)+1 from [dbo].[Tabla_Funciones_Contratos])
	if @id is null begin
		set @id =1
	end
	INSERT INTO [dbo].[Tabla_Funciones_Contratos]([Id], [Descripcion], [baja], [Objeto])
	VALUES(@Id,@Descripcion,0,@Objeto)
end

if @operacion = 2 begin
	update [dbo].[Tabla_Funciones_Contratos]
	set descripcion = @descripcion,
	    objeto = @objeto
	where id = @id
end

if @operacion = 3 begin
	update [dbo].[Tabla_Funciones_Contratos]
	set baja = 1
	where id = @id 
end

' 
END
GO
/****** Object:  Table [dbo].[RH_Traspaso_Documentacion]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_Traspaso_Documentacion]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[RH_Traspaso_Documentacion](
	[id] [int] NOT NULL,
	[Sector_TX] [smallint] NOT NULL,
	[Usuario_TX] [smallint] NOT NULL,
	[Fecha_TX] [datetime] NOT NULL,
	[Codigo] [varchar](5) NULL,
	[Motivo] [varchar](200) NULL,
	[Tabla] [varchar](100) NULL,
	[Registro] [varchar](100) NULL,
	[Sector_RX] [smallint] NOT NULL,
	[Usuario_RX] [smallint] NULL,
	[Fecha_RX] [datetime] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Designaciones_Fechas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Designaciones_Fechas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Designaciones_Fechas](
	[Fecha_Adm_Pub] [smalldatetime] NULL,
	[Fecha_Min] [smalldatetime] NOT NULL,
	[Nro_Doc] [int] NOT NULL,
	[Id_Interna] [int] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Origen_UR]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Origen_UR]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[RPT_LEG_Origen_UR]          
        
as          
          
set nocount on          
          
CREATE TABLE #Tempo          
( Documento int,           
 Id_Area_UR int,          
 Area_UR varchar(200),          
 Cant_Area_UR int,           
 Id_Sec int,      
 Secretaria varchar(200),                  
  cant_ur int,          
 igual int )          
          
CREATE TABLE #listado          
( codigo_UR char(24),  
 Id_Area_UR int,        
 Area_UR varchar(200),                  
 Suma_Total_Utilizadas int,          
 Suma_Misma_Utilizadas int,          
 Suma_Otras_Utilizadas int,          
 codigo_SEC char(24),  
 Id_Area_Prestada int,      
 Area_Prestada varchar(200),          
 Suma_Area_Prestada int,          
 Libres int,          
 Cantidad_Total_Area int,    
 Fecha smalldatetime)          
          
CREATE TABLE #Suma_UR_Prestadas          
( Area_UR varchar(200),                  
 cantidad int)          
          
CREATE TABLE #Suma_UR_Misma          
( Area_UR varchar(200),                  
 cantidad int)          
          
          
INSERT INTO #Tempo          
SELECT  ur.Documento,           
 ur.Id_Area Id_Area_UR,           
 ta.Descripcion Area_UR,          
 isnull(cantidad,0) Cant_Area_UR,        
 0,          
 TADep.Descripcion  Secretaria,                  
 isnull(cant_ur,0),          
 case when ta.Descripcion = TADep.Descripcion then           
 ''0''          
 else           
 ''1''          
 end igual          
FROM dbo.leg_desglose_ur ur          
INNER JOIN dbo.Tabla_URetributivas tur          
 ON ur.id_area = tur.id_area          
LEFT join dbo.vw_desglose_area da                      
 on ur.documento = da.documento                                      
LEFT join dbo.tabla_areas TA                      
 on ur.id_area = ta.id                  
inner join dbo.Tabla_Areas TADep                
  ON TADep.id = dbo.Fx_Primer_Nivel_Dependencia_Area (da.Id_Area)           
WHERE estado <> ''B''          
ORDER BY ur.id_area, ur.documento          
          
      
UPDATE t      
set id_sec = ta.id      
from #tempo t      
LEFT join dbo.tabla_areas TA                      
 on t.secretaria = ta.descripcion      
      
      
INSERT INTO #listado          
Select  0,  
 Id_Area_UR,      
 area_ur,          
 0,          
 0,          
 0,        
 0,     
 id_sec,       
 secretaria,           
 isnull(sum(isnull(cant_ur,0)),0),          
 0,           
 isnull(Cant_Area_UR,0),    
 getdate()    
from #tempo          
where igual = 1          
group by Id_Area_UR, area_ur, id_sec, secretaria, Cant_Area_UR       
order by Id_Area_UR          
          
      
INSERT INTO #listado          
Select 0,  
 Id_Area_UR,      
 area_ur,          
 0,          
 0,          
 0,        
 0,     
 id_sec,       
 secretaria,           
 isnull(sum(isnull(cant_ur,0)),0),          
 0,           
 isnull(Cant_Area_UR,0),    
 getdate()        
from #tempo      
where igual = 0      
 and area_ur not in (select area_ur from #listado )      
group by Id_Area_UR, area_ur, id_sec, secretaria, Cant_Area_UR         
order by Id_Area_UR          
      
      
INSERT INTO #Suma_UR_Prestadas          
Select area_ur, isnull(sum(isnull(cant_ur,0)),0)          
from #tempo          
where igual = 1          
group by area_ur          
order by area_ur          
          
        
INSERT INTO #Suma_UR_Misma          
Select area_ur, isnull(sum(isnull(cant_ur,0)),0)          
from #tempo          
where igual = 0          
group by area_ur          
order by area_ur          
          
          
UPDATE L          
SET Suma_Misma_Utilizadas = (select isnull(cantidad,0)          
    FROM #Suma_UR_Misma p          
    where l.area_ur = p.area_ur)          
FROM #listado l          
          
          
UPDATE L          
SET Suma_Otras_Utilizadas = (select isnull(cantidad,0)          
    FROM #Suma_UR_Prestadas p          
    where l.area_ur = p.area_ur)          
FROM #listado l          
          
          
UPDATE L          
SET Suma_Total_Utilizadas = isnull(Suma_Otras_Utilizadas,0) + isnull(Suma_Misma_Utilizadas,0)          
FROM #listado l          
          
          
UPDATE L          
SET libres = isnull(Cantidad_Total_Area,0) - isnull(Suma_Total_Utilizadas,0)          
FROM #listado l          
          
        
UPDATE #listado      
set  area_prestada = null,      
 suma_area_prestada=null,      
 id_area_prestada = null      
from #listado      
where area_ur = area_prestada      
      
      
UPDATE L  
set Codigo_UR = LEFT(codigo,19)  
FROM #listado L  
 inner join dbo.Tabla_Areas_Estructura ta  
  on L.Id_Area_UR = ta.id_area  
   
  
UPDATE L  
set Codigo_sec = LEFT(codigo,19)  
FROM #listado L  
 inner join dbo.Tabla_Areas_Estructura ta  
  on L.id_Area_Prestada = ta.id_area  
  
  
Select  codigo_UR,  
 Id_Area_UR,        
 Area_UR ,          
 Suma_Total_Utilizadas ,          
 Suma_Misma_Utilizadas ,          
 Suma_Otras_Utilizadas ,          
 codigo_sec,  
 id_Area_Prestada,       
 Area_Prestada ,          
 Suma_Area_Prestada ,          
 Libres ,          
 Cantidad_Total_Area,    
 convert(char(10),getdate(),103) fecha          
from #listado L          
order by codigo_UR, codigo_SEC        
      
        
-- drop table #tempo      
-- drop table #listado      
-- drop table #Suma_UR_Prestadas      
-- drop table #Suma_UR_misma      
  

' 
END
GO
/****** Object:  Table [dbo].[ger_medico_lic]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ger_medico_lic]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ger_medico_lic](
	[Doc_Nro] [nvarchar](255) NULL,
	[fecha atencion] [smalldatetime] NULL,
	[Volver dias] [nvarchar](255) NULL,
	[PresionDia] [nvarchar](255) NULL,
	[PresionHora] [nvarchar](255) NULL,
	[PresionDiastolica] [nvarchar](255) NULL,
	[PresionSistolica] [nvarchar](255) NULL,
	[codigo diagnostico] [nvarchar](255) NULL,
	[Observaciones] [nvarchar](255) NULL,
	[Observaciones1] [nvarchar](255) NULL,
	[IdLicencia] [float] NULL,
	[Baja] [nvarchar](255) NULL,
	[ConsultorioExterno] [nvarchar](255) NULL,
	[IdUsuario] [float] NULL,
	[regresa] [nvarchar](255) NULL,
	[regreso] [nvarchar](255) NULL
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Validar_Tabla_Areas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Validar_Tabla_Areas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[GABM_Validar_Tabla_Areas]
	@id int=null
as

SELECT	id,
	descripcion,
	Dependencia Depende,
	Nivel,
	Baja,
	Fecha_Hasta,
	de_dela Denominacion,
	Presenta_DDJJ DDJJ
FROM dbo.Tabla_Areas
WHERE (id = @id) or (@id is null)


' 
END
GO
/****** Object:  Table [dbo].[EVAL_Periodos_Evaluacion]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_Periodos_Evaluacion]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[EVAL_Periodos_Evaluacion](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[desde] [smalldatetime] NOT NULL,
	[hasta] [smalldatetime] NOT NULL,
	[descripcion] [varchar](100) NOT NULL,
	[id_interna_coordinador] [int] NOT NULL,
	[baja] [bit] NOT NULL,
 CONSTRAINT [PK_EVAL_Periodos_Evaluacion] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Regimen_Jubilatorio]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Regimen_Jubilatorio]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Regimen_Jubilatorio](
	[Id] [smallint] NOT NULL,
	[Descripcion] [nvarchar](50) NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Regimen_Jubilatorio] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_DEL_Estudio_Realizado]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_DEL_Estudio_Realizado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create procedure [dbo].[LEG_DEL_Estudio_Realizado]
	@IdEstudio int
AS
UPDATE dbo.LEG_Estudios_Realizados
SET DatodeBaja = 1
WHERE Id = @IdEstudio


' 
END
GO
/****** Object:  Table [dbo].[Calificaciones]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Calificaciones]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Calificaciones](
	[Jurisdiccion] [varchar](50) NULL,
	[Organismo] [varchar](50) NULL,
	[Calificacion_Final] [varchar](25) NULL,
	[Fecha_Desde] [datetime] NULL,
	[Fecha_Hasta] [datetime] NULL,
	[Folio] [char](10) NULL,
	[Id_Interna] [int] NOT NULL,
	[Doc_Titular] [int] NOT NULL,
	[Id_Calificacion] [int] NOT NULL,
	[DatoDeBaja] [bit] NULL,
	[DatoNoImprime] [bit] NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_DocIdentidad]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_DocIdentidad]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_DocIdentidad](
	[Id] [smallint] NOT NULL,
	[Descripcion] [nvarchar](50) NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_DocIdentidad] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[PLA_DDJJ_Generadas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_DDJJ_Generadas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[PLA_DDJJ_Generadas](
	[Fecha] [smalldatetime] NOT NULL,
	[Documento] [int] NOT NULL,
	[Area] [int] NOT NULL,
	[Fecha_Recepcion] [smalldatetime] NULL,
	[Usuario_Recepciono] [smallint] NULL,
	[Observaciones] [text] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Estado_Civil]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Estado_Civil]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Estado_Civil](
	[Id] [smallint] NOT NULL,
	[Descripcion] [nvarchar](50) NULL,
	[Baja] [bit] NOT NULL,
	[Codigo_Banco_Nacion] [char](1) NULL,
 CONSTRAINT [PK_Tabla_Estado_Civil] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[PLA_ADD_Generacion_DDJJ]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_ADD_Generacion_DDJJ]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE  procedure [dbo].[PLA_ADD_Generacion_DDJJ]
	
AS
--MLD: 28-06-07: Genera DDJJ 104 de todos los agentes a certificar
-- Tiene en cuenta si el Agente es Certificante o NO se lo debe Certificar
create table #TmpArea
	(Id smallint identity(1,1),
	Codigo char(25),
	Id_area smallint)

create table #TmpDDJJ
	(documento int,
	Apellido varchar(50),
	Nombre varchar(50),
	Area smallint,
	CertArea smallint)

INSERT INTO #tmpArea (codigo,id_area)
SELECT	TAE.Codigo,
	ta.id
FROM dbo.Tabla_Areas TA 
INNER JOIN dbo.tabla_areas_estructura TAE
	on TAE.id_Area = TA.Id
WHERE 	TA.Baja = 0 AND
	TA.Presenta_DDJJ = 1 AND
	right(TAE.Codigo,5) <> ''00000'' and
	ta.baja = 0

DECLARE @Inicial char(25)
DECLARE @final char(25)

DECLARE @i smallint
SET @i = 1

WHILE @i <= (select max(id) from #tmparea) BEGIN
	set @inicial = (select codigo from #tmparea where id = @i)
	set @final = case when @i < (select max(id) from #tmparea)  then (select codigo from #tmparea where id = @i+1) else ''999999999999999999999999'' end 

	insert into #TmpDDJJ (documento, Apellido, Nombre ,Area,CertArea  )
	select 	da.documento,
		dp.apellido,
		dp.nombre,
		--CAMBIA AREA DE LOS CERTIFICANTES 
		case when cert.documento is null then
			(select id_area from #tmparea where id = @i)
		else
			Case when cert.Certificante = 1 then
				isnull((select id_area from #tmparea where id = @i - 1),0)
			else
				(select id_area from #tmparea where id = @i)
			END
		end Area,
		(select id_area from #tmparea where id = @i) CertificaArea --REAL REAL
	from dbo.tabla_areas_estructura ta
	inner join dbo.vw_desglose_area da
		on da.id_area = ta.id_area
	inner join dbo.Datos_personales dp
		on dp.id_interna = da.id_interna
	left join dbo.PLA_Certificantes_DDJJ Cert
		on Cert.Documento = da.documento 
	left join dbo.Ctr_Contratos CTR
		on ctr.id_contrato = (select max(id_contrato) from ctr_contratos where nro_documento = dp.nro_documento and aprobado = 0 and baja = 0 and left(nro_contrato,2) = ''01'')
	where (codigo between @Inicial and @Final) and
		right(codigo,5) <> ''00000'' AND
		((dp.bajalegajos = 0 and visiblelegajos = 1 )or (visiblecontratos = 1 and bajacontratos = 0)) AND
		ta.codigo <>  @Final AND
		(Cert.NoCertificar =0 or cert.NoCertificar IS NULL) --SACAR LOS Q NO CERTIFICAN
		and (ctr.id_contrato is null)
	
	set @i = @i + 1
END

INSERT INTO dbo.PLA_DDJJ_Generadas (Fecha, Documento, Area)
SELECT getdate(), Documento, Area from #TmpDDJJ
ORDER BY area,apellido, nombre


DROP TABLE #tmpArea
DROP TABLE #TmpDDJJ






' 
END
GO
/****** Object:  Table [dbo].[Tabla_Idiomas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Idiomas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Idiomas](
	[Id] [smallint] NOT NULL,
	[Descripcion] [varchar](25) NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Idiomas] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_UR_Tramite]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_UR_Tramite]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[LEG_GET_UR_Tramite]              
 @Area_UR int = null,                                  
 @Lugar_Trabajo_UR int = null,                                  
 @tipo_UR int = null,                                  
 @Exp varchar(30) = null,                              
 @fecha smalldatetime = null,                               
 @orden char(1) = 1,      --Order by                      
 @Sin_Exp int = null,    -- NULL: TODOS, 0: Sin , 1: Con                      
 @Estado char(2) = null, --NULL: TODOS, TRAMITE: NA, APROBADO: A, BAJA: B                              
 @Origen char(2) = null  --NULL: TODOS, PROPIAS: PR, PRESTADAS: PE          
AS                                  
                    
set nocount on                    
                    
create table #tempo                    
(                    
Id int,                       
Id_interna int,                        
Documento int,                        
apellido varchar(40),                       
nombre varchar(60),                      
codigo_area_UR char(24),                         
id_area_UR int ,                      
area_UR varchar(200),                    
codigo_Sec char(24),                         
id_Secretaria int,                    
secretaria varchar(200),                    
Canti_Asignada int,                        
Desde smalldatetime,                        
Hasta smalldatetime,                        
Id_Acto_Tipo int,                        
Acto_tipo varchar(20),                        
Acto_Nro int,                        
Acto_Fecha smalldatetime,                        
Acto_Firmante varchar(200),                         
Id_Acto_Tipo_Baja int,                        
Acto_Tipo_Baja varchar(20),                        
Acto_Nro_Baja int,                        
Acto_Fecha_Baja smalldatetime,                        
Acto_Firmante_Baja varchar(200),                        
Exp_Nro varchar(30),                        
Id_Tipo_UR int,                        
Tipo_UR varchar(100),                        
Estado char(2),                  
motivo_baja varchar(100),                      
fecha_baja datetime,            
id_area_trabajo int,            
area_trabajo varchar(200),    
--Tramitacion_Acto varchar(30),    
--Tramitacion_Exp varchar(30),    
Tramitacion varchar(30)    
)                     
                  
            
create table #tempo2                    
(                    
codigo char(24),                    
Id_area int,                    
Descripcion varchar(200)                    
)                    
                    
                    
                    
insert into #tempo                    
select  ur.Id,                        
 ur.Id_interna,                        
 ur.Documento,                        
 dp.apellido,                       
 dp.nombre,                        
 0,                    
 ur.Id_area id_area_UR,                        
 ta.descripcion area_UR,                        
 0,                    
 0, --dbo.Fx_Primer_Nivel_Dependencia_Area (da.Id_Area) id_Secretaria,                  
 0 Secretaria,                    
 Cant_UR Canti_Asignada,                        
 ur.Desde,                        
 Hasta,                        
 ur.Acto_Tipo Id_Acto_Tipo,                        
 tr.Descripcion Acto_tipo,                        
 ur.Acto_Nro,                        
 ur.Acto_Fecha,                        
 ttt.Descripcion +'' ''+ DPF.Apellido +'' ''+ DPF.Nombre   Acto_Firmante,                         
 ur.Acto_Tipo_Baja Id_Acto_Tipo_Baja,                        
 trb.descripcion Acto_Tipo_Baja,                        
 ur.Acto_Nro_Baja,                        
 ur.Acto_Fecha_Baja,                        
 tttb.Descripcion +'' ''+ DPFB.Apellido +'' ''+ DPFB.Nombre  Acto_Firmante_Baja,                        
 ur.Exp_Nro,                        
 ur.Tipo_UR Id_Tipo_UR,                        
 ttur.descripcion Tipo_UR,                        
 ur.Estado ,                  
 mb.descripcion motivo_baja,                  
 ur.fecha_baja,            
 null,            
 null,    
     
 Case  when Acto_Tipo  is null then isnull(ur.Exp_Nro,''--'')    
 when Acto_Tipo  is not null then TR.abrebiatura +'' ''+  ur.Acto_Nro +''/''+ right(year(ur.Acto_Fecha),2)    
 end     
    
    
    
    
FROM dbo.leg_desglose_UR  ur                          
                    
INNER JOIN dbo.datos_personales dp                        
 ON dp.nro_documento = ur.documento                    
                  
INNER JOIN dbo.tabla_areas ta                        
 ON ta.id = ur.id_area                        
              
INNER JOIN dbo.Tabla_URetributivas tur                                    
 ON ur.id_area = tur.id_area                         
          
LEFT JOIN dbo.Tabla_Firmantes TFC                            
 ON TFC.id = ur.Acto_Firmante                            
              
LEFT JOIN dbo.datos_personales DPF                            
 ON TFC.nro_documento = DPF.nro_documento                            
              
LEFT JOIN dbo.tabla_tratamientos TT                            
 ON TT.id = tfc.id_tratamiento                            
              
LEFT JOIN dbo.tabla_tratamientos_titulos TTT                            
 ON TTT.id = tfc.id_titulo                         
              
LEFT JOIN dbo.Tabla_Firmantes TFCB                            
 ON TFCB.id = ur.Acto_Firmante_Baja                            
              
LEFT JOIN dbo.datos_personales DPFB                            
 ON TFCB.nro_documento = DPFB.nro_documento                            
              
LEFT JOIN dbo.tabla_tratamientos TTB                            
 ON TTB.id = tfcB.id_tratamiento                            
              
LEFT JOIN dbo.tabla_tratamientos_titulos TTTB                            
 ON TTTB.id = tfcB.id_titulo                         
              
LEFT JOIN dbo.tabla_tipos_resoluciones TR                            
 ON TR.id = ur.Acto_Tipo                          
              
LEFT JOIN dbo.tabla_tipos_resoluciones TRB                            
 ON TRB.id = ur.Acto_Tipo_Baja                              
              
INNER JOIN dbo.LEG_Tabla_Tipo_URetributivas TTUR                        
 ON TTUR.id = ur.Tipo_UR                        
              
LEFT JOIN dbo.tabla_motivos_baja mb                    
 ON mb.id = ur.motivo_baja                  
                  
where  (ur.id_area = @area_ur or @area_ur is null)                        
 and (dbo.Fx_Primer_Nivel_Dependencia_Area (@Lugar_Trabajo_UR) = @Lugar_Trabajo_UR or @Lugar_Trabajo_UR is null)                        
 and (tipo_UR = @tipo_UR or @tipo_ur is null)                        
 and (exp_nro = @Exp or @Exp is null)                        
 and (ur.desde >= @fecha or @fecha is null)                       
 and ((estado=''NA'' and @estado = ''NA'') OR                        
     (ltrim(rtrim(estado)) =''A'' and @estado = ''A'') OR                      
     (ltrim(rtrim(estado)) =''B'' and @estado = ''B'') OR                      
     (@estado IS NULL and ltrim(rtrim(estado)) <> ''B''))                              
and((Exp_nro IS NULL and @Sin_Exp = 0) OR                        
   (Exp_nro iS NOT NULL And @Sin_Exp = 1) OR                         
   (@Sin_exp IS NULL))                       
                    
              
--ID_AREA DE LA SECRETARIA              
update t              
set id_Secretaria  = dbo.Fx_Primer_Nivel_Dependencia_Area (da.Id_Area)               
from #tempo t            
LEFT join dbo.vw_desglose_area da                                    
  on t.documento = da.documento                                                    
LEFT join dbo.tabla_areas TA2                                    
 on t.id_area_ur = ta2.id               
              
            
-- CODIGO DE LA ESTRUCTURA: ESTO ME SIRVE PARA ORDENAR.            
insert into #tempo2                    
select  distinct                    
 left(tae.codigo,19),                    
 tae.id_area,                     
 tae.descripcion                    
from tabla_areas_estructura tae, Tabla_URetributivas tur                    
where tae.id_area = tur.id_area                    
                     
            
-- ACTUALIZO CON EL CODIGO DE LA ESTRUCTURA EL AREA DE UR            
update t                    
set  codigo_area_ur =  codigo                     
from #tempo t                    
INNER JOIN #tempo2 t2                    
 on t.id_area_ur = t2.Id_area                    
            
            
-- ACTUALIZO CON EL CODIGO DE LA ESTRUCTURA EL AREA DE LA SECRETARIA                    
update t                    
set   codigo_sec =  codigo,                    
  secretaria = descripcion                     
from #tempo t                    
INNER JOIN tabla_areas_estructura t2                    
 on t.id_secretaria = t2.Id_area                    
                    
            
--AREA DE LUGAR DE TRABAJO            
update t                    
set   id_area_trabajo =  da.id_area,                     
 area_trabajo = ta2.descripcion                     
from #tempo t                    
LEFT join dbo.vw_desglose_area da          
 on t.documento = da.documento                
                
LEFT join dbo.tabla_areas TA2                
 on TA2.id = da.id_area                
            
           
    
IF @origen = ''PR''          
BEGIN          
 DELETE FROM #tempo           
 WHERE id_area_ur <> id_Secretaria          
END          
          
IF @origen = ''PE''          
BEGIN          
 DELETE FROM #tempo           
 WHERE id_area_ur = id_Secretaria          
END          
          
          
IF @orden = 1                     
BEGIN                    
 select *                     
 from #tempo                    
 order by apellido, nombre, codigo_area_ur, codigo_sec                    
END                    
                    
                    
IF @orden = 2                    
BEGIN                    
 select *                     
 from #tempo                    
 order by codigo_area_ur, apellido, nombre                    
END                    
                    
            
IF @orden = 3                    
BEGIN                    
 select *                     
 from #tempo                    
 order by codigo_sec, apellido, nombre                    
END                    
                       
   
IF @orden = 9   --Esto es para el reporte, porque no lo ordena automatico.                 
BEGIN                    
 select *                     
 from #tempo                    
 order by id_area_UR, id_Secretaria, apellido, nombre  
END                    
  
  
          
              
            
          
        
      
    
  

' 
END
GO
/****** Object:  Table [dbo].[PLA_Firmantes_DDJJ]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_Firmantes_DDJJ]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[PLA_Firmantes_DDJJ](
	[Legajo] [int] NULL,
	[Area_Donde_Firma] [int] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Nivel_Estudios]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Nivel_Estudios]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Nivel_Estudios](
	[Id] [smallint] NOT NULL,
	[Descripcion] [nvarchar](50) NULL,
	[Cod_Gest_Pub] [char](1) NULL,
	[Baja] [bit] NOT NULL,
	[orden] [smallint] NULL,
 CONSTRAINT [PK_Tabla_Nivel_Estudios] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Autorizaciones_Licencias_Bk_02_12_2010]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Autorizaciones_Licencias_Bk_02_12_2010]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Autorizaciones_Licencias_Bk_02_12_2010](
	[Id_Interna] [int] NOT NULL,
	[Dias_Autorizados] [smallint] NOT NULL,
	[Id_Concepto_Licencia] [smallint] NOT NULL,
	[Periodo] [smallint] NOT NULL,
	[Id] [int] NOT NULL,
	[Dias_Tomados] [smallint] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[LEG_Estudios_Idiomas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Idiomas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Estudios_Idiomas](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Id_Idioma] [smallint] NOT NULL,
	[Habla] [smallint] NULL,
	[Lee] [smallint] NULL,
	[Escribe] [smallint] NULL,
	[Id_Interna] [int] NOT NULL,
	[Nro_doc] [int] NOT NULL,
	[Folio] [char](10) NULL,
	[DatoDeBaja] [bit] NULL,
	[DatoNoImprime] [bit] NULL,
	[Usuario] [smallint] NOT NULL,
	[FechaProceso] [datetime] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Estudios_Idiomas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Estudios_Idiomas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Estudios_Idiomas](
	[Idioma] [smallint] NOT NULL,
	[Habla] [smallint] NULL,
	[Lee] [smallint] NULL,
	[Escribe] [smallint] NULL,
	[Id_Interna] [int] NOT NULL,
	[Nro_doc] [int] NOT NULL,
	[Folio] [char](10) NULL,
	[id_estudio] [int] NULL,
	[DatoDeBaja] [bit] NULL,
	[DatoNoImprime] [bit] NULL,
 CONSTRAINT [PK_Estudios_Idiomas] PRIMARY KEY NONCLUSTERED 
(
	[Idioma] ASC,
	[Id_Interna] ASC,
	[Nro_doc] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Datos_Personales]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Datos_Personales]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Datos_Personales](
	[Id_Interna] [int] NOT NULL,
	[Apellido] [varchar](40) NOT NULL,
	[Nombre] [varchar](60) NOT NULL,
	[Tipo_Planta] [int] NULL,
	[Sexo] [smallint] NOT NULL,
	[Fecha_Nacimiento] [datetime] NOT NULL,
	[Lugar_Nacimiento] [varchar](50) NULL,
	[Nacionalidad] [smallint] NOT NULL,
	[Fecha_Ingreso_Pais] [smalldatetime] NULL,
	[Carta_Ciudadania] [varchar](50) NULL,
	[Juzgado] [varchar](100) NULL,
	[Secretario] [varchar](100) NULL,
	[Fecha_Juzgado] [smalldatetime] NULL,
	[Cuil_Nro] [varchar](15) NOT NULL,
	[Tipo_Documento] [smallint] NOT NULL,
	[Nro_Documento] [int] NOT NULL,
	[Distrito_Militar] [smallint] NULL,
	[Clase] [int] NULL,
	[Cedula_Identidad] [char](11) NULL,
	[Expedida_por] [varchar](50) NULL,
	[Regimen_Jubilatorio] [smallint] NULL,
	[Denominacion] [smallint] NULL,
	[Estado_Civil] [smallint] NOT NULL,
	[Fecha_Matrimonio] [smalldatetime] NULL,
	[Fecha_Matrimonio_2da] [smalldatetime] NULL,
	[Grupo_Sanguineo] [varchar](2) NULL,
	[Factor_Sanguineo] [varchar](20) NULL,
	[Credencial] [varchar](20) NULL,
	[Obra_Social] [smallint] NULL,
	[Nro_Afiliado] [varchar](50) NULL,
	[Usuario] [smallint] NOT NULL,
	[VisibleLegajos] [bit] NOT NULL,
	[VisibleContratos] [bit] NOT NULL,
	[BajaLegajos] [bit] NOT NULL,
	[BajaContratos] [bit] NOT NULL,
 CONSTRAINT [PK_Datos_Personales] PRIMARY KEY CLUSTERED 
(
	[Id_Interna] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Legajo_Bajas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Legajo_Bajas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Legajo_Bajas](
	[Id_Interna] [int] NOT NULL,
	[Nro_Doc] [int] NULL,
	[Fecha_Baja] [smalldatetime] NOT NULL,
	[Motivo_Baja] [smallint] NOT NULL,
	[Usuario] [smallint] NOT NULL,
	[Acto_Tipo] [smallint] NULL,
	[Acto_Nro] [varchar](10) NULL,
	[Acto_Fecha] [smalldatetime] NULL,
	[Acto_Firmante] [int] NOT NULL,
 CONSTRAINT [PK_Legajo_Bajas] PRIMARY KEY CLUSTERED 
(
	[Id_Interna] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY],
 CONSTRAINT [IX_Legajo_Bajas] UNIQUE NONCLUSTERED 
(
	[Nro_Doc] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[RH_Usuarios_Detalles]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_Usuarios_Detalles]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[RH_Usuarios_Detalles](
	[Id_Usuario] [smallint] NOT NULL,
	[Id_Sector] [smallint] NULL,
	[Apellido] [varchar](40) NOT NULL,
	[Nombre] [varchar](50) NOT NULL,
	[Mail] [varchar](200) NULL,
	[Leer_TMP] [bit] NOT NULL,
	[BloqueoLegajo] [bit] NOT NULL,
	[DesBloqueoLegajo] [bit] NOT NULL,
	[Acceso_Web] [bit] NOT NULL,
 CONSTRAINT [PK_RH_Usuarios_Detalles] PRIMARY KEY CLUSTERED 
(
	[Id_Usuario] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Conceptos_Licencias]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Conceptos_Licencias]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Conceptos_Licencias](
	[Nro_Articulo] [varchar](5) NOT NULL,
	[Concepto] [varchar](5) NOT NULL,
	[Descripcion] [varchar](60) NOT NULL,
	[Dias_Autorizados] [smallint] NOT NULL,
	[id_Concepto] [smallint] NOT NULL,
	[Acumulativa] [bit] NOT NULL,
	[Goce_Haberes] [smallint] NOT NULL,
	[Es_Ordinaria] [bit] NOT NULL,
	[Anual] [bit] NOT NULL,
	[Dias_Habiles] [bit] NULL,
	[Send_Legajos] [bit] NULL,
	[Licencia_Medica] [bit] NULL,
	[Regresa_Medica] [bit] NULL,
	[GeneraDerechoOrdinaria] [bit] NULL,
	[Baja] [bit] NOT NULL,
	[DiasMensuales] [smallint] NOT NULL,
	[DiasConsecutivos] [smallint] NOT NULL,
	[Usuario] [smallint] NOT NULL,
	[PathFormularioWeb] [varchar](90) NULL,
 CONSTRAINT [PK_Tabla_Conceptos] PRIMARY KEY NONCLUSTERED 
(
	[id_Concepto] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY],
 CONSTRAINT [IX_Tabla_Conceptos_Licencias] UNIQUE NONCLUSTERED 
(
	[Nro_Articulo] ASC,
	[Concepto] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Autorizaciones_Licencias]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Autorizaciones_Licencias]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Autorizaciones_Licencias](
	[Id_Interna] [int] NOT NULL,
	[Dias_Autorizados] [smallint] NOT NULL,
	[Id_Concepto_Licencia] [smallint] NOT NULL,
	[Periodo] [smallint] NOT NULL,
	[Id] [int] NOT NULL,
	[Dias_Tomados] [smallint] NULL,
 CONSTRAINT [PK_Autorizaciones_Licencias_1] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY],
 CONSTRAINT [IX_Autorizaciones_Licencias] UNIQUE NONCLUSTERED 
(
	[Id_Interna] ASC,
	[Id_Concepto_Licencia] ASC,
	[Periodo] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY],
 CONSTRAINT [IX_Autorizaciones_Licencias_1] UNIQUE NONCLUSTERED 
(
	[Id_Interna] ASC,
	[Id_Concepto_Licencia] ASC,
	[Periodo] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Areas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Areas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Areas](
	[id] [int] NOT NULL,
	[descripcion] [varchar](200) NOT NULL,
	[Baja] [bit] NOT NULL,
	[Fecha_Desde] [smalldatetime] NULL,
	[Presenta_DDJJ] [bit] NULL,
	[Usuario] [smallint] NOT NULL,
 CONSTRAINT [PK_Tabla_Areas] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Licencias_Solicitadas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Licencias_Solicitadas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Licencias_Solicitadas](
	[Id] [int] NOT NULL,
	[Id_Interna] [int] NOT NULL,
	[Concepto] [smallint] NOT NULL,
	[Periodo] [smallint] NOT NULL,
	[Desde] [smalldatetime] NOT NULL,
	[Hasta] [smalldatetime] NOT NULL,
	[Autorizacion] [smallint] NOT NULL,
	[Autorizo_Descuento] [varchar](100) NULL,
	[Dias_Descuento] [varchar](4) NULL,
	[Goce] [smallint] NOT NULL,
	[Observaciones] [varchar](100) NULL,
	[Id_Area] [int] NOT NULL,
	[Informo] [varchar](50) NOT NULL,
	[Id_Tabla_Autorizacion] [int] NOT NULL,
	[Dias_A_Tomar] [smallint] NOT NULL,
	[FH_FIN_ANTES_INTERR] [smalldatetime] NULL,
	[Motivo_Interrupcion] [varchar](200) NULL,
	[Usuario] [smallint] NOT NULL,
	[informo_a_liquidacion] [bit] NULL,
	[informo_Fecha] [smalldatetime] NULL,
	[informo_usuario] [smallint] NULL,
 CONSTRAINT [PK_Licencias_Solicitadas] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[MNS_Notas_Respondidas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MNS_Notas_Respondidas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[MNS_Notas_Respondidas](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Id_Ingreso] [int] NOT NULL,
	[Respuesta] [text] NOT NULL,
	[FechaRespuesta] [datetime] NOT NULL,
	[UsuarioRespuesta] [smallint] NOT NULL,
 CONSTRAINT [PK_MNS_Notas_Respondidas] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[RH_Usuarios_Areas_WEB]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_Usuarios_Areas_WEB]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[RH_Usuarios_Areas_WEB](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[Id_Usuario] [smallint] NOT NULL,
	[Id_Area] [int] NOT NULL,
	[baja] [bit] NOT NULL,
 CONSTRAINT [PK_RH_Usuarios_Areas_WEB] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY],
 CONSTRAINT [IX_RH_Usuarios_Areas_WEB] UNIQUE NONCLUSTERED 
(
	[Id_Usuario] ASC,
	[Id_Area] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[ASIS_Parte_Cabecera]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Parte_Cabecera]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ASIS_Parte_Cabecera](
	[Fecha] [smalldatetime] NOT NULL,
	[Id_Area] [int] NOT NULL,
	[Id_Usuario] [smallint] NOT NULL,
	[confirmado] [bit] NOT NULL,
 CONSTRAINT [PK_ASIS_Parte_Cabecera] PRIMARY KEY CLUSTERED 
(
	[Fecha] ASC,
	[Id_Area] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY],
 CONSTRAINT [IX_ASIS_Parte_Cabecera] UNIQUE NONCLUSTERED 
(
	[Fecha] ASC,
	[Id_Area] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[MED_Pacientes]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_Pacientes]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[MED_Pacientes](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Tipo_Documento] [smallint] NOT NULL,
	[Nro_Documento] [int] NOT NULL,
	[Apellido] [varchar](40) NOT NULL,
	[Nombre] [varchar](60) NOT NULL,
	[Fecha_Nacimiento] [smalldatetime] NOT NULL,
	[Sexo] [smallint] NOT NULL,
	[Area] [int] NULL,
	[Grupo_Sanguineo] [varchar](2) NULL,
	[Factor_Sanguineo] [varchar](20) NULL,
	[Observaciones] [varchar](300) NULL,
 CONSTRAINT [PK_MED_PACIENTES] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY],
 CONSTRAINT [IX_MED_PACIENTES] UNIQUE NONCLUSTERED 
(
	[Nro_Documento] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY],
 CONSTRAINT [IX_MED_PACIENTES_1] UNIQUE NONCLUSTERED 
(
	[Nro_Documento] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[ASIS_Partes_recibidos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Partes_recibidos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ASIS_Partes_recibidos](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[id_area] [int] NOT NULL,
	[fh_parte] [smalldatetime] NOT NULL,
	[fh_recepcion] [smalldatetime] NOT NULL,
	[fh_carga] [smalldatetime] NOT NULL,
 CONSTRAINT [PK_ASIS_Partes_recibidos] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[ASIS_Solicitudes_Licencia_Web]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ASIS_Solicitudes_Licencia_Web](
	[id] [int] NOT NULL,
	[id_interna] [int] NOT NULL,
	[concepto] [smallint] NOT NULL,
	[desde] [smalldatetime] NOT NULL,
	[hasta] [smalldatetime] NOT NULL,
	[usuario] [smallint] NOT NULL,
	[fecha_solicitud] [smalldatetime] NOT NULL,
	[id_area] [int] NULL,
	[baja] [bit] NULL,
 CONSTRAINT [PK_ASIS_Solicitudes_Licencia_Web] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[LEG_Desglose_Area]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_Area]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Desglose_Area](
	[Id] [int] NOT NULL,
	[Id_interna] [int] NOT NULL,
	[Documento] [int] NOT NULL,
	[Id_area] [int] NOT NULL,
	[Desde] [datetime] NOT NULL,
	[Jurisdiccion] [varchar](25) NULL,
	[Organismo] [varchar](25) NULL,
	[Folio] [char](10) NULL,
	[Acto_Tipo] [smallint] NULL,
	[Acto_Nro] [varchar](10) NULL,
	[Acto_Fecha] [datetime] NULL,
	[Usuario] [smallint] NOT NULL,
 CONSTRAINT [PK_LEG_Desglose_Area] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[RH_Usuarios_Areas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_Usuarios_Areas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[RH_Usuarios_Areas](
	[Id_Usuario] [smallint] NOT NULL,
	[Id_Area] [int] NOT NULL,
 CONSTRAINT [PK_RH_Usuarios_Areas] PRIMARY KEY CLUSTERED 
(
	[Id_Usuario] ASC,
	[Id_Area] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas](
	[id] [int] NOT NULL,
	[id_interna] [int] NOT NULL,
	[concepto] [smallint] NOT NULL,
	[desde] [smalldatetime] NOT NULL,
	[hasta] [smalldatetime] NOT NULL,
	[usuario] [smallint] NOT NULL,
	[fecha_solicitud] [smalldatetime] NOT NULL,
	[id_area] [int] NOT NULL,
	[fecha_Rechazo] [smalldatetime] NULL,
 CONSTRAINT [PK_ASIS_Solicitudes_Licencia_Web_Rechazadas] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Carrera_Administrativa]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Carrera_Administrativa]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Carrera_Administrativa](
	[Jurisdicción] [varchar](50) NOT NULL,
	[Organismo] [varchar](50) NOT NULL,
	[Regimen] [smallint] NOT NULL,
	[Id_agrupamiento] [smallint] NOT NULL,
	[Id_Grado] [smallint] NULL,
	[Id_Cargos] [smallint] NOT NULL,
	[Causas] [varchar](50) NULL,
	[Fecha_Desde] [datetime] NOT NULL,
	[Fecha_Hasta] [datetime] NULL,
	[Acto_Tipo] [smallint] NULL,
	[Acto_nro] [varchar](10) NULL,
	[Acto_Fecha] [datetime] NULL,
	[Folio] [char](10) NOT NULL,
	[Id_Interna] [int] NOT NULL,
	[Doc_Tit] [int] NOT NULL,
	[Id_Carrera] [int] NOT NULL,
	[Id_Nivel] [smallint] NULL,
	[Id_Tipo_Cargo] [smallint] NOT NULL,
	[Usuario] [smallint] NULL,
	[DatoDeBaja] [bit] NULL,
	[datonoimprime] [bit] NULL,
 CONSTRAINT [PK_Carrera_Administrativa] PRIMARY KEY NONCLUSTERED 
(
	[Id_Carrera] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Estudios_Relaciones]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Relaciones]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Estudios_Relaciones](
	[Id] [int] NOT NULL,
	[Nivel] [smallint] NOT NULL,
	[Area] [smallint] NOT NULL,
	[Titulo] [int] NOT NULL,
	[Especialidad] [int] NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Estudios_Facultad_Areas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Facultad_Areas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Estudios_Facultad_Areas](
	[IdFacultad] [int] NOT NULL,
	[IdArea] [smallint] NOT NULL,
 CONSTRAINT [PK_Tabla_Estudios_Facultad_Areas] PRIMARY KEY CLUSTERED 
(
	[IdFacultad] ASC,
	[IdArea] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Tabla_Estudios_Instituciones]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Instituciones]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Estudios_Instituciones](
	[id] [int] NOT NULL,
	[Nivel] [smallint] NULL,
	[Nombre] [varchar](200) NULL,
	[Nro] [int] NULL,
	[Denominacion] [varchar](200) NULL,
	[Localidad] [varchar](200) NULL,
	[Baja] [bit] NULL,
 CONSTRAINT [PK_Tabla_Estudios_Instituciones] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY],
 CONSTRAINT [IX_Tabla_Estudios_Instituciones] UNIQUE NONCLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[LEG_Estudios_Realizados]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Realizados]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Estudios_Realizados](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Id_Nivel] [smallint] NOT NULL,
	[Id_Universidad] [int] NULL,
	[Id_Facultad] [int] NULL,
	[Id_Institucion] [int] NULL,
	[Id_Titulo] [int] NULL,
	[Id_Especialidad] [int] NULL,
	[Fecha_Ingreso] [datetime] NULL,
	[Fecha_Egreso] [datetime] NULL,
	[Depende_de] [varchar](50) NULL,
	[Certificado_Expedido_por] [varchar](50) NULL,
	[Matricula_Nro] [varchar](50) NULL,
	[Folio_Nro] [char](10) NOT NULL,
	[Id_Interna] [int] NOT NULL,
	[Nro_Doc] [int] NOT NULL,
	[Cant_Materias_Totales] [smallint] NULL,
	[Cant_Materias_Aprob] [smallint] NULL,
	[Completo] [bit] NOT NULL,
	[DatoDeBaja] [bit] NOT NULL,
	[DatoNoImprime] [bit] NOT NULL,
	[SinCertificado] [bit] NOT NULL,
	[Usuario] [smallint] NOT NULL,
	[FechaProceso] [datetime] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Tabla_Estudios_Uni_Facultad]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Uni_Facultad]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Tabla_Estudios_Uni_Facultad](
	[id] [int] NOT NULL,
	[Universidad] [int] NOT NULL,
	[Facultad] [int] NOT NULL,
	[Baja] [bit] NOT NULL,
 CONSTRAINT [PK_Tabla_Estudios_Uni_Facultad] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[LEG_Desglose_Planta]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_Planta]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Desglose_Planta](
	[Id] [int] NOT NULL,
	[Id_interna] [int] NOT NULL,
	[Documento] [int] NOT NULL,
	[Id_Planta] [smallint] NOT NULL,
	[Desig_Planta] [tinyint] NULL,
	[Desde] [datetime] NOT NULL,
	[Jurisdiccion] [varchar](25) NULL,
	[Organismo] [varchar](25) NULL,
	[Folio] [char](10) NULL,
	[Acto_Tipo] [smallint] NULL,
	[Acto_Nro] [varchar](10) NULL,
	[Acto_Fecha] [datetime] NULL,
	[Usuario] [smallint] NOT NULL,
 CONSTRAINT [PK_LEG_Desglose_Planta] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
IF NOT EXISTS (SELECT * FROM ::fn_listextendedproperty(N'MS_Description' , N'SCHEMA',N'dbo', N'TABLE',N'LEG_Desglose_Planta', N'COLUMN',N'Desig_Planta'))
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'1-Permanente, 2-Transitoria' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'LEG_Desglose_Planta', @level2type=N'COLUMN',@level2name=N'Desig_Planta'
GO
/****** Object:  Table [dbo].[LEG_Estudios_Especialidades]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Especialidades]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Estudios_Especialidades](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[Tipo_maqui] [smallint] NULL,
	[P_Min_Maq] [smallint] NULL,
	[Id_Idioma] [smallint] NULL,
	[P_Min_Idi] [smallint] NULL,
	[Doc_Tit] [int] NOT NULL,
	[Id_interna] [int] NOT NULL,
	[Folio] [char](10) NOT NULL,
	[DatoDeBaja] [bit] NOT NULL,
	[DatoNoImprime] [bit] NOT NULL,
	[Oficio] [varchar](200) NULL,
	[Conocimiento] [varchar](200) NULL,
	[Usuario] [smallint] NOT NULL,
	[FechaProceso] [datetime] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Domicilio_Personal]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Domicilio_Personal]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Domicilio_Personal](
	[Fecha_Comunicacion] [smalldatetime] NOT NULL,
	[Calle] [varchar](50) NOT NULL,
	[Número] [int] NOT NULL,
	[Piso] [varchar](50) NULL,
	[Dpto] [varchar](50) NULL,
	[Casa] [varchar](10) NULL,
	[Manzana] [varchar](10) NULL,
	[Barrio] [varchar](20) NULL,
	[Torre] [varchar](10) NULL,
	[UF] [varchar](10) NULL,
	[Localidad] [int] NOT NULL,
	[Codigo_Postal] [varchar](50) NOT NULL,
	[Partido_Dpto] [varchar](50) NULL,
	[Provincia] [smallint] NULL,
	[Telefono] [varchar](20) NULL,
	[Correo_Electronico] [varchar](50) NULL,
	[Folio] [char](10) NOT NULL,
	[Id_Interna] [int] NOT NULL,
	[Nro_Doc] [int] NOT NULL,
	[ID_Domicilio] [int] NOT NULL,
	[Usuario] [smallint] NULL,
	[DatoDeBaja] [bit] NULL,
	[Correo_Electronico_MDS] [varchar](50) NULL,
	[Telefono2] [varchar](50) NULL,
 CONSTRAINT [PK_Domicilio_Personal] PRIMARY KEY CLUSTERED 
(
	[ID_Domicilio] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CRED_Documentos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Documentos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_Documentos](
	[Id] [smallint] IDENTITY(1,1) NOT NULL,
	[IdTipoDocumento] [smallint] NOT NULL,
	[FolioDesde] [varchar](10) NOT NULL,
	[Foliohasta] [varchar](10) NOT NULL,
	[Fecha] [smalldatetime] NOT NULL,
	[Observacion] [varchar](200) NULL,
	[IdUsuario] [smallint] NOT NULL,
 CONSTRAINT [PK__Documentos__5070F446] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CRED_Bajas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Bajas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_Bajas](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Fecha] [smalldatetime] NOT NULL,
	[IdDocumento] [smallint] NOT NULL,
	[Motivo] [varchar](50) NOT NULL,
	[IdAutorizante] [int] NOT NULL,
	[IdUsuario] [smallint] NOT NULL,
 CONSTRAINT [PK__CRED_Bajas__688A0BA7] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CRED_Personas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Personas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_Personas](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Documento] [int] NOT NULL,
	[Apellido] [varchar](50) NOT NULL,
	[Nombres] [varchar](50) NOT NULL,
	[IdBaja] [int] NULL,
	[FechaAlta] [smalldatetime] NOT NULL,
	[UsuarioAlta] [varchar](20) NOT NULL,
 CONSTRAINT [PK__CRED_Personas__50B28216] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY],
 CONSTRAINT [UQ__cred_Personas__3C417515] UNIQUE NONCLUSTERED 
(
	[Documento] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY],
 CONSTRAINT [UQ__CRED_Personas__4A8F946C] UNIQUE NONCLUSTERED 
(
	[Documento] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CRED_Autorizantes]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Autorizantes]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_Autorizantes](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[IdPersona] [int] NOT NULL,
	[FechaDesde] [datetime] NOT NULL,
	[IdBaja] [int] NULL,
	[FechaAlta] [smalldatetime] NOT NULL,
	[UsuarioAlta] [varchar](20) NOT NULL,
 CONSTRAINT [PK__CRED_Autorizante__548312FA] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CRED_Credenciales]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Credenciales]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_Credenciales](
	[Id] [smallint] IDENTITY(1,1) NOT NULL,
	[IdTipo] [smallint] NOT NULL,
	[IdBaja] [int] NULL,
	[FechaAlta] [smalldatetime] NOT NULL,
	[UsuarioAlta] [varchar](20) NOT NULL,
	[CodigoMagnetico] [int] NULL,
 CONSTRAINT [PK__CRED_Credenciale__5D1858FB] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CRED_Asignaciones]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Asignaciones]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_Asignaciones](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[IdCredencial] [smallint] NOT NULL,
	[IdPersona] [int] NOT NULL,
	[Fecha] [smalldatetime] NOT NULL,
	[IdDocumento] [smallint] NOT NULL,
	[IdAutorizante] [int] NOT NULL,
	[IdOrganismo] [smallint] NOT NULL,
	[IdBaja] [int] NULL,
	[IdUsuario] [smallint] NOT NULL,
 CONSTRAINT [PK__CRED_Asignacione__62D13251] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[CRED_CredencialesAsignablesAPersonas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_CredencialesAsignablesAPersonas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_CredencialesAsignablesAPersonas](
	[IdPersona] [int] NOT NULL,
	[IdTipoCredencial] [smallint] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[CRED_HistoricoBajasPersonas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_HistoricoBajasPersonas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_HistoricoBajasPersonas](
	[IdBaja] [int] NOT NULL,
	[IdPersona] [int] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[CRED_PedidoAltaPersonas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_PedidoAltaPersonas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_PedidoAltaPersonas](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[IdDocumento] [smallint] NOT NULL,
	[IdOrganismo] [smallint] NOT NULL,
	[IdAutorizante] [int] NOT NULL,
	[IdConceptoRelacion] [smallint] NOT NULL,
	[FechaAlta] [smalldatetime] NOT NULL,
	[UsuarioAlta] [varchar](20) NOT NULL,
	[IdPersona] [int] NOT NULL,
	[Observacion] [varchar](200) NULL,
 CONSTRAINT [PK__CRED_PedidoAltaP__64B97AC3] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[WEB_Sincronizacion_SaldosLicencias]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_Sincronizacion_SaldosLicencias]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[WEB_Sincronizacion_SaldosLicencias](
	[Id_interna] [int] NOT NULL,
	[Id_Concepto] [smallint] NOT NULL,
	[id_modificacion] [int] IDENTITY(1,1) NOT NULL,
	[realizada] [bit] NOT NULL,
	[fecha] [smalldatetime] NOT NULL,
 CONSTRAINT [PK_WEB_Sincronizacion_SaldosLicencias] PRIMARY KEY CLUSTERED 
(
	[id_modificacion] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[WEB_Sincronizacion_DatosPersonales]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_Sincronizacion_DatosPersonales]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[WEB_Sincronizacion_DatosPersonales](
	[nro_documento] [int] NOT NULL,
	[id_modificacion] [int] IDENTITY(1,1) NOT NULL,
	[Realizada] [bit] NOT NULL,
	[fecha] [smalldatetime] NOT NULL,
 CONSTRAINT [PK_WEB_Sincronizacion_DatosPersonales] PRIMARY KEY CLUSTERED 
(
	[id_modificacion] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[ASIS_Parte_Plantillas_Fechas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Parte_Plantillas_Fechas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[ASIS_Parte_Plantillas_Fechas](
	[id] [int] NOT NULL,
	[id_interna] [int] NOT NULL,
	[desde] [smalldatetime] NOT NULL,
	[hasta] [smalldatetime] NOT NULL,
	[concepto] [smallint] NOT NULL,
 CONSTRAINT [PK_ASIS_Parte_Plantillas_Fechas] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[LEG_DDJJ_Cargos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_DDJJ_Cargos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_DDJJ_Cargos](
	[Nro_Documento] [int] NOT NULL,
	[Año] [smallint] NOT NULL,
	[UsuarioRecepciono] [smallint] NOT NULL,
	[FechaRecepciono] [smalldatetime] NOT NULL,
	[Folio] [varchar](10) NULL,
	[Id_Comprobante] [int] NULL,
	[Id] [int] IDENTITY(1,1) NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[LEG_Documentacion_Legajo]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Documentacion_Legajo](
	[Id_interna] [int] NOT NULL,
	[Foto] [bit] NOT NULL,
	[PresentoAptoMedico] [smallint] NOT NULL,
	[Decreto_894] [bit] NOT NULL,
	[FotocDNI] [bit] NOT NULL,
	[Cuadernillo] [bit] NOT NULL,
	[FotocObraSocial] [bit] NOT NULL,
	[Titulo] [smallint] NOT NULL,
	[CertifServAnt] [bit] NOT NULL,
	[AcreditEstadoCivil] [bit] NOT NULL,
	[CV] [bit] NOT NULL,
	[ActasNacimientoPresenta] [bit] NOT NULL,
	[ActasNacimientoCantidad] [smallint] NULL,
	[FotocDNIHijosPresenta] [bit] NOT NULL,
	[FotocDNIHijosCantidad] [smallint] NULL,
	[AntecedentesPenales] [bit] NOT NULL,
	[ComprobCUIT] [bit] NOT NULL,
	[OpcionJ] [bit] NOT NULL,
	[InfoSumaria] [smallint] NOT NULL,
	[Observaciones] [text] NULL,
	[DDJJCtr1] [bit] NOT NULL,
	[DDJJCtr2] [bit] NOT NULL,
	[DDJJCtr3] [bit] NOT NULL,
 CONSTRAINT [PK_LEG_Documentacion_Legajo] PRIMARY KEY CLUSTERED 
(
	[Id_interna] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[LEG_Desglose_FE]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_FE]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Desglose_FE](
	[Id] [int] NOT NULL,
	[Id_interna] [int] NOT NULL,
	[Documento] [int] NOT NULL,
	[Nivel_FE] [smallint] NULL,
	[Tipo_FE] [tinyint] NULL,
	[Desde] [datetime] NOT NULL,
	[Hasta] [datetime] NULL,
	[Acto_Tipo] [smallint] NULL,
	[Acto_Nro] [varchar](10) NULL,
	[Acto_Fecha] [datetime] NULL,
	[Acto_Tipo_Baja] [smallint] NULL,
	[Acto_Nro_Baja] [varchar](10) NULL,
	[Acto_Fecha_Baja] [datetime] NULL,
	[Baja] [bit] NOT NULL,
	[Usuario] [smallint] NULL,
	[Tratamiento] [smallint] NOT NULL,
	[Id_Area] [int] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CRED_PersonasRelevadas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_PersonasRelevadas]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_PersonasRelevadas](
	[Documento] [int] NOT NULL,
	[Apellido] [varchar](50) NOT NULL,
	[Nombre] [varchar](50) NOT NULL,
	[Lugar_de_trabajo] [varchar](8) NOT NULL,
	[Telefono] [varchar](26) NOT NULL,
	[Email_mds] [varchar](60) NOT NULL,
	[Email_personal] [varchar](60) NOT NULL,
	[Fecha_comunicacion] [smalldatetime] NULL,
	[IdBaja] [int] NULL,
	[IdUsuario] [smallint] NOT NULL,
 CONSTRAINT [PK__CRED_PersonasRel__5947C817] PRIMARY KEY CLUSTERED 
(
	[Documento] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CRED_Domicilios]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Domicilios]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_Domicilios](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[Documento] [int] NOT NULL,
	[Calle] [varchar](50) NOT NULL,
	[Numero] [varchar](6) NOT NULL,
	[Piso] [varchar](3) NOT NULL,
	[Depto] [varchar](255) NOT NULL,
	[Casa] [varchar](20) NOT NULL,
	[Manzana] [varchar](20) NOT NULL,
	[Torre] [varchar](20) NOT NULL,
	[Uf] [varchar](20) NOT NULL,
	[Codigo_postal] [varchar](12) NOT NULL,
	[Localidad] [varchar](60) NOT NULL,
	[Barrio] [varchar](50) NOT NULL,
	[IdLocalidad] [int] NULL,
 CONSTRAINT [PK__CRED_Domicilios__6D4EC0C4] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY],
 CONSTRAINT [UQ__cred_domicilios__70EA477E] UNIQUE NONCLUSTERED 
(
	[Documento] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[WEB_AgrupacionConceptosLicencia]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_AgrupacionConceptosLicencia]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[WEB_AgrupacionConceptosLicencia](
	[idGrupo] [int] NOT NULL,
	[idConcepto] [smallint] NOT NULL,
 CONSTRAINT [PK_WEB_AgrupacionConceptosLicencia] PRIMARY KEY CLUSTERED 
(
	[idConcepto] ASC,
	[idGrupo] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[Cred_CodigoImpresoCredencial]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Cred_CodigoImpresoCredencial]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Cred_CodigoImpresoCredencial](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[IdCredencial] [smallint] NOT NULL,
	[CodigoImpreso] [int] NULL,
 CONSTRAINT [PK__Cred_CodigoImpre__47B327C1] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[LEG_Desglose_NivelGrado]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_NivelGrado]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Desglose_NivelGrado](
	[Id] [int] NOT NULL,
	[Id_interna] [int] NOT NULL,
	[Documento] [int] NOT NULL,
	[Id_nivel] [smallint] NOT NULL,
	[Id_grado] [smallint] NOT NULL,
	[Desde] [datetime] NULL,
	[Jurisdiccion] [varchar](25) NULL,
	[Organismo] [varchar](25) NULL,
	[Folio] [char](10) NULL,
	[Acto_Tipo] [smallint] NULL,
	[Acto_Nro] [varchar](10) NULL,
	[Acto_Fecha] [datetime] NULL,
	[Usuario] [smallint] NOT NULL,
 CONSTRAINT [PK_LEG_Desglose_NivelGrado] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[Cred_Vencimientos_Asignaciones]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Cred_Vencimientos_Asignaciones]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[Cred_Vencimientos_Asignaciones](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[IdAsignacion] [int] NOT NULL,
	[FechaVencimiento] [datetime] NOT NULL,
 CONSTRAINT [PK__Cred_Vencimiento__43E296DD] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[WEB_Sincronizacion_Conceptos_Licencias]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_Sincronizacion_Conceptos_Licencias]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[WEB_Sincronizacion_Conceptos_Licencias](
	[id_concepto] [smallint] NOT NULL,
	[id_modificacion] [int] IDENTITY(1,1) NOT NULL,
	[Realizada] [bit] NOT NULL,
	[fecha] [smalldatetime] NOT NULL
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[LEG_Estudios_Otros]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Otros]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[LEG_Estudios_Otros](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Establecimiento] [varchar](200) NOT NULL,
	[Titulo] [varchar](200) NOT NULL,
	[Depende_De] [varchar](50) NOT NULL,
	[Expedido_Por] [varchar](200) NOT NULL,
	[Fecha_ingreso] [datetime] NULL,
	[Fecha_egreso] [datetime] NULL,
	[Folio_Nro] [char](10) NOT NULL,
	[Id_Interna] [int] NOT NULL,
	[Nro_Doc] [int] NOT NULL,
	[Cant_Horas_Totales] [smallint] NULL,
	[Cant_Materias_Totales] [smallint] NULL,
	[Evaluacion_Final] [smallint] NULL,
	[Incompleto] [bit] NOT NULL,
	[DatoDeBaja] [bit] NOT NULL,
	[DatoNoImprime] [bit] NOT NULL,
	[Usuario] [smallint] NOT NULL,
	[FechaProceso] [datetime] NOT NULL
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[MNS_Asignables]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MNS_Asignables]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[MNS_Asignables](
	[Id_Usuario] [smallint] NOT NULL,
	[VerTodos] [bit] NOT NULL,
 CONSTRAINT [PK_MNS_Asignables] PRIMARY KEY CLUSTERED 
(
	[Id_Usuario] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[WEB_Passwords]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_Passwords]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[WEB_Passwords](
	[idUsuario] [smallint] NOT NULL,
	[password] [varchar](150) NOT NULL,
 CONSTRAINT [PK_WEB_Passwords] PRIMARY KEY CLUSTERED 
(
	[idUsuario] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CRED_UsuariosAccesos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_UsuariosAccesos]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[CRED_UsuariosAccesos](
	[IdUsuario] [smallint] NOT NULL,
	[IdAcceso] [smallint] NOT NULL,
 CONSTRAINT [PK__CRED_UsuariosAcc__59D1D7FC] PRIMARY KEY CLUSTERED 
(
	[IdUsuario] ASC,
	[IdAcceso] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_NoFirmantes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_NoFirmantes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE procedure [dbo].[ASIS_GET_NoFirmantes] AS

SELECT DP.APELLIDO +'', '' + DP.nombre NOMBRE, 
	dp.id_interna, dp.nro_documento legajo  
FROM Legajos_No_Firman LNF 
INNER JOIN DATOS_PERSONALES DP
	 ON LNF.ID_INTERNA = DP.ID_INTERNA
LEFT JOIN dbo.Legajo_Bajas LB
	on LB.Id_interna = DP.Id_interna
WHERE LB.Id_Interna IS NULL
ORDER BY NOMBRE




' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_Legajos_No_Firma]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Legajos_No_Firma]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[ASIS_Legajos_No_Firma]
	@operacion [bit],
	@id_interna [int]

as



if @operacion = 0 begin

	if not exists (select id_interna from dbo.Legajos_no_firman where id_interna = @id_interna) begin
		insert into dbo.Legajos_no_firman
		values (@id_interna)
	end

end

if @operacion = 1 begin
	delete from dbo.Legajos_no_firman
	where id_interna =@id_interna

	
end

' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Legajo_No_Firma]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Legajo_No_Firma]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[ASIS_GET_Legajo_No_Firma]
	@Id_interna int
AS
SELECT id_interna 
FROM dbo.Legajos_No_Firman
WHERE Id_Interna = @Id_Interna

' 
END
GO
/****** Object:  StoredProcedure [dbo].[Proc_Modificar_IdInterna]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Proc_Modificar_IdInterna]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'Create procedure [dbo].[Proc_Modificar_IdInterna]
@id_interna_vieja int,
@id_interna_nueva int

as

--declare @id_interna_vieja as int
--set @id_interna_vieja = 20698--25314963

--declare @id_interna_nueva as int
--set @id_interna_nueva = 204698

------
------

declare @id_interna_ficticia as int
set @id_interna_ficticia = 1111111


------------------------------------------------------------
--
--  INSERTO ID_INTERNA FICTICIA EN DATOS PERSONALES
--
------------------------------------------------------------

insert into dbo.datos_personales
(id_interna, apellido, nombre, sexo, fecha_nacimiento, nacionalidad, cuil_nro, 
tipo_documento, nro_documento, estado_civil, usuario, visibleLegajos, 
visiblecontratos, bajalegajos, bajacontratos)
values
(@id_interna_ficticia, '''','''',1,''01/01/1900'', 1, ''22000000001'',
1, 0, 1, 1, 0, 0, 0, 0)


------------------------------------------------------------
--
--  ACTUALIZO LA ID_VIEJA POR UNA FICTICIA EN EL RESTO DE LAS TABLAS
--
------------------------------------------------------------

update dbo.antec_militares 
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Antiguedad
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.ASIS_Parte_Plantillas_Fechas
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.ASIS_Solicitudes_Licencia_Web
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.ASIS_Solicitudes_Licencia_Web_Rechazadas
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Autorizaciones_Licencias
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Calificaciones
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Capacitacion
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Carrera_Administrativa
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Certificados_Escolaridad 
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.CTR_Antiguedad_Grado_Reconocidas
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Datos_Familiares
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.designaciones
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.designaciones_fechas
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.documentacion_legajo
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.domicilio_familiares
	set id_interno = @id_interna_ficticia where id_interno = @id_interna_vieja

update dbo.Domicilio_Laboral
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Domicilio_Personal
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Embargos
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Estudios_Especilidades
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Estudios_Idiomas
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Estudios_Otros
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Estudios_Realizados
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.EVAL_Periodos_Evaluacion
	set id_interna_coordinador = @id_interna_ficticia where id_interna_coordinador = @id_interna_vieja

update dbo.Felicitaciones
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.GU_Cert_Nacimiento
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.GU_DDJJ_Guarderia
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.GU_Facturas_Guarderia
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.GU_Recibos_Haberes
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.L_IMP_Estudios_Especilidades
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.LEG_Administracion_Folios
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.LEG_Certificados_Escolaridad
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.LEG_Desglose_Area
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.LEG_Desglose_FE
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.LEG_Desglose_NivelGrado
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.LEG_Desglose_Planta
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.LEG_Desglose_UR
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.LEG_Documentacion_Legajo
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.LEG_Documentacion_Legajo_Intimacion
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.LEG_Estudios_Especialidades
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.LEG_Estudios_Idiomas
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.LEG_Estudios_Otros
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.LEG_Estudios_Realizados
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.LEG_Licencias_Autorizadas
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.LEG_Otros_Servicios
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.LEG_Servicios_Adm_Publica
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Legajos_No_Firman
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Licencias
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Licencias_Solicitadas
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.licencias_solicitadas_bk_141107
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Otros_Datos
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Otros_Indice_Documentos
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Pasividad
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.PLA_Pases_Solicitados
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.PLA_Pases_Solicitados_BACKUP20090714
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.PLA_Pases_Solicitados_BACKUP20090715
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.PLA_Recibos
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.PLA_Recibos_111108
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.PLA_Recibos_Detalle
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.PLA_Recibos_Detalle_111108
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Psicofisico
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Sanciones
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.SEG_SEGUROS_ACTIVOS
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Servicios_Jubilatorios
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Situaciones_Especiales
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Tabla_Firmantes
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Tabla_Temporal_Dotacion_Completa
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.tmp_autorizaciones_licencias
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.TMP_LEG_Servicios_Jubilatorios
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.TMP_RPT_Indice_Documentos
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.tmp2_autorizaciones_licencias
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.WEB_Sincronizacion_SaldosLicencias
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja

update dbo.Legajo_Bajas
	set id_interna = @id_interna_ficticia where id_interna = @id_interna_vieja


------------------------------------------------------------
--
--  ACTUALIZO LA ID_VIEJA POR LA NUEVA EN DATOS PERSONALES
--
------------------------------------------------------------

update dbo.datos_personales
	set id_interna = @id_interna_nueva where id_interna = @id_interna_vieja

------------------------------------------------------------
--
--  ACTUALIZO LA ID_FICTICIA POR LA NUEVA EN EL RESTO DE LAS TABLAS
--
------------------------------------------------------------

update dbo.antec_militares 
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Antiguedad
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.ASIS_Parte_Plantillas_Fechas
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.ASIS_Solicitudes_Licencia_Web
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.ASIS_Solicitudes_Licencia_Web_Rechazadas
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Autorizaciones_Licencias
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Calificaciones
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Capacitacion
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Carrera_Administrativa
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Certificados_Escolaridad 
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.CTR_Antiguedad_Grado_Reconocidas
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Datos_Familiares
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.designaciones
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.designaciones_fechas
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.documentacion_legajo
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.domicilio_familiares
	set id_interno = @id_interna_nueva where id_interno = @id_interna_ficticia

update dbo.Domicilio_Laboral
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Domicilio_Personal
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Embargos
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Estudios_Especilidades
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Estudios_Idiomas
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Estudios_Otros
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Estudios_Realizados
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.EVAL_Periodos_Evaluacion
	set id_interna_coordinador = @id_interna_nueva where id_interna_coordinador = @id_interna_ficticia

update dbo.Felicitaciones
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.GU_Cert_Nacimiento
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.GU_DDJJ_Guarderia
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.GU_Facturas_Guarderia
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.GU_Recibos_Haberes
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.L_IMP_Estudios_Especilidades
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.LEG_Administracion_Folios
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.LEG_Certificados_Escolaridad
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.LEG_Desglose_Area
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.LEG_Desglose_FE
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.LEG_Desglose_NivelGrado
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.LEG_Desglose_Planta
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.LEG_Desglose_UR
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.LEG_Documentacion_Legajo
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.LEG_Documentacion_Legajo_Intimacion
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.LEG_Estudios_Especialidades
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.LEG_Estudios_Idiomas
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.LEG_Estudios_Otros
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.LEG_Estudios_Realizados
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.LEG_Licencias_Autorizadas
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.LEG_Otros_Servicios
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.LEG_Servicios_Adm_Publica
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Legajos_No_Firman
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Licencias
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Licencias_Solicitadas
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.licencias_solicitadas_bk_141107
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Otros_Datos
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Otros_Indice_Documentos
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Pasividad
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.PLA_Pases_Solicitados
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.PLA_Pases_Solicitados_BACKUP20090714
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.PLA_Pases_Solicitados_BACKUP20090715
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.PLA_Recibos
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.PLA_Recibos_111108
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.PLA_Recibos_Detalle
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.PLA_Recibos_Detalle_111108
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Psicofisico
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Sanciones
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.SEG_SEGUROS_ACTIVOS
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Servicios_Jubilatorios
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Situaciones_Especiales
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Tabla_Firmantes
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Tabla_Temporal_Dotacion_Completa
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.tmp_autorizaciones_licencias
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.TMP_LEG_Servicios_Jubilatorios
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.TMP_RPT_Indice_Documentos
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.tmp2_autorizaciones_licencias
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.WEB_Sincronizacion_SaldosLicencias
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia

update dbo.Legajo_Bajas
	set id_interna = @id_interna_nueva where id_interna = @id_interna_ficticia


------------------------------------------------------------
--
--  BORRO LA ID INTERNA FICTICIA DE DP
--
------------------------------------------------------------

delete from WEB_Sincronizacion_DatosPersonales where nro_documento = 0
delete from dbo.datos_personales where id_interna = @id_interna_ficticia


--***************

---  TEMA PAILALEF

/*
select * from dbo.Datos_Personales
where nro_documento = 8213511


update dbo.Datos_Personales set VisibleLegajos = 1 where nro_documento = 8213511

select * from dbo.Designaciones_Fechas
where nro_doc = 8213511

INSERT INTO [DB_RRHH].[dbo].[Designaciones_Fechas]
           ([Fecha_Adm_Pub]
           ,[Fecha_Min]
           ,[Nro_Doc]
           ,[Id_Interna])
     VALUES
           (<Fecha_Adm_Pub, smalldatetime,>
           ,<Fecha_Min, smalldatetime,>
           ,8213511
           ,202920)


select * from dbo.Domicilio_Personal
where nro_doc = 8213511

update dbo.Domicilio_Personal
set id_interna = 202920
where nro_doc = 8213511


select * from dbo.LEG_Desglose_Area where documento = 8213511
select * from dbo.LEG_Desglose_Planta where documento = 8213511

select * from dbo.LEG_Desglose_FE where documento = 8213511
select * from dbo.LEG_Desglose_NivelGrado where documento = 8213511
select * from dbo.LEG_Desglose_UR where documento = 8213511

*/

' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_ASIS_Parte_Asistencia]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_ASIS_Parte_Asistencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[RPT_ASIS_Parte_Asistencia]  
 @legajo [int]=Null,  
 @Area [int]=null,  
 @Dep varchar(25)=null,  
 @usuario int=null
AS  
SET NOCOUNT ON  
IF @Dep IS NULL BEGIN  
 SELECT dp.id_interna,  
  Dp.nro_documento Legajo,   
  dp.apellido +'', ''+ dp.nombre Nombre,   
  dbo.FxCadena_Dependencia (DA.Id_area) CadenaDependencia,  
  df.fecha_min,  
  da.id_Area Id_Area  
 FROM dbo.datos_personales DP  
 INNER JOIN dbo.Designaciones_fechas DF  
  on df.id_interna = dp.Id_interna  
 INNER JOIN dbo.VW_Desglose_Area DA  
  on Da.id_interna = Dp.Id_Interna  
 INNER join dbo.Tabla_Areas TA  
  on TA.Id = DA.Id_Area   AND  
            (TA.Id = @Area OR @Area IS NULL)    
 --agrego desde aca  
 left join dbo.legajos_no_firman lnf on dp.id_interna = lnf.id_interna  
 left join dbo.legajo_bajas lb on dp.id_interna = lb.id_interna  
 --agrego hasta aca  
 where  (dp.id_interna = @LEgajo or @legajo is null)  AND  
  lnf.id_interna is null AND   
  lb.id_interna is null  AND   
  Dp.BajaLegajos = 0  
   
  --(  
  --((ta.id_area = @Area) and (right(ta.codigo,5) <> 0)) or   
  --(@Area is null)  
  --)   
 ORDER BY Cadenadependencia,nombre  
END  
ELSE  
BEGIN  
   
 DECLARE @IdDependencia int  
 SET @IdDependencia = (select distinct id_area from dbo.Tabla_Areas_Estructura where codigo = @Dep)  
  
 CREATE TABLE #TAreas   
  (Codigo int)  
 INSERT INTO #TAreas  
 SELECT codigo   
 FROM dbo.Fx_Listar_Dependencias_Areas (@IdDependencia)    
  
  
 SELECT distinct   
  dp.id_interna,  
  Dp.nro_documento Legajo,   
  dp.apellido +'', ''+ dp.nombre Nombre,   
  dbo.FxCadena_Dependencia (dA.Id_area) CadenaDependencia,  
  df.fecha_min,  
  da.id_area  
   
 FROM dbo.datos_personales DP  
   
 INNER JOIN dbo.Designaciones_fechas DF  
  on df.id_interna = dp.Id_interna  
   
 INNER JOIN dbo.VW_Desglose_Area DA  
  on Da.id_interna = Dp.Id_Interna  
  
 INNER JOIN #TAreas TTa  
  on TTa.codigo = DA.id_area  
  
 --agrego desde aca  
 left join dbo.legajos_no_firman lnf on dp.id_interna = lnf.id_interna  
 left join dbo.legajo_bajas lb on dp.id_interna = lb.id_interna  
 --agrego hasta aca  
  
     
 WHERE (dp.id_interna = @LEgajo or @legajo is null)  AND  
  lnf.id_interna is null AND   
  lb.id_interna is null   
  
 ORDER BY Cadenadependencia,nombre  
  
 DROP TABLE #TAreas  
END  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Recepcion_Planillas_Firmas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Recepcion_Planillas_Firmas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[ASIS_GET_Recepcion_Planillas_Firmas]
	@PeriodoDesde varchar(6),
	@PeriodoHasta varchar(6),
	@Area1 Int = NULL,
	@Area2 Int = NULL,
	@Area3 Int = NULL,
	@Area4 Int = NULL,
	@Area5 Int = NULL,
	@Area6 Int = NULL,
	@Area7 Int = NULL,
	@Area8 Int = NULL,
	@Area9 Int = NULL,
	@Area10 Int = NULL,
	@id_interna int= NULL
AS
SELECT 
DP.Apellido + '', '' + DP.Nombre Apellido, 
PR.Periodo, 
TA.Descripcion,
DF.Fecha_Min,
Year(Fecha_Min) * 100 + case when month(Fecha_Min) < 10 then ''0'' + month(fecha_min)  else month(fecha_min) end minis,
@PeriodoDesde desde,
@PeriodoHasta hasta
FROM dbo.Datos_Personales DP
LEFT JOIN dbo.ASIS_Planillas_Recibidas PR
	ON DP.Id_Interna = PR.Agente AND
	(RIGHT(PR.Periodo,4) + LEFT(PR.Periodo,2) BETWEEN @PeriodoDesde AND @PeriodoHasta OR PR.Periodo IS NULL) 
INNER JOIN dbo.VW_Desglose_Area DA 
	ON DP.Id_Interna = DA.id_Interna
INNER JOIN dbo.Tabla_Areas TA 
	ON DA.Id_Area = TA.id
LEFT JOIN dbo.Designaciones_Fechas DF
	ON DP.Id_Interna = DF.Id_Interna
LEFT JOIN dbo.Legajos_No_Firman LNF
	on LNF.Id_interna = DP.Id_Interna
LEFT JOIN dbo.Legajo_Bajas LB
	on lb.id_interna = dp.id_interna
WHERE 

LNF.Id_Interna IS NULL AND
LB.Id_Interna IS NULL AND 
DP.VisibleLegajos = 1 AND 
(DP.Id_Interna = @id_interna OR @id_interna IS NULL) AND
(((DA.Id_Area = @Area1) OR
(DA.Id_Area = @Area2) OR 
(DA.Id_Area = @Area3) OR
(DA.Id_Area = @Area4) OR 
(DA.Id_Area = @Area5) OR
(DA.Id_Area = @Area6) OR
(DA.Id_Area = @Area7) OR
(DA.Id_Area = @Area8) OR
(DA.Id_Area = @Area9)) or @Area1 IS NULL)
AND Year(Fecha_Min) * 100 + case when month(Fecha_Min) < 10 then ''0'' + month(fecha_min)  else month(fecha_min) end <= @PeriodoHasta

ORDER BY TA.id, DP.Apellido, DP.Nombre, RIGHT(PR.Periodo,4) + LEFT(PR.Periodo,2)

' 
END
GO
/****** Object:  View [dbo].[VW_Tabla_Goce_Sueldo_Licencia]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Goce_Sueldo_Licencia]'))
EXEC dbo.sp_executesql @statement = N'


CREATE VIEW [dbo].[VW_Tabla_Goce_Sueldo_Licencia]
AS
SELECT *
FROM TABLA_GOCE_SUELDO_LICENCIA



'
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Conceptos_Licencias]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Conceptos_Licencias]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'





CREATE procedure [dbo].[GABM_Tabla_Conceptos_Licencias]
	@Operacion char(1),
	@Id 	[int]=null,
	@Descripcion 	[varchar](30)=null,
	@Articulo varchar(5) = null,
	@concepto varchar(5)   = null,
	@dias_autorizados int   = null,
	@Acumulativa bit   = null,
	@goce_haberes smallint   = null,
	@es_ordinaria bit   = null,
	@Anual bit   = null,
	@dias_habiles bit   = null,	
	@send_legajos bit   = null,
	@licencia_medica bit   = null,
	@regresa_medica bit   = null,
	@GeneraDerechoOrdinaria bit   = null,
	@baja bit   = null,
	@DiasMensuales smallint   = null,	
	@DiasConsecutivos smallint   = null,
	@Usuario int = null
AS 

IF @operacion =''A''
BEGIN

	Declare @MAx [int]
	set @Max = (select max(id_concepto)+1 from dbo.Tabla_Conceptos_Licencias)
	if @Max is null begin
		set @Max=1
	end
	INSERT INTO dbo.Tabla_Conceptos_Licencias
		(nro_articulo,
		concepto,
		descripcion,
		dias_autorizados,
		id_concepto,
		acumulativa,
		goce_haberes,
		es_ordinaria,
		anual,
		dias_habiles,
		send_legajos,
		regresa_medica,
		generaderechoordinaria,
		baja,
		diasmensuales,
		diasconsecutivos,
		Usuario) 
 	VALUES (@Articulo,
		@Concepto,
		@Descripcion,
		@Dias_Autorizados,
		@Max,
		@Acumulativa,
		@goce_haberes,
		@es_ordinaria,
		@anual,
		@dias_habiles,
		@send_legajos,
		@regresa_medica,
		@generaderechoordinaria,
		0,
		@diasmensuales,
		@diasconsecutivos,
		@Usuario)

END


IF @operacion =''M''
BEGIN
	UPDATE 	dbo.Tabla_Conceptos_Licencias
	SET 	Nro_Articulo = @articulo,
		Concepto = @Concepto,
		Descripcion =  @Descripcion,
		Dias_autorizados = @Dias_Autorizados,
		Acumulativa = @Acumulativa,
		Goce_Haberes = @Goce_Haberes,
		Es_Ordinaria = @Es_Ordinaria,
		Anual = @Anual,
		Dias_Habiles = @Dias_Habiles,
		Send_Legajos = @Send_Legajos,
		Licencia_Medica = @Licencia_Medica,
		Regresa_Medica = @Regresa_Medica,
		GeneraDerechoOrdinaria = @GeneraDerechoOrdinaria,
		DiasMensuales = @DiasMensuales,
		DiasConsecutivos = @DiasConsecutivos,
		Usuario = @Usuario
	WHERE	Id_Concepto = @Id
END


IF @operacion =''B''
BEGIN

	UPDATE 	dbo.Tabla_Conceptos_Licencias
	SET 	Baja =  1,
		Usuario = @Usuario
	WHERE 	Id_Concepto = @Id

END


IF @operacion =''R''
BEGIN
	UPDATE 	dbo.Tabla_Conceptos_Licencias
	SET 	Baja =  0,
		Usuario = @Usuario
	WHERE 	Id_Concepto = @Id
END


IF @operacion =''S''
BEGIN
	SELECT	
	id_Concepto,
	Nro_Articulo,
	Concepto,
	TCL.Descripcion,
	Dias_Autorizados,
	case when Acumulativa = 1 then
			''Si''
		else
			''No''
	end Acumulativa,
	TGL.Descripcion Goce_Haberes,
	case when Es_Ordinaria = 1 then
			''Si''
		else
			''No''
	end Es_Ordinaria,
	case when Anual = 1 then
			''Si''
		else
			''No''
	end Anual,
	case when Dias_Habiles = 1 then
			''Si''
		else
			''No''
	end Dias_Habiles,
	case when Send_Legajos = 1 then
			''Si''
		else
			''No''
	end Send_Legajos,
	case when Licencia_Medica = 1 then
			''Si''
		else
			''No''
	end Licencia_Medica,
	case when  GeneraDerechoOrdinaria = 1 then
			''Si''
		else
			''No''
	end  GeneraDerechoOrdinaria,
	case when  baja = 1 then
			''Si''
		else
			''No''
	end  Baja,
	DiasMensuales,
	DiasConsecutivos,
	case when  Regresa_Medica = 1 then
			''Si''
		else
			''No''
	end  Regresa_Medica


	FROM  dbo.Tabla_Conceptos_Licencias TCL
	INNER JOIN dbo.Tabla_Goce_Sueldo_Licencia TGL
		on TGL.id = TCL.Goce_Haberes

	WHERE (id = @ID) OR (@ID is null)
	ORDER BY TCL.id_Concepto,
		 TCL.Nro_Articulo--, 
		 -- TCL.descripcion
END
















' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Licencias_Pendientes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Licencias_Pendientes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[ASIS_GET_Licencias_Pendientes]
	@id_Interna [int],
	@Lic_medica bit = null
as

set @Lic_medica = null--borrar linea
select  ''Tomadas'' Estado, --Solicitadas
        LS.Id,
	LS.Periodo,
	ls.Dias_A_Tomar,
	ls.desde,
	ls.hasta,
	ls.dias_descuento,
	tgs.descripcion goce,
	ls.observaciones,
	ls.id_area,
	ls.autorizo_descuento,
	Tcl.Nro_Articulo + tcl.Concepto + '' - '' +Tcl.descripcion descripcion,
	(tcl.dias_autorizados - LS.dias_A_Tomar)  Dias_Restantes,	
	(select max(case when dias_tomados is null then 0 else dias_tomados end) DT from autorizaciones_licencias al
	where al.id_interna = @id_interna and al.periodo = ls.periodo and tcl.id_concepto=  al.id_concepto_licencia) dt,
	ta.descripcion Area,
	case when tcl.es_ordinaria = 1 then al.dias_autorizados else tcl.dias_autorizados end dias_autorizados,
	ls.id,
	tcl.id_Concepto ,
	tcl.Dias_habiles esHabil,
	informo,
	ls.goce Id_Goce

from dbo.licencias_solicitadas LS
inner join dbo.tabla_conceptos_licencias TCL
	on TCL.id_concepto = LS.concepto
inner join dbo.tabla_areas TA
	on ta.id = ls.id_area
inner join dbo.Tabla_Goce_Sueldo_Licencia tgs 
	on tgs.id = ls.goce
left join dbo.autorizaciones_licencias al on
	ls.id_tabla_autorizacion = al.id

where LS.id_interna = @id_interna and (tcl.licencia_medica = @lic_medica or @lic_medica is null)

/*
union  all

select  ''Pendiente'' Estado, --pendientes
        Lp.Id_Detalle,
	Lp.dias_A_Tomar,
	Lp.desde,
	Lp.hasta,
	Lp.dias_descuento,
	tgs.descripcion goce,
	Lp.observaciones,
	Lp.id_area,
	lp.autorizo_descuento,
	Tcl.Nro_Articulo + tcl.Concepto + '' - '' +Tcl.descripcion descripcion,
	(tcl.dias_autorizados - lp.dias_A_Tomar) Dias_Restantes,
	(select max(case when dias_tomados is null then 0 else dias_tomados end) DT from autorizaciones_licencias al
	where al.id_interna = @id_interna and al.periodo = lp.periodo and tcl.id_concepto=  al.id_concepto_licencia) dt,
	ta.descripcion Area,
	tcl.dias_autorizados,
	lp.id,
	tcl.id_concepto,
	tcl.Dias_habiles esHabil,
	informo,
	lp.goce Id_Goce	
from dbo.ASIS_Parte_Detalle LP
inner join dbo.tabla_conceptos_licencias TCL
	on TCL.id_concepto = lp.Asistencia
inner join dbo.tabla_areas TA
	on ta.id = lp.id_area
inner join dbo.Tabla_Goce_Sueldo_Licencia tgs 
	on tgs.id = TCL.goce_Haberes
where lp.id_interna = @id_interna and (tcl.licencia_medica = @lic_medica or @lic_medica is null)

*/

' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Periodos_Goce]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/****** Object:  StoredProcedure [dbo].[ASIS_GET_Licencias_Pendientes_Medicas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Licencias_Pendientes_Medicas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE   procedure [dbo].[ASIS_GET_Licencias_Pendientes_Medicas]    
 @id_Interna [int],    
 @Lic_medica bit = null,    
 @Id_Lic int = null    
as    
select    
 ''Tomadas'' Estado,  --Solicitadas    
 LS.Id,    
 ls.periodo,    
 ls.Dias_A_Tomar,    
 ls.desde,    
 ls.hasta,    
 ls.dias_descuento,    
 tgs.descripcion goce,    
 ls.observaciones,    
 ls.id_area,    
 ls.autorizo_descuento,    
 Tcl.Nro_Articulo + tcl.Concepto + '' - '' +Tcl.descripcion descripcion,    
 (tcl.dias_autorizados - LS.dias_A_Tomar)  Dias_Restantes,     
     
 (select max(case when dias_tomados is null then 0 else dias_tomados end) DT from autorizaciones_licencias al    
 where al.id_interna = @id_interna and al.periodo = ls.periodo and tcl.id_concepto=  al.id_concepto_licencia) dt,    
 ta.descripcion Area,    
 tcl.dias_autorizados,    
 ls.id,    
 tcl.id_Concepto ,    
 tcl.Dias_habiles esHabil,    
 informo,    
 ls.goce Id_Goce    
    
from dbo.licencias_solicitadas LS    
inner join dbo.tabla_conceptos_licencias TCL    
 on TCL.id_concepto = LS.concepto    
left join dbo.tabla_areas TA    
 on ta.id = ls.id_area    
inner join dbo.Tabla_Goce_Sueldo_Licencia tgs     
 on tgs.id = ls.goce    
where LS.id_interna = @id_interna and (tcl.licencia_medica = @lic_medica or @lic_medica is null) and     
 (ls.id=@id_lic or @id_lic is null)    
    
/*
union  all    
select  ''Pendiente'' Estado, --pendientes    
        Lp.Id,    
 Lp.periodo,    
 Lp.dias_A_Tomar,    
 Lp.desde,    
 Lp.hasta,    
 Lp.dias_descuento,    
 tgs.descripcion goce,    
 Lp.observaciones,    
 Lp.id_area,    
 lp.autorizo_descuento,    
 Tcl.Nro_Articulo + tcl.Concepto + '' - '' +Tcl.descripcion descripcion,    
 (tcl.dias_autorizados - lp.dias_A_Tomar) Dias_Restantes,    
    
 (select max(case when dias_tomados is null then 0 else dias_tomados end) DT from autorizaciones_licencias al    
 where al.id_interna = @id_interna and al.periodo = lp.periodo and tcl.id_concepto=  al.id_concepto_licencia) dt,    
 ta.descripcion Area,    
 tcl.dias_autorizados,    
 lp.id,    
 tcl.id_concepto,    
 tcl.Dias_habiles esHabil,    
 informo,    
 lp.goce Id_Goce    
     
from dbo.Licencias_pendientes LP    
inner join dbo.tabla_conceptos_licencias TCL    
 on TCL.id_concepto = lp.concepto    
left join dbo.tabla_areas TA    
 on ta.id = lp.id_area    
inner join dbo.Tabla_Goce_Sueldo_Licencia tgs     
 on tgs.id = lp.goce    
where lp.id_interna = @id_interna and (tcl.licencia_medica = @lic_medica or @lic_medica is null)  
*/  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Estudios_Idiomas]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Estudios_Idiomas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[RPT_LEG_Estudios_Idiomas]
	@Id_interna int
as
select  top 4
	ti.descripcion Idioma,
	tnih.descripcion Habla,
	tnil.descripcion Lee,
	tnie.descripcion Escribe,
	ER.ID_interna
FROM dbo.Estudios_idiomas ER
INNER JOIN dbo.Tabla_Nivel_Idioma TNIH
	on TNIH.id = ER.Habla
INNER JOIN dbo.Tabla_Nivel_Idioma TNIL
	on TNIL.id = ER.lee
INNER JOIN dbo.Tabla_Nivel_Idioma TNIE
	on TNIE.id = ER.escribe
INNER JOIN dbo.Tabla_Idiomas TI
	on TI.id = ER.Idioma

where id_interna = @Id_interna AND
	DatoDeBaja = 0 AND
	DatoNoImprime = 0 






' 
END
GO
/****** Object:  StoredProcedure [dbo].[ABM_nivel_idioma]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ABM_nivel_idioma]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ABM_nivel_idioma]
	(@ID [smallint],
	@Descripcion	[varchar](25),
	@operacion [int])

AS 
declare @MaxId [int]
set @maxId = (select max(id) +1 from dbo.tabla_nivel_idioma )

--ALTA
IF  @operacion = 1 
BEGIN
	INSERT INTO dbo.tabla_nivel_idioma
	 ([Id],
	 Descripcion) 
	VALUES 
		(@maxid,
		@Descripcion)
END


-- MODIFICACION
IF @operacion = 2 
BEGIN
	UPDATE dbo.tabla_nivel_idioma 
	SET   [Id]= @id,
	          Descripcion= @Descripcion
	WHERE 
		ID =  @ID		
END

--BAJA
IF @OPERACION =3  
BEGIN
	UPDATE dbo.tabla_nivel_idioma 
	SET   baja = 1
	WHERE 
		ID =  @ID		
END


--CONSULTA
IF @OPERACION =4 
BEGIN
	SELECT * FROM dbo.tabla_nivel_idioma
	where baja =0
	order by id
END


-- VERIFICA SI EXISTE EN DB
IF @OPERACION=5
BEGIN
	SELECT * FROM dbo.tabla_nivel_idioma
	where descripcion=@descripcion
END

' 
END
GO
/****** Object:  View [dbo].[VW_Idiomas_Niveles]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Idiomas_Niveles]'))
EXEC dbo.sp_executesql @statement = N'


CREATE  VIEW [dbo].[VW_Idiomas_Niveles]
AS
SELECT id,descripcion
FROM tabla_nivel_Idioma
WHERE baja =0




'
GO
/****** Object:  StoredProcedure [dbo].[GetEstudios_Idiomas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetEstudios_Idiomas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GetEstudios_Idiomas]
	(@Id_Interna_5 	[int],
	 @Nro_doc_6 	[int])

AS 
select datodebaja,datonoimprime,
id_estudio,
(select descripcion from [dbo].tabla_idiomas TI where TI.id = EI.idioma) Idioma,
(select descripcion from [dbo].tabla_nivel_idioma TI where TI.id = EI.habla) Habla, 
(select descripcion from [dbo].tabla_nivel_idioma TI where TI.id = EI.escribe) Escribe, 
(select descripcion from [dbo].tabla_nivel_idioma TI where TI.id = EI.Lee) Lee,
EI.folio

from [dbo].Estudios_Idiomas EI

where 	
( [Id_Interna] = @Id_Interna_5 or  [Nro_doc] =@Nro_doc_6) and datodebaja=0
' 
END
GO
/****** Object:  StoredProcedure [dbo].[RELEVA_Antiguedad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RELEVA_Antiguedad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[RELEVA_Antiguedad]   
  @Documento int      
AS      
      
SELECT DP.Apellido,      
 DP.Nombre,      
 TD.Descripcion Tipo_Documento,      
 DP.Nro_Documento,      
 AP.Organismo,      
 TFC.Descripcion CArgo,      
 convert(char(10),Ap.Fecha_desde,103) Desde,      
 convert(char(10),AP.Fecha_HAsta,103) Hasta,      
 TNE.Descripcion Nivel,      
    
/* case when e.Certificado_Expedido_por <> '''' then      
   e.Certificado_Expedido_por       
 else      
   TEI.nombre    
 end Institucion,      
  */  
 case when TEI.Nombre IS NULL then      
	case when tef.Descripcion IS NULL THEN
		  e.Certificado_Expedido_por       
	ELSE
		TEF.Descripcion
	END
 else      
  TEI.nombre    
 end Institucion,      

 TET.descripcion Titulo    
     
FROM dbo.Datos_Personales DP      
    
INNER JOIN dbo.Tabla_DocIdentidad TD      
  ON TD.Id = DP.Tipo_Documento      
    
LEFT JOIN dbo.LEG_Estudios_Realizados E      
  ON E.Nro_Doc = DP.Nro_Documento AND      
     E.DatoDeBaja = 0 AND      
     E.Id = (Select top 1 id     
      from dbo.LEG_Estudios_realizados  ER      
      where nro_doc = @Documento and --completo = 1 AND   
 DatoDeBaja = 0      
      order by fecha_ingreso desc )      
    
LEFT JOIN dbo.LEG_Servicios_Adm_Publica AP      
 ON AP.Doc_Titular = DP.Nro_Documento     
 AND AP.DatoDeBaja = 0      
    
LEFT JOIN dbo.Tabla_nivel_estudios TNE      
 ON TNE.Id = E.Id_Nivel      
    
LEFT JOIN dbo.Tabla_Funciones_Cargos TFC      
 ON TFC.Id = AP.Cargo      
    
LEFT JOIN dbo.Tabla_Estudios_Facultades TEF    
 ON E.Id_Facultad = TEF.Id    
 AND TEF.baja = 0    
    
LEFT JOIN dbo.Tabla_Estudios_Titulos TET    
 ON TET.Id = E.Id_Titulo    
 AND TET.baja = 0    
    
LEFT JOIN dbo.Tabla_Estudios_Instituciones TEI    
 ON TEI.id = e.id_institucion    
 AND TEI.baja = 0    
    
WHERE DP.Nro_Documento = @Documento      
order by cast(Ap.Fecha_desde as datetime) ,cast(AP.Fecha_Hasta as datetime)       
      
      
      
      
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Estudios_Realizados]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Estudios_Realizados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE  procedure [dbo].[RPT_LEG_Estudios_Realizados]
	@NroDocumento int  
AS
SELECT	TEN.Descripcion Nivel,
	rtrim(TET.Descripcion) Titulo,
	convert(char(10),E.Fecha_Ingreso,103) Fecha_ingreso,
	convert(char(10),E.Fecha_Egreso,103) Fecha_Egreso,
	CASE WHEN TEU.Descripcion IS NULL THEN
		rtrim(TEI.Nombre  +'' ''+ isnull(cast(TEI.Nro as char),'''')) 
	ELSE
		TEU.Descripcion
	END  Institucion,
	E.Folio_Nro Folio
FROM 	dbo.LEG_Estudios_Realizados E  
INNER JOIN dbo.Tabla_Estudios_Niveles TEN
	ON TEN.Id = E.Id_Nivel
INNER JOIN dbo.Tabla_Estudios_Titulos TET
	ON TET.Id = E.Id_Titulo AND
	   TET.Id <> 0
LEFT JOIN dbo.Tabla_Estudios_Instituciones TEI
	ON TEI.Id = E.Id_Institucion AND
	   TEI.Id <> 0
LEFT JOIN dbo.Tabla_Estudios_Universidades TEU
	ON TEU.Id = E.Id_Universidad AND
	   TEU.Id <> 0
WHERE  	Nro_Doc = @NroDocumento 
	AND DatodeBaja = 0 
	AND DatoNoImprime = 0
ORDER BY TEN.Orden
  
  







' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_CTR_Antiguedad_Reconocida_Grado]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_CTR_Antiguedad_Reconocida_Grado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[RPT_CTR_Antiguedad_Reconocida_Grado]                              
  @id_contrato int = 0,                      
  @marca int,    -- 0: Trae las experiencias tomadas        
    -- 1: Trae el encabezado del certificado                           
  @id_certificado  int = null       
AS
SET NOCOUNT ON                        


--ACA FALTA LA PRIMER FECHA DE NIVEL
--DECLARE  @fecha_nivel datetime    
--create table #fecha_nivel    
--(    
-- fecha datetime    
--)    
--    
--insert into #fecha_nivel    
--exec dbo.ctr_get_primer_fecha_nivel @id_contrato    
--    
--select @fecha_nivel = fecha from #fecha_nivel   
--PRIMERFECHA DE NIVEL
                      
--TOMADAS                  
                          
DECLARE --@Id_Calculo int                     
 @desde_ct char(10),                    
 @hasta_ct char(10),                                      
 @FechaCertificado char(10),                    
 @FechaAsignacion char(10),                
 @Nivelcert char(5),                
 @Gradocert char (5),                
 @Antiguedadcert smallint,                
 @Nro_Documento    int                
       
               
IF @id_contrato > 0  
BEGIN  
 select @id_certificado = IdCertificado,                       
  @FechaCertificado = convert(char(10),FechaCertificado,103),                    
  @FechaAsignacion =  convert(char(10),FechaAsignacion,103),                
  @Nivelcert = Nivel,                
  @Gradocert = Grado,                
  @Antiguedadcert = Antiguedad                   
 from dbo.CTR_Antiguedad_Certificados ac                      
 where IdContrato = @id_contrato                      
  and IdCertificado = (select max(IdCertificado) from CTR_Antiguedad_Certificados where IdContrato = @id_contrato)                      
  
 select  @desde_ct = convert(char(10),desde,103),                    
   @hasta_ct = convert(char(10),hasta,103),                
  @Nro_Documento = Nro_Documento                    
 from ctr_contratos                    
 where id_contrato = @id_contrato    
  
END  
ELSE  
BEGIN         
               
 select @id_certificado = IdCertificado,                       
  @FechaCertificado = convert(char(10),FechaCertificado,103),                    
  @FechaAsignacion =  convert(char(10),FechaAsignacion,103),                
  @Nivelcert = Nivel,                
  @Gradocert = Grado,                
  @Antiguedadcert = Antiguedad                   
 from dbo.CTR_Antiguedad_Certificados ac                      
 where IdCertificado = @id_certificado  
  
 SET @desde_ct = ''''                    
 SET @hasta_ct = ''''   
  
 select  @Nro_Documento = rc.Nro_Documento  
 from dbo.CTR_Antiguedad_Certificados ac  
  INNER JOIN dbo.CTR_Antiguedad_Reconocida_Grado rc  
   ON ac.idcalculo = rc.Id_Calculo  
 where idcertificado = @id_certificado  
  
END  
  
      
create table #tempo                      
(                      
Nro_Documento int,                      
apellido varchar(100),                        
nombre varchar(100),                       
Funcion varchar(100),                       
FechaCorte char(10),        
id_lugar int,                    
tipo char(1),                      
lugar varchar(200),                      
actividad varchar(100),                      
desde char(10),                      
hasta char(10),                      
folio char(10)                
)                      
            
                      
insert into #tempo                      
SELECT  arg.Nro_Documento,                        
 dp.apellido,                        
 dp.nombre,                         
 ac.Funcion,                        
 convert(char(10),arg.FechaCorte,103) FechaCorte,       
 sap.Id,                       
 arg.Tipo,                        
 sap.Jurisdiccion +'', ''+ sap.Organismo lugar,                        
 TFC.Descripcion  Actividad,                        
 convert(char(10),sap.Fecha_Desde,103) Desde,                              
 convert(char(10),sap.Fecha_Hasta,103) hasta,                        
 Folio                       
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                          
                        
INNER JOIN dbo.ctr_antiguedad_certificados AC                          
 ON AC.idCalculo = arg.id_calculo                          
                        
INNER JOIN dbo.datos_personales dp                     
 ON dp.nro_documento = arg.Nro_Documento                        
                        
INNER JOIN dbo.LEG_Servicios_Adm_Publica sap                        
 ON sap.id = arg.Id_Antiguedad                        
                        
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                                    
 ON TFC.Id = SAP.Cargo                           
                        
WHERE   ac.idcertificado = @id_certificado                        
 and arg.Tipo = ''E''                        
                        
                        
-- Lo comenté para que no traiga el ingreso al MDS FAML 15/10/2009                          
                      
--insert into #tempo                        
--SELECT  arg.Nro_Documento,                          
-- dp.apellido,                          
-- dp.nombre,                           
-- ac.Funcion,                          
-- convert(char(10),arg.FechaCorte,103) FechaCorte,         
-- 999999,                         
-- ''M'' Tipo,                          
-- ''Ministerio de Desarrollo Social'' lugar,                          
-- ''''  Actividad,                          
-- convert(char(10),arg.desde,103) Desde,                     
-- convert(char(10),arg.hasta,103) hasta,                          
-- ''00-000/000'' folio                  
--FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                            
--                          
--INNER JOIN dbo.ctr_antiguedad_certificados AC                            
-- ON AC.idCalculo = arg.id_calculo                            
--                          
--INNER JOIN dbo.datos_personales dp                            
-- ON dp.nro_documento = arg.Nro_Documento                          
--                          
--WHERE   ac.idcertificado = @id_certificado                          
-- and arg.Tipo = ''X''                          
                   
---Lo agregue para que traiga los contratos del MDS      
insert into #tempo                        
SELECT  arg.Nro_Documento,                          
 dp.apellido,                          
 dp.nombre,                           
 ac.Funcion,                          
 convert(char(10),arg.FechaCorte,103) FechaCorte,         
 ctr.Id_Contrato,                         
 arg.Tipo,                          
 ''Min. Desarrollo Social'' lugar,                          
 CASE ctr.tipo_contrato      
   WHEN 1 THEN ''Contrato (Nivel '' + ctrniv.Nivel + '')'' + ctrtipo.Descripcion      
   WHEN 2 THEN ''Contrato ('' + ctrfunc.Descripcion + '')'' + ctrtipo.Descripcion      
   ELSE ''Contrato MDS''      
 END        
  as Actividad,      
 convert(char(10),ctr.Desde,103) Desde,                                
 CASE ctrbajas.Fecha_Baja      
   WHEN Null THEN convert(char(10),FechaCorte,103)      
   ELSE convert(char(10),isnull(ctrbajas.Fecha_Baja, arg.FechaCorte),103)      
 END Hasta,      
 ''00-000/000''
--  ,convert(char(10),@fecha_nivel,103)    
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                            
                          
INNER JOIN dbo.ctr_antiguedad_certificados AC                            
 ON AC.idCalculo = arg.id_calculo                            
                          
INNER JOIN dbo.datos_personales dp                            
 ON dp.nro_documento = arg.Nro_Documento                          
                          
INNER JOIN dbo.CTR_Contratos CTR                          
 ON ctr.id_contrato = arg.Id_Antiguedad                          
       
left join dbo.Tabla_Funciones_Contratos ctrfunc      
  on ctrfunc.id=ctr.funcion      
left join dbo.Tabla_Niveles ctrniv      
  on ctrniv.id=ctr.nivel      
left join dbo.Tabla_Resoluciones_Contratos ctrtipo      
  on ctrtipo.id=ctr.tipo_contrato      
left join dbo.CTR_Contratos_Bajas ctrbajas      
  on ctr.nro_documento = ctrbajas.nro_documento and ctr.id_contrato = ctrbajas.id_contrato      
WHERE   ac.idcertificado = @id_certificado                          
 and arg.Tipo = ''M''      
---HASTA ACA AGREGUE FAML                               
                         
                      
                      
          
          
insert into #tempo                      
SELECT  arg.Nro_Documento,                        
 dp.apellido,                        
 dp.nombre,                         
 ac.Funcion,                        
 convert(char(10),arg.FechaCorte,103) FechaCorte,        
 ots.id,                      
 arg.Tipo,                        
 ots.Institucion lugar,                        
 TFC.Descripcion  Actividad,                        
 convert(char(10),ots.Fecha_Desde,103) Desde,                              
 convert(char(10),ots.Fecha_Hasta,103) hasta,                        
 Folio                       
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                          
                        
INNER JOIN dbo.ctr_antiguedad_certificados AC                          
 ON AC.idCalculo = arg.id_calculo                          
                        
INNER JOIN dbo.datos_personales dp                          
 ON dp.nro_documento = arg.Nro_Documento                        
                        
INNER JOIN dbo.LEG_otros_servicios ots                        
 ON ots.id = arg.Id_Antiguedad                        
                        
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                                    
 ON TFC.Id = ots.Cargo                           
                        
WHERE   ac.idcertificado = @id_certificado                        
 and arg.Tipo = ''P''                       
          
      
      
IF @marca = 0                      
BEGIN                      
 select tipo ,                      
 lugar ,                      
 actividad ,                      
 desde ,                      
 hasta ,                      
 folio                    
 from #tempo                      
END                      
                        
                      
                      
IF @marca = 1                      
BEGIN                      
                
declare @titulo varchar(100),                
 @fecha_egreso smalldatetime,                
 @nivel char(1)                
                
Select  @titulo = et.Descripcion,                 
 @fecha_egreso = er.Fecha_Egreso,                
 @nivel = ne.Cod_Gest_Pub                
                
from dbo.LEG_Estudios_Realizados er                
                
INNER JOIN dbo.Tabla_Nivel_Estudios ne              
 on ne.id = er.id_nivel                
                
INNER JOIN dbo.Tabla_Estudios_Titulos et                
 on et.id = er.id_titulo                
                
where  er.Nro_Doc = @Nro_Documento                
 and er.id_nivel = (select max(id_nivel) from dbo.LEG_Estudios_Realizados                 
   where Nro_Doc = @Nro_Documento                
   and orden <> 8)                
                
 select top 1                      
 Nro_Documento ,                      
 apellido ,                        
 nombre ,                       
 Funcion ,                       
 FechaCorte,                    
 @desde_ct desde_ct,                    
 @hasta_ct hasta_ct,                    
 @id_certificado id_certificado,                    
 @FechaCertificado FechaCertificado,                    
 @FechaAsignacion FechaAsignacion ,                
 @Nivelcert Nivelcert,                
 @Gradocert Gradocert,                
 @Antiguedadcert Antiguedadcert,                
 ltrim(rtrim(@titulo)) titulo,                
 ltrim(rtrim(@nivel)) +'' - ''+ convert(char(10),@fecha_egreso,103) niv_fecha
---  ,fecha_nivel    
 from #tempo                      
                
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Estudios_Realizados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Estudios_Realizados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE  procedure [dbo].[LEG_GET_Estudios_Realizados]
 @NroDocumento int  

AS
SELECT	E.Id,
	TEN.Descripcion Nivel,
	TET.Descripcion Titulo,
	e.Fecha_Egreso,
	E.Folio_Nro Folio
   
FROM dbo.LEG_Estudios_Realizados E  
INNER JOIN dbo.Tabla_Estudios_Niveles TEN
	ON TEN.Id = E.Id_Nivel
INNER JOIN dbo.Tabla_Estudios_Titulos TET
	ON TET.Id = E.Id_Titulo
WHERE  Nro_Doc = @NroDocumento AND
	DatodeBaja = 0 and Completo = 0
order by e.Fecha_egreso
' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_CTR_Antiguedad_Reconocida_Grado_BKP_30092011]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_CTR_Antiguedad_Reconocida_Grado_BKP_30092011]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create procedure [dbo].[RPT_CTR_Antiguedad_Reconocida_Grado_BKP_30092011]                              
  @id_contrato int = 0,                      
  @marca int,    -- 0: Trae las experiencias tomadas        
    -- 1: Trae el encabezado del certificado                           
  @id_certificado  int = null       
AS
SET NOCOUNT ON                        


--ACA FALTA LA PRIMER FECHA DE NIVEL
--DECLARE  @fecha_nivel datetime    
--create table #fecha_nivel    
--(    
-- fecha datetime    
--)    
--    
--insert into #fecha_nivel    
--exec dbo.ctr_get_primer_fecha_nivel @id_contrato    
--    
--select @fecha_nivel = fecha from #fecha_nivel   
--PRIMERFECHA DE NIVEL
                      
--TOMADAS                  
                          
DECLARE --@Id_Calculo int                     
 @desde_ct char(10),                    
 @hasta_ct char(10),                                      
 @FechaCertificado char(10),                    
 @FechaAsignacion char(10),                
 @Nivelcert char(5),                
 @Gradocert char (5),                
 @Antiguedadcert smallint,                
 @Nro_Documento    int                
       
               
IF @id_contrato > 0  
BEGIN  
 select @id_certificado = IdCertificado,                       
  @FechaCertificado = convert(char(10),FechaCertificado,103),                    
  @FechaAsignacion =  convert(char(10),FechaAsignacion,103),                
  @Nivelcert = Nivel,                
  @Gradocert = Grado,                
  @Antiguedadcert = Antiguedad                   
 from dbo.CTR_Antiguedad_Certificados ac                      
 where IdContrato = @id_contrato                      
  and IdCertificado = (select max(IdCertificado) from CTR_Antiguedad_Certificados where IdContrato = @id_contrato)                      
  
 select  @desde_ct = convert(char(10),desde,103),                    
   @hasta_ct = convert(char(10),hasta,103),                
  @Nro_Documento = Nro_Documento                    
 from ctr_contratos                    
 where id_contrato = @id_contrato    
  
END  
ELSE  
BEGIN         
               
 select @id_certificado = IdCertificado,                       
  @FechaCertificado = convert(char(10),FechaCertificado,103),                    
  @FechaAsignacion =  convert(char(10),FechaAsignacion,103),                
  @Nivelcert = Nivel,                
  @Gradocert = Grado,                
  @Antiguedadcert = Antiguedad                   
 from dbo.CTR_Antiguedad_Certificados ac                      
 where IdCertificado = @id_certificado  
  
 SET @desde_ct = ''''                    
 SET @hasta_ct = ''''   
  
 select  @Nro_Documento = rc.Nro_Documento  
 from dbo.CTR_Antiguedad_Certificados ac  
  INNER JOIN dbo.CTR_Antiguedad_Reconocida_Grado rc  
   ON ac.idcalculo = rc.Id_Calculo  
 where idcertificado = @id_certificado  
  
END  
  
      
create table #tempo                      
(                      
Nro_Documento int,                      
apellido varchar(100),                        
nombre varchar(100),                       
Funcion varchar(100),                       
FechaCorte char(10),        
id_lugar int,                    
tipo char(1),                      
lugar varchar(200),                      
actividad varchar(100),                      
desde char(10),                      
hasta char(10),                      
folio char(10)                
)                      
            
                      
insert into #tempo                      
SELECT  arg.Nro_Documento,                        
 dp.apellido,                        
 dp.nombre,                         
 ac.Funcion,                        
 convert(char(10),arg.FechaCorte,103) FechaCorte,       
 sap.Id,                       
 arg.Tipo,                        
 sap.Jurisdiccion +'', ''+ sap.Organismo lugar,                        
 TFC.Descripcion  Actividad,                        
 convert(char(10),sap.Fecha_Desde,103) Desde,                              
 convert(char(10),sap.Fecha_Hasta,103) hasta,                        
 Folio                       
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                          
                        
INNER JOIN dbo.ctr_antiguedad_certificados AC                          
 ON AC.idCalculo = arg.id_calculo                          
                        
INNER JOIN dbo.datos_personales dp                     
 ON dp.nro_documento = arg.Nro_Documento                        
                        
INNER JOIN dbo.LEG_Servicios_Adm_Publica sap                        
 ON sap.id = arg.Id_Antiguedad                        
                        
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                                    
 ON TFC.Id = SAP.Cargo                           
                        
WHERE   ac.idcertificado = @id_certificado                        
 and arg.Tipo = ''E''                        
                        
                        
-- Lo comenté para que no traiga el ingreso al MDS FAML 15/10/2009                          
                      
--insert into #tempo                        
--SELECT  arg.Nro_Documento,                          
-- dp.apellido,                          
-- dp.nombre,                           
-- ac.Funcion,                          
-- convert(char(10),arg.FechaCorte,103) FechaCorte,         
-- 999999,                         
-- ''M'' Tipo,                          
-- ''Ministerio de Desarrollo Social'' lugar,                          
-- ''''  Actividad,                          
-- convert(char(10),arg.desde,103) Desde,                     
-- convert(char(10),arg.hasta,103) hasta,                          
-- ''00-000/000'' folio                  
--FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                            
--                          
--INNER JOIN dbo.ctr_antiguedad_certificados AC                            
-- ON AC.idCalculo = arg.id_calculo                            
--                          
--INNER JOIN dbo.datos_personales dp                            
-- ON dp.nro_documento = arg.Nro_Documento                          
--                          
--WHERE   ac.idcertificado = @id_certificado                          
-- and arg.Tipo = ''X''                          
                   
---Lo agregue para que traiga los contratos del MDS      
insert into #tempo                        
SELECT  arg.Nro_Documento,                          
 dp.apellido,                          
 dp.nombre,                           
 ac.Funcion,                          
 convert(char(10),arg.FechaCorte,103) FechaCorte,         
 ctr.Id_Contrato,                         
 arg.Tipo,                          
 ''Min. Desarrollo Social'' lugar,                          
 CASE ctr.tipo_contrato      
   WHEN 1 THEN ''Contrato (Nivel '' + ctrniv.Nivel + '')'' + ctrtipo.Descripcion      
   WHEN 2 THEN ''Contrato ('' + ctrfunc.Descripcion + '')'' + ctrtipo.Descripcion      
   ELSE ''Contrato MDS''      
 END        
  as Actividad,      
 convert(char(10),ctr.Desde,103) Desde,                                
 CASE ctrbajas.Fecha_Baja      
   WHEN Null THEN convert(char(10),FechaCorte,103)      
   ELSE convert(char(10),isnull(ctrbajas.Fecha_Baja, arg.FechaCorte),103)      
 END Hasta,      
 ''00-000/000''
--  ,convert(char(10),@fecha_nivel,103)    
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                            
                          
INNER JOIN dbo.ctr_antiguedad_certificados AC                            
 ON AC.idCalculo = arg.id_calculo                            
                          
INNER JOIN dbo.datos_personales dp                            
 ON dp.nro_documento = arg.Nro_Documento                          
                          
INNER JOIN dbo.CTR_Contratos CTR                          
 ON ctr.id_contrato = arg.Id_Antiguedad                          
       
left join dbo.Tabla_Funciones_Contratos ctrfunc      
  on ctrfunc.id=ctr.funcion      
left join dbo.Tabla_Niveles ctrniv      
  on ctrniv.id=ctr.nivel      
left join dbo.Tabla_Resoluciones_Contratos ctrtipo      
  on ctrtipo.id=ctr.tipo_contrato      
left join dbo.CTR_Contratos_Bajas ctrbajas      
  on ctr.nro_documento = ctrbajas.nro_documento and ctr.id_contrato = ctrbajas.id_contrato      
WHERE   ac.idcertificado = @id_certificado                          
 and arg.Tipo = ''M''      
---HASTA ACA AGREGUE FAML                               
                         
                      
                      
          
          
insert into #tempo                      
SELECT  arg.Nro_Documento,                        
 dp.apellido,                        
 dp.nombre,                         
 ac.Funcion,                        
 convert(char(10),arg.FechaCorte,103) FechaCorte,        
 ots.id,                      
 arg.Tipo,                        
 ots.Institucion lugar,                        
 TFC.Descripcion  Actividad,                        
 convert(char(10),ots.Fecha_Desde,103) Desde,                              
 convert(char(10),ots.Fecha_Hasta,103) hasta,                        
 Folio                       
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                          
                        
INNER JOIN dbo.ctr_antiguedad_certificados AC                          
 ON AC.idCalculo = arg.id_calculo                          
                        
INNER JOIN dbo.datos_personales dp                          
 ON dp.nro_documento = arg.Nro_Documento                        
                        
INNER JOIN dbo.LEG_otros_servicios ots                        
 ON ots.id = arg.Id_Antiguedad                        
                        
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                                    
 ON TFC.Id = ots.Cargo                           
                        
WHERE   ac.idcertificado = @id_certificado                        
 and arg.Tipo = ''P''                       
          
      
      
IF @marca = 0                      
BEGIN                      
 select tipo ,                      
 lugar ,                      
 actividad ,                      
 desde ,                      
 hasta ,                      
 folio                    
 from #tempo                      
END                      
                        
                      
                      
IF @marca = 1                      
BEGIN                      
                
declare @titulo varchar(100),                
 @fecha_egreso smalldatetime,                
 @nivel char(1)                
                
Select  @titulo = et.Descripcion,                 
 @fecha_egreso = er.Fecha_Egreso,                
 @nivel = ne.Cod_Gest_Pub                
                
from dbo.LEG_Estudios_Realizados er                
                
INNER JOIN dbo.Tabla_Nivel_Estudios ne              
 on ne.id = er.id_nivel                
                
INNER JOIN dbo.Tabla_Estudios_Titulos et                
 on et.id = er.id_titulo                
                
where  er.Nro_Doc = @Nro_Documento                
 and er.id_nivel = (select max(id_nivel) from dbo.LEG_Estudios_Realizados                 
   where Nro_Doc = @Nro_Documento                
   and orden <> 8)                
                
 select top 1                      
 Nro_Documento ,                      
 apellido ,                        
 nombre ,                       
 Funcion ,                       
 FechaCorte,                    
 @desde_ct desde_ct,                    
 @hasta_ct hasta_ct,                    
 @id_certificado id_certificado,                    
 @FechaCertificado FechaCertificado,                    
 @FechaAsignacion FechaAsignacion ,                
 @Nivelcert Nivelcert,                
 @Gradocert Gradocert,                
 @Antiguedadcert Antiguedadcert,                
 ltrim(rtrim(@titulo)) titulo,                
 ltrim(rtrim(@nivel)) +'' - ''+ convert(char(10),@fecha_egreso,103) niv_fecha
---  ,fecha_nivel    
 from #tempo                      
                
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_CTR_Antiguedad_Reconocida_Grado_BKP_28092011]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_CTR_Antiguedad_Reconocida_Grado_BKP_28092011]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[RPT_CTR_Antiguedad_Reconocida_Grado_BKP_28092011]                                
  @id_contrato int,                        
  @marca int    -- 0: Trae las experiencias tomadas          
      -- 1: Trae el encabezado del certificado                             
          
AS      
SET NOCOUNT ON                          
                 
DECLARE  @fecha_nivel datetime    
create table #fecha_nivel    
(    
 fecha datetime    
)    
    
insert into #fecha_nivel    
exec dbo.ctr_get_primer_fecha_nivel @id_contrato    
    
select @fecha_nivel = fecha from #fecha_nivel    
    
    
    
           
--TOMADAS                    
                            
DECLARE --@Id_Calculo int                       
 @desde_ct char(10),                      
 @hasta_ct char(10),                      
 @id_certificado  int,                      
 @FechaCertificado char(10),                      
 @FechaAsignacion char(10),                  
 @Nivelcert char(5),                  
 @Gradocert char (5),                  
 @Antiguedadcert smallint,                  
 @Nro_Documento    int                    
                      
select @id_certificado = IdCertificado,                         
 @FechaCertificado = convert(char(10),FechaCertificado,103),                      
 @FechaAsignacion =  convert(char(10),FechaAsignacion,103),                  
 @Nivelcert = Nivel,                  
 @Gradocert = Grado,                  
 @Antiguedadcert = Antiguedad                  
from dbo.CTR_Antiguedad_Certificados ac                        
where IdContrato = @id_contrato                        
 and IdCertificado = (select max(IdCertificado) from CTR_Antiguedad_Certificados where IdContrato = @id_contrato)                        
                        
                      
select  @desde_ct = convert(char(10),desde,103),                      
  @hasta_ct = convert(char(10),hasta,103),                  
 @Nro_Documento = Nro_Documento                      
from ctr_contratos                      
where id_contrato = @id_contrato                      
                      
        
create table #tempo                        
(                        
Nro_Documento int,                        
apellido varchar(100),                          
nombre varchar(100),                         
Funcion varchar(100),                         
FechaCorte char(10),          
id_lugar int,                      
tipo char(1),                        
lugar varchar(200),                        
actividad varchar(100),                        
desde char(10),                        
hasta char(10),                        
folio char(10),    
fecha_nivel char(10)    
)                        
              
                        
insert into #tempo                        
SELECT  arg.Nro_Documento,                          
 dp.apellido,                          
 dp.nombre,                           
 ac.Funcion,                          
 convert(char(10),arg.FechaCorte,103) FechaCorte,         
 sap.Id,                         
 arg.Tipo,                          
 sap.Jurisdiccion +'', ''+ sap.Organismo lugar,                          
 TFC.Descripcion  Actividad,                          
 convert(char(10),sap.Fecha_Desde,103) Desde,                                
 convert(char(10),isnull(sap.Fecha_Hasta, FechaCorte),103) hasta,                          
 Folio,    
 convert(char(10),@fecha_nivel,103)    
     
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                            
                          
INNER JOIN dbo.ctr_antiguedad_certificados AC                            
 ON AC.idCalculo = arg.id_calculo                            
                          
INNER JOIN dbo.datos_personales dp                            
 ON dp.nro_documento = arg.Nro_Documento                          
                          
INNER JOIN dbo.LEG_Servicios_Adm_Publica sap                          
 ON sap.id = arg.Id_Antiguedad                          
                          
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                    
 ON TFC.Id = SAP.Cargo                             
                          
WHERE   ac.idcertificado = @id_certificado                          
 and arg.Tipo = ''E''         
                          
                          
-- Lo comenté para que no traiga el ingreso al MDS FAML 15/10/2009                          
                      
--insert into #tempo                        
--SELECT  arg.Nro_Documento,                          
-- dp.apellido,                          
-- dp.nombre,                           
-- ac.Funcion,                          
-- convert(char(10),arg.FechaCorte,103) FechaCorte,         
-- 999999,                         
-- ''M'' Tipo,                          
-- ''Ministerio de Desarrollo Social'' lugar,                          
-- ''''  Actividad,                          
-- convert(char(10),arg.desde,103) Desde,                     
-- convert(char(10),arg.hasta,103) hasta,                          
-- ''00-000/000'' folio                  
--FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                            
--                          
--INNER JOIN dbo.ctr_antiguedad_certificados AC                            
-- ON AC.idCalculo = arg.id_calculo                            
--                          
--INNER JOIN dbo.datos_personales dp                            
-- ON dp.nro_documento = arg.Nro_Documento                          
--                          
--WHERE   ac.idcertificado = @id_certificado                          
-- and arg.Tipo = ''X''                          
                   
---Lo agregue para que traiga los contratos del MDS      
insert into #tempo                        
SELECT  arg.Nro_Documento,                          
 dp.apellido,                          
 dp.nombre,                           
 ac.Funcion,                          
 convert(char(10),arg.FechaCorte,103) FechaCorte,         
 ctr.Id_Contrato,                         
 arg.Tipo,                          
 ''Min. Desarrollo Social'' lugar,                          
 CASE ctr.tipo_contrato      
   WHEN 1 THEN ''Contrato (Nivel '' + ctrniv.Nivel + '')'' + ctrtipo.Descripcion      
   WHEN 2 THEN ''Contrato ('' + ctrfunc.Descripcion + '')'' + ctrtipo.Descripcion      
   ELSE ''Contrato MDS''      
 END        
  as Actividad,      
 convert(char(10),ctr.Desde,103) Desde,                                
 CASE ctrbajas.Fecha_Baja      
   WHEN Null THEN convert(char(10),FechaCorte,103)      
   ELSE convert(char(10),isnull(ctrbajas.Fecha_Baja, arg.FechaCorte),103)      
 END Hasta,      
 ''00-000/000'',    
 convert(char(10),@fecha_nivel,103)    
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                            
                          
INNER JOIN dbo.ctr_antiguedad_certificados AC                            
 ON AC.idCalculo = arg.id_calculo                            
                          
INNER JOIN dbo.datos_personales dp                            
 ON dp.nro_documento = arg.Nro_Documento                          
                          
INNER JOIN dbo.CTR_Contratos CTR                          
 ON ctr.id_contrato = arg.Id_Antiguedad                          
       
left join dbo.Tabla_Funciones_Contratos ctrfunc      
  on ctrfunc.id=ctr.funcion      
left join dbo.Tabla_Niveles ctrniv      
  on ctrniv.id=ctr.nivel      
left join dbo.Tabla_Resoluciones_Contratos ctrtipo      
  on ctrtipo.id=ctr.tipo_contrato      
left join dbo.CTR_Contratos_Bajas ctrbajas      
  on ctr.nro_documento = ctrbajas.nro_documento and ctr.id_contrato = ctrbajas.id_contrato      
WHERE   ac.idcertificado = @id_certificado                          
 and arg.Tipo = ''M''      
---HASTA ACA AGREGUE FAML                               
            
            
insert into #tempo                        
SELECT  arg.Nro_Documento,                          
 dp.apellido,                          
 dp.nombre,                           
 ac.Funcion,                          
 convert(char(10),arg.FechaCorte,103) FechaCorte,          
 ots.id,                        
 arg.Tipo,                          
 ots.Institucion lugar,                          
 TFC.Descripcion  Actividad,                          
 convert(char(10),ots.Fecha_Desde,103) Desde,                                
 convert(char(10),ots.Fecha_Hasta,103) hasta,                          
 Folio ,    
convert(char(10),@fecha_nivel,103)    
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                  
                          
INNER JOIN dbo.ctr_antiguedad_certificados AC                            
 ON AC.idCalculo = arg.id_calculo                            
                          
INNER JOIN dbo.datos_personales dp                            
 ON dp.nro_documento = arg.Nro_Documento                          
                          
INNER JOIN dbo.LEG_otros_servicios ots                          
 ON ots.id = arg.Id_Antiguedad                          
                          
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                                      
 ON TFC.Id = ots.Cargo                             
                          
WHERE   ac.idcertificado = @id_certificado                          
 and arg.Tipo = ''P''                         
            
        
        
IF @marca = 0                        
BEGIN                        
 select tipo ,                        
 lugar ,                        
 actividad ,                        
 desde ,                        
 hasta ,                        
 folio                      
 from #tempo                        
END                        
                          
                        
                        
IF @marca = 1                        
BEGIN                        
                  
declare @titulo varchar(100),                  
 @fecha_egreso smalldatetime,                  
 @nivel char(1)    
    
                 
Select  @titulo = et.Descripcion,                   
 @fecha_egreso = er.Fecha_Egreso,                  
 @nivel = ne.Cod_Gest_Pub                  
                  
from dbo.LEG_Estudios_Realizados er                  
                  
INNER JOIN dbo.Tabla_Nivel_Estudios ne                  
 on ne.id = er.id_nivel                  
                  
INNER JOIN dbo.Tabla_Estudios_Titulos et                  
 on et.id = er.id_titulo                  
                  
where  er.Nro_Doc = @Nro_Documento                  
 and er.id_nivel = (select max(id_nivel) from dbo.LEG_Estudios_Realizados                   
   where Nro_Doc = @Nro_Documento                  
   and orden <> 8)                  
                  
 select top 1                        
 Nro_Documento ,                        
 apellido ,                          
 nombre ,                         
 Funcion ,                         
 FechaCorte,                      
 @desde_ct desde_ct,                      
 @hasta_ct hasta_ct,                      
 @id_certificado id_certificado,                      
 @FechaCertificado FechaCertificado,                      
 @FechaAsignacion FechaAsignacion ,                  
 @Nivelcert Nivelcert,                  
 @Gradocert Gradocert,                  
 @Antiguedadcert Antiguedadcert,                  
 ltrim(rtrim(@titulo)) titulo,                  
 ltrim(rtrim(@nivel)) +'' - ''+ convert(char(10),@fecha_egreso,103) niv_fecha,    
 fecha_nivel    
 from #tempo                        
                  
END ' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Estudios_Realizados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Estudios_Realizados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_UPD_Estudios_Realizados]  
 @Id_Nivel smallint,  
 @Id_Universidad int,  
 @Id_Facultad int,  
 @Id_Institucion int,  
 @Id_Titulo int,  
 @Id_Especialidad int,  
 @Fecha_Ingreso datetime,  
 @Fecha_Egreso datetime,  
 @Depende_de varchar(50),  
 @Certificado_Expedido_por varchar(50),  
 @Matricula_Nro varchar(50),  
 @Folio_Nro char(10),  
 @Id_Interna int,  
 @Nro_Doc int,  
 @Cant_Materias_Totales smallint,  
 @Cant_Materias_Aprob smallint,  
 @Completo bit,  
 @DatoDeBaja bit,  
 @DatoNoImprime bit,  
 @SinCertificado bit,
 @Usuario smallint,  
 @IdEstudio int  
  
AS  
  
  
  
UPDATE dbo.[LEG_Estudios_Realizados]  
SET [Id_Nivel]=@Id_Nivel,  
 [Id_Universidad]= @Id_Universidad,  
 [Id_Facultad]= @Id_Facultad,  
 [Id_Institucion]= @Id_Institucion,  
 [Id_Titulo]= @Id_Titulo,  
 [Id_Especialidad]= @Id_Especialidad,  
 [Fecha_Ingreso]=@Fecha_Ingreso,  
 [Fecha_Egreso]=@Fecha_Egreso,  
 [Depende_de]=@Depende_de,  
 [Certificado_Expedido_por]= @Certificado_Expedido_por,  
 [Matricula_Nro]= @Matricula_Nro,  
 [Folio_Nro]=@Folio_Nro,  
 [Id_Interna]=@Id_Interna,  
 [Nro_Doc]=@Nro_Doc,  
 [Cant_Materias_Totales]=@Cant_Materias_Totales,  
 [Cant_Materias_Aprob]=@Cant_Materias_Aprob,  
 [Completo]=@Completo,  
 [DatoDeBaja]=@DatoDeBaja,  
 [DatoNoImprime]=@DatoNoImprime,  
 SinCertificado = @SinCertificado,
 [Usuario]=@Usuario,  
 [FechaProceso]=getdate()  
WHERE Id = @IdEstudio  
  
  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_CTR_Antiguedad_Grado_BKP_30092011]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_CTR_Antiguedad_Grado_BKP_30092011]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create procedure [dbo].[RPT_CTR_Antiguedad_Grado_BKP_30092011]                          
  @Nro_Documento int,                          
  @id_contrato int = 0,  
  @Id_Certificado int = null  
as
--NO TOMADAS        
        
SET NOCOUNT ON                      
            
DECLARE @FechaCorte smalldatetime        
           
IF @id_contrato > 0   
BEGIN  
  
 select  @FechaCorte = FechaCorte,        
   @Id_Certificado = IdCertificado        
 from dbo.CTR_Antiguedad_Certificados ac            
 INNER JOIN dbo.CTR_Antiguedad_Reconocida_Grado ar            
  ON ar.id_calculo = ac.IdCalculo             
 where IdContrato = @id_contrato            
  and IdCertificado = (select max(IdCertificado) from CTR_Antiguedad_Certificados where IdContrato = @id_contrato and impreso=1)            
  
END  
ELSE  
BEGIN  
  
 select  @FechaCorte = FechaCorte,        
   @Id_Certificado = IdCertificado        
 from dbo.CTR_Antiguedad_Certificados ac            
 INNER JOIN dbo.CTR_Antiguedad_Reconocida_Grado ar            
  ON ar.id_calculo = ac.IdCalculo             
  and IdCertificado = @Id_Certificado  
  
END  
            
      
create table #tempo            
(          
id_contrato int,        
id int,            
tipo char(1),            
lugar varchar(200),            
actividad varchar(100),            
fecha_desde smalldatetime,            
fecha_hasta smalldatetime,            
folio char(10),        
fecha_carga smalldatetime,        
Marca char(1)            
)            
            
                          
-- SERVICIOS ADM PUBLICA            
INSERT INTO #tempo                      
select distinct          
 @id_contrato id_contrato,         
 sap.id,                          
 ''E'' Tipo,              
 Jurisdiccion +'', ''+ Organismo lugar,              
 TFC.Descripcion  Actividad,              
 fecha_desde ,                 
 fecha_hasta ,                      
 folio ,        
 Fecha_Carga,        
 ''''        
FROM dbo.LEG_Servicios_Adm_Publica SAP  
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                          
 ON TFC.Id = SAP.Cargo                          
WHERE  SAP.Doc_Titular = @Nro_Documento AND                          
 DatoDeBaja = 0                           
                        
          
--UNION -- OTROS SERVICIOS                          
              
INSERT INTO #tempo                                  
select distinct         
 @id_contrato id_contrato,                         
 ots.id,          
 ''P'' Tipo,                    
 Institucion lugar,              
 TFC.Descripcion Actividad,              
 fecha_desde ,                 
 fecha_hasta ,                           
 Folio,        
 '''',        
 ''''                    
FROM dbo.LEG_otros_servicios OTS                          
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                          
   ON TFC.Id = OTS.Cargo                          
WHERE OTS.Documento =  @Nro_Documento  AND                           
   DatoDeBaja = 0                           
                      
--UNION                       
              
INSERT INTO #tempo                                  
SELECT            
 @id_contrato id_contrato,         
 999999,          
 ''M'' Tipo,                 
 ''Ministerio de Desarrollo Social'' lugar,                                   
 '''' actividad,              
 fecha_min fecha_desde ,                 
 @FechaCorte fecha_hasta ,                             
 ''00-000/000'' folio ,        
 '''',        
 ''''             
FROM dbo.Designaciones_fechas df                          
WHERE Nro_Doc  = @Nro_Documento                      
ORDER BY fecha_desde   --GER: 01/11/2007                        
                     
              
declare @fecha_min datetime                                  
set @fecha_min = (select fecha_min from dbo.designaciones_fechas where Nro_Doc = @Nro_Documento)                          
                          
                      
 -- ELIMINA REGISTROS POSTERIORES A LA FECHA DE INGRESO AL MINISTERIO --                                   
 update #tempo            
 set fecha_hasta =  @fecha_min - 1            
 where fecha_hasta > @fecha_min and tipo <> ''M''                        
              
 DELETE T                      
 FROM #tempo T                      
 WHERE Fecha_Desde >= @Fecha_Min and tipo <> ''M''                    
            
--  update #servicios                          
--  set fecha_hasta =  @fecha_min - 1            
--  where fecha_hasta > @fecha_min and tipo <> ''M''                             
--  DELETE T                      
--  FROM #Servicios T                      
--  WHERE Fecha_Desde >= @Fecha_Min and tipo <> ''M''                        
  
      
update t        
set marca =  case         
   when convert(char(10),t.fecha_carga,112) > convert(char(10),cac.FechaAsignacion,112) then ''X''        
  else         
   ''''        
  end         
FROM #tempo t         
        
INNER JOIN CTR_Antiguedad_Certificados cac        
   ON t.Id_Contrato = cac.IdContrato        
        
where cac.idcertificado = @Id_Certificado        
 and cac.IdContrato = @id_contrato        
        
      
----------------------------------------------------------------------------------------------    
--ESTAS SON LAS TOMADAS. SE COPIO EL SP "RPT_CTR_Antiguedad_Reconocida_Grado" Y SE PEGO ACA    
----------------------------------------------------------------------------------------------    
    
DECLARE --@Id_Calculo int                     
 @desde_ct char(10),                    
 @hasta_ct char(10),                                      
 @FechaCertificado char(10),                    
 @FechaAsignacion char(10),                
 @Nivelcert char(5),                
 @Gradocert char (5),                
 @Antiguedadcert smallint ,                
-- @Nro_Documento    int                
 @marca int  
  
               
IF @id_contrato > 0  
BEGIN  
 select @id_certificado = IdCertificado,                       
  @FechaCertificado = convert(char(10),FechaCertificado,103),                    
  @FechaAsignacion =  convert(char(10),FechaAsignacion,103),                
  @Nivelcert = Nivel,                
  @Gradocert = Grado,                
  @Antiguedadcert = Antiguedad                   
 from dbo.CTR_Antiguedad_Certificados ac                      
 where IdContrato = @id_contrato                      
  and IdCertificado = (select max(IdCertificado) from CTR_Antiguedad_Certificados where IdContrato = @id_contrato)                      
  
 select  @desde_ct = convert(char(10),desde,103),                    
   @hasta_ct = convert(char(10),hasta,103),                
  @Nro_Documento = Nro_Documento                    
 from ctr_contratos                    
 where id_contrato = @id_contrato    
  
END  
ELSE  
BEGIN         
               
 select @id_certificado = IdCertificado,                       
  @FechaCertificado = convert(char(10),FechaCertificado,103),                    
  @FechaAsignacion =  convert(char(10),FechaAsignacion,103),                
  @Nivelcert = Nivel,                
  @Gradocert = Grado,                
  @Antiguedadcert = Antiguedad                   
 from dbo.CTR_Antiguedad_Certificados ac                      
 where IdCertificado = @id_certificado  
  
 SET @desde_ct = ''''                    
 SET @hasta_ct = ''''   
  
 select  @Nro_Documento = rc.Nro_Documento  
 from dbo.CTR_Antiguedad_Certificados ac  
  INNER JOIN dbo.CTR_Antiguedad_Reconocida_Grado rc  
   ON ac.idcalculo = rc.Id_Calculo  
 where idcertificado = @id_certificado  
  
END  
  
      
create table #tempo2  
(                      
Nro_Documento int,                      
apellido varchar(100),                        
nombre varchar(100),                       
Funcion varchar(100),                       
FechaCorte char(10),        
id_lugar int,                    
tipo char(1),                      
lugar varchar(200),                      
actividad varchar(100),                      
desde char(10),                      
hasta char(10),                      
folio char(10)                
)                      
            
                      
insert into #tempo2         
SELECT  arg.Nro_Documento,                        
 dp.apellido,                        
 dp.nombre,                         
 ac.Funcion,                        
 convert(char(10),arg.FechaCorte,103) FechaCorte,       
 sap.Id,                       
 arg.Tipo,                        
 sap.Jurisdiccion +'', ''+ sap.Organismo lugar,                        
 TFC.Descripcion  Actividad,                        
 convert(char(10),sap.Fecha_Desde,103) Desde,                              
 convert(char(10),sap.Fecha_Hasta,103) hasta,                        
 Folio                       
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                          
                        
INNER JOIN dbo.ctr_antiguedad_certificados AC                          
 ON AC.idCalculo = arg.id_calculo                          
                        
INNER JOIN dbo.datos_personales dp                          
 ON dp.nro_documento = arg.Nro_Documento                        
                        
INNER JOIN dbo.LEG_Servicios_Adm_Publica sap                        
 ON sap.id = arg.Id_Antiguedad                        
                        
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                                    
 ON TFC.Id = SAP.Cargo                           
                        
WHERE   ac.idcertificado = @id_certificado                        
 and arg.Tipo = ''E''                        
                        
                        
                        
insert into #tempo2                      
SELECT  arg.Nro_Documento,                        
 dp.apellido,                        
 dp.nombre,                         
 ac.Funcion,                        
 convert(char(10),arg.FechaCorte,103) FechaCorte,       
 999999,                       
 ''M'' Tipo,                        
 ''Ministerio de Desarrollo Social'' lugar,                        
 ''''  Actividad,                        
 convert(char(10),arg.desde,103) Desde,                   
 convert(char(10),arg.hasta,103) hasta,                        
 ''00-000/000'' folio                
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                          
                        
INNER JOIN dbo.ctr_antiguedad_certificados AC                          
 ON AC.idCalculo = arg.id_calculo                          
                        
INNER JOIN dbo.datos_personales dp                          
 ON dp.nro_documento = arg.Nro_Documento                        
                        
WHERE   ac.idcertificado = @id_certificado                        
 and arg.Tipo = ''X''                        
                      
                      
          
          
insert into #tempo2                      
SELECT  arg.Nro_Documento,                        
 dp.apellido,                        
 dp.nombre,                         
 ac.Funcion,                        
 convert(char(10),arg.FechaCorte,103) FechaCorte,        
 ots.id,                      
 arg.Tipo,                        
 ots.Institucion lugar,                        
 TFC.Descripcion  Actividad,                        
 convert(char(10),ots.Fecha_Desde,103) Desde,                              
 convert(char(10),ots.Fecha_Hasta,103) hasta,                        
 Folio                       
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                          
                        
INNER JOIN dbo.ctr_antiguedad_certificados AC                          
 ON AC.idCalculo = arg.id_calculo                          
                        
INNER JOIN dbo.datos_personales dp                          
 ON dp.nro_documento = arg.Nro_Documento                        
                        
INNER JOIN dbo.LEG_otros_servicios ots                        
 ON ots.id = arg.Id_Antiguedad                        
                        
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                                    
 ON TFC.Id = ots.Cargo                           
                        
WHERE   ac.idcertificado = @id_certificado                        
 and arg.Tipo = ''P''                       
        
      
      
IF @marca = 0                      
BEGIN                      
 select tipo ,                      
 lugar ,                      
 actividad ,                      
 desde ,                      
 hasta ,                      
 folio                    
 from #tempo2                      
END                      
                        
                      
                      
IF @marca = 1                      
BEGIN                      
                
declare @titulo varchar(100),                
 @fecha_egreso smalldatetime,                
 @nivel char(1)                
                
Select  @titulo = et.Descripcion,                 
 @fecha_egreso = er.Fecha_Egreso,                
 @nivel = ne.Cod_Gest_Pub                
                
from dbo.LEG_Estudios_Realizados er                
                
INNER JOIN dbo.Tabla_Nivel_Estudios ne                
 on ne.id = er.id_nivel                
                
INNER JOIN dbo.Tabla_Estudios_Titulos et                
 on et.id = er.id_titulo                
                
where  er.Nro_Doc = @Nro_Documento                
 and er.id_nivel = (select max(id_nivel) from dbo.LEG_Estudios_Realizados                 
   where Nro_Doc = @Nro_Documento                
   and orden <> 8)                
                
 select top 1                      
 Nro_Documento ,                      
 apellido ,                        
 nombre ,                       
 Funcion ,                       
 FechaCorte,                    
 @desde_ct desde_ct,                    
 @hasta_ct hasta_ct,                    
 @id_certificado id_certificado,                    
 @FechaCertificado FechaCertificado,                    
 @FechaAsignacion FechaAsignacion ,                
 @Nivelcert Nivelcert,                
 @Gradocert Gradocert,                
 @Antiguedadcert Antiguedadcert,                
 ltrim(rtrim(@titulo)) titulo,                
 ltrim(rtrim(@nivel)) +'' - ''+ convert(char(10),@fecha_egreso,103) niv_fecha                
 from #tempo2                      
                
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_CTR_Antiguedad_Reconocida_Grado_GER]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_CTR_Antiguedad_Reconocida_Grado_GER]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[RPT_CTR_Antiguedad_Reconocida_Grado_GER]
  @id_contrato int = 0,                        
  @marca int,    -- 0: Trae las experiencias tomadas          
    -- 1: Trae el encabezado del certificado                             
  @id_certificado  int = null         
AS  
SET NOCOUNT ON                          
  
  
--ACA FALTA LA PRIMER FECHA DE NIVEL  
--DECLARE  @fecha_nivel datetime      
--create table #fecha_nivel      
--(      
-- fecha datetime      
--)      
--      
--insert into #fecha_nivel      
--exec dbo.ctr_get_primer_fecha_nivel @id_contrato      
--      
--select @fecha_nivel = fecha from #fecha_nivel     
--PRIMERFECHA DE NIVEL  
                        
--TOMADAS                    
                            
DECLARE --@Id_Calculo int                       
 @desde_ct char(10),                      
 @hasta_ct char(10),                                        
 @FechaCertificado char(10),                      
 @FechaAsignacion char(10),                  
 @Nivelcert char(5),                  
 @Gradocert char (5),                  
 @Antiguedadcert smallint,                  
 @Nro_Documento    int                  
         
                 
IF @id_contrato > 0    
BEGIN    
 select @id_certificado = IdCertificado,                         
  @FechaCertificado = convert(char(10),FechaCertificado,103),                      
  @FechaAsignacion =  convert(char(10),FechaAsignacion,103),                  
  @Nivelcert = Nivel,                  
  @Gradocert = Grado,                  
  @Antiguedadcert = Antiguedad                     
 from dbo.CTR_Antiguedad_Certificados ac                        
 where IdContrato = @id_contrato                        
  and IdCertificado = (select max(IdCertificado) from CTR_Antiguedad_Certificados where IdContrato = @id_contrato)                        
    
 select  @desde_ct = convert(char(10),desde,103),                      
   @hasta_ct = convert(char(10),hasta,103),                  
  @Nro_Documento = Nro_Documento                      
 from ctr_contratos                      
 where id_contrato = @id_contrato      
    
END    
ELSE    
BEGIN           
                 
 select @id_certificado = IdCertificado,                         
  @FechaCertificado = convert(char(10),FechaCertificado,103),                      
  @FechaAsignacion =  convert(char(10),FechaAsignacion,103),                  
  @Nivelcert = Nivel,                  
  @Gradocert = Grado,                  
  @Antiguedadcert = Antiguedad                     
 from dbo.CTR_Antiguedad_Certificados ac                        
 where IdCertificado = @id_certificado    
    
 SET @desde_ct = ''''                      
 SET @hasta_ct = ''''     
    
 select  @Nro_Documento = rc.Nro_Documento    
 from dbo.CTR_Antiguedad_Certificados ac    
  INNER JOIN dbo.CTR_Antiguedad_Reconocida_Grado rc    
   ON ac.idcalculo = rc.Id_Calculo    
 where idcertificado = @id_certificado    
    
END    
    
        
create table #tempo                        
(                        
Nro_Documento int,                        
apellido varchar(100),                          
nombre varchar(100),                         
Funcion varchar(100),                         
FechaCorte char(10),          
id_lugar int,                      
tipo char(1),                        
lugar varchar(200),                        
actividad varchar(100),                        
desde char(10),                        
hasta char(10),                        
folio char(10)                  
)                        
              
                        
insert into #tempo                        
SELECT  arg.Nro_Documento,                          
 dp.apellido,                          
 dp.nombre,                           
 ac.Funcion,                          
 convert(char(10),arg.FechaCorte,103) FechaCorte,         
 sap.Id,                         
 arg.Tipo,                          
 sap.Jurisdiccion +'', ''+ sap.Organismo lugar,                          
 TFC.Descripcion  Actividad,                          
 convert(char(10),sap.Fecha_Desde,103) Desde,                                
 convert(char(10),sap.Fecha_Hasta,103) hasta,                          
 Folio                         
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                            
                          
INNER JOIN dbo.ctr_antiguedad_certificados AC                            
 ON AC.idCalculo = arg.id_calculo                            
                          
INNER JOIN dbo.datos_personales dp                       
 ON dp.nro_documento = arg.Nro_Documento                          
                          
INNER JOIN dbo.LEG_Servicios_Adm_Publica sap                          
 ON sap.id = arg.Id_Antiguedad                          
                          
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                                      
 ON TFC.Id = SAP.Cargo                             
                          
WHERE   ac.idcertificado = @id_certificado                          
 and arg.Tipo = ''E''                          
                          
                          
-- Lo comenté para que no traiga el ingreso al MDS FAML 15/10/2009                            
                        
--insert into #tempo                          
--SELECT  arg.Nro_Documento,                            
-- dp.apellido,                            
-- dp.nombre,                             
-- ac.Funcion,                            
-- convert(char(10),arg.FechaCorte,103) FechaCorte,           
-- 999999,                           
-- ''M'' Tipo,                            
-- ''Ministerio de Desarrollo Social'' lugar,                            
-- ''''  Actividad,                            
-- convert(char(10),arg.desde,103) Desde,                       
-- convert(char(10),arg.hasta,103) hasta,                            
-- ''00-000/000'' folio                    
--FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                              
--                            
--INNER JOIN dbo.ctr_antiguedad_certificados AC                              
-- ON AC.idCalculo = arg.id_calculo                              
--                            
--INNER JOIN dbo.datos_personales dp                              
-- ON dp.nro_documento = arg.Nro_Documento                            
--                            
--WHERE   ac.idcertificado = @id_certificado                            
-- and arg.Tipo = ''X''                            
                     
---Lo agregue para que traiga los contratos del MDS        
insert into #tempo                          
SELECT  arg.Nro_Documento,                            
 dp.apellido,                            
 dp.nombre,                             
 ac.Funcion,                            
 convert(char(10),arg.FechaCorte,103) FechaCorte,           
 ctr.Id_Contrato,                           
 arg.Tipo,                            
 ''Min. Desarrollo Social'' lugar,                            
 CASE ctr.tipo_contrato        
   WHEN 1 THEN ''Contrato (Nivel '' + ctrniv.Nivel + '')'' + ctrtipo.Descripcion        
   WHEN 2 THEN ''Contrato ('' + ctrfunc.Descripcion + '')'' + ctrtipo.Descripcion        
   ELSE ''Contrato MDS''        
 END          
  as Actividad,        
 convert(char(10),ctr.Desde,103) Desde,                                  
 CASE ctrbajas.Fecha_Baja        
   WHEN Null THEN convert(char(10),FechaCorte,103)        
   ELSE convert(char(10),isnull(ctrbajas.Fecha_Baja, arg.FechaCorte),103)        
 END Hasta,        
 ''00-000/000''  
--  ,convert(char(10),@fecha_nivel,103)      
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                              
                            
INNER JOIN dbo.ctr_antiguedad_certificados AC                              
 ON AC.idCalculo = arg.id_calculo                              
                            
INNER JOIN dbo.datos_personales dp                              
 ON dp.nro_documento = arg.Nro_Documento                            
                            
INNER JOIN dbo.CTR_Contratos CTR                
 ON ctr.id_contrato = arg.Id_Antiguedad                            
         
left join dbo.Tabla_Funciones_Contratos ctrfunc        
  on ctrfunc.id=ctr.funcion        
left join dbo.Tabla_Niveles ctrniv        
  on ctrniv.id=ctr.nivel        
left join dbo.Tabla_Resoluciones_Contratos ctrtipo        
  on ctrtipo.id=ctr.tipo_contrato        
left join dbo.CTR_Contratos_Bajas ctrbajas        
  on ctr.nro_documento = ctrbajas.nro_documento and ctr.id_contrato = ctrbajas.id_contrato        
WHERE   ac.idcertificado = @id_certificado                            
 and arg.Tipo = ''M''        
---HASTA ACA AGREGUE FAML                                 
                           
                        
                        
            
            
insert into #tempo                        
SELECT  arg.Nro_Documento,                          
 dp.apellido,                          
 dp.nombre,                           
 ac.Funcion,                          
 convert(char(10),arg.FechaCorte,103) FechaCorte,          
 ots.id,                        
 arg.Tipo,                          
 ots.Institucion lugar,                          
 TFC.Descripcion  Actividad,                          
 convert(char(10),ots.Fecha_Desde,103) Desde,                                
 convert(char(10),ots.Fecha_Hasta,103) hasta,                          
 Folio                         
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                            
                          
INNER JOIN dbo.ctr_antiguedad_certificados AC                            
 ON AC.idCalculo = arg.id_calculo                            
                          
INNER JOIN dbo.datos_personales dp                            
 ON dp.nro_documento = arg.Nro_Documento                          
                          
INNER JOIN dbo.LEG_otros_servicios ots                          
 ON ots.id = arg.Id_Antiguedad                          
                          
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                                      
 ON TFC.Id = ots.Cargo                             
                          
WHERE   ac.idcertificado = @id_certificado                          
 and arg.Tipo = ''P''                         
            
        
        
IF @marca = 0                        
BEGIN                        
 select tipo ,                        
 lugar ,                        
 actividad ,                        
 desde ,                        
 hasta ,                        
 folio                      
 from #tempo                        
END                        
                          
                        
                        
IF @marca = 1                        
BEGIN                        
                  
declare @titulo varchar(100),                  
 @fecha_egreso smalldatetime,                  
 @nivel char(1)                  
                  
Select  @titulo = et.Descripcion,                   
 @fecha_egreso = er.Fecha_Egreso,                  
 @nivel = ne.Cod_Gest_Pub                  
                  
from dbo.LEG_Estudios_Realizados er                  
                  
INNER JOIN dbo.Tabla_Nivel_Estudios ne                
 on ne.id = er.id_nivel                  
                  
INNER JOIN dbo.Tabla_Estudios_Titulos et                  
 on et.id = er.id_titulo                  
                  
where  er.Nro_Doc = @Nro_Documento                  
 and er.id_nivel = (select max(id_nivel) from dbo.LEG_Estudios_Realizados                   
   where Nro_Doc = @Nro_Documento                  
   and orden <> 8)                  
                  
 select top 1                        
 Nro_Documento ,                        
 apellido ,                          
 nombre ,                         
 Funcion ,                         
 FechaCorte,                      
 @desde_ct desde_ct,                      
 @hasta_ct hasta_ct,                      
 @id_certificado id_certificado,                      
 @FechaCertificado FechaCertificado,                      
 @FechaAsignacion FechaAsignacion ,                  
 @Nivelcert Nivelcert,                  
 @Gradocert Gradocert,                  
 @Antiguedadcert Antiguedadcert,                  
 ltrim(rtrim(@titulo)) titulo,                  
 ltrim(rtrim(@nivel)) +'' - ''+ convert(char(10),@fecha_egreso,103) niv_fecha  
---  ,fecha_nivel      
 from #tempo                        
                  
END  ' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Estudios_Realizados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Estudios_Realizados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_ADD_Estudios_Realizados]  
 @Id_Nivel smallint,  
 @Id_Universidad int,  
 @Id_Facultad int,  
 @Id_Institucion int,  
 @Id_Titulo int,  
 @Id_Especialidad int,  
 @Fecha_Ingreso datetime,  
 @Fecha_Egreso datetime,  
 @Depende_de varchar(50),  
 @Certificado_Expedido_por varchar(50),  
 @Matricula_Nro varchar(50),  
 @Folio_Nro char(10),  
 @Id_Interna int,  
 @Nro_Doc int,  
 @Cant_Materias_Totales smallint,  
 @Cant_Materias_Aprob smallint,  
 @Completo bit,  
 @DatoDeBaja bit,
 @SinCertificado bit,	  
 @DatoNoImprime bit,  
 @Usuario smallint  
  
AS  
INSERT INTO dbo.[LEG_Estudios_Realizados]  
 ([Id_Nivel],   
 [Id_Universidad],   
 [Id_Facultad],   
 [Id_Institucion],   
 [Id_Titulo],   
 [Id_Especialidad],   
 [Fecha_Ingreso],   
 [Fecha_Egreso],   
 [Depende_de],   
 [Certificado_Expedido_por],   
 [Matricula_Nro],   
 [Folio_Nro],   
 [Id_Interna],   
 [Nro_Doc],   
 [Cant_Materias_Totales],   
 [Cant_Materias_Aprob],   
 [Completo],   
 [DatoDeBaja],   
 [DatoNoImprime],   
  SinCertificado,
 [Usuario],   
 [FechaProceso])  
VALUES( @Id_Nivel,  
 @Id_Universidad,  
 @Id_Facultad,  
 @Id_Institucion,  
 @Id_Titulo,  
 @Id_Especialidad,  
 @Fecha_Ingreso,  
 @Fecha_Egreso,  
 @Depende_de,  
 @Certificado_Expedido_por,  
 @Matricula_Nro,  
 @Folio_Nro,  
 @Id_Interna,  
 @Nro_Doc,  
 @Cant_Materias_Totales,  
 @Cant_Materias_Aprob,  
 @Completo,  
 @DatoDeBaja,  
 @DatoNoImprime,  
 @SinCertificado,
 @Usuario,  
 getdate())  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Consulta_Bajas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Consulta_Bajas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[CTR_GET_Consulta_Bajas]
	@Documento int=null,
	@contrato int=null,
	@area int=null,
	@desde smalldatetime=null,
	@hasta smalldatetime=null
AS
/*
declare	@Documento int
declare	@contrato int
declare	@area int
declare	@desde smalldatetime
declare	@hasta smalldatetime
set	@Documento=null
set	@contrato =NULL
set	@area =null
set	@desde =NULL
set	@hasta =NULL
*/
select 	DP.Nro_Documento Documento,
	DP.Apellido,
	DP.Nombre,
	CC.Nro_Contrato,
	convert (char(10), CC.Desde,103) Desde,
	convert (char(10), CC.Hasta,103) Hasta,
	TC.descripcion Tipo_Contrato,
	TR.Descripcion Acto_Administ,			
	CB.Acto_Nro,
	convert (char(10), CB.Acto_Fecha,103) Acto_Fecha,
	--TFC.Apellido Acto_Firmante,
	ttt.Descripcion +'' ''+ DPF.Apellido +'' ''+ DPF.Nombre  Acto_Firmante,
	MB.descripcion Motivo_Baja,
	convert (char(10), CB.Fecha_Baja,103) Fecha_Baja,
	TA.Descripcion Area

from dbo.ctr_contratos_bajas CB

inner join dbo.datos_personales DP
	on CB.nro_documento=DP.nro_documento

inner join dbo.ctr_contratos CC
	on CC.id_contrato=CB.id_contrato

LEFT join dbo.Tabla_Resoluciones_Contratos TC
	on TC.id = CC.tipo_contrato and CC.id_contrato=CB.id_contrato

LEFT join dbo.tabla_tipos_resoluciones TR
	on TR.id = CB.acto_tipo

--LEFT join dbo.CFirmantes_Contratos TFC
--	on TFC.id = CB.Acto_Firmante
LEFT join dbo.Tabla_Firmantes TFC
	on TFC.id = CB.Acto_Firmante
inner join dbo.datos_personales DPF
	on TFC.nro_documento=DPF.nro_documento
inner join dbo.tabla_tratamientos TT
	on TT.id=tfc.id_tratamiento
inner join dbo.tabla_tratamientos_titulos TTT
	on TTT.id=tfc.id_titulo


LEFT JOIN dbo.Tabla_Motivos_Baja MB
	on MB.id=CB.Motivo_Baja

LEFT join dbo.tabla_areas TA
	on TA.id = CC.id_area 

/*
LEFT join dbo.vw_desglose_area DA
	on CC.nro_documento = DA.documento 

LEFT join dbo.tabla_areas TA2
	on TA2.id = DA.id_area 
*/

where 
(CC.nro_documento = @documento  or @documento is null) and
((CC.desde between @desde and @hasta) or (@desde is null or @hasta is null)) and
((CC.hasta between @desde and @hasta) or (@desde is null or @hasta is null)) and
(CC.tipo_contrato= @contrato or @contrato is null) and
(CC.id_area =@area or @area is null) 

order by DP.Apellido, DP.Nombre, CC.Nro_Contrato






' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Datos_ReIncorporacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Datos_ReIncorporacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[LEG_GET_Datos_ReIncorporacion]
	@Id_Interna int
AS
SELECT 	convert(char(10),LB.fecha_baja,103) Fecha_Baja,
	MB.Descripcion MotivoBaja,
	isnull(TR.Descripcion,'''') Acto,
	isnull(LB.Acto_Nro,'''') Acto_Nro,
	isnull(convert(char(10),LB.Acto_Fecha,103),'''') Acto_Fecha,
	convert(char(10),df.Fecha_Min ,103) FechaIngresoMIn,
	dbo.Fx_Calcula_Antiguedad (df.Fecha_Min,LB.fecha_baja) Antiguedad

FROM	dbo.legajo_bajas LB
INNER JOIN dbo.Tabla_Motivos_Baja MB
	on MB.id = LB.motivo_baja
LEFT JOIN dbo.Tabla_Tipos_Resoluciones TR
	on TR.id = LB.actO_tipo
INNER JOIN dbo.Designaciones_Fechas DF
	on DF.Id_interna = LB.ID_Interna
WHERE LB.id_interna = @Id_Interna



' 
END
GO
/****** Object:  View [dbo].[VW_CBajas_Contratos_Completa]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CBajas_Contratos_Completa]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_CBajas_Contratos_Completa]
as
select top 100 percent
	dp.Legajo,
	dp.Apellido,
	dp.Nombre,
	trc.descripcion Tipo_Contrato,
	tn.nivel,
	tg.grado,
	tf.descripcion Funcion,
	r.descripcion rango,
	cc.monto,
	tr.descripcion Acto_Tipo,
	b.Acto_Nro,
	b.Acto_Fecha,
	f.apellido Firmante,
	mb.descripcion Motivo_Baja,
	b.Fecha_Baja
		
		 
from ccontrato cc

left join cdatos_personales dp
	on dp.legajo=cc.legajo

left join CBajas_Contratos b
	on b.id=cc.id 

left join tabla_resoluciones_contratos trc
	on trc.id=cc.tipo_contrato

left join tabla_tipos_resoluciones tr
	on tr.id=b.acto_tipo

left join cfirmantes_contratos f
	on f.id=b.acto_firmante

left join tabla_motivos_baja mb
	on mb.id=b.motivo_baja

LEFT JOIN dbo.Tabla_Niveles tn
	on tn.id = cc.nivel

LEFT JOIN dbo.Tabla_Grados tg
	on tg.id = cc.grado

LEFT JOIN dbo.Tabla_Funciones_Contratos tf
	on tf.id = cc.funcion

LEFT JOIN dbo.Tabla_Rangos r
	on tr.id = cc.rango

where cc.baja=1

order by dp.Apellido,dp.Nombre


'
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Motivos_Bajas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Motivos_Bajas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[GABM_Tabla_Motivos_Bajas]
	@Operacion char(1),
	@Id_1 	[int]=null,
	@Descripcion_2 	[varchar](50)=null

AS 
IF @operacion =''A''
BEGIN
	Declare @MAx [int]
	set @Max = (select max(id)+1 from dbo.Tabla_Motivos_Baja)
	if @Max is null begin
		set @max=1
	end
	INSERT INTO dbo.Tabla_Motivos_Baja 
		 ([Id],
		 [Descripcion],
		Baja) 
 	VALUES 
		( @max,
		 @Descripcion_2,
		0)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_Motivos_Baja
	set 	[Descripcion] =  @Descripcion_2
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_Motivos_Baja
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_Motivos_Baja
	set 	baja =  0
	where 	id = @Id_1
END


IF @operacion =''S''
BEGIN
	SELECT	Id,
		descripcion Descripción,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja 
	FROM  dbo.Tabla_Motivos_Baja
	WHERE (id = @ID_1) OR (@ID_1 is null)
	ORDER BY descripcion
END










' 
END
GO
/****** Object:  View [dbo].[VW_MotivosBaja]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_MotivosBaja]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_MotivosBaja]
AS
SELECT *
FROM tabla_motivos_baja
where baja =0

'
GO
/****** Object:  StoredProcedure [dbo].[ABM_Tabla_motivos_baja]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ABM_Tabla_motivos_baja]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ABM_Tabla_motivos_baja]
	(@ID [smallint],
	@Descripcion	[nvarchar](50),
	@operacion [int])

AS 
declare @MaxId [int]
set @maxId = (select max(id) +1 from dbo.Tabla_motivos_baja )

--ALTA
IF  @operacion = 1 
BEGIN
	INSERT INTO dbo.Tabla_motivos_baja
	 ([Id],
	 Descripcion) 
	VALUES 
		(@maxid,
		@Descripcion)
END


-- MODIFICACION
IF @operacion = 2 
BEGIN
	UPDATE dbo.Tabla_motivos_baja 
	SET   [Id]= @id,
	          Descripcion= @Descripcion
	WHERE 
		ID =  @ID		
END

--BAJA
IF @OPERACION =3  
BEGIN
	UPDATE dbo.Tabla_motivos_baja 
	SET   baja = 1
	WHERE 
		ID =  @ID		
END


--CONSULTA
IF @OPERACION =4 
BEGIN
	SELECT * FROM dbo.Tabla_motivos_baja
	where baja =0
	order by id
END


-- VERIFICA SI EXISTE EN DB
IF @OPERACION=5
BEGIN
	SELECT * FROM dbo.Tabla_motivos_baja
	where descripcion=@descripcion
END


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Contrato_InActivo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Contrato_InActivo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[CTR_GET_Contrato_InActivo]	
	@Doc int
AS
--MLD: 19-09-06: CREADO
SELECT 	C.Id_Contrato,
	C.Id_Domicilio,
	C.Tipo_Contrato,
	C.Nro_Contrato,	convert(char(10),C.Desde,103) Desde,
	convert(char(10),C.Hasta,103) Hasta,
	Case when C.Firmado = 1 then
		''Si''
	else
		''No''
	End Firmado,
	case when C.Impreso = 1 then
		''Si''
	else
		''No''
	end Impreso,
	case when C.Aprobado = 1 then
		''Si''
	else
		''No''
	end Aprobado,
	case when C.Enmienda = 1 then
		''Si''
	else
		''No''
	end Enmienda,
	CASE C.Estado 
		WHEN ''A'' THEN ''Alta''
		WHEN ''E'' THEN ''Enmienda''
		WHEN ''R'' THEN ''Renovación''
		ELSE ''Alta''
	END Estado,
	TRC.Descripcion DescTipo_Contrato,


	--GPR: 05-12-2006
	TTR.Descripcion Acto_Tipo,
	isnull(C.Acto_Nro,'''') Acto_Nro,
	isnull(C.Acto_Fecha,'''')Acto_Fecha,
	--F.Apellido Acto_Firmante,
	ttt.Descripcion +'' ''+ DPF.Apellido +'' ''+ DPF.Nombre Acto_Firmante,
	

	TTRB.Descripcion Acto_Tipo_Baja,
	isnull(CB.Acto_Nro,'''') Acto_Nro_Baja,
	isnull(CB.Acto_Fecha,'''')Acto_Fecha_Baja,
	tttb.Descripcion +'' ''+ DPFB.Apellido +'' ''+ DPFB.Nombre Acto_Firmante_Baja,
	MB.Descripcion Motivo_Baja,
	CB.Fecha_Baja,

	--
	TA2.Descripcion Area
	--

FROM 	dbo.CTR_Contratos C
INNER JOIN dbo.Tabla_Resoluciones_Contratos TRC
	on TRC.Id = C.Tipo_Contrato

--GPR: 05-12-2006 Trae Acto Adm por el cual se aprobo
	--LEFT JOIN dbo.CFirmantes_Contratos F
	--on F.Id=C.Acto_Firmante
LEFT join dbo.Tabla_Firmantes TFC
	on TFC.id = C.Acto_Firmante
LEFT join dbo.datos_personales DPF
	on TFC.nro_documento=DPF.nro_documento
LEFT join dbo.tabla_tratamientos TT
	on TT.id=tfc.id_tratamiento
LEFT join dbo.tabla_tratamientos_titulos TTT
	on TTT.id=tfc.id_titulo
LEFT JOIN dbo.Tabla_Tipos_Resoluciones TTR
	on TTR.id=C.Acto_Tipo
--

--GPR: 12-04-2007 Trae Acto Adm por el cual no se aprobo
LEFT JOIN dbo.CTR_Contratos_Bajas CB
	on CB.Id_Contrato=C.Id_Contrato


LEFT join dbo.Tabla_Firmantes TFCB
	on TFCB.id = CB.Acto_Firmante
LEFT join dbo.datos_personales DPFB
	on TFCB.nro_documento=DPFB.nro_documento
LEFT join dbo.tabla_tratamientos TTB
	on TTB.id=tfcb.id_tratamiento
LEFT join dbo.tabla_tratamientos_titulos TTTB
	on TTTB.id=tfc.id_titulo
LEFT JOIN dbo.Tabla_Tipos_Resoluciones TTRB
	on TTRB.id=CB.Acto_Tipo
LEFT JOIN dbo.Tabla_Motivos_Baja MB
	on MB.id=CB.Motivo_Baja

--

LEFT join dbo.tabla_areas TA
	on TA.id = c.id_area

LEFT join dbo.vw_desglose_area da
	on c.nro_documento = da.documento

LEFT join dbo.tabla_areas TA2
	on TA2.id = da.id_area

--

WHERE 	c.nro_documento= @Doc AND 
	C.baja= 1

ORDER BY Nro_Contrato desc











' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Legajos_de_Baja]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Legajos_de_Baja]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



--MLD: 29-11-06: Modificado para q solo traiga LEGAJOS



CREATE PROCEDURE [dbo].[LEG_GET_Legajos_de_Baja]
	@desde smalldatetime=null,
	@hasta smalldatetime=null,
	@motivo smallint=null
as

SELECT	lb.nro_doc, 
	lb.id_interna,dp.apellido +'', ''+ dp.nombre Nombre, 
	convert(char(10),lb.fecha_baja,103)Fecha_baja, 
	mb.descripcion 
FROM dbo.legajo_bajas lb
INNER JOIN datos_personales dp
	ON dp.id_interna = lb.id_interna
INNER JOIN dbo.tabla_motivos_baja MB
	ON mb.id = lb.motivo_baja
WHERE 	((lb.fecha_baja between @desde and  @hasta) or @desde is null) and 
	(mb.id = @motivo or @motivo is null) AND
	DP.Id_interna <> DP.Nro_Documento


ORDER BY lb.fecha_baja, apellido,nombre










' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Domicilios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Domicilios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[LEG_GET_Domicilios]    
 @Doc int=null,    
 @Id int=null    
AS    
    
SELECT [Fecha_Comunicacion],     
 [Calle],     
 [Número],     
 [Piso],     
 [Dpto],     
 [Casa],     
 [Manzana],     
 [Barrio],     
 [Torre],     
 [UF],    
 [Localidad],     
 [Codigo_Postal],     
 [Partido_Dpto],     
 [Provincia],     
 p.nombreProvincia Provincia_Desc,  
 [Telefono],     
 [Correo_Electronico],    
 [Folio],     
 [Id_Interna],     
 [Nro_Doc],    
 [ID_Domicilio],    
 [Usuario] ,    
 datodebaja  ,  
 nombrelocalidad,  
 pr.descripcion PartidoDesc  
    
FROM [dbo].Domicilio_Personal d    
  
left join provincias p  
 on p.codafip=d.provincia  
left join dbo.localidadesafip L   
 on l.idlocalidad = d.localidad  
left join dbo.partidos Pr  
 On pr.partido = l.id_partido  
   
WHERE (Nro_Doc = @doc) or (id_interna = @id)     
ORDER BY Fecha_Comunicacion DESC  
  
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[Upt_Tel_Mail_Cont_Dom]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Upt_Tel_Mail_Cont_Dom]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[Upt_Tel_Mail_Cont_Dom]
	 @Telefono 	[varchar](20),
	 @Correo_Electronico 	[varchar](50),
	 @Nro_Doc 	[int],
	 @tel_ant 	[varchar](20)

AS UPDATE [dbo].[Domicilio_Personal] 

SET   	[Telefono] = @Telefono,
	 [Correo_Electronico] = @Correo_Electronico
	
WHERE 
	nro_doc=@nro_doc and [Telefono] = @tel_ant
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_Impresion_Contrato_Enmienda]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Impresion_Contrato_Enmienda]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CTR_Impresion_Contrato_Enmienda]  
 @Id_Contrato int  
AS   
SET NOCOUNT ON  
--Busca Nro y Resolucion del COntrato a Enmendar  
CREATE TABLE #T  
 (Id Char(11),  
 Acto Varchar(20),  
 Documento int)  
  
INSERT INTO #T  
SELECT top 1 Nro_Contrato,Acto_Nro, Nro_Documento  
FROM dbo.CTR_Contratos   
WHERE  Nro_Documento in (SELECT Nro_Documento FROM dbo.CTR_Contratos WHERE Id_Contrato = @Id_Contrato) AND  
 Id_Contrato < @Id_Contrato  
ORDER BY Nro_Contrato Desc  
  
  
declare @Doc int  
declare @Max_Iddom int  
  
set @Doc=(select nro_documento from ctr_contratos where id_contrato=@Id_Contrato)  
IF (select aprobado from dbo.ctr_contratos where id_contrato = @Id_contrato) = 1 BEGIN  
 set @Max_Iddom=(select id_domicilio from ctr_contratos where id_contrato=@Id_Contrato)  
end   
else begin  
 set @Max_Iddom=(select max(id_domicilio) from domicilio_personal where nro_doc=@doc and datodebaja=0)  
end  
  
  
SELECT  d.id_domicilio,  
 c.nro_contrato,  
 isnull(#t.id,'''') Nro_Contrato_Ant,  
 isnull(#t.Acto,'''') Resolucion_Ant,  
 TC.id Tipo_Contrato,  
 TC.descripcion Desc_Contrato,   
 td.descripcion Tipo_Doc,    
 C.Nro_Documento,  
 C.[Id_contrato],  
 DP.Apellido,  
  DP.Nombre,  
 d.calle,  
 d.número nro,  
 d.Piso,  
 d.dpto,  
 d.casa,  
 d.manzana,  
 d.Barrio,  
 d.torre,  
 d.UF,  
  
 convert (char(10), C.[Desde],103) Desde ,  
 convert (char(10), C.[Hasta],103) Hasta,  
  
 case when  c.[Impreso] = 1 then  
  ''Si''  
 else  
  ''No''  
 end Impreso,  
  
 case when C.[Aprobado] =1 then  
  ''Si''  
 else  
  ''No''  
 end Aprobado,  
  
 dbo.FxCadena_Dependencia (ta.id) Dependencia,  
  
 ta.descripcion Secretaria,   
  
 c.id_area,  
  
-- ta.de_dela,  
 isnull(TT.Descripcion,'''') de_DeLa,  
 cfc.cargo,  
 cfc.Apellido Nombre_Cont,  
 cfc.direccion,  
  
 case when tc.tipo_contrato = 1 then  
  fc.descripcion    
 else  
  ccf.funcion  
 end Funcion,  
 case when tc.tipo_contrato = 2 then  
  ccf.CargaHsSemLetras  
 else  
  ''No Corresponde''   
 end HS_Letra,  
 case when tc.tipo_contrato = 2 then  
  ccf.CargaHsSemNro  
 else  
  0  
 end hs_nro,  
 case when tc.tipo_contrato = 1 then  
  fc.objeto  
 else  
  ccf.objeto  
 end Objeto,  
 tn.nivel,  
 tg.grado,  
 tgl.letra,   
 c.excepcion,  
 tr.descripcion Rango,  
 c.monto,  
  '', '' + loc.nombrelocalidad  + (case when prov.nombreProvincia <> '''' then '', Provincia de ''+  prov.nombreProvincia else '''' end) Localidad,  
 c.firmado,  
  
 case when c.fecha_impresion is null THEN  
  Getdate()  
 else  
  c.fecha_impresion  
 end Fecha_Impresion,  
  
  
 c.enmienda,   
 c.acto_nro,  
 ttc.sendlegajos,  --MODALIDAD  
 left(tae.codigo,4) codigo     

FROM dbo.CTR_Contratos  C  
INNER JOIN #t  
 on #t.Documento = C.Nro_Documento  
   
--LEFT JOIN dbo.Domicilio_personal DomLeg  
-- on DomLeg.nro_doc =c.Nro_Documento and domleg.fecha_comunicacion = (select max(fecha_comunicacion) from domicilio_personal where nro_doc = c.Nro_Documento)  
  
LEFT JOIN dbo.Domicilio_Personal D  
 on D.id_domicilio = @max_iddom  
  
LEFT JOIN dbo.tabla_funciones_contratos FC  --1184  
 on fc.id=c.funcion  
  
LEFT JOIN dbo.tabla_rangos TR  
 on tr.id = c.rango  
  
LEFT JOIN  dbo.Datos_Personales DP  
 on DP.Nro_Documento = C.Nro_Documento  
  
LEFT JOIN dbo.Tabla_DocIdentidad TD  
 on td.id = dp.tipo_documento   
  
LEFT JOIN dbo.Tabla_Resoluciones_Contratos TC  
 on TC.id = C.tipo_contrato  
  
INNER JOIN dbo.Tabla_Tipos_Contratos TTC  
 on TTC.Id = TC.Tipo_Contrato  
  
--LEFT JOIN dbo.vw_desglose_area da  
-- on c.nro_documento = da.documento  
  
LEFT JOIN dbo.tabla_areas TA  
 on (TA.id = c.id_area)   
  
LEFT JOIN dbo.Tabla_Areas_Detalle TAD  
 on TAD.Id_Area = TA.id  
  
LEFT JOIN dbo.Tabla_Tratamientos TT  
 on TT.Id = TAD.Tratamiento_Area AND Tipo = ''A''  
   
LEFT JOIN dbo.cfirmantes_contratos cfc  
 on cfc.id= c.Contrato_Firmante  
  
LEFT JOIN dbo.tabla_niveles TN  
 on tn.id=c.nivel  
  
LEFT JOIN dbo.tabla_grados TG  
 on tg.id=c.grado  
  
LEFT JOIN dbo.tabla_grado_letras TGL  
 on tgl.grado=tg.grado  
  
LEFT JOIN dbo.ccontrato_funciones CCF  --1421  
 on ccf.id_nivel=tn.id  
  
LEFT JOIN dbo.localidadesafip LOC  
 on (LOC.idLocalidad = d.localidad)   
  
LEFT JOIN dbo.provincias Prov  
 on prov.codAFIP = loc.id_provincia           
  

inner join Tabla_Areas_Estructura TAE  
 on TAE.id_area=c.id_area  
 and right(TAE.codigo,5)= convert(varchar(5),replicate(''0'', 5 - datalength(ltrim(rtrim(tae.id_area))))) + convert(varchar(5),tae.id_area)  


WHERE Id_Contrato = @Id_Contrato  
  
  
drop table #t  
  
  
--***** ACTUALIZA ID_DOMICILIO EN CTR_CONTRATOS ****----  
IF (select aprobado from dbo.ctr_contratos where id_contrato = @Id_contrato) = 0 BEGIN  
 IF (select Impreso from dbo.ctr_contratos where id_contrato = @Id_contrato) = 0 BEGIN  
  update ctr_contratos  
  set id_domicilio=@max_iddom  
  where id_contrato=@id_contrato  
 END  
 else BEGIN  
  update ctr_contratos  
  set id_domicilio=@max_iddom,  
      firmado=0,  
      exp_nro=null  
  where id_contrato=@id_contrato  
 end  
end  
  
  
  
  
  
  
  
  
  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_GET_Recibos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_GET_Recibos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE procedure [dbo].[PLA_GET_Recibos]
	@Confirmado bit=0,
	@id_interna int=null,
	@oficina smallint=null,
	@mes smallint=null,
	@año smallint=null

as
SELECT r.id_interna,r.Cuil,r.Id_Oficina Oficina,r.Nro_Orden,r.Nivel,r.grado,r.confirmado,r.mes,r.año,
dp.apellido +'', ''+ dp.nombre Nombre,

isnull(''Calle:'' + domp.Calle,'''') +
isnull('' Nº:''+ convert(varchar,domp.Número),'''') +
isnull('' Piso:''+ domp.Piso,'''') +
isnull('' Dpto:'' + domp.Dpto,'''') +
isnull('' - (''+ convert(varchar,domp.Codigo_Postal) +'') '','''') +
isnull(loc.nombrelocalidad,'''') DomLegajo,

isnull(''Calle:'' + doml.Calle,'''') +
isnull('' Nº:''+ convert(varchar,doml.Número),'''') +
isnull('' Piso:''+ doml.Piso,'''') +
isnull('' Dpto:'' + doml.Dpto,'''') +
isnull('' - (''+ convert(varchar,doml.Codigo_Postal) +'') '','''') +
isnull(loc2.nombrelocalidad,'''') DomLaboral

from dbo.PLA_Recibos r
inner join dbo.datos_personales dp
	on dp.id_interna = r.id_interna
left join dbo.domicilio_personal Domp
	on domp.id_interna = r.id_interna and domp.id_domicilio = (select max(id_domicilio) from dbo.domicilio_personal where id_interna = r.id_interna)
left join dbo.domicilio_laboral DomL
	on doml.id_interna = r.id_interna and doml.id_domicilio = (select max(id_domicilio) from dbo.domicilio_laboral where id_interna = r.id_interna)
left join dbo.localidadesafip Loc
	on loc.idLocalidad = domp.localidad
left join dbo.localidadesafip Loc2
	on loc2.idLocalidad = doml.localidad

where	(r.Id_Interna = @id_interna or @id_interna is null) and
	(r.confirmado = @confirmado)and
	(r.id_oficina = @oficina or @oficina is null) and
	(r.mes = @mes or @mes is null) and
	(r.año = @año or @año is null) and
	r.confirmado =0

' 
END
GO
/****** Object:  StoredProcedure [dbo].[RELEVA_Datos_Personales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RELEVA_Datos_Personales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[RELEVA_Datos_Personales]  
 @Documento int  
AS  
  
SELECT  apellido,  
 Nombre,  
 nro_documento,  
 TDoc.Descripcion Tipo_Documento,  
 left(CUIl_Nro,2)+''-''+  right(left(CUIl_Nro,10),8) +''-''+ right(CUIl_Nro,1) CUIL,  
 convert(char(10),Fecha_Nacimiento,103) Fecha_Nacimiento,  
 TC.Descripcion Estado_Civil,  
 dom.Calle,  
 dom.Número Numero,  
 dom.piso,  
 dom.dpto,  
 dom.barrio,  
 loc.NombreLocalidad,  
 dom.partido_dpto,  
 PV.NombreProvincia,  
 dom.Codigo_Postal,  
 Correo_Electronico,  
 Telefono  
   
FROM dbo.Datos_Personales DP  
LEFT JOIN dbo.Domicilio_Personal Dom  
 ON Dom.Nro_Doc = DP.Nro_Documento AND  
    Id_Domicilio = (select top 1 id_domicilio From dbo.Domicilio_Personal 
			Where Nro_Doc = DP.Nro_Documento and DatoDeBaja = 0
			order by convert(char,fecha_comunicacion,112) desc )
LEFT JOIN dbo.Tabla_DocIdentidad TDoc  
 ON TDoc.id = DP.Tipo_Documento  
LEFT JOIN dbo.Tabla_Estado_Civil TC   
 ON TC.Id = DP.Estado_Civil  
LEFT JOIN dbo.LocalidadesAfip Loc  
 on LOC.IdLocalidad = Dom.Localidad  
LEFT JOIN dbo.Provincias PV  
 on PV.IdProvincia = dom.Provincia  
WHERE DP.Nro_Documento = @Documento  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_GET_Domicilio_Personal]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_GET_Domicilio_Personal]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[PLA_GET_Domicilio_Personal]
	@id int
AS

SELECT  Fecha_Comunicacion,
	Calle,
	Número,
	Piso,
	Dpto,
	Casa,
	Manzana,
	Barrio,
	Torre,
	UF,
	Codigo_Postal,
	L.nombrelocalidad Localidad,
	Pa.descripcion Partido,
	Pv.nombreprovincia Provincia

FROM [dbo].Domicilio_Personal  D
inner join dbo.localidadesafip L
	on L.idlocalidad = D.localidad
inner join provincias Pv
	on Pv.codafip = L.id_provincia
inner join partidos Pa
	on Pa.partido = L.id_partido

WHERE id_interna = @id 
and id_domicilio = (select max(id_domicilio) from dbo.domicilio_personal where id_interna = @id)



' 
END
GO
/****** Object:  View [dbo].[VW_LIQ_Datos_Banco_Nacion]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_LIQ_Datos_Banco_Nacion]'))
EXEC dbo.sp_executesql @statement = N'CREATE view [dbo].[VW_LIQ_Datos_Banco_Nacion]                       
as                          
select  top 100 percent           
 dp.nro_documento,                                 
 dp.Apellido +'', ''+ dp.Nombre  NomApe,                                           
   NULL id_area, -- ta.id id_area,                                
   NULL area,    -- ta.Descripcion area,                                 
             
 case when id_provincia=0 then                                
     l.nombrelocalidad                                 
   else                                
     l.nombrelocalidad +'' / ''+ p.nombreProvincia                                 
   end localidad,                                 
                                 
    NULL Id_dom_pago, -- tad.id_area Id_dom_pago,                                
                                 
 ltrim(rtrim(dom.calle)) Calle_dom,                                  
 ltrim(rtrim(dom.Número)) Nro_dom,                                  
 ltrim(rtrim(dom.piso)) Piso_dom,                                  
 ltrim(rtrim(dom.dpto)) dpto_dom,                                                        
          
 NULL calle_pago,                                 
 NULL nro_pago,                                
 NULL piso_pago,                                
 NULL dpto_pago,  
 
 '''' Tipo_Planta,  
 '''' planta,  
 '''' Nivel,  
 '''' Grado,  
 '''' funcion,  
 '''' rango,  
 '''' monto,

/*                                                  
 LDP.Id_Planta Tipo_Planta,                                
 TTP.descripcion planta,                                                    
          
  CASE WHEN TN.Nivel IS NOT NULL THEN                  
     TN.Nivel                    
  END Nivel,                    
                   
  CASE WHEN TG.Grado IS NOT NULL THEN                      
    TG.Grado                    
  END Grado,                    
                   
  CASE WHEN TF.descripcion IS NOT NULL THEN                   
    TF.descripcion                            
  end funcion,                     
                    
  CASE WHEN TRG.descripcion IS NOT NULL THEN                   
    TRG.descripcion                   
  end  rango,                                   
                   
  CASE WHEN TN.Nivel IS NULL THEN                    
    c.monto                     
  ELSE                    
   -- TS.Remuneracion_Fija  --mld:09/08/07 Modifacion tabla Sinapa                
     dbo.Fx_Monto_Sinapa (tn.nivel, tg.grado, c.Desde)                
  END Monto,                  
*/
              
  ec.id id_estado_civil,                                
  EC.descripcion Estado_civil,                            
---------                            
 ''AH'' Proceso,      
 NULL Servicio,      
 0 Sucur_Bco,       
 11 id_banco,      
 ''P'' Moneda,      
 0 Limite_Tarjeta,      
 Codigo_Banco_Nacion letra_EC,                                             
 NULL CBU,                            
 NULL Tarjeta_Debito,      
 NULL Tarjeta_1er_Titular,      
 NULL Tarjeta_2do_Titular,                      
 0 exportado,             
 DP.Cuil_Nro CUIL,    
 DP.Id_interna          
                          
from dbo.datos_personales dp                                
                          
inner join dbo.Domicilio_Personal Dom                                  
 on dp.nro_documento = dom.nro_doc 
 and dom.id_domicilio = (select max(id_domicilio) from domicilio_personal where nro_doc = dp.nro_documento)                                  
                                
inner join dbo.localidadesafip L                                  
 on L.idlocalidad=dom.localidad                                 
                                
inner join dbo.provincias p                                  
 on  p.codafip=l.id_provincia                                 
 and  l.codigopostal=dom.codigo_postal                                
                          
--left join dbo.vw_desglose_area da                                
-- on dp.nro_documento = da.documento                                
--LEFT join dbo.tabla_areas TA                                
-- on TA.id = da.id_area                                
--LEFT join dbo.tabla_areas_detalle TAD                                
-- on tad.id_area=TA.id                                
                            
------left join dbo.leg_desglose_planta LDP                                
------ on dp.nro_documento = ldp.Documento                               
             
------left join dbo.tipo_de_planta TTP                                
------ on ttp.id=LDP.Id_Planta            
                                  
left join dbo.ctr_contratos C                                
 on c.nro_documento=dp.nro_documento                              
 and nro_contrato = (select max(nro_contrato)                                 
      from ctr_contratos                                 
      where nro_documento = dp.nro_documento and c.baja=0)                                  
                               
------left  join dbo.tabla_niveles TN                                  
------ on TN.id = C.nivel                                  
                                  
------left join dbo.tabla_grados TG                                  
------ on TG.id = c.grado                                  
                                
------left join dbo.tabla_funciones_contratos TF                                  
------ on TF.id = c.funcion                                  
                                  
------LEFT join dbo.tabla_rangos TRG                                  
------ on TRG.id = c.rango                                  
                          
inner join dbo.Tabla_Estado_Civil EC                                
 on ec.id=dp.estado_civil                                
                          
left join dbo.legajo_bajas LB                          
 on lb.ID_INTERNA =  DP.Id_interna                          
                          
-------------------------------------------------------------                
--LEFT JOIN dbo.Tabla_Sinapa TS     --MLD: MOdificacion SINAPA                
-- on (TS.Nivel = tn.nivel) AND                    
--    (TS.grado = tg.grado)                  
-------------------------------------------------------------                
where  lb.nro_doc IS NULL                               
 --and (nro_contrato = (select max(nro_contrato) from ctr_contratos where nro_documento = dp.nro_documento and c.baja=0)          
 --or nro_contrato is null)        
          
order by apellido                       

'
GO
/****** Object:  StoredProcedure [dbo].[CON_PARAN_TITULAR_FAMILIAR]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CON_PARAN_TITULAR_FAMILIAR]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[CON_PARAN_TITULAR_FAMILIAR]
	@NacimientoDesdeP datetime=null,
	@NacimientoHastaP datetime=null,
	@SexoP smallint=null,
	@TDocP smallint=null,
	@EstadoCivil smallint=null,
	@GrupoS smallint=null,
	@FactorS smallint=null,
	@NacionalidadP smallint=null,
	@IngresoDesdeP datetime=null,
	@IngresoHastaP datetime=null,
	@Os smallint=null,
	@OpcionJub smallint = null,
	@AFJP smallint=Null,
	@Localidad smallint = null,
	@Parentesco smallint = null,
	@NacimientoDesdeF datetime=null,
	@NacimientoHastaF datetime=null,
	@SexoF smallint=null,
	@TDocF smallint=null,
	@NacionalidadF smallint=null,
	@ACargoDesde datetime=null,
	@ACargoHasta datetime=null,
	@Adoptado bit=1,
	@Discapacitado bit=1,
	@BajaP Bit=null,
	@BajaF bit=null,
	@familiares bit
	

as

SELECT  	--DATOS DEL TITULAR
	dp.id_interna,
	''Titular'' Parentesco,
	tdoc.descripcion TipoDocT,
	dp.Nro_Documento,
	dp.apellido +'', ''+  dp.nombre ApellidoT,	
	convert(varchar(10),dp.fecha_nacimiento,103) FechaNacTitular,
	case when dp.sexo = 1 then
		''Masculino''
	else
		''Femenino''
	end SexoT,
	ec.descripcion EstadoCivil,
	case grupo_sanguineo 
	when 0 then ''0''
	when 1 then ''A''
	when 2 then ''B''
	when 3 then ''AB''  
	else  '' ''
	end GrupoSanguineo,
	case Factor_sanguineo
	when 0 then ''RH +''
	when 1 then ''RH -''	
	else '' ''
	end FactorSanguineo,
	nac.descripcion NacionalidadT,
	convert(varchar(10),dp.Fecha_Ingreso_Pais,103) FechaIngresoPaisT,
	os.nombre ObraSocial,
	case when Regimen_Jubilatorio=2 then
		''Capitalización''
	else
		''Reparto''
	end OpcionJubilatoria,
	rj.descripcion AFJP,
	DomP.Calle + '' ''+ convert(varchar(5),domp.número) + 
		case when not domp.piso is null then '' Piso:''+  domp.piso end
		+ 
		case when not domp.dpto  is null then '' Dpto:'' + domp.dpto end	DomicilioT,
	loc.codigopostal CodigoPostalP,
	loc.nombrelocalidad LocalidadP ,
/*

	--DATOS DEL FAMILIAR
--	''Familiar'' Familiar,
	tdocf.descripcion TipoDocF,
	df.Fam_Docum_Nrodoc Nro_DocumentoF,
	df.apellido +'', ''+  df.nombre ApellidoF,	
	convert(varchar(10),df.fecha_nacimiento,103) FechaNacFamiliar,
	case when df.sexo = 1 then
		''Masculino''
	else
		''Femenino''
	end SexoF,
	nacf.descripcion NacionalidadF,
	DomPf.Calle + '' ''+ convert(varchar(5),dompf.nro) + 
		case when not dompf.piso is null then '' Piso:''+  dompf.piso end
		+ 
		case when not dompf.dpto  is null then '' Dpto:'' + dompf.dpto end	DomicilioF,
	dompf.codigo_postal CodigoPostalF,
	DOMPf.Localidad LocalidadF
*/
	case when dp.id_interna in (select id_interna from legajo_bajas) then
		''Si''
	else
		''No''
	end Baja,
	0 Orden
FROM dbo.datos_personales DP

INNER JOIN dbo.Domicilio_Personal DomP
	on Domp.id_interna = dp.id_interna and
	domP.id_domicilio = (select max(id_domicilio) from dbo.domicilio_personal where id_interna = dp.id_interna) and
	(domp.localidad = @localidad or @localidad is null)

INNER JOIN dbo.tabla_DocIdentidad TDoc
	on TDoc.id = dp.tipo_Documento

INNER JOIN dbo.Tabla_Estado_Civil EC
	on EC.id = DP.Estado_Civil

INNER JOIN dbo.tabla_nacionalidad NAC
	on NAC.id = Dp.Nacionalidad

INNER JOIN dbo.Tabla_ObraSOcial OS
	on OS.id = DP.Obra_Social

INNER JOIN dbo.Tabla_Regimen_Jubilatorio RJ
	on RJ.id = dp.denominacion

INNER JOIN LOCALIDADESAFIP LOC
	on LOC.idlocalidad = domp.localidad
/*
INNER join dbo.Datos_Familiares DF
	ON DF.ID_Interna = dp.Id_interna	 

INNER JOIN dbo.Domicilio_Familiares DomPf
	on Dompf.id_interno = dp.id_interna and
	dompf.id_fam = df.idfam and
	domPf.orden = (select max(orden) from dbo.domicilio_familiares where id_interno = dp.id_interna and id_fam = df.idfam) 

INNER JOIN dbo.tabla_DocIdentidad TDocF
	on TDocf.id = df.fam_docum_tipo

INNER JOIN dbo.tabla_nacionalidad NACf
	on NACf.id = Df.Nacionalidad
*/	
WHERE 	--PERSONALES
	((dp.fecha_nacimiento between @NacimientoDesdeP and @NacimientoHastaP) or @NacimientoDesdeP is null) and
	(dp.sexo = @SexoP or @SexoP is null) and
	(dp.tipo_documento = @TdocP or @TdocP is null) and
	(dp.Estado_civil = @EstadoCivil or @EstadoCivil is null) and
	(dp.Grupo_Sanguineo = @GrupoS or @GrupoS is null) and
	(dp.Grupo_Sanguineo = @FactorS or  @FactorS is null) and
	(dp.nacionalidad = @NacionalidadP or @NacionalidadP is null) and
	((dp.Fecha_Ingreso_Pais between @IngresodesdeP and @IngresoHastaP) or @IngresoDesdeP is null) and
	(dp.obra_social = @os or @os is null) and
	(dp.Regimen_Jubilatorio = @opcionjub or @opcionjub is null) and
	(dp.Denominacion = @afjp or @afjp is null) and
	((dp.id_interna in (select id_interna from legajo_bajas) and @BajaP=1 or @bajaP is null) or
	(dp.id_interna not in (select id_interna from legajo_bajas) and @BajaP=0 or @bajaP is null)) --and
	/*
	--FAMILIARES
	(df.parentesco = @Parentesco or @parentesco is null) and
	((df.Fecha_Nacimiento between @NacimientoDesdeF and @NacimientoHastaF) or @NacimientoDesdeF is null) and
	(df.sexo = @SexoF or @SexoF is null) and
	(df.Fam_Docum_Tipo = @TDocF or @TdocF is null) and
	(df.nacionalidad =  @NacionalidadF or @NacionalidadF is null) and
	((df.ACargoDesde >= @ACargoDesde and df.ACargoHasta <= @ACargoHasta) or @ACargoDesde is null) and
	(df.adoptado = @adoptado or @adoptado =1) and
	(df.discapacitado = @Discapacitado or @Discapacitado = 1) and
	((not df.fecha_baja is null and @BajaP=1 or @bajaP is null) or
	(df.fecha_baja is null and @BajaP=0 or @bajaP is null)) 
*/




union all


SELECT  	--DATOS DEL TITULAR
	--DATOS DEL FAMILIAR
	dp.id_interna,
	ta.descripcion Familiar,
	tdocf.descripcion TipoDocF,
	df.Fam_Docum_Nrodoc Nro_DocumentoF,
	df.apellido +'', ''+  df.nombre ApellidoF,	
	convert(varchar(10),df.fecha_nacimiento,103) FechaNacFamiliar,
	case when df.sexo = 1 then
		''Masculino''
	else
		''Femenino''
	end SexoF,
	'' '',
	'' '',
	'' '',
	nacf.descripcion NacionalidadF,
	'' '',
	'' '',
	'' '',
	'' '',
	DomPf.Calle + '' ''+ convert(varchar(5),dompf.nro) + 
		case when not dompf.piso is null then '' Piso:''+  dompf.piso end
		+ 
		case when not dompf.dpto  is null then '' Dpto:'' + dompf.dpto end	DomicilioF,
	dompf.codigo_postal CodigoPostalF,
	DOMPf.Localidad LocalidadF,
	case when not df.fecha_baja is null then
		''Si''
	else
		''No''
	end Baja,
	1 orden
FROM dbo.datos_personales DP

INNER JOIN dbo.Domicilio_Personal DomP
	on Domp.id_interna = dp.id_interna and
	domP.id_domicilio = (select max(id_domicilio) from dbo.domicilio_personal where id_interna = dp.id_interna) and
	(domp.localidad = @localidad or @localidad is null)

INNER JOIN dbo.tabla_DocIdentidad TDoc
	on TDoc.id = dp.tipo_Documento

INNER JOIN dbo.Tabla_Estado_Civil EC
	on EC.id = DP.Estado_Civil

INNER JOIN dbo.tabla_nacionalidad NAC
	on NAC.id = Dp.Nacionalidad

INNER JOIN dbo.Tabla_ObraSOcial OS
	on OS.id = DP.Obra_Social

INNER JOIN dbo.Tabla_Regimen_Jubilatorio RJ
	on RJ.id = dp.denominacion

INNER JOIN LOCALIDADESAFIP LOC
	on LOC.idlocalidad = domp.localidad

INNER join dbo.Datos_Familiares DF
	ON DF.ID_Interna = dp.Id_interna	 

INNER JOIN dbo.Domicilio_Familiares DomPf
	on Dompf.id_interno = dp.id_interna and
	dompf.id_fam = df.idfam and
	domPf.orden = (select max(orden) from dbo.domicilio_familiares where id_interno = dp.id_interna and id_fam = df.idfam) 

INNER JOIN dbo.tabla_DocIdentidad TDocF
	on TDocf.id = df.fam_docum_tipo

INNER JOIN dbo.tabla_nacionalidad NACf
	on NACf.id = Df.Nacionalidad

INNER JOin dbo.tabla_PArentesco TA
	on ta.id = df.parentesco
	
WHERE 	--PERSONALES
	((
	((dp.fecha_nacimiento between @NacimientoDesdeP and @NacimientoHastaP) or @NacimientoDesdeP is null) and
	(dp.sexo = @SexoP or @SexoP is null) and
	(dp.tipo_documento = @TdocP or @TdocP is null) and
	(dp.Estado_civil = @EstadoCivil or @EstadoCivil is null) and
	(dp.Grupo_Sanguineo = @GrupoS or @GrupoS is null) and
	(dp.Grupo_Sanguineo = @FactorS or  @FactorS is null) and
	(dp.nacionalidad = @NacionalidadP or @NacionalidadP is null) and
	((dp.Fecha_Ingreso_Pais between @IngresodesdeP and @IngresoHastaP) or @IngresoDesdeP is null) and
	(dp.obra_social = @os or @os is null) and
	(dp.Regimen_Jubilatorio = @opcionjub or @opcionjub is null) and
	(dp.Denominacion = @afjp or @afjp is null) and
	((dp.id_interna in (select id_interna from legajo_bajas) and @BajaP=1 or @bajaP is null) or
	(dp.id_interna not in (select id_interna from legajo_bajas) and @BajaP=0 or @bajaP is null)) and
	
	--FAMILIARES
	(df.parentesco = @Parentesco or @parentesco is null) and
	((df.Fecha_Nacimiento between @NacimientoDesdeF and @NacimientoHastaF) or @NacimientoDesdeF is null) and
	(df.sexo = @SexoF or @SexoF is null) and
	(df.Fam_Docum_Tipo = @TDocF or @TdocF is null) and
	(df.nacionalidad =  @NacionalidadF or @NacionalidadF is null) and
	((df.ACargoDesde >= @ACargoDesde and df.ACargoHasta <= @ACargoHasta) or @ACargoDesde is null) and
	(df.adoptado = @adoptado or @adoptado =1) and
	(df.discapacitado = @Discapacitado or @Discapacitado = 1) and

	((not df.fecha_baja is null and @Bajaf=1 or @bajaf is null) or
	(df.fecha_baja is null and @Bajaf=0 or @bajaf is null)) 

	) and @familiares = 1)







order by dp.id_interna, orden

	


	




' 
END
GO
/****** Object:  StoredProcedure [dbo].[BORRAR]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[BORRAR]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[BORRAR] 
	-- Add the parameters for the stored procedure here
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here

 UPDATE dbo.Datos_Personales            
 SET Id_Interna =  202867,            
  VisibleLegajos = 1            
 WHERE Nro_Documento = 25314963            
            
 UPDATE dbo.Domicilio_Personal            
 SET Id_Interna = 202867            
 WHERE Nro_Doc = 25314963            
            
 UPDATE dbo.Estudios_Realizados            
 SET  Id_Interna = 202867            
 WHERE Nro_Doc = 25314963            
            
 UPDATE dbo.LEG_Desglose_Area             
 SET  Id_Interna = 202867            
 WHERE Documento = 25314963            
            
 UPDATE dbo.LEG_Desglose_Planta             
 SET  Id_Interna = 202867            
 WHERE Documento = 25314963            
            
 UPDATE dbo.LEG_Otros_Servicios            
 SET  Id_Interna = 202867,            
  Folio = ''99-999/999''            
 WHERE Id_interna = 25314963            
            
 UPDATE dbo.LEG_Servicios_Adm_Publica            
 SET  Id_Interna = 202867--,            
--  Folio = ''99-999/999''            
 WHERE Doc_Titular = 25314963            
            
 UPDATE dbo.leg_desglose_ur  
 SET  Id_Interna = 202867   
 WHERE Documento = 25314963            
             
 DECLARE @IdContrato int            
 DECLARE @MaxId int            
 SET @IdContrato = (            
  SELECT max(Id_Contrato)             
  FROM dbo.CTR_Contratos             
  WHERE nro_Documento = 25314963 and Aprobado = 1 and Baja =0)            
            
 SET @MaxId = (Select max(Id)+1 FROM dbo.Leg_Desglose_NivelGrado)            
            
 INSERT INTO dbo.LEG_Desglose_NivelGrado            
 SELECT  @MAxId,            
  202867,            
  25314963,            
  Nivel,             
  Grado,            
  Desde,            
  ''MDS'',            
  ''MDS'',            
  ''99-999/999'',            
  Acto_Tipo,            
  Acto_Nro,            
  Acto_Fecha,            
  Usuario             
  from dbo.Ctr_Contratos             
  Where Id_Contrato = @IdContrato            
            
            
            
            
 UPDATE dbo.LEG_Desglose_NivelGrado            
 SET  Id_Interna = 202867            
 WHERE Documento = 25314963            
            
 DECLARE @FechaMin datetime            
 SET @FechaMin = (          
          
Select min(Desde)           
 from dbo.CTR_Contratos C          
 INNER JOIN dbo.tabla_resoluciones_Contratos TRC          
  ON TRC.Id = C.Tipo_Contrato          
 INNER JOIN dbo.Tabla_Tipos_Contratos TTC          
  ON TTC.Id = TRC.Tipo_Contrato          
 WHERE Nro_Documento = 25314963           
  and SendLegajos =  1)            
          
            
 INSERT INTO dbo.Designaciones_Fechas            
 VALUES (NULL,ISNULL(@FechaMin,GETDATE()) , 25314963, 202867)   

END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_CRED_PERSONAS]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_CRED_PERSONAS]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_GET_CRED_PERSONAS]      
 @nro_documento int,      
 @fecha smalldatetime      
as      
      
set nocount on      
      
IF (select count(1) from dbo.Domicilio_Personal      
 where Nro_Doc = @nro_documento      
 and Fecha_Comunicacion = @fecha) > 0       
BEGIN      
 select ''1'' resultado      
 return      
END      
      
    
IF (select count(1) from dbo.datos_personales dp      
INNER JOIN dbo.Legajo_Bajas lb      
 ON dp.Nro_Documento = lb.Nro_Doc  
where dp.Nro_Documento = @nro_documento) > 0      
BEGIN      
 select ''2'' resultado      
 return      
END      
    
      
      
IF (select count(1)      
 from dbo.CRED_PersonasRelevadas pr          
 INNER JOIN CRED_Domicilios d          
  ON pr.Documento = d.Documento          
 where pr.Documento = @nro_documento          
 and pr.Fecha_comunicacion = @fecha) = 0      
BEGIN      
 select ''3'' resultado      
 return      
END      
      
      
select ''4'' resultado,      
pr.Documento,      
pr.Apellido,      
pr.Nombre,      
pr.Lugar_de_trabajo,      
pr.Telefono,      
pr.Email_mds,      
pr.Email_personal,      
pr.Fecha_comunicacion      
 from dbo.CRED_PersonasRelevadas pr          
 INNER JOIN CRED_Domicilios d          
  ON pr.Documento = d.Documento          
 where pr.Documento = @nro_documento          
 and pr.Fecha_comunicacion = @fecha ' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_DELETE_DP_DA_TP]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_DELETE_DP_DA_TP]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE Procedure [dbo].[CTR_DELETE_DP_DA_TP]
@Doc int
as

/*
Delete from datos_personales
where nro_documento=@Doc

Delete from dbo.LEG_Desglose_Area
where documento=@Doc

Delete from dbo.LEG_Desglose_Planta
where documento=@Doc
*/

delete from WEB_Sincronizacion_DatosPersonales
where nro_documento=@Doc

delete from LEG_Desglose_Area
where documento=@Doc

delete from LEG_Desglose_Planta
where documento=@Doc

delete from WEB_Sincronizacion_SaldosLicencias
where id_interna in (select id_interna from datos_personales
			where nro_documento=@Doc)

delete from Autorizaciones_Licencias
where id_interna in (select id_interna from datos_personales
			where nro_documento=@Doc)

delete from licencias_solicitadas
where id_interna in (select id_interna from datos_personales
			where nro_documento=@Doc)

DELETE from domicilio_personal
where nro_doc=@Doc


DELETE from datos_personales
where nro_documento=@Doc





' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_MaxIdDomicilio]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_MaxIdDomicilio]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[CTR_GET_MaxIdDomicilio]
	@doc int
AS
--MLD: 20-09-06: Modificado para usar FECHA de Comunicacion
SELECT 	top 1 ISNULL(id_domicilio,'''') Id_Dom 
FROM 	dbo.Domicilio_Personal
WHERE 	nro_doc = @doc
ORDER BY Fecha_Comunicacion Desc


' 
END
GO
/****** Object:  StoredProcedure [dbo].[Get_Domicilio_Personal]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Get_Domicilio_Personal]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[Get_Domicilio_Personal]
	@id int
AS

SELECT * FROM
[dbo].Domicilio_Personal 
	WHERE Id_Domicilio = @id 



' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetDomicilios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetDomicilios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GetDomicilios]
	@titid int,
	@titdoc int
AS

SELECT * FROM
[dbo].Domicilio_Personal 
	WHERE Nro_Doc = @titdoc or id_interna = @titid ORDER BY Fecha_Comunicacion DESC


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LIQ_Exportar_Txt_Bco]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_Exportar_Txt_Bco]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[LIQ_Exportar_Txt_Bco]          
 @id int          
AS          
          
declare @fecha_min char(8)  
  
SELECT nb.nro_cta_empresa,          
 ----------------------        
 dp.apellido,          
 ----------------------        
  dp.nombre,          
 ----------------------        
  case when dp.tipo_documento=1 or dp.tipo_documento=2 or dp.tipo_documento=3 then           
   ''001''          
  else          
   case when dp.tipo_documento=4 then          
    ''004''          
   else          
    ''Corregir Tipo_Doc''          
   end          
  end Tipo_Doc,          
 ----------------------          
  dp.nro_documento,          
 ----------------------        
  case when dp.tipo_documento=1 or dp.tipo_documento=2 or dp.tipo_documento=3 then           
   ''00''          
  else          
   case when dp.tipo_documento=4 then          
    ''04''          
   else          
    ''Corregir Prov_doc''          
   end          
  end Prov_Doc,          
 ----------------------          
  case when dp.nacionalidad=1 then          
   ''A''          
   else          
   ''E''          
  end Nacionalidad,          
 ----------------------          
  right(convert(char(8),dp.fecha_nacimiento,112),2) + left(right(convert(char(8),dp.fecha_nacimiento,112),4),2) + left(convert(char(8),dp.fecha_nacimiento,112),4) fecha_nacimiento,          
   ----------------------        
  case when dp.sexo=1 then          
   ''M''          
   else          
   ''F''          
  end Sexo,          
 ----------------------        
 nc.Estado_Civil_Bco Estado_Civil,          
 ----------------------        
  dom.calle Calle,          
 ----------------------        
  dom.Número Nro,          
 ----------------------        
  dom.piso Piso,          
 ----------------------        
  dom.dpto,          
 ----------------------        
  l.nombrelocalidad Localidad,         
 ----------------------         
  dom.codigo_postal,           
  ----------------------          
  p.cod_bco Cod_Prov,          
 ----------------------           
  nc.tipo_cta,          
 ----------------------        
  ''008'' cia,          
 ----------------------        
  dp.cuil_nro,          
 ----------------------        
  nc.sueldo,            
 ----------------------        
  
case when right(convert(char(8),dbo.FxGet_Min_Desde(c.nro_documento),112),2) + left(right(convert(char(8),dbo.FxGet_Min_Desde(c.nro_documento),112),4),2) + left(convert(char(8),dbo.FxGet_Min_Desde(c.nro_documento),112),4) is null then  
  
 isnull ( right(convert(char(8),d.fecha_min,112),2) + left(right(convert(char(8),d.fecha_min,112),4),2) + left(convert(char(8),d.fecha_min,112),4) , getdate())  
   
else   
  
 right(convert(char(8),dbo.FxGet_Min_Desde(c.nro_documento),112),2) + left(right(convert(char(8),dbo.FxGet_Min_Desde(c.nro_documento),112),4),2) + left(convert(char(8),dbo.FxGet_Min_Desde(c.nro_documento),112),4)       
  
end Fecha_Ingreso,  
  
  
----------------------         
  nc.Id_Dom_Pago Cod_Dep,  --db.codigo_dependencia        
 ----------------------         
  db.codigo_postal CP_Dep,         
 ----------------------         
  db.id_area          
          
          
FROM datos_personales dp          
           
inner join Domicilio_Personal Dom          
-- on dp.nro_documento=dom.nro_doc and id_domicilio = (select max(id_domicilio) from domicilio_personal where id_interna = dp.id_interna)          
   on dp.nro_documento=dom.nro_doc and id_domicilio = (select max(id_domicilio) from domicilio_personal where nro_doc = dp.nro_documento)                    

inner join liq_nro_cuenta NC          
 on nc.documento=dp.nro_documento          
          
inner join localidadesafip L          
 on L.idlocalidad=dom.localidad          
          
inner join provincias p          
 on p.codafip=l.id_provincia and l.codigopostal=dom.codigo_postal          
      
left join ctr_contratos c        
 on c.nro_documento=dp.nro_documento and c.id_contrato=(select max(id_contrato) from CTR_Contratos where nro_documento=dp.nro_documento)      
      
left join dbo.vw_desglose_area da          
 on da.documento = dp.nro_documento      
      
left join tabla_areas_detalle db        
 on db.id_area = da.id_area        
  
left join tabla_nomina_bancos NB        
 on nb.codigo=nc.id_banco      
  
left join designaciones_fechas d          
 on d.nro_doc=dp.nro_documento   
      
where nc.id=@id          
          
        
      
          
          
/*  
left join designaciones des          
 on d.nro_doc=des.nro_doc           
        
left join dbo.vw_desglose_area vwda          
 on vwda.id_interna = des.id_interna          
          
left join dbo.vw_desglose_nivelgrado vwdng          
 on vwdng.id_interna = des.id_interna          
          
left join dbo.vw_desglose_planta vwdp          
 on vwdp.id_interna = des.id_interna          
        
        
left join tabla_areas_detalle db          
 on db.id_area = des.area          
          
left join tabla_nomina_bancos NB          
 on nb.codigo=nc.id_banco          
*/          
      
          
          
        
      
    
  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[Update_Domicilio_Personal]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Update_Domicilio_Personal]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[Update_Domicilio_Personal]      
   (@Fecha_Comunicacion_21  [smalldatetime],      
  @Calle_22  [varchar](50),      
  @Número_23  [int],      
  @Piso_24  [varchar](50),      
  @Dpto_25  [varchar](50),      
  @Casa_26  [varchar](10),      
  @Manzana_27  [varchar](10),      
  @Barrio_28  [varchar](20),      
  @Torre_29  [varchar](10),      
  @UF_30  [varchar](10),      
  @Localidad_31  [int],      
  @Codigo_Postal_32  [varchar](50),      
  @Partido_Dpto_33  [varchar](50),      
  @Provincia_34  [varchar](50),      
  @Telefono_35  [varchar](20),      
  @Correo_Electronico_36  [varchar](50),      
  @Folio_37  [char](10),      
  @Id_Interna_38  [int],      
  @Nro_Doc_39  [int],      
  @ID_Domicilio_40  [int],      
  @baja bit,
  @usuario int=null)      
      
    
    
AS       
      
--GPR 06-03-07      
--Tiraba error al ingresar la provincia. Guardaba la Descrip.      
--Se agrega para cambiar a Id      
      
--MLD_ 30-04-07      
--SE CAMBIO IdProvincia POR CODAFIP      
      
      
      
declare @id_prov int      
set @id_prov= (select codafip from dbo.Provincias      
where nombreProvincia = @Provincia_34)      
--where nombreprovincia = @Provincia_34)      
--      
      
      
UPDATE [dbo].[Domicilio_Personal]       
      
SET  [Fecha_Comunicacion]  = @Fecha_Comunicacion_21,      
  [Calle]  = @Calle_22,      
  [Número]  = @Número_23,      
  [Piso]  = @Piso_24,      
  [Dpto]  = @Dpto_25,      
  [Casa]  = @Casa_26,      
  [Manzana]  = @Manzana_27,      
  [Barrio]  = @Barrio_28,      
  [Torre]  = @Torre_29,      
  [UF]  = @UF_30,      
  [Localidad]  = @Localidad_31,      
  [Codigo_Postal]  = @Codigo_Postal_32,      
  [Partido_Dpto]  = @Partido_Dpto_33,      
  [Provincia]  = @id_prov,      
  [Telefono]  = @Telefono_35,      
  [Correo_Electronico]  = @Correo_Electronico_36,      
  [Folio]  = @Folio_37,      
--  [Id_Interna]  = @Id_Interna_38,      
  [Nro_Doc]  = @Nro_Doc_39,      
  [ID_Domicilio]  = @ID_Domicilio_40,      
  [DatoDeBaja] = @baja,
  usuario=@usuario      
      
WHERE       
 ( [ID_Domicilio]  = @ID_Domicilio_40)      
      
      
      
    
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Domicilio_Personal]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Domicilio_Personal]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[RPT_LEG_Domicilio_Personal]
	@id_interna int
AS

SELECT  Fecha_Comunicacion,
	Calle,
	Número,
	Piso,
	Dpto,
	Codigo_Postal,
	l.nombrelocalidad, 
	pp.descripcion Partido, 
	p.nombreprovincia Prov,
	Telefono
FROM [dbo].Domicilio_Personal  D
INNER JOIN dbo.localidadesafip L
	on l.idlocalidad = d.localidad

INNER JOIN dbo.provincias P
	on p.codafip = l.id_provincia
INNER JOIN dbo.partidos pp
	on pp.partido = l.id_partido

WHERE id_interna = @id_interna 
and d.datodebaja =0

ORDER BY Fecha_Comunicacion
' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_GET_Dotacion_Gestion_Publica]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_GET_Dotacion_Gestion_Publica]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'







-- =============================================
-- Author: Lucas
-- ALTER  date: 11/09/2009
-- Description:	Consulta De Dotación Para Gestión Publica
-- Utiliza Tabla_Temporal_Dotacion_Completa
--Utiliza StoreProcedure dbo.RH_GET_Dotacion_Completa_Parametro
-- =============================================
--exec [dbo].[RH_GET_Dotacion_Gestion_Publica]
CREATE        PROCEDURE [dbo].[RH_GET_Dotacion_Gestion_Publica]
AS
declare @algo int
begin

exec @algo=dbo.RH_GET_Dotacion_Completa_Parametro @Borrar_Tabla_Temporal=1


select dota.id_interna,
       dota.nro_documento,
       dat_pers.Tipo_Documento,
       dat_pers.Cuil_Nro,
       dat_pers.apellido,
       dat_pers.nombre,
       dat_pers.Sexo,
       dat_pers.Estado_Civil Id_Estado_Civil,
       dat_pers.Fecha_Nacimiento,
       dat_pers.Lugar_Nacimiento,
       dat_pers.Nacionalidad Id_Nacionalidad,
       domicilio.ID_Domicilio,
       domicilio.Fecha_Comunicacion fecha_comunicacion,
	domicilio.Calle calle,
 	domicilio.Número numero,
	domicilio.Dpto,
 	domicilio.piso,
	domicilio.Localidad,
 	domicilio.Provincia,
       dota.Id_Planta,
       dota.Id_Designacion_Planta,
        dota.id_area,
       dota.id_nivel,
        dota.id_grado,
        dota.Id_Contrato
  
from dbo.tabla_Temporal_Dotacion_Completa dota

INNER join 
	dbo.Datos_Personales dat_pers
	ON
	dat_pers.id_interna = dota.id_interna
inner join 
 	dbo.Domicilio_Personal	domicilio
 	on		
 	domicilio.Nro_Doc=dat_pers.nro_documento --dp2.Nro_Doc
	and domicilio.Fecha_Comunicacion = (select max(dp2.Fecha_Comunicacion) from Domicilio_Personal dp2 where dp2.Nro_Doc = domicilio.nro_doc and dp2.DatoDeBaja<>1  group by dp2.Nro_Doc  )
	and domicilio.ID_Domicilio = (select max(dp2.Id_Domicilio) from Domicilio_Personal dp2 where dp2.Nro_Doc = domicilio.nro_doc and dp2.DatoDeBaja<>1  group by dp2.Nro_Doc  )


 

end







' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Indice_Documentos]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Indice_Documentos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'





CREATE       PROCEDURE [dbo].[RPT_LEG_Indice_Documentos]  
 @id_interna int  
AS  
  
--DATOS PERSONALES  
--select id_interna,nro_documento,''MDS'' Jurisdiccion,''DGRHyORG'' Organizacion,''Datos Personales'' Tipo ,''00-000/000'' Foja,'''' Desde,''''Hasta  
--from datos_personales  
--where nro_documento = @legajo or id_interna = @id_interna_interna  
  
----UNION   
  
  
--Domicilio PERSONAL  
select ''MDS'' JUR,''DGRHyORG'' ORG,''Cert. de Domicilio'' TIPO,FOLIO, fecha_comunicacion desde,''01/01/1900'' hasta  
into #TMP_RPT_Domicilio  
FROM Domicilio_personal  
WHERE  id_interna = @id_interna   AND  
 DatoDeBaja = 0 AnD  
-- DatoNoImprime = 0 and   
 folio<> ''99-999/999''   
  
----UNION   
  
--FAMILARES  
--select id_interna, doc_titular, ''MDS'',''DGRHyORG'',''Familiar: ''+ p.descripcion,''00-000/000'','''','''' from datos_Familiares DF  
--inner join tabla_parentesco P  
-- on p.id = df.parentesco  
--where id_interna = @id_interna or doc_titular = @legajo  
  
--UNION   
  
  
--Domicilio FAMILIARES  
  
  
select ''MDS'' jur,''DGRHyORG'' org,''Cert. de Domicilio'' tipo,FOLIO,fechacomunicacion desde ,''01/01/1900'' hasta  
into #TMP_RPT_Domicilio_F  
FROM dbo.Domicilio_familiares D  
inner join datos_familiares DF  
 on d.id_interno = df.id_interna and d.id_fam = idfam  
WHERE d.id_interno = @id_interna   AND  
-- DatoDeBaja = 0 AnD  
-- DatoNoImprime = 0 and   
 folio <> ''99-999/999'' and folio not in (select folio from #TMP_RPT_domicilio)  
  
  
--UNION   
  
  
  
--DESIGNACIONES  
select jurisdiccion jur,organismo org,tr.descripcion +'' ''+ acto_nro tipo,folio,fecha_desde desde,fecha_hasta hasta  
into #TMP_RPT_Designaciones  
from designaciones D  
inner join tabla_tipos_resoluciones TR  
 on TR.id = d.acto_tipo  
where id_interna = @id_interna AND  
 DatoDeBaja = 0 AnD  
 DatoNoImprime = 0 and   
 folio <> ''99-999/999'' and folio not in (select folio from #TMP_RPT_domicilio union select folio from #TMP_RPT_domicilio_F)  
  
  
--UNION   
  
  
--CARRERA ADMINISTRATIVA  
select jurisdicción jur ,organismo org,tr.descripcion +'' '' + acto_nro tipo,folio,fecha_desde desde,fecha_hasta hasta  
into #TMP_RPT_Carrera  
from carrera_administrativa C  
inner join tabla_tipos_resoluciones TR  
 on TR.id = c.acto_tipo  
where id_interna = @id_interna AND  
 DatoDeBaja = 0 AnD  
 DatoNoImprime = 0 and   
 folio <> ''99-999/999'' and folio not in (select folio from #TMP_RPT_domicilio union select folio from #TMP_RPT_domicilio_F union select folio from #TMP_RPT_Designaciones)  
  
  
--UNION   
  
  
--FELICITACIONES  
  
select Fel.jurisdicción jur, FEL.ORGANISMO org,tr.descripcion +'' ''+ acto_nro tipo, FEL.FOLIO_NRO folio,FEL.FECHA desde ,FEL.FECHA hasta  
into #TMP_RPT_Felicitaciones  
FROM dbo.Datos_Personales  DP   
LEFT JOIN dbo.Felicitaciones Fel   
 ON DP.id_Interna = Fel.id_Interna   
inner join tabla_tipos_resoluciones TR  
 on TR.id = fel.acto_tipo  
WHERE DP.id_interna = @id_interna  AND  
 DatoDeBaja = 0 AnD  
 DatoNoImprime = 0 and   
 folio_nro <> ''99-999/999'' and folio_nro not in (select folio from #TMP_RPT_domicilio union select folio from #TMP_RPT_domicilio_F union select folio from #TMP_RPT_Designaciones union  Select folio from #TMP_RPT_Carrera)  
  
  
--EMBARGOS  
  
--UNION   
  
select ''MDS'' Jur ,''DGRHyORG'' org ,''Embargo'' tipo,folio,trabado_fecha desde,levantado_fecha hasta  
into #TMP_RPT_Embargos  
from embargos  
where id_interna = @id_interna  AND  
 DatoDeBaja = 0 AnD  
 DatoNoImprime = 0 and   
 folio <> ''99-999/999'' and folio not in (select folio from #TMP_RPT_domicilio union select folio from #TMP_RPT_domicilio_F union select folio from #TMP_RPT_Designaciones union  Select folio from #TMP_RPT_Carrera union select folio from #TMP_RPT_felicitaciones)  
  
  
--UNION   
  
  
--Estudiios realizados  
select ''MDS'' jur,''DGRHyORG'' org ,''Estudio nivel: ''+ NE.descripcion tipo ,folio_nro folio,fecha_ingreso desde,fecha_egreso hasta  
into #TMP_RPT_EstudiosR  
from estudios_realizados ER  
inner join tabla_nivel_estudios NE  
  on NE.id = er.nivel  
WHERE id_interna = @id_interna  AND  
 DatoDeBaja = 0 AnD  
 DatoNoImprime = 0 and   
 folio_nro <> ''99-999/999'' and folio_nro not in (select folio from #TMP_RPT_domicilio union select folio from #TMP_RPT_domicilio_F union select folio from #TMP_RPT_Designaciones union  Select folio from #TMP_RPT_Carrera union select folio from #TMP_RPT_felicitaciones union select folio from #TMP_RPT_embargos)  
  
  
--UNION   
  
  
--estudios_idiomas  
select  ''MDS'' jur,''DGRHyORG'' org,''Estudio : Idiomas'' tipo ,folio,''01/01/1900'' desde ,''01/01/1900'' hasta  
into #TMP_RPT_EstudiosI  
from estudios_Idiomas  
WHERE id_interna = @id_interna  AND  
 DatoDeBaja = 0 AnD  
 DatoNoImprime = 0 and   
 folio <> ''99-999/999'' and folio not in (select folio from #TMP_RPT_domicilio union select folio from #TMP_RPT_domicilio_F union select folio from #TMP_RPT_Designaciones union  Select folio from #TMP_RPT_Carrera union select folio from #TMP_RPT_felicitaciones union select folio from #TMP_RPT_embargos union select folio from #TMP_RPT_EstudiosR)  
  
--UNION   
  
  
  
--estudios_ESPECIALIDADES  
select ''MDS'' jur ,''DGRHyORG'' org,''Estudio : Especialidad'' tipo ,folio,''01/01/1900'' desde,''01/01/1900'' hasta  
into #TMP_RPT_EstudiosE  
from estudios_especilidades  
WHERE id_interna = @id_interna  AND  
 DatoDeBaja = 0 AnD  
 DatoNoImprime = 0 and   
 folio <> ''99-999/999'' and folio not in (select folio from #TMP_RPT_domicilio union select folio from #TMP_RPT_domicilio_F union select folio from #TMP_RPT_Designaciones union  Select folio from #TMP_RPT_Carrera union select folio from #TMP_RPT_felicitaciones union select folio from #TMP_RPT_embargos union select folio from #TMP_RPT_EstudiosR union select folio from #TMP_RPT_EstudiosI)  
  
--UNION   
  
  
  
--OTROS ESTUDIOS  
select ''MDS'' jur,''DGRHyORG'' org,''Estudio : Otros'' tipo ,folio_nro folio,fecha_Ingreso desde,fecha_egreso hasta  
into #TMP_RPT_EstudiosO  
from estudios_otros  
WHERE id_interna = @id_interna  AND  
 DatoDeBaja = 0 AnD  
 DatoNoImprime = 0 and   
 folio_nro <> ''99-999/999'' and folio_nro not in (select folio from #TMP_RPT_domicilio union select folio from #TMP_RPT_domicilio_F union select folio from #TMP_RPT_Designaciones union  Select folio from #TMP_RPT_Carrera union select folio from #TMP_RPT_felicitaciones union select folio from #TMP_RPT_embargos union select folio from #TMP_RPT_EstudiosR union select folio from #TMP_RPT_EstudiosI union select folio from #TMP_RPT_EstudiosE)  
  
--UNION   
  
  
--LICENCIAS  
  
select jurisdicción jur,organismo org,''Licencia'' tipo ,folio,fecha_inicio desde,Fecha_fin hasta  
into #TMP_RPT_Licencias  
from licencias  
where id_interna = @id_interna and   
 folio <> ''99-999/999'' and folio not in (select folio from #TMP_RPT_domicilio union select folio from #TMP_RPT_domicilio_F union select folio from #TMP_RPT_Designaciones union  Select folio from #TMP_RPT_Carrera union select folio from #TMP_RPT_felicitaciones union select folio from #TMP_RPT_embargos union select folio from #TMP_RPT_EstudiosR union select folio from #TMP_RPT_EstudiosI union select folio from #TMP_RPT_EstudiosE union select folio from #TMP_RPT_EstudiosO)  
  
  
  
  
  
--UNION   
  
  
--PASIVIDAD  
  
select ''MDS'' jur,''DGRHyORG'' org,''Pasividad'' tipo ,folio_nro folio,''01/01/1900'' desde,''01/01/1900'' hasta  
into #TMP_RPT_Pasividad  
from pasividad  
where  id_interna = @id_interna and   
 folio_nro <> ''99-999/999'' and folio_nro not in (select folio from #TMP_RPT_domicilio union select folio from #TMP_RPT_domicilio_F union select folio from #TMP_RPT_Designaciones union  Select folio from #TMP_RPT_Carrera union select folio from #TMP_RPT_felicitaciones union select folio from #TMP_RPT_embargos union select folio from #TMP_RPT_EstudiosR union select folio from #TMP_RPT_EstudiosI union select folio from #TMP_RPT_EstudiosE union select folio from #TMP_RPT_EstudiosO union select folio from #TMP_RPT_Licencias)  
  
--UNION   
  
  
  
--CAPACITACION  
  
select jurisdicción jur,organismo org,''Capacitación'' tipo,folio_nro folio,fecha_desde desde,fecha_hasta hasta  
into #TMP_RPT_Capacitacion  
from capacitacion  
where id_interna = @id_interna  AND  
 DatoDeBaja = 0 AnD  
 DatoNoImprime = 0 and   
 folio_nro <> ''99-999/999'' and folio_nro not in (select folio from #TMP_RPT_domicilio union select folio from #TMP_RPT_domicilio_F union select folio from #TMP_RPT_Designaciones union  Select folio from #TMP_RPT_Carrera union select folio from #TMP_RPT_felicitaciones union select folio from #TMP_RPT_embargos union select folio from #TMP_RPT_EstudiosR union select folio from #TMP_RPT_EstudiosI union select folio from #TMP_RPT_EstudiosE union select folio from #TMP_RPT_EstudiosO union select folio from #TMP_RPT_Licencias union select folio from #TMP_RPT_Pasividad)  
  
  
--UNION   
  
  
  
--CALIFICACIONES  
select jurisdiccion jur,organismo org,''Calificaciones'' tipo,folio,fecha_desde desde, fecha_hasta hasta  
into #TMP_RPT_Calificaciones    
from calificaciones  
where id_interna = @id_interna  AND  
 DatoDeBaja = 0 AnD  
 DatoNoImprime = 0 and   
 folio <> ''99-999/999'' and folio not in (select folio from #TMP_RPT_domicilio union select folio from #TMP_RPT_domicilio_F union select folio from #TMP_RPT_Designaciones union  Select folio from #TMP_RPT_Carrera union select folio from #TMP_RPT_felicitaciones union select folio from #TMP_RPT_embargos union select folio from #TMP_RPT_EstudiosR union select folio from #TMP_RPT_EstudiosI union select folio from #TMP_RPT_EstudiosE union select folio from #TMP_RPT_EstudiosO union select folio from #TMP_RPT_Licencias union select folio from #TMP_RPT_Pasividad union select folio from #TMP_RPT_Capacitacion)    
--UNION   
  
  
  
--ANTECEDENTES MILITARES  
  
select ''MDS'' Jur,''DGRHyORG'' Org,''Ant. Militar'' tipo ,''00-000/999'' folio ,''01/01/1900'' desde,''01/01/1900'' hasta  
into #TMP_RPT_Antecedentes  
from dbo.antec_militares  
where id_interna = @id_interna  
  
  
--UNION  
  
-- OTROS SERVICIOS  
  
select ''MDS'' jur,''DGRHyORG'' org,''Otros Cert. de Trabajo'' tipo ,folio,fecha_desde desde,fecha_hasta hasta  
into #TMP_RPT_OServicios  
--from dbo.otros_servicios  
from dbo.leg_otros_servicios  
where id_interna = @id_interna  AND  
 DatoDeBaja = 0 AnD  
 DatoNoImprime = 0 and   
 folio <> ''99-999/999'' and folio not in (select folio from #TMP_RPT_domicilio union select folio from #TMP_RPT_domicilio_F union select folio from #TMP_RPT_Designaciones union  Select folio from #TMP_RPT_Carrera union select folio from #TMP_RPT_felicitaciones union select folio from #TMP_RPT_embargos union select folio from #TMP_RPT_EstudiosR union select folio from #TMP_RPT_EstudiosI union select folio from #TMP_RPT_EstudiosE union select folio from #TMP_RPT_EstudiosO union select folio from #TMP_RPT_Licencias union select folio from #TMP_RPT_Pasividad union select folio from #TMP_RPT_Capacitacion union select folio from #TMP_RPT_calificaciones)    
  
  
--UNION  
  
  
-- SERVICIOS ADM PUBLICA  
select jurisdiccion jur,organismo org, case when ctr_cert = 0 then ''Contrato'' else ''Cert. de Servicio'' end tipo,folio,fecha_desde desde,fecha_hasta hasta  
into #TMP_RPT_APublica  
--from dbo.servicios_adm_publica  
from dbo.leg_servicios_adm_publica  
where id_interna = @id_interna  AND  
 DatoDeBaja = 0 AnD  
 DatoNoImprime = 0 and   
 folio <> ''99-999/999'' and folio not in (select folio from #TMP_RPT_domicilio union select folio from #TMP_RPT_domicilio_F union select folio from #TMP_RPT_Designaciones union  Select folio from #TMP_RPT_Carrera union select folio from #TMP_RPT_felicitaciones union select folio from #TMP_RPT_embargos union select folio from #TMP_RPT_EstudiosR union select folio from #TMP_RPT_EstudiosI union select folio from #TMP_RPT_EstudiosE union select folio from #TMP_RPT_EstudiosO union select folio from #TMP_RPT_Licencias union select folio from #TMP_RPT_Pasividad union select folio from #TMP_RPT_Capacitacion union select folio from #TMP_RPT_calificaciones union select folio from #TMP_RPT_OServicios)  
  
  
--UNION  
  
  
  
--OTROS DOC AGREGADOS  
select Jurisdicción jur,Organismo org,Tipo,Foja folio,Fecha_Agregado desde,Des_Fecha hasta, Agr_Intervino Intervino, Des_Intervino Desglose into #TMP_RPT_ODocs  
from  dbo.Otros_Indice_Documentos  
where id_interna = @id_interna  AND  
 DatoDeBaja = 0 AnD  
 DatoNoImprime = 0 and   
 foja <> ''99-999/999'' and foja not in (select folio from #TMP_RPT_domicilio union select folio from #TMP_RPT_domicilio_F union select folio from #TMP_RPT_Designaciones union  Select folio from #TMP_RPT_Carrera union select folio from #TMP_RPT_felicitaciones union select folio from #TMP_RPT_embargos union select folio from #TMP_RPT_EstudiosR union select folio from #TMP_RPT_EstudiosI union select folio from #TMP_RPT_EstudiosE union select folio from #TMP_RPT_EstudiosO union select folio from #TMP_RPT_Licencias union select folio from #TMP_RPT_Pasividad union select folio from #TMP_RPT_Capacitacion union select folio from #TMP_RPT_calificaciones union select folio from #TMP_RPT_OServicios union select folio from #TMP_RPT_APublica)  
  
  
--UNION  
  
  
--PSICOFISICOS  
  
select Jurisdiccion jur,Organismo org, ''Cert. Psicofisico'' tipo,Folio_nro folio,Fecha desde,''01/01/1900'' hasta   
into #TMP_RPT_Psico  
from  dbo.Psicofisico  
where id_interna = @id_interna  AND  
 DatoDeBaja = 0 AnD  
 DatoNoImprime = 0 and   
 folio_nro <> ''99-999/999'' and folio_nro not in (select folio from #TMP_RPT_domicilio union select folio from #TMP_RPT_domicilio_F union select folio from #TMP_RPT_Designaciones union  Select folio from #TMP_RPT_Carrera union select folio from #TMP_RPT_felicitaciones union select folio from #TMP_RPT_embargos union select folio from #TMP_RPT_EstudiosR union select folio from #TMP_RPT_EstudiosI union select folio from #TMP_RPT_EstudiosE union select folio from #TMP_RPT_EstudiosO union select folio from #TMP_RPT_Licencias union select folio from #TMP_RPT_Pasividad union select folio from #TMP_RPT_Capacitacion union select folio from #TMP_RPT_calificaciones union select folio from #TMP_RPT_OServicios union select folio from #TMP_RPT_APublica union select folio from #TMP_RPT_ODocs)  
 order by folio_nro  
  
  
--UNION   
  
--OTROS DATOS  
select id_interna,doc_titular,jurisdiccion jur,organismo org,left (detalle,65) tipo,folio, fecha desde,fecha hasta  
into #TMP_RPT_Otros_Datos  
from dbo.otros_datos  
where id_interna = @id_interna  AND  
 DatoDeBaja = 0 AnD  
 DatoNoImprime = 0 and   
 folio <> ''99-999/999'' and folio not in (select folio from #TMP_RPT_domicilio union select folio from #TMP_RPT_domicilio_F union select folio from #TMP_RPT_Designaciones union  Select folio from #TMP_RPT_Carrera union select folio from #TMP_RPT_felicitaciones union select folio from #TMP_RPT_embargos union select folio from #TMP_RPT_EstudiosR union select folio from #TMP_RPT_EstudiosI union select folio from #TMP_RPT_EstudiosE union select folio from #TMP_RPT_EstudiosO union select folio from #TMP_RPT_Licencias union select folio from #TMP_RPT_Pasividad union select folio from #TMP_RPT_Capacitacion union select folio from #TMP_RPT_calificaciones union select folio from #TMP_RPT_OServicios union select folio from #TMP_RPT_APublica union select folio from #TMP_RPT_ODocs union select folio from #TMP_RPT_Psico)  
 order by folio  
  
-- DDJJ de CARGOS

--select ''MDS'' Jur,''DGRHyORG'' Org,''DDJJ Cargo Año:'' + rtrim(cast(año as char)) tipo , folio ,FechaRecepciono desde,''01/01/1900'' hasta  
--into #TMP_RPT_DDJJ_Cargos
--from dbo.LEG_DDJJ_Cargos DD
--INNER JOIN dbo.Datos_Personales DP
--	ON DP.Id_Interna = @Id_Interna AND
--	DD.Nro_Documento = dp.Nro_Documento
--Where folio <> ''99-999/999'' and folio not in (select folio from #TMP_RPT_domicilio union select folio from #TMP_RPT_domicilio_F union select folio from #TMP_RPT_Designaciones union  Select folio from #TMP_RPT_Carrera union select folio from #TMP_RPT_felicitaciones union select folio from #TMP_RPT_embargos union select folio from #TMP_RPT_EstudiosR union select folio from #TMP_RPT_EstudiosI union select folio from #TMP_RPT_EstudiosE union select folio from #TMP_RPT_EstudiosO union select folio from #TMP_RPT_Licencias union select folio from #TMP_RPT_Pasividad union select folio from #TMP_RPT_Capacitacion union select folio from #TMP_RPT_calificaciones union select folio from #TMP_RPT_OServicios union select folio from #TMP_RPT_APublica union select folio from #TMP_RPT_ODocs union select folio from #TMP_RPT_Psico union select folio from #TMP_RPT_Otros_Datos)  
--order by folio

--Version Modificada DDJJ de Cargos
select ''MDS'' Jur,''DGRHyORG'' Org,(select AA.Descripcion from dbo.Tabla_Comprobante_Descripcion  AA where AA.ID = Dc.Id_Comprobante ) + cast(año as varchar) tipo ,folio ,FechaRecepciono desde,''01/01/1900'' hasta  
into #TMP_RPT_DDJJ_Cargos
FROM dbo.LEG_DDJJ_Cargos Dc  
INNER JOIN dbo.Datos_Personales dp  
 on dp.Nro_documento = dc.Nro_documento AND  
 dp.id_interna = @Id_Interna  
where folio <> ''99-999/999'' and folio not in (select folio from #TMP_RPT_domicilio union select folio from #TMP_RPT_domicilio_F union select folio from #TMP_RPT_Designaciones union  Select folio from #TMP_RPT_Carrera union select folio from #TMP_RPT_felicitaciones union select folio from #TMP_RPT_embargos union select folio from #TMP_RPT_EstudiosR union select folio from #TMP_RPT_EstudiosI union select folio from #TMP_RPT_EstudiosE union select folio from #TMP_RPT_EstudiosO union select folio from #TMP_RPT_Licencias union select folio from #TMP_RPT_Pasividad union select folio from #TMP_RPT_Capacitacion union select folio from #TMP_RPT_calificaciones union select folio from #TMP_RPT_OServicios union select folio from #TMP_RPT_APublica union select folio from #TMP_RPT_ODocs union select folio from #TMP_RPT_Psico union select folio from #TMP_RPT_Otros_Datos)    
order by folio  



  
  
delete from tmp_rpt_indice_Documentos  
where id_interna = @id_interna  
  
insert into  dbo.TMP_RPT_Indice_Documentos  
select    @id_interna Id_interna, JUR ,ORG ,TIPO , FOLIO , desde , hasta ,  case when convert(char(10),desde,103) = ''01/01/1900'' then '''' else convert(char(10),desde,103)  end  Desde2 , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else '''' end  Hasta2 , '''',''''  
from #TMP_RPT_domicilio   
union   
select  @id_interna Id_interna, JUR ,ORG ,TIPO , FOLIO , desde , hasta ,  case when convert(char(10),desde,103) = ''01/01/1900'' then '''' else convert(char(10),desde,103)  end  Desde2  , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else ''''  end  Hasta2,'''','''' from #TMP_RPT_domicilio_F   
union   
select   @id_interna Id_interna,JUR ,ORG ,TIPO , FOLIO , desde , hasta ,  case when convert(char(10),desde,103) = ''01/01/1900'' then '''' else convert(char(10),desde,103)  end  Desde2  , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else ''''  end  Hasta2,'''','''' from #TMP_RPT_Designaciones   
union   
select @id_interna Id_interna,   JUR ,ORG ,TIPO , FOLIO , desde , hasta ,  case when convert(varchar(10),desde,103) =''01/01/1900'' then '''' else convert(char(10),desde,103)   end  Desde2  , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else ''''  end  Hasta2,'''','''' from #TMP_RPT_Carrera   
union   
select @id_interna Id_interna,    JUR ,ORG ,TIPO , FOLIO , desde , hasta ,  case when convert(varchar(10),desde,103) =''01/01/1900'' then '''' else convert(char(10),desde,103)   end  Desde2  , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else ''''  end  Hasta2,'''','''' from #TMP_RPT_felicitaciones   
union   
select @id_interna Id_interna,    JUR ,ORG ,TIPO , FOLIO , desde , hasta ,  case when convert(varchar(10),desde,103) =''01/01/1900'' then '''' else convert(char(10),desde,103)   end  Desde2  , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else ''''  end  Hasta2,'''','''' from #TMP_RPT_embargos   
union   
select @id_interna Id_interna,    JUR ,ORG ,TIPO , FOLIO , desde , hasta , case when convert(varchar(10),desde,103) =''01/01/1900'' then '''' else convert(char(10),desde,103)   end  Desde2  , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else ''''  end  Hasta2,'''','''' from #TMP_RPT_EstudiosR   
union   
select @id_interna Id_interna,    JUR ,ORG ,TIPO , FOLIO , desde , hasta , case when convert(varchar(10),desde,103) =''01/01/1900'' then '''' else convert(char(10),desde,103)   end  Desde2  , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else ''''  end  Hasta2,'''','''' from #TMP_RPT_EstudiosI   
union   
select @id_interna Id_interna,    JUR ,ORG ,TIPO , FOLIO , desde , hasta ,   case when convert(varchar(10),desde,103) =''01/01/1900'' then '''' else convert(char(10),desde,103) end  Desde2 , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else ''''  end  Hasta2 ,'''','''' from #TMP_RPT_EstudiosE   
union   
select @id_interna Id_interna,    JUR ,ORG ,TIPO , FOLIO , desde , hasta ,   case when convert(varchar(10),desde,103) =''01/01/1900'' then '''' else convert(char(10),desde,103)  end  Desde2  , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else ''''  end  Hasta2,'''','''' from #TMP_RPT_EstudiosO   
union   
select @id_interna Id_interna,    JUR ,ORG ,TIPO , FOLIO , desde , hasta ,  case when convert(varchar(10),desde,103) =''01/01/1900'' then '''' else convert(char(10),desde,103)   end  Desde2  , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else ''''  end  Hasta2,'''','''' from #TMP_RPT_Licencias   
union   
select @id_interna Id_interna,    JUR ,ORG ,TIPO , FOLIO , desde , hasta ,    case when convert(varchar(10),desde,103) =''01/01/1900'' then '''' else convert(char(10),desde,103)   end  Desde2   , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else ''''  end  Hasta2,'''','''' from #TMP_RPT_Pasividad   
union   
select @id_interna Id_interna,    JUR ,ORG ,TIPO , FOLIO , desde , hasta ,    case when convert(varchar(10),desde,103) =''01/01/1900'' then '''' else convert(char(10),desde,103)   end  Desde2  , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else ''''  end  Hasta2,'''','''' from #TMP_RPT_Capacitacion   
union   
select @id_interna Id_interna,    JUR ,ORG ,TIPO , FOLIO , desde , hasta ,    case when convert(varchar(10),desde,103) =''01/01/1900'' then '''' else convert(char(10),desde,103)   end  Desde2  , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else ''''  end  Hasta2,'''','''' from #TMP_RPT_calificaciones   
union   
select @id_interna Id_interna,    JUR ,ORG ,TIPO , FOLIO , desde , hasta ,    case when convert(varchar(10),desde,103) =''01/01/1900'' then '''' else convert(char(10),desde,103)   end  Desde2  , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else ''''  end  Hasta2,'''','''' from #TMP_RPT_OServicios   
union   
select @id_interna Id_interna,    JUR ,ORG ,TIPO , FOLIO , desde , hasta ,    case when convert(varchar(10),desde,103) =''01/01/1900'' then '''' else convert(char(10),desde,103)  end  Desde2  , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else ''''  end  Hasta2,'''','''' from #TMP_RPT_APublica   
union   
select @id_interna Id_interna,    JUR ,ORG ,TIPO , FOLIO , desde , hasta ,    case when convert(varchar(10),desde,103) =''01/01/1900'' then '''' else convert(char(10),desde,103) end  Desde2  , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else convert(char(10),Hasta,103)  end  Hasta2,Intervino, Desglose from #TMP_RPT_ODocs  
union  
select @id_interna Id_interna,    JUR ,ORG ,TIPO , FOLIO , desde , hasta ,  case when convert(varchar(10),desde,103) =''01/01/1900'' then '''' else convert(char(10),desde,103) end  Desde2  , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else ''''  end  Hasta2,'''','''' from #TMP_RPT_Psico  
UNION   
select @id_interna Id_interna,    JUR ,ORG ,TIPO , FOLIO , desde , hasta ,  case when convert(varchar(10),desde,103) =''01/01/1900'' then '''' else convert(char(10),desde,103) end  Desde2  , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else ''''  end  Hasta2,'''','''' from #TMP_RPT_Otros_Datos  
  
UNION   
select @id_interna Id_interna,    JUR ,ORG ,TIPO , FOLIO , desde , hasta ,  case when convert(varchar(10),desde,103) =''01/01/1900'' then '''' else convert(char(10),desde,103) end  Desde2  , case when convert(char(10),Hasta,103) = ''01/01/1900'' then '''' else ''''  end  Hasta2,'''','''' from #TMP_RPT_DDJJ_Cargos

  
order by folio  
  
  
  
  
  
drop table  #TMP_RPT_domicilio   
drop table  #TMP_RPT_domicilio_F   
drop table  #TMP_RPT_Designaciones   
drop table  #TMP_RPT_Carrera   
drop table  #TMP_RPT_felicitaciones   
drop table  #TMP_RPT_embargos   
drop table  #TMP_RPT_EstudiosR   
drop table  #TMP_RPT_EstudiosI   
drop table  #TMP_RPT_EstudiosE   
drop table  #TMP_RPT_EstudiosO   
drop table  #TMP_RPT_Licencias   
drop table  #TMP_RPT_Pasividad   
drop table  #TMP_RPT_Capacitacion   
drop table  #TMP_RPT_calificaciones   
drop table  #TMP_RPT_antecedentes   
drop table  #TMP_RPT_OServicios   
drop table  #TMP_RPT_APublica   
drop table  #TMP_RPT_ODocs  
drop table  #TMP_RPT_Psico  
drop table  #TMP_RPT_Otros_Datos  
drop table  #TMP_RPT_DDJJ_Cargos
  
  
  
  
  
  
  
  
  
  
  
  
  







' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_DDJJ_Cargos]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_DDJJ_Cargos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE  PROCEDURE [dbo].[RPT_LEG_DDJJ_Cargos]  
    @Documento [int]  
AS   
select   
  
isnull(TDOC.descripcion,'''') Tipo_Documento,   
isnull(dp.Nro_Documento,'''')Nro_Documento,  
isnull(DM.descripcion,'''') Distrito_Militar ,  
isnull(dp.Clase, '''') Clase ,  
isnull(dp.Cedula_Identidad ,'''')Cedula_Identidad,  
isnull(dp.Expedida_por,'''')Expedida_por,  
dp.apellido,  
dp.nombre,  
convert(char(10),dp.fecha_Nacimiento,103) Fecha_Nacimiento,  
domp.calle,  
domp.número,  
ISNULL(Piso,'''')Piso,  
ISNULL(dpto,'''') dpto,  
ISNULL(casa,'''')casa,  
ISNULL(manzana,'''')manzana,  
ISNULL(UF,'''') Uf,  
codigo_postal,  
LOC.NombreLocalidad Localidad,  
PAR.Descripcion Partido,  
PROV.NombreProvincia Provincia  
  
from  [dbo].Datos_Personales  DP  
left join [dbo].Tabla_DocIdentidad TDOC  
 on TDOC.id = dp.tipo_documento  
left join [dbo].Tabla_DistritosMilitares DM  
 on DM.id = DP.Distrito_Militar   
LEFT JOIN dbo.Domicilio_Personal DomP  
 ON DomP.Nro_Doc = DP.Nro_Documento AND  
	Id_Domicilio = (select top 1 id_domicilio From dbo.Domicilio_Personal 
			Where Nro_Doc = @Documento and DatoDeBaja = 0
			order by convert(char,fecha_comunicacion,112) desc )
--    Id_Domicilio = (select max(Id_Domicilio) From dbo.Domicilio_Personal Where Nro_Doc = DP.Nro_Documento and DatoDeBaja = 0)  
	
LEFT JOIN dbo.LocalidadesAfip LOC  
 on LOC.IdLocalidad = DomP.Localidad  
LEFT JOIN dbo.Partidos PAR  
 on PAR.Partido  = LOC.Id_Partido  
LEFT JOIN dbo.Provincias PROV  
 on PROV.CodAfip = LOC.Id_Provincia  
where Nro_Documento = @Documento  
  
  
  
  
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Indice_Documentos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Indice_Documentos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE       PROCEDURE [dbo].[LEG_GET_Indice_Documentos] -- VB: CREO QUE SE ELIMINO      
 @id [int],      
 @legajo [int]      
AS
--Domicilio PERSONAL      
SELECT ID_INTERNA,NRO_DOC,''MDS'' JUR,''DGRHyORG'' ORG,''Cert. de Domicilio'' TIPO,Folio FOLIO,fecha_comunicacion,'''' Fecha_Hasta      
FROM Domicilio_personal      
WHERE id_interna = @id  and folio<> ''99-999/999''  and datodebaja =0      
      
      
UNION       
      
--Domicilio FAMILIARES      
      
SELECT d.ID_INTERNo,d.DOC_titular,''MDS'',''DGRHyORG'',''Cert. de Domicilio'',FOLIO,fechacomunicacion,''''      
FROM dbo.Domicilio_familiares D      
inner join datos_familiares DF      
 on d.id_interno = df.id_interna and d.id_fam = idfam      
WHERE d.id_interno = @id  and folio <> ''99-999/999''      
      
UNION       
      
--DESIGNACIONES      
select id_interna,nro_doc,jurisdiccion,organismo,tr.descripcion +'' ''+ acto_nro Documento,folio,fecha_desde,fecha_hasta from designaciones D      
inner join tabla_tipos_resoluciones TR      
 on TR.id = d.acto_tipo      
where (id_interna = @id or nro_doc = @legajo)      
and folio <> ''99-999/999'' and datodebaja = 0      
      
      
union       
      
--CARRERA ADMINISTRATIVA      
select id_interna,doc_tit,jurisdicción,organismo,tr.descripcion +'' '' + acto_nro,folio,fecha_desde,fecha_hasta from carrera_administrativa C      
inner join tabla_tipos_resoluciones TR      
 on TR.id = c.acto_tipo      
where (id_interna = @id or doc_tit = @legajo)      
and folio <> ''99-999/999'' and datodebaja = 0      
      
      
UNION       
      
--FELICITACIONES      
      
SELECT DP.ID_INTERNA,DP.NRO_DOCUMENTO,Fel.jurisdicción, FEL.ORGANISMO,tr.descripcion +'' ''+ acto_nro, FEL.FOLIO_NRO,FEL.FECHA,FEL.FECHA      
FROM dbo.Datos_Personales  DP       
LEFT JOIN dbo.Felicitaciones Fel       
 ON DP.id_Interna = Fel.id_Interna       
inner join tabla_tipos_resoluciones TR      
 on TR.id = fel.acto_tipo      
WHERE (Nro_Documento = @Legajo or DP.id_interna = @id )      
and folio_nro <> ''99-999/999'' and datodebaja = 0      
      
      
--EMBARGOS      
      
union       
      
select id_interna, legajo, ''MDS'',''DGRHyORG'',''Embargo'',folio,trabado_fecha,levantado_fecha      
from embargos      
where (id_interna = @id)      
and folio <> ''99-999/999'' and datodebaja = 0      
      
      
union       
      
--Estudiios realizados      
select id_interna,nro_doc, ''MDS'',''DGRHyORG'',''Estudio nivel: ''+ NE.descripcion,folio_nro,fecha_ingreso,fecha_egreso      
from estudios_realizados ER      
inner join tabla_nivel_estudios NE      
  on NE.id = er.nivel      
WHERE (Nro_Doc = @Legajo or id_interna = @id)      
and ER.folio_nro <> ''99-999/999'' and datodebaja = 0      
      
      
UNION       
      
--estudios_idiomas      
select id_interna,nro_doc, ''MDS'',''DGRHyORG'',''Estudio : Idiomas'',folio,'''',''''      
from estudios_Idiomas      
WHERE (Nro_Doc = @Legajo or id_interna = @id )      
and folio <> ''99-999/999'' and datodebaja = 0      
      
UNION       
      
--estudios_ESPECIALIDADES      
select id_interna,doc_tit, ''MDS'',''DGRHyORG'',''Estudio : Especialidad'',folio,'''',''''      
from estudios_especilidades      
WHERE (Doc_tit = @Legajo or id_interna = @id )      
and folio <> ''99-999/999'' and datodebaja = 0      
      
      
UNION       
      
--OTROS ESTUDIOS      
select id_interna,nro_doc, ''MDS'',''DGRHyORG'',''Estudio : Otros'',folio_nro,fecha_Ingreso,fecha_egreso      
from estudios_otros      
WHERE (nro_Doc = @Legajo or id_interna = @id )      
and folio_nro <> ''99-999/999'' and datodebaja = 0      
      
      
union       
      
--LICENCIAS      
      
select id_interna,legajo, jurisdicción,organismo,''Licencia'',folio,fecha_inicio,Fecha_fin      
from licencias      
where (id_interna = @id)      
and folio <> ''99-999/999'' and datodebaja = 0      
      
      
union       
      
--PASIVIDAD      
      
select id_interna,nro_doc,''MDS'',''DGRHyORG'',''Pasividad'',folio_nro,'''',''''      
from pasividad      
where id_interna = @id      
and folio_nro <> ''99-999/999''       
union       
      
--CAPACITACION      
      
select id_interna,doc_titular,jurisdicción,organismo,''Capacitación'',folio_nro,fecha_desde,fecha_hasta      
from capacitacion      
where id_interna = @id      
and folio_nro <> ''99-999/999'' and datodebaja = 0      
      
      
union       
      
--CALIFICACIONES      
select id_interna,doc_titular,jurisdiccion,organismo,''Calificaciones'',folio,fecha_desde, fecha_hasta      
from calificaciones      
where id_interna = @id      
and folio <> ''99-999/999'' and datodebaja = 0      
      
union       
      
--ANTECEDENTES MILITARES      
      
select id_interna,legajo,''MDS'',''DGRHyORG'',''Ant. Militar'',''00-000/000'','''',''''      
from dbo.antec_militares      
where id_interna = @id       
      
      
union      
      
-- OTROS SERVICIOS      
      
select id_interna,0,''MDS'',''DGRHyORG'',''Otros Cert. de Trabajo'',folio,fecha_desde,fecha_hasta      
from dbo.leg_otros_servicios      
where id_interna = @id      
and folio <> ''99-999/999'' and datodebaja = 0      
      
      
      
UNION      
      
-- SERVICIOS ADM PUBLICA      
select id_interna,doc_titular,jurisdiccion,organismo,''Cert. de Trabajo'',folio,fecha_desde,fecha_hasta      
from dbo.LEG_Servicios_adm_publica      
where id_interna = @id      
and folio <> ''99-999/999'' and datodebaja = 0      
      
      
union      
      
--OTROS DOC AGREGADOS      
select id_interna,legajo,Jurisdicción,Organismo,Tipo,Foja,Fecha_Agregado,''''      
from  dbo.Otros_Indice_Documentos      
where id_interna = @id      
and foja <> ''99-999/999'' and datodebaja = 0      
      
      
union      
      
--PSICOFISICOS      
      
select id_interna,0,Jurisdiccion,Organismo,''Cert. Psicofisico'',Folio_nro,Fecha,''''      
      
from  dbo.Psicofisico      
where id_interna = @id      
and Folio_Nro <> ''99-999/999'' and datodebaja = 0      
      
    
  
union      
      
--OTROS DOCUMENTOS
      
select id_interna,0,Jurisdiccion,Organismo,motivo,Folio,Fecha,''''      
from  dbo.Otros_Datos  
where id_interna = @id      
and Folio <> ''99-999/999'' and datodebaja = 0      
  
--faml 26_feb_2010    

union      
      
--SITUACIONES ESPECIALES DE REVISTA
      
select id_interna,0,Jurisdicción,Organismo,motivo,Folio_Nro,Fecha_Desde,Fecha_Hasta      
from  dbo.Situaciones_Especiales 
where id_interna = @id      
and Folio_Nro <> ''99-999/999'' and datodebaja = 0    

--faml 26_feb_2010
      
union  
  
--select 0,dp.nro_documento,''MDS'',''MDS'',''DDJJ Cargos Año: '' + cast(año as varchar),folio,fecharecepciono,''''  
--FROM dbo.LEG_DDJJ_Cargos Dc  
--INNER JOIN dbo.Datos_Personales dp  
-- on dp.Nro_documento = dc.Nro_documento AND  
-- dp.id_interna = @Id  
--where folio <> ''99-999/999''  
--order by folio  
  
select 0,dp.nro_documento,''MDS'',''MDS'',(select AA.Descripcion from dbo.Tabla_Comprobante_Descripcion  AA where AA.ID = Dc.Id_Comprobante ) + cast(año as varchar),folio,fecharecepciono,''''  
FROM dbo.LEG_DDJJ_Cargos Dc  
INNER JOIN dbo.Datos_Personales dp  
 on dp.Nro_documento = dc.Nro_documento AND  
 dp.id_interna = @Id  
where folio <> ''99-999/999''  
order by folio
' 
END
GO
/****** Object:  StoredProcedure [dbo].[Alta_DomicilioPersonal]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Alta_DomicilioPersonal]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[Alta_DomicilioPersonal]          
 (@Fecha_Comunicacion  [Datetime],          
  @Calle  [varchar](50),          
  @Número  [smallint],          
  @Piso  [varchar](50),          
  @Dpto  [varchar](50),          
  @Casa  [varchar](10),          
  @Manzana  [varchar](10),          
  @Barrio  [varchar](20),          
  @Torre  [varchar](10),          
  @UF  [varchar](10),          
  @Localidad  [varchar](50),          
  @Codigo_Postal  [varchar](50),          
  @Partido_Dpto  [varchar](50),          
  @Provincia  [varchar](50),          
  @Telefono [varchar](20),          
  @Correo_Electronico [varchar](50),          
  @Folio  [char](10),          
  @Id_Interna [int],          
  @Nro_Doc [int] ,    
--  @Id_Domicilio  [int])          
  @Baja bit,        
  @usuario int =null,    
  @Correo_Electronico_mds [varchar](50) = null,    
  @Telefono2 [varchar](50) = null)    
AS           
          
Declare  @Id_Domicilio [int]          
set  @Id_Domicilio = (select max(id_domicilio)+1 from dbo.domicilio_personal)            
if @id_domicilio is null begin          
 set @id_domicilio =1          
end          
          
--GPR 06-03-07          
--Tiraba error al ingresar la provincia. Guardaba la Descrip.          
--Se agrega para cambiar a Id          
/*declare @id_prov int          
set @id_prov= (select idprovincia from dbo.Provincias          
where nombreprovincia=@Provincia)*/      
--          
      
--GPR 19-06-07          
--Tiraba error al ingresar la provincia. Guardaba la Descrip.          
--Se agrega para cambiar a Id          
declare @id_prov int              
set @id_prov= (select codafip from dbo.Provincias              
where nombreProvincia = @Provincia)              
          
      
INSERT INTO [dbo].[Domicilio_Personal]           
  ([Fecha_Comunicacion],          
  [Calle],          
  [Número],          
  [Piso],          
  [Dpto],          
  [Casa],          
  [Manzana],          
  [Barrio],          
  [Torre],          
  [UF],          
  [Localidad],          
  [Codigo_Postal],          
  [Partido_Dpto],          
  [Provincia],          
  [Telefono],          
  [Correo_Electronico],          
  [Folio],          
  [Id_Interna],          
  [Nro_Doc],          
  [Id_Domicilio],          
  [DatoDeBaja],        
  usuario,    
  Correo_Electronico_MDS,  
  Telefono2  
 )           
           
VALUES           
 (@Fecha_Comunicacion,          
  @Calle,          
  @Número,          
  @Piso,          
  @Dpto,          
  @Casa,          
  @Manzana,          
  @Barrio,          
  @Torre,          
  @UF,          
  @Localidad,          
  @Codigo_Postal,          
  @Partido_Dpto,          
  @id_prov,          
  @Telefono,          
  @Correo_Electronico,          
  @Folio,          
  @Id_Interna,          
  @Nro_Doc,          
  @Id_Domicilio,          
  @baja,        
  @usuario,    
  @Correo_Electronico_mds,    
  @Telefono2)          
          
        ' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_Impresion_DDJJ]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Impresion_DDJJ]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CTR_Impresion_DDJJ]          
 @Documento int          
AS
SELECT  Apellido +'', ''+ nombre Apellido,          
 TDI.Descripcion TipoDoc,          
 DP.Nro_Documento NroDoc,          
 left(DP.CUIL_Nro,2) +''-''+ right(left(DP.CUIL_Nro,10),8) +''-''+ right(DP.CUIL_Nro,1) CUIL,  
 Getdate() Fecha,          
 TTC.SendLegajos,  --MODALIDAD,          
  Nro_Contrato,      
 -- comentado por FABIAN para renovar INAI XX left(tae.codigo,4) codigo,  
''0101'' codigo,
c.id_contrato,

rtrim(dom.Calle) Calle,
rtrim(dom.Número) nro,
rtrim(dom.Piso) +'' - ''+ rtrim(isnull(dom.Dpto,''-'')) piso,
--dom.Localidad,
--dom.Provincia,
case dom.Provincia 
	when 0 then nombrelocalidad
	else nombrelocalidad +'' (''+ nombreProvincia +'')''
end Localidad,

dom.Codigo_Postal
                      
FROM  dbo.Datos_Personales DP          
INNER JOIN dbo.Tabla_DocIdentidad TDI          
 on TDI.Id = DP.Tipo_Documento          
inner  JOIN dbo.CTR_Contratos C          
 on C.Nro_Documento = DP.Nro_Documento AND          
 C.Nro_Contrato = (SELECT MAX(Nro_Contrato) FROM dbo.CTR_Contratos WHERE Nro_Documento = @Documento)          
          
LEFT JOIN dbo.Tabla_Resoluciones_Contratos TC          
 on TC.id = C.tipo_contrato          
          
inner JOIN dbo.Tabla_Tipos_Contratos TTC          
 on TTC.Id = TC.Tipo_Contrato          
          
inner join Tabla_Areas_Estructura TAE        
 on TAE.id_area=c.id_area        
 and right(TAE.codigo,5)= convert(varchar(5),replicate(''0'', 5 - datalength(ltrim(rtrim(tae.id_area))))) + convert(varchar(5),tae.id_area)        
        
LEFT JOIN dbo.Domicilio_Personal dom
 on dom.Nro_Doc = dp.nro_documento
	AND  dom.ID_Domicilio = (select max(ID_Domicilio) from Domicilio_Personal where nro_doc = @Documento)

LEFT JOIN dbo.LocalidadesAFIP l
 on l.idLocalidad = dom.Localidad

LEFT JOIN dbo.Provincias p
 on p.codAFIP = dom.Provincia



WHERE DP.Nro_Documento = @Documento
' 
END
GO
/****** Object:  StoredProcedure [dbo].[LIQ_Exportar_Txt_Bco_GER]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_Exportar_Txt_Bco_GER]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[LIQ_Exportar_Txt_Bco_GER]
 @id int          
AS          
          
declare @fecha_min char(8)  
  
SELECT nb.nro_cta_empresa,          
 ----------------------        
 dp.apellido,          
 ----------------------        
  dp.nombre,          
 ----------------------        
  case when dp.tipo_documento=1 or dp.tipo_documento=2 or dp.tipo_documento=3 then           
   ''001''          
  else          
   case when dp.tipo_documento=4 then          
    ''004''          
   else          
    ''Corregir Tipo_Doc''          
   end          
  end Tipo_Doc,          
 ----------------------          
  dp.nro_documento,          
 ----------------------        
  case when dp.tipo_documento=1 or dp.tipo_documento=2 or dp.tipo_documento=3 then           
   ''00''          
  else          
   case when dp.tipo_documento=4 then          
    ''04''          
   else          
    ''Corregir Prov_doc''          
   end          
  end Prov_Doc,          
 ----------------------          
  case when dp.nacionalidad=1 then          
   ''A''          
   else          
   ''E''          
  end Nacionalidad,          
 ----------------------          
  right(convert(char(8),dp.fecha_nacimiento,112),2) + left(right(convert(char(8),dp.fecha_nacimiento,112),4),2) + left(convert(char(8),dp.fecha_nacimiento,112),4) fecha_nacimiento,          
   ----------------------        
  case when dp.sexo=1 then          
   ''M''          
   else          
   ''F''          
  end Sexo,          
 ----------------------        
 nc.Estado_Civil_Bco Estado_Civil,          
 ----------------------        
  dom.calle Calle,          
 ----------------------        
  dom.Número Nro,          
 ----------------------        
  dom.piso Piso,          
 ----------------------        
  dom.dpto,          
 ----------------------        
  l.nombrelocalidad Localidad,         
 ----------------------         
  dom.codigo_postal,           
  ----------------------          
  p.cod_bco Cod_Prov,          
 ----------------------           
  nc.tipo_cta,          
 ----------------------        
  ''008'' cia,          
 ----------------------        
  dp.cuil_nro,          
 ----------------------        
  nc.sueldo,            
 ----------------------        
  
case when right(convert(char(8),dbo.FxGet_Min_Desde(c.nro_documento),112),2) + left(right(convert(char(8),dbo.FxGet_Min_Desde(c.nro_documento),112),4),2) + left(convert(char(8),dbo.FxGet_Min_Desde(c.nro_documento),112),4) is null then  
  
 isnull ( right(convert(char(8),d.fecha_min,112),2) + left(right(convert(char(8),d.fecha_min,112),4),2) + left(convert(char(8),d.fecha_min,112),4) , getdate())  
   
else   
  
 right(convert(char(8),dbo.FxGet_Min_Desde(c.nro_documento),112),2) + left(right(convert(char(8),dbo.FxGet_Min_Desde(c.nro_documento),112),4),2) + left(convert(char(8),dbo.FxGet_Min_Desde(c.nro_documento),112),4)       
  
end Fecha_Ingreso,  
  
  
----------------------         
  nc.Id_Dom_Pago Cod_Dep,  --db.codigo_dependencia        
 ----------------------         
  db.codigo_postal CP_Dep,         
 ----------------------         
  db.id_area          
          
          
FROM datos_personales dp          
           
left join Domicilio_Personal Dom          
-- on dp.nro_documento=dom.nro_doc and id_domicilio = (select max(id_domicilio) from domicilio_personal where id_interna = dp.id_interna)          
 on dp.nro_documento=dom.nro_doc and id_domicilio = (select max(id_domicilio) from domicilio_personal where nro_doc = dp.nro_documento)          
          
inner join liq_nro_cuenta NC          
 on nc.documento=dp.nro_documento          
          
left join localidadesafip L          
 on L.idlocalidad=dom.localidad          
          
left join provincias p          
 on p.codafip=l.id_provincia and l.codigopostal=dom.codigo_postal          
      
----

left join ctr_contratos c        
 on c.nro_documento=dp.nro_documento and c.id_contrato=(select max(id_contrato) from CTR_Contratos where nro_documento=dp.nro_documento)      
      
left join dbo.vw_desglose_area da          
 on da.documento = dp.nro_documento      
      
left join tabla_areas_detalle db        
 on db.id_area = da.id_area        
  
left join tabla_nomina_bancos NB        
 on nb.codigo=nc.id_banco      
  
left join designaciones_fechas d          
 on d.nro_doc=dp.nro_documento   
      
where nc.id=@id          
          
        
      
          
          
/*  
left join designaciones des          
 on d.nro_doc=des.nro_doc           
        
left join dbo.vw_desglose_area vwda          
 on vwda.id_interna = des.id_interna          
          
left join dbo.vw_desglose_nivelgrado vwdng          
 on vwdng.id_interna = des.id_interna          
          
left join dbo.vw_desglose_planta vwdp          
 on vwdp.id_interna = des.id_interna          
        
        
left join tabla_areas_detalle db          
 on db.id_area = des.area          
          
left join tabla_nomina_bancos NB          
 on nb.codigo=nc.id_banco          
*/          
      
          
          
        
      
    
  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetDatosPersonales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetDatosPersonales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[GetDatosPersonales]    
 @Legajo int,    
 @id int,    
 @traerbajas bit  = null    
AS    
    
    
SELECT DAT_P.Id_Interna as IdPersona,*,lb.id_interna baja,p.nombreprovincia provincia_desc   
  
FROM [dbo].Datos_Personales as DAT_P     
    
LEFT JOIN [dbo].Domicilio_Personal as DOM_P     
 ON DAT_P.id_Interna = DOM_P.id_Interna AND     
    DOM_P.DatoDeBaja = 0     
    
LEFT JOIN [dbo].LocalidadesAFIP as LAFIP     
 ON DOM_P.Localidad = LAFIP.idLocalidad     
     
LEFT JOIN dbo.Designaciones_Fechas as DEF     
 ON DAT_P.Id_Interna = DEF.Id_Interna   
   
left join dbo.legajo_bajas LB    
 on lb.id_interna = dat_p.id_interna    
  
left join provincias p  
 on p.codafip=DOM_P.provincia  
    
WHERE (Nro_Documento = @Legajo or DAT_P.id_interna = @id )     
and (LB.fecha_baja is null or not @traerbajas is null)    
    
    
--AGREGADO 27/07/06    
and nro_documento <> 0 and dat_p.id_interna <> 0    
    
ORDER BY Fecha_Comunicacion DESC    
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetDomicilios_cont_leg]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetDomicilios_cont_leg]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[GetDomicilios_cont_leg]
	@titdoc int
AS


SELECT telefono,correo_electronico
FROM [dbo].Domicilio_Personal 
WHERE Nro_Doc = @titdoc 
group by telefono, correo_electronico
' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_ADD_Formulario_DDJJ]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_ADD_Formulario_DDJJ]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[PLA_ADD_Formulario_DDJJ]
	(@Legajo [int],
	 @Area_Actual [int],
	 @Area_Certifica [int],
	 @Mes 	[smallint],
	 @Año 	[smallint])
AS 
Declare @id [int]
set @id = (select max(id)+1 from [dbo].[PLA_Formulario_DDJJ] )
IF @id is null begin
	set @id=1
END

INSERT INTO [dbo].[PLA_Formulario_DDJJ] 
	 ([id],
	 [Legajo],
	 [Mes],
	 [Año],
	Area_Actual,
	Area_Certifica) 
 VALUES 
	(@id,
	 @Legajo,
	 @Mes,
	 @Año,
	@Area_actual,
	@Area_Certifica)


' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_GET_Agentes_No_Certificados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_GET_Agentes_No_Certificados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[PLA_GET_Agentes_No_Certificados]  
 @Mes smallint,  
 @Año smallint  
  
AS  
SELECT DP.Nro_Documento,  
 DP.Apellido +'', ''+ Nombre Apellido,  
 dp.Id_interna,  
 CASE WHEN FD.Legajo IS NULL THEN  
  d.id_area  
 ELSE  
  FD.Area_Donde_Firma  
 END IdArea_Certifica,  
 d.id_area IdArea_Actual,  
 ''L'' Tipo_Planta,  
 (select descripcion from dbo.tabla_areas where id = CASE WHEN FD.Legajo IS NULL THEN  
  d.id_area  
 ELSE  
  FD.Area_Donde_Firma  
 END) Area_Certifica,  
 (select descripcion from dbo.tabla_areas where id = D.id_Area) Area_Actual,  
  
 case when f.legajo IS NULL then  
  ''No''  
 ELSE  
  ''Si''  
 END Certifico,  
 f.area_Certifica IdArea_Certifica  
  
FROM dbo.Datos_Personales DP  
INNER JOIN dbo.VW_Desglose_Area D  
 on D.Id_Interna = DP.Id_Interna   
  
LEFT JOIN dbo.Legajo_Bajas LB   
 on LB.Id_Interna = DP.Id_Interna   
  
  
LEFT JOIN dbo.PLA_Firmantes_DDJJ FD --SI ES FIRMANDE DE DDJJ  
 on FD.Legajo = DP.Nro_Documento  
  
INNER JOIN dbo.Tabla_Areas TAA  
 on TAA.id = d.id_area  
  
LEFT JOIN dbo.PLA_Formulario_DDJJ F --SI CERTIFICO  
 on f.legajo = dp.nro_documento and  
 f.año = @Año and  
 f.mes = @mes  
  
left JOIN dbo.CTR_Contratos C    
 on C.Nro_Documento = dp.Nro_Documento    
 and c.id_Contrato = (select max(id_Contrato) from dbo.CTR_Contratos where Nro_Documento = dp.Nro_Documento and (Aprobado = 1 OR Alta_Prov_Leg = 1))    
  
  
WHERE ((LB.Id_Interna IS NULL) OR (month(lb.fecha_baja) = @Mes and year(lb.fecha_baja) = @año))  --LB.Id_Interna IS NULL   
  
ORDER BY Apellido  
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_DEL_FormularioDDJJ]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

GO
/****** Object:  StoredProcedure [dbo].[PLA_DEL_Certificacion_DDJJ]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_DEL_Certificacion_DDJJ]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[PLA_DEL_Certificacion_DDJJ]
	@Id int
AS
	DELETE FROM dbo.PLA_Formulario_DDJJ 
	WHERE	Id = @Id	

' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_Get_RecepcionDDJJ]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_Get_RecepcionDDJJ]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[PLA_Get_RecepcionDDJJ]

	@area int=null,
	@año int=null,
	@operacion int

as

if @operacion=1 begin

select distinct(fdj.area_certifica), ta.descripcion, 

	case when (select distinct(mes) from pla_formulario_DDJJ where mes =1  and año =@año and area_certifica = ta.id) is not null then
		''1''
	else
		''''
	end +
 	case when (select distinct(mes) from pla_formulario_DDJJ where mes =2  and año =@año and area_certifica = ta.id  ) is not null then
	 	'', '' + ''2''
	else
		''''
	end +
 	case when (select distinct(mes) from pla_formulario_DDJJ where mes =3  and año =@año and area_certifica = ta.id  ) is not null then
	 	'', '' + ''3''
	else
		''''
	end +
 	case when (select distinct(mes) from pla_formulario_DDJJ where mes =4  and año =@año and area_certifica = ta.id) is not null then
	 	'', '' + ''4''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =5  and año =@año and area_certifica = ta.id ) is not null then
	 	'', '' + ''5''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =6  and año =@año and area_certifica = ta.id ) is not null then
	 	'', '' + ''6''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =7  and año =@año and area_certifica = ta.id ) is not null then
	 	'', '' + ''7''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =8  and año =@año and area_certifica = ta.id ) is not null then
	 	'', '' + ''8''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =9  and año =@año and area_certifica = ta.id ) is not null then
	 	'', '' + ''9''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =10  and año =@año and area_certifica = ta.id ) is not null then
	 	'', '' + ''10''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =11 and año =@año and area_certifica = ta.id ) is not null then
	 	'', '' + ''11''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =12  and año =@año and area_certifica = ta.id ) is not null then
	 	'', '' + ''12''
	else	
		''''
	end DDJJ_Entregadas


from pla_formulario_DDJJ FDJ

inner join tabla_areas ta
	on ta.id = fdj.area_certifica
	
where
	(left(fdj.area_certifica,5)=left(@area,5) or @area is null) and
	(fdj.año=@año or @año is null) 
			           
group by fdj.area_certifica,ta.id, ta.descripcion
order by fdj.area_certifica

end



if @operacion=2 begin

select distinct(fdj.area_certifica), ta.descripcion,  

case when (select distinct(mes) from pla_formulario_DDJJ where mes =1 and area_certifica = ta.id and año =@año ) is  null then
		''1''
	else
		''''
	end +
 	case when (select distinct(mes) from pla_formulario_DDJJ where mes =2 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''2''
	else
		''''
	end +
 	case when (select distinct(mes) from pla_formulario_DDJJ where mes =3 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''3''
	else
		''''
	end +
 	case when (select distinct(mes) from pla_formulario_DDJJ where mes =4 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''4''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =5 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''5''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =6 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''6''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =7 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''7''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =8 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''8''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =9 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''9''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =10 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''10''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =11 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''11''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =12 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''12''
	else	
		''''
	end DDJJ_No_Entregadas

from pla_Formulario_DDJJ fdj

left join tabla_areas ta
	on ta.id=fdj.area_certifica

where
	(left(fdj.area_certifica,5)=left(@area,5) or @area is null) and
	(fdj.año=@año or @año is null) 
			           


union

select id,descripcion,

case when (select distinct(mes) from pla_formulario_DDJJ where mes =1 and area_certifica = ta.id and año =@año ) is  null then
		''1''
	else
		''''
	end +
 	case when (select distinct(mes) from pla_formulario_DDJJ where mes =2 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''2''
	else
		''''
	end +
 	case when (select distinct(mes) from pla_formulario_DDJJ where mes =3 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''3''
	else
		''''
	end +
 	case when (select distinct(mes) from pla_formulario_DDJJ where mes =4 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''4''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =5 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''5''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =6 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''6''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =7 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''7''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =8 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''8''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =9 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''9''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =10 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''10''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =11 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''11''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =12 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''12''
	else	
		''''
	end DDJJ_No_Entregadas


from tabla_areas ta

where id not in(select area_certifica from pla_formulario_ddjj where año=@año)
	and (left(ta.id,5)=left(@area,5) or @area is null) 
	--and (fdj.año=@año or @año is null)

end



if @operacion=3 begin

select distinct(fdj.area_certifica), ta.descripcion, 

	case when (select distinct(mes) from pla_formulario_DDJJ where mes =1  and año =@año and area_certifica = ta.id) is not null then
		''1''
	else
		''''
	end +
 	case when (select distinct(mes) from pla_formulario_DDJJ where mes =2  and año =@año and area_certifica = ta.id  ) is not null then
	 	'', '' + ''2''
	else
		''''
	end +
 	case when (select distinct(mes) from pla_formulario_DDJJ where mes =3  and año =@año and area_certifica = ta.id  ) is not null then
	 	'', '' + ''3''
	else
		''''
	end +
 	case when (select distinct(mes) from pla_formulario_DDJJ where mes =4  and año =@año and area_certifica = ta.id) is not null then
	 	'', '' + ''4''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =5  and año =@año and area_certifica = ta.id ) is not null then
	 	'', '' + ''5''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =6  and año =@año and area_certifica = ta.id ) is not null then
	 	'', '' + ''6''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =7  and año =@año and area_certifica = ta.id ) is not null then
	 	'', '' + ''7''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =8  and año =@año and area_certifica = ta.id ) is not null then
	 	'', '' + ''8''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =9  and año =@año and area_certifica = ta.id ) is not null then
	 	'', '' + ''9''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =10  and año =@año and area_certifica = ta.id ) is not null then
	 	'', '' + ''10''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =11 and año =@año and area_certifica = ta.id ) is not null then
	 	'', '' + ''11''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =12  and año =@año and area_certifica = ta.id ) is not null then
	 	'', '' + ''12''
	else	
		''''
	end DDJJ_Entregadas


from pla_formulario_DDJJ FDJ

inner join tabla_areas ta
	on ta.id=fdj.area_certifica
	
where
	(left(fdj.area_certifica,2)=left(@area,2) or @area is null) and
	(fdj.año=@año or @año is null) 
			           
group by fdj.area_certifica,ta.id, ta.descripcion
order by fdj.area_certifica

end




if @operacion=4 begin

select distinct(fdj.area_certifica), ta.descripcion,  

case when (select distinct(mes) from pla_formulario_DDJJ where mes =1 and area_certifica = ta.id and año =@año ) is  null then
		''1''
	else
		''''
	end +
 	case when (select distinct(mes) from pla_formulario_DDJJ where mes =2 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''2''
	else
		''''
	end +
 	case when (select distinct(mes) from pla_formulario_DDJJ where mes =3 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''3''
	else
		''''
	end +
 	case when (select distinct(mes) from pla_formulario_DDJJ where mes =4 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''4''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =5 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''5''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =6 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''6''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =7 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''7''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =8 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''8''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =9 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''9''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =10 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''10''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =11 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''11''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =12 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''12''
	else	
		''''
	end DDJJ_No_Entregadas

from pla_Formulario_DDJJ fdj

left join tabla_areas ta
	on ta.id=fdj.area_certifica

where
	(left(fdj.area_certifica,2)=left(@area,2) or @area is null) and
	(fdj.año=@año or @año is null) 
			           

union

select id,descripcion,

case when (select distinct(mes) from pla_formulario_DDJJ where mes =1 and area_certifica = ta.id and año =@año ) is  null then
		''1''
	else
		''''
	end +
 	case when (select distinct(mes) from pla_formulario_DDJJ where mes =2 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''2''
	else
		''''
	end +
 	case when (select distinct(mes) from pla_formulario_DDJJ where mes =3 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''3''
	else
		''''
	end +
 	case when (select distinct(mes) from pla_formulario_DDJJ where mes =4 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''4''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =5 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''5''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =6 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''6''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =7 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''7''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =8 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''8''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =9 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''9''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =10 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''10''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =11 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''11''
	else	
		''''
	end +
	case when (select distinct(mes) from pla_formulario_DDJJ where mes =12 and area_certifica = ta.id and año =@año ) is  null then
	 	'', '' + ''12''
	else	
		''''
	end DDJJ_No_Entregadas


from tabla_areas ta
where id not in(select area_certifica from pla_formulario_ddjj where año=@año)
	and (left(ta.id,2)=left(@area,2) or @area is null) 
	--and (fdj.año=@año or @año is null)

end

' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_GET_Formulario_DDJJ_Manual]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_GET_Formulario_DDJJ_Manual]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



--MLD: 29-11-06: Se MODIFICA PARA TRAER TODO DESDE DATOS_PERSONALES

CREATE procedure [dbo].[PLA_GET_Formulario_DDJJ_Manual]
	@Documento int,
	@Mes smallint,
	@Año smallint
AS

SELECT  dp.Apellido +'', ''+ dp.Nombre Apellido,
	TA.id Area,
	TA.descripcion DescArea,
	VisibleLegajos,
	VisibleContratos,
	BajaLegajos,
	BajaContratos

FROM dbo.Datos_Personales DP
left join dbo.vw_desglose_area d
	on d.Id_interna = dp.id_interna

INNER JOIN dbo.tabla_areas TA
	on ta.id = d.id_area

left join dbo.legajo_bajas lb
	on lb.id_interna = dp.id_interna and
		(year(fecha_baja) <= @año and month(fecha_baja) < @mes)

LEFT JOIN dbo.PLA_Formulario_DDJJ FDDJJ
		on FDDJJ.Legajo = dp.Nro_documento AND
		   FDDJJ.mes = @mes and
		   FDDJJ.año = @Año	
WHERE (	Dp.Nro_Documento = @Documento) and
--	(lb.id_interna is null) and
	(FDDJJ.legajo is null) --AND






' 
END
GO
/****** Object:  StoredProcedure [dbo].[SEG_ALTA_SEGURO]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[SEG_ALTA_SEGURO]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[SEG_ALTA_SEGURO] 

@id_interna int,  @concepto varchar(6)

AS

DECLARE @id_concepto int
DECLARE @tipo_seguro_anterior int
DECLARE @es_seguro bit


SET @es_seguro = (SELECT Seguro FROM dbo.TABLA_CONCEPTOS_RECIBOS WHERE codigo = @concepto)


IF @es_seguro = 1 BEGIN
	SET @id_concepto = (SELECT id FROM dbo.TABLA_CONCEPTOS_RECIBOS WHERE codigo = @concepto)
	
	INSERT INTO dbo.SEG_SEGUROS_ACTIVOS
		(Id_Interna, Tipo_Seguro) 
	VALUES
		(@id_interna, @id_concepto)
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[SEG_Buscar]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[SEG_Buscar]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[SEG_Buscar]
@Apellido varchar(80) = null,
@IdArea int = null,
@mes int,
@año int,
@Nove int
AS

--EXISTE SEGURO INACTIVO
SELECT DP.Apellido, DP.Nombre, DP.nro_documento, CR.Codigo, TA.Descripcion area,  CASE WHEN Month(getDate()) = @mes AND SA.Tipo_Seguro IS NULL THEN ''1'' ELSE  ''0'' END EsDiferencia, CASE WHEN  SA.Tipo_Seguro IS NULL THEN ''0'' ELSE ''1'' END valor
FROM dbo.PLA_RECIBOS_DETALLE RD 
INNER JOIN dbo.TABLA_CONCEPTOS_RECIBOS CR ON
RD.Concepto = CR.Codigo
LEFT JOIN dbo.SEG_SEGUROS_ACTIVOS SA ON
RD.Id_Interna = SA.Id_Interna AND
CR.Id = SA.Tipo_Seguro
INNER JOIN dbo.DATOS_PERSONALES DP ON
DP.id_interna = RD.Id_Interna

LEFT JOIN dbo.VW_Desglose_Area DE 
ON DE.Id_Interna = DP.Id_Interna 

INNER JOIN dbo.TABLA_AREAS TA ON
TA.Id = DE.Id_Area

WHERE CR.Seguro = 1 AND 
DP.id_interna NOT IN (SELECT id_Interna FROM dbo.LEGAJO_BAJAS) 
		AND (apellido  LIKE @apellido + ''%'' OR @apellido ='''')
		AND (TA.id = @IdArea OR @IdArea = '''')
		AND rd.mes = @mes AND rd.año = @año
		AND ((Month(getDate()) = @mes AND SA.Tipo_Seguro IS NULL) OR (@Nove = 0))
UNION ALL

--NO EXISTE SEGURO ACTIVO
SELECT DP.Apellido, DP.Nombre, DP.nro_documento, CR.Codigo, TA.Descripcion area, CASE WHEN Month(getDate()) = @mes  AND RD.Concepto IS NULL THEN ''1'' ELSE  ''0'' END  EsDiferencia, ''1'' valor

FROM dbo.SEG_SEGUROS_ACTIVOS SA
INNER JOIN dbo.TABLA_CONCEPTOS_RECIBOS CR ON
SA.Tipo_Seguro = CR.Id
LEFT JOIN dbo.PLA_RECIBOS_DETALLE RD ON
CR.Codigo = RD.Concepto AND
SA.Id_Interna = RD.Id_Interna AND
rd.mes = @mes and rd.año = @año
INNER JOIN dbo.DATOS_PERSONALES DP ON
DP.id_interna = SA.Id_Interna
INNER JOIN dbo.VW_Desglose_Area DE 
ON DE.Id_Interna = DP.Id_Interna 

INNER JOIN dbo.TABLA_AREAS TA 
ON TA.Id = DE.Id_Area

WHERE CR.Seguro = 1 
AND DP.id_interna NOT IN (SELECT id_Interna FROM dbo.LEGAJO_BAJAS) 
		AND (apellido  LIKE @apellido + ''%'' OR @apellido ='''')
		AND (TA.id = @IdArea OR @IdArea = '''')
		AND (  (Month(getDate()) = @mes  AND RD.Concepto IS NULL))
	ORDER BY  3, 4, 1, 2, 5 --IMPORTANTE


' 
END
GO
/****** Object:  StoredProcedure [dbo].[SEG_Modificar_Seguro]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[SEG_Modificar_Seguro]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[SEG_Modificar_Seguro] 
@operacion int,
@doc int,
@tipo_seguro varchar(50)


AS



DECLARE @id_interna int
SET @id_interna = (SELECT id_interna FROM dbo.DATOS_PERSONALES WHERE nro_documento = @doc)
DECLARE @Id_Tipo_Seguro int
SET @Id_Tipo_Seguro = (SELECT id FROM dbo.TABLA_CONCEPTOS_RECIBOS WHERE codigo LIKE @tipo_seguro)


IF @operacion = 1 BEGIN --es alta
	DECLARE @existe int	
	SET @existe = (SELECT id_interna FROM dbo.SEG_SEGUROS_ACTIVOS WHERE id_Interna = @id_Interna AND Tipo_Seguro = @id_tipo_seguro)
	IF @existe is null BEGIN
		INSERT INTO dbo.SEG_Seguros_Activos (id_interna, TIPO_SEGURO) 
		VALUES(@id_interna ,@Id_Tipo_Seguro)
	END
END
IF @operacion = 2 BEGIN --es alta
	DELETE FROM dbo.SEG_Seguros_Activos WHERE id_interna = @id_interna and TIPO_SEGURO = @Id_Tipo_Seguro
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_GET_Archivos_Importados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_GET_Archivos_Importados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[PLA_GET_Archivos_Importados]  
 @FechaDesde datetime = null,  
 @FechaHasta datetime = null,  
 @Archivo varchar(50) = null  
As  
SELECT Archivo,Cant_Registros, Fecha_Carga  
FROM dbo.PLA_Recibos_Migrados  
WHERE ((Fecha_carga between @FechaDesde and @FechaHasta) or @FechaDesde is null) AND  
       ((archivo = @Archivo) or (@Archivo is null))  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_ADD_Recibos_Migrados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_ADD_Recibos_Migrados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[PLA_ADD_Recibos_Migrados]
 @Archivo varchar(50),        
 @Cant_Registros smallint,        
 @Usuario smallint,  
 @liquidacion int,    
 @mes smallint,    
 @año smallint,    
 @descripcion varchar(100) = NULL,
 @tipo_liquidacion int
AS        
    

INSERT INTO [dbo].[PLA_Recibos_Migrados]        
 (Archivo,         
 [Cant_Registros],         
 [Fecha_Carga],         
 [Usuario],    
 Liquidacion,    
 mes,    
 año,    
 Descripcion,
 tipo_liquidacion)        
VALUES (@Archivo,        
 @Cant_Registros,        
 getdate(),         
 @Usuario,    
 @liquidacion,    
 @mes,    
 @año,    
 @descripcion,
 @tipo_liquidacion)        
        
      
    
  ' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_GET_Recibos_Recibidos]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_GET_Recibos_Recibidos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[RPT_GET_Recibos_Recibidos]
	@id_comprobante int
as

select 
rr.id_comprobante,
rr.id_recibo,
dp.apellido +'', ''+ dp.nombre agente,
dp2.apellido +'', ''+ dp2.nombre firmante,
tc.Descripcion cargo,
ta.Descripcion area,
rr.fecha_alta,
u.nombre usuario,
r.Cuil,
r.Id_Oficina,
r.Nro_Orden,
r.liquidacion,

case when rm.mes < 10
then convert(char(4),rm.año) +''/0''+ convert(char(1),rm.mes) +'' - ''+ rm.descripcion 
else convert(char(4),rm.año) +''/''+ convert(char(2),rm.mes) +'' - ''+ rm.descripcion 
end descrip_liq


from dbo.PLA_Recibos_Recibidos rr

INNER JOIN dbo.pla_recibos r
	on r.id_recibo = rr.id_recibo

INNER JOIN dbo.datos_personales dp
	on right(left(r.cuil,11),8) = dp.nro_documento

INNER JOIN dbo.datos_personales dp2
	on  rr.doc_firmante = dp2.nro_documento

INNER JOIN dbo.tabla_cargos tc
	ON tc.Id = rr.id_cargo

INNER JOIN dbo.Tabla_Areas ta
	ON ta.id = rr.id_area

INNER JOIN rh_usuarios u
	ON u.Id = rr.usuario 

INNER JOIN dbo.PLA_Recibos_Migrados rm
	on rm.liquidacion = r.liquidacion

where rr.id_comprobante = @id_comprobante

order by r.liquidacion, dp2.apellido , dp2.nombre, dp.apellido , dp.nombre
' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_GET_Liquidacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_GET_Liquidacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[PLA_GET_Liquidacion]  
as  
select  liquidacion id,   
 convert(char(4),año) +''/''+ convert(char(2),mes) +'' - ''+ descripcion descripcion  
from dbo.PLA_Recibos_Migrados  
order by año desc,mes desc 




' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_GET_Recepcion_Recibos_Haberes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_GET_Recepcion_Recibos_Haberes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[PLA_GET_Recepcion_Recibos_Haberes]
 @CodigoArea varchar(24) =NULL,                  
 @liquidacion int = null,      
 @orden int = 1,                  
 @Documento int = null    
As
select  DP.Nro_documento,
	ISNULL(DP.Apellido +'', ''+ DP.nombre,''NO RECEPCIONADO'') Agente,
	cast(RM.Año as char(4)) +''/''+  cast(RM.Mes as char(2)) +'' - ''+ 	RM.Descripcion Liquidacion,
	CASE WHEN Impreso = 1 THEN ''SI'' ELSE ''NO'' END Impreso, 
	ISNULL(DPF.Apellido +'', ''+ DPF.nombre,''NO RECEPCIONADO'') Firmante,
	ISNULL(cast(convert(varchar, Fecha_Alta, 103) as char(10)),'''') FechaRecepcion,
	isnull(Id_Comprobante,0) NroComprobante
from dbo.pla_recibos PC
INNER JOIN dbo.PLA_Recibos_Migrados RM
	ON RM.Liquidacion = PC.Liquidacion
LEFT JOIN dbo.PLA_Recibos_Recibidos RR
	ON RR.Id_Recibo = PC.Id_Recibo
LEFT JOIN dbo.Datos_Personales DPF
	ON DPF.Nro_Documento = RR.Doc_Firmante
INNER JOIN dbo.Datos_Personales DP
	on DP.id_interna = PC.id_interna
WHERE   (RM.liquidacion = @liquidacion or @liquidacion is null) AND 
	(dp.Nro_documento = @Documento OR @Documento IS NULL)    


' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_GET_Recibos_Migrados_MaxLiq]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_GET_Recibos_Migrados_MaxLiq]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[PLA_GET_Recibos_Migrados_MaxLiq]
as

select isnull(max(liquidacion),0) + 1 MaxLiq
from dbo.PLA_Recibos_Migrados

' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetCalcular_Dotacion_Area_Detalle]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetCalcular_Dotacion_Area_Detalle]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'





CREATE procedure [dbo].[GetCalcular_Dotacion_Area_Detalle]
	@area [int],	
	@Nivel smallint,
	@Planta [varchar](20)	
as

if @Planta > ''C'' and @planta > ''TT''begin
-- PERMAMENTE, TRANSITORIA, GABINETE
	select distinct dp.apellido Apellido, dp.nombre Nombre, dp.nro_documento Legajo , convert(varchar(10),dp.fecha_nacimiento,103) Fecha_Nacimiento ,tp.descripcion Planta, tn.nivel Nivel, tg.grado Grado, 0 monto, convert(varchar(10),df.fecha_min,103) Fecha_Ing , Ant.Ant_total Antiguedad ,d.area , ta.descripcion Dependencia from dbo.designaciones D
	left join dbo.tipo_de_planta TP 
		on TP.id = D.id_planta
	inner join datos_personales DP
		on dp.id_interna = d.id_interna
--
	left JOIN dbo.Tabla_niveles TN
		on tn.id = d.id_nivel
	left JOIN dbo.tabla_grados TG
		on tg.id = d.id_grado
	left JOIN dbo.Tabla_areas TA
		on ta.id = d.area
	left join dbo.designaciones_fechas DF
		on df.id_interna = dp.id_interna
	left JOIN dbo.antiguedad Ant
		on ant.id_interna = dp.id_interna
--
	where (area =@area or(left(area,@nivel) = left(@area,@nivel) and right(area,3)>900))and d.fecha_hasta = ''01/01/2006'' and TP.tipo = @Planta and
		d.id_interna not in (select id_interna from legajo_bajas)
	order by apellido,nombre
end
if @Planta =''C'' begin
--contratada LEGAJOS
	select dp.apellido Apellido, dp.nombre Nombre, dp.nro_documento Legajo, convert(varchar(10),dp.fecha_nacimiento,103) Fecha_Nacimiento, tp.descripcion Planta, tn.nivel Nivel_Funcion, tg.grado Grado_Rango, 0 monto , convert(varchar(10), df.fecha_min,103) Fecha_Ing , Ant.Ant_total Antiguedad , d.area, ta.descripcion Dependencia 
	from dbo.designaciones D
	left join dbo.tipo_de_planta TP 
		on TP.id = D.id_planta
	inner join datos_personales DP
		on dp.id_interna = d.id_interna
--
	left JOIN dbo.Tabla_niveles TN
		on tn.id = d.id_nivel
	left JOIN dbo.tabla_grados TG
		on tg.id = d.id_grado
	INNER JOIN dbo.Tabla_areas TA
		on ta.id = d.area
	left join dbo.designaciones_fechas DF
		on Df.id_interna = dp.id_interna
	left JOIN dbo.antiguedad Ant
		on ant.id_interna = dp.id_interna
--



	where (area =@area or(left(area,@nivel) = left(@area,@nivel) and right(area,3)>900))and d.fecha_hasta = ''01/01/2006'' and TP.tipo = @Planta and
		d.id_interna not in (select id_interna from legajo_bajas)

	union all

--Contratada CONTRATOS
	select distinct dp.apellido, dp.nombre, dp.legajo, convert(varchar(10),dp.fecha_nac,103) Fecha_Nacimiento, ''CContratada'' Planta, 
--
	case when ttc.SendLegajos = 1 then
		tn.nivel --nivel
	else
		tf.descripcion --funcion
	end 	Nivel_Funcion,
	case when ttc.SendLegajos = 1 then
		tg.grado --grado
	else
		tr.descripcion --rango
	end 	Grado_Rango,
	isnull(c.monto,0) Monto , 
-- **
	(select convert(char(10),desde,103) from ccontrato where nro_contrato = (select min(nro_contrato) 
	from ccontrato where legajo = c.legajo)) Fecha_Ing,

	dbo.fx_calcula_antiguedad((select convert(char(10),desde,103) from ccontrato where nro_contrato = (select min(nro_contrato) 
	from ccontrato where legajo = c.legajo)),getdate()) Antiguedad,	

-- **

	c.id_area Area, ta.descripcion dependencia
--
	from ccontrato C
	inner join Cdatos_personales DP
		on dp.legajo = c.legajo
--
	INNER JOIN dbo.Tabla_Resoluciones_Contratos TRC
		on TRC.id = c.tipo_contrato
	INNER JOIN dbo.Tabla_Tipos_Contratos TTC
		on TTC.id = TRC.tipo_contrato
	LEFT JOIN dbo.tabla_niveles TN
		on tn.id = c.nivel
	LEFT JOIN dbo.tabla_grados TG
		on tg.id = c.grado
	LEFT JOIN dbo.Tabla_Funciones_contratos TF
		on tf.id = c.funcion
	LEFT JOIN dbo.tabla_Rangos TR
		on tr.id = c.rango
	INNER JOIN dbo.Tabla_areas TA
		on ta.id = c.id_area

--SendLegajos = 1 --> nivel/grado
--

	where (id_area =@area or(left(id_area,@nivel) = left(@area,@nivel) and right(id_area,3)>900)) and c.baja =0 and dp.send_legajos=0 and c.aprobado=1 and dp.baja =0
	order by apellido,nombre
end

IF @Planta = ''TT'' BEGIN
--LEGAJOS
	select dp.apellido Apellido, dp.nombre Nombre, dp.nro_documento Legajo , convert(varchar(10),dp.fecha_nacimiento,103) Fecha_Nacimiento, tp.Descripcion Planta , tn.nivel Nivel_Funcion, tg.grado Grado_Rango, 0 Monto , convert(varchar(10),df.fecha_min,103) Fecha_Ing , Ant.Ant_total Antiguedad,  d.area, ta.descripcion Dependencia from dbo.designaciones D
	left join dbo.tipo_de_planta TP 
		on TP.id = D.id_planta
	inner join datos_personales DP
		on dp.id_interna = d.id_interna
--
	left JOIN dbo.Tabla_niveles TN
		on tn.id = d.id_nivel
	left JOIN dbo.tabla_grados TG
		on tg.id = d.id_grado
	INNER JOIN dbo.tabla_areas TA
		on ta.id = d.area
	left JOIN dbo.designaciones_fechas DF
		on df.id_interna = dp.id_interna
	left JOIN dbo.antiguedad Ant
		on ant.id_interna = dp.id_interna
--
	where (area =@area or(left(area,@nivel) = left(@area,@nivel) and right(area,3)>900))and d.fecha_hasta = ''01/01/2006''  and
		d.id_interna not in (select id_interna from legajo_bajas)

	union all

--CONTRATOS
	select distinct dp.apellido, dp.nombre, dp.legajo , convert(varchar(10),dp.fecha_nac,103) Fecha_Nacimiento, ''Contratada'' Planta,
--
	case when ttc.SendLegajos = 1 then
		tn.nivel --nivel
	else
		tf.descripcion --funcion
	end 	Nivel_Funcion,
	case when ttc.SendLegajos = 1 then
		tg.grado --grado
	else
		tr.descripcion --rango
	end 	Grado_Rango,
	isnull(c.monto,0) Monto, 
-- **
	(select convert(char(10),desde,103) from ccontrato where nro_contrato = (select min(nro_contrato) 
	from ccontrato where legajo = c.legajo)) Fecha_Ing,

	dbo.fx_calcula_antiguedad((select convert(char(10),desde,103) from ccontrato where nro_contrato = (select min(nro_contrato) 
	from ccontrato where legajo = c.legajo)),getdate()) Antiguedad,	

-- **
	c.id_area Area, ta.descripcion Dependencia
--
	from ccontrato C
	inner join Cdatos_personales DP
		on dp.legajo = c.legajo

--
	INNER JOIN dbo.Tabla_Resoluciones_Contratos TRC
		on TRC.id = c.tipo_contrato
	INNER JOIN dbo.Tabla_Tipos_Contratos TTC
		on TTC.id = TRC.tipo_contrato
	LEFT JOIN dbo.tabla_niveles TN
		on tn.id = c.nivel
	LEFT JOIN dbo.tabla_grados TG
		on tg.id = c.grado
	LEFT JOIN dbo.Tabla_Funciones_Contratos TF
		on tf.id = c.funcion
	LEFT JOIN dbo.tabla_Rangos TR
		on tr.id = c.rango
	--TR.SendLegajos = 1 --> nivel/grado
	INNER JOIN dbo.tabla_areas TA
		on ta.id = c.id_area

--
	where (id_area =@area or(left(id_area,@nivel) = left(@area,@nivel) and right(id_area,3)>900)) and c.baja =0 and dp.send_legajos=0 and c.aprobado=1 and dp.baja =0

	order by apellido,nombre
END












' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_Get_Fx_Calcula_Antiguedad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Get_Fx_Calcula_Antiguedad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[CTR_Get_Fx_Calcula_Antiguedad]
@F1 datetime ,
@F2 datetime
as

Select dbo.Fx_Calcula_Antiguedad (@F1, @F2)


' 
END
GO
/****** Object:  StoredProcedure [dbo].[get_antiguedades_Estado]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[get_antiguedades_Estado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'--FUNCIONES:        
 --dbo.Fx_Calcula_Antiguedad (fecha1, fecha2) = ''xx-xx-xx''        
 --dbo.Fx_Sumar_Antiguedad (ant1, ant2) = ''yy-yy-yy)        
        
CREATE procedure [dbo].[get_antiguedades_Estado]        
        
@documento int = null,        
@desde datetime = null,        
@hasta datetime = null,        
@tipo char(1) = null        
        
as        
set nocount on        
        
--declare @documento int        
--declare @desde datetime        
--declare @hasta datetime        
--declare @tipo char(1)         
        
--set @documento = null --17237545        
--set @desde = null        
--set @hasta = null        
--set @tipo = NULL --''M''  ''P''   ''E''        
        
create table #t        
( item int identity(1,1),        
  desde smalldatetime,        
  hasta smalldatetime,        
  documento int)        
        
create table #t2        
( item int identity(1,1),        
  desde datetime,        
  hasta datetime,        
  documento int)        
        
        
        
create table #a        
(documento int,        
antiguedad varchar(10))        
        
         
insert into #t        
select  distinct fecha_desde, fecha_hasta, doc_titular         
from leg_servicios_adm_publica        
where (doc_titular = @documento or @documento IS NULL) AND        
 (fecha_desde >=  @desde or @desde is null) AND        
 (fecha_hasta <= @hasta or @hasta is null) and        
 (''E'' =  @tipo or @tipo is null) AND        
 datodebaja = 0         
        
        
insert into #t        
select  distinct fecha_desde, fecha_hasta, documento         
from leg_otros_servicios        
where (documento = @documento or @documento IS NULL) AND        
 (fecha_desde >=  @desde or @desde is null) AND        
 (fecha_hasta <= @hasta or @hasta is null) and        
 (''P'' =  @tipo or @tipo IS NULL) AND        
 datodebaja = 0         
        
        
        
insert into #t        
select  fecha_Min,         
 case when @hasta IS NULL then        
  getdate()        
 else        
  @hasta        
 end FechaHasta,         
 nro_doc        
from dbo.designaciones_fechas        
where (nro_doc = @documento or @documento IS NULL) AND        
 (fecha_Min >=  @desde or @desde is null) AND        
 (fecha_Min <= @hasta or @hasta is null) and        
-- (''M'' =  @tipo or @tipo IS NULL) and        
 (''E'' = @tipo or @tipo IS NULL)  --esto se lo agrego para que antiguedad en el estado incluya el ministerio.        
        
        
declare @i int        
set @i = 1        
        
        
insert into #t2        
select desde, hasta, documento from #t        
order by documento, desde asc, hasta desc        
        
-- AGREGA AQUELLAS PERSONAS QUE NO TIENEN ANTIGUEDAD        
insert into #t2        
select  ''01/01/1900'',''01/01/1900'' , nro_documento        
from datos_personales dp        
left join #t t        
 ON t.documento = dp.nro_documento        
where (t.documento is null AND @Documento IS NULL)        
        
        
        
declare @fdesde datetime        
declare @fhasta datetime        
declare @doc int        
declare @Antiguedad varchar(10)        
        
set @fdesde = ''01/01/1900''        
set @fhasta = ''01/01/9999''        
set @doc = 0        
set @antiguedad = ''00-00-00''        
        
--select * from #t2        
        
        
WHILE @i <= (select count(*) from #t2) BEGIN        
        
 -- INICIA VARIABLES DE LA PERSONA         
 set @doc = (select documento from #t2 where item = @i)        
 set @fdesde = (select desde from #t2 where item = @i)        
 set @fhasta = (select hasta from #t2 where item = @i)        
 set @antiguedad = ''00-00-00''        
         
 set @antiguedad = dbo.Fx_Sumar_Antiguedad(@antiguedad, dbo.Fx_Calcula_Antiguedad (@fdesde, @fhasta))        
 set @i = @i + 1         
 while @doc = (select documento from #t2 where item = @i) BEGIN        
   IF ((select desde from #t2 where item = @i) >= @fhasta)  BEGIN          
	   set @fdesde = (select desde from #t2 where item = @i) --@fhasta           
	   IF ((select desde from #t2 where item = @i) = @fhasta) BEGIN          
	    set @fdesde = @fdesde + 1 --@fhasta + 1           
	   END          

	   set @fhasta = (select hasta from #t2 where item = @i)          
	   set @antiguedad = dbo.Fx_Sumar_Antiguedad(@antiguedad, dbo.Fx_Calcula_Antiguedad (@fdesde, @fhasta))          
	   set @i = @i + 1          
	   END          
  ELSE IF ((select desde from #t where item = @i) <= @fhasta) AND  ((select hasta from #t2 where item = @i) >= @fhasta) BEGIN          
	   set @fdesde = @fhasta + 1           
	   set @fhasta = (select hasta from #t2 where item = @i) 

	   IF 	(select hasta from #t2 where item = @i) = @hasta BEGIN
	      set @fhasta = @fhasta + 1 
	   END	
	   set @antiguedad = dbo.Fx_Sumar_Antiguedad(@antiguedad, dbo.Fx_Calcula_Antiguedad (@fdesde, @fhasta))          
	   set @i = @i + 1          
	  END          
  ELSE BEGIN          
	   set @i = @i + 1          
	  END          
 END        
        
 -- GUARDA ANTIGUEDAD DE LA PERSONA        
 insert into #a        
 values (@doc, @antiguedad)         
         
END         
        
select *     
into tmp_antiguedad_estado    
from #a        
        
drop table #t        
drop table #t2        
drop table #a        
        
set nocount off      
      
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[get_antiguedades_Total]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[get_antiguedades_Total]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[get_antiguedades_Total]          
          
@documento int = null,          
@desde datetime = null,          
@hasta datetime = null,          
@tipo char(1) = null          
          
as          
set nocount on          
          
--declare @documento int          
--declare @desde datetime          
--declare @hasta datetime          
--declare @tipo char(1)           
          
--set @documento = null --17237545          
--set @desde = null          
--set @hasta = null          
--set @tipo = NULL --''M''  ''P''   ''E''          
          
create table #t          
( item int identity(1,1),          
  desde smalldatetime,          
  hasta smalldatetime,          
  documento int)          
          
create table #t2          
( item int identity(1,1),          
  desde datetime,          
  hasta datetime,          
  documento int)          
          
          
          
create table #a          
(documento int,          
antiguedad varchar(10))          
          
           
insert into #t          
select  distinct fecha_desde, fecha_hasta, doc_titular           
from leg_servicios_adm_publica          
where (doc_titular = @documento or @documento IS NULL) AND          
 (fecha_desde >=  @desde or @desde is null) AND          
 (fecha_hasta <= @hasta or @hasta is null) and          
 (''E'' =  @tipo or @tipo is null) AND          
 datodebaja = 0           
          
          
insert into #t          
select  distinct fecha_desde, fecha_hasta, documento           
from leg_otros_servicios          
where (documento = @documento or @documento IS NULL) AND          
 (fecha_desde >=  @desde or @desde is null) AND          
 (fecha_hasta <= @hasta or @hasta is null) and          
 (''P'' =  @tipo or @tipo IS NULL) AND          
 datodebaja = 0           
          
          
          
insert into #t          
select  fecha_Min,           
 case when @hasta IS NULL then          
  getdate()          
 else          
  @hasta          
 end FechaHasta,           
 nro_doc          
from dbo.designaciones_fechas          
where (nro_doc = @documento or @documento IS NULL) AND          
 (fecha_Min >=  @desde or @desde is null) AND          
 (fecha_Min <= @hasta or @hasta is null) and          
-- (''M'' =  @tipo or @tipo IS NULL) and          
 (''E'' = @tipo or @tipo IS NULL)  --esto se lo agrego para que antiguedad en el estado incluya el ministerio.          
          
          
declare @i int          
set @i = 1          
          
          
insert into #t2          
select desde, hasta, documento from #t          
order by documento, desde asc, hasta desc          
          
-- AGREGA AQUELLAS PERSONAS QUE NO TIENEN ANTIGUEDAD          
insert into #t2          
select  ''01/01/1900'',''01/01/1900'' , nro_documento          
from datos_personales dp          
left join #t t          
 ON t.documento = dp.nro_documento          
where (t.documento is null AND @Documento IS NULL)          
          
          
          
declare @fdesde datetime          
declare @fhasta datetime          
declare @doc int          
declare @Antiguedad varchar(10)          
          
set @fdesde = ''01/01/1900''          
set @fhasta = ''01/01/9999''          
set @doc = 0          
set @antiguedad = ''00-00-00''          
          
--select * from #t2          
          
          
WHILE @i <= (select count(*) from #t2) BEGIN          
          
 -- INICIA VARIABLES DE LA PERSONA           
 set @doc = (select documento from #t2 where item = @i)          
 set @fdesde = (select desde from #t2 where item = @i)          
 set @fhasta = (select hasta from #t2 where item = @i)          
 set @antiguedad = ''00-00-00''          
           
 set @antiguedad = dbo.Fx_Sumar_Antiguedad(@antiguedad, dbo.Fx_Calcula_Antiguedad (@fdesde, @fhasta))          
 set @i = @i + 1           
 while @doc = (select documento from #t2 where item = @i) BEGIN          
  IF ((select desde from #t2 where item = @i) >= @fhasta)  BEGIN          
	   set @fdesde = (select desde from #t2 where item = @i) --@fhasta           
	   IF ((select desde from #t2 where item = @i) = @fhasta) BEGIN          
	    set @fdesde = @fdesde + 1 --@fhasta + 1           
	   END          

	   set @fhasta = (select hasta from #t2 where item = @i)          
	   set @antiguedad = dbo.Fx_Sumar_Antiguedad(@antiguedad, dbo.Fx_Calcula_Antiguedad (@fdesde, @fhasta))          
	   set @i = @i + 1          
	   END          
  ELSE IF ((select desde from #t where item = @i) <= @fhasta) AND  ((select hasta from #t2 where item = @i) >= @fhasta) BEGIN          
	   set @fdesde = @fhasta + 1           
	   set @fhasta = (select hasta from #t2 where item = @i) 

	   IF 	(select hasta from #t2 where item = @i) = @hasta BEGIN
	      set @fhasta = @fhasta + 1 
	   END	
	   set @antiguedad = dbo.Fx_Sumar_Antiguedad(@antiguedad, dbo.Fx_Calcula_Antiguedad (@fdesde, @fhasta))          
	   set @i = @i + 1          
	  END          
  ELSE BEGIN          
	   set @i = @i + 1          
	  END          
 END          
          
 -- GUARDA ANTIGUEDAD DE LA PERSONA          
 insert into #a          
 values (@doc, @antiguedad)           
           
END           
      
          
select *       
into tmp_antiguedad_total      
from #a          
          
drop table #t          
drop table #t2          
drop table #a          
          
set nocount off        
        
      
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[get_antiguedades_Privado]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[get_antiguedades_Privado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'--FUNCIONES:          
 --dbo.Fx_Calcula_Antiguedad (fecha1, fecha2) = ''xx-xx-xx''          
 --dbo.Fx_Sumar_Antiguedad (ant1, ant2) = ''yy-yy-yy)          
          
CREATE procedure [dbo].[get_antiguedades_Privado]          
          
@documento int = null,          
@desde datetime = null,          
@hasta datetime = null,          
@tipo char(1) = null                
as          
set nocount on          
          
--declare @documento int          
--declare @desde datetime          
--declare @hasta datetime          
--declare @tipo char(1)           
          
--set @documento = null --17237545          
--set @desde = null          
--set @hasta = null          
--set @tipo = NULL --''M''  ''P''   ''E''          
          
create table #t          
( item int identity(1,1),          
  desde smalldatetime,          
  hasta smalldatetime,          
  documento int)          
          
create table #t2          
( item int identity(1,1),          
  desde datetime,          
  hasta datetime,          
  documento int)          
          
          
          
create table #a          
(documento int,          
antiguedad varchar(10))          
          
           
insert into #t          
select  distinct fecha_desde, fecha_hasta, doc_titular           
from leg_servicios_adm_publica          
where (doc_titular = @documento or @documento IS NULL) AND          
 (fecha_desde >=  @desde or @desde is null) AND          
 (fecha_hasta <= @hasta or @hasta is null) and          
 (''E'' =  @tipo or @tipo is null) AND          
 datodebaja = 0           
          
          
insert into #t          
select  distinct fecha_desde, fecha_hasta, documento           
from leg_otros_servicios          
where (documento = @documento or @documento IS NULL) AND          
 (fecha_desde >=  @desde or @desde is null) AND          
 (fecha_hasta <= @hasta or @hasta is null) and          
 (''P'' =  @tipo or @tipo IS NULL) AND          
 datodebaja = 0           
          
          
          
insert into #t          
select  fecha_Min,           
 case when @hasta IS NULL then          
  getdate()          
 else          
  @hasta          
 end FechaHasta,           
 nro_doc          
from dbo.designaciones_fechas          
where (nro_doc = @documento or @documento IS NULL) AND          
 (fecha_Min >=  @desde or @desde is null) AND          
 (fecha_Min <= @hasta or @hasta is null) and          
-- (''M'' =  @tipo or @tipo IS NULL) and          
 (''E'' = @tipo or @tipo IS NULL)  --esto se lo agrego para que antiguedad en el estado incluya el ministerio.          
          
          
declare @i int          
set @i = 1          
          
          
insert into #t2          
select desde, hasta, documento from #t          
order by documento, desde asc, hasta desc          
          
-- AGREGA AQUELLAS PERSONAS QUE NO TIENEN ANTIGUEDAD          
insert into #t2          
select  ''01/01/1900'',''01/01/1900'' , nro_documento          
from datos_personales dp          
left join #t t          
 ON t.documento = dp.nro_documento          
where (t.documento is null AND @Documento IS NULL)          
          
          
          
declare @fdesde datetime          
declare @fhasta datetime          
declare @doc int          
declare @Antiguedad varchar(10)          
          
set @fdesde = ''01/01/1900''          
set @fhasta = ''01/01/9999''          
set @doc = 0          
set @antiguedad = ''00-00-00''          
          
--select * from #t2          
          
          
WHILE @i <= (select count(*) from #t2) BEGIN          
          
 -- INICIA VARIABLES DE LA PERSONA           
 set @doc = (select documento from #t2 where item = @i)          
 set @fdesde = (select desde from #t2 where item = @i)          
 set @fhasta = (select hasta from #t2 where item = @i)          
 set @antiguedad = ''00-00-00''          
           
 set @antiguedad = dbo.Fx_Sumar_Antiguedad(@antiguedad, dbo.Fx_Calcula_Antiguedad (@fdesde, @fhasta))          
 set @i = @i + 1           
 while @doc = (select documento from #t2 where item = @i) BEGIN          
  IF ((select desde from #t2 where item = @i) >= @fhasta)  BEGIN          
	   set @fdesde = (select desde from #t2 where item = @i) --@fhasta           
	   IF ((select desde from #t2 where item = @i) = @fhasta) BEGIN          
	    set @fdesde = @fdesde + 1 --@fhasta + 1           
	   END          

	   set @fhasta = (select hasta from #t2 where item = @i)          
	   set @antiguedad = dbo.Fx_Sumar_Antiguedad(@antiguedad, dbo.Fx_Calcula_Antiguedad (@fdesde, @fhasta))          
	   set @i = @i + 1          
	   END          
  ELSE IF ((select desde from #t where item = @i) <= @fhasta) AND  ((select hasta from #t2 where item = @i) >= @fhasta) BEGIN          
	   set @fdesde = @fhasta + 1           
	   set @fhasta = (select hasta from #t2 where item = @i) 

	   IF 	(select hasta from #t2 where item = @i) = @hasta BEGIN
	      set @fhasta = @fhasta + 1 
	   END	
	   set @antiguedad = dbo.Fx_Sumar_Antiguedad(@antiguedad, dbo.Fx_Calcula_Antiguedad (@fdesde, @fhasta))          
	   set @i = @i + 1          
	  END          
  ELSE BEGIN          
	   set @i = @i + 1          
	  END          

 END          
          
 -- GUARDA ANTIGUEDAD DE LA PERSONA          
 insert into #a          
 values (@doc, @antiguedad)           
           
END           
          
select *       
into tmp_antiguedad_privado      
from #a          
          
drop table #t          
drop table #t2          
drop table #a          
          
set nocount off        
        
      
    
  

' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Calcula_Antiguedad_Asistencia]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Calcula_Antiguedad_Asistencia]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_Calcula_Antiguedad_Asistencia] 
(@F1 datetime ,@F2 datetime)  
RETURNS  varchar(10)

BEGIN 

declare @return_value char(8)


--Contabiliza un mes mas si dias es > 15
set @return_value = 

case when right(dbo.Fx_Calcula_Antiguedad(@F1, @F2), 2) < 15 then 
	dbo.Fx_Calcula_Antiguedad(@F1, @F2)
else 
	dbo.fx_sumar_antiguedad(dbo.Fx_Calcula_Antiguedad(@F1, @F2), ''00-01-00'')
end

RETURN isnull(@return_value, ''00-00-00'')

END' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_TMP_Serv_Jubilatorios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_TMP_Serv_Jubilatorios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_TMP_Serv_Jubilatorios]  
 @Id_interna int    
as    
  

create table #Serv
	(Id int identity (1,1),
	Id_interna int,
	Corresponde varchar(100),
	Caja varchar (100),
 	Afiliado Varchar(100),
	Desde datetime,
	Hasta datetime,
	Antiguedad varchar(100),
	Ant_total varchar(100),
	DesdeOriginal datetime,
  	HastaOriginal datetime)


insert into #Serv (id_interna, corresponde, caja, afiliado, desde, hasta, antiguedad, Ant_total, desdeoriginal, hastaoriginal)

select distinct     
 sap.id_interna,     
 ''Estado''  Corresponde,    
 caja,    
 afiliado,    
 fecha_desde ,    
 fecha_hasta ,    
-- ''00-00-00'', --no_computa ,    
-- dbo.Fx_Restar_Antiguedad (dbo.fx_Calcula_Antiguedad (fecha_desde,fecha_hasta),no_computa) Antiguedad,    
 dbo.fx_Calcula_Antiguedad (fecha_desde,fecha_hasta) Antiguedad,    
 a.Ant_total,    
 convert(char(10),fecha_desde,103) DesdeOriginal,    
 convert(char(10),fecha_hasta,103) HastaOriginal    
     

FROM dbo.LEG_Servicios_adm_publica SAP    
INNER JOIN dbo.antiguedad A    
 on a.id_interna = sap.id_interna    
INNER JOIN dbo.designaciones_fechas DF    
 on DF.id_interna= sap.id_interna    
WHERE  SAP.id_interna=  @Id_interna  AND    
 DatoDeBaja = 0     
--MLD: 04-09-06: SE TOMA EN CUENTA PARA LA ANTIGUEDAD, SE    
-- USA PARA REINCORPORACIONES    
--AND    
-- datonoimprime = 0    
union    
select distinct     
 ots.id_interna,    
 ''Privado'' Corresponde,    
 caja,    
 afiliado,    
 fecha_desde desde,    
 fecha_hasta hasta,    
-- no_computa ,    
-- dbo.Fx_Restar_Antiguedad (dbo.fx_Calcula_Antiguedad (fecha_desde,fecha_hasta),no_computa) Antiguedad,    
 dbo.fx_Calcula_Antiguedad (fecha_desde,fecha_hasta) Antiguedad,    
 a.Ant_total,    
 convert (char(10),fecha_desde,103) DesdeOriginal,     
 convert (Char(10),fecha_hasta,103) HastaOriginal    
     
from dbo.LEG_otros_servicios OTS    
INNER JOIN dbo.antiguedad A    
 on a.id_interna = OTS.id_interna    
INNER JOIN dbo.designaciones_fechas DF    
 on DF.id_interna= ots.id_interna    
WHERE OTS.id_interna =  @Id_interna  AND     
 DatoDeBaja = 0     
--MLD: 04-09-06: SE TOMA EN CUENTA PARA LA ANTIGUEDAD, SE    
-- USA PARA REINCORPORACIONES    
--AND    
-- datonoimprime = 0    
order by fecha_desde ,fecha_hasta ,corresponde    
    
    
declare @fecha_min datetime    
declare @Desde datetime    
Declare @ULtimohasta datetime    
declare @i int    
    
    
-- DETERMINACION DE DIAS A DESCONTAR POR LICENCIAS QUE NO GENERAN  ANTIGUEDAD    
-- *** --    
declare @NoGenerarAnt varchar(8)    
Set @NoGenerarAnt = (SELECT dbo.fx_calcula_antiguedad (convert(datetime,''01/01/1900''), dateadd (d, sum(datediff(d,ls.desde,ls.hasta)),''01/01/1900''))     
 FROM licencias_solicitadas LS    
 INNER join dbo.tabla_conceptos_licencias TCL    
  ON TCL.id_concepto = ls.concepto    
 INNER join dbo.designaciones_fechas DF    
  ON df.id_interna = ls.id_interna    
 WHERE   tcl.GeneraDerechoOrdinaria =0 AND    
  ls.desde >= df.fecha_Min AND    
  ls.id_interna = @ID_INTERNA )    
    
-- *** --    
    
    
    
Declare @Cantidad int
set @Cantidad = (Select count(*) from #Serv)    
    
    
set @i = 1        
set @fecha_min = (select fecha_min from designaciones_fechas where id_interna = @id_interna)    
set @ULtimohasta = (select hasta from #serv where id = @i)    

    
-- DETERMINACION DE SUPERPOSICION DE FECHAS --    
-- * --    

set @i = @i + 1        
WHILE @i <= @Cantidad BEGIN        
 IF (select desdeOriginal from #serv where id = @i) > @UltimoHasta begin        
  update #serv      
     set DEsde = desdeoriginal,        
         hasta = case when hastaoriginal > @Fecha_min THEn @Fecha_min ELSE Hastaoriginal END        
  where id = @I        
 END        
 ELSE         
 BEGIN        
  update #serv
     set Desde = dateadd("D",1,@UltimoHasta),        
         hasta = case when hastaOriginal > @Fecha_min THEn @Fecha_min ELSE HastaOriginal END        
  where id = @I        
 END        
 IF (select HastaOriginal from #Serv where id = @i) > @ultimohasta BEGIN        
  set @ultimohasta = (select Hastaoriginal from #serv where id = @i)        
 END         
 IF @UltimoHAsta > @Fecha_min BEGIN        
  Set @UltimoHasta = @Fecha_min
 END        
         
 set @i = @i + 1        
END 

-- * --    
    
Delete from dbo.TMP_LEG_Servicios_Jubilatorios where id_interna = @id_interna    
    
insert into dbo.TMP_LEG_Servicios_Jubilatorios    
select  id_interna,    
 Corresponde,     
 caja,     
 afiliado,    
-- fecha_desde,     
-- fecha_hasta,     
 ''00-00-00'', -- no_computa,     
 Antiguedad,     
 Ant_total,     
 convert(char(10),DesdeOriginal, 103) DesdeOriginal,    
 convert(char(10),HastaOriginal, 103)HastaOriginal,    
--DESDE,
-- HASTA,
 dbo.fx_Calcula_Antiguedad (desde,hasta) AntiguedadAReconocer,    
-- dbo.Fx_Restar_Antiguedad (dbo.fx_Calcula_Antiguedad (fecha_desde,fecha_hasta),no_computa) AntiguedadAReconocer,    
 convert(char(10),@fecha_min,103) FechaMinisterio,    
-- dbo.fx_Calcula_Antiguedad (@Fecha_min,getdate())AntiguedadMinisterio    
-- antiguedad en el ministerio - no computable para Ordinarias    
 dbo.Fx_Restar_Antiguedad(dbo.fx_Calcula_Antiguedad (@Fecha_min,case when (select fecha_baja from dbo.legajo_bajas where id_interna = @id_interna) is null then    
      getdate()    
    else    
       (select fecha_baja from dbo.legajo_bajas where id_interna = @id_interna)      
    end) , @NoGenerarAnt)  AntiguedadMinisterio    
    
FROM #serv
    
    

drop table #serv
    
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[get_antiguedades]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[get_antiguedades]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'--FUNCIONES:
	--dbo.Fx_Calcula_Antiguedad (fecha1, fecha2) = ''xx-xx-xx''
	--dbo.Fx_Sumar_Antiguedad (ant1, ant2) = ''yy-yy-yy)

CREATE procedure [dbo].[get_antiguedades]

@documento int = null,
@desde datetime = null,
@hasta datetime = null,
@tipo char(1) = null

as
set nocount on

--declare @documento int
--declare @desde datetime
--declare @hasta datetime
--declare @tipo char(1) 

--set @documento = null --17237545
--set @desde = null
--set @hasta = null
--set @tipo = NULL --''M''  ''P''   ''E''

create table #t
( item int identity(1,1),
  desde smalldatetime,
  hasta smalldatetime,
  documento int)

create table #t2
( item int identity(1,1),
  desde datetime,
  hasta datetime,
  documento int)



create table #a
(documento int,
antiguedad varchar(10))

	
insert into #t
select  distinct fecha_desde, fecha_hasta, doc_titular 
from leg_servicios_adm_publica
where (doc_titular = @documento or @documento IS NULL) AND
	(fecha_desde >=  @desde or @desde is null) AND
	(fecha_hasta <= @hasta or @hasta is null) and
	(''E'' =  @tipo or @tipo is null) AND
	datodebaja = 0 


insert into #t
select  distinct fecha_desde, fecha_hasta, documento 
from leg_otros_servicios
where (documento = @documento or @documento IS NULL) AND
	(fecha_desde >=  @desde or @desde is null) AND
	(fecha_hasta <= @hasta or @hasta is null) and
	(''P'' =  @tipo or @tipo IS NULL) AND
	datodebaja = 0 



insert into #t
select  fecha_Min, 
	case when @hasta IS NULL then
		getdate()
	else
		@hasta
	end FechaHasta, 
	nro_doc
from dbo.designaciones_fechas
where (nro_doc = @documento or @documento IS NULL) AND
	(fecha_Min >=  @desde or @desde is null) AND
	(fecha_Min <= @hasta or @hasta is null) and
	(''M'' =  @tipo or @tipo IS NULL) and
	(''E'' = @tipo or @tipo IS NULL)  --esto se lo agrego para que antiguedad en el estado incluya el ministerio.


declare @i int
set @i = 1


insert into #t2
select desde, hasta, documento from #t
order by documento, desde asc, hasta desc

-- AGREGA AQUELLAS PERSONAS QUE NO TIENEN ANTIGUEDAD
insert into #t2
select  ''01/01/1900'',''01/01/1900'' , nro_documento
from datos_personales dp
left join #t t
	ON t.documento = dp.nro_documento
where (t.documento is null AND @Documento IS NULL)



declare @fdesde datetime
declare @fhasta datetime
declare @doc int
declare @Antiguedad varchar(10)

set @fdesde = ''01/01/1900''
set @fhasta = ''01/01/9999''
set @doc = 0
set @antiguedad = ''00-00-00''

--select * from #t2


WHILE @i <= (select count(*) from #t2) BEGIN

	-- INICIA VARIABLES DE LA PERSONA	
	set @doc = (select documento from #t2 where item = @i)
	set @fdesde = (select desde from #t2 where item = @i)
	set @fhasta = (select hasta from #t2 where item = @i)
	set @antiguedad = ''00-00-00''
	
	set @antiguedad = dbo.Fx_Sumar_Antiguedad(@antiguedad, dbo.Fx_Calcula_Antiguedad (@fdesde, @fhasta))
	set @i = @i + 1	
	while @doc = (select documento from #t2 where item = @i) BEGIN
		IF ((select desde from #t2 where item = @i) >= @fhasta)  BEGIN
			set @fdesde = @fhasta 
			IF ((select desde from #t2 where item = @i) = @fhasta) BEGIN
				set @fdesde = @fhasta + 1 
			END
			set @fhasta = (select hasta from #t2 where item = @i)
			set @antiguedad = dbo.Fx_Sumar_Antiguedad(@antiguedad, dbo.Fx_Calcula_Antiguedad (@fdesde, @fhasta))
			set @i = @i + 1
 		END
		ELSE IF ((select desde from #t where item = @i) <= @fhasta) AND  ((select hasta from #t2 where item = @i) >= @fhasta) BEGIN
			set @fdesde = @fhasta + 1 
			set @fhasta = (select hasta from #t2 where item = @i)
			set @antiguedad = dbo.Fx_Sumar_Antiguedad(@antiguedad, dbo.Fx_Calcula_Antiguedad (@fdesde, @fhasta))
			set @i = @i + 1
		END
		ELSE BEGIN
			set @i = @i + 1
		END
	END

	-- GUARDA ANTIGUEDAD DE LA PERSONA
	insert into #a
	values (@doc, @antiguedad) 
	
END 

select * from #a

drop table #t
drop table #t2
drop table #a

set nocount off' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Antiguedad_Grado]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Antiguedad_Grado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CTR_GET_Antiguedad_Grado]            
  @Nro_Documento int,            
  @FechaCorte datetime            
as
SET NOCOUNT ON            
            
-- SERVICIOS ADM PUBLICA            
select distinct             
  sap.Doc_Titular Nro_Documento,             
  ''Estado''  Corresponde,            
  fecha_desde ,            
  fecha_hasta ,            
  dbo.fx_Calcula_Antiguedad (fecha_desde,            
  case when fecha_hasta > @FechaCorte THEN            
    @FechaCorte            
  else              
    fecha_hasta            
  END)Antiguedad,            
  convert(char(10),fecha_desde,103) DesdeOriginal,            
  case when fecha_hasta > @FechaCorte THEN            
   convert(char(10),@FechaCorte,103)            
  else              
   convert(char(10),fecha_hasta,103)             
  END HastaOriginal,            
  SAP.Id,            
  Organismo,            
  folio,            
  TFC.Descripcion  Cargo            
INTO #Servicios            
FROM dbo.LEG_Servicios_Adm_Publica SAP            
INNER JOIN dbo.Tabla_Funciones_Cargos TFC            
 ON TFC.Id = SAP.Cargo            
WHERE  SAP.Doc_Titular =  @Nro_Documento AND            
  DatoDeBaja = 0             
            
            
UNION -- OTROS SERVICIOS            
            
select distinct             
 ots.Documento Nro_Documento,            
 ''Privado'' Corresponde,            
 fecha_desde desde,            
 fecha_hasta hasta,            
 dbo.fx_Calcula_Antiguedad (fecha_desde,            
 case when fecha_hasta > @FechaCorte THEN            
 @FechaCorte            
 else              
 fecha_hasta            
 END            
 ) Antiguedad,            
 convert (char(10),fecha_desde,103) DesdeOriginal,             
 case when fecha_hasta > @FechaCorte THEN            
 convert(char(10),@FechaCorte,103)            
 else              
 convert(char(10),fecha_hasta,103)             
 END HastaOriginal,            
         
 OTS.Id,            
 Institucion,            
 Folio,            
 TFC.Descripcion Cargo            
FROM dbo.LEG_otros_servicios OTS            
INNER JOIN dbo.Tabla_Funciones_Cargos TFC            
  ON TFC.Id = OTS.Cargo            
WHERE OTS.Documento =  @Nro_Documento  AND             
  DatoDeBaja = 0             
        
            
UNION         

-----Desde aca COMENTE FAML 14/10/2009                      
--SELECT  Nro_Doc Nro_Documento,            
--  ''Ingreso Ministerio'',            
--  fecha_min Desde,            
--  @FechaCorte,            
--  dbo.fx_Calcula_Antiguedad (fecha_min,@FechaCorte) Antiguedad,            
--  convert (char(10),fecha_min,103) DesdeOriginal,             
--  convert (Char(10),@FechaCorte,103) HastaOriginal,            
--  999999 Id,            
--  ''Ministerio'',            
--  ''00-000/000'',            
--  '''' Cargo            
--FROM dbo.Designaciones_fechas df            
--WHERE Nro_Doc  = @Nro_Documento        
--ORDER BY fecha_desde   --GER: 01/11/2007
-----Hasta aca COMENTE FAML 14/10/2009          


-----Desde aca agregue FAML 14/10/2009 
--Trae los contratos de la ctr_contrato en reemplazo de lo que era antiguedad de ministerio         
select
	ctr.nro_documento Nro_Documento
	,''Ministerio''
	,ctr.Desde Desde
	,CASE ctrbajas.Fecha_Baja
		 WHEN Null THEN @FechaCorte
		 ELSE ctrbajas.Fecha_Baja
	END  
		as Hasta
	,CASE ctrbajas.Fecha_Baja
		 WHEN Null THEN dbo.fx_Calcula_Antiguedad (ctr.Desde,@FechaCorte)
		 ELSE dbo.fx_Calcula_Antiguedad (ctr.Desde,
					case when ctrbajas.Fecha_Baja > @FechaCorte 
						THEN @FechaCorte
						else ctrbajas.Fecha_Baja
						END
						)
	END  
		as Antiguedad
	,convert(char(10),ctr.Desde,103) DesdeOriginal            
	,CASE ctrbajas.Fecha_Baja
		WHEN Null THEN convert(char(10),@FechaCorte,103)
		ELSE case when ctr.Hasta > @FechaCorte 
			THEN convert(char(10),@FechaCorte,103)
			else convert(char(10),ctrbajas.Fecha_Baja,103)
			end             
	  END HastaOriginal            
	,ctr.Id_Contrato
	,''Min. Desarrollo Social''
	,''00-000/000''
	--trae el Cargo
	,CASE ctr.tipo_contrato
		 WHEN 1 THEN ''Contrato (Nivel '' + ctrniv.Nivel + '')'' + ctrtipo.Descripcion
		 WHEN 2 THEN ''Contrato ('' + ctrfunc.Descripcion + '')'' + ctrtipo.Descripcion
		 ELSE ''Contrato MDS''
	END  
		as Cargo
from dbo.CTR_Contratos CTR
	left join dbo.CTR_Contratos_Bajas ctrbajas
		on ctr.nro_documento = ctrbajas.nro_documento and ctr.id_contrato = ctrbajas.id_contrato
	left join dbo.Tabla_Funciones_Contratos ctrfunc
		on ctrfunc.id=ctr.funcion
	left join dbo.Tabla_Niveles ctrniv
		on ctrniv.id=ctr.nivel
	left join dbo.Tabla_Resoluciones_Contratos ctrtipo
		on ctrtipo.id=ctr.tipo_contrato
where ctr.aprobado=1 and (ctr.Desde < ctrbajas.Fecha_Baja or ctrbajas.Fecha_Baja is null ) and ctr.Desde < @FechaCorte and ctr.nro_documento = @Nro_Documento 

-----Hasta aca agregue FAML 14/10/2009          

order by fecha_desde, fecha_hasta

           
-- DETERMINACION DE DIAS A DESCONTAR POR LICENCIAS QUE NO GENERAN  ANTIGUEDAD            
-- *** --            
declare @fecha_min datetime 
declare @NoGenerarAnt varchar(8)            

        
Set @NoGenerarAnt = (SELECT dbo.fx_calcula_antiguedad (convert(datetime,''01/01/1900''), dateadd (d, sum(datediff(d,ls.desde,ls.hasta)),''01/01/1900''))             
   FROM dbo.licencias_solicitadas LS            
   INNER join dbo.tabla_conceptos_licencias TCL            
     ON TCL.id_concepto = ls.concepto            
   INNER JOIN dbo.Datos_Personales DP        
   on DP.Id_Interna = ls.Id_interna        
   INNER join dbo.designaciones_fechas DF            
     ON df.Nro_Doc = dp.Nro_Documento        
   WHERE   tcl.GeneraDerechoOrdinaria =0 AND            
     ls.desde >= df.fecha_Min AND            
     DP.Nro_Documento = @Nro_Documento )            

-- *** --            
        

set @fecha_min = (select top 1 fecha_min from dbo.designaciones_fechas where Nro_Doc = @Nro_Documento)            

        
           
-- -- ELIMINA REGISTROS POSTERIORES A LA FECHA DE INGRESO AL MINISTERIO --            
-- -- ** --            
-- update #servicios            
-- set fecha_hasta = @fecha_min-1--,            
-- where fecha_hasta > @fecha_min and corresponde <> ''Ingreso Ministerio''          
--    /*        
-- update #servicios             
--   set fecha_hasta = null,            
--       fecha_desde = null        
-- where fecha_desde >= @fecha_MIn AND            
--       Corresponde <> ''EstadoCtr''            
-- */        
--DELETE T        
--FROM #Servicios T        
--WHERE Fecha_Desde >=@Fecha_Min and corresponde <> ''Ingreso Ministerio''      
        
            
 -- ** --            
            
SELECT Nro_Documento,            
 Corresponde,             
  fecha_desde,             
  fecha_hasta,             
 -- no_computa,             
  dbo.fx_Antiguedad_En_Meses (Antiguedad) Antiguedad,             
  convert(char(10),DesdeOriginal, 103) DesdeOriginal,            
  convert(char(10),HastaOriginal, 103)HastaOriginal,            
  dbo.fx_Antiguedad_En_Meses (dbo.fx_Calcula_Antiguedad (fecha_desde,fecha_hasta)) AntiguedadAReconocer,            
  convert(char(10),@fecha_min,103) FechaMinisterio,            
  dbo.fx_Antiguedad_En_Meses (dbo.Fx_Restar_Antiguedad(dbo.fx_Calcula_Antiguedad (@Fecha_min,case when (select fecha_baja from dbo.legajo_bajas where Nro_doc = @Nro_Documento) is null then            
       getdate()            
     else            
        (select fecha_baja from dbo.legajo_bajas where Nro_Doc = @Nro_Documento)              
     end) , @NoGenerarAnt)  ) AntiguedadMinisterio,            
  id,            
  Organismo,            
  folio,            
  Cargo            
INTO #Ctr_Antiguedades            
FROM #servicios            
            
SELECT * FROM #ctr_Antiguedades            
order by fecha_desde , id  
        
            
DROP TABLE #servicios            
DROP TABLE #Ctr_Antiguedades
' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[fx_meses_entre_fechas]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[fx_meses_entre_fechas]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 10/10/2008
-- Description:	Devuelve la cantidad de meses entre dos fechas (o fraccion mayor a 15 dias)
-- =============================================
CREATE FUNCTION [dbo].[fx_meses_entre_fechas] 
(
	-- Add the parameters for the function here
	@fecha1 smalldatetime,
	@fecha2 smalldatetime
)
RETURNS int
AS
BEGIN
	declare @antiguedad char(8)
	declare @meses int
	declare @dias int
	
	set @antiguedad = dbo.fx_calcula_antiguedad(@fecha1, @fecha2)

	set @meses = right(left(@antiguedad,5),2)
	set @dias = cast(right(@antiguedad, 2) as int)
	
	if  @dias >= 15 begin
		set @meses = @meses + 1 	
	end

	return @meses
END
' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Get_Antiguedad_Total_A_Hoy]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Get_Antiguedad_Total_A_Hoy]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: ''01/12/2008''
-- Description:	Trae la antiguedad Total, desde el ingreso al ministerio a hoy
-- =============================================
CREATE FUNCTION [dbo].[Fx_Get_Antiguedad_Total_A_Hoy]
(
	@fecha_min smalldatetime,
	@fecha_calculo smalldatetime,
	@antiguedad_anterior  char(8)
)
RETURNS char(10)
AS
BEGIN
	return dbo.fx_sumar_antiguedad(dbo.Fx_Calcula_Antiguedad(@fecha_min, @fecha_calculo), @antiguedad_anterior)
END' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[fx_cumplio_antiguedad]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[fx_cumplio_antiguedad]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'

-- =============================================
-- Author:		Agustin
-- Create date: ''01/12/2008''
-- Modification date: ''03/12/2010''
-- Description:	Verifica si una persona ya cumplio la antiguedad necesaria
-- =============================================
CREATE FUNCTION [dbo].[fx_cumplio_antiguedad] 
(
	@años_antiguedad char(8),
	@fecha_min smalldatetime,
	@antiguedad_anterior char(8),
	@fecha_calculo smalldatetime
)
RETURNS bit
AS
BEGIN
	return
	
	case when
		(
		cast (@años_antiguedad as int) > cast(left(dbo.fx_sumar_antiguedad(dbo.Fx_Calcula_Antiguedad(@fecha_min, @fecha_calculo), @antiguedad_anterior), 2) as int)
		--@años_antiguedad > left(dbo.fx_sumar_antiguedad(dbo.Fx_Calcula_Antiguedad(@fecha_min, @fecha_calculo), @antiguedad_anterior), 2) 
		)
		then 0 else 1 end
	--		@años_antiguedad < left(dbo.fx_sumar_antiguedad(dbo.Fx_Calcula_Antiguedad(@fecha_min, @fecha_calculo), @antiguedad_anterior), 2) 
	--		and dbo.fx_get_dias_de_antiguedad(dbo.fx_sumar_antiguedad(dbo.Fx_Calcula_Antiguedad(@fecha_min, @fecha_calculo), @antiguedad_anterior)) = 0
	--		and dbo.fx_get_meses_de_antiguedad(dbo.fx_sumar_antiguedad(dbo.Fx_Calcula_Antiguedad(@fecha_min, @fecha_calculo), @antiguedad_anterior)) = 0
	--	)
	--	or(
	--		@años_antiguedad <= left(dbo.fx_sumar_antiguedad(dbo.Fx_Calcula_Antiguedad(@fecha_min, @fecha_calculo), @antiguedad_anterior), 2) 
	--		and (dbo.fx_get_dias_de_antiguedad(dbo.fx_sumar_antiguedad(dbo.Fx_Calcula_Antiguedad(@fecha_min, @fecha_calculo), @antiguedad_anterior)) <> 0
	--		or dbo.fx_get_meses_de_antiguedad(dbo.fx_sumar_antiguedad(dbo.Fx_Calcula_Antiguedad(@fecha_min, @fecha_calculo), @antiguedad_anterior)) <> 0)
	--	) 
		
	--	then 
	--		1
	--	else
	--		0
	--	end
END


' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[fx_anios_entre_fechas]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[fx_anios_entre_fechas]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: ''01/12/2008''
-- Description:	Te devuelve true aun no se cumplio un año de antiguedad
-- =============================================
CREATE FUNCTION [dbo].[fx_anios_entre_fechas]
(
	@fecha1 smalldatetime,
	@fecha2 smalldatetime
)
RETURNS int
AS
BEGIN
	
	return
	(
		dbo.fx_get_años_de_antiguedad
		(
			dbo.Fx_Calcula_Antiguedad
			(
				@fecha1, @fecha2
			)
		)
	)

END
' 
END
GO
/****** Object:  View [dbo].[VW_maxid_factura]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_maxid_factura]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_maxid_factura]
as
select max(id_factura) id_factura 
from CTR_Facturas







'
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Facturas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Facturas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_GET_Facturas]
	@Doc int
AS
SELECT f.id_factura, 
f.nro_factura,
f.documento, 
--c.id_contrato, 
dp.cuil_nro, 
--f.mes_factura, 
--f.año_factura, 
f.fecha_factura, 
f.fecha_recibida, 
f.fecha_pase_cont, 
--f.nro_resolucion, 
--c.acto_nro,
--f.acto_tipo, 
f.monto_factura, 
f.anulada, 
dp.apellido, 
dp.nombre, 
f.Area, 
f.firmante
--c.desde,
--c.hasta 

FROM ctr_Facturas f

left join CTR_Facturas_Detalle FD
	on FD.id_factura=f.id_factura

inner join datos_personales dp
	on dp.nro_documento=f.documento	

--inner join ctr_contratos c
--	on c.id_contrato=ip.id_contrato

where f.documento=@doc and f.anulada=0 

--order by f.año_factura desc , f.mes_factura desc
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Mostrar_Pases]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Mostrar_Pases]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[CTR_GET_Mostrar_Pases]
AS
SELECT f.Documento,	
	dp.Apellido, 	
	dp.Nombre, 
	dp.cuil_nro,
	f.Nro_Factura,
	f.monto_factura,
	f.Fecha_Recibida,	
	ta.Descripcion Area,
	--fc.apellido Firmante,
	ttt.Descripcion +'' ''+ DPF.Apellido +'' ''+ DPF.Nombre Firmante,
	f.id_factura
 
from CTR_Facturas f

LEFT join dbo.vw_desglose_area da
	on f.documento = da.documento

LEFT join dbo.Tabla_Areas TA
	on TA.id = da.id_area

inner join dbo.datos_personales DP
	on dp.nro_documento= f.documento

--inner join dbo.CFirmantes_Contratos FC
--	on fc.id= f.firmante
inner join dbo.Tabla_Firmantes TFC
	on TFC.id = f.firmante
inner join dbo.datos_personales DPF
	on TFC.nro_documento=DPF.nro_documento
inner join dbo.tabla_tratamientos TT
	on TT.id=tfc.id_tratamiento
inner join dbo.tabla_tratamientos_titulos TTT
	on TTT.id=tfc.id_titulo


where (fecha_pase_cont is null) and f.anulada=0

group by f.nro_factura,	
	f.documento, 
	dp.apellido, 
	dp.nombre, 
	dp.cuil_nro,
	f.monto_factura,
	f.fecha_recibida,	
	ta.descripcion,
	--fc.apellido ,
	ttt.Descripcion +'' ''+ DPF.Apellido +'' ''+ DPF.Nombre,
	f.id_factura 

order by  dp.apellido,nro_factura

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Controla_Factura_Cargado]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Controla_Factura_Cargado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_GET_Controla_Factura_Cargado]
	@doc int,
	@nro_fact char(13)
as

Select nro_factura
from ctr_facturas
where documento=@doc and nro_factura=@nro_fact 
	and anulada=0

' 
END
GO
/****** Object:  View [dbo].[VW_GET_ReImpresion_Pases]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_GET_ReImpresion_Pases]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_GET_ReImpresion_Pases]
as

select top 100 percent fecha_pase_cont,nro_pase_cont 
from CTR_Facturas
where (fecha_pase_cont is not null or fecha_pase_cont<>'''')and nro_pase_cont<>0

group by fecha_pase_cont,nro_pase_cont
order by fecha_pase_cont

'
GO
/****** Object:  StoredProcedure [dbo].[CTR_ADD_Facturas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ADD_Facturas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_ADD_Facturas]
	(@Doc 			[int],
	@Fecha_factura 	[smalldatetime],
	@Nro_factura 		[varchar](13),
	@Fecha_recibida	[smalldatetime],	
	@monto 		money,	 
	@area 			int,
	@firma 			smallint,
	@Fecha_pase		[smalldatetime]=null)
	
AS 
DECLARE @ID [INT]
set @id = (select max(id_factura) +1 from dbo.CTR_Facturas)
if @id is null begin
	set  @id =1
end

INSERT INTO [dbo].[CTR_Facturas] 
	 ( [Id_factura],
	[documento],
	[Fecha_factura],
	[Nro_factura],	
	[Fecha_recibida],	
	monto_factura,
	Area,
	firmante,
	[Fecha_pase_cont])
 
VALUES 
	( @Id,
	 @doc,
	 @Fecha_factura,	
	@Nro_factura,
	 @Fecha_recibida,
	@monto,
	@area,
	@firma,
	 @Fecha_pase)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Saldo_Factura_Anular]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Saldo_Factura_Anular]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[CTR_GET_Saldo_Factura_Anular]
@doc int,
@nro_Fact char(13)
AS

select 	f.monto_factura Total_Factura,
	fd.mes_factura,
	fd.año_factura,
	fd.monto_factura,
	fd.id_contrato
from ctr_facturas f
inner join ctr_facturas_detalle fd
	on fd.id_factura=f.id_factura
where f.documento=@doc 
	and f.anulada=0 
	and nro_factura=@nro_fact


/*
set nocount on
create table #Saldos -- CARGA TODOS LOS CONTRATOS Y SU MONTO MENSUAL
	(id int identity(1,1),
	desde datetime,	
	hasta datetime, 
	monto money,
	id_contrato int,
	nro_contrato char(11))

insert into #saldos 
SELECT desde, 
	case when cb.fecha_baja is null then
		case when cc.hasta > getdate() then
			cast(''30/'' +  cast(month(getdate()) as varchar)  +''/''+ cast(year(getdate())as varchar)  as datetime)
		else
			cc.hasta
		end
	else
		cb.fecha_baja
	end,
	cc.monto,
	cc.id_contrato,
	cc.nro_contrato 
FROM dbo.ctr_contratos CC
LEFT JOIN dbo.ctr_contratos_bajas  CB
	on cb.id_contrato = cc.id_contrato
where aprobado = 1 And
cc.nro_documento = @doc 
and year(cc.desde) > 2005


create table #Resultados -- GUARDA CtaCte
	(mes int,
	año int,
	montop money,	
	id_contrato int,
	nro_contrato char(11))

declare @Fi datetime
declare @Ff datetime
declare @id int
set @id = 1
Set @Fi  = (select desde from #saldos where id = @Id)
Set @Ff  = (select hasta from #saldos where id = @Id)

while @id <= (select count(desde) from #Saldos) BEGIN -- CANTIDAD DE CONTRATOS
	
	WHILE 	@fi <= @ff BEGIN --MESES DE CADA CONTRATO
		INSERT INTO #resultados
		SELECT 	month(@fi), 
			year(@fi),
			case when day(desde) > 1 and (month(desde) = month(@fi)) then		
				(monto  / 30) * (30 - day(desde))
			else
				case when day(hasta) < 30 and ((month(@fi) = month(@ff) and year(@fi) = year(@ff))) then		
					(monto  / 30) * (day(hasta))
				else
					monto
				end
			end,
			id_contrato,
			nro_contrato
		FROM #Saldos where id = @Id
		Set @fi = dateadd(month,1,@fi)
	END	
	set @Id = @Id + 1
	Set @Fi  = (select desde from #saldos where id = @Id)
	Set @Ff  = (select hasta from #saldos where id = @Id)

END	


create table #Facturas -- GUARDA FACTURAS
	(mes_factura int,
	año_factura int,
	id_cont int,
	monto_factura money)

insert into #facturas
select 	fd.mes_factura,
	fd.año_factura,
	fd.id_contrato,
	sum(fd.monto_factura)Suma_monto_Factura
from ctr_facturas f
inner join ctr_facturas_detalle fd
	on f.id_factura=fd.id_factura 
where f.documento=@doc and f.anulada=0 and nro_factura=@nro_fact
group by fd.mes_factura,fd.año_factura,fd.id_contrato


create table #Monto_Facturas -- GUARDA MONTO FACTURAS ORIG.
	(mes_factura int,
	año_factura int,
	Id_cont int,
	monto_factura_total_imputado money)

insert into #Monto_Facturas
select 	fd.mes_factura,
	fd.año_factura,
	fd.id_contrato,
	sum(fd.monto_factura)
from ctr_facturas f
inner join ctr_facturas_detalle fd
	on f.id_factura=fd.id_factura 
where f.documento=@doc and f.anulada=0 
group by fd.mes_factura,fd.año_factura,fd.id_contrato



select 	mes Mes_Cont, 
	año Año_Cont, 
	sum(montop)Monto_Cont,
	sum(isnull(monto_factura,0))Monto_Factura, 
	monto_factura_total_imputado - sum(isnull(monto_factura,0)) monto_otras_facturas,
	sum(montop - isnull(monto_factura,0))- (monto_factura_total_imputado - sum(isnull(monto_factura,0)))  saldo_mes,
	id_contrato,
	nro_contrato
FROM  #resultados r 
left join #facturas f
	on r.mes = f.mes_factura and r.año = f.año_factura and r.id_contrato=f.id_cont
left join #monto_facturas mf
	on r.mes = mf.mes_factura and r.año = mf.año_factura and r.id_contrato=mf.id_cont
where monto_factura<>0
group by r.mes,
	r.año,
	monto_factura_total_imputado,
	id_contrato,
	nro_contrato


drop table #Saldos
drop table #resultados
drop table #facturas
drop table #monto_facturas
*/




' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_DELETE_Factura_X_Nro]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_DELETE_Factura_X_Nro]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_DELETE_Factura_X_Nro]
	@id_fact int
AS
delete	CTR_Facturas 
where id_factura=@id_fact

delete	CTR_Facturas_detalle 
where id_factura=@id_fact



' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_CTR_Pases_Factura]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_CTR_Pases_Factura]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE         PROCEDURE  [dbo].[RPT_CTR_Pases_Factura]
	@nro_pase 	int,
	@fecha		char(10)
AS
select 	left(dp.Cuil_Nro,2)+''-''+ right(left(dp.Cuil_Nro,10),8)+''-''+ right(dp.Cuil_Nro,1) Cuil_Nro,
	dp.Apellido +'' ''+ dp.Nombre ApeNom,
	trc.descripcion +'' ''+ replace(c.acto_nro,'' '','''') +''/''+ cast(right(year(c.Acto_Fecha),2) as char(2)) Acto_Adm,
	fd.Monto_Factura,	
	cast((fd.Mes_Factura)as varchar) +''/''+ cast(right(fd.Año_Factura,2)as char(2)) Mes,
	f.Nro_Factura,
	f.Fecha_Recibida,
	f.Fecha_Pase_Cont,
	f.Nro_Pase_cont, 
	--FC.apellido Firmante
	tt.descripcion +'' ''+ ttt.Descripcion +'': ''+ DPF.Apellido +'', ''+ DPF.Nombre  Firmante,
	TA.Descripcion Area,

	case left( right(@fecha,7)  ,2) 
		when ''01'' then ''Enero'' +'' ''+ right(@fecha,4) 
		when ''02'' then ''Febrero'' +'' ''+ right(@fecha,4) 
		when ''03'' then ''Marzo'' +'' ''+ right(@fecha,4) 
		when ''04'' then ''Abril'' +'' ''+ right(@fecha,4) 
		when ''05'' then ''Mayo'' +'' ''+ right(@fecha,4) 
		when ''06'' then ''Junio'' +'' ''+ right(@fecha,4) 
		when ''07'' then ''Julio'' +'' ''+ right(@fecha,4) 
		when ''08'' then ''Agosto'' +'' ''+ right(@fecha,4) 
		when ''09'' then ''Septiembre'' +'' ''+ right(@fecha,4) 
		when ''10'' then ''Octubre'' +'' ''+ right(@fecha,4) 
		when ''11'' then ''Noviembre'' +'' ''+ right(@fecha,4) 
		when ''12'' then ''Diciembre'' +'' ''+ right(@fecha,4) 
	end MesAño 
	         
FROM  CTR_Facturas F

INNER  join dbo.CTR_Facturas_Detalle FD
	on FD.id_factura = F.id_factura 

INNER  join dbo.CTR_Contratos C
	on C.id_contrato=fd.id_contrato

LEFT join dbo.tabla_areas TA
	on TA.id = c.id_area

LEFT join dbo.vw_desglose_area da
	on c.nro_documento = da.documento

INNER join dbo.datos_personales DP
	on dp.nro_documento= f.documento

INNER join dbo.Tabla_Tipos_Resoluciones TRC
	on trc.id=c.acto_tipo

--INNER join dbo.CFirmantes_Contratos FC
--	on fc.id= c.contrato_firmante
INNER join dbo.Tabla_Firmantes TFC
	on TFC.id = C.contrato_firmante
inner join dbo.datos_personales DPF
	on TFC.nro_documento=DPF.nro_documento
inner join dbo.tabla_tratamientos TT
	on TT.id=tfc.id_tratamiento
inner join dbo.tabla_tratamientos_titulos TTT
	on TTT.id=tfc.id_titulo


where nro_pase_cont= @nro_pase  and f.anulada =0

order by ta.descripcion, dp.apellido






' 
END
GO
/****** Object:  View [dbo].[VW_GET_CTR_Nro_Pase]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_GET_CTR_Nro_Pase]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_GET_CTR_Nro_Pase]
as
select max(nro_pase_cont) nro_pase from CTR_Facturas




'
GO
/****** Object:  StoredProcedure [dbo].[CTR_UPD_Pase_Contabilidad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_UPD_Pase_Contabilidad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_UPD_Pase_Contabilidad]

--@doc int,
--@mes varchar(10),
--@fac varchar(20),
@Id_fact int,
@pase smalldatetime,
@nro_pase smallint

AS

update CTR_Facturas set 
	fecha_pase_cont=@pase,
	nro_pase_cont=@nro_pase

where id_factura=@id_fact
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_DEL_Anula_Factura]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_DEL_Anula_Factura]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_DEL_Anula_Factura]
	@id_fact int,
	@Obs varchar(200),
	@User int
AS
update	CTR_Facturas 
set anulada=1,
    Observacion=@obs,
    usuario_anula=@user
where id_factura=@id_fact

update	CTR_Facturas_detalle 
set anulada=1
where id_factura=@id_fact

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_FACTURA_X_NRO]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_FACTURA_X_NRO]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_GET_FACTURA_X_NRO]
	@doc int,
	@nro_fact char(13)
as
select 	f.id_factura,
	f.fecha_factura,
	f.fecha_recibida,
	f.monto_factura,
	f.area,
	f.firmante,
	f.fecha_pase_cont
from ctr_facturas f
where f.documento=@doc and f.anulada=0 and f.nro_factura=@nro_fact
' 
END
GO
/****** Object:  View [dbo].[VW_Cnro_pase]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Cnro_pase]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_Cnro_pase]
as
select max(nro_pase_cont) nro_pase_cont from CTR_Facturas

'
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Facturas_a_Modif]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Facturas_a_Modif]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CTR_GET_Facturas_a_Modif]

@doc int,
@fecha smalldatetime=null,
@nro char(13)=null

as
select 	f.fecha_factura,
	f.nro_Factura
from ctr_facturas f
where f.documento=@doc 
	and (f.fecha_factura=@fecha or @fecha is null)
	and (f.nro_factura=@nro or @nro is null) 
	and f.anulada=0
order by f.fecha_factura
' 
END
GO
/****** Object:  StoredProcedure [dbo].[Get_IdContratoXId]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Get_IdContratoXId]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE   procedure [dbo].[Get_IdContratoXId] 
 @Id int
As
Declare @Cadena varchar(20)
Declare @Dev int
BEGIN
	
set @Cadena = (select Tabla from   dbo.RH_Traspaso_Documentacion where @Id=id and Codigo like ''CAPCL'') 	

set @Dev = dbo.Fx_Split (@Cadena ,'':'',2) 
select @Dev as ''Campo''


END


' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetConcatCodBar]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetConcatCodBar]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE   Procedure [dbo].[GetConcatCodBar]   
  (@Codigo varchar (50))     
  
as   
--este store procedure recibe el codigo ''FRH0301,1,1,1,bleh''  
--devuelve la cadena concatenada para insertar en la tabla otros indices documentos  
DECLARE @CampoAInsertar varchar(60)  
DECLARE @Tipo varchar(10)  
DECLARE @Numero varchar(10)  
DECLARE @Cadena_Id varchar(10)  
DECLARE @Descripcion varchar(60)  
DECLARE @CE_2 varchar(4)  
DECLARE @CE_1 varchar(10)   
DECLARE @Id_Contrato varchar(10)  
DECLARE @NextString varchar(9)   
DECLARE @C_6 varchar(4)  
DECLARE @C_3 varchar(4)  
DECLARE @C_2 varchar(10)  
DECLARE @fecha smalldatetime  
  
set @NextString = dbo.Fx_Split  (@Codigo, '','',1)   
  
 IF (@NextString like ''FRH0307%'') or (@NextString like ''FRH0308%'') or (@NextString like ''FRH0309%'')  
  or (@NextString like ''FRH0310%'') or (@NextString like ''FRH0311%'')   
 Begin  
  set @Tipo = dbo.Fx_Split  (@Codigo, '','',1)       
  set @Numero= dbo.Fx_Split  (@Codigo, '','',3)       
  set @Cadena_Id=@Tipo+''#''+@Numero  
  set @Id_Contrato= dbo.Fx_Split (@Codigo, '','',2)    
  set @Descripcion= (select Id_Comprobante from dbo.Tabla_Cod_Barras where @Cadena_Id like Cadena_Id)   
  set @CE_2 =(select year(Desde)  from  dbo.CTR_Contratos where @Id_Contrato =Id_Contrato)  --el año del contrato   
  set @CE_1 =(select Nro_Documento from dbo.CTR_Contratos where @Id_Contrato =Id_Contrato)  
  set @CampoAInsertar=@Descripcion+''-''+@CE_2+''-''+@CE_1  
  
 End   
   
 IF (@NextString like ''FRH0110%'')   
 Begin   
  set @Tipo = dbo.Fx_Split  (@Codigo, '','',1)       
  set @Numero= dbo.Fx_Split  (@Codigo, '','',3)       
  set @Cadena_Id=@Tipo+''#''+@Numero  
  set @Descripcion= (select Id_Comprobante from dbo.Tabla_Cod_Barras where @Cadena_Id like Cadena_Id)   
  set @C_6 = dbo.Fx_Split (@Codigo, '','',6)   
  set @CE_1= dbo.Fx_Split (@Codigo, '','',2)      
  set @CampoAInsertar=@Descripcion+''-''+@C_6+''-''+@CE_1   
  
 End  
  
 IF (@NextString like ''FRH0101%'' )  
 Begin   
  set @Tipo = dbo.Fx_Split (@Codigo, '','',1)  
  set @Numero = dbo.Fx_Split (@Codigo,'','',4)  
  set @Cadena_Id=@Tipo+''#''+@Numero  
  set @Descripcion= (select Id_Comprobante from dbo.Tabla_Cod_Barras where @Cadena_Id like Cadena_Id)   
  set @C_3 = dbo.Fx_Split (@Codigo, '','',3)     
  set @C_2 = dbo.Fx_Split (@Codigo, '','',2)  
    
  if len(@C_3)>4   
  begin  
   set @fecha=@C_3  
   set @C_3=year(@fecha)   
  end  
     
    
  set @CampoAInsertar=@Descripcion+''-''+@C_3+''-''+@C_2   
    
 End  
  

 IF (@NextString like ''FRH0301%'') OR  (@NextString like ''FRH0302%'') OR (@NextString like ''FRH0306%'')
 Begin   
  set @Tipo = dbo.Fx_Split  (@Codigo, '','',1)       
  set @Numero= 1
  set @Cadena_Id=@Tipo+''#''+@Numero  
  set @Descripcion= (select Id_Comprobante from dbo.Tabla_Cod_Barras where @Cadena_Id like Cadena_Id)      
  set @CampoAInsertar=@Descripcion
  
 End  
  
   
  select (@CampoAInsertar) as Campo  
 --trae de la tabla la leyenda que tengo que insertar   
  
   
  
  
  
  
   
  
  
  
  
  
  
  
  



' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_GET_Recibos_Recibidos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_GET_Recibos_Recibidos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[PLA_GET_Recibos_Recibidos]    
 @id_recibo int,  
 @ope int    
as    
    
IF @ope = 1  
BEGIN  
	select id_recibo, isnull(id_comprobante,0)  id_comprobante    
	from dbo.PLA_Recibos_Recibidos    
	where id_recibo = @id_recibo    
END  
  
  
IF @ope = 2  
BEGIN  
	

	select prr.id_recibo,  
		dp.apellido +'', ''+ dp.nombre agente,  
		dp2.apellido +'', ''+ dp2.nombre firmante,  
		f.id id_firmante  
	
	from dbo.PLA_Recibos_Recibidos prr  
	
	left JOIN dbo.PLA_Recibos pr  
	on prr.id_recibo = pr.id_recibo  
	
	left JOIN dbo.datos_personales dp  
	on dp.nro_documento = right(left(pr.cuil,11),8)  
	
	left JOIN dbo.datos_personales dp2  
	on dp2.nro_documento = prr.doc_firmante  
	
	left JOIN dbo.tabla_firmantes f  
	on f.nro_documento = prr.doc_firmante  
	
	where prr.id_comprobante is null  

END  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_ADD_Recibos_Recibidos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_ADD_Recibos_Recibidos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[PLA_ADD_Recibos_Recibidos]

@id_recibo	int,
@id_firmante	int,
@usuario	int

as

declare @id int,
	@id_cargo int,
	@id_area int,
	@doc_firmante int

select @id = max(isnull(id,0)) + 1 from dbo.PLA_Recibos_Recibidos

select 	@id_cargo = cargo,
	@id_area = area,
	@doc_firmante = nro_documento
from tabla_firmantes
where id = @id_firmante

INSERT INTO dbo.PLA_Recibos_Recibidos
(
id,
id_recibo,
doc_firmante,
id_cargo,
id_area,
fecha_alta,
usuario
)
VALUES
(
@id,
@id_recibo,
@doc_firmante,
@id_cargo,
@id_area,
getdate(),
@usuario
)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CTR_GET_Contratos]  
@Doc int=null,  
@Id_Cont int=null,  
@Nro_Cont char(11)=null   
AS  
  
SELECT c.[Id_Contrato],   
c.[Id_Domicilio],   
c.[Nro_Documento],   
tc.[Tipo_Contrato],   
c.[Tipo_Contrato] Id_Tipo_Cont,   
c.[Nro_Contrato],   
c.[Desde],   
c.[Hasta],   
c.[Nivel],   
c.[Grado],   
c.[Funcion],   
c.[Rango],   
c.[Monto],   
c.[Firmado],   
c.[Impreso],   
c.[Fecha_Impresion],   
c.[Fecha_Dia_Impresion],   
c.[Exp_Nro],   
c.[Aprobado],   
c.[Acto_Tipo],   
c.[Acto_Nro],   
c.[Acto_Fecha],   
c.[Acto_Firmante],   
c.[Contrato_Firmante],   
c.[Baja],   
CB.Fecha_baja,  
c.[Excepcion],   
c.[Enmienda],   
c.[Salvado],   
c.[Fecha_Salvado],   
c.[Usuario_Salvado],   
c.[Observacion],   
c.[Estado],  
c.Conserva_Area,   
  
--TFC.apellido Firmante_Desc,   
ttt.Descripcion +'' ''+ DPF.Apellido +'' ''+ DPF.Nombre  Firmante_Desc,   
TC.Descripcion Tipo_Contrato_Desc,  
TR.descripcion Acto_Desc,  
TN.nivel Nivel_Desc,  
TG.grado Grado_Desc,  
TF.descripcion Funcion_Desc,  
TRG.descripcion Rango_Desc,  
  
 case when c.impreso=1 then  
  c.[Id_Area]   
 else  
  da.id_area   
 end Id_Area,  
  
 case when c.impreso=1 then  
  TA.descripcion   
 else  
  TA2.descripcion   
 end Area,  
  
c.Id_Area AreaCont,  
da.id_area AreaReal  
   
FROM dbo.CTR_Contratos C  
  
inner join dbo.Tabla_Resoluciones_Contratos TC  
 on TC.id = c.tipo_contrato  
  
LEFT join dbo.tabla_niveles TN  
 on TN.id = C.nivel  
  
LEFT join dbo.tabla_grados TG  
 on TG.id = c.grado  
  
LEFT join dbo.tabla_tipos_resoluciones TR  
 on TR.id = c.acto_tipo  
  
LEFT join dbo.tabla_areas TA  
 on TA.id = c.id_area  
  
LEFT join dbo.vw_desglose_area da  
 on c.nro_documento = da.documento  
  
LEFT join dbo.tabla_areas TA2  
 on TA2.id = da.id_area  
   
LEFT join dbo.tabla_funciones_contratos TF  
 on TF.id = c.funcion  
  
LEFT join dbo.tabla_rangos TRG  
 on TRG.id = c.rango  
  
--LEFT join dbo.CFirmantes_Contratos TFC  
-- on TFC.id = C.Contrato_Firmante  
LEFT join dbo.Tabla_Firmantes TFC  
 on TFC.id = C.Contrato_Firmante  
LEFT join dbo.datos_personales DPF  
 on TFC.nro_documento=DPF.nro_documento  
LEFT join dbo.tabla_tratamientos TT  
 on TT.id=tfc.id_tratamiento  
LEFT join dbo.tabla_tratamientos_titulos TTT  
 on TTT.id=tfc.id_titulo  
  
  
LEFT join dbo.CTR_Contratos_Bajas CB  
 on CB.id_contrato = c.id_contrato  
  
where (c.nro_documento=@doc) or   
 (c.id_contrato=@id_cont) or  
 (c.nro_contrato=@nro_cont)  
  
  
order by c.desde desc,c.hasta desc  
  
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Controla_Tabla_Firmante]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Controla_Tabla_Firmante]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[GABM_Controla_Tabla_Firmante]
	@Doc int,
	@area int
as

select * 
from dbo.Tabla_Firmantes
where Area = @area
	and Nro_Documento = @doc



' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Consulta_Parametrizada]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Consulta_Parametrizada]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Consulta_Parametrizada]    
 @Doc [int]=null,     
 @Apellido [varchar](50)=null,    
 @Estado [varchar](50)=null,    
 @Desde [smalldatetime]=null,    
 @Hasta [smalldatetime]=null,    
 @Tipo_Cont [smallint]=null,    
 @Nro_Exp [varchar](30)=null,    
 @Acto [smallint]=null,     
 @Acto_Nro [char](10)=null,    
 @Acto_Año [smalldatetime]=null,    
 @Nivel [smallint]=null,    
 @Grado[smallint]=null,    
 @Funcion [smallint]=null,    
 @Rango [smallint]=null,    
 @AreaReal [int]=null,    
 @AreaCont [int]=null    
 --@firma [int]=null    
  
/*    
declare @Doc [int]    
declare @Apellido [varchar](50)    
declare @Estado [varchar](50)    
declare @Desde [smalldatetime]    
declare @Hasta [smalldatetime]    
declare @Tipo_Cont [smallint]    
declare @Nro_Exp [varchar](20)    
declare @Acto [smallint]    
declare @Acto_Nro [char](10)    
declare @Acto_Año [smalldatetime]    
declare @Nivel [smallint]    
declare @Grado[smallint]    
declare @Funcion [smallint]    
declare @Rango [smallint]    
declare @AreaReal [int]    
declare @AreaCont [int]    
declare @firma [int]    
set @Doc =null    
set @Apellido=null  
set @Estado =null  
set @Desde =null  
set @Hasta =null  
set @Tipo_Cont =null  
set @Nro_Exp =null  
set @Acto =null  
set @Acto_Nro =null  
set @Acto_Año =null  
set @Nivel =null  
set @Grado=null  
set @Funcion =null  
set @Rango =null  
set @AreaReal =null  
set @AreaCont =null  
set @firma =null  
*/  
AS    
select TD.Descripcion Tipo_Doc,      
 C.Nro_Documento,      
 DP.Apellido,    
  DP.Nombre,     
 TC.Descripcion Contrato,     
 C.Nro_Contrato,    
 convert (char(10), C.[Desde],103) Desde ,    
 convert (char(10), C.[Hasta],103) Hasta,    
    
 --ESTADO DEL CONTRATO    
 case when C.Baja =1 then    
   ''Baja''    
 ELSE    
  case when C.Enmienda =1 then    
   ''Enmienda''    
  ELSE    
   case when C.Estado=''A'' then    
    case when C.Aprobado = 1 then    
     ''Alta Aprobada''    
    else    
     ''Alta en Tramite''    
    end     
   else     
    case when C.Aprobado =1 then    
     ''Renovación Aprobada''    
    else    
     ''Renovación en Tramite''    
    end    
   end    
  end    
 end Estado,    
    
 case when C.[Aprobado] =1 then    
  ''Si''    
 else    
  ''No''    
 end Aprobado,      
    
 C.Exp_Nro,    
 TTR.Descripcion Acto_Administ,    
 C.Acto_Nro Nro_Acto,    
 C.Acto_Fecha,    
    
 case when TC.Tipo_Contrato = 1 then    
  FC.Descripcion      
 else    
  CCF.Funcion    
 end Funcion,    
 R.descripcion Rango,    
 C.Monto,    
     
 TN.nivel,    
 TG.grado,     
     
 TA.descripcion Area_Contrato,    
 TA2.descripcion Area_Real,    
 --CFC.Apellido Nombre_Firmante    
ttt.Descripcion +'' ''+ DPF.Apellido +'' ''+ DPF.Nombre Nombre_Firmante     
  
From  [dbo].[CTR_Contratos]  C    
    
left join dbo.tabla_funciones_contratos FC  --1184    
 on fc.id=c.funcion    
    
inner join dbo.Datos_Personales DP    
 on DP.Nro_documento = C.nro_documento and     
 (dp.apellido like @apellido + ''%'' or @apellido is null)    
    
--inner join dbo.domicilio_personal D    
-- on d.nro_doc=c.nro_documento and d.id_domicilio=c.id_domicilio    
    
inner join dbo.Tabla_DocIdentidad TD    
 on td.id=dp.tipo_documento     
    
inner join dbo.Tabla_Resoluciones_Contratos TC    
 on TC.id = C.tipo_contrato    
    
LEFT join dbo.tabla_areas TA    
 on TA.id = c.id_area    
    
LEFT join dbo.vw_desglose_area da    
 on c.nro_documento = da.documento and (da.id_area= @areareal or @areareal is null)     
    
LEFT join dbo.tabla_areas TA2    
 on TA2.id = da.id_area    
  
    
--inner join dbo.cfirmantes_contratos cfc    
-- on cfc.id=c.contrato_firmante    
LEFT join dbo.Tabla_Firmantes TFC  
 on TFC.id = C.Acto_Firmante  
inner join dbo.datos_personales DPF  
 on TFC.nro_documento=DPF.nro_documento  
inner join dbo.tabla_tratamientos TT  
 on TT.id=tfc.id_tratamiento  
inner join dbo.tabla_tratamientos_titulos TTT  
 on TTT.id=tfc.id_titulo  
  
  
left join dbo.tabla_niveles TN    
 on tn.id=c.nivel    
    
left join dbo.tabla_grados TG    
 on tg.id=c.grado    
    
left join dbo.tabla_grado_letras TGL    
 on tgl.grado=tg.grado    
    
left join dbo.ccontrato_funciones CCF  --1421    
 on ccf.id_nivel=tn.id    
    
left join dbo.tabla_rangos R    
 on r.id=c.rango    
    
left join dbo.Tabla_Tipos_Resoluciones TTR    
 on ttr.id=c.acto_tipo    
    
    
WHERE     
 (c.nro_documento = @doc  or @doc is null) and    
 --(dp.apellido like @apellido + ''%'' or @apellido is null) and    
 ((c.desde between @desde and @hasta) or (@desde is null or @hasta is null)) and    
 ((c.hasta between @desde and @hasta) or (@desde is null or @hasta is null)) and    
    
 (c.aprobado = 1 and c.estado=''A'' and c.baja=0 and @estado = ''Alta Aprobada'' or @estado =''Alta en Tramite'' or @estado =''Baja'' or @estado =''Renovación Aprobada'' or @estado =''Renovación en Tramite'' or @Estado = ''Enmienda'' or @estado is null) and    
 (c.aprobado = 0 and c.estado=''A'' and c.baja=0 and @Estado = ''Alta en Tramite'' or @estado =''Alta Aprobada'' or @estado =''Baja'' or @estado =''Renovación Aprobada'' or @estado =''Renovación en Tramite'' or @Estado = ''Enmienda'' or @estado is null) and    
    
 (c.enmienda = 1 and c.baja=0 and @Estado = ''Enmienda'' or @estado =''Alta en Tramite'' or @estado =''Alta Aprobada'' or @estado =''Baja'' or @estado =''Renovación Aprobada'' or @estado =''Renovación en Tramite'' or @estado is null) and    
    
 (c.baja = 1 and @estado = ''Baja'' or @estado =''Alta en Tramite'' or @estado =''Alta Aprobada'' or @estado =''Renovación Aprobada'' or @estado =''Renovación en Tramite'' or @Estado = ''Enmienda'' or @estado is null) and    
    
 (c.aprobado = 1 and c.estado<>''A'' and c.baja=0 and @estado=''Renovación Aprobada'' or @estado = ''Alta Aprobada'' or @estado =''Alta en Tramite'' or @estado =''Baja''  or @estado =''Renovación en Tramite'' or @Estado = ''Enmienda'' or @estado is null) and    
 (c.aprobado = 0 and c.estado<>''A'' and c.baja=0 and  @Estado = ''Renovación en Tramite'' or @estado=''Renovación Aprobada'' or @estado = ''Alta Aprobada'' or @estado =''Alta en Tramite'' or @estado =''Baja''  or @Estado = ''Enmienda'' or @estado is null) and    
    
 (c.tipo_contrato= @tipo_cont or @tipo_cont is null) and    
 (c.exp_nro=@nro_exp or @nro_exp is null) and    
 (c.acto_tipo= @Acto or @Acto  is null) and    
 (c.acto_nro= @Acto_nro or @Acto_nro  is null) and    
 --(right(convert(char(10),c.acto_fecha,103),4)= @Acto_año or @Acto_año  is null) and    
 (c.acto_fecha= @Acto_año or @Acto_año  is null) and    
 (c.nivel= @nivel or  @nivel is null) and    
 (c.grado= @grado or @grado is null) and    
 (c.funcion= @funcion or  @funcion is null) and    
 (c.rango= @rango or @rango is null) and    
 (c.id_area =@areacont or @areacont is null)     
 --and (da.id_area= @areareal or @areareal is null)     
    
  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CON_CTR_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CON_CTR_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CON_CTR_Contratos]    
    
AS
 
SELECT --c.Id_Contrato,   
--c.Id_Domicilio,   
c.Nro_Documento,   
DP.Apellido,
DP.Nombre,
TC.Descripcion Tipo_Contrato,   
c.Nro_Contrato,   
c.Desde,   
c.Hasta,   
TN.Nivel,   
TG.Grado,   
TF.descripcion Funcion,   
TRG.descripcion Rango,   
c.Monto,   
case when c.Firmado = 1 then
	''SI''
else
	''NO''
end Firmado,   

case when c.Impreso = 1 then
	''SI''
else
	''NO''
end Impreso,   

c.Fecha_Impresion,   
c.Fecha_Dia_Impresion,   
c.Exp_Nro,     
case when c.Aprobado = 1 then
	''SI''
else
	''NO''
end Aprobado, 
TR.descripcion Acto_Tipo,   
c.Acto_Nro,   
c.Acto_Fecha,   
ttt2.Descripcion +'' ''+ DPFA.Apellido +'' ''+ DPFA.Nombre Acto_Firmante, 
ttt.Descripcion +'' ''+ DPF.Apellido +'' ''+ DPF.Nombre Contrato_Firmante,   
  
case when c.Excepcion = 1 then
	''SI''
else
	''NO''
end Excepcion, 

case when c.Enmienda = 1 then
	''SI''
else
	''NO''
end Enmienda, 

case when c.Salvado = 1 then
	''SI''
else
	''NO''
end Salvado, 
c.Fecha_Salvado,
c.Usuario_Salvado,   
c.Observacion,   
    
case when c.Baja = 1 then
	''SI''
else
	''NO''
end Baja,   
CB.Fecha_baja,
c.Estado,  

--  case when c.impreso=1 then  
--   c.Id_Area   
--  else  
--   da.id_area   
--  end Id_Area,  
  
case when c.impreso=1 then  
  TA.descripcion   
else  
  TA2.descripcion   
end Area  
  
--c.Id_Area AreaCont,  
--da.id_area AreaReal  
   
FROM dbo.CTR_Contratos C  
  
INNER join dbo.datos_personales DP  
 on C.nro_documento=DP.nro_documento  

inner join dbo.Tabla_Resoluciones_Contratos TC  
 on TC.id = c.tipo_contrato  
  
LEFT join dbo.tabla_niveles TN  
 on TN.id = C.nivel  
  
LEFT join dbo.tabla_grados TG  
 on TG.id = c.grado  
  
LEFT join dbo.tabla_tipos_resoluciones TR  
 on TR.id = c.acto_tipo  
  
LEFT join dbo.tabla_areas TA  
 on TA.id = c.id_area  
  
LEFT join dbo.vw_desglose_area da  
 on c.nro_documento = da.documento  
  
LEFT join dbo.tabla_areas TA2  
 on TA2.id = da.id_area  
   
LEFT join dbo.tabla_funciones_contratos TF  
 on TF.id = c.funcion  
  
LEFT join dbo.tabla_rangos TRG  
 on TRG.id = c.rango  
  
--LEFT join dbo.CFirmantes_Contratos TFC  
-- on TFC.id = C.Contrato_Firmante  
LEFT join dbo.Tabla_Firmantes TFC  
 on TFC.id = C.Contrato_Firmante  
LEFT join dbo.datos_personales DPF  
 on TFC.nro_documento=DPF.nro_documento  
LEFT join dbo.tabla_tratamientos TT  
 on TT.id=tfc.id_tratamiento  
LEFT join dbo.tabla_tratamientos_titulos TTT  
 on TTT.id=tfc.id_titulo  


LEFT join dbo.Tabla_Firmantes TFA  
 on TFA.id = C.acto_Firmante  
LEFT join dbo.datos_personales DPFA  
 on TFA.nro_documento=DPFA.nro_documento  
LEFT join dbo.tabla_tratamientos TT2  
 on TT2.id=tfA.id_tratamiento  
LEFT join dbo.tabla_tratamientos_titulos TTT2  
 on TTT2.id=tfA.id_titulo  


   
LEFT join dbo.CTR_Contratos_Bajas CB  
 on CB.id_contrato = c.id_contrato  
    
order by DP.Apellido, DP.nombre, c.nro_contrato
  
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[UCTR_GET_Tabla_Firmantes]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[UCTR_GET_Tabla_Firmantes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[UCTR_GET_Tabla_Firmantes]  
  
 @Area int =null,  
 @CTR int  =null,  
 @FACT int =null,  
 @AADM int =null,
 @ddjjrecibo  int =null
  
AS   
Select TF.id,  
 DP.Apellido,  
 DP.Nombre    
  
from dbo.Tabla_Firmantes TF  
  
inner join dbo.datos_personales DP  
 on DP.nro_documento=TF.nro_documento   
  
where  (TF.Area=@area or @area is null)and   
 (TF.ctr=@ctr or @ctr is null)and   
 (TF.fact=@fact or @fact is null)and   
 (TF.aadm=@aadm or @aadm is null)and  
 (TF.ddjjrecibo=@ddjjrecibo or @ddjjrecibo is null)and  
 TF.Baja =0  
order by apellido  
  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CON_PARAN_CONTRATOS]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CON_PARAN_CONTRATOS]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CON_PARAN_CONTRATOS]  
 @Desde datetime = NULL,  
 @Hasta datetime = NULL,  
 @Aprobado bit = NULL,  
 @Baja Bit = NULL,  
 @TipoContrato smallint= NULL  
AS  
  
SELECT   --DATOS DEL TITULAR  
 tdoc.descripcion TipoDoc,  
 dp.Nro_Documento ,  
 dp.apellido +'', ''+  dp.nombre Apellido,   
-- convert(varchar(10),dp.fecha_nacimiento,103) FechaNac,  
-- case when dp.sexo = 1 then  
--  ''Masculino''  
-- else  
--  ''Femenino''  
-- end Sexo,  
-- ec.descripcion EstadoCivil,  
-- nac.descripcion Nacionalidad,  
-- case when regimen_jubilatorio =2 then  
--  ''Capitalización''  
-- else  
--  ''Reparto''  
-- end OpcionJubilatoria,  
-- rj.descripcion AFJP,  
  
-- DomP.Calle + '' ''+ convert(varchar(5),domp.número) +   
--  case when not domp.piso is null then '' Piso:''+  domp.piso end  
--  +   
--  case when not domp.dpto  is null then '' Dpto:'' + domp.dpto end Domicilio,  
-- loc.codigopostal CodigoPostal,  
-- loc.nombrelocalidad Localidad ,  
  
 case when C.baja = 1 then  
  ''Si''  
 else  
  ''No''  
 end Baja,  
 c.nro_contrato,  
 convert(varchar,c.desde,103) Desde,  
 convert(varchar,c.hasta,103) Hasta,  
 trc.descripcion TipoContrato,  
 tn.nivel,  
 tg.grado,  
 tf.descripcion funcion,  
 tr.descripcion rango,  
 c.monto,  
 case when c.baja = 1 then  
  ''Sí''  
 else  
  ''No''  
 end BajaC,  
 case when c.aprobado = 1 then  
  ''Sí''  
 else  
  ''No''  
 end Aprobado,  
 case when c.impreso =1 then  
  ''Sí''  
 else  
  ''No''  
 end Impreso,  
 --FC.apellido Firmante,  
ttt.Descripcion +'' ''+ DPF.Apellido +'' ''+ DPF.Nombre  Firmante,  
case when firmado = 1 then  
  ''Sí''  
 else  
  ''No''  
 end Firmado,  
 ta.descripcion Area,  
 Exp_Nro Expediente,  
   
 case when excepcion = 1 then  
  ''Sí''  
 else  
  ''No''  
 end excepcion,  
 case when Enmienda = 1 then  
  ''Sí''  
 else  
  ''No''  
 end Enmienda  
  
   
  
  
 FROM dbo.Datos_Personales DP  
  
-- INNER JOIN dbo.Domicilio_Personal DomP  
--  on Domp.Id_Interna = dp.Id_Interna and  
--   Fecha_Comunicacion = (select max(Fecha_Comunicacion) from dbo.Domicilio_Personal where Id_Interna = Dp.Id_Interna)  
  
 INNER JOIN dbo.tabla_DocIdentidad TDoc  
  on TDoc.id = dp.tipo_Documento  
  
-- INNER JOIN dbo.Tabla_Estado_Civil EC  
--  on EC.id = DP.Estado_Civil  
  
-- INNER JOIN dbo.tabla_nacionalidad NAC  
--  on NAC.id = Dp.Nacionalidad  
  
  
-- INNER JOIN dbo.Tabla_Regimen_Jubilatorio RJ  
--  on RJ.id = dp.regimen_jubilatorio  
  
-- INNER JOIN dbo.LOCALIDADESAFIP LOC  
--  on LOC.idlocalidad = domp.localidad  
  
  
 INNER JOIN dbo.CTR_Contratos C  
  on c.Nro_Documento = dp.Nro_Documento and  
  c.Id_Contrato = (select max(Id_Contrato) from dbo.CTR_Contratos where Nro_Documento = dp.Nro_Documento)  
  
 INNER JOIN dbo.TAbla_Resoluciones_Contratos TRC  
  on TRC.id = c.tipo_contrato  
  
 LEFT JOIN dbo.tabla_niveles TN  
  on tn.id = c.nivel  
 LEFT JOIN dbo.Tabla_Grados TG  
  on tg.id = c.grado  
 LEFT JOIN dbo.Tabla_funciones_contratos TF  
  on tf.id = c.funcion  
 LEFT JOIN dbo.Tabla_RAngos TR  
  on tr.id = c.rango  
-- inner join dbo.cfirmantes_contratos FC  
--  on FC.id = c.Contrato_firmante  
 LEFT join dbo.Tabla_Firmantes TFC
	on TFC.id = c.Contrato_firmante 
inner join dbo.datos_personales DPF
	on TFC.nro_documento=DPF.nro_documento
inner join dbo.tabla_tratamientos TT
	on TT.id=tfc.id_tratamiento
inner join dbo.tabla_tratamientos_titulos TTT
	on TTT.id=tfc.id_titulo

INNER JOIN dbo.tabla_areas TA  
  on ta.id = c.id_area  
     
WHERE  (C.Desde >= @desde OR @Desde IS NULL) AND  
 (C.Hasta <= @Hasta OR @Hasta IS NULL) AND  
 (C.Aprobado = @Aprobado OR @Aprobado IS NULL) AND  
 (C.Baja = @Baja OR @Baja IS NULL) AND  
 (C.Tipo_Contrato = @TipoContrato Or @TipoContrato IS NULL)  
   
  
  
  
  
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Firmantes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Firmantes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[GABM_Tabla_Firmantes]        
 @Operacion char(1),        
 @Id [int] = NULL,        
 @Area [int] = NULL,        
 @Id_Interna [int] = NULL,        
 @Nro_Documento [int] = NULL,        
 @Id_Titulo [smallint] = NULL,        
 @Id_Tratamiento [smallint] = NULL,        
 @Cargo Smallint = NULL,        
 @Ctr [bit] = NULL,        
 @FacT [bit] = NULL,        
 @AAdm [bit] = NULL,
 @DDJJRecibo [bit] = NULL
AS         
        
IF @operacion =''A''        
BEGIN        
 Declare @MAx [int]        
 set @Max = (select max(id)+1 from dbo.Tabla_Firmantes)        
 if @Max is null begin        
  set @max=1        
 end        
 INSERT INTO dbo.Tabla_Firmantes         
  (id,        
  area,        
  id_interna,        
  nro_documento,        
  id_titulo,        
  id_tratamiento,        
  cargo,        
  ctr,        
  fact,        
  aadm,
  DDJJRecibo)         
  VALUES         
  (@max,        
  @Area,        
  @Id_Interna,        
  @Nro_Documento ,        
  @Id_Titulo ,        
  @Id_Tratamiento ,        
  @Cargo ,        
  @Ctr ,        
  @FacT ,        
  @AAdm,
  @DDJJRecibo)        
        
END        
        
IF @operacion =''M''        
BEGIN        
 UPDATE  dbo.Tabla_Firmantes        
 SET area = @Area,        
  id_interna = @Id_Interna,        
  nro_documento = @Nro_Documento ,        
  Id_Titulo = @Id_Titulo ,        
  Id_Tratamiento = @Id_Tratamiento ,        
  Cargo = @Cargo ,        
  Ctr = @Ctr ,        
  FacT = @FacT,        
  AAdm = @AAdm,
  DDJJRecibo = @DDJJRecibo         
 WHERE  Id = @Id        
END        
        
        
IF @operacion =''B''        
BEGIN        
 UPDATE dbo.Tabla_Firmantes        
 SET Baja =  1,        
  Fecha_Baja = getdate()        
 WHERE  id = @Id        
END        
        
IF @operacion =''R''        
BEGIN        
 UPDATE  dbo.Tabla_Firmantes        
 SET Baja =  0,        
  Fecha_Baja = NULL        
 WHERE  id = @Id        
END        
        
IF @operacion =''S''        
BEGIN        
 SELECT TF.Id,        
  TF.Nro_Documento Documento,        
  TF.Id_Interna,         
  DP.Apellido +'', ''+ DP.Nombre Apellido,        
  TF.Area,        
  TA.Descripcion Sector,        
  TT.Descripcion Tratamiento,        
  TTIT.Descripcion Titulo,        
  TC.Descripcion Cargo,        
  convert(char(10),isnull(TF.Fecha_Baja,''''),103) Fecha_Baja,        
  CASE WHEN TF.baja = 1 THEN        
   ''Si''        
  ELSE        
   ''No''        
  END Baja,         
        
  CASE WHEN TF.Ctr = 1 THEN        
   ''Si''        
  ELSE        
   ''No''        
  END FirmaContratos,        
   CASE WHEN TF.Fact = 1 THEN        
   ''Si''        
  ELSE        
   ''No''        
  END FirmaFacturas,        
  CASE WHEN TF.AAdm = 1 THEN        
   ''Si''        
  ELSE        
   ''No''        
  END FirmaActosAdm,
  CASE WHEN TF.ddjjrecibo = 1 THEN        
   ''Si''        
  ELSE        
   ''No''        
  END FirmaddjjRecibo
        
 FROM  dbo.Tabla_Firmantes TF        
 INNER JOIN dbo.Tabla_Areas TA        
  ON TF.area = TA.Id        
 INNER JOIN dbo.Tabla_Tratamientos TT        
  ON TT.Id = TF.Id_Tratamiento AND        
     TT.Tipo = ''P''        
 INNER JOIN dbo.Tabla_Tratamientos_Titulos TTit        
  ON TTiT.Id = TF.Id_Titulo         
 INNER JOIN dbo.Tabla_Cargos TC        
  ON TC.Id = TF.Cargo        
 INNER JOIN dbo.Datos_Personales DP        
  on DP.Nro_Documento = TF.Nro_Documento        
 WHERE (TF.Id = @ID) OR (@ID IS NULL)        
 ORDER BY DP.Apellido, DP.Nombre        
END        
        
        
        
        
        
        
        
        
        
      
      
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Contrato_Activo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Contrato_Activo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[CTR_GET_Contrato_Activo]	
	@Doc int
AS
--MLD: 19-09-06: MODIFICADO
SELECT 	C.Id_Contrato,
	c.Id_Domicilio,
	C.Tipo_Contrato,
	C.Nro_Contrato,	convert(char(10),C.Desde,103) Desde,
	convert(char(10),C.Hasta,103) Hasta,
	Case when C.Firmado = 1 then
		''Si''
	else
		''No''
	End Firmado,
	case when C.Impreso = 1 then
		''Si''
	else
		''No''
	end Impreso,
	case when C.Aprobado = 1 then
		''Si''
	else
		''No''
	end Aprobado,
	case when C.Enmienda = 1 then
		''Si''
	else
		''No''
	end Enmienda,
	CASE C.Estado 
		WHEN ''A'' THEN ''Alta''
		WHEN ''E'' THEN ''Enmienda''
		WHEN ''R'' THEN ''Renovación''
		ELSE ''Alta''
	END Estado,
	TRC.Descripcion DescTipo_Contrato,
	C.Id_Domicilio,
	ISNULL(C.Exp_Nro,'''') Expediente,
	CASE WHEN Reservado = 1 THEN
		''Si''
	ELSE
		''No''
	END Reservado,
	
	--GPR: 05-12-2006
	TTR.Descripcion Acto_Tipo,
	C.Acto_Nro,
	C.Acto_Fecha,
	
	ttt.Descripcion +'' ''+ DPF.Apellido +'' ''+ DPF.Nombre  Acto_Firmante,

	--	
	TA2.descripcion Area
	--
	

FROM 	dbo.CTR_Contratos C
INNER JOIN dbo.Tabla_Resoluciones_Contratos TRC
	on TRC.Id = C.Tipo_Contrato

--GPR: 05-12-2006 Trae Acto Adm por el cual se aprobo
LEFT JOIN dbo.Tabla_Tipos_Resoluciones TTR
	on TTR.id=C.Acto_Tipo

LEFT join dbo.Tabla_Firmantes TFC
	on TFC.id = C.Acto_Firmante
left join dbo.datos_personales DPF
	on TFC.nro_documento=DPF.nro_documento
left join dbo.tabla_tratamientos TT
	on TT.id=tfc.id_tratamiento

left join dbo.tabla_tratamientos_titulos TTT
	on TTT.id= tfc.id_titulo

--

LEFT join dbo.tabla_areas TA
	on TA.id = c.id_area

LEFT join dbo.vw_desglose_area da
	on c.nro_documento = da.documento

LEFT join dbo.tabla_areas TA2
	on TA2.id = da.id_area

--

WHERE 	C.Nro_Documento= @Doc AND 
	C.baja= 0

ORDER BY C.Nro_Contrato desc








' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_GET_Traspaso_Documentacion]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_GET_Traspaso_Documentacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'





CREATE procedure [dbo].[RH_GET_Traspaso_Documentacion]
	@Pendientes bit=null,
	@Sextor_Rx smallint=null,
	@EnvioDesde datetime=null,
	@EnvioHasta datetime=null
as
SELECT 	td.id Id,
	convert(char(10),Fecha_Tx,103) FechaEnvio,
	S_TX.descripcion SectorEnvio,
	U_TX.Nombre UsuarioEnvio,
	motivo,
	S_RX.Descripcion SectorRecibe,
	isnull(U_RX.nombre,'''') UsuarioRecibe,
	convert(char(10),Fecha_RX,103) FechaRecibe,
	isnull(codigo,0) Codigo,
	Registro

FROM dbo.RH_Traspaso_Documentacion TD
INNER JOIN dbo.RH_Sectores S_TX
	on S_TX.id = TD.sector_TX
INNER JOIN dbo.RH_Sectores S_RX
	on S_RX.id = td.Sector_RX
LEFT JOIN dbo.RH_Usuarios U_TX
	on U_TX.id = TD.Usuario_TX
LEFT JOIN dbo.RH_Usuarios U_RX
	on U_RX.id = TD.Usuario_RX

WHERE 	(((not Fecha_RX is null and @pendientes =0) OR
	(Fecha_RX is null and @pendientes =1))or @pendientes is null) AND
	TD.Sector_RX = @Sextor_Rx
ORDER BY registro




' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_Administracion_Usuario]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_Administracion_Usuario]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'





CREATE procedure [dbo].[RH_Administracion_Usuario]
	@Operacion char(1),
	@IdUsuario smallint,
	@Usuario varchar(15)=NULL,
	@Password 	varchar(60)=NULL,
	@Vence_Passw 	smalldatetime=NULL,
	@Actualizar_Passw [bit]=0,
	@EsAdministrador [bit]=0,
	@Sector smallint = null
AS 
IF @operacion =''A''
BEGIN
	Declare @Max [int]
	set @Max = (select max(id)+1 from dbo.RH_Usuarios)
	if @Max is null begin
		set @Max=1
	end
	INSERT INTO dbo.RH_Usuarios
		(Id,
		Nombre,
		Password,
		Vence_Passw,
		Baja,
		Actualizar_Passw,
		Administrador)
 	VALUES 
		(@max,
		@Usuario,
		@Password,
		@Vence_Passw,
		0,
		@Actualizar_Passw,
		@EsAdministrador)
END

IF @operacion =''M''
BEGIN
	update 	dbo.RH_Usuarios
	set 	Nombre = @Usuario,
		Vence_Passw = @Vence_Passw,
		Actualizar_Passw = @Actualizar_Passw,
		Administrador = @EsAdministrador
	where 	id = @IdUsuario
END


IF @operacion =''B''
BEGIN
	update 	dbo.RH_Usuarios
	set 	Baja =  1
	where 	id = @IdUsuario
END

IF @operacion =''R''
BEGIN
	update 	dbo.RH_Usuarios
	set 	Baja =  0
	where 	id = @IdUsuario
END


IF @operacion =''S''
BEGIN
	SELECT	U.Id,
		U.Nombre Usuario,
		Password,
		convert(char(10),Vence_Passw,103) Vence_Passw,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja,
		case when Actualizar_Passw = 1 then
			''Si''
		else
			''No''
		end Actualizar_Passw,

		case when Administrador = 1 then
			''Si''
		else
			''No''
		end Administrador,
		ISNULL(S.Descripcion,'''') Sector 
	FROM  dbo.RH_Usuarios U
	LEFT JOIN dbo.RH_Usuarios_Detalles UD
		on UD.Id_Usuario =  U.ID
	LEFT JOIN dbo.RH_Sectores S	
		on S.Id = UD.Id_Sector
	WHERE ((U.id = @IdUsuario) OR (@IdUsuario is null)) AND
		((UD.Id_Sector = @Sector) OR (@Sector IS NULL))
		
	ORDER BY U.Nombre
END


IF @operacion =''G''
BEGIN
	SELECT	Id
	FROM  dbo.RH_Usuarios
	WHERE (Nombre = @Usuario)
END









' 
END
GO
/****** Object:  View [dbo].[VW_RH_Sectores]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_RH_Sectores]'))
EXEC dbo.sp_executesql @statement = N'


CREATE   VIEW [dbo].[VW_RH_Sectores]
AS
SELECT top 100 percent    *
FROM         dbo.RH_Sectores
ORDER BY Descripcion



'
GO
/****** Object:  StoredProcedure [dbo].[LEG_DEL_Bloqueo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_DEL_Bloqueo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[LEG_DEL_Bloqueo]
	@legajo int
AS
DELETE from dbo.LEG_Bloqueos
where legajo =@Legajo

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Bloqueo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Bloqueo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_GET_Bloqueo]
	@Usuario smallint
AS
SELECT 	lb.legajo, 
	convert(char(10),lb.Fecha,103) BloqueoDesde,
	(dp.Apellido +'', ''+ dp.nombre) Apellido,
	(isnull(U.Apellido,'''') +'', ''+ isnull(U.Nombre,'''')) Usuario
FROM dbo.LEG_Bloqueos LB
left join dbo.RH_Usuarios_Detalles U
	on U.id_usuario = LB.id_usuario
left JOIN dbo.Datos_Personales DP
	on dp.id_interna = LB.legajo

where (lb.id_usuario = @Usuario or U.DesBloqueoLegajo = 1)




' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Bloqueo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Bloqueo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[LEG_ADD_Bloqueo]
	@Usuario smallint,
	@Legajo int
AS
INSERT INTO dbo.LEG_Bloqueos
values (@Usuario,@legajo,getdate())




' 
END
GO
/****** Object:  StoredProcedure [dbo].[UCTR_GET_Legajo_Por_Nombre]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[UCTR_GET_Legajo_Por_Nombre]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[UCTR_GET_Legajo_Por_Nombre]  
 @Apellido varchar(100),  
 @EsContrato bit = 0,  
 @IdUsuario smallint=NULL,  
 @Todos Bit = 0  
AS  
SELECT  dp.apellido,  
 dp.nombre,  
 dp.Nro_Documento   
FROM dbo.Datos_Personales DP  
LEFT JOIN dbo.Legajo_Bajas LB  
 on DP.Id_interna = LB.ID_Interna  
LEFT JOIN dbo.Leg_Bloqueos LQ  
 on LQ.legajo = DP.Id_interna  
  
  
INNER JOIN dbo.VW_Desglose_Area DA  
 on DA.Documento = dp.Nro_Documento   
  
INNER JOIN dbo.RH_Usuarios_Areas UA  
 on UA.Id_Usuario = @IdUsuario AND  
    (UA.Id_Area = DA.Id_Area or Ua.id_area = 0)  
  
WHERE  (DP.Apellido like  @Apellido + ''%'') AND  
 ((DP.VisibleContratos = 1 and @EsContrato = 1) or (@EsContrato = 0 and visiblelegajos = 1) OR @Todos = 1)  
  
-- (DP.VisibleContratos = 1 and @EsContrato = 1) and  
-- ((DP.BajaLegajos = 0 and @Escontrato = 0) or (DP.BajaContratos = 0 and @Escontrato = 1))  
  
ORDER BY dp.apellido, dp.nombre
  
  
   
  
  
  
  
   
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Legajos_Bloqueos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Legajos_Bloqueos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_GET_Legajos_Bloqueos]
	@Documento int,
	@Id_Interna int
AS
SELECT dp.Apellido, dp.Nombre, dp.Id_interna, dp.Nro_Documento,
	(u.apellido +'', '' + u.nombre) Usuario,
	convert(char(10),lb.fecha,103) FechaBloqueo
FROM dbo.Datos_Personales DP
LEFT JOIN dbo.LEG_Bloqueos LB
	on LB.legajo = dp.Id_interna
LEFT JOIN dbo.RH_Usuarios_Detalles U
	on U.id_usuario = lb.id_usuario
WHERE	(nro_documento = @Documento or @documento =0) AND
	(id_interna = @Id_Interna or @Id_interna =0)





' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_ALTA_feriado]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_ALTA_feriado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[ASIS_ALTA_feriado]
	@Fecha [varchar](10),
	@AÑO int,
	@Periodico bit

as
declare @hay int
declare @id [smallint]

set @hay = (select count(*) from dbo.tabla_feriados where day(fecha) = day(@fecha) and month(fecha) = month(@fecha))

if @hay < 1 begin
	set @id = (select max(id)+1 from dbo.tabla_feriados)
	if @id is null begin
		set @id = 1
	end

	insert into dbo.tabla_feriados (id,fecha, año, periodico)
	values (@id, @fecha, @Año,@Periodico)
end



' 
END
GO
/****** Object:  View [dbo].[VW_Dias_Feriados]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Dias_Feriados]'))
EXEC dbo.sp_executesql @statement = N'

CREATE  view [dbo].[VW_Dias_Feriados]
as
select id, fecha, Año, Periodico from dbo.tabla_Feriados	


'
GO
/****** Object:  StoredProcedure [dbo].[ASIS_Delete_Feriado]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Delete_Feriado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[ASIS_Delete_Feriado]
	@id [smallint]

as
delete from dbo.tabla_feriados
where id = @id


' 
END
GO
/****** Object:  View [dbo].[VW_Feriados]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Feriados]'))
EXEC dbo.sp_executesql @statement = N'


CREATE   view [dbo].[VW_Feriados]
as

Select top 100 percent 
	Id, Fecha, Año, Periodico
from Dbo.Tabla_Feriados
order by fecha




'
GO
/****** Object:  View [dbo].[VW_Sexos]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Sexos]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[VW_Sexos]
AS
SELECT *
FROM tabla_sexo


'
GO
/****** Object:  StoredProcedure [dbo].[GETdatosfamiliares]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GETdatosfamiliares]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[GETdatosfamiliares]   
@famdoc int,  
@titdoc int,  
@idint int,  
@idfam int  
AS  
  
Select    
tp.descripcion parentesco, tp.id idparentesco, df.apellido, df.nombre,df.fecha_nacimiento,ts.descripcion sexo, tn.descripcion nacionalidad, td.descripcion fam_docum_tipodoc, df.idfam,df.discapacitado,df.adoptado,  
df.fam_docum_nrodoc, df.fam_ci_expedido_por,  df.acargodesde, df.acargohasta, df.fam_ci, df.fam_ci_expedido_por, df.fam_otrotipo,df.fam_otrotipo_expedido_por, te.descripcion escolaridad, df.tel1, df.tel2, df.tel3, df.lugar, df.fecha, df.Fecha_Fallecimiento fecha_fallecimiento, 
df.lugar_fallecimiento_informe, df.fecha_fallecimiento_informe, df.nacionalidad Id_nacionalidad,  
df.fecha_baja,  
isnull(df.cert_nacimiento,0) Cert_Nacimiento,  
isnull(df.cert_matrimonio,0) Cert_Matrimonio 
--isnull(ce.Tipo_Cert,0) Tipo_Cert

from [dbo].datos_familiares df   
left join [dbo].tabla_parentesco tp on df.parentesco = tp.id  
left join [dbo].tabla_sexo ts on df.sexo = ts.id  
left join [dbo].tabla_nacionalidad tn on  df.nacionalidad=tn.id  
left join [dbo].tabla_docidentidad td on df.fam_docum_tipo=td.id  
left join [dbo].tabla_fam_escolaridad te on df.escolaridad=te.id  
--left join [dbo].Certificados_Escolaridad ce on ce.id_fam=df.idfam 
--and ce.fecha = (select max(ce2.fecha) from Certificados_Escolaridad ce2 where id_interna = df.id_interna and id_fam = df.idfam)
  
where  (df.idfam = @idFam) and  (df.doc_titular=@titdoc or df.id_interna=@idint)  
  
  
' 
END
GO
/****** Object:  View [dbo].[VW_LIQ_GET_Consul_Masiva_NroCuentas]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/****** Object:  StoredProcedure [dbo].[MED_GET_Pacientes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_Pacientes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create PROCEDURE [dbo].[MED_GET_Pacientes]            
 @Documento int = NULL  
AS     
SET NOCOUNT ON
/*ELIMINA EL PACIENTE LOCAL SI YA EXISTE EN LEGAJOS */
DELETE MP
FROM dbo.MED_Pacientes MP
INNER JOIN dbo.Datos_Personales DP
	ON DP.Nro_Documento = MP.Nro_Documento

         
/* BUSCA EN DATOS PERSONALES DE MEDICO */          
SELECT   DI.Descripcion Tipo_documento,             
  PA.NRO_DOCUMENTO,             
  PA.Apellido,             
  PA.Nombre,             
  convert(char(10),PA.Fecha_Nacimiento,103) Fecha_Nacimiento,  
  TS.Descripcion Sexo,             
   
  TA.Descripcion area,             
   
  PA.Grupo_Sanguineo,    
  PA.Factor_Sanguineo,  
  PA.Observaciones  
    
FROM dbo.MED_PACIENTES PA            
INNER JOIN dbo.Tabla_DocIdentidad DI  
 ON DI.Id = PA.Tipo_Documento  
INNER JOIN dbo.Tabla_Sexo TS  
 on TS.Id = PA.Sexo  
INNER JOIN dbo.TABLA_AREAS TA       
 ON TA.id = PA.area            
                
WHERE (PA.Nro_Documento = @Documento)            
    
  
  
' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Instituciones_Educativas_X_Nivel]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Instituciones_Educativas_X_Nivel]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create  PROCEDURE [dbo].[LEG_GET_Instituciones_Educativas_X_Nivel]
	@nivel smallint
AS
-- @nivel = 0 --> TODAS
SELECT	id,
	Descripcion 
FROM	[dbo].tabla_instituciones_educativas
WHERE 	nivel = @nivel or 
	@nivel =0
ORDER BY descripcion


' 
END
GO
/****** Object:  StoredProcedure [dbo].[ABM_Instituciones_Educativas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ABM_Instituciones_Educativas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ABM_Instituciones_Educativas]
	(@ID [int],
	@nivel  [smallint],
	@Descripcion	[varchar](200),
	@operacion [int])

AS 
declare @MaxId [int]
set @maxId = (select max(id) +1 from dbo.tabla_Instituciones_Educativas )

--ALTA
IF  @operacion = 1 
BEGIN
	INSERT INTO dbo.tabla_Instituciones_Educativas
	 ([Id],
	 [nivel],
	 Descripcion) 
	VALUES 
		(@maxid,
		@nivel,
		@Descripcion)
END


-- MODIFICACION
IF @operacion = 2 
BEGIN
	UPDATE dbo.tabla_Instituciones_Educativas 
	SET   [Id]= @id,
	          nivel=@nivel,
	          Descripcion= @Descripcion
	WHERE 
		ID =  @ID		
END

--BAJA
IF @OPERACION =3  
BEGIN
	UPDATE dbo.tabla_Instituciones_Educativas 
	SET   baja = 1
	WHERE 
		ID =  @ID		
END


--CONSULTA
IF @OPERACION =4 
BEGIN
	SELECT * FROM dbo.tabla_Instituciones_Educativas
	where baja =0
	order by id
END


-- VERIFICA SI EXISTE EN DB
IF @OPERACION=5
BEGIN
	SELECT * FROM dbo.tabla_Instituciones_Educativas
	where descripcion=@descripcion
END


' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Estudios_Otros]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Estudios_Otros]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE procedure [dbo].[RPT_LEG_Estudios_Otros]
	@Id_interna int
as

select  top 8
	Establecimeinto,
	Depende_de,
	Titulo,
	Expedido_por,
	TIE.Descripcion,
	case when Fecha_egreso =''01/01/1900''  then
		'' ''
	else
		Fecha_egreso
	end	Fecha_egreso,
	ER.ID_interna
FROM dbo.Estudios_Otros ER
LEFT JOIN dbo.Tabla_Instituciones_Educativas TIE
	on TIE.id = ER.id_establecimiento
where id_interna = @Id_interna AND
	DatoDeBaja = 0 AND
	DatoNoImprime = 0 
order by fecha_egreso






' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetInstituciones_Educativas_X_Nivel]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetInstituciones_Educativas_X_Nivel]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GetInstituciones_Educativas_X_Nivel]  
 @nivel smallint  
AS  
-- @nivel = 0 --> TODAS  
  
select 	id,
	isnull(Descripcion,'''') Descripcion 
from [dbo].tabla_instituciones_educativas  
where nivel = @nivel or @nivel =0  
  
  
order by descripcion  
  
  
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Estudios]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Estudios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'








CREATE         procedure [dbo].[RPT_LEG_Estudios]

	@Id_interna int,
	@DesdeNivel smallint,
	@HastaNivel smallint
--    nivel  Cod_GEST_PUB (tabla_nivel_estudios)
--	1	I		Sin Estudios
-- 	2	P		Primario
--  	3	S		Secundario
--  	4	T       	Terciario
--  	5	U		Universitario
--  	6	U		post_grado
--	7	I		Primario Incompleto
--	8	C		Ciclo_basico	
as

select  top 8
	ER.nivel,
	tne.cod_gest_pub,
	case when certificado_expedido_por ='''' then
		exped_revalid_por
	else
		certificado_expedido_por
	end certificado_expedido_por,
	case when er.fecha_egreso = ''01/01/1900'' then
		''''
	else
		convert(char(10),er.fecha_egreso,103)
	end fecha_egreso,
	titulo,
	exped_revalid_por,
	facultad,
	depende_de,
	matricula_nro,
	TIE.Descripcion,
	ER.ID_interna
FROM dbo.Estudios_realizados ER
INNER JOIN dbo.tabla_nivel_estudios TNE
	ON tne.id = er.nivel
LEFT JOIN dbo.Tabla_Instituciones_Educativas TIE
	on TIE.id = ER.id_establecimiento
where 	id_interna = @Id_interna AND
	(er.nivel between @DEsdenivel AND @hastaNivel) AND
	DatoDeBaja = 0 AND
	DatoNoImprime = 0 
/*
group by ER.nivel,
	tne.cod_gest_pub,
	certificado_expedido_por,
	fecha_egreso,
	titulo,
	exped_revalid_por,
	facultad,
	depende_de,
	matricula_nro,
	TIE.Descripcion,
	ER.ID_interna
*/
order by er.nivel, fecha_egreso










' 
END
GO
/****** Object:  StoredProcedure [dbo].[Web_GetSaldoLicencia]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Web_GetSaldoLicencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		Agustin
-- Create date: 26/03/2009
-- Description:	Obtiene el Saldo de una licencia para un agente
-- =============================================
CREATE PROCEDURE [dbo].[Web_GetSaldoLicencia]
	@nroDocumento int,
	@idConcepto int
AS
BEGIN
	SET NOCOUNT ON;
	
	declare @idInterna int
	set @idInterna = (Select id_interna from dbo.datos_personales where nro_documento = @nroDocumento)

	select al.periodo, al.dias_autorizados - al.dias_tomados saldo
	from dbo.autorizaciones_licencias al
	where 
		al.id_concepto_licencia = @idConcepto and 
		al.id_interna = @idInterna and
		al.dias_autorizados - al.dias_tomados > 0

END' 
END
GO
/****** Object:  View [dbo].[VW_PRIV_MIGRA_LICENCIAS]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_PRIV_MIGRA_LICENCIAS]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_PRIV_MIGRA_LICENCIAS]
AS
SELECT     TOP 100 PERCENT LS.Id AS ID_SOL, AL.Id AS ID_AUTH, LS.Id_Interna, LS.Concepto, LS.Periodo
FROM         dbo.Licencias_Solicitadas LS INNER JOIN
                      dbo.Autorizaciones_Licencias AL ON LS.Id_Interna = AL.Id_Interna AND LS.Concepto = AL.Id_Concepto_Licencia AND LS.Periodo = AL.Periodo
INNER JOIN TABLA_CONCEPTOS_LICENCIAS TCL ON TCL.ID_CONCEPTO = LS.CONCEPTO
WHERE TCL.ES_ORDINARIA=0
ORDER BY LS.Id_Interna, LS.Concepto, LS.Periodo



'
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_GET_Calculo_Fecha_Exceso]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_GET_Calculo_Fecha_Exceso]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE function [dbo].[Fx_GET_Calculo_Fecha_Exceso]
 (@id_interna int,  
 @periodo int,  
 @concepto smallint)

 RETURNS smalldatetime
AS  
BEGIN  
  
DECLARE @dias_autorizados int  
DECLARE @id_lic int  
DECLARE @desde_lic smalldatetime  
DECLARE @hasta_lic smalldatetime   
DECLARE @id_tabla_autorizacion_lic int  
DECLARE @dias_tomados_lic int  
DECLARE @dias_acumulados int  
  
DECLARE @fecha_return smalldatetime  

--Obtengo los dias autorizados segun el concepto  
SET @dias_autorizados = (select top 1 Dias_Autorizados from AUTORIZACIONES_LICENCIAS   
      where periodo=@periodo    
      and id_concepto_licencia = @concepto)  
  
  
DECLARE lic_cursor CURSOR FOR   
select id, id_interna, desde, hasta, id_tabla_autorizacion, dias_a_tomar  
from Licencias_solicitadas    
where id_interna = @id_interna    
 and periodo=@periodo    
 and concepto = @concepto  
order by Desde, hasta  
  
  
OPEN lic_cursor;                
FETCH NEXT FROM lic_cursor                 
INTO @id_lic, @id_interna, @desde_lic, @hasta_lic, @id_tabla_autorizacion_lic, @dias_tomados_lic  
  
SET @dias_acumulados = @dias_tomados_lic  
                   
WHILE @@FETCH_STATUS = 0                
BEGIN            
 --select ''1'', @id_lic, @id_interna, @desde_lic, @hasta_lic, @id_tabla_autorizacion_lic, @dias_tomados_lic, @dias_acumulados  
  
 IF (@dias_acumulados > @dias_autorizados)  
 BEGIN  
  set @fecha_return = @hasta_lic - (@dias_acumulados - @dias_autorizados)  
  CLOSE lic_cursor;                
  DEALLOCATE lic_cursor;                
  return @fecha_return
 END  
   
 FETCH NEXT FROM lic_cursor                 
 INTO @id_lic, @id_interna, @desde_lic, @hasta_lic, @id_tabla_autorizacion_lic, @dias_tomados_lic  
  
 SET @dias_acumulados = @dias_acumulados + @dias_tomados_lic  
  
END  
  
CLOSE lic_cursor;                
DEALLOCATE lic_cursor;             
  
return null --getdate()


END' 
END
GO
/****** Object:  StoredProcedure [dbo].[asis_insertar_tmpLicencias]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[asis_insertar_tmpLicencias]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 05/01/2009
-- Description:	Inserta las vacaciones de una persona en un temporal
-- para luego pasarlo a definitivamente a autorizaciones_licencias
-- =============================================
CREATE PROCEDURE [dbo].[asis_insertar_tmpLicencias]
	@legajo int,
	@dias int,
	@periodo int
AS
BEGIN
	declare @id int
	set @id = (select max(id) + 1 from dbo.autorizaciones_licencias)
	insert into dbo.tmp_autorizaciones_licencias
	(
		[id_interna],
		[dias_autorizados],
		[id_concepto_licencia],
		[periodo] ,
		[id],
		[dias_tomados] 
	)
	values
	(
		@legajo, @dias, 1, @periodo, @id ,0
	)
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Max_Id_Autorizacion_Licencia]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Max_Id_Autorizacion_Licencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ASIS_GET_Max_Id_Autorizacion_Licencia] AS

select max(id) maxid from dbo.autorizaciones_licencias
' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_InterrupcionLicencia]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_InterrupcionLicencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ASIS_InterrupcionLicencia] 
	@fecha smalldatetime,
	@motivo varchar(200),
	@id_solicitud int
AS

Declare @Id_Auth int
Declare @Dias_A_Tomar_Antes int
Declare @Dias_A_Tomar int

set @Dias_A_Tomar_Antes = (select Dias_A_Tomar from dbo.licencias_solicitadas where id = @id_solicitud)
set @Id_Auth = (select id_tabla_autorizacion from dbo.licencias_solicitadas where id = @id_solicitud)

UPDATE DBO.LICENCIAS_SOLICITADAS 
SET FH_FIN_ANTES_INTERR = Hasta
WHERE ID = @id_solicitud

UPDATE DBO.LICENCIAS_SOLICITADAS
SET HASTA = @fecha, motivo_interrupcion = @motivo,
Dias_A_Tomar = datediff(day, DESDE,@fecha)+1
WHERE ID = @id_solicitud

set @Dias_A_Tomar = (select dias_A_Tomar form from dbo.licencias_solicitadas where id = @id_solicitud)

UPDATE DBO.AUTORIZACIONES_LICENCIAS SET DIAS_TOMADOS = DIAS_TOMADOS - @Dias_A_Tomar_Antes + @Dias_A_Tomar
WHERE ID = @id_auth


--ELIMINA INTERRUPCION SI ES QUE VINO DEL WEB

DECLARE @Documento int
set @Documento = (select  DP.Nro_Documento
	FROM dbo.Licencias_Solicitadas LS
	INNER JOIN dbo.Datos_Personales DP
		on DP.Id_Interna = LS.Id_Interna
	WHERE ID = @id_solicitud)


DELETE FROM dbo.ASIS_Interrupcion_Licencias
WHERE Documento = @Documento


' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_ALTA_Autorizaciones_Licencia]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_ALTA_Autorizaciones_Licencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ASIS_ALTA_Autorizaciones_Licencia]
	(@Id_Interna int, 
             @año int,
	@Concepto int)
AS

Declare	 @Id int
set  @Id = (select max(id)+1 from dbo.Autorizaciones_licencias where not id is null)		
if @Id is null begin
	set @Id =1
end

Declare @Dias_Corresponden_Concepto int
set @Dias_Corresponden_Concepto = (select dias_autorizados from dbo.tabla_conceptos_licencias where id_concepto = @concepto)

INSERT INTO dbo.AUTORIZACIONES_LICENCIAS 
(id_Interna, Dias_Autorizados, Periodo, Id_Concepto_Licencia, id, Dias_tomados)
	VALUES(
	@id_interna,
	@Dias_Corresponden_Concepto, 
	@año, @Concepto, @id, 0)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CALC_getAutorizaciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CALC_getAutorizaciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 18/11/2009
-- Description:	Trae todas las autorizaciones de licencia
-- =============================================
CREATE PROCEDURE [dbo].[CALC_getAutorizaciones]
AS
BEGIN
	SELECT id_interna, dias_autorizados, id, periodo
	FROM dbo.autorizaciones_licencias
	WHERE id_concepto_licencia = 1
END

' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_ALTA_Licencias_Solicitadas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_ALTA_Licencias_Solicitadas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[ASIS_ALTA_Licencias_Solicitadas]                            
( @idInterna int, @Concepto smallint,                              
 @Periodo varchar(4), @Fecha_Inicio smalldatetime,                              
 @Fecha_Fin smalldatetime, @Autorizo_Descuento varchar (100),                              
 @Dias_Descuento smallint, @Goce smallint,                              
 @Observaciones varchar (100), @Informo varchar(50),                              
 @DiasATomar smallint, @Id_Area int,                               
 @id_autorizacion int, @Estimada bit,                              
 @auth int, @esMigrado bit,                              
 @usuario int,                              
 @id_diagnostico int = NULL,                            
 @Id_Atencion int= NULL)                      
                            
AS                               
SET NOCOUNT ON     
                 
Declare @NewId [int]                              
Declare @DiasTomadosAnteriores int                              
Declare @DiasRestantesAuthActual int                              
Declare @DiasRestantesAnterior int                              
Declare @i int                              
Declare @tmp_desde smalldatetime                              
Declare @tmp_hasta smalldatetime                              
Declare @primero int                  
                              
--MIENTRAS LOS DIAS A TOMAR SOBREPASAN LOS DEL PERIODO                              
set @i = 1                              
set @primero = 0                          
set @DiasRestantesAnterior = 0      
             
/*GER 22/02/2012: Si el concepto es 10A(2) o 10C(4) o 10J(12).       
Tengo que permitir seguir cargando para luego hacer un informe de los dias a descuento.*/      
IF (@Concepto<>''2'' and @Concepto<>''4'' and @Concepto<>''12'')                
BEGIN            
 set @DiasRestantesAuthActual = 0 --GER:31/05/2012. Se agrego porque empezaba null.    
 set @DiasRestantesAuthActual = (SELECT ((Dias_Autorizados - Dias_Tomados) - @DiasRestantesAuthActual) FROM DBO.AUTORIZACIONES_LICENCIAS WHERE ID = @id_autorizacion)                              
END                
  
IF (@DiasRestantesAuthActual < 0)
	set @DiasRestantesAuthActual = null

                              
 --print ''1 primero''                              
 --print @Primero                               
                              
while  @DiasATomar > @DiasRestantesAuthActual                              
 begin                              
                              
 --print ''2 primero''                              
 --print @Primero                               
                              
 set  @NewId = (select max(Id)+1 from dbo.Licencias_solicitadas)                                
 if @NewId is null begin                              
  set @NewId = 1                              
 end                              
                              
 --select @DiasRestantesAnterior ''ant'' , @DiasRestantesAuthActual ''actual''

 set @tmp_Desde = @Fecha_Inicio + @DiasRestantesAnterior + @primero                              
 set @DiasRestantesAnterior = @DiasRestantesAnterior + @DiasRestantesAuthActual                              
 set @tmp_Hasta = (@DiasRestantesAnterior + @Fecha_Inicio) - 1                              
           
 --select @tmp_Desde ''desde'', @DiasRestantesAnterior ''dias'', @tmp_Hasta ''hasta''
                   
 --agrego la licencia solicitada por el maximo de dias permitidos                              
 INSERT INTO dbo.Licencias_solicitadas                              
  (Id,  Id_Interna,  Concepto,                               
  Periodo,  Desde,  Hasta,                               
  Autorizo_Descuento,  Dias_Descuento,  Goce,                               
  Observaciones, informo, Dias_A_Tomar,                              
  Id_Area, Id_Tabla_Autorizacion,                               
  autorizacion,                               
  usuario)                               
 VALUES                              
   (@NewId, @idInterna, @Concepto,                              
  @Periodo +(@i-1), @tmp_Desde, @tmp_Hasta,                              
  @Autorizo_Descuento, @Dias_Descuento, @Goce,                              
  @Observaciones, @Informo, @DiasRestantesAuthActual,                              
  @Id_Area, @id_autorizacion,          
  @auth,                               
  @usuario)                              
                              
 --obtengo la siguiente autorizacion                              
 set @id_autorizacion = (SELECT ID FROM DBO.AUTORIZACIONES_LICENCIAS WHERE ID_INTERNA = @IdInterna AND PERIODO = (@PERIODO + @I) AND ID_CONCEPTO_LICENCIA = 1)                              
 set @DiasATomar = @DiasATomar - @DiasRestantesAuthActual                              
 set @DiasRestantesAuthActual = (SELECT ((Dias_Autorizados - Dias_Tomados)) FROM DBO.AUTORIZACIONES_LICENCIAS WHERE ID=@id_autorizacion)                              
 set @i = @i + 1                              
 set @primero = 1                              
end                              
                              
 --print ''3 primero''                              
 --print @Primero                               
                              
set  @NewId = (select max(Id)+1 from dbo.Licencias_solicitadas)                                
if @NewId is null begin                              
 set @NewId =1                              
end                        
                              
set @tmp_Desde = @Fecha_Inicio + @DiasRestantesAnterior --+ @primero                              
set @DiasRestantesAnterior = @DiasRestantesAnterior + @DiasRestantesAuthActual                              
            
                              
INSERT INTO dbo.Licencias_solicitadas                              
 (Id,  Id_Interna,  Concepto,                               
 Periodo,  Desde,  Hasta,                               
 Autorizo_Descuento,  Dias_Descuento,  Goce,                               
 Observaciones, informo, Dias_A_Tomar,                              
 Id_Area, Id_Tabla_Autorizacion,                               
 autorizacion,                               
 usuario)                               
VALUES                              
  (@NewID, @idInterna, @Concepto,                              
 @Periodo+(@i-1), @tmp_Desde, @Fecha_Fin,                              
 @Autorizo_Descuento, @Dias_Descuento, @Goce,                              
 @Observaciones, @Informo, @DiasATomar,                              
 @Id_Area, @id_autorizacion,                               
 @auth,                               
 @usuario)                              
                    
        
--SI EXISTE LA ATENCION GUARDO LICENCIA-ATENCION DESDE MEDICOS                   
IF (select count(*) from MED_Atenciones where id = @Id_Atencion ) > 0                  
BEGIN                  
 UPDATE MED_Atenciones                  
 SET IdLicencia = @NewID                  
 WHERE id = @Id_Atencion                  
END                  
      
                    
select @NewID IdGenerado ' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Exist_Autoriz_Lic_Ord]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Exist_Autoriz_Lic_Ord]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ASIS_GET_Exist_Autoriz_Lic_Ord] 
@Id_Interna int,
@periodo int,
@id_concepto int
AS

SELECT id From autorizaciones_licencias where id_interna = @Id_Interna and periodo = @periodo and id_Concepto_licencia = @id_Concepto
' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_ALTA_Autorizaciones_Licencia_Ordinaria]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_ALTA_Autorizaciones_Licencia_Ordinaria]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ASIS_ALTA_Autorizaciones_Licencia_Ordinaria]
	(@Id_Interna int, 
	@Dias_Autorizados smallint,
             @año int)
AS
Declare @id_auth int
Declare @conceptoOrdinaria int
Declare	 @Id	[int]

set @conceptoOrdinaria = (select id_concepto from tabla_conceptos_licencias where Es_Ordinaria = 1)
set @id_auth = (select id from dbo.autorizaciones_licencias where id_interna = @id_interna and id_concepto_licencia = @conceptoOrdinaria and periodo = @año)

if @id_auth is null begin
	set  @Id = (select max(id)+1 from dbo.Autorizaciones_licencias where not id is null)		
	if @Id is null begin
		set @Id =1
	end
	INSERT INTO dbo.AUTORIZACIONES_LICENCIAS 
	(id_Interna, Dias_Autorizados, Periodo, Id_Concepto_Licencia, id)
		VALUES(
		@id_interna,
		@Dias_Autorizados, 
		@año,
		@conceptoOrdinaria,
		@id)
end  else begin
	UPDATE dbo.autorizaciones_licencias SET Dias_Autorizados = @Dias_Autorizados where id = @Id_Auth
end
' 
END
GO
/****** Object:  StoredProcedure [dbo].[MNS_ADD_Nota_Ingresada]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MNS_ADD_Nota_Ingresada]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[MNS_ADD_Nota_Ingresada]
	@Fecha char(10),
	@Hora char(5),
	@Solicito varchar(100),
	@Motivo varchar(200),	
	@Detalle text,
	@AsignadaA smallint = NULL,
	@UsuarioSistema smallint
AS
INSERT INTO dbo.MNS_Notas_Ingresadas
( Fecha, hora, solicito, motivo, detalle, asignadaA, fechaSistema, UsuarioSistema)
VALUES (@Fecha, @Hora, @Solicito, @Motivo, @Detalle, @AsignadaA, GetDate(), @UsuarioSistema)

	
	





' 
END
GO
/****** Object:  StoredProcedure [dbo].[MNS_GET_Notas_Ingresadas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MNS_GET_Notas_Ingresadas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[MNS_GET_Notas_Ingresadas]      
  @Usuario smallint ,    
  @Pendientes bit = 0     
AS      
SELECT  NI.Id,      
 NI.Fecha,      
 NI.Hora,      
 NI.Solicito,      
 NI.Motivo,      
 UD.Apellido +'', ''+ UD.Nombre AsignadaA,  
 CASE WHEN NR.Id IS NULL THEN  
  ''Pendiente''  
 ELSE  
  ''Respondida por '' + ISNULL(UDR.Apellido +'', ''+ UDR.Nombre,'''')   
 END Estado ,
 UDTx.Apellido +'', ''+ UDTx.Nombre IngresadaPor  
FROM  dbo.MNS_Notas_Ingresadas NI      
INNER JOIN dbo.RH_Usuarios_Detalles UD      
  ON UD.Id_Usuario = NI.Asignadaa    
INNER JOIN dbo.MNS_Asignables A      
  ON A.Id_Usuario = @Usuario    
LEFT JOIN dbo.MNS_Notas_Respondidas NR    
  ON NR.Id_Ingreso = NI.Id     
LEFT JOIN dbo.RH_Usuarios_Detalles UDR  
 ON UDR.Id_Usuario = NR.UsuarioRespuesta  
  
INNER JOIN dbo.RH_Usuarios_Detalles UDTx      
  ON UDTx.Id_Usuario = NI.UsuarioSistema
WHERE ((NI.Asignadaa = @Usuario) OR  (A.Vertodos = 1)) AND    
  ((NR.Id IS NULL AND @Pendientes = 0) OR (@Pendientes = 1))    
      
      
      
    
    
  
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[MNS_GET_Nota]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MNS_GET_Nota]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[MNS_GET_Nota]  
 @Id int  
AS  
  
SELECT  NI.Id,  
 NI.Fecha,  
 NI.Hora,  
 NI.Solicito,  
 NI.Motivo,  
 NI.Detalle,  
 UD.Apellido +'', ''+ UD.Nombre AsignadaA,  
 ISNULL(NR.Respuesta,'''') Respuesta,  
 CONVERT(char(10),FechaRespuesta,103) FechaRespuesta,
 ISNULL(UDR.Apellido +'', ''+ UDR.Nombre,'''') RespondidaPor  

FROM dbo.MNS_Notas_Ingresadas NI  
INNER JOIN dbo.RH_Usuarios_Detalles UD  
 ON UD.Id_Usuario = NI.asignadaa  
  
LEFT JOIN dbo.MNS_Notas_Respondidas NR  
 ON NR.Id_Ingreso = NI.Id  
LEFT JOIN dbo.RH_Usuarios_Detalles UDR
 ON UDR.Id_Usuario = NR.UsuarioRespuesta
WHERE NI.Id = @Id  
  
  
  
  



' 
END
GO
/****** Object:  StoredProcedure [dbo].[MNS_GET_Notas_Enviadas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MNS_GET_Notas_Enviadas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[MNS_GET_Notas_Enviadas] 
	 @Usuario smallint
AS    
SELECT  NI.Id,    
	NI.Fecha,    
	NI.Hora,    
	NI.Solicito,    
	NI.Motivo,    
	UD.Apellido +'', ''+ UD.Nombre AsignadaA,
	CASE WHEN NR.Id IS NULL THEN
		''Pendiente''
	ELSE
		''Respondida por '' + ISNULL(UDR.Apellido +'', ''+ UDR.Nombre,'''') 
	END Estado
FROM 	dbo.MNS_Notas_Ingresadas NI    
INNER JOIN dbo.RH_Usuarios_Detalles UD    
	 ON UD.Id_Usuario = NI.Asignadaa  
INNER JOIN dbo.MNS_Asignables A    
	 ON A.Id_Usuario = @Usuario  
LEFT JOIN dbo.MNS_Notas_Respondidas NR  
	 ON NR.Id_Ingreso = NI.Id   
LEFT JOIN dbo.RH_Usuarios_Detalles UDR
 ON UDR.Id_Usuario = NR.UsuarioRespuesta

WHERE	(NI.UsuarioSistema = @Usuario) 
    
    
    




' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_DEL_Estudio_Otros]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_DEL_Estudio_Otros]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create procedure [dbo].[LEG_DEL_Estudio_Otros]
	@IdEstudio int
AS
UPDATE dbo.LEG_Estudios_Otros
SET DatodeBaja = 1
WHERE Id = @IdEstudio


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Estudios_Otros]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Estudios_Otros]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[LEG_GET_Estudios_Otros]    
 @NroDocumento int      
    
AS    
    
SELECT  E.Id,    
 Establecimiento,  
 Titulo,    
 E.Folio_Nro Folio    
       
FROM dbo.LEG_Estudios_Otros E      
WHERE  Nro_Doc = @NroDocumento AND    
 DatodeBaja = 0     
      
      
    
      
      
    
    
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Estudio_Realizado_ID]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Estudio_Realizado_ID]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE   procedure [dbo].[LEG_GET_Estudio_Realizado_ID]    
 @IdEstudio int,  
 @Tipo as int  
AS  
  
IF @Tipo = 1 BEGIN   
 select *     
 from dbo.LEG_Estudios_Realizados E    
 where  Id = @IdEstudio     
END  
  
  
IF @Tipo = 2 BEGIN   
 select *     
 from dbo.LEG_Estudios_Otros E    
 where  Id = @IdEstudio     
END  
  
IF @Tipo = 3 BEGIN   
 select *     
 from dbo.LEG_Estudios_Especialidades E    
 where  Id = @IdEstudio     
END  
  
IF @Tipo = 4 BEGIN   
 select *     
 from dbo.LEG_Estudios_Idiomas E    
 where  Id = @IdEstudio     
END  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Estudios_Otros]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Estudios_Otros]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_ADD_Estudios_Otros]
	(@Establecimeinto 	[varchar](200),
	@Titulo_3 	[varchar](200),
	@Depende_de_2 	[varchar](50),
	@Expedido_por_4 	[varchar](200),
	@Fecha_I 	[datetime],
	@Fecha_E 	[datetime],
	@Folio_Nro_6 	[char](10),
	@Id_Interna_7 	[int],
	@Nro_Doc_8 	[int],
	@Cant_Horas_Totales_9 	[smallint],
	@Cant_Materias_Totales_11 	[smallint],
	@Evaluacion_Final_13 	[smallint],
	@Incompleto bit = 0 ,
	@datodebaja bit,
	@datonoimprime bit,
	@Usuario smallint)
AS 
INSERT INTO dbo.LEG_Estudios_Otros
	([Establecimiento],
	[Depende_de],
	[Titulo],
	[Expedido_por],
	[Fecha_ingreso],
	[Fecha_egreso],
	[Folio_Nro],
	[Id_Interna],
	[Nro_Doc],
	[Cant_Horas_Totales],
	[Cant_Materias_Totales],
	[Evaluacion_Final],
	Incompleto,
	datodebaja,
	datonoimprime,
	Usuario,
	FechaProceso) 
VALUES 
	(@Establecimeinto,
	@Depende_de_2,
	@Titulo_3,
	@Expedido_por_4,
	@Fecha_I,
	@Fecha_E,
	@Folio_Nro_6,
	@Id_Interna_7,
	@Nro_Doc_8,
	@Cant_Horas_Totales_9,
	@Cant_Materias_Totales_11,
	@Evaluacion_Final_13,
	@Incompleto,
	@datodebaja,
	@datonoimprime,
	@Usuario,
	Getdate())





' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Estudios_Otros]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Estudios_Otros]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


create  PROCEDURE [dbo].[LEG_UPD_Estudios_Otros]
	(@IdEstudio int,
	@Establecimeinto 	[varchar](200),
	@Titulo_3 	[varchar](200),
	@Depende_de_2 	[varchar](50),
	@Expedido_por_4 	[varchar](200),
	@Fecha_I 	[datetime],
	@Fecha_E 	[datetime],
	@Folio_Nro_6 	[char](10),
	@Cant_Horas_Totales_9 	[smallint],
	@Cant_Materias_Totales_11 	[smallint],
	@Evaluacion_Final_13 	[smallint],
	@Incompleto bit = 0 ,
	@datodebaja bit,
	@datonoimprime bit,
	@Usuario smallint)
AS 
UPDATE dbo.LEG_Estudios_Otros
SET	[Establecimiento]=@Establecimeinto,
	[Depende_de]=@Depende_de_2,
	[Titulo]=@Titulo_3,
	[Expedido_por]=@Expedido_por_4,
	[Fecha_ingreso]=@Fecha_I,
	[Fecha_egreso]=@Fecha_E,
	[Folio_Nro]=@Folio_Nro_6,
	[Cant_Horas_Totales]=@Cant_Horas_Totales_9,
	[Cant_Materias_Totales]=@Cant_Materias_Totales_11,
	[Evaluacion_Final]=@Evaluacion_Final_13,
	Incompleto=@Incompleto,
	datodebaja=@datodebaja,
	datonoimprime=@datonoimprime,
	Usuario=@Usuario,
	FechaProceso= GetDate()
WHERE Id = @IdEstudio
	
	





' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_Antiguedad_Asociada_Certificado]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Antiguedad_Asociada_Certificado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_Antiguedad_Asociada_Certificado]
	@Tipo Char(1),
	@Id int
as
SELECT convert(char(10),FechaProceso,103) FechaProceso
FROM dbo.Ctr_Antiguedad_Grado_Reconocidas
WHERE Tipo = @tipo and
	Id = @Id
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_ADD_Antiguedad_Grado_Reconocidas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ADD_Antiguedad_Grado_Reconocidas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[CTR_ADD_Antiguedad_Grado_Reconocidas]
	@Id_Interna int,
	@Tipo Char(1), --Estado,Privada,Contrato,X Ingreso Ministerio
	@Id int,
	@Desde datetime = NULL,
	@hasta datetime = NULL,
	@FechaCorte datetime 
AS
	INSERT INTO dbo.CTR_Antiguedad_Grado_Reconocidas
	VALUES (@Id_interna,
		@Tipo,
		@Id,
		@Desde,
		@Hasta,
		@FechaCorte,
		Getdate())	


	

	




' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_DEL_Antiguedad_Grado_Reconocidas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_DEL_Antiguedad_Grado_Reconocidas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CTR_DEL_Antiguedad_Grado_Reconocidas]
	@Id_interna int,
	@FechaCorte datetime
AS
DELETE	FROM dbo.CTR_Antiguedad_Grado_Reconocidas 
WHERE 	Id_interna =@Id_Interna AND FechaCorte = @Fechacorte


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Antiguedad_Grado_Reconocidas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Antiguedad_Grado_Reconocidas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[CTR_GET_Antiguedad_Grado_Reconocidas]
	@Id_Interna int,
	@FechaCorte datetime
AS
SELECT 	Id_interna,
	tipo,
	id,
	convert(char(10),desde,103) Desde,
	convert(char(10),hasta,103) hasta
FROM dbo.CTR_Antiguedad_Grado_Reconocidas
WHERE 	Id_Interna = @Id_interna AND
	FechaCorte = @FechaCorte



' 
END
GO
/****** Object:  View [dbo].[VW_GET_Tabla_Tipo_Expedientes]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_GET_Tabla_Tipo_Expedientes]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_GET_Tabla_Tipo_Expedientes]
as
select * from Tabla_Tipo_Expedientes
where baja=0

'
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_HistoricoDeBajasByDNI]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_HistoricoDeBajasByDNI]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create PROCEDURE [dbo].[CRED_Get_HistoricoDeBajasByDNI]
	@DocumentoPersona int
AS

select
	persAuth.Documento DocumentoAutorizanteBaja, persAuth.Nombres NombreAutorizanteBaja, persAuth.Apellido ApellidoAutorizanteBaja, persAuth.Id IdAutorizanteBaja,
	tipoDoc.Id IdTipoDocumentoBaja, tipoDoc.Descripcion DescripcionTipoDocumentoBaja,
	doc.Id IdDocumentoBajaPersona, doc.FolioDesde DocumentoBajaPersonaFolioDesde, doc.Foliohasta DocumentoBajaPersonaFolioHasta, doc.Fecha fechaDocumentoBajaPersona,
	baj.Id IdBajaPersona, baj.Motivo MotivoBajaPersona, baj.Fecha fechaBajaPersona

	from dbo.CRED_HistoricoBajasPersonas hisBaja
	inner join dbo.CRED_Bajas baj
		ON baj.Id = hisBaja.IdBaja
	inner join dbo.CRED_Personas pers
		ON pers.Id = hisBaja.IdPersona
	inner join  dbo.CRED_Documentos doc
		ON doc.Id = baj.IdDocumento
	inner join dbo.CRED_TiposDocumentos tipoDoc
		ON tipoDoc.Id = doc.IdTipoDocumento
	inner join dbo.CRED_Autorizantes auth
		ON auth.Id = baj.IdAutorizante
	inner join dbo.CRED_Personas persAuth
		ON persAuth.Id = auth.Id
where pers.Documento = @DocumentoPersona' 
END
GO
/****** Object:  StoredProcedure [dbo].[MNS_ADD_Respuesta]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MNS_ADD_Respuesta]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[MNS_ADD_Respuesta]
	@Id_Ingreso int,
	@respuesta text,
	@Usuario smallint
AS

INSERT INTO dbo.MNS_Notas_Respondidas
(Id_Ingreso, Respuesta, FechaRespuesta, UsuarioRespuesta)
VALUES (@Id_Ingreso, @Respuesta, getdate(), @Usuario)




' 
END
GO
/****** Object:  StoredProcedure [dbo].[CON_Apto_Jubilarse]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CON_Apto_Jubilarse]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'





CREATE procedure [dbo].[CON_Apto_Jubilarse]
	@Hasta_Fecha smalldatetime=null,
	@IdUsuario smallint
as
if @hasta_fecha is null begin
	set @hasta_fecha = (getdate())
end

SELECT nro_documento, dp.ID_INTERNA, apellido +'', ''+ nombre ApeyNombre, Fecha_nacimiento, dbo.FxCalcula_Edad (FECHA_NACIMIENTO,@hasta_fecha)Edad 
FROM DATOS_PERSONALES DP
INNER JOIN dbo.VW_Desglose_Area DA
	on da.id_interna = dp.Id_interna
INNER JOIN dbo.RH_Usuarios_Areas UA
	on UA.Id_Usuario = @IdUsuario AND
	   (UA.Id_Area = DA.Id_Area or Ua.id_area = 0)
where (sexo = 2 and dbo.FxCalcula_Edad (FECHA_NACIMIENTO,@hasta_fecha) > (select valor from dbo.tabla_parametros where tipo =''EJUBF '')) 
OR
(sexo = 1 and dbo.FxCalcula_Edad (FECHA_NACIMIENTO,@hasta_fecha) > (select valor from dbo.tabla_parametros where tipo =''EJUBM'')) 

AND dp.id_interna not in (select id_interna from dbo.legajo_bajas)

AND VisibleLegajos = 1 AND
BajaLegajos = 0








' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Familiares_Escolaridad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Familiares_Escolaridad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[LEG_GET_Familiares_Escolaridad]
	@id_interna int
as
SELECT  df.id_interna,
	df.fam_Docum_Nrodoc Doc_Fam,
	df.idfam Id_Fam, 
	df.apellido +'', ''+ nombre Familiar,
	ce.nivel_escolaridad,
	te.descripcion DescEscolaridad,
	ce.tipo_certificado,
	ce.fecha_presentacion,
	ce.id
FROM dbo.datos_familiares DF
left join dbo.LEG_Certificados_Escolaridad CE
	on ce.id_interna = df.id_interna and 
	   ce.id_familiar = df.idfam and
	   ce.id = (select max(id) from dbo.LEG_Certificados_Escolaridad where id_interna = df.id_interna and id_familiar = df.idfam)
left join dbo.Tabla_Fam_Escolaridad TE
	on te.id = ce.nivel_escolaridad

WHERE   dbo.FxCalcula_Edad(df.fecha_nacimiento,getdate()) <= (select valor from dbo.Tabla_Parametros where tipo = ''EMCE'')and 
	df.parentesco = 4 and 
	df.fecha_baja is null and 
	df.id_interna = @id_interna







' 
END
GO
/****** Object:  StoredProcedure [dbo].[GU_GET_FAMILIARES_COBRO]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GU_GET_FAMILIARES_COBRO]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'







CREATE procedure [dbo].[GU_GET_FAMILIARES_COBRO]
	@id_interna int=null,
	@Documento int=null,
	@Cert_Nacimiento bit=null
as

DECLARE @FCorte datetime
set @FCorte = (select valor from dbo.tabla_parametros where tipo =''FCGU'') +''/''+ convert(varchar ,(year(getdate()) ))

select dp.nro_documento, 
	dp.id_interna, 
	dp.apellido +'', ''+dp.nombre ApellidoT, 
	df.apellido +'', ''+ df.nombre ApellidoF,
	convert(varchar,df.fecha_nacimiento,103) FechaNacimiento,
	dbo.FxCalcula_Edad (df.fecha_nacimiento,@FCorte) Edad, 
	convert(varchar,@FCorte,103) FechaCorte, 
	df.idfam ,
	df.Fam_Docum_Nrodoc DocumentoF,
	isnull(gu.guarderia,'''') Guarderia,
	isnull(gu.cuit,'''') GuCUIT,
	isnull(df.cert_nacimiento,0) Cert_Leg,
	isnull(CN.id_fam,0) Cert_Gu
	

from dbo.datos_personales dp
inner join dbo.datos_familiares df
	on df.id_interna = dp.id_interna and df.parentesco = 4
left join dbo.GU_DDJJ_Guarderia GU
	on GU.id_interna = dp.id_interna
	and gu.id_fam = df.idfam
left join dbo.GU_Cert_Nacimiento CN
	on CN.id_interna = dp.id_interna and
           CN.id_fam = df.idfam
where 	(dbo.FxCalcula_Edad (df.fecha_nacimiento,@FCorte) <= (select valor from dbo.tabla_parametros where tipo =''EMGU'')) and
	(df.fecha_baja is null) and
	(dp.id_interna = @id_interna or @id_interna is null) and
	(dp.nro_documento = @documento or @documento is null) and
	(not cn.id_fam is null or @cert_nacimiento is null)



order by dp.apellido, dp.nombre, df.apellido, df.nombre









' 
END
GO
/****** Object:  StoredProcedure [dbo].[WEB_GetDotacionDeAreaAux]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_GetDotacionDeAreaAux]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 01/04/2009
-- Description:	SP auxiliar de WEB_GetDotacionDeArea
-- =============================================
CREATE PROCEDURE [dbo].[WEB_GetDotacionDeAreaAux]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


		----------------------------
		--  Temporal de Contratos --
		----------------------------	

		SELECT 
			dp.id_interna, 
			max(id_contrato) contrato_vigente,
			max(desglose_ng.desde) nivelGrado_desde,
			max(desglose_pl.desde) planta_desde,
			max(desglose_ar.desde) area_desde

			into #TMP_Dotacion
		FROM 
			dbo.ctr_contratos ctr_cont
		INNER JOIN 
			dbo.datos_personales dp
				ON ctr_cont.nro_documento = dp.nro_documento
		
		LEFT JOIN 
			dbo.leg_desglose_nivelgrado desglose_ng
				ON dp.id_interna = desglose_ng.id_interna
		
		LEFT JOIN
			dbo.leg_desglose_planta desglose_pl
				ON dp.id_interna = desglose_pl.id_interna

		LEFT JOIN
			dbo.leg_desglose_area desglose_ar
				ON dp.id_interna = desglose_ar.id_interna

		WHERE
			ctr_cont.baja = 0
			and ctr_cont.aprobado = 1
			and (desglose_ng.desde < getdate() or desglose_ng.desde is null)
			and (desglose_pl.desde < getdate() or desglose_pl.desde is null)

		GROUP by
			dp.id_interna

		ORDER BY
			dp.id_interna


		--------------------------
		--  Temporal de Legajos --
		--------------------------	

		SELECT 
			dp.id_interna--, 
			--max(id_contrato) contrato_vigente,
			--max(desglose_ng.desde) nivelGrado_desde,
			--max(desglose_pl.desde) planta_desde,
			--max(desglose_ar.desde) area_desde

			--into #TMP_Dotacion2
		FROM 
			dbo.datos_personales dp
		LEFT JOIN 
			dbo.ctr_contratos ctr_cont
			ON dp.nro_documento = ctr_cont.nro_documento
		
		LEFT JOIN 
			dbo.leg_desglose_nivelgrado desglose_ng
				ON dp.id_interna = desglose_ng.id_interna
		
		LEFT JOIN
			dbo.leg_desglose_planta desglose_pl
				ON dp.id_interna = desglose_pl.id_interna

		LEFT JOIN
			dbo.leg_desglose_area desglose_ar
				ON dp.id_interna = desglose_ar.id_interna

		WHERE
			((ctr_cont.nro_documento is null or dp.bajacontratos = 1 and dp.visiblelegajos = 1) 
			and  dp.bajalegajos = 0 and dp.visiblelegajos = 1)
			and (desglose_ng.desde < getdate() or desglose_ng.desde is null)
			and (desglose_pl.desde < getdate() or desglose_pl.desde is null)

		GROUP by
			dp.id_interna

		ORDER BY
			dp.id_interna

select * from  #TMP_Dotacion2
		----------------
		--  Resultado --
		----------------

		SELECT
			dp.nro_documento,
			dp.apellido,
			dp.nombre,
			dp.fecha_nacimiento,
			case when tn.Nivel is null then
				tfc.descripcion
			else
				tn.Nivel
			end Nivel_Funcion,
			case when tg.grado is null then  
				tr.descripcion  
			else  
				tg.grado  
			end Grado_rango,
			tipo_pl.descripcion TPlanta,
			ta.descripcion Area

		FROM 
			#TMP_Dotacion tmp

		INNER JOIN 
			dbo.datos_personales dp
			ON tmp.id_interna = dp.id_interna

		LEFT JOIN 
			dbo.leg_desglose_nivelgrado desglose_ng
				ON tmp.id_interna = desglose_ng.id_interna
				and tmp.nivelGrado_desde = desglose_ng.desde

			LEFT JOIN 
				dbo.tabla_niveles tn
					ON desglose_ng.id_nivel = tn.id

			LEFT JOIN
				dbo.tabla_grados tg
					ON desglose_ng.id_grado = tg.id

		LEFT JOIN
			dbo.leg_desglose_planta desglose_pl
				ON tmp.id_interna = desglose_pl.id_interna
				and tmp.planta_desde = desglose_pl.desde

			LEFT JOIN
				dbo.tipo_de_planta tipo_pl
				ON desglose_pl.id_planta = tipo_pl.id		

		LEFT JOIN
			dbo.leg_desglose_area desglose_ar
				ON tmp.id_interna = desglose_ar.id_interna
				and tmp.area_desde = desglose_ar.desde

			LEFT JOIN
				dbo.tabla_areas ta
				ON desglose_ar.id_area = ta.id

		LEFT JOIN
			dbo.ctr_contratos ctr_cont
			ON tmp.contrato_vigente = ctr_cont.id_contrato

		LEFT JOIN dbo.tabla_funciones_contratos tfc  
			ON tfc.id = ctr_cont.funcion  

		LEFT JOIN dbo.tabla_rangos tr
			ON tr.id = ctr_cont.rango  


		UNION ALL


		SELECT
			dp.nro_documento,
			dp.apellido,
			dp.nombre,
			dp.fecha_nacimiento,
			tn.Nivel Nivel_Funcion,
			tg.grado Grado_rango,
			tipo_pl.descripcion TPlanta,
			ta.descripcion Area

		FROM 
			#TMP_Dotacion2 tmp

		INNER JOIN 
			dbo.datos_personales dp
			ON tmp.id_interna = dp.id_interna

		LEFT JOIN 
			dbo.leg_desglose_nivelgrado desglose_ng
				ON tmp.id_interna = desglose_ng.id_interna
				and tmp.nivelGrado_desde = desglose_ng.desde

			LEFT JOIN 
				dbo.tabla_niveles tn
					ON desglose_ng.id_nivel = tn.id

			LEFT JOIN
				dbo.tabla_grados tg
					ON desglose_ng.id_grado = tg.id

		LEFT JOIN
			dbo.leg_desglose_planta desglose_pl
				ON tmp.id_interna = desglose_pl.id_interna
				and tmp.planta_desde = desglose_pl.desde

			LEFT JOIN
				dbo.tipo_de_planta tipo_pl
				ON desglose_pl.id_planta = tipo_pl.id		

		LEFT JOIN
			dbo.leg_desglose_area desglose_ar
				ON tmp.id_interna = desglose_ar.id_interna
				and tmp.area_desde = desglose_ar.desde

			LEFT JOIN
				dbo.tabla_areas ta
				ON desglose_ar.id_area = ta.id


		DROP TABLE #TMP_Dotacion
		DROP TABLE #TMP_Dotacion2
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Areas_Detalle]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Areas_Detalle]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[GABM_Tabla_Areas_Detalle]    
 @Operacion char(1),    
 @Id_Area int=null,    
 @Tratamiento_Area smallint=null,    
 @Calle varchar(255)=null,    
 @Nro varchar(5)=null,    
 @Piso varchar(3)=null,    
 @Dpto varchar(3)=null,    
 @Localidad int=null,    
 @Codigo_Postal int=null,    
 @Tratamiento smallint=null,    
 @Tratamiento_Titulo smallint=null,    
 @Contacto varchar(255)=null,    
 @Telefono varchar(20)=null,    
 @Fax varchar(20)=null    
as    
IF @Operacion =''A'' BEGIN    
 DECLARE @Codigo_Dependencia int    
 SET @Codigo_Dependencia = (select max(Codigo_Dependencia)+1 from dbo.tabla_areas_detalle)    
 IF @Codigo_Dependencia is null BEGIN    
  SET @Codigo_Dependencia = 1    
 END    
 INSERT INTO [dbo].[Tabla_Areas_Detalle]([Id_Area], Tratamiento_Area, [Codigo_Dependencia], [Calle], [Nro], [Piso], [Dpto], [Localidad], [Codigo_Postal], Tratamiento, Tratamiento_Titulo, [Contacto], [Telefono], [Fax], baja)    
 VALUES( @Id_Area,     
  @Tratamiento_Area,    
  @Codigo_Dependencia,    
  @Calle,    
  @Nro,     
  @Piso,    
  @Dpto,     
  @Localidad,     
  @Codigo_Postal,     
  @Tratamiento,    
  @tratamiento_Titulo,    
  @Contacto,     
  @Telefono,     
  @Fax,    
  0)    
END    
IF @Operacion = ''M'' BEGIN    
 UPDATE  [dbo].[Tabla_Areas_Detalle]    
 SET  tratamiento_area = @Tratamiento_Area,     
  [Calle]= @Calle,     
  [Nro]= @Nro,    
  [Piso]= @Piso,    
  [Dpto]= @Dpto,    
  [Localidad]= @Localidad,    
  [Codigo_Postal]= @Codigo_Postal,    
  tratamiento = @tratamiento,    
  tratamiento_titulo = @tratamiento_titulo,    
  [Contacto]=@Contacto,    
  [Telefono]= @Telefono,    
  [Fax]=@Fax    
 WHERE [Id_Area] = @Id_Area    
END    
IF @Operacion = ''B'' BEGIN    
 UPDATE  [dbo].[Tabla_Areas_Detalle]    
 SET  Baja = 1    
 WHERE  [Id_Area] = @Id_Area    
END    
IF @Operacion = ''R'' BEGIN    
 UPDATE  [dbo].[Tabla_Areas_Detalle]    
 SET  Baja = 0    
 WHERE  [Id_Area] = @Id_Area    
END    
  
IF @Operacion = ''S'' BEGIN    
 SELECT id_area,    
  tratamiento_area    
  Codigo_Dependencia,    
  Calle,    
  isnull(Nro,0) Nro,    
  isnull(Piso,'''') Piso,    
  isnull(Dpto,'''') Dpto,    
  localidad,    
  loc.Nombrelocalidad,    
  Codigo_Postal,    
  isnull(Tratamiento,-1) Tratamiento,    
  isnull(Tratamiento_Titulo,-1) Tratamiento_Titulo,    
  isnull(Contacto,'''') contacto,    
  isnull(Telefono,'''') telefono,    
  isnull(Fax,'''') fax,    
  tad.Baja    
 FROM [dbo].[Tabla_Areas_Detalle] TAD    
 INNER JOIN dbo.LocalidadesAfip Loc    
  on Loc.idLocalidad = TAD.localidad    
 WHERE  ([Id_Area] = @Id_Area ) OR (@id_area is null)    
END    
    
  
  
IF @Operacion = ''E'' BEGIN    
 SELECT id_area,    
 ta.descripcion,  
  tratamiento_area    
  Codigo_Dependencia,    
  Calle,    
  isnull(Nro,0) Nro,    
  isnull(Piso,'''') Piso,    
  isnull(Dpto,'''') Dpto,    
  localidad,    
  loc.Nombrelocalidad,    
  Codigo_Postal,    
  isnull(Tratamiento,-1) Tratamiento,    
  tt.descripcion TratamientoPersona,  
  isnull(Tratamiento_Titulo,-1) Tratamiento_Titulo,    
  ttt.descripcion tratamientotitulo,  
  isnull(Contacto,'''') contacto,    
  isnull(Telefono,'''') telefono,    
  isnull(Fax,'''') fax,    
  ta.Presenta_DDJJ,
  tad.Baja    

 FROM [dbo].[Tabla_Areas_Detalle] TAD    
 left JOIN dbo.LocalidadesAfip Loc    
  on Loc.idLocalidad = TAD.localidad    
 inner JOIN dbo.Tabla_Areas TA   
 ON TA.id = tad.Id_Area  
 left join tabla_tratamientos tt  
 on tt.id = tad.tratamiento and  
 tt.tipo = ''P''  
 left join dbo.tabla_tratamientos_titulos ttt  
 on ttt.id = tad.tratamiento_titulo   
-- WHERE  ([Id_Area] = @Id_Area ) OR (@id_area is null)    
END    
    
    
    
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[EXP_Desglose_FE]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EXP_Desglose_FE]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[EXP_Desglose_FE]
AS
SELECT 	FE.Id,
	FE.Id_interna,
	FE.Documento,
	TF.Descripcion Nivel,
	TD.Descripcion Designacion,
	FE.desde,
	isnull(FE.hasta,'''') hasta,
	case when FE.baja =1 then
		TTRB.Descripcion
	else
		TTR.Descripcion
	end Acto_Tipo,
	case when FE.baja =1 then
		FE.acto_nro_baja
	else
		FE.acto_nro
	end Acto_Nro,
	case when FE.baja =1 then
		isnull(FE.acto_fecha_baja,'''')
	else
		isnull(FE.acto_fecha,'''')
	end Acto_fecha,
	FE.baja,
	TT.Descripcion Tratamiento,
	TA.Descripcion Area
FROM 	dbo.LEG_Desglose_FE FE
INNER JOIN dbo.Tabla_Funciones TF
	ON TF.Id = FE.NIvel_Fe
INNER JOIN dbo.Tabla_Designacion TD	
	ON TD.ID = FE.Tipo_Fe
INNER JOIN dbo.Tabla_Tratamientos TT
	on TT.ID = FE.Tratamiento
INNER JOIN dbo.Tabla_Areas TA
	ON Ta.Id = FE.Id_Area
LEFT JOIN dbo.Tabla_Tipos_Resoluciones TTR
	ON TTR.Id = FE.Acto_Tipo
LEFT JOIN dbo.Tabla_Tipos_Resoluciones TTRB
	ON TTRB.Id = FE.Acto_Tipo_Baja

' 
END
GO
/****** Object:  StoredProcedure [dbo].[Get_Todos_Los_AgentesDeTodasLasAreas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Get_Todos_Los_AgentesDeTodasLasAreas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE  procedure [dbo].[Get_Todos_Los_AgentesDeTodasLasAreas] 
AS
Declare @CantidadDeAreas int
Declare @Contador int
Declare @idArea int 


Begin

 


set @CantidadDeAreas = (select max(id) from dbo.Tabla_Areas )
set @Contador=1


while @CantidadDeAreas <> @Contador 
begin 

	set @idArea =(select id from Tabla_Areas where @Contador=id and Baja<>1)
	
	  exec Web_GetAgentesDelArea @idArea
	
	
	set @Contador = @Contador + 1

--Trae todas las personas de un area y las inserta en una tabla temporal 
end

select * from #temporal

End



' 
END
GO
/****** Object:  StoredProcedure [dbo].[ESTR_UPD_ReIncorporar_Area]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ESTR_UPD_ReIncorporar_Area]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[ESTR_UPD_ReIncorporar_Area]
	@Area smallint
AS	
UPDATE dbo.Tabla_Areas
SET Baja = 0
WHERE Id = @Area

UPDATE dbo.Tabla_Areas_Estructura 
SET 	Baja = 0,
	Acto_Baja = NULL,
	Acto_Nro = NULL,
	Acto_Fecha = NULL
WHERE Id_Area = @Area

	
	

' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_Get_RecepcionRecibos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_Get_RecepcionRecibos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[PLA_Get_RecepcionRecibos]
	@año int,
	@Area int=null,
	@id_interna int=null,
	@Recep bit
as
select distinct  dp.id_interna,
	dp.apellido +'', ''+ dp.nombre Apellido,
	case when (select r.mes from dbo.PLA_Recibos where id_interna = dp.id_interna and mes =1 and año = @año) is not null then
		case when @recep=1 then ''Si'' else '''' end
	else
		case when @recep=0 then ''No'' else '''' end
	end Enero,
	case when (select r.mes from dbo.PLA_Recibos where id_interna = dp.id_interna and mes = 2 and año = @año) is not null then
		case when @recep=1 then ''Si'' else '''' end
	else
		case when @recep=0 then ''No'' else '''' end	end Febrero,
	case when (select r.mes from dbo.PLA_Recibos where id_interna = dp.id_interna and mes = 3 and año = @año) is not null then
		case when @recep=1 then ''Si'' else '''' end
	else
		case when @recep=0 then ''No'' else '''' end	end Marzo,
	case when (select r.mes from dbo.PLA_Recibos where id_interna = dp.id_interna and mes = 4 and año = @año) is not null then
		case when @recep=1 then ''Si'' else '''' end
	else
		case when @recep=0 then ''No'' else '''' end	end Abril,
	case when (select r.mes from dbo.PLA_Recibos where id_interna = dp.id_interna and mes = 5 and año = @año) is not null then
		case when @recep=1 then ''Si'' else '''' end
	else
		case when @recep=0 then ''No'' else '''' end
	end Mayo,
	case when (select r.mes from dbo.PLA_Recibos where id_interna = dp.id_interna and mes = 6 and año = @año) is not null then
		case when @recep=1 then ''Si'' else '''' end
	else
		case when @recep=0 then ''No'' else '''' end	
	end Junio,
	case when (select r.mes from dbo.PLA_Recibos where id_interna = dp.id_interna and mes = 7 and año = @año) is not null then
		case when @recep=1 then ''Si'' else '''' end
	else
		case when @recep=0 then ''No'' else '''' end	
	end Julio,
	case when (select r.mes from dbo.PLA_Recibos where id_interna = dp.id_interna and mes = 8 and año = @año) is not null then
		case when @recep=1 then ''Si'' else '''' end
	else
		case when @recep=0 then ''No'' else '''' end	
	end Agosto,
	case when (select r.mes from dbo.PLA_Recibos where id_interna = dp.id_interna and mes = 9 and año = @año) is not null then
		case when @recep=1 then ''Si'' else '''' end
	else
		case when @recep=0 then ''No'' else '''' end	
	end Septiembre,
	case when (select r.mes from dbo.PLA_Recibos where id_interna = dp.id_interna and mes = 10 and año = @año) is not null then
		case when @recep=1 then ''Si'' else '''' end
	else
		case when @recep=0 then ''No'' else '''' end	
	end Octubre,
	case when (select r.mes from dbo.PLA_Recibos where id_interna = dp.id_interna and mes = 11 and año = @año) is not null then
		case when @recep=1 then ''Si'' else '''' end
	else
		case when @recep=0 then ''No'' else '''' end	
	end Noviembre,
	case when (select r.mes from dbo.PLA_Recibos where id_interna = dp.id_interna and mes = 12 and año = @año) is not null then
		case when @recep=1 then ''Si'' else '''' end
	else
		case when @recep=0 then ''No'' else '''' end	
	end Diciembre,
	a.descripcion Area

from dbo.datos_personales DP
left join dbo.PLA_Recibos R
	on Dp.id_interna = r.id_interna

inner join dbo.designaciones D
	on d.id_interna = dp.id_interna and d.fecha_hasta IS NULL
inner join dbo.vw_desglose_area vwda on
	vwda.id_interna = d.id_interna

inner join dbo.tabla_areas A
	on A.id = vwda.id_area

where (vwda.id_area = @area or @area is null) and
      (dp.id_interna = @id_interna or @id_interna is null) 

group by dp.id_interna,r.mes, dp.apellido,dp.nombre,a.descripcion

order by dp.apellido



' 
END
GO
/****** Object:  StoredProcedure [dbo].[CGet_Datos_Personales_Leg]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CGet_Datos_Personales_Leg]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[CGet_Datos_Personales_Leg]
	 @Nro_Documento_16 	[int]

AS
Select 	 DP.[Id_Interna],
	 [Apellido],
	 [Nombre],
	 [Sexo],
	 [Fecha_Nacimiento],
	 [Cuil_Nro],
	 [Tipo_Documento],
	 [Nro_Documento],
	 [Regimen_Jubilatorio],
	 [Denominacion],
	 [Estado_Civil],
	nacionalidad,

	--da.Id_Area,
	d.area id_area,
	TA2.descripcion DescAreaN
	

FROM [dbo].[Datos_Personales]   DP

--left join dbo.vw_desglose_area da
--	on dp.nro_documento = da.documento
left join dbo.designaciones d
	on  d.nro_doc=dp.nro_documento and fecha_hasta=''01/01/2006''

left join dbo.tabla_areas TA2
	on TA2.id = d.area


--left join dbo.tabla_areas TA2
--	on TA2.id = da.id_area


Where   Nro_Documento = @Nro_Documento_16

' 
END
GO
/****** Object:  View [dbo].[VW_Dependencias_Secretarias]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Dependencias_Secretarias]'))
EXEC dbo.sp_executesql @statement = N'

CREATE  view [dbo].[VW_Dependencias_Secretarias]
as

select top 100 percent  id,descripcion 
from dbo.tabla_areas
where --nivel <3 and 
baja =0 
--and id=dependencia

--in (select distinct(dependenci) from dbo.tabla_dependencias)
--where id in (select distinct(secretaria) from dbo.tabla_dependencias)
order by descripcion
	



'
GO
/****** Object:  StoredProcedure [dbo].[GetArea_Actual]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetArea_Actual]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[GetArea_Actual] 
	@id_interna [int]=null,
	@documento [int]=null

as 

SELECT	a.id, 
	a.descripcion 
FROM dbo.vw_desglose_area D
INNER JOIN dbo.tabla_areas A
	on a.id = d.id_area
WHERE (d.id_interna = @id_interna or d.documento = @documento)



/*

alter procedure dbo.GetCalcular_Dotacion_Area
	@area [int],
	@nivel smallint
as
select

	permanente= (select count(id_interna) from dbo.designaciones D
	inner join dbo.tipo_de_planta TP 
		on TP.id = D.id_planta
	where (area =@area or ((left(area,@nivel) = left(@area,@nivel) and right(area,3)>900)))and fecha_hasta = ''01/01/2006'' and TP.tipo = ''P'' and id_interna not in (select id_interna from legajo_bajas) ) 
	,	
	transitoria=(select count(id_interna) from dbo.designaciones D
	inner join dbo.tipo_de_planta TP 
		on TP.id = D.id_planta
	where (area =@area or ((left(area,@nivel) = left(@area,@nivel) and right(area,3)>900))) and fecha_hasta = ''01/01/2006'' and TP.tipo = ''T'' and id_interna not in (select id_interna from legajo_bajas))	
	,
	gabinete=(select count(id_interna) from dbo.designaciones D
	inner join dbo.tipo_de_planta TP 
		on TP.id = D.id_planta
	where (area =@area or ((left(area,@nivel) = left(@area,@nivel) and right(area,3)>900))) and fecha_hasta = ''01/01/2006'' and TP.tipo = ''G'' and id_interna not in (select id_interna from legajo_bajas))	
	,
	contratada=(select count (area) from designaciones d
	inner join dbo.tipo_de_planta TP 
		on TP.id = D.id_planta
	where (area =@area or ((left(area,@nivel) = left(@area,@nivel) and right(area,3)>900))) and fecha_hasta = ''01/01/2006'' and TP.tipo = ''C'' and id_interna not in (select id_interna from legajo_bajas))	
	,
	contratos = (select distinct count(id_area) from ccontrato C
	inner join Cdatos_personales DP
		on dp.legajo = c.legajo
	where (id_area =@area or ((left(id_area,@nivel) = left(@area,@nivel) and right(id_area,3)>900))) and  dp.send_legajos=0 and dp.baja=0 and c.id = (select max(id) from ccontrato where legajo = dp.legajo and baja =0 and aprobado=1))

--(id_area =@area or(left(id_area,@nivel) = left(@area,@nivel) and right(id_area,3)>900)) and c.baja =0 and dp.send_legajos=0 and c.aprobado=1 and dp.baja=0)
	,
	externa=(select count (area) from designaciones d
	inner join dbo.tipo_de_planta TP 
		on TP.id = D.id_planta
	where d.fecha_hasta = ''01/01/2006'' and  TP.tipo = ''E''
	and (area =@area or ((left(area,@nivel) = left(@area,@nivel) and right(area,3)>900))) and id_interna not in (select id_interna from legajo_bajas))




alter procedure dbo.GetCalcular_Dotacion_Area_Detalle
	@area [int],	
	@Nivel smallint,
	@Planta [varchar](20)	
as

if @Planta > ''C'' and @planta > ''TT''begin
-- PERMAMENTE, TRANSITORIA, GABINETE
	select distinct dp.apellido Apellido, dp.nombre Nombre, dp.nro_documento Legajo , convert(varchar(10),dp.fecha_nacimiento,103) Fecha_Nacimiento ,tp.descripcion Planta, tn.nivel Nivel, tg.grado Grado, 0 monto, convert(varchar(10),df.fecha_min,103) Fecha_Ing , Ant.Ant_total Antiguedad ,d.area , ta.descripcion Dependencia from dbo.designaciones D
	left join dbo.tipo_de_planta TP 
		on TP.id = D.id_planta
	inner join datos_personales DP
		on dp.id_interna = d.id_interna
--
	left JOIN dbo.Tabla_niveles TN
		on tn.id = d.id_nivel
	left JOIN dbo.tabla_grados TG
		on tg.id = d.id_grado
	left JOIN dbo.Tabla_areas TA
		on ta.id = d.area
	left join dbo.designaciones_fechas DF
		on df.id_interna = dp.id_interna
	left JOIN dbo.antiguedad Ant
		on ant.id_interna = dp.id_interna
--
	where (area =@area or(left(area,@nivel) = left(@area,@nivel) and right(area,3)>900))and d.fecha_hasta = ''01/01/2006'' and TP.tipo = @Planta and
		d.id_interna not in (select id_interna from legajo_bajas)
	order by apellido,nombre
end
if @Planta =''C'' begin
--contratada LEGAJOS
	select dp.apellido Apellido, dp.nombre Nombre, dp.nro_documento Legajo, convert(varchar(10),dp.fecha_nacimiento,103) Fecha_Nacimiento, tp.descripcion Planta, tn.nivel Nivel_Funcion, tg.grado Grado_Rango, 0 monto , convert(varchar(10), df.fecha_min,103) Fecha_Ing , Ant.Ant_total Antiguedad , d.area, ta.descripcion Dependencia 
	from dbo.designaciones D
	left join dbo.tipo_de_planta TP 
		on TP.id = D.id_planta
	inner join datos_personales DP
		on dp.id_interna = d.id_interna
--
	left JOIN dbo.Tabla_niveles TN
		on tn.id = d.id_nivel
	left JOIN dbo.tabla_grados TG
		on tg.id = d.id_grado
	INNER JOIN dbo.Tabla_areas TA
		on ta.id = d.area
	left join dbo.designaciones_fechas DF
		on Df.id_interna = dp.id_interna
	left JOIN dbo.antiguedad Ant
		on ant.id_interna = dp.id_interna
--



	where (area =@area or(left(area,@nivel) = left(@area,@nivel) and right(area,3)>900))and d.fecha_hasta = ''01/01/2006'' and TP.tipo = @Planta and
		d.id_interna not in (select id_interna from legajo_bajas)

	union all

--Contratada CONTRATOS
	select distinct dp.apellido, dp.nombre, dp.legajo, convert(varchar(10),dp.fecha_nac,103) Fecha_Nacimiento, ''CContratada'' Planta, 
--
	case when ttc.SendLegajos = 1 then
		tn.nivel --nivel
	else
		tf.descripcion --funcion
	end 	Nivel_Funcion,
	case when ttc.SendLegajos = 1 then
		tg.grado --grado
	else
		tr.descripcion --rango
	end 	Grado_Rango,
	isnull(c.monto,0) Monto , 
-- **
	(select convert(char(10),desde,103) from ccontrato where nro_contrato = (select min(nro_contrato) 
	from ccontrato where legajo = c.legajo)) Fecha_Ing,

	dbo.fx_calcula_antiguedad((select convert(char(10),desde,103) from ccontrato where nro_contrato = (select min(nro_contrato) 
	from ccontrato where legajo = c.legajo)),getdate()) Antiguedad,	

-- **

	c.id_area Area, ta.descripcion dependencia
--
	from ccontrato C
	inner join Cdatos_personales DP
		on dp.legajo = c.legajo
--
	INNER JOIN dbo.Tabla_Resoluciones_Contratos TRC
		on TRC.id = c.tipo_contrato
	INNER JOIN dbo.Tabla_Tipos_Contratos TTC
		on TTC.id = TRC.tipo_contrato
	LEFT JOIN dbo.tabla_niveles TN
		on tn.id = c.nivel
	LEFT JOIN dbo.tabla_grados TG
		on tg.id = c.grado
	LEFT JOIN dbo.Tabla_Funciones_contratos TF
		on tf.id = c.funcion
	LEFT JOIN dbo.tabla_Rangos TR
		on tr.id = c.rango
	INNER JOIN dbo.Tabla_areas TA
		on ta.id = c.id_area

--SendLegajos = 1 --> nivel/grado
--

	where (id_area =@area or(left(id_area,@nivel) = left(@area,@nivel) and right(id_area,3)>900)) and c.baja =0 and dp.send_legajos=0 and c.aprobado=1 and dp.baja =0
	order by apellido,nombre
end

IF @Planta = ''TT'' BEGIN
--LEGAJOS
	select dp.apellido Apellido, dp.nombre Nombre, dp.nro_documento Legajo , convert(varchar(10),dp.fecha_nacimiento,103) Fecha_Nacimiento, tp.Descripcion Planta , tn.nivel Nivel_Funcion, tg.grado Grado_Rango, 0 Monto , convert(varchar(10),df.fecha_min,103) Fecha_Ing , Ant.Ant_total Antiguedad,  d.area, ta.descripcion Dependencia from dbo.designaciones D
	left join dbo.tipo_de_planta TP 
		on TP.id = D.id_planta
	inner join datos_personales DP
		on dp.id_interna = d.id_interna
--
	left JOIN dbo.Tabla_niveles TN
		on tn.id = d.id_nivel
	left JOIN dbo.tabla_grados TG
		on tg.id = d.id_grado
	INNER JOIN dbo.tabla_areas TA
		on ta.id = d.area
	left JOIN dbo.designaciones_fechas DF
		on df.id_interna = dp.id_interna
	left JOIN dbo.antiguedad Ant
		on ant.id_interna = dp.id_interna
--
	where (area =@area or(left(area,@nivel) = left(@area,@nivel) and right(area,3)>900))and d.fecha_hasta = ''01/01/2006''  and
		d.id_interna not in (select id_interna from legajo_bajas)


	union all

--CONTRATOS
	select distinct dp.apellido, dp.nombre, dp.legajo , convert(varchar(10),dp.fecha_nac,103) Fecha_Nacimiento, ''Contratada'' Planta,
--
	case when ttc.SendLegajos = 1 then
		tn.nivel --nivel
	else
		tf.descripcion --funcion
	end 	Nivel_Funcion,
	case when ttc.SendLegajos = 1 then
		tg.grado --grado
	else
		tr.descripcion --rango
	end 	Grado_Rango,
	isnull(c.monto,0) Monto, 
-- **
	(select convert(char(10),desde,103) from ccontrato where nro_contrato = (select min(nro_contrato) 
	from ccontrato where legajo = c.legajo)) Fecha_Ing,

	dbo.fx_calcula_antiguedad((select convert(char(10),desde,103) from ccontrato where nro_contrato = (select min(nro_contrato) 
	from ccontrato where legajo = c.legajo)),getdate()) Antiguedad,	

-- **
	c.id_area Area, ta.descripcion Dependencia
--
	from ccontrato C
	inner join Cdatos_personales DP
		on dp.legajo = c.legajo

--
	INNER JOIN dbo.Tabla_Resoluciones_Contratos TRC
		on TRC.id = c.tipo_contrato
	INNER JOIN dbo.Tabla_Tipos_Contratos TTC
		on TTC.id = TRC.tipo_contrato
	LEFT JOIN dbo.tabla_niveles TN
		on tn.id = c.nivel
	LEFT JOIN dbo.tabla_grados TG
		on tg.id = c.grado
	LEFT JOIN dbo.Tabla_Funciones_Contratos TF
		on tf.id = c.funcion
	LEFT JOIN dbo.tabla_Rangos TR
		on tr.id = c.rango
	--TR.SendLegajos = 1 --> nivel/grado
	INNER JOIN dbo.tabla_areas TA
		on ta.id = c.id_area

--
	where (id_area =@area or(left(id_area,@nivel) = left(@area,@nivel) and right(id_area,3)>900)) and c.baja =0 and dp.send_legajos=0 and c.aprobado=1 and dp.baja =0

	order by apellido,nombre
END







*/







' 
END
GO
/****** Object:  View [dbo].[VW_Tabla_areas]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_areas]'))
EXEC dbo.sp_executesql @statement = N'

CREATE  VIEW [dbo].[VW_Tabla_areas]
AS
SELECT  top 100 percent *
FROM dbo.Tabla_areas
where baja =0
order by id, descripcion







'
GO
/****** Object:  StoredProcedure [dbo].[ASIS_BCO_Planilla_Firmas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_BCO_Planilla_Firmas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE   procedure [dbo].[ASIS_BCO_Planilla_Firmas]
	@Documento int,
	@Area int
AS
SELECT 	DP.Id_interna,
	Dp.Apellido +'',''+ DP.Nombre Agente, 
	TA.descripcion Sector
FROM dbo.Datos_Personales DP
inner join dbo.tabla_areas  TA
	on TA.id = @Area OR
		TA.id = (select id_area from Relacion where id_area_viejo = @Area)
WHERE DP.nro_Documento = @Documento







' 
END
GO
/****** Object:  StoredProcedure [dbo].[Web_Login]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Web_Login]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE  procedure [dbo].[Web_Login]    
@usuario varchar(50),    
@password varchar(50)    
as    
    
DECLARE @usua int    
  
set @usua = ( select top 1 isnull(ta.id,0)
 from     
  [dbo].[RH_Usuarios_Areas_Web] aw    
 inner join dbo.RH_usuarios us on    
   us.id = aw.id_usuario    
 inner join dbo.tabla_areas ta on    
  ta.id = id_area    
 inner join dbo.web_passwords pa on    
  pa.idUsuario = us.id    
 where     
  us.Nombre = @usuario and    
  pa.password = @password  and    
--  us.password = @password  and    
  us.Baja <> 1    
)  
  
    
 select    
  us.nombre,    
  us.id id_usuario,    
  us.password,    
  ta.id id_area,    
  ta.descripcion nombre_area    
 from     
  [dbo].[RH_Usuarios_Areas_Web] aw    
 inner join dbo.RH_usuarios us on    
   us.id = aw.id_usuario    
 inner join dbo.tabla_areas ta on    
  ta.id = id_area    
 inner join dbo.web_passwords pa on    
  pa.idUsuario = us.id    
 where     
  us.Nombre = @usuario and    
  pa.password = @password  and    
--  us.password = @password  and    
  us.Baja <> 1    
     

IF @usua > 0
BEGIN
	insert into log_web values (@usua, getdate())    
END    
  
  ' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_GET_Pases]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_GET_Pases]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[PLA_GET_Pases]
	@Estado smallint=0
AS
	SELECT
	[P].[id], [DP].[Nro_Documento], [DP].[ID_INTERNA],
	[DP].[apellido] + '', '' + [DP].[Nombre] Agente,
	[AACTUAL].[descripcion] AreaAct, [ANUEVA].[descripcion] AreaNueva,
	[P].[fecha_solicitud], [P].[estado], [P].[area_nueva],

	convert(char(10),fecha_pase,103) Fecha_Pase

FROM [dbo].[PLA_Pases_Solicitados] P
INNER JOIN [dbo].[Datos_Personales] DP
	ON [DP].[Id_interna] = [P].[Id_Interna]
INNER JOIN [dbo].[Tabla_Areas] AActual
	ON [AACTUAL].[id] = [P].[area_actual]
INNER JOIN [dbo].[Tabla_Areas] ANueva
	ON [Anueva].[id] = [P].[Area_Nueva]

WHERE [P].[Estado] = @estado
	--  0 pendiente
	--  1 confirmado
	--  2 rechazado

ORDER BY [fecha_solicitud]




' 
END
GO
/****** Object:  View [dbo].[VW_CON_Consulta_ART]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CON_Consulta_ART]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view  [dbo].[VW_CON_Consulta_ART]
AS
SELECT 	top 100 percent apellido,
	nombre,
	nro_documento Documento,
	cuil_nro CUIL,
	ta.descripcion Dependencia,
	tad.calle,
	tad.nro,
	l.nombrelocalidad localidad,
	tad.contacto responsable,
	tad.telefono
FROM dbo.datos_personales dp
INNER JOIN dbo.designaciones d
	on d.id_interna = dp.id_interna
	 	and fecha_hasta = ''01/01/2006''
INNER JOIN dbo.tabla_areas ta
	on ta.id = d.area
INNER JOIN dbo.tabla_areas_detalle tad
	on tad.id_area = ta.id
INNER JOIN dbo.localidadesafip l
	on l.idlocalidad = tad.localidad
LEFT JOIN dbo.legajo_bajas lb
	on lb.id_interna = dp.id_interna
WHERE	lb.id_interna is null
	
	
ORDER BY Apellido, Nombre


'
GO
/****** Object:  StoredProcedure [dbo].[RPT_CTR_Recepcion_Contratos]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_CTR_Recepcion_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[RPT_CTR_Recepcion_Contratos]
	@Compro_Recepcion int
as

select  dp.apellido +'', ''+ dp.nombre apellido_nombre,
	rc.Compro_Recepcion,
	convert(char(10),rc.Compro_Recepcion_Fecha,103) Recepcion_Fecha,
	ta.descripcion,
	n.nivel,
	g.grado

from dbo.CTR_Recepcion_Contratos rc

inner join ctr_contratos cc
	on cc.id_contrato = rc.id_contrato

inner join datos_personales dp
	on dp.nro_documento = cc.nro_documento

inner join vw_desglose_area da
	on cc.nro_documento = da.documento

inner join tabla_areas ta
	on da.id_area = ta.id

inner join tabla_niveles n
	on n.id = cc.nivel

inner join tabla_grados g
	on g.id = cc.grado

where Compro_Recepcion =  @Compro_Recepcion

order by apellido, nombre
' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_ASIS_Informe_Recepcion_Planillas]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_ASIS_Informe_Recepcion_Planillas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[RPT_ASIS_Informe_Recepcion_Planillas]
	@Periodo char(7),
	@Area int= null
AS
SELECT	count(p.area) Recepcionadas,
	p.area,
	(select count(id_interna) from dbo.designaciones where area = p.area and fecha_hasta = ''01/01/2006'') Dotacion,
	max(ta.descripcion)
FROM dbo.ASIS_Planillas_Recibidas P
INNER JOIN dbo.tabla_areas TA
	ON TA.id = P.area
WHERE 	P.periodo = @Periodo and
	TA.baja =0
GROUP BY P.area




' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Areas_del_Parte_Diario]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Areas_del_Parte_Diario]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE Procedure [dbo].[ASIS_GET_Areas_del_Parte_Diario]
	@fecha [smalldatetime]= Null,
	@confirmado [bit]=0
AS
	SELECT 
	convert(char(10), [PC].[fecha], 103) +'' - ''+ [TA].[Descripcion] Descripcion
	FROM 	[dbo].[ASIS_Parte_Cabecera] [PC]
	INNER JOIN [dbo].[Tabla_areas] [TA] ON
		[TA].[id] = [PC].[id_area]
	WHERE (convert(char, [PC].[Fecha], 103) = @fecha OR @fecha is NULL) and 
	  	[PC].[confirmado] = @confirmado
	ORDER BY [Ta].[descripcion]

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CAsignar_Expediente]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CAsignar_Expediente]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CAsignar_Expediente]  
 @Aprobado_23  [bit],  
 @Area [int],  
 @Secretaria [int],  
 @Legajo [int]=null,  
 @tipo_cont [int]=null,  
 @exp [varchar](30)=null  
AS   
select  TC.id Tipo_Contrato,  
 TC.descripcion Desc_Contrato,   
 c.nro_contrato,  
 C.[Legajo],  
 C.[Id],  
 DP.Apellido,  
  DP.Nombre,  
   
 convert (char(10), C.[Desde],103) Desde ,  
 convert (char(10), C.[Hasta],103) Hasta,  
  
 TA.descripcion Dependencia,   
 TA2.descripcion Secretaria  
  
   
From  [dbo].[CContrato]  C  
  
inner join dbo.CDatos_Personales DP  
 on DP.Legajo = C.Legajo  
  
inner join dbo.Tabla_Resoluciones_Contratos TC  
 on TC.id = C.tipo_contrato  
  
inner join dbo.tabla_areas TA  
 on (TA.id = c.id_area)   
  
inner join dbo.tabla_areas TA2  
 on TA2.id = c.id_secretaria  
  
  
Where  C.aprobado= @Aprobado_23 and     
 c.Baja=0 and  
(    
 ((c.id_area  = @secretaria and @secretaria <> -1) or  
 (left(c.id_area,2) = left(@area,2) and @secretaria = -1)) --and  
 or   
 (@area = -1 and @secretaria=-1)  
) and  
   
 (C.legajo = @legajo or @legajo is null) and  
 (c.impreso = 1) and  
 --(c.exp_nro=@exp or @exp is null) and  
 (c.exp_nro is null) and  
 (c.tipo_contrato=@tipo_cont or @tipo_cont is null )   
  
order by DP.Apellido,  dp.nombre ,id_area, id_secretaria  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_MED_Certificado_Embarazo]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_MED_Certificado_Embarazo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[RPT_MED_Certificado_Embarazo]  
 @IdEmbarazo int      
AS      
SELECT DP.Apellido +'', ''+ DP.Nombre Paciente,      
 RTRIM(DI.Descripcion) Tipo_Documento,      
 DP.Nro_Documento  Nro_Documento,      
 ISNULL(Convert(char(10),AM.FechaProbable,103),'''') FechaProbable,      
 ISNULL(Convert(char(10),AM.FechaParto,103),'''') FechaParto,      
 TADP.Descripcion Area,      
 ISNULL(AM.ObservacionesPreParto,''-'') ObservacionesPreParto,      
 ISNULL(AM.ObservacionesPosParto,''-'') ObservacionesPosParto,      
 ISNULL(convert(char(10),LS.Desde,103),''--/--/----'') Desde,      
 ISNULL(convert(char(10),LS.Hasta,103),''--/--/----'') Hasta,      
 ISNULL(RTRIM(cast(TCL.Nro_Articulo as char))+'' ''+ upper(TCL.Concepto),''---'') Concepto      
        
FROM dbo.MED_Embarazadas AM      
      
INNER JOIN dbo.Datos_Personales DP      
 ON DP.Nro_Documento = AM.Nro_Documento      
INNER JOIN dbo.Tabla_DocIdentidad DI      
 on DI.Id = DP.Tipo_Documento      
INNER JOIN dbo.VW_Desglose_Area DA      
 ON DA.Documento = DP.Nro_Documento      
      
INNER JOIN dbo.Tabla_Areas TADP      
 on TADP.Id = DA.Id_Area      
      
LEFT JOIN dbo.Licencias_Solicitadas LS      
 ON LS.Id = AM.IdLicencia      
      
LEFT JOIN Tabla_Conceptos_Licencias TCL      
 ON TCL.Id_Concepto = LS.Concepto      
      
WHERE AM.Id =  @IdEmbarazo  
      
      
      
    
  
' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_ASIS_Incorporacion_Agente]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_ASIS_Incorporacion_Agente]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[RH_ASIS_Incorporacion_Agente]  
	 @Operacion char(1),  
	 @Id int =NULL,  
	 @Usuario smallint =NULL  
AS  
  
IF @Operacion = ''I'' BEGIN  
	 UPDATE dbo.RH_Traspaso_Documentacion  
	 SET Usuario_Rx = @Usuario,  
	     Fecha_Rx = Getdate()  
	 WHERE id =  @Id  
END  
  
IF @Operacion = ''S'' BEGIN  
	 SELECT  TD.Registro Documento,  
	  DF.Id_Interna,  
	  convert(char(10),DF.Fecha_Min,103) Fecha_Min,  
	  convert(Char(10),TD.Fecha_TX,103) Fecha_Tx,  
	  Dp.Apellido +'', ''+ Dp.nombre Apellido,  
	  TA.Descripcion Area  
	 FROM dbo.RH_Traspaso_Documentacion TD  
	 INNER JOIN dbo.Designaciones_Fechas DF  
	  ON DF.Nro_Doc = TD.Registro  
	 INNER JOIN dbo.Datos_Personales DP  
	  ON DP.Nro_Documento = TD.Registro  
	 INNER JOIN dbo.VW_Desglose_Area DA  
	  ON DA.Documento = DP.Nro_Documento  
	 INNER JOIN dbo.Tabla_Areas TA   
	  ON TA.Id = DA.Id_Area  
	 WHERE (TD.Id = @Id OR @Id IS NULL)  
END  
  
  
  
  



' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_Areas_Dependencia]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_Areas_Dependencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[EVAL_GET_Areas_Dependencia] 
@codigo varchar(24)
AS
select ta.id, ta.descripcion from 
dbo.Fx_Listar_Areas_Dependencia(@codigo) fx
inner join dbo.tabla_areas ta
	on fx.codigo = ta.id
' 
END
GO
/****** Object:  StoredProcedure [dbo].[DOT_GetAreas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[DOT_GetAreas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 28/09/09
-- Description:	Trate todas las areas, para armar la dotacion.
-- =============================================
CREATE PROCEDURE [dbo].[DOT_GetAreas]
AS
BEGIN
	SET NOCOUNT ON;

	select 
		id,
		descripcion nombre
	from dbo.tabla_areas
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_Areas_FE]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_Areas_FE]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <28/04/2008>
-- Description:	<Trae todo el arbol de areas hacia abajo de una funcion ejecutiva. Si algun area de las de abajo tiene su propia fe, la trae tambien>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_GET_Areas_FE]
	@id_evaluador int,
	@id_periodo int
AS
BEGIN
	SET NOCOUNT ON;
	
declare @hasta as smalldatetime
set @hasta = (
select hasta from dbo.eval_periodos_evaluacion
where id = @id_periodo
)

SELECT distinct FE.id_area , desde
FROM dbo.LEG_Desglose_FE FE
INNER JOIN dbo.tabla_areas TA
	on FE.desde <= @hasta and (FE.hasta >= @hasta or FE.hasta is null)
where Fe.id_interna = @id_evaluador
order by FE.desde desc
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Solicitudes_Web]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Solicitudes_Web]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

 --[dbo].[ASIS_GET_Solicitudes_Web] 

CREATE PROCEDURE [dbo].[ASIS_GET_Solicitudes_Web] 
@id_interna int = NULL,
@Id_Area int = NULL,
@fecha smalldatetime = NULL
AS


SELECT 
SW.Fecha_Solicitud,
DP.Apellido + '', '' + DP.Nombre Nombre,
TCL.Descripcion descLicencia,
SW.Desde,
SW.Hasta,
TA.Descripcion Area,
SW.id,
DP.Id_Interna,
TCL.Nro_Articulo,
TCL.Id_Concepto,
UD.Apellido + '', '' + UD.Nombre Usuario

FROM dbo.ASIS_Solicitudes_Licencia_Web SW
INNER JOIN dbo.VW_Desglose_Area DA ON
DA.id_interna = SW.id_interna
INNER JOIN dbo.Datos_Personales DP ON
DP.id_interna = DA.id_interna
INNER JOIN dbo.Tabla_Conceptos_Licencias TCL ON
TCL.id_Concepto = SW.Concepto
INNER JOIN dbo.Tabla_Areas TA ON
DA.id_Area = TA.id
INNER JOIN dbo.RH_Usuarios US ON
US.id = SW.Usuario
INNER JOIN dbo.RH_Usuarios_Detalles UD ON
UD.id_usuario = US.id
LEFT JOIN dbo.licencias_solicitadas ls ON
ls.id_interna = sw.id_interna and
ls.concepto = sw.concepto and
ls.desde = sw.desde and
ls.hasta = sw.hasta
LEFT JOIN ASIS_Solicitudes_Licencia_Web_Rechazadas re ON
re.id_interna = sw.id_interna and
re.concepto = sw.concepto and
re.desde = sw.desde and
re.hasta = sw.hasta

WHERE (SW.id_interna = @id_interna or @id_interna is null) AND
	(DA.Id_Area = @id_area or @id_area is null) AND
	(SW.fecha_solicitud = @fecha OR @fecha is null) AND
	(re.id_interna is null) AND
	(ls.id_interna is null)
	AND SW.baja is null or sw.baja = 0

--order by sw.id_interna' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Areas_Estructura]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Areas_Estructura]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'







CREATE procedure [dbo].[GABM_Tabla_Areas_Estructura]
	@Operacion char(1),
	@codigo char(24)=null,
	@Id_Area int=null,
	@Descripcion Varchar(200)=null,
	@Baja bit=null,
	@Acto_Baja smallint=null,
	@Acto_Nro varchar(10)=null,
	@Acto_Fecha datetime=null
AS
IF @Operacion =''A'' BEGIN
	INSERT INTO [dbo].[Tabla_Areas_Estructura](codigo, id_area, descripcion,baja)
	VALUES(	@Codigo, 
		@Id_area,
		@Descripcion,
		0)
END
IF @Operacion = ''M'' BEGIN
	UPDATE 	[dbo].[Tabla_Areas_Estructura]
	SET 	Descripcion = @Descripcion
	WHERE   Id_area = @id_area
END
IF @Operacion = ''B'' BEGIN
	UPDATE 	[dbo].[Tabla_Areas_Estructura]
	SET 	Baja = 1,
		Acto_Baja = @acto_Baja,
		Acto_Nro = @Acto_Nro,
		Acto_Fecha = @Acto_Fecha
	WHERE 	[Codigo] = @Codigo
END
IF @Operacion = ''R'' BEGIN
	UPDATE 	[dbo].[Tabla_Areas_Estructura]
	SET 	Baja = 0,
		Acto_Baja = null,
		Acto_Nro = null,
		Acto_Fecha = null
	WHERE 	[Codigo] = @Codigo
END
IF @Operacion = ''S'' BEGIN
	SELECT	E.Codigo,
		e.id_area,
		e.Descripcion,
		e.Baja,
		e.Acto_Baja,
		e.Acto_Nro,
		e.Acto_fecha,
		isnull(d.tratamiento_area,-1)tratamiento_area,
		d.calle,
		d.nro,
		isnull(d.piso,'''')piso,
		isnull(d.dpto,'''') dpto,
		d.localidad,
		d.codigo_postal,
		isnull(d.tratamiento,-1)tratamiento,
		isnull(d.tratamiento_titulo,-1)tratamiento_titulo,
		isnull(d.contacto,'''') Contacto,
		isnull(d.telefono,'''') telefono,
		isnull(d.fax,'''') fax,
		A.Presenta_DDJJ DDJJ
	FROM	dbo.Tabla_Areas_Estructura E
	INNER JOIN dbo.Tabla_Areas_Detalle D
		ON D.id_area = E.id_area
	INNER JOIN dbo.Tabla_Areas A
		ON A.Id = D.Id_Area
	WHERE 	(E.Codigo = @Codigo ) OR (@Codigo is null)
END









' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_GET_Area_Actual]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_Area_Actual]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create PROCEDURE [dbo].[MED_GET_Area_Actual]       
	@documento [int]      
AS     

IF (Select Nro_Documento from dbo.Datos_Personales WHERE Nro_Documento = @Documento) IS NULL BEGIN
	SELECT MP.Area IdArea, ISNULL(TA.Descripcion,'''') Area       
	FROM dbo.MED_PACIENTES MP      
	INNER JOIN dbo.TABLA_AREAS TA      
	 ON TA.id = MP.area   
	WHERE (MP.nro_documento = @documento)     
END
ELSE BEGIN
	SELECT DA.Id_Area IdArea, ISNULL(TA.Descripcion,'''') Area       
	FROM dbo.VW_Desglose_Area DA
	INNER JOIN dbo.Tabla_Areas TA
		on TA.Id = DA.Id_Area
	WHERE DA.documento = @documento     
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Consulta_Licencia]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Consulta_Licencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[ASIS_GET_Consulta_Licencia]    
    
  @Id_Interna int=null,    
  @Lic int=null,    
  @Area int=null ,  
  @IdUsuario int=null,
  @Periodo smallint=null
    
as    
 SELECT  DP.Nro_Documento Documento,     
  Ls.Id_Interna,    
  DP.Apellido,    
  DP.Nombre,     
  --ls.concepto,     
  tc.Nro_Articulo +''-''+ tc.Concepto Articulo,    
  tc.descripcion Licencia,    
     
  --AÑO     
  case when max(tc.dias_autorizados) <> 365 then    
   max(tc.dias_autorizados)    
  else    
   ''-''     
  end Anual_Autorizados,     
      
  max(tc.dias_autorizados)- (max(tc.dias_autorizados) - sum(ls.dias_a_Tomar)) Anual_Tomados,     
      
  case when max(tc.dias_autorizados) <> 365 then    
   max(tc.dias_autorizados) - sum(ls.dias_a_Tomar)     
  else    
   ''-''     
  end Anual_Restan,     
      
  --MES    
  case when max(isnull(tclmes.diasmensuales,0)) = 0 then    
   ''-''    
  else    
   replace(max(tclmes.diasmensuales),0,''-'')       
  end Mensual_Autorizados,    
    
  case when max(isnull(tclmes.diasmensuales,0)) = 0 then    
   ''-''    
  else    
   replace(max(tclmes.diasmensuales) - (sum(CASE WHEN tclmes.diasmensuales IS NULL THEN 0 ELSE tclmes.diasmensuales END) - sum(CASE WHEN lsmes.dias_a_tomar IS NULL THEN 0 ELSE lsmes.dias_a_tomar END)),0,''-'')       
  end Mensual_Tomados,    
    
  case when max(isnull(tclmes.diasmensuales,0)) = 0 then    
   ''-''    
  else    
   sum(CASE WHEN tclmes.diasmensuales IS NULL THEN 0 ELSE tclmes.diasmensuales END) - sum(CASE WHEN lsmes.dias_a_tomar IS NULL THEN 0 ELSE lsmes.dias_a_tomar END)      
  end Mensual_Restan,    
    
  ta2.descripcion Area    
  --ls.id_area    
    
    
 FROM dbo.licencias_solicitadas ls    
    
 INNER JOIN dbo.tabla_conceptos_licencias tc    
  ON tc.id_concepto = ls.concepto    
    
 INNER JOIN dbo.Datos_Personales DP     
  ON DP.Id_interna = Ls.Id_Interna    
    
 LEFT JOIN (dbo.licencias_solicitadas lsMes     
       
  
 INNER JOIN dbo.Tabla_conceptos_licencias tclMes    
  ON lsMes.concepto = tclMes.id_concepto     
  AND tclMes.DiasMensuales <> 0 AND NOT tclMes.DiasMensuales IS NULL    
  AND month(lsmes.desde) = month(getdate())    
  AND year(lsmes.desde) = year(getdate()) )    
    ON ls.id = lsMes.id   
    
     
 LEFT join dbo.tabla_areas TA    
  on TA.id = ls.id_area    
     
 LEFT join dbo.vw_desglose_area da    
  on dp.nro_documento = da.documento    
     
 LEFT join dbo.tabla_areas TA2    
  on TA2.id = da.id_area    
     
    
 WHERE (ls.periodo = @Periodo OR @Periodo IS NULL) and     
  (ls.id_interna = @Id_Interna or @Id_Interna is null) and    
  (ls.concepto=@lic or @lic is null) and    
  (ls.id_area=@area or @area is null) and     
  tc.id_concepto<>1    
      
    
 GROUP BY Ls.id_interna, DP.apellido,DP.Nombre, ls.concepto, tc.Nro_Articulo, tc.Concepto, tc.descripcion, DP.Nro_Documento,ta2.descripcion,ls.id_area    
 HAVING sum(ls.dias_a_Tomar) > 0    
    
 order by Apellido, Nombre    
    
    
  
  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[GEN_GET_Area]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GEN_GET_Area]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE 
[dbo].[GEN_GET_Area] 
@id_area int AS


select top 1 ta.id, ta.descripcion, ta.baja, tae.codigo 
from dbo.tabla_areas ta
inner join dbo.tabla_areas_estructura tae
	on ta.id = tae.id_area
where TA.ID = @id_area
order by taE.codigo
' 
END
GO
/****** Object:  View [dbo].[VW_CConsulta_Firmantes]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CConsulta_Firmantes]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_CConsulta_Firmantes]
as
select top 100 percent Apellido [Apellido y Nombre],Cargo,Direccion, fc.Secretaria Id_Secretaria,ta.descripcion Secretaría,

case when firma_contrato=1 then
	''SI''
else
	''NO''
end Firma_Contrato

 
from cfirmantes_contratos FC

inner join tabla_areas ta
	on ta.id=fc.secretaria

order by fc.secretaria

'
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Areas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Areas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'





CREATE procedure [dbo].[GABM_Tabla_Areas]
	@Operacion char(1),
	@id int,
	@descripcion varchar(200)=null,
	@Presenta_DDJJ smallint=null,
	@Usuario smallint
AS
IF @Operacion = ''A'' BEGIN
	INSERT INTO [dbo].[Tabla_Areas]([id], [descripcion], [Baja], [Fecha_Desde],  [Presenta_DDJJ],Usuario)
	VALUES(	@id,
		@descripcion,
		0,
		getdate(),
		@Presenta_DDJJ,
		@usuario)
END
IF @Operacion = ''M'' BEGIN
	UPDATE 	[dbo].[Tabla_Areas]
	SET  	[descripcion]=@descripcion,
		[Presenta_DDJJ]=@Presenta_DDJJ,
		usuario = @Usuario
	WHERE 	id= @id
END

IF @Operacion = ''B'' BEGIN
	UPDATE 	[dbo].[Tabla_Areas]
	SET  	[Baja]=1,
		usuario =@usuario
	WHERE 	id= @id
END
IF @Operacion = ''R'' BEGIN
	UPDATE 	[dbo].[Tabla_Areas]
	SET  	[Baja]=0,
		Fecha_desde= getdate(),
		usuario = @usuario
	WHERE 	id= @id
END





' 
END
GO
/****** Object:  View [dbo].[VW_CON_Pases_Sector]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CON_Pases_Sector]'))
EXEC dbo.sp_executesql @statement = N'

CREATE view [dbo].[VW_CON_Pases_Sector]
as
select top 100 percent dp.apellido, dp.nombre, dp.nro_documento, d.id_interna,  d.fecha_desde,  TA.DESCRIPCION
from designaciones d
inner join datos_personales dp
	on dp.id_INTERNA = d.id_interna
inner join tabla_areas ta
	on ta.id = D.AREA
order by d.id_interna, d.fecha_desde asc




'
GO
/****** Object:  View [dbo].[VW_Tabla_URetributivas]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_URetributivas]'))
EXEC dbo.sp_executesql @statement = N'CREATE    view [dbo].[VW_Tabla_URetributivas]    
AS    
SELECT  TRU.id_area,     
 TRU.Cantidad,     
 (TRU.Cantidad - (select isnull(sum(cant_ur),0)   
  from dbo.LEG_Desglose_UR   
  where id_area = TRU.Id_Area and baja =0)) Disponibles,    
  ta.descripcion Desc_Area    
FROM  dbo.Tabla_URetributivas TRU    
INNER JOIN dbo.tabla_areas TA    
 on ta.id = TRU.id_area    
WHERE  TRU.baja =0 AND    
 TA.baja =0    
    
    
    
    
  

'
GO
/****** Object:  StoredProcedure [dbo].[ASIS_Get_Deudores_Partes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Get_Deudores_Partes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[ASIS_Get_Deudores_Partes]
@desde smalldatetime, @hasta smalldatetime, @id_area int = null, @id_resp int = null
AS
BEGIN

SELECT TA.id, TA.descripcion Area, isnull(APW.fecha,'''') fh_web, isnull(APR.fh_parte,'''') fh_fisico
FROM dbo.Tabla_Areas TA
LEFT JOIN dbo.Asis_partes_recibidos APR ON
TA.id = APR.id_area AND ((APR.fh_parte between @desde and @hasta) or APR.fh_parte is null)
LEFT JOIN dbo.Asis_partes_Web APW ON
TA.id = APW.id_area AND ((APW.fecha between @desde and @hasta) or APW.fecha is null)
LEFT JOIN dbo.RH_Usuarios_Areas_Web UAW ON
UAW.id_area = TA.id AND not @id_resp is null
where ((APW.fecha >= @desde AND APW.fecha <= @hasta) OR APW.fecha IS NULL) AND
      ((APR.fh_parte >= @desde AND APR.fh_parte <= @hasta) OR APR.fh_parte IS NULL )
		AND (TA.id = @id_area OR @id_area is null)
		AND ((UAW.Id_Usuario = @id_resp AND UAW.baja=0) OR @id_resp IS NULL)
		AND TA.baja = 0 

ORDER BY TA.id, fh_parte

END' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_GET_Areas_Usuario]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_GET_Areas_Usuario]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE   PROCEDURE [dbo].[RH_GET_Areas_Usuario]  
@usuario int,
@solo_web bit = NULL
AS  

IF @solo_web = 1 BEGIN

	SELECT [t].[id], [t].[descripcion]

	FROM [dbo].[RH_USUARIOS_AREAS_WEB] [w]
	INNER JOIN [dbo].[Tabla_Areas] [t]
		ON [t].[id] = [w].[id_area]
	
	WHERE [w].[id_usuario] = @usuario and w.baja = 0

END ELSE BEGIN 

	SELECT [t].[id], [t].[descripcion]
	
	FROM [dbo].[RH_USUARIOS_AREAS] [w]
	INNER JOIN [dbo].[Tabla_Areas] [t]
		ON [t].[id] = [w].[id_area]
	  
	WHERE [w].[id_usuario] = @usuario  

END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_GET_Agentes_Incorporados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_GET_Agentes_Incorporados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[PLA_GET_Agentes_Incorporados]
AS
SELECT	AI.id,
	CASE WHEN DP.Nro_Documento IS NULL THEN
		''No''
	ELSE
		''Si''
	END Encontrado,
	isnull(AI.Doc,'''') DocSolicitado,
	isnull(AI.Apellido +'', ''+ AI.Nombre,'''') ApellidoSolicitado,
	isnull(AI.Telefono,'''') Telefono,
	isnull(AI.Modalidad,'''') Modalidad,
	isnull(TA.Descripcion,'''') AreaSolicita,
	isnull(UD.Apellido +'', ''+ UD.Nombre,'''') UsuarioSolicito,
	isnull(convert(char(10),AI.fecha_solicitud_incorporacion,103),'''') FechaSolicitado,
	ISNULL(TA2.Descripcion,'''') AreaActual,
	ISNULL(DP.Apellido +'', ''+ DP.Nombre,'''') ApellidoReal

FROM dbo.PLA_Agentes_Incorporados AI
LEFT JOIN dbo.Datos_Personales DP
	on DP.Nro_Documento = AI.Doc
left JOIN dbo.Tabla_Areas TA
	on TA.id = AI.Area

LEFT JOIN dbo.VW_Desglose_Area DA
	on DA.Documento = AI.Doc

LEFT JOIN dbo.Tabla_Areas TA2
	on TA2.Id = DA.Id_Area

LEFT JOIN dbo.RH_Usuarios_Detalles UD
	on UD.Id_Usuario = AI.Usuario_solicito_incorporacion
WHERE  AI.Confirmado = 0 OR AI.Confirmado is null



' 
END
GO
/****** Object:  StoredProcedure [dbo].[CGet_Facturas_areas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CGet_Facturas_areas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[CGet_Facturas_areas]

@apellido varchar(20)=null,
@dep int=null,
@sec int=null,
@año int=null,
@baja smallint,
@operacion int

as

if @operacion=1 begin

	select cdp.apellido,cdp.nombre,f.legajo,f.año_factura,dbo.FxMontos_Facturas (cdp.legajo,@año) Monto

from cfacturas f

	inner join cdatos_personales cdp
		on cdp.legajo=f.legajo
	
	inner join ccontrato c
		on c.id=f.id_contrato

	inner join dbo.tabla_areas TA
		on TA.id = c.id_area

	inner join dbo.Tabla_Resoluciones_Contratos TC
		on TC.id = C.tipo_contrato


	where 	(cdp.apellido like @apellido + ''%'' or @apellido is null) and 
		(c.id_area=@dep or @dep is null) and
		(c.id_secretaria= @sec or @sec is null) and
		--(f.año_factura=@año or @año is null) and 
		c.baja=@baja and anulada=0 and 
		tc.id=2
			           
group by cdp.apellido,cdp.nombre, f.legajo, año_factura,cdp.legajo
order by cdp.apellido, cdp.nombre,f.año_factura
end


if @operacion=2 begin

select  cdp.Legajo, cdp.Apellido, cdp.Nombre, 

	case when (select mes_factura from cfacturas where mes_factura =1 and legajo = cdp.legajo and año_factura =@año ) is null then
		''1''
	else
		''''
	end +
 	case when (select mes_factura from cfacturas where mes_factura =2 and legajo = cdp.legajo and año_factura =@año) is null then
	 	'', '' + ''2''
	else
		''''
	end +
 	case when (select mes_factura from cfacturas where mes_factura =3 and legajo = cdp.legajo and año_factura =@año) is null then
	 	'', '' + ''3''
	else
		''''
	end +
 	case when (select mes_factura from cfacturas where mes_factura =4 and legajo = cdp.legajo and año_factura =@año) is null then
	 	'', '' + ''4''
	else	
		''''
	end +
	case when (select mes_factura from cfacturas where mes_factura =5 and legajo = cdp.legajo and año_factura =@año) is null then
	 	'', '' + ''5''
	else	
		''''
	end +
	case when (select mes_factura from cfacturas where mes_factura =6 and legajo = cdp.legajo and año_factura =@año) is null then
	 	'', '' + ''6''
	else	
		''''
	end +
	case when (select mes_factura from cfacturas where mes_factura =7 and legajo = cdp.legajo and año_factura =@año) is null then
	 	'', '' + ''7''
	else	
		''''
	end +
	case when (select mes_factura from cfacturas where mes_factura =8 and legajo = cdp.legajo and año_factura =@año) is null then
	 	'', '' + ''8''
	else	
		''''
	end +
	case when (select mes_factura from cfacturas where mes_factura =9 and legajo = cdp.legajo and año_factura =@año) is null then
	 	'', '' + ''9''
	else	
		''''
	end +
	case when (select mes_factura from cfacturas where mes_factura =10 and legajo = cdp.legajo and año_factura =@año) is null then
	 	'', '' + ''10''
	else	
		''''
	end +
	case when (select mes_factura from cfacturas where mes_factura =11 and legajo = cdp.legajo and año_factura =@año) is null then
	 	'', '' + ''11''
	else	
		''''
	end +
	case when (select mes_factura from cfacturas where mes_factura =12 and legajo = cdp.legajo and año_factura =@año) is null then
	 	'', '' + ''12''
	else	
		''''
	end Meses_Faltantes


from cdatos_personales cdp

	left join ccontrato c
		on c.legajo=cdp.legajo
	
	left join cfacturas f
		on c.legajo=f.legajo and f.anulada=0 and (f.año_factura=@año or @año is null)
	
	left join dbo.tabla_areas TA
		on TA.id = c.id_area

	--left join dbo.Tabla_Tipos_Resoluciones TTR
		--on ttr.id=f.acto_tipo

	left join dbo.Tabla_Resoluciones_Contratos TC
		on TC.id = C.tipo_contrato

	where 	(cdp.apellido like @apellido + ''%'' or @apellido is null) and 
		(c.id_area=@dep or @dep is null) and
--		(c.id_secretaria= @sec or @sec is null) and
		c.baja=0 and tc.tipo_contrato=1
			           
group by cdp.legajo,cdp.apellido,cdp.nombre , año_factura
order by cdp.apellido, cdp.nombre,f.año_factura


end
' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_URetributivas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_URetributivas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[GABM_Tabla_URetributivas]
	@Operacion char(1),
	@Area 	[int]=null,
	@Cantidad int=null

AS 
IF @operacion =''A''
BEGIN
	INSERT INTO dbo.Tabla_URetributivas
		 ([Id_Area],
		 [Cantidad],
		Baja) 
 	VALUES 
		(@Area,
		 @Cantidad,
		0)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_URetributivas
	set 	[Cantidad] =  @Cantidad
	where 	id_area = @Area
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_URetributivas
	set 	baja =  1
	where 	id_area = @Area
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_URetributivas
	set 	baja =  0
	where 	id_Area = @Area
END


IF @operacion =''S''
BEGIN
	SELECT	Id_Area,
		TA.Descripcion,		
		Cantidad Cantidad,
		
		case when ur.baja = 1 then
			''Si''
		else
			''No''
		end Baja 
	FROM  dbo.Tabla_URetributivas UR
	INNER JOIN dbo.Tabla_Areas TA
		on TA.id = UR.Id_Area
	WHERE (id_area = @Area) OR (@Area is null)
	ORDER BY ta.Descripcion
END










' 
END
GO
/****** Object:  StoredProcedure [dbo].[ESTR_DEL_Area]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ESTR_DEL_Area]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ESTR_DEL_Area]
	@Area smallint,
	@Acto smallint,
	@Acto_Nro varchar(10),
	@Acto_Fecha datetime
AS

UPDATE dbo.Tabla_Areas
SET baja = 1
where Id = @Area


UPDATE dbo.Tabla_Areas_Estructura
SET 	Baja = 1,
	Acto_baja = @Acto,
	Acto_Nro = @Acto_Nro,
	Acto_Fecha = @Acto_Fecha
Where 	Id_Area = @Area and
	right(codigo,5) <> ''00000''
	
	





' 
END
GO
/****** Object:  StoredProcedure [dbo].[CGet_CDatos_Personales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CGet_CDatos_Personales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CGet_CDatos_Personales]
	(@Legajo_1 	[int],
	 @Apellido_2 	[varchar](20) = null)

AS 
select	dp.[Legajo],
	dp.[Apellido],
	 dp.[Nombre],
	 dp.[Tipo_doc],
	 dp.[Estado_Civil],
	dp.[CUIT],
	 dp.[Telefono],
	dp.[Mail],
	dp.[Opc_Jub],
	dp.[AFJP],
	dp.baja,	
	dp.fechabaja,
	dp.Send_Legajos,
	dp.fecha_nac,
	dp.sexo,
	dp.nacionalidad,

	da.id_area,
	TA2.descripcion DescAreaN

from  [dbo].[CDatos_Personales]  dp

left join dbo.vw_desglose_area da
	on dp.legajo = da.documento


left join dbo.tabla_areas TA2
	on TA2.id = da.id_area

where  dp.legajo =  @Legajo_1 or  (apellido = @Apellido_2)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Desglose_Detalles]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Desglose_Detalles]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[LEG_GET_Desglose_Detalles]
	@Tipo char(1),
	@Id_Interna int
AS


IF @Tipo = ''A'' BEGIN
	SELECT 	A.Id,
		convert(char(10),Desde,103) Desde,
		''Area: ''+ TA.Descripcion Concepto
	FROM dbo.leg_desglose_Area A
	INNER JOIN dbo.Tabla_Areas TA
		on TA.Id = A.Id_Area
	WHERE Id_Interna = @Id_Interna
	ORDER BY cast(Desde as datetime)
END

IF @Tipo = ''P'' BEGIN
	SELECT 	P.Id,
		convert(char(10),Desde,103) Desde,
		''Planta: ''+TP.Descripcion + '' - Desig: ''+ TD.Descripcion Concepto
	FROM dbo.leg_desglose_planta P
	INNER JOIN dbo.Tipo_de_Planta TP
		on TP.Id = P.Id_Planta
	INNER JOIN dbo.tabla_Designacion TD
		on TD.Id = P.Desig_Planta
	WHERE Id_Interna = @Id_Interna
	ORDER BY cast(Desde as datetime)
END
IF @Tipo = ''N'' BEGIN
	SELECT 	Ng.Id, 
		convert(char(10),Desde,103) Desde,
		''Nivel: '' + TN.Nivel +'' - Grado: ''+ TG.Grado Concepto
	FROM dbo.leg_desglose_nivelgrado NG
	INNER JOIN dbo.Tabla_Niveles TN
		on TN.Id = NG.Id_Nivel
	INNER JOIN dbo.Tabla_Grados TG
		on TG.id = NG.Id_grado
	WHERE Id_Interna = @Id_Interna
	ORDER BY cast(Desde as datetime)
END





' 
END
GO
/****** Object:  StoredProcedure [dbo].[ESTR_DEL_Estructura]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ESTR_DEL_Estructura]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[ESTR_DEL_Estructura]
	@Area int,
	@Acto smallint,
	@Acto_Nro varchar(10),
	@Acto_Fecha datetime
AS  
  
UPDATE dbo.Tabla_Areas  
SET baja = 1  
where Id in (select (codigo) from fx_Listar_Dependencias_Areas (@area)) 
  
  
UPDATE dbo.Tabla_Areas_Estructura  
SET Baja = 1 ,
	Acto_baja = @Acto,
	Acto_Nro = @Acto_Nro,
	Acto_Fecha = @Acto_Fecha
where Id_Area in (select (codigo) from fx_Listar_Dependencias_Areas (@area)) 
   
   
  
  
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CGet_CContrato]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CGet_CContrato]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CGet_CContrato]
 
@Legajo_1 [int]

AS 
Select    c.[Legajo],
	 c.[Id],
	 c.[Tipo_Contrato],
	 c.[Desde],
	 c.[Hasta],
	c.acta_nro,
	c.exp_nro,
	c.acto_tipo,
	c.acto_nro,
	c.acto_fecha,
	c.nivel,
	c.grado,
	c.funcion,
	c.rango,
	c.monto,
	c.conserva_area,
             

	case when c.impreso=1 or c.conserva_area=1 then
		c.[Id_Area] 
	else
		--(select id_area from vw_desglose_area where documento= c.legajo)
		da.id_area	
	end Id_Area,

--	case when c.aprobado=0 then
--		c.id_secretaria
--	else
--		''cc''
--	end id_secretaria,

	c.firmado,
	c.impreso,
	c.fechabaja,
	c.baja,
	c.nro_contrato,
	c.aprobado,
	c.observacion,
	c.excepcion,
	c.enmienda,

	c.id_firma,
	TFC.apellido DescFirma,	

	TC.Descripcion DescContrato,

        TR.descripcion DescActo,
	TN.nivel as DescNivel,
	TG.grado as DescGrado,

	TF.descripcion DescFuncion,
	TRG.descripcion DescRango,

--	case when c.aprobado = 1 then
--		 (select descripcion from dbo.tabla_areas where id = c.id_area)
--	else
--		 (select descripcion from dbo.tabla_areas where id = (select id_area from dbo.VW_Desglose_area where documento= c.legajo))
--	end DescArea,

	TA.descripcion DescArea,
	TA2.descripcion DescAreaN,
--	TA2.descripcion DescSecretaria,

	tc.tipo_contrato IdContrato,
	c.estado
	
from  dbo.[CContrato]  C

inner join dbo.Tabla_Resoluciones_Contratos TC
	on TC.id = c.tipo_contrato

left join dbo.tabla_niveles TN
	on TN.id = C.nivel
left join dbo.tabla_grados TG
	on TG.id = c.grado

left join dbo.tabla_tipos_resoluciones TR
	on TR.id = c.acto_tipo

--left join dbo.tabla_areas TA
--	on TA.id = c.id_area

--left join dbo.tabla_areas TA2
--	on TA2.id = c.id_secretaria

left join dbo.tabla_areas TA
	on TA.id = c.id_area


inner join cdatos_personales dp
	on dp.legajo = c.legajo

inner join dbo.vw_desglose_area da
	on dp.legajo = da.documento

--left join dbo.carea_contrato da
--	on c.legajo = da.documento

left join dbo.tabla_areas TA2
	on TA2.id = da.id_area
	
LEFT join dbo.tabla_funciones_contratos TF
	on TF.id = c.funcion

left join dbo.tabla_rangos TRG
	on TRG.id = c.rango

left join dbo.CFirmantes_Contratos TFC
	on TFC.id = C.id_firma


where c.legajo =  @Legajo_1 

order by c.desde desc ,c.hasta desc
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Area_Formal]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Area_Formal]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Area_Formal]
	@id_area int
as

select tae.id_area 
from tabla_areas_estructura tae

INNER JOIN dbo.Tabla_Areas TA 
	on TAE.id_Area = TA.Id 

where codigo = (select max(left(codigo,19)) + ''00000'' 
		from tabla_areas_estructura
		where left(codigo,19) = (select top 1 left(codigo,19)  
					from tabla_areas_estructura 
					where id_area = @id_area ))
	AND TA.Baja = 0 
	AND TA.Presenta_DDJJ = 1


' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Anexo_UR]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Anexo_UR]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[RPT_LEG_Anexo_UR]    
 	@exp varchar(30)  = null
as    
select ta.descripcion Area,    
Documento,    
Apellido,    
Nombre,    
desde,    
hasta,    
tu.descripcion tipo_ur,    
Cant_UR    
     
from dbo.leg_desglose_ur u    
inner join dbo.LEG_Tabla_Tipo_URetributivas tu    
 on u.Tipo_UR = tu.id    
    
inner join dbo.datos_personales dp    
 on dp.nro_documento = u.documento    
     
inner join dbo.Tabla_URetributivas tur    
 on tur.id_area = u.id_area    
    
inner join dbo.tabla_areas ta    
 on ta.id = u.id_area    
    
where (ltrim(rtrim(Exp_Nro)) = @exp  or @exp is null)
  
order by area, apellido, nombre, desde, hasta
  
  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_MED_Certificado_Licencia]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_MED_Certificado_Licencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[RPT_MED_Certificado_Licencia]    
 @IdAtencion int    
AS    
SELECT DP.Apellido +'', ''+ DP.Nombre Paciente,    
 RTRIM(DI.Descripcion) Tipo_Documento,    
 DP.Nro_Documento  Nro_Documento,    
 Convert(char(10),AM.FechaAtencion,103) FechaAtencion,    
 TADP.Descripcion Area,    
 ISNULL(AM.Observaciones,''-'') Observaciones,    
 ISNULL(convert(char(10),LS.Desde,103),''--/--/----'') Desde,    
 ISNULL(convert(char(10),LS.Hasta,103),''--/--/----'') Hasta,    
 ISNULL(RTRIM(cast(TCL.Nro_Articulo as char))+'' ''+ upper(TCL.Concepto),''---'') Concepto   ,
 ''Dr/a.: '' +UD.Apellido +'', ''+ UD.Nombre Medico
FROM dbo.MED_Atenciones AM    
    
INNER JOIN dbo.Datos_Personales DP    
 ON DP.Nro_Documento = AM.Nro_Documento    
INNER JOIN dbo.Tabla_DocIdentidad DI    
 on DI.Id = DP.Tipo_Documento    
INNER JOIN dbo.VW_Desglose_Area DA    
 ON DA.Documento = DP.Nro_Documento    
    
INNER JOIN dbo.Tabla_Areas TADP    
 on TADP.Id = DA.Id_Area    
    
LEFT JOIN dbo.Licencias_Solicitadas LS    
 ON LS.Id = AM.IdLicencia    
    
LEFT JOIN Tabla_Conceptos_Licencias TCL    
 ON TCL.Id_Concepto = LS.Concepto    

INNER JOIN dbo.RH_Usuarios_Detalles UD
	On UD.Id_Usuario = AM.IdUsuario
    
WHERE AM.Id =  @IdAtencion    
    
    
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CON_LEG_Control_Documentacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CON_LEG_Control_Documentacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CON_LEG_Control_Documentacion]  
 @Id_Interna int = NULL,  
 @Area int =NULL  
AS  
SELECT DP.Id_Interna,  
 dp.Nro_documento,  
 DP.Apellido +'', ''+ DP.Nombre ApellidoyNombre,  
   
 CASE PresentoAptoMedico   
 WHEN 0 THEN ''No Presentado''  
 WHEN 1 THEN ''Provisorio''  
 WHEN 2 THEN ''Definitivo''  
 ELSE ''No Presentado''  
 END AptoMedico,  
  
 CASE WHEN Foto = 1 THEN  
  ''Si''  
 ELSE  
  ''No''  
 END Foto,  
  
 CASE WHEN FotocDNI = 1 THEN  
  ''Si''  
 ELSE  
  ''No''  
 END FotocDNI,   
  
 CASE WHEN Decreto_894 = 1 THEN  
  ''Si''  
 ELSE  
  ''No''  
 END Decreto894,  
  
 CASE WHEN Cuadernillo = 1 THEN  
  ''Si''  
 ELSE  
  ''No''  
 END Cuadernillo,  
  
 CASE WHEN FotocObraSocial = 1 THEN  
  ''Si''  
 ELSE  
  ''No''  
 END FotocObraSocial,  
  
 CASE WHEN AcreditEstadoCivil = 1 THEN  
  ''Si''  
 ELSE  
  ''No''  
 END AcreditacionEstadoCivil,  
  
 CASE Titulo  
 WHEN 0 THEN ''No Presentado''  
 WHEN 1 THEN ''Sin Estudios''  
 WHEN 2 THEN ''Primario''  
 WHEN 3 THEN ''Secundario''  
 WHEN 4 THEN ''Universitario''  
 ELSE ''No Presentado''  
 END Titulo,  
  
 CASE WHEN CertifServAnt = 1 THEN  
  ''Si''  
 ELSE  
  ''No''  
 END CertifServicios,  
  
 CASE WHEN Cv = 1 THEN  
  ''Si''  
 ELSE  
  ''No''  
 END CV,  
  
 CASE WHEN AntecedentesPenales = 1 THEN  
  ''Si''  
 ELSE  
  ''No''  
 END AntecedentesPenales,  
   
 CASE WHEN ActasNacimientoCantidad > 0 THEN  
  ''Si''   
 ELSE  
  CASE WHEN actasNacimientoPresenta = 0 THEN  
   ''No Presentada''  
  ELSE  
   ''Sin Hijos''  
  END  
 END ActasNacimientoPresentada,  
 isnull(ActasNacimientoCantidad,0) ActasNacimientoCantidad,  
 (Select count(DF.Id_interna) - ISNULL(ActasNacimientoCantidad,0) FROM dbo.Datos_Familiares DF WHERE DF.Id_Interna = DP.Id_Interna AND DF.Parentesco = 4) ActasNacimientoFaltantes,  
   
 CASE WHEN FotocDNIHijosCantidad > 0 THEN  
  ''Si''   
 ELSE  
  CASE WHEN FotocDNIHijosPresenta = 0 THEN  
   ''No Presentada''  
  ELSE  
   ''Sin Hijos''  
  END  
 END FotocDniHijosPresentada,  
 ISNULL(FotocDNIHijosCantidad,0) FotocDNIHijosCantidad,  
 (Select count(DF.Id_interna)- ISNULL(FotocDNIHijosCantidad,0) FROM dbo.Datos_Familiares DF WHERE DF.Id_Interna = DP.Id_Interna AND DF.Parentesco = 4) FotocDNIHijosFaltantes,  
  
  
 CASE WHEN ComprobCuit = 1 THEN  
  ''Si''  
 ELSE  
  ''No''  
 END ComprobCuit,  
  
 CASE WHEN OpcionJ = 1 THEN  
  ''Si''  
 ELSE  
  ''No''  
 END OpcionJubilatoria,  
  
 CASE InfoSumaria   
 WHEN 0 THEN ''No Presentada''  
 WHEN 1 THEN ''Presentada''  
 WHEN 2 THEN ''No Corresponde''   
 ELSE ''No Presentada''  
 END InfoSumaria,  
  
 YEAR(DeF.Fecha_Min) Año_Ingreso,  
 CASE WHEN (Select count(Año) from dbo.LEG_DDJJ_Cargos where Nro_Documento = DP.Nro_Documento)IS NULL THEN  
  ''No Presentada''  
 ELSE  
  ''Presento '' + cast((Select count(Año) from dbo.LEG_DDJJ_Cargos where Nro_Documento = DP.Nro_Documento) as char)  
 END DDJJCargos,  
 TA.Descripcion Area  ,
 Observaciones
FROM dbo.Datos_Personales DP  
LEFT JOIN dbo.LEG_documentacion_legajo DL  
 ON DL.Id_Interna = DP.Id_Interna   
INNER JOIN dbo.Designaciones_Fechas DeF  
 ON Def.Id_Interna = DP.Id_interna  
INNER JOIN dbo.VW_Desglose_Area DA  
 ON DA.Documento = DP.Nro_Documento AND  
    (DA.Id_Area =  @Area OR @Area IS NULL)  
INNER JOIN dbo.Tabla_Areas TA  
 ON TA.Id = DA.Id_Area  
WHERE  VisibleLegajos = 1 AND  
 BajaLegajos = 0  AND  
 (DP.Id_Interna = @Id_Interna OR @Id_Interna IS NULL)  
ORDER BY DP.Apellido, DP.Nombre  
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[GEN_GET_Area_Agente]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GEN_GET_Area_Agente]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		<Agustin>
-- Create date: <18/04/2008>
-- Description:	<Trae el area de un agente>
-- =============================================
--[dbo].[EVAL_GET_AREA_AGENTE] 68,''10/10/2008''
CREATE PROCEDURE [dbo].[GEN_GET_Area_Agente]
	@id_interna int,
	@fecha smalldatetime
AS
BEGIN
	SET NOCOUNT ON;
	select top 1 da.id_area, da.desde, ta.descripcion
	from dbo.leg_desglose_area da
	inner join dbo.tabla_areas ta
		on ta.id = da.id_area
	where da.id_interna = @id_interna and da.desde < @fecha
	order by da.desde desc
END

' 
END
GO
/****** Object:  StoredProcedure [dbo].[ESTR_GET_Descripcion_Area]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ESTR_GET_Descripcion_Area]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[ESTR_GET_Descripcion_Area]
	@Area int
AS

SELECT	Descripcion
FROM dbo.Tabla_Areas
WHERE id = @Area


' 
END
GO
/****** Object:  StoredProcedure [dbo].[GETexistensia_datos_familiares]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GETexistensia_datos_familiares]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[GETexistensia_datos_familiares]
	@doc int,
	@id int
AS
select apellido, nombre, parentesco 
from [dbo].datos_familiares
where (id_interna=@id or doc_titular=@doc )
and fecha_baja is null




' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetFamiliaresRPT]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetFamiliaresRPT]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[GetFamiliaresRPT]
	@idInt int
as
select idfam,PARENtesco from datos_familiares
where id_interna = @idint
and parentesco < 5
order by parentesco


' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_DDJJ_Familiares]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_DDJJ_Familiares]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'






CREATE procedure [dbo].[RPT_LEG_DDJJ_Familiares]
	 @Id_Interna 	[int]
AS 
SELECT	 rtrim(Apellido) + '', ''+  rtrim(Nombre) Apellido,
	 P.descripcion Parentesco,
	 DI.descripcion Tipo_Doc,
	 [Fam_Docum_Nrodoc] Nro_Doc,
	 convert(char(10),[ACargoDesde],103) ACargoDesde,
	 convert(char(10),[ACargoHasta],103) ACargoHasta
FROM [dbo].[Datos_Familiares] DF
INNER JOIN dbo.Tabla_DocIdentidad DI
	on DI.id = DF.fam_docum_tipo
INNER JOIN dbo.tabla_parentesco P
	on P.id = DF.parentesco
WHERE	Id_Interna = @id_interna  AND
	acargodesde is not null AND
	df.fecha_baja is null AND
	(acargohasta is null or acargohasta >= Getdate() or acargohasta = ''01/01/1900'')
	
ORDER BY convert(datetime,DF.acargodesde)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_DEL_Familiar]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_DEL_Familiar]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[LEG_DEL_Familiar]
	@id_interna int,
	@id_fam int,
	@Motivo smallint,
	@fecha datetime,
	@usuario smallint

as

update dbo.Datos_Familiares
set motivo_baja = @motivo,
	fecha_baja=@fecha,
	usuario = @usuario 

where id_interna = @id_interna 
and idfam = @id_fam




' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_DDJJ_Familiares]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_DDJJ_Familiares]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[LEG_GET_DDJJ_Familiares]
	 @Id_Interna 	[int],
	 @Doc_Titular 	[int]

AS 

select 	 [Apellido],
	 [Nombre],
	 P.descripcion Parentesco,
	 DI.descripcion Tipo_Doc,
	 [Fam_Docum_Nrodoc] Nro_Doc,
	 [ACargoDesde],
	 [ACargoHasta]

from  [dbo].[Datos_Familiares] DF
inner join dbo.Tabla_DocIdentidad DI
	on DI.id = DF.fam_docum_tipo
inner join dbo.tabla_parentesco P
	on P.id = DF.parentesco

where  (Id_Interna = @id_interna or  Doc_Titular= @doc_titular) and 
	acargodesde is not null AND
	df.fecha_baja is null AND
	(acargohasta is null or acargohasta >= Getdate() or acargohasta = ''01/01/1900'')

' 
END
GO
/****** Object:  View [dbo].[WEB_DatosPersonales_a_WEB]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[WEB_DatosPersonales_a_WEB]'))
EXEC dbo.sp_executesql @statement = N'




CREATE     view [dbo].[WEB_DatosPersonales_a_WEB] 

as

SELECT 	dp.[Id_Interna], 
	[Apellido], 
	[Nombre], 
	[Tipo_Documento], 
	[Nro_Documento], 
	case when (dd.fecha_hasta is null and dd.fecha_desde <= getdate()) then
		dd.Area 
	else
		(select top 1 area from dbo.designaciones where id_interna = dp.id_interna and not fecha_desde is null order by fecha_desde)
	end  Area,
	dd.fecha_desde Area_DEsde,
	(select count(idfam) from datos_familiares where id_interna = dp.id_interna and fecha_baja is null) [Familiares_A_Cargo], 
	case when er.titulo is null or er.titulo ='''' then
		''El Legajo no tiene estudios''
	else
		er.titulo
	end [Estudios], 
	dd.id_Planta ,
        tc.descripcion   [Funcion], 
	0 [Operacion] ,
	lb.fecha_baja

FROM [dbo].[Datos_Personales] DP
INNER JOIN dbo.designaciones DD
	on dd.id_interna = dp.id_interna
INNER JOIN dbo.tabla_cargos TC
	on tc.id = dd.id_Cargo
LEFT JOIN dbo.Estudios_Realizados ER
	on er.id_interna = dp.id_interna
	and er.id_estudio = (Select max(id_estudio) from dbo.Estudios_realizados where id_interna = dp.Id_interna)

left join dbo.legajo_bajas LB
	on lb.id_interna = dp.id_interna
WHERE 	(dd.fecha_hasta is null) and 
	(dp.id_interna not in (select id_interna from legajo_bajas where fecha_baja > getdate()-30))











'
GO
/****** Object:  StoredProcedure [dbo].[Modificar_Datos_Familiares]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Modificar_Datos_Familiares]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[Modificar_Datos_Familiares]
	(@Apellido_32 	[nvarchar](50),
	 @Nombre_33 	[nvarchar](50),
	 @Parentesco_34 	[smallint],
	 @Sexo_35 	[smallint],
	 @Fecha_Nacimiento_36 	[datetime],
	 @Nacionalidad_37 	[smallint],
	 @Fam_Docum_Tipo_38 	[smallint],
	 @Fam_Docum_Nrodoc_39 	[int],
	 @Fam_CI_40 	[int],
	 @Fam_CI_expedido_por_41 	[nvarchar](50),
	 @Fam_otrotipo_42 	[nvarchar](20),
	 @Fam_otrotipo_expedido_por_43 	[nvarchar](50),
	 @Tel1_44 	[varchar](15),
	 @Tel2_45 	[varchar](15),
	 @Tel3_46 	[varchar](15),
	 @Lugar_47 	[nvarchar](50),
	 @Fecha_48 	[datetime],
	 @Fecha_Fallecimiento_49 	[datetime],
	 @Lugar_Fallecimiento_informe_50 	[nvarchar](50),
	 @Fecha_Fallecimiento_informe_51 	[datetime],
	 @Id_Interna_53 	[int],
	 @Doc_Titular_54 	[int],
	 @Escolaridad_55 	[smallint],
	 @ACargoDesde_56 	[datetime],
	 @ACargoHasta_57 	[datetime],
	 @discapacitado_58 	[bit],
	 @adoptado_59 	[bit],
	 @Cert_Nacimiento bit,
	 @Cert_Matrimonio bit,
	 @idFamiliar_60 [int] )

AS UPDATE [dbo].[Datos_Familiares] 

SET  [Apellido]	 = @Apellido_32,
	 [Nombre]	 = @Nombre_33,
	 [Parentesco]	 = @Parentesco_34,
	 [Sexo]	 = @Sexo_35,
	 [Fecha_Nacimiento]	 = @Fecha_Nacimiento_36,
	 [Nacionalidad]	 = @Nacionalidad_37,
	 [Fam_Docum_Tipo]	 = @Fam_Docum_Tipo_38,
	 [Fam_Docum_Nrodoc]	 = @Fam_Docum_Nrodoc_39,
	 [Fam_CI]	 = @Fam_CI_40,
	 [Fam_CI_expedido_por]	 = @Fam_CI_expedido_por_41,
	 [Fam_otrotipo]	 = @Fam_otrotipo_42,
	 [Fam_otrotipo_expedido_por]	 = @Fam_otrotipo_expedido_por_43,
	 [Tel1]	 = @Tel1_44,
	 [Tel2]	 = @Tel2_45,
	 [Tel3]	 = @Tel3_46,
	 [Lugar]	 = @Lugar_47,
	 [Fecha]	 = @Fecha_48,
	 [Fecha_Fallecimiento]	 = @Fecha_Fallecimiento_49,
	 [Lugar_Fallecimiento_informe]	 = @Lugar_Fallecimiento_informe_50,
	 [Fecha_Fallecimiento_informe]	 = @Fecha_Fallecimiento_informe_51,
	 [Id_Interna]	 = @Id_Interna_53,
	 [Doc_Titular]	 = @Doc_Titular_54,
	 [Escolaridad]	 = @Escolaridad_55,
	 [ACargoDesde]	 = @ACargoDesde_56,
	 [ACargoHasta]	 = @ACargoHasta_57,
	 [discapacitado]	 = @discapacitado_58,
	 [adoptado]	 = @adoptado_59,
	Cert_Nacimiento  = @Cert_Nacimiento,
	Cert_Matrimonio =  @Cert_Matrimonio

WHERE 
	([Id_Interna]= @Id_Interna_53 AND [Doc_Titular]= @Doc_Titular_54 AND [idfam]=@idFamiliar_60)

' 
END
GO
/****** Object:  StoredProcedure [dbo].[alta_Datos_Familiares]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[alta_Datos_Familiares]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[alta_Datos_Familiares]
	(@Apellido_1 	[nvarchar](50),
	 @Nombre_2 	[nvarchar](50),
	 @Parentesco_3 	[smallint],
	 @Sexo_4 	[smallint],
	 @Fecha_Nacimiento_5 	[datetime],
	 @Nacionalidad_6 	[smallint],
	 @Fam_Docum_Tipo_7 	[smallint],
	 @Fam_Docum_Nrodoc_8 	[int],
	 @Fam_CI_9 	[int],
	 @Fam_CI_expedido_por_10 	[nvarchar](50),
	 @Fam_otrotipo_11 	[nvarchar](20),
	 @Fam_otrotipo_expedido_por_12 	[nvarchar](50),
	 @Tel1_13 	[varchar](15),
	 @Tel2_14 	[varchar](15),
	 @Tel3_15 	[varchar](15),
	 @Lugar_16 	[nvarchar](50),
	 @Fecha_17 	[datetime],
	 @Fecha_Fallecimiento_18 	[datetime],
	 @Lugar_Fallecimiento_informe_19 	[nvarchar](50),
	 @Fecha_Fallecimiento_informe_20 	[datetime],
	 @Id_Interna_21 	[int],
	 @Doc_Titular_22 	[int],
	 @Escolaridad_23 	[smallint],
	 @ACargoDesde_24 	[datetime],
	 @ACargoHasta_25 	[datetime],
	 @discapacitado_26 	[bit],
	 @adoptado_27 	[bit],	
	 @Cert_Nacimiento bit,
	 @Cert_Matrimonio bit,
	@Usuario smallint=1)

AS 
Declare  @IDfam int
set @IDFam =(select max(idfam)+1 from [dbo].datos_familiares where id_interna = @id_interna_21 and doc_titular=@doc_titular_22)

if @IDfam is null begin
	set @IDfam =1
end



INSERT INTO dbo.Datos_Familiares
	 ( [Apellido],
	 [Nombre],
	 [Parentesco],
	 [Sexo],
	 [Fecha_Nacimiento],
	 [Nacionalidad],
	 [Fam_Docum_Tipo],
	 [Fam_Docum_Nrodoc],
	 [Fam_CI],
	 [Fam_CI_expedido_por],
	 [Fam_otrotipo],
	 [Fam_otrotipo_expedido_por],
	 [Tel1],
	 [Tel2],
	 [Tel3],
	 [Lugar],
	 [Fecha],
	 [Fecha_Fallecimiento],
	 [Lugar_Fallecimiento_informe],
	 [Fecha_Fallecimiento_informe],
	 [Id_Interna],
	 [Doc_Titular],
	 [Escolaridad],
	 [ACargoDesde],
	 [ACargoHasta],
	 [discapacitado],
	 [adoptado],
	 [idfam],
	 Cert_Nacimiento,
  	 Cert_Matrimonio,
	Usuario)
 
VALUES 
	(@Apellido_1,
	 @Nombre_2,
	 @Parentesco_3,
	 @Sexo_4,
	 @Fecha_Nacimiento_5,
	 @Nacionalidad_6,
	 @Fam_Docum_Tipo_7,
	 @Fam_Docum_Nrodoc_8,
	 @Fam_CI_9,
	 @Fam_CI_expedido_por_10,
	 @Fam_otrotipo_11,
	 @Fam_otrotipo_expedido_por_12,
	 @Tel1_13,
	 @Tel2_14,
	 @Tel3_15,
	 @Lugar_16,
	 @Fecha_17,
	 @Fecha_Fallecimiento_18,
	 @Lugar_Fallecimiento_informe_19,
	 @Fecha_Fallecimiento_informe_20,
	 @Id_Interna_21,
	 @Doc_Titular_22,
	 @Escolaridad_23,
	 @ACargoDesde_24,
	 @ACargoHasta_25,
	 @discapacitado_26,
	 @adoptado_27,
	 @IDFam,	 
	 @Cert_Nacimiento,
	 @Cert_Matrimonio ,
	@Usuario)



select @IDFam ID_Fam
' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Datos_Familiares]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Datos_Familiares]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'









CREATE procedure [dbo].[RPT_LEG_Datos_Familiares]
	@Id_interna as int
as
SELECT 	df.idfam,
	df.parentesco IdParentesco,
	TP.Descripcion Parentesco,
	apellido,
	nombre,
	ISNULL(CONVERT(varchar(10),fecha_nacimiento,103),'' '') fecha_nacimiento,
	isnull(TNac.descripcion,'''') Nacionalidad,
	isnull(TDoc.descripcion,'''') Tdoc,
	isnull(df.Fam_Docum_Nrodoc ,'''')NDoc,
	isnull(df.Fam_CI,'''') Celuda,
	isnull(df.Fam_CI_expedido_por,'''') CeludaExpedidapor,
	isnull(df.Fam_otrotipo,'''') OtroDoc,
	isnull(df.Fam_otrotipo_expedido_por,'''') OtroExpedidopor,
	isnull(RTRIM(DomF.Calle) +'' ''+ RTRIM(CONVERT(char,Domf.nro)) +'' ''+ RTRIM(DomF.piso) +'' ''+ RTRIM(DomF.Dpto),'' '')  Domicilio,
	isnull(''(''+ DomF.codigo_postal +'') ''+ RTRIM(DomF.Localidad) +'' ''+ RTRIM(DomF.provincia),'''') Domicilio2, 
	ISNULL(DF.tel1,'' '') TEl1,
	ISNULL(df.tel2,'' '') TEL2,
	ISNULL(df.tel3,'' '') TEL3,
	isnull(DF.Lugar,'''') Lugar,
	ISNULL(CONVERT(varchar(10),DF.Fecha,103),'' '') Fecha,
	ISNULL(CONVERT(varchar(10),DF.Fecha_Fallecimiento,103), '' '') Fecha_Fallecimiento,
	isnull(DF.Lugar_Fallecimiento_informe,'''')Lugar_Fallecimiento_informe,
	ISNULL(CONVERT(varchar(10),DF.Fecha_Fallecimiento_informe,103),'' '') Fecha_Fallecimiento_informe,
	ISNULL(CONVERT(varchar(10),fecha_baja,103),'''') fecha_baja

FROM 	dbo.datos_familiares DF
INNER JOIN dbo.Tabla_Parentesco TP
	on TP.id = DF.Parentesco
INNER JOIN dbo.tabla_nacionalidad TNac
	ON TNac.id = df.nacionalidad
INNER JOIN dbo.Tabla_DocIdentidad TDoc
	ON TDoc.id = DF.Fam_Docum_Tipo
left JOIN dbo.domicilio_familiares DomF
	ON DomF.Id_Interno = df.id_interna AND DomF.ID_FAM = DF.idfam
--MLD: 22-06-06: No se muestran familiares de baja
WHERE 	(df.fecha_baja is null) and -- or df.parentesco <> 3) AND
	(df.parentesco <= 4) AND
	DF.Id_Interna = @Id_Interna
ORDER BY idparentesco  ,fecha_nacimiento, fecha_baja















' 
END
GO
/****** Object:  StoredProcedure [dbo].[Getfamiliares]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Getfamiliares]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[Getfamiliares]
@doc int,
@idinterna int
AS
select tp.descripcion,fam_docum_tipo,fam_docum_nrodoc, apellido,nombre,fecha_nacimiento, idfam ,
tdoc.descripcion Tipo_Documento,
fecha_baja

from [dbo].datos_familiares df 
inner join [dbo].tabla_parentesco tp on tp.id = df.parentesco
left join dbo.Tabla_DocIdentidad TDoc
	on df.fam_docum_tipo = tdoc.id
where doc_titular = @doc or id_interna=@idinterna







' 
END
GO
/****** Object:  View [dbo].[VW_CON_FAM_A_CARGO]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CON_FAM_A_CARGO]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_CON_FAM_A_CARGO]
AS
SELECT DISTINCT Id_Interna
FROM         dbo.Datos_Familiares
WHERE     (GETDATE() BETWEEN ACargoDesde AND ACargoHasta) OR
                      (GETDATE() >= ACargoDesde) AND (ACargoHasta IS NULL)

'
GO
/****** Object:  View [dbo].[VW_Datos_Familiares]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Datos_Familiares]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_Datos_Familiares]
AS
SELECT  *
FROM dbo.Datos_familiares



'
GO
/****** Object:  StoredProcedure [dbo].[GU_GET_DDJJ_Presentadas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GU_GET_DDJJ_Presentadas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[GU_GET_DDJJ_Presentadas]
	@Desde datetime=null,
	@Hasta datetime=null,
	@Id_Interna int=null
as
SELECT  dp.id_interna Id_Interna,
	dp.nro_documento Documento,
	dp.Apellido +'', ''+ dp.nombre Apellido,
	df.apellido +'', ''+ Df.nombre Familiar,
	gu.id_fam,
	convert(varchar(10),gu.Fecha,103) Fecha_DDJJ,
	gu.guarderia

FROM dbo.GU_DDJJ_Guarderia GU
INNER JOIN dbo.Datos_Personales DP
	on dp.id_interna = gu.id_interna
INNER JOIN dbo.Datos_Familiares DF
	on df.id_interna = dp.id_interna
	and df.idfam = gu.id_fam
WHERE	((gu.fecha between @desde and @hasta) Or @Desde is null) and
	((gu.id_interna = @id_interna) or @id_interna is null)
--GROUP BY dp.id_interna,dp.nro_documento,dp.apellido,dp.nombre, gu.fecha, gu.guarderia










' 
END
GO
/****** Object:  StoredProcedure [dbo].[Get_Descripcion_Comprobante_Filtro]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Get_Descripcion_Comprobante_Filtro]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



--Este Store Procedure Devuelve filtrado todas las descripciones

CREATE   procedure [dbo].[Get_Descripcion_Comprobante_Filtro]
AS

Select * 
from dbo.Tabla_Comprobante_Descripcion
where ID<>4 and ID <> 5 and ID<>6






' 
END
GO
/****** Object:  StoredProcedure [dbo].[get_Comprobante_Descripcion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[get_Comprobante_Descripcion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE  PROCEDURE [dbo].[get_Comprobante_Descripcion]  
 @Id int    
    
as    
    
select Descripcion     
from Tabla_Comprobante_Descripcion    
where  @Id=ID


' 
END
GO
/****** Object:  StoredProcedure [dbo].[DOT_GetContratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[DOT_GetContratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 28/09/09
-- Description:	Trate todas las areas, para armar la dotacion.
-- =============================================
CREATE PROCEDURE [dbo].[DOT_GetContratos]
AS
BEGIN
	SET NOCOUNT ON;

	select 
		id_contrato id,
		desde,
		hasta,
		Nro_Documento documento,
		Nro_Contrato numero,
		baja,
		aprobado
	from 
		dbo.ctr_contratos
END

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_todos_los_certificados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_todos_los_certificados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_GET_todos_los_certificados]    
as
SELECT  
 cert.IdCertificado    
      ,cert.IdCalculo    
      ,cert.Nivel    
      ,cert.Grado    
      ,cert.Funcion    
      ,cert.FechaCertificado    
      ,cert.Antiguedad    
      ,cert.TipoCertificado    
      ,cert.Impreso    
      ,cert.IdContrato    
      ,cert.FechaAsignacion    
      ,cert.UsuarioAsignacion    
  FROM dbo.CTR_Antiguedad_Certificados cert    
right join (select max(id_contrato) id_ctro from dbo.CTR_Contratos    
   where baja = 0 group by nro_documento) idarenovar    
 on idarenovar.id_ctro = cert.Idcontrato
where cert.Idcontrato is not null AND cert.IdCalculo IN (SELECT ID_CALCULO FROM dbo.CTR_Antiguedad_Reconocida_Grado) and cert.IdCertificado in (    
SELECT max(cert2.IdCertificado)    
        FROM dbo.CTR_Antiguedad_Certificados cert2    
right join (select max(id_contrato) id_ctro from dbo.CTR_Contratos    
   where baja = 0 group by nro_documento) idarenovar2    
 on idarenovar2.id_ctro = cert2.Idcontrato    
where cert2.Idcontrato is not null 
group by cert2.IdContrato)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Nivel_Grado]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Nivel_Grado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CTR_GET_Nivel_Grado]
	@documento int
as
DECLARE @id_contrato int

select @id_contrato = max(id_contrato)
from ctr_contratos
where desde = (select max(desde)
			from ctr_contratos
			where (desde < ''01/12/2008''
			and aprobado = 1
			and nro_documento = @documento)
--- agregado Fabian para que incluya a las renovaciones 2009 (opcion mas faborable)
		 or 
			(desde < ''03/01/2009''
			and aprobado = 1
			and estado =''R''
			and nro_documento = @documento)
--- agregado hasta aca
)
	and aprobado = 1
	and nro_documento = @documento


select ctr.nivel, ctr.grado, gr.grado descr_grado from ctr_contratos ctr
inner join dbo.Tabla_Grados gr
on gr.id = ctr.grado and gr.baja=0
where id_contrato = @id_contrato
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Primer_Fecha_Nivel_BKP_04072011]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Primer_Fecha_Nivel_BKP_04072011]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Primer_Fecha_Nivel_BKP_04072011]
 @id_contrato int          
as          
    
set nocount on    
    
declare @nro_doc int          
set @nro_doc = (select nro_documento from ctr_contratos where id_contrato = @id_contrato)          
          
create table #tempo          
(          
id int IDENTITY(1,1),        
id_contrato int,          
nro_doc int,          
desde datetime,          
nivel int,          
marca int          
)          
         
insert into #tempo        
select id_contrato, nro_documento, desde, nivel, 0        
from ctr_contratos           
where nro_documento = @nro_doc          
and aprobado = 1          
and nivel = (select nivel from ctr_contratos          
  where id_contrato = @id_contrato)    
order by id_contrato asc         
    
DECLARE @id_cont int          
DECLARE @id_cont_Ant int          
DECLARE @entro int       
DECLARE @rangofechaInicial datetime    
DECLARE @rangofechaFinal datetime    
    
set @entro = 0    
    
WHILE (SELECT count(*) FROM #tempo WHERE marca = 0) > 0          
BEGIN        
        
SET @id_cont = (select id_contrato from #tempo where id = (select max(id) from #tempo where marca = 0))          
SET @id_cont_Ant = (select id_contrato from #tempo where id = (select isnull(max(id)-1,0) from #tempo where marca = 0))          
        
 IF (@id_cont_Ant is not null)          
 BEGIN          
  SET @rangofechaInicial = (SELECT convert(char(10),desde - 5,103) FROM #tempo WHERE id_contrato = @id_cont)    
 SET @rangofechaFinal = (SELECT convert(char(10),desde + 5,103) FROM #tempo WHERE id_contrato = @id_cont)    
    
 IF (SELECT count(*)     
  FROM ctr_contratos_bajas          
  WHERE id_contrato = @id_cont_Ant     
  and convert(char(10),fecha_baja,103) between @rangofechaInicial and @rangofechaFinal) > 0    
 BEGIN    
  IF ((SELECT count(*) FROM #tempo     
   WHERE id_contrato = @id_cont    
    and nivel = (SELECT nivel FROM #tempo     
      WHERE id_contrato = @id_cont_ant))) = 0     
  BEGIN    
   SELECT desde FROM #tempo WHERE id_contrato = @id_cont        
            
   UPDATE #tempo          
   SET marca = 1           
     
   set @entro = 1    
  END    
 END    
 ELSE    
 BEGIN        
  SELECT desde FROM #tempo WHERE id_contrato = @id_cont        
            
  UPDATE #tempo          
  SET marca = 1           
    
  set @entro = 1    
 END      
 END    
 ELSE        
 BEGIN          
 SELECT desde FROM #tempo WHERE id_contrato = @id_cont          
        
 UPDATE #tempo          
 SET marca = 1       
    
 set @entro = 1        
 END          
              
 UPDATE #tempo          
 SET marca = 1           
 WHERE id_contrato = @id_cont          
         
END        
         
    
IF @entro = 0    
BEGIN    
 SELECT desde FROM #tempo WHERE id_contrato = @id_cont          
END    
    
    
    
  ' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Primer_Fecha_Nivel_GER]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Primer_Fecha_Nivel_GER]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'                                                 
CREATE procedure [dbo].[CTR_GET_Primer_Fecha_Nivel_GER]    
 @id_contrato int                    
as        
set nocount on              
    
--Declaracion de variables    
DECLARE @nro_doc int, @inicio_contrato datetime, @fin_contrato datetime,     
 @nivel int, @fecha_baja smalldatetime, @inicio_proximo_contrato smalldatetime;    
    
    
--Seteo inicial de variables:    
-- nivel del cual se quiere saber, cuándo fue otorgado por primera vez a la persona.    
set @nivel = (select nivel from dbo.ctr_contratos where id_contrato = @id_contrato)    
set @nro_doc = (select nro_documento from dbo.ctr_contratos where id_contrato = @id_contrato)    
    
    
--cursor con contratos y bajas    
DECLARE contratos_cursor CURSOR FOR     
     
 SELECT ctr.desde, ctr.hasta, bajas.fecha_baja    
 FROM ctr_contratos ctr    
 LEFT JOIN ctr_contratos_bajas bajas    
  ON ctr.id_contrato = bajas.id_contrato    
 WHERE ctr.nro_documento = @nro_doc and ctr.nivel = @nivel     
  and ctr.id_contrato <= @id_contrato and ctr.aprobado = 1    
 ORDER BY ctr.desde desc;    
    
    
--abrir el cursor    
OPEN contratos_cursor;     
    
--leer del cursor, en las variables    
FETCH NEXT FROM contratos_cursor INTO @inicio_contrato, @fin_contrato, @fecha_baja    
    
--esto para la primera iteracion.    
set @inicio_proximo_contrato = @fin_contrato    
    
--loop sobre el cursor    
WHILE @@FETCH_STATUS = 0    
BEGIN    
 if dbo.fx_son_fechas_cercanas(@inicio_proximo_contrato, @fin_contrato) = 0    
 begin    

  select  @inicio_proximo_contrato as desde    
      
  --cerrar el cursor y salir    
  CLOSE contratos_cursor; DEALLOCATE contratos_cursor;    
  return    
 end    
    
 set @inicio_proximo_contrato = @inicio_contrato    
    
 --leer del cursor, en las variables    
 FETCH NEXT FROM contratos_cursor INTO @inicio_contrato, @fin_contrato, @fecha_baja    
END    
    
--cerrar el cursor    
CLOSE contratos_cursor; DEALLOCATE contratos_cursor;    


IF (@inicio_proximo_contrato is null)
	SET @inicio_proximo_contrato = (Select desde from ctr_contratos where id_contrato = @id_contrato)


select @inicio_proximo_contrato as desde ' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_GET_Dotacion_Completa]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_GET_Dotacion_Completa]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


-- =============================================
-- Author:		Agustin
-- Create date: 24/04/2009
-- Description:	Consulta de dotacion de Area
-- =============================================
CREATE PROCEDURE [dbo].[RH_GET_Dotacion_Completa]
AS
BEGIN
-- Paso 1: Obtengo de todas las personas que corresponda mostrar
-- la fecha de la ultima planta y area
set nocount on   

SELECT 
	dat_pers.id_interna,
	max(desg_ar.desde) AreaDesde,
	max(desg_pl.desde) PlantaDesde,
	max(desg_nivGr.desde) NivelGradoDesde,
	0 Aux_Max_Id_Planta,
	0 Aux_Max_Id_Area,
	0 Aux_Max_Id_NivelGrado
	into #Fechas_De_Desgloses
FROM
	dbo.Datos_Personales dat_pers

INNER JOIN 
	dbo.leg_desglose_area desg_ar
	ON	
		dat_pers.id_interna = desg_ar.id_interna

INNER JOIN
	dbo.leg_desglose_planta desg_pl
	ON
		dat_pers.id_interna = desg_pl.id_interna

LEFT JOIN
	dbo.leg_desglose_nivelgrado desg_nivGr
	ON
		dat_pers.id_interna = desg_nivGr.id_interna

LEFT JOIN 
	dbo.Ctr_Contratos primer_ctr_y_en_tramite
	ON 
		primer_ctr_y_en_tramite.nro_documento = dat_pers.nro_documento and
		primer_ctr_y_en_tramite.aprobado = 0 and
		primer_ctr_y_en_tramite.baja = 0 and
		left(primer_ctr_y_en_tramite.nro_contrato,2) = ''01''

LEFT JOIN
	dbo.Ctr_Contratos ctr_vencidos
	ON
		dat_pers.nro_documento = ctr_vencidos.nro_documento and
		ctr_vencidos.aprobado = 1 and
		ctr_vencidos.baja = 0 and 
		ctr_vencidos.hasta < getdate()
LEFT JOIN
	dbo.Ctr_Contratos ctr_NoAprobados_Con_Anterior_Vencido
	ON
		ctr_NoAprobados_Con_Anterior_Vencido.nro_documento = ctr_vencidos.nro_documento and
		ctr_NoAprobados_Con_Anterior_Vencido.aprobado = 0 and
		ctr_vencidos.baja = 0
WHERE

	desg_ar.desde <= getdate() and
	desg_pl.desde <= getdate() and
--	desg_nivGr.desde <= getdate() and
	primer_ctr_y_en_tramite.id_contrato is null and
	(
		--O NO TIENEN CONTRATO VENCIDO
		ctr_vencidos.id_contrato is null
		--O TIENEN VENCIDO, PERO ALGUN OTRO EN TRAMITE
		or
		(
			NOT ctr_vencidos.id_contrato is null and
			NOT ctr_NoAprobados_Con_Anterior_Vencido.id_contrato is null 
		)
		
	) and
	(
		(dat_pers.bajalegajos = 0 and dat_pers.visiblelegajos = 1) or
		(dat_pers.visiblecontratos = 1 and dat_pers.bajacontratos = 0)
	)
	GROUP BY dat_pers.id_interna
	ORDER BY dat_pers.id_interna


-- Paso 2: Traigo el maximo Id de Area y Planta para los casos
-- en que para una misma fecha hay dos desgloses. 
-- P. Ej: leg_desglose_area tiene dos id distintos para la misma persona
--		en dos fechas diferentes

	SELECT  
		tmp.Id_Interna, 
		max(desgl_pl.id) max_IdPlanta,
		max(desgl_ar.id) max_IdArea,
		max(desgl_nivGr.id) max_IdNivGr
		into #Maximos_Ids_De_Planta_Y_Area
	FROM 
		#Fechas_De_Desgloses tmp
	LEFT JOIN
		dbo.Leg_Desglose_Planta desgl_pl
		ON
			desgl_pl.desde = tmp.plantaDesde and
			desgl_pl.id_interna = tmp.id_interna
	LEFT JOIN 
		dbo.Leg_Desglose_Area desgl_ar
		ON
			desgl_ar.desde = tmp.areaDesde and
			desgl_ar.id_interna = tmp.id_interna
	LEFT JOIN 
		dbo.Leg_Desglose_NivelGrado desgl_nivGr
		ON
			desgl_nivGr.desde = tmp.NivelGradoDesde and
			desgl_nivGr.id_interna = tmp.id_interna
	GROUP By tmp.Id_Interna
	ORDER BY tmp.Id_Interna


-- Paso 3: Actualizo la tabla con los Ids.
	UPDATE Fechas
		Set
		Fechas.Aux_Max_Id_Planta = Ids.max_IdPlanta,
		Fechas.Aux_Max_Id_Area = Ids.max_IdArea,
		Fechas.Aux_Max_Id_NivelGrado = Ids.max_IdNivGr
	FROM 
		#Fechas_De_Desgloses Fechas
	INNER JOIN 
		#Maximos_Ids_De_Planta_Y_Area iDS
	ON
		Fechas.id_interna = Ids.id_interna

-- aca borra de la tabla temporal (#Fechas_De_Desgloses) aquellas personas que son
-- planta 22 (contratada) y no estan AUN en la tabla contratos
delete from #Fechas_De_Desgloses
where #Fechas_De_Desgloses.id_interna in
	(select Fechas_ctrosfuturos.id_interna from #Fechas_De_Desgloses Fechas_ctrosfuturos
		left join dbo.LEG_Desglose_Planta desg_pl_ctrosfuturos
			on 
				desg_pl_ctrosfuturos.Id = Fechas_ctrosfuturos.Aux_Max_Id_Planta
		left join dbo.Datos_Personales datpers_ctrosfuturos
			on 
				datpers_ctrosfuturos.Id_Interna = Fechas_ctrosfuturos.Id_interna
		left join dbo.CTR_contratos ctros_ctrosfuturos
			on 
				ctros_ctrosfuturos.nro_documento = datpers_ctrosfuturos.nro_documento
	where desg_pl_ctrosfuturos.Id_planta=22 and ctros_ctrosfuturos.nro_documento is null)

-- Paso 4: Muestro Todo.
	SELECT 
		dat_pers.nro_documento,
		dat_pers.id_interna, 
		dat_pers.apellido,
		dat_pers.nombre,
		niveles.Nivel,
		grados.Grado,
		t_planta.Descripcion Tipo_Planta,
		designacion.descripcion Tipo_Designacion,
		areas.Descripcion Lugar_de_Trabajo,
		''_''+tae.codigo codigoestructura,
		tae2.Descripcion Dependencia_Subs,
		tae3.Descripcion Dependencia_Secretaria,
		desgl_pl.id_Planta,
		desgl_pl.Desig_Planta Id_Designacion_Planta,
		desgl_ar.id_area,
		desgl_nivgr.id_nivel,
		desgl_nivgr.id_grado

	FROM 
		#Fechas_De_Desgloses tmp
	INNER JOIN
		dbo.Datos_Personales dat_pers
		ON
			dat_pers.id_interna = tmp.id_interna
	INNER JOIN
		dbo.leg_desglose_planta desgl_pl
		ON
			desgl_pl.id = tmp.aux_max_id_planta
	INNER JOIN	
		dbo.tipo_de_planta t_planta
		ON
			desgl_pl.id_planta = t_planta.id
	INNER JOIN
		dbo.tabla_designacion designacion
		ON
			desgl_pl.Desig_planta = designacion.id

	INNER JOIN
		dbo.leg_desglose_area desgl_ar
		ON 
			desgl_ar.id = tmp.aux_max_id_area
	INNER JOIN
		dbo.Tabla_Areas areas
		ON	
			desgl_ar.id_area = areas.id
			
	--ESTE ES LEFT PORQUE PUEDE NO TENER NIVEL Y GRADO (PORQUE TIENE FUNCION Y RANGO - 1184)
	LEFT JOIN
		dbo.leg_desglose_nivelgrado desgl_nivgr
		ON desgl_nivgr.id = tmp.aux_max_id_nivelgrado
	LEFT JOIN 
		dbo.tabla_niveles niveles
		ON	
			desgl_nivgr.id_nivel = niveles.id
	LEFT JOIN
		dbo.tabla_grados grados
		ON
			desgl_nivgr.id_grado = grados.id
			
	--- Agrego FABIAN 16/09/2011
	inner join dbo.Tabla_Areas_Estructura tae
		on tae.Id_area = areas.id and substring(tae.codigo,20,5) <> ''00000''
	inner join dbo.Tabla_Areas_Estructura tae2
		on tae2.codigo = substring(tae.codigo,1,10)+''00000000000000''
	inner join dbo.Tabla_Areas_Estructura tae3
		on tae3.codigo = substring(tae.codigo,1,7)+''00000000000000000''
	--- Fin Agregó FABIAN
			
	drop table #Fechas_De_Desgloses
	drop table #Maximos_Ids_De_Planta_Y_Area

END


' 
END
GO
/****** Object:  StoredProcedure [dbo].[Cruce_Consulta_Dotacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Cruce_Consulta_Dotacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE  procedure [dbo].[Cruce_Consulta_Dotacion] 
AS
BEGIN

--Me fijo si estan las vistas creadas
--Sino estan las creo
	IF EXISTS(SELECT * 
            	  FROM INFORMATION_SCHEMA.TABLES
            	  WHERE TABLE_NAME = ''VW_Dotacion_Completa'' 
                  AND TABLE_TYPE = ''VIEW''
                  AND TABLE_SCHEMA = ''dbo'')
     		  DROP VIEW dbo.VW_Dotacion_Completa
--Creo La vista VW_Dotacion_Completa
declare curs Cursor for


--exec (''create View dbo.VW_Dotacion_Completa
--as 
	SELECT 
		dat_pers.id_interna,
		max(desg_ar.desde) AreaDesde,
		max(desg_pl.desde) PlantaDesde,
		max(desg_nivGr.desde) NivelGradoDesde,
		0 Aux_Max_Id_Planta,
		0 Aux_Max_Id_Area,
		0 Aux_Max_Id_NivelGrado
		--into #Fechas_De_Desgloses
	FROM
		dbo.Datos_Personales dat_pers
	
	INNER JOIN 
		dbo.leg_desglose_area desg_ar
		ON	
			dat_pers.id_interna = desg_ar.id_interna
	
	INNER JOIN
		dbo.leg_desglose_planta desg_pl
		ON
			dat_pers.id_interna = desg_pl.id_interna
	
	INNER JOIN
		dbo.leg_desglose_nivelgrado desg_nivGr
		ON
			dat_pers.id_interna = desg_nivGr.id_interna
	
	LEFT JOIN 
		dbo.Ctr_Contratos primer_ctr_y_en_tramite
		ON 
			primer_ctr_y_en_tramite.nro_documento = dat_pers.nro_documento and
			primer_ctr_y_en_tramite.aprobado = 0 and
			primer_ctr_y_en_tramite.baja = 0 and
			left(primer_ctr_y_en_tramite.nro_contrato,2) = ''01'' 
	
	LEFT JOIN
		dbo.Ctr_Contratos ctr_vencidos
		ON
			dat_pers.nro_documento = ctr_vencidos.nro_documento and
			ctr_vencidos.aprobado = 1 and
			ctr_vencidos.baja = 0 and 
			ctr_vencidos.hasta < getdate()
	LEFT JOIN
		dbo.Ctr_Contratos ctr_NoAprobados_Con_Anterior_Vencido
		ON
			ctr_NoAprobados_Con_Anterior_Vencido.nro_documento = ctr_vencidos.nro_documento and
			ctr_NoAprobados_Con_Anterior_Vencido.aprobado = 0 and
			ctr_vencidos.baja = 0
	WHERE
	
		desg_ar.desde <= getdate() and
		desg_pl.desde <= getdate() and
		desg_nivGr.desde <= getdate() and
		primer_ctr_y_en_tramite.id_contrato is null and
		(
			--O NO TIENEN CONTRATO VENCIDO
			ctr_vencidos.id_contrato is null
			--O TIENEN VENCIDO, PERO ALGUN OTRO EN TRAMITE
			or
			(
				NOT ctr_vencidos.id_contrato is null and
				NOT ctr_NoAprobados_Con_Anterior_Vencido.id_contrato is null 
			)
			
		) and
		(
			(dat_pers.bajalegajos = 0 and dat_pers.visiblelegajos = 1) or
			(dat_pers.visiblecontratos = 1 and dat_pers.bajacontratos = 0)
		)
		GROUP BY dat_pers.id_interna
		ORDER BY dat_pers.id_interna
	
	
	-- Paso 2: Traigo el maximo Id de Area y Planta para los casos
	-- en que para una misma fecha hay dos desgloses. 
	-- P. Ej: leg_desglose_area tiene dos id distintos para la misma persona
	--		en dos fechas diferentes
-- 	
-- 		SELECT  
-- 			tmp.Id_Interna, 
-- 			max(desgl_pl.id) max_IdPlanta,
-- 			max(desgl_ar.id) max_IdArea,
-- 			max(desgl_nivGr.id) max_IdNivGr
-- 			into #Maximos_Ids_De_Planta_Y_Area
-- 		FROM 
-- 			#Fechas_De_Desgloses tmp
-- 		LEFT JOIN
-- 			dbo.Leg_Desglose_Planta desgl_pl
-- 			ON
-- 				desgl_pl.desde = tmp.plantaDesde and
-- 				desgl_pl.id_interna = tmp.id_interna
-- 		LEFT JOIN 
-- 			dbo.Leg_Desglose_Area desgl_ar
-- 			ON
-- 				desgl_ar.desde = tmp.areaDesde and
-- 				desgl_ar.id_interna = tmp.id_interna
-- 		LEFT JOIN 
-- 			dbo.Leg_Desglose_NivelGrado desgl_nivGr
-- 			ON
-- 				desgl_nivGr.desde = tmp.NivelGradoDesde and
-- 				desgl_nivGr.id_interna = tmp.id_interna
-- 		GROUP By tmp.Id_Interna
-- 		ORDER BY tmp.Id_Interna
-- 	
-- 	
-- 	-- Paso 3: Actualizo la tabla con los Ids.
-- 		UPDATE Fechas
-- 			Set
-- 			Fechas.Aux_Max_Id_Planta = Ids.max_IdPlanta,
-- 			Fechas.Aux_Max_Id_Area = Ids.max_IdArea,
-- 			Fechas.Aux_Max_Id_NivelGrado = Ids.max_IdNivGr
-- 		FROM 
-- 			#Fechas_De_Desgloses Fechas
-- 		INNER JOIN 
-- 			#Maximos_Ids_De_Planta_Y_Area iDS
-- 		ON
-- 			Fechas.id_interna = Ids.id_interna
-- 	
-- 	
-- 	-- Paso 4: Muestro Todo.
-- 		SELECT 
-- 			dat_pers.id_interna, 
-- 			dat_pers.nro_documento,
-- 			dat_pers.apellido,
-- 			dat_pers.nombre,
-- 			desgl_pl.id_Planta,
-- 			t_planta.Descripcion Tipo_Planta,
-- 			desgl_pl.Desig_Planta Id_Designacion_Planta,
-- 			designacion.descripcion Tipo_Designacion,
-- 			desgl_ar.id_area,
-- 			areas.Descripcion Area,
-- 			desgl_nivgr.id_nivel,
-- 			niveles.Nivel,
-- 			desgl_nivgr.id_grado,
-- 			grados.Grado
-- 		FROM 
-- 			#Fechas_De_Desgloses tmp
-- 		INNER JOIN
-- 			dbo.Datos_Personales dat_pers
-- 			ON
-- 				dat_pers.id_interna = tmp.id_interna
-- 		INNER JOIN
-- 			dbo.leg_desglose_planta desgl_pl
-- 			ON
-- 				desgl_pl.id = tmp.aux_max_id_planta
-- 		INNER JOIN	
-- 			dbo.tipo_de_planta t_planta
-- 			ON
-- 				desgl_pl.id_planta = t_planta.id
-- 		INNER JOIN
-- 			dbo.tabla_designacion designacion
-- 			ON
-- 				desgl_pl.Desig_planta = designacion.id
-- 	
-- 		INNER JOIN
-- 			dbo.leg_desglose_area desgl_ar
-- 			ON 
-- 				desgl_ar.id = tmp.aux_max_id_area
-- 		INNER JOIN
-- 			dbo.Tabla_Areas areas
-- 			ON	
-- 				desgl_ar.id_area = areas.id
-- 				
-- 		--ESTE ES LEFT PORQUE PUEDE NO TENER NIVEL Y GRADO (PORQUE TIENE FUNCION Y RANGO - 1184)
-- 		LEFT JOIN
-- 			dbo.leg_desglose_nivelgrado desgl_nivgr
-- 			ON desgl_nivgr.id = tmp.aux_max_id_nivelgrado
-- 		LEFT JOIN 
-- 			dbo.tabla_niveles niveles
-- 			ON	
-- 				desgl_nivgr.id_nivel = niveles.id
-- 		LEFT JOIN
-- 			dbo.tabla_grados grados
-- 			ON
-- 				desgl_nivgr.id_grado = grados.id
-- 				
-- 		drop table #Fechas_De_Desgloses
-- 		drop table #Maximos_Ids_De_Planta_Y_Area	
--termine de Crear la vista VW_Dotacion_Completa 	
--'')


END

' 
END
GO
/****** Object:  StoredProcedure [dbo].[GET_Dotacion_Gestion_Publica]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GET_Dotacion_Gestion_Publica]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		Lucas
-- ALTER  date: 07/09/2009
-- Description:	Consulta de dotacion de Area Para Gestión Publica
-- =============================================
--exec dbo.GET_Dotacion_Gestion_Publica
CREATE       procedure [dbo].[GET_Dotacion_Gestion_Publica]


AS

-- Paso 1: Obtengo de todas las personas que corresponda mostrar
-- la fecha de la ultima planta y area


SELECT 
	dat_pers.id_interna,
	max(desg_ar.desde) AreaDesde,
	max(desg_pl.desde) PlantaDesde,
	isnull(max(desg_nivGr.desde),'''') NivelGradoDesde,
	0 Aux_Max_Id_Planta,
	0 Aux_Max_Id_Area,
	0 Aux_Max_Id_NivelGrado,
	0 Tipo_Contrato
	into #Fechas_De_Desgloses
FROM
	dbo.Datos_Personales dat_pers

LEFT JOIN --inner
	dbo.leg_desglose_area desg_ar
	ON	
		dat_pers.id_interna = desg_ar.id_interna

LEFT JOIN --inner
	dbo.leg_desglose_planta desg_pl
	ON
		dat_pers.id_interna = desg_pl.id_interna

LEFT JOIN --inner
	dbo.leg_desglose_nivelgrado desg_nivGr
	ON	
		dat_pers.id_interna = desg_nivGr.id_interna
		AND desg_nivGr.desde <= getdate()

LEFT JOIN 
	dbo.Ctr_Contratos primer_ctr_y_en_tramite
	ON 
		primer_ctr_y_en_tramite.nro_documento = dat_pers.nro_documento and
		primer_ctr_y_en_tramite.aprobado = 0 and
		primer_ctr_y_en_tramite.baja = 0 and
		left(primer_ctr_y_en_tramite.nro_contrato,2) = ''01''

LEFT JOIN
	dbo.Ctr_Contratos ctr_vencidos
	ON
		dat_pers.nro_documento = ctr_vencidos.nro_documento and
		ctr_vencidos.aprobado = 1 and
		ctr_vencidos.baja = 0 and 
		ctr_vencidos.hasta < getdate()
LEFT JOIN
	dbo.Ctr_Contratos ctr_NoAprobados_Con_Anterior_Vencido
	ON
		ctr_NoAprobados_Con_Anterior_Vencido.nro_documento = ctr_vencidos.nro_documento and
		ctr_NoAprobados_Con_Anterior_Vencido.aprobado = 0 and
		ctr_vencidos.baja = 0
WHERE

	desg_ar.desde <= getdate() and
	desg_pl.desde <= getdate() and
	--desg_nivGr.desde <= getdate() and
	primer_ctr_y_en_tramite.id_contrato is null and
	 (
		--O NO TIENEN CONTRATO VENCIDO
		ctr_vencidos.id_contrato is null
		--O TIENEN VENCIDO, PERO ALGUN OTRO EN TRAMITE
		or
		(
			NOT ctr_vencidos.id_contrato is null and
			NOT ctr_NoAprobados_Con_Anterior_Vencido.id_contrato is null 
		)
		
	) and
	(
		(dat_pers.bajalegajos = 0 and dat_pers.visiblelegajos = 1) or
		(dat_pers.visiblecontratos = 1 and dat_pers.bajacontratos = 0)
	)
	GROUP BY dat_pers.id_interna
	ORDER BY dat_pers.id_interna

------*************


------************

-- Paso 2: Traigo el maximo Id de Area y Planta para los casos
-- en que para una misma fecha hay dos desgloses. 
-- P. Ej: leg_desglose_area tiene dos id distintos para la misma persona
--		en dos fechas diferentes

	SELECT  
		tmp.Id_Interna, 
		max(desgl_pl.id) max_IdPlanta,
		max(desgl_ar.id) max_IdArea,
		max(desgl_nivGr.id) max_IdNivGr
		into #Maximos_Ids_De_Planta_Y_Area
	FROM 
		#Fechas_De_Desgloses tmp
	LEFT JOIN
		dbo.Leg_Desglose_Planta desgl_pl
		ON
			desgl_pl.desde = tmp.plantaDesde and
			desgl_pl.id_interna = tmp.id_interna
	LEFT JOIN 
		dbo.Leg_Desglose_Area desgl_ar
		ON
			desgl_ar.desde = tmp.areaDesde and
			desgl_ar.id_interna = tmp.id_interna
	LEFT JOIN 
		dbo.Leg_Desglose_NivelGrado desgl_nivGr
		ON
			desgl_nivGr.desde = tmp.NivelGradoDesde and
			desgl_nivGr.id_interna = tmp.id_interna
	GROUP By tmp.Id_Interna
	ORDER BY tmp.Id_Interna

-- Paso 3: Actualizo la tabla con los Ids.
	UPDATE Fechas
		Set
		Fechas.Aux_Max_Id_Planta = Ids.max_IdPlanta,
		Fechas.Aux_Max_Id_Area = Ids.max_IdArea,
		Fechas.Aux_Max_Id_NivelGrado = Ids.max_IdNivGr
	FROM 
		#Fechas_De_Desgloses Fechas
	inner join --por inner 
		#Maximos_Ids_De_Planta_Y_Area iDS
	ON
		Fechas.id_interna = Ids.id_interna


	--GER
	SELECT top 1 d.id_interna, c.tipo_contrato 
	
	INTO #tempo_tipo_contrato
		
	FROM ctr_contratos c
	
	INNER JOIN datos_personales d
		ON d.nro_documento = c.nro_documento
	
	INNER JOIN #Fechas_De_Desgloses f
		ON d.id_interna = f.id_interna
	
	WHERE c.aprobado = 1
		and c.baja = 0
	
	order by c.desde desc
	--GER


 	UPDATE F
 	SET Tipo_Contrato = (SELECT Tipo_Contrato 
	 		     FROM #tempo_tipo_contrato t
			     where  t.id_interna = f.id_interna)
 	FROM #FECHAS_DE_DESGLOSES F	




-- 	UPDATE f
-- 	set tipo_contrato = (select top 1 tipo_contrato 
-- 			from ctr_contratos c, datos_personales d
-- 			where d.nro_documento = c.nro_documento
-- 			and d.id_interna = f.id_interna
-- 			and c.aprobado = 1
-- 			and c.baja = 0
-- 			order by c.desde desc)
-- 	from #Fechas_De_Desgloses f			


-- Paso 4: Muestro Todo.
	SELECT 
	
		dat_pers.id_interna,
		dat_pers.Tipo_Documento as Tipo_Documento,
		--tipoDocumento.Descripcion as Tipo_Documento,
		dat_pers.nro_documento,
		dat_pers.Cuil_Nro,
		dat_pers.apellido,
		dat_pers.nombre,
		dat_pers.Sexo as Sexo,
		--sexo.Descripcion as Sexo,
		dat_pers.Estado_Civil as Estado_Civil,
		--estadoCivil.Descripcion as Estado_Civil,
		dat_pers.Fecha_Nacimiento,
		dat_pers.Lugar_Nacimiento,
		dat_pers.Nacionalidad as Nacionalidad,
		--nacionalidad.Descripcion as Nacionalidad,
		domicilio.ID_Domicilio as ID_Domicilio,
		domicilio.Fecha_Comunicacion as Fecha_Comunicacion,
		domicilio.Calle as Calle,
 		domicilio.Número as Numero,
 		domicilio.Dpto as Dpto,
 		domicilio.piso as Piso,
 		domicilio.Localidad as ID_Localidad,
 		domicilio.Provincia as ID_Provincia,
 --+ '' ''+ 
--			cast (domicilio.Número as varchar(8))+'' ''+
--			isNULL (domicilio.piso  + 
--			domicilio.Dpto,null) + '' Localidad: '' +	
--			localidad.nombrelocalidad +'' ''+'' Partido: ''+ partido.Descripcion+
--				case when provincia.idProvincia =0 then
--					'' '' 
--				else 
--					'' Prov. '' + provincia.nombreProvincia
--				end 
--		Domicilio,
		--domicilio.Calle + '' '' + cast (domicilio.Número as varchar(8)) as Domicilio,
		desgl_pl.id_Planta,
		--t_planta.Descripcion Tipo_Planta,
		desgl_pl.Desig_Planta Id_Designacion_Planta,
		--designacion.descripcion Tipo_Designacion,
		desgl_ar.id_area,
		--areas.Descripcion Area,
		desgl_nivgr.id_nivel,
		--niveles.Nivel,
		desgl_nivgr.id_grado,
		--grados.Grado
		tmp.tipo_contrato
	FROM 
		#Fechas_De_Desgloses tmp 
--Agregado que esten en datos personales que no esten en tmp 
--y que tenga determinadas condiciones


--descomentar sino funciona
	--INNER JOIN
	INNER join 
		dbo.Datos_Personales dat_pers
		ON
			dat_pers.id_interna = tmp.id_interna
		--or dat_pers.id_interna not in (select tmp.id_interna from tmp ) 
 	inner join 
 		dbo.Domicilio_Personal	domicilio
 		on		
 			domicilio.Nro_Doc=dat_pers.nro_documento --dp2.Nro_Doc
			and domicilio.Fecha_Comunicacion = (select max(dp2.Fecha_Comunicacion) from Domicilio_Personal dp2 where dp2.Nro_Doc = domicilio.nro_doc and dp2.DatoDeBaja<>1  group by dp2.Nro_Doc  )
			and domicilio.ID_Domicilio = (select max(dp2.Id_Domicilio) from Domicilio_Personal dp2 where dp2.Nro_Doc = domicilio.nro_doc and dp2.DatoDeBaja<>1  group by dp2.Nro_Doc  )
--	INNER join 
--		dbo.Tabla_DocIdentidad tipoDocumento
--		on
--			tipoDocumento.Id=dat_pers.Tipo_Documento
--	inner join
--		dbo.Tabla_Estado_Civil estadoCivil 
--		on 
--			estadoCivil.Id=dat_pers.Estado_Civil
----	INNER join 
----		dbo.Tabla_Nacionalidad nacionalidad
----		ON		
----			nacionalidad.Id = dat_pers.Nacionalidad
--	INNER join 
--		dbo.Tabla_Sexo  sexo
--		on
--			sexo.Id = dat_pers.Sexo
	
			

	INNER JOIN
		dbo.leg_desglose_planta desgl_pl
		ON
			desgl_pl.id = tmp.aux_max_id_planta
--	INNER JOIN	
--		dbo.tipo_de_planta t_planta
--		ON
--			desgl_pl.id_planta = t_planta.id
--	INNER JOIN
--		dbo.tabla_designacion designacion
--		ON
--			desgl_pl.Desig_planta = designacion.id

	INNER JOIN
		dbo.leg_desglose_area desgl_ar
		ON 
			desgl_ar.id = tmp.aux_max_id_area
--	INNER JOIN
--		dbo.Tabla_Areas areas
--		ON	
--			desgl_ar.id_area = areas.id
--	INNER join 
--		dbo.LocalidadesAfip localidad
--		on 
--			localidad.idLocalidad=domicilio.Localidad
-- 	inner join 
-- 		dbo.Provincias provincia	
-- 		on 
-- 			provincia.codAFIP=domicilio.Provincia
--	inner join
--		dbo.Partidos partido 
--		on
--			partido.Partido=localidad.ID_Partido	
--		
	--ESTE ES LEFT PORQUE PUEDE NO TENER NIVEL Y GRADO (PORQUE TIENE FUNCION Y RANGO - 1184)
 	--LEFT JOIN
	 left join 
 		dbo.leg_desglose_nivelgrado desgl_nivgr
 		ON desgl_nivgr.id = tmp.aux_max_id_nivelgrado

--	LEFT JOIN 
--		dbo.tabla_niveles niveles
--		ON	
--			desgl_nivgr.id_nivel = niveles.id
--	LEFT JOIN
--		dbo.tabla_grados grados
--		ON
--			desgl_nivgr.id_grado = grados.id
	
-- 	group by dat_pers.nro_documento,domicilio.ID_Domicilio
-- 	order by domicilio.ID_Domicilio   desc
	--select * from #Fechas_De_Desgloses
	drop table #Fechas_De_Desgloses
	drop table #Maximos_Ids_De_Planta_Y_Area









' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_GET_Dotacion_Completa_Parametro]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_GET_Dotacion_Completa_Parametro]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================  
-- Author:  Agustin  
-- ALTER  date: 24/04/2009  
-- Description: Consulta de dotacion de Area  
-- =============================================  
CREATE PROCEDURE [dbo].[RH_GET_Dotacion_Completa_Parametro]  
 @Borrar_Tabla_Temporal smallint=null  
AS  
--declare   
--exec [dbo].[RH_GET_Dotacion_Completa_Parametro] 1  
  
BEGIN  
-- Paso 1: Obtengo de todas las personas que corresponda mostrar  
-- la fecha de la ultima planta y area  
set nocount on     
--(@Borrar_Tabla_Temporal==1)  and  
  
  
SELECT   
 dat_pers.id_interna,  
 max(isnull(desg_ar.desde, ''01/01/1900'')) AreaDesde,  
 max(isnull(desg_pl.desde, ''01/01/1900'')) PlantaDesde,  
 max(isnull(desg_nivGr.desde, ''01/01/1900'')) NivelGradoDesde,  
 0 Aux_Max_Id_Planta,  
 0 Aux_Max_Id_Area,  
 0 Aux_Max_Id_NivelGrado  
 into #Fechas_De_Desgloses  
FROM  
 dbo.Datos_Personales dat_pers  
  
INNER JOIN   
 dbo.leg_desglose_area desg_ar  
 ON   
  dat_pers.id_interna = desg_ar.id_interna  
  
INNER JOIN  
 dbo.leg_desglose_planta desg_pl  
 ON  
  dat_pers.id_interna = desg_pl.id_interna  
  
LEFT JOIN  
 dbo.leg_desglose_nivelgrado desg_nivGr  
 ON  
  dat_pers.id_interna = desg_nivGr.id_interna  
  
LEFT JOIN   
 dbo.Ctr_Contratos primer_ctr_y_en_tramite  
 ON   
  primer_ctr_y_en_tramite.nro_documento = dat_pers.nro_documento and  
  primer_ctr_y_en_tramite.aprobado = 0 and  
  primer_ctr_y_en_tramite.baja = 0 and  
  left(primer_ctr_y_en_tramite.nro_contrato,2) = ''01''  
  
LEFT JOIN  
 dbo.Ctr_Contratos ctr_vencidos  
 ON  
  dat_pers.nro_documento = ctr_vencidos.nro_documento and  
  ctr_vencidos.aprobado = 1 and  
  ctr_vencidos.baja = 0 and   
  ctr_vencidos.hasta < getdate()  
LEFT JOIN  
 dbo.Ctr_Contratos ctr_NoAprobados_Con_Anterior_Vencido  
 ON  
  ctr_NoAprobados_Con_Anterior_Vencido.nro_documento = ctr_vencidos.nro_documento and  
  ctr_NoAprobados_Con_Anterior_Vencido.aprobado = 0 and  
  ctr_vencidos.baja = 0  
WHERE  
  
 desg_ar.desde <= getdate() and  
 desg_pl.desde <= getdate() and  
-- desg_nivGr.desde <= getdate() and  
 primer_ctr_y_en_tramite.id_contrato is null and  
 (  
  --O NO TIENEN CONTRATO VENCIDO  
  ctr_vencidos.id_contrato is null  
  --O TIENEN VENCIDO, PERO ALGUN OTRO EN TRAMITE  
  or  
  (  
   NOT ctr_vencidos.id_contrato is null and  
   NOT ctr_NoAprobados_Con_Anterior_Vencido.id_contrato is null   
  )  
    
 ) and  
 (  
  (dat_pers.bajalegajos = 0 and dat_pers.visiblelegajos = 1) or  
  (dat_pers.visiblecontratos = 1 and dat_pers.bajacontratos = 0)  
 )  
 GROUP BY dat_pers.id_interna  
 ORDER BY dat_pers.id_interna  
  

-- Paso 2: Traigo el maximo Id de Area y Planta para los casos  
-- en que para una misma fecha hay dos desgloses.   
-- P. Ej: leg_desglose_area tiene dos id distintos para la misma persona  
--  en dos fechas diferentes  
  
 SELECT    
  tmp.Id_Interna,   
  max(isnull(desgl_pl.id, -1)) max_IdPlanta,  
  max(isnull(desgl_ar.id, -1)) max_IdArea,  
  max(isnull(desgl_nivGr.id, -1)) max_IdNivGr  
  into #Maximos_Ids_De_Planta_Y_Area  
 FROM   
  #Fechas_De_Desgloses tmp  
 LEFT JOIN  
  dbo.Leg_Desglose_Planta desgl_pl  
  ON  
   desgl_pl.desde = tmp.plantaDesde and  
   desgl_pl.id_interna = tmp.id_interna  
 LEFT JOIN   
  dbo.Leg_Desglose_Area desgl_ar  
  ON  
   desgl_ar.desde = tmp.areaDesde and  
   desgl_ar.id_interna = tmp.id_interna  
 LEFT JOIN   
  dbo.Leg_Desglose_NivelGrado desgl_nivGr  
  ON  
   desgl_nivGr.desde = tmp.NivelGradoDesde and  
   desgl_nivGr.id_interna = tmp.id_interna  
 GROUP By tmp.Id_Interna  
 ORDER BY tmp.Id_Interna  
  
  
-- Paso 3: Actualizo la tabla con los Ids.  
 UPDATE Fechas  
  Set  
  Fechas.Aux_Max_Id_Planta = Ids.max_IdPlanta,  
  Fechas.Aux_Max_Id_Area = Ids.max_IdArea,  
  Fechas.Aux_Max_Id_NivelGrado = Ids.max_IdNivGr  
 FROM   
  #Fechas_De_Desgloses Fechas  
 INNER JOIN   
  #Maximos_Ids_De_Planta_Y_Area iDS  
 ON  
  Fechas.id_interna = Ids.id_interna  
  


-- aca borra de la tabla temporal (#Fechas_De_Desgloses) aquellas personas que son  
-- planta 22 (contratada) y no estan AUN en la tabla contratos  
delete from #Fechas_De_Desgloses  
where #Fechas_De_Desgloses.id_interna in  
 (select Fechas_ctrosfuturos.id_interna from #Fechas_De_Desgloses Fechas_ctrosfuturos  
  left join dbo.LEG_Desglose_Planta desg_pl_ctrosfuturos  
   on   
    desg_pl_ctrosfuturos.Id = Fechas_ctrosfuturos.Aux_Max_Id_Planta  
  left join dbo.Datos_Personales datpers_ctrosfuturos  
   on   
    datpers_ctrosfuturos.Id_Interna = Fechas_ctrosfuturos.Id_interna  
  left join dbo.CTR_contratos ctros_ctrosfuturos  
   on   
    ctros_ctrosfuturos.nro_documento = datpers_ctrosfuturos.nro_documento  
 where desg_pl_ctrosfuturos.Id_planta=22 and ctros_ctrosfuturos.nro_documento is null)  
  
-- aca empieza a manejar el tema del parametro para borrar o dejar la tabla temporal  
IF  (@Borrar_Tabla_Temporal=1)   and (EXISTS (SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE=''BASE TABLE'' AND TABLE_NAME=''Tabla_Temporal_Dotacion_Completa''))  
begin            
 DELETE FROM [DB_RRHH].[dbo].[Tabla_Temporal_Dotacion_Completa]  
 --WHERE HOST_ID()= dbo.Tabla_Temporal_Dotacion_Completa.hostId   
   
 -- ''Borra la Tabla_Temporal_Dotacion_Completa''  
 INSERT INTO [DB_RRHH].[dbo].[Tabla_Temporal_Dotacion_Completa]([id_interna], [nro_documento], [id_Planta], [Id_Designacion_Planta], [id_area], [id_nivel], [id_grado], [Id_Contrato], [hostId])  
 SELECT   
    dat_pers.id_interna,   
    dat_pers.nro_documento,  
    desgl_pl.id_Planta,  
    desgl_pl.Desig_Planta Id_Designacion_Planta,  
    desgl_ar.id_area,  
    desgl_nivgr.id_nivel,  
    desgl_nivgr.id_grado,  
    null,  
    0    
 FROM   
  #Fechas_De_Desgloses tmp  
 INNER JOIN  
  dbo.Datos_Personales dat_pers  
  ON  
   dat_pers.id_interna = tmp.id_interna  
 INNER JOIN  
  dbo.leg_desglose_planta desgl_pl  
  ON  
   desgl_pl.id = tmp.aux_max_id_planta  
 INNER JOIN   
  dbo.tipo_de_planta t_planta  
  ON  
   desgl_pl.id_planta = t_planta.id  
 INNER JOIN  
  dbo.tabla_designacion designacion  
  ON  
   desgl_pl.Desig_planta = designacion.id  
  
 INNER JOIN  
  dbo.leg_desglose_area desgl_ar  
  ON   
   desgl_ar.id = tmp.aux_max_id_area  
 INNER JOIN  
  dbo.Tabla_Areas areas  
  ON   
   desgl_ar.id_area = areas.id  
     
 --ESTE ES LEFT PORQUE PUEDE NO TENER NIVEL Y GRADO (PORQUE TIENE FUNCION Y RANGO - 1184)  
 LEFT JOIN  
  dbo.leg_desglose_nivelgrado desgl_nivgr  
  ON desgl_nivgr.id = tmp.aux_max_id_nivelgrado  
 LEFT JOIN   
  dbo.tabla_niveles niveles  
  ON   
   desgl_nivgr.id_nivel = niveles.id  
 LEFT JOIN  
  dbo.tabla_grados grados  
  ON  
   desgl_nivgr.id_grado = grados.id  
  
 --Hago Update con los contratos activos en la tabla_temporal  
 UPDATE dota  
 SET    dota.Id_Contrato=C.Id_Contrato  
 from dbo.CTR_Contratos C    
 INNER join Tabla_Temporal_Dotacion_Completa dota  
 on dota.nro_documento=C.Nro_Documento  
 WHERE     
  C.baja= 0 and C.Aprobado=1  
   
  
  
    
end           
  
-- ELSE  
--   
-- begin  
--    
--   SELECT   
--    dat_pers.id_interna,   
--    dat_pers.nro_documento,  
--    dat_pers.apellido,  
--    dat_pers.nombre,  
--    desgl_pl.id_Planta,  
--    t_planta.Descripcion Tipo_Planta,  
--    desgl_pl.Desig_Planta Id_Designacion_Planta,  
--    designacion.descripcion Tipo_Designacion,  
--    desgl_ar.id_area,  
--    areas.Descripcion Area,  
--    desgl_nivgr.id_nivel,  
--    niveles.Nivel,  
--    desgl_nivgr.id_grado,  
--    grados.Grado  
--   FROM   
--    #Fechas_De_Desgloses tmp  
--   INNER JOIN  
--    dbo.Datos_Personales dat_pers  
--    ON  
--     dat_pers.id_interna = tmp.id_interna  
--   INNER JOIN  
--    dbo.leg_desglose_planta desgl_pl  
--    ON  
--     desgl_pl.id = tmp.aux_max_id_planta  
--   INNER JOIN   
--    dbo.tipo_de_planta t_planta  
--    ON  
--     desgl_pl.id_planta = t_planta.id  
--   INNER JOIN  
--    dbo.tabla_designacion designacion  
--    ON  
--     desgl_pl.Desig_planta = designacion.id  
--    
--   INNER JOIN  
--    dbo.leg_desglose_area desgl_ar  
--    ON   
--     desgl_ar.id = tmp.aux_max_id_area  
--   INNER JOIN  
--    dbo.Tabla_Areas areas  
--    ON   
--     desgl_ar.id_area = areas.id  
--       
--   --ESTE ES LEFT PORQUE PUEDE NO TENER NIVEL Y GRADO (PORQUE TIENE FUNCION Y RANGO - 1184)  
--   LEFT JOIN  
--    dbo.leg_desglose_nivelgrado desgl_nivgr  
--    ON desgl_nivgr.id = tmp.aux_max_id_nivelgrado  
--   LEFT JOIN   
--    dbo.tabla_niveles niveles  
--    ON   
--     desgl_nivgr.id_nivel = niveles.id  
--   LEFT JOIN  
--    dbo.tabla_grados grados  
--    ON  
--     desgl_nivgr.id_grado = grados.id  
--   
--     
-- end  
    
   
 drop table #Fechas_De_Desgloses  
 drop table #Maximos_Ids_De_Planta_Y_Area  
  
END  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_ADD_Contrato_Certificado_Automatico_PASO3]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ADD_Contrato_Certificado_Automatico_PASO3]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE  Procedure [dbo].[CTR_ADD_Contrato_Certificado_Automatico_PASO3]                  
                  
 (@Id_Domicilio_2  [int]=NULL,                        
  @Nro_Documento_3  [int]=NULL,                        
  @Tipo_Contrato_4  [smallint]=NULL,                        
  @Nro_Contrato_5  [char](11)=NULL,                        
  @Desde_6  [smalldatetime]=NULL,                        
  @Hasta_7  [smalldatetime]=NULL,                        
  @Nivel_8  [smallint]=NULL,                        
  @Grado_9  [smallint]=NULL,                        
  @Funcion_10  [smallint]=NULL,                        
  @Rango_11  [smallint]=NULL,                        
  @Monto_12  [money]=NULL,                        
  @Id_Area_13  [int]=NULL,                        
  @Contrato_Firmante_24  [smallint]=NULL,                        
  @Excepcion_26  [bit]=NULL,                        
  @Enmienda_27  [bit]=NULL,                        
  @Observacion_31  [varchar](200)=NULL,                        
  @Estado_32  [char](1)=NULL,                        
  @Conserva_Area bit=NULL,                        
  @Usuario smallint=NULL,                        
  @Salvado bit=0,              
  @Nro_Contrato_Ant [char](11)=NULL,    
  @Meses_Calculo_Antiguedad int,
  @hostId varchar(10)
)                        
         
AS  
set nocount on     
             
  
-- LMY            
DELETE from dbo.CTR_Tempo_Renovacion         
  
DECLARE @fecha smalldatetime,              
@nivel_letra char(1),              
--@grado_letra char(1),              
@grado_ant varchar(5)  
set @fecha =  getdate()                
              
              
--OBTENGO EL NIVEL DEL CONTRATO ANTERIOR                  
select @nivel_letra = nivel from dbo.tabla_niveles where id = @Nivel_8 and baja = 0  
  
--OBTENGO EL GRADO DEL CONTRATO ANTERIOR                  
Select @grado_ant = grado from tabla_grados where Id = @Grado_9 and baja = 0  
  
  
--OBTENGO EL ID_CONTRATO CON EL CONTRATO ANTERIOR                  
declare @IdContrato int                 
select @IdContrato = id_contrato from dbo.ctr_contratos                 
where nro_contrato= @Nro_Contrato_ant and nro_documento = @Nro_Documento_3                
                
--OBTENGO FECHA DE CORTE (DESDE -1)                
declare @FechaCorte smalldatetime                
SET @FechaCorte = @Desde_6 - 1                
                
              
--OBTENGO EL MAXIMO IDCALCULO                
Declare @idcalculo int                
select @idcalculo = max(idcalculo) + 1 from dbo.CTR_Antiguedad_Certificados                
                
--OBTENGO LA FUNCION                 
--Comentado por FABIAN (16_11_2009) traia la funcion desde la tabla, pero la tiene que traer desde el certificado asignado al contrato que se esta renovando  
--Declare @funcion varchar(200)                
--SELECT @funcion = Descripcion                  
--FROM dbo.Tabla_Cargos TFC                  
--INNER JOIN dbo.Tabla_Relacion_Funcion_Nivel RFN                  
-- on RFN.IdFuncion = TFC.Id                  
--WHERE Baja =0 AND                   
-- RFN.IdNIvel = @Nivel_8                  
  
--Declare @funcion varchar(200)  
--SELECT @funcion = funcion  
--FROM (select top 1 funcion   
--  from dbo.CTR_Antiguedad_Certificados   
--  where idcontrato = @IdContrato  
--  order by idcertificado desc  
--  )  
  
Declare @funcion varchar(200)  
SET @funcion = (SELECT top 1 funcion   
  from dbo.CTR_Antiguedad_Certificados   
  where idcontrato = @IdContrato  
  order by idcertificado desc  
  )  
  
        
--OBTENGO EL CERTIFICADO                
Declare @tipo_certificado int                
select @tipo_certificado = TipoCertificado                 
from dbo.CTR_Antiguedad_Certificados                
where IdContrato = @IdContrato                
                
--OBTENGO EL GRADO             
--set @grado = dbo.Fx_CTR_Grado_Segun_AntFuncion (@Nivel_8, @meses)                 
--set @grado = CONVERT(varchar(5),@grado)     
  
Declare @Grado varchar(5),  
  @Fecha_Desde_Nivel datetime  
  
create table #Tempo_Fecha  
(fecha datetime)  
  
insert into #Tempo_Fecha   
exec dbo.CTR_GET_Primer_Fecha_Nivel @IdContrato  
  
IF (SELECT count(*) from #Tempo_Fecha) = 0  
BEGIN                
 raiserror 50000 ''La fecha nivel calculada es null''  
 RETURN        
END                   
  
select @Fecha_Desde_Nivel = fecha from #Tempo_Fecha  
  
  
--''01/12/2008'' --> Fecha en la cual rige el SINEP    
-- si @fecha >= 01/12/2008 -> grado = intero (@meses / 36)    
  
IF (@Fecha_Desde_Nivel >= ''01/12/2008'')     
BEGIN    
  
 set @grado = convert(int,(@Meses_Calculo_Antiguedad / 36))  
END    
    
-- si @fecha < 01/12/2008    
-- conocer el nivel y grado del contrato que estoy renovando    
-- @meses_usados = obtener los meses de (dbo.Tabla_Meses_Grados_Funciones)    
-- grado = intero ((@meses - @meses_usados) / 36)    
IF (@Fecha_Desde_Nivel < ''01/12/2008'')    
BEGIN    
 declare @meses_sinapa int    
 SET @meses_sinapa = (select Meses from Tabla_Meses_Grados_Funciones      
    where  Nivel = @Nivel_8    
    and Grado = @Grado_9)    
  
  set @grado = convert(int,((@Meses_Calculo_Antiguedad - @meses_sinapa) / 36)) + convert(int,@grado_ant)  
END    
  
    
if @@error <> 0               
BEGIN                     
 raiserror 50000 ''ERROR en la Funcion''              
 insert into dbo.CTR_Tempo_Renovacion values (-2)                         
 insert into dbo.CTR_errores_Certificados values (getdate(),@IdContrato,''Error en la Funcion'' )                    
 RETURN              
END                 
            
  
--set @grado_letra = @grado    
--select @grado = ID from dbo.tabla_grados TG                  
--where Grado = @grado_Letra  and baja = 0    
          
            
declare @Error varchar(500)    
    
----------------CONTROLO EL GRADO SI CORRESPONDE-----------------         
if ((@grado < convert(int,@grado_ant)) or (@grado > (convert(int,@grado_ant) + 1)))                
BEGIN                
 set  @Error = ''ERROR No corresponde el grado: Nuevo '' + ltrim(rtrim(convert(char,@Grado))) + '' -- Anterior '' + ltrim(rtrim(convert(char,@grado_ant))) +'' -- Meses_Total ''+ convert(char(10),@Meses_Calculo_Antiguedad)  
 raiserror 50000  @error   
  
 insert into dbo.CTR_Tempo_Renovacion values (-2)                           
 insert into dbo.CTR_errores_Certificados values (getdate(),@IdContrato,''ERROR No corresponde el grado. NIVEL: ''+ @nivel_letra +'' ''+ ''GRADO: ''+ @grado  )         
 RETURN        
END                   
--------------------------------------------------------------------                
                
BEGIN TRANSACTION              
              
-----------------GENERO ANTIGUEDAD----------------------------------                
EXEC dbo.CTR_ADD_Antiguedad_Certificados                
 @IdCalculo,                    
 @nivel_letra,                    
 @grado,  --@grado_letra              
 @Funcion,                 
 @fecha,               
 @Meses_Calculo_Antiguedad, --@meses,                  
 @tipo_certificado                 
--------------------------------------------------------------------                
                
if @@error <> 0               
BEGIN                
  ROLLBACK TRANSACTION              
  raiserror 50000 ''ERROR en Generar la Antiguedad''              
 insert into dbo.CTR_Tempo_Renovacion values (-2)                             
 insert into dbo.CTR_errores_Certificados values (getdate(),@IdContrato,''ERROR en Generar la Antiguedad'')                            
 RETURN        
END              
              
              
DECLARE @id_grado_nuevo int  
select @id_grado_nuevo = ID from dbo.tabla_grados TG                  
where Grado = @grado and baja = 0   
  
-------------------ALTA DE CONTRATO---------------------------------                
EXEC dbo.CTR_ADD_Contratos                        
  @Id_Domicilio_2,                  
  @Nro_Documento_3,                
  @Tipo_Contrato_4,                
  @Nro_Contrato_5 ,                
  @Desde_6  ,                
  @Hasta_7  ,                
  @Nivel_8  ,                
  @id_grado_nuevo  ,                
  @Funcion_10,                  
  @Rango_11  ,     
  @Monto_12  ,                
  @Id_Area_13,                
  @Contrato_Firmante_24  ,                
  @Excepcion_26  ,                
  @Enmienda_27  ,                
  @Observacion_31,                 
  @Estado_32  ,                
  @Conserva_Area ,                
  @Usuario ,                
  @Salvado                 
--------------------------------------------------------------------                
                
if @@error <> 0               
BEGIN              
  ROLLBACK TRANSACTION              
  raiserror 50000 ''ERROR en Alta de Contrato''              
 insert into dbo.CTR_Tempo_Renovacion values (-2)                             
 insert into dbo.CTR_errores_Certificados values (getdate(),@IdContrato,''ERROR en alta de Contrato'' )                            
 RETURN      
END              
              
              
--OBTENGO EL MAXIMO ID_CONTRATO PARA LA PERSONA                
select @IdContrato = max(id_contrato) from dbo.ctr_contratos where nro_documento= @Nro_Documento_3                
                
--OBTENGO EL CERTIFICADO PARA ASIGNARLO AL CONTRATO                
declare @IdCertificado int                
SELECT @IdCertificado = IdCertificado FROM dbo.CTR_Antiguedad_Certificados where idcalculo = @idcalculo                
                
                
------------ASIGNO EL CONTRATO AL CERTIFICADO---------------------                
EXEC dbo.CTR_ADD_Antiguedad_Certificado_Asignacion           
 @Idcertificado,                
 @IdContrato,                
 @Usuario                
--------------------------------------------------------------------                
              
if @@error <> 0               
BEGIN              
  ROLLBACK TRANSACTION              
  raiserror 50000 ''ERROR en Asignación de Certificado''              
 insert into dbo.CTR_Tempo_Renovacion values (-2)                             
 insert into dbo.CTR_errores_Certificados values (getdate(),@IdContrato,''ERROR en Asignacion de Certificado'' )                            
 RETURN      
END              
                
  
          
--create table #Tempo_Cert                  
-- (id int,  
--  Desde datetime,                  
--  Hasta datetime,                  
--  DesdeNuevo varchar(10),  
--  HastaNuevo varchar(10),  
--  Meses int,                  
--  Orden int,              
--  Tipo char(1))   
--  
--INSERT INTO  #Tempo_Cert    
--exec dbo.CTR_Get_Temporal_Experiencias_Reconocidas 1  
  
  
------------ASIGNO ANTIGUEDAD GRADO---------------------                
insert into dbo.CTR_Antiguedad_Reconocida_Grado              
select @IdCalculo, @Nro_Documento_3, t.Tipo, t.Orden, t.Desde, t.Hasta, @FechaCorte, @fecha, @Usuario                  
from dbo.CTR_Temporal_Experiencias_Reconocidas t  
where hostid = @hostId          
---------------------------------------------------------  
               
if @@error <> 0               
BEGIN              
  ROLLBACK TRANSACTION              
  raiserror 50000 ''ERROR en Antiguedad Grado''              
 insert into dbo.CTR_Tempo_Renovacion values (-2)                             
 insert into dbo.CTR_errores_Certificados values (getdate(),@IdContrato,''ERROR en Antiguedad Grado'' )                                    
 RETURN              
END              
              
--drop table #Tempo_Cert  
insert into dbo.CTR_Tempo_Renovacion values (1)                  
  
      
COMMIT TRANSACTION  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Consulta_Contratos_Certificados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Consulta_Contratos_Certificados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE   procedure [dbo].[CTR_GET_Consulta_Contratos_Certificados]  
as  
  

select distinct (cac.idcalculo) Id_Calculo,  
c.id_contrato,
c.Nro_Documento,   
Apellido,  
Nombre,  
Nro_Contrato,   
convert(char(10),c.Desde,103) Desde,   
convert(char(10),c.Hasta,103) Hasta,   
case when aprobado=1 then  
 ''Aprobado''  
else  
 ''En Tramite''  
end Estado,  
IdCertificado,  
convert(char(10),arg.FechaCorte,103) Fecha_Corte,   
convert(char(10),cac.FechaCertificado,103) Fecha_Certificado,   
tn.Nivel Nivel_Cont,  
tg.Grado Grado_Cont,  
cac.Nivel Nivel_Cert,  
cac.Grado Grado_Cert,  
cac.Antiguedad  
from ctr_contratos c  
  
left join CTR_Antiguedad_Certificados cac  
 on cac.idcontrato = c.id_contrato     	
 and cac.idcalculo = (select max(idcalculo) from CTR_Antiguedad_Certificados cac2 
 				where cac.idcontrato = cac2.idcontrato )

left JOIN dbo.CTR_Antiguedad_Reconocida_Grado ARG      
  on ARG.Id_Calculo = cac.IdCalculo       
  
inner join datos_personales DP  
 on DP.nro_documento = c.nro_documento  
  
LEFT join dbo.tabla_niveles TN    
 on TN.id = C.nivel    
    
LEFT join dbo.tabla_grados TG    
 on TG.id = c.grado   
  
where  c.baja=0   
 and (c.tipo_contrato = 1 or c.tipo_contrato = 4)  

order by apellido, nombre  
  



' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_Get_Antiguedad_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Get_Antiguedad_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE   procedure [dbo].[CTR_Get_Antiguedad_Contratos] 
@idCalculo int
as
--exec dbo.CTR_Get_Antiguedad_Contratos 10689

select * from (
	select 
		ctros.Id_Contrato,
		ctros.Nro_Documento,
		certif.IdCertificado,
		certif.IdCalculo,
		certif.Antiguedad as Meses_Certif,
		AntReconocidas.Tipo,
		AntReconocidas.Id_Antiguedad,
		certif3.FechaAsignacion,
		AntReconocidas.FechaCorte,
		--trae el Desde
		CASE AntReconocidas.Tipo
			 WHEN ''E'' THEN SVC_AP.Fecha_Desde
			 WHEN ''P'' THEN SVC_PR.Fecha_Desde
	 		 ELSE  AntReconocidas.Desde
		END  
			as Desde,
		CASE AntReconocidas.Tipo
			 WHEN ''E'' THEN SVC_AP.Fecha_Hasta
			 WHEN ''P'' THEN SVC_PR.Fecha_Hasta
	 		 ELSE  AntReconocidas.Hasta
		END  
			as Hasta
	from dbo.CTR_Contratos ctros
	
	left join dbo.CTR_Antiguedad_Certificados certif
		on ctros.Id_contrato = certif.idcontrato
	
	-- aca combina con una consulta de los certificados que trae solamente
	-- el ultimo asignado a cada id_Contrato
	inner join (
				select certif2.IdContrato, max(certif2.FechaAsignacion) as FechaAsignacion
				from dbo.CTR_Antiguedad_Certificados certif2
				group by certif2.IdContrato
				) certif3
		on certif.Idcontrato = certif3.idcontrato and certif.FechaAsignacion = certif3.FechaAsignacion
	
	left join dbo.CTR_Antiguedad_Reconocida_Grado AntReconocidas
		on certif.IdCalculo = AntReconocidas.id_calculo
	
	left join dbo.LEG_Servicios_Adm_Publica SVC_AP
		on ctros.Nro_documento = SVC_AP.Doc_Titular and SVC_AP.DatodeBaja = 0 and AntReconocidas.Id_Antiguedad = SVC_AP.id and AntReconocidas.Tipo = ''E''
	
	left join dbo.LEG_Otros_Servicios SVC_PR
		on ctros.Nro_documento = SVC_PR.Documento and SVC_PR.DatodeBaja = 0 and AntReconocidas.Id_Antiguedad = SVC_PR.id and AntReconocidas.Tipo = ''P''
	
	where ctros.baja = 0 and @idCalculo=certif.IdCalculo 
) as tablaAFiltrar
where not (tablaAFiltrar.Desde is null or tablaAFiltrar.Hasta is null) 


--and ctros.nro_documento = @documento






' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetAnio_Ctr]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetAnio_Ctr]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'





CREATE     PROCEDURE [dbo].[GetAnio_Ctr]
	(@ID_Contrato [Int])

AS 
declare @Anio [Int]
SET @Anio = (SELECT  year(Desde) FROM [DB_RRHH].[dbo].[CTR_Contratos]
where Baja<>1 and @ID_Contrato=Id_Contrato )

return @Anio  




' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_ADD_Contrato_Certificado_Automatico_PASO1]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ADD_Contrato_Certificado_Automatico_PASO1]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE     Procedure [dbo].[CTR_ADD_Contrato_Certificado_Automatico_PASO1]                
                 
  @Nro_Contrato_ant  char(11)=NULL ,                   
  @HostId varchar(10)      
                
as  
set nocount on              
begin                 
        
--exec [dbo].[CTR_ADD_Contrato_Certificado_Automatico_PASO1] ''06-26473451''             
--OBTENGO EL ID_CONTRATO CON EL CONTRATO ANTERIOR                
declare @IdContrato int     
  
--declare @Nro_Contrato_ant   [char](11)  
--set   @Nro_Contrato_ant = ''01-27259804''      
      
select @IdContrato = id_contrato from dbo.ctr_contratos               
where nro_contrato like ''%''+@Nro_Contrato_ant+''%''    
  
  
--and nro_documento = @Nro_Documento_3              
   
DELETE FROM dbo.CTR_Temporal_Experiencias_Reconocidas WHERE HostId = @HostId    
  

--XXXX podria reemplazarse por  
insert into dbo.CTR_Temporal_Experiencias_Reconocidas (orden, tipo,desde,hasta,hostid  )                 
select distinct   
 id_antiguedad ,  
 Tipo,  
 CASE TIPO when ''E''  THEN servpub.fecha_desde  
              when ''P''  THEN otros.fecha_desde  
     when ''M'' THEN  contratos.desde  
     else ar.desde   
     end as Desde,  
 CASE TIPO when ''E''  THEN servpub.fecha_hasta  
              when ''P''  THEN otros.fecha_hasta  
     when ''M''  THEN  isnull (ctrbajas.Fecha_Baja,ar.hasta)  
     else ar.hasta   
     end as hasta,
  @HostId  
           
from dbo.CTR_Antiguedad_Reconocida_Grado AR  
left join dbo.LEG_Servicios_Adm_Publica servpub  
 on servpub.Id = ar.id_antiguedad   
left join dbo.LEG_Otros_Servicios otros  
 on otros.id = ar.id_antiguedad  
left join dbo.ctr_contratos contratos  
 on contratos.id_contrato = ar.id_antiguedad   
left join dbo.CTR_Contratos_Bajas ctrbajas  
 on contratos.nro_documento = ctrbajas.nro_documento and contratos.id_contrato = ctrbajas.id_contrato          
inner join dbo.CTR_Antiguedad_Certificados AC                
 on ac.idcalculo = ar.id_calculo                
where   ac.idContrato =@IdContrato and idcertificado = (select top 1 idcertificado from dbo.CTR_Antiguedad_Certificados  
               where idcontrato = @IdContrato  
               order by fechaasignacion desc)  
  
--order by AR.id_antiguedad,AR.Hasta desc  
order by desde asc, Hasta  asc   

insert into dbo.CTR_Temporal_Experiencias_Reconocidas (orden, tipo,desde,hasta,hostid  )       
select @IdContrato, ''M'', Desde, Hasta , @HostId             
from dbo.CTR_Contratos ctr  
where  @IdContrato = ctr.Id_Contrato    
  
  
--select @IdContrato as IdCONTRATO   
--select top 1 idcertificado as IdCertificado from dbo.CTR_Antiguedad_Certificados  
--where idcontrato = @IdContrato  
--order by fechaasignacion desc  
  
  
--declare @FechaCorte smalldatetime  
--  
--select Desde, @FechaCorte Hasta , @IdContrato id_antiguedad, ''M''             
--from dbo.CTR_Contratos ctr  
--where  @IdContrato = ctr.Id_Contrato              
--  
--select * from dbo.CTR_Temporal_Experiencias_Reconocidas  
--    
               
end  
' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_CTR_Antiguedad_Grado_GER]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/****** Object:  StoredProcedure [dbo].[CTR_ADD_Anexo_Impreso]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ADD_Anexo_Impreso]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_ADD_Anexo_Impreso]
	@Expediente Varchar(30)
AS
INSERT INTO dbo.CTR_Expedientes_Anexados
SELECT ID_Contrato
FROM dbo.CTR_Contratos
WHERE rtrim(Exp_nro) = @Expediente AND
      Baja = 0 AND
      Aprobado =0
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_DEL_Exp_Tipo_X]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_DEL_Exp_Tipo_X]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[CTR_DEL_Exp_Tipo_X]
  @IdCalculo int
as
declare @FechaCorte datetime,  
  @Nro_Documento int,  

  @UsuarioProceso int,
  @FechaProceso datetime
  
-- @IdCalculo DEBERIA RECIBIRLO
-- set @IdCalculo = 8427
--- comentar esto luego

select top 1  
  @Nro_Documento = Nro_Documento,   
  @FechaCorte = FechaCorte,  
  @FechaProceso = FechaProceso,  
  @UsuarioProceso = UsuarioProceso  
from dbo.CTR_Antiguedad_Reconocida_Grado
where Id_calculo = @IdCalculo

insert INTO dbo.CTR_Antiguedad_Reconocida_Grado (Id_Calculo,Nro_Documento,tipo,Id_Antiguedad,Desde,Hasta,FechaCorte,FechaProceso,UsuarioProceso) select @IdCalculo
 ,ctr.nro_documento
 ,''M''
 ,ctr.id_contrato
 ,ctr.Desde  
 ,isnull(ctrbajas.Fecha_Baja, @FechaCorte)
 ,@FechaCorte
 ,@FechaProceso
 ,@UsuarioProceso
from dbo.CTR_Contratos CTR  
 left join dbo.CTR_Contratos_Bajas ctrbajas  
  on ctr.nro_documento = ctrbajas.nro_documento and ctr.id_contrato = ctrbajas.id_contrato  
 left join dbo.Tabla_Funciones_Contratos ctrfunc  
  on ctrfunc.id=ctr.funcion  
 left join dbo.Tabla_Niveles ctrniv  
  on ctrniv.id=ctr.nivel  
 left join dbo.Tabla_Resoluciones_Contratos ctrtipo  
  on ctrtipo.id=ctr.tipo_contrato  
where ctr.aprobado=1 and (ctr.Desde < ctrbajas.Fecha_Baja or ctrbajas.Fecha_Baja is null ) and ctr.Desde < @FechaCorte and ctr.nro_documento = @Nro_Documento   
	and (ctr.tipo_contrato = 1 or ctr.tipo_contrato = 4)


delete from dbo.CTR_Antiguedad_Reconocida_Grado where id_calculo = @IdCalculo and tipo = ''X''


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Primer_Fecha_Ctro1421]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Primer_Fecha_Ctro1421]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'                                               
CREATE procedure [dbo].[CTR_GET_Primer_Fecha_Ctro1421]  
 @id_contrato int                  
as      

declare @idcontparametro int  
set @idcontparametro = @id_contrato  

set nocount on            
  
--Declaracion de variables  
DECLARE @nro_doc int, @inicio_contrato datetime, @fin_contrato datetime,   
 @nivel int, @fecha_baja smalldatetime, @inicio_proximo_contrato smalldatetime;  
  
  
--Seteo inicial de variables:  
-- nivel del cual se quiere saber, cuándo fue otorgado por primera vez a la persona.  
set @nivel = (select nivel from dbo.ctr_contratos where id_contrato = @id_contrato)  
set @nro_doc = (select nro_documento from dbo.ctr_contratos where id_contrato = @id_contrato)  
  
  
--cursor con contratos y bajas  
DECLARE contratos_cursor CURSOR FOR   
   
 SELECT ctr.desde, ctr.hasta, bajas.fecha_baja  
 FROM ctr_contratos ctr  
 LEFT JOIN ctr_contratos_bajas bajas  
  ON ctr.id_contrato = bajas.id_contrato  
 WHERE ctr.nro_documento = @nro_doc 
  --and ctr.nivel = @nivel   
  and ctr.tipo_contrato in (1,4) 
  and ctr.id_contrato <= @id_contrato and ctr.aprobado = 1  
 ORDER BY ctr.desde desc;  
  
  
--abrir el cursor  
OPEN contratos_cursor;   
  
--leer del cursor, en las variables  
FETCH NEXT FROM contratos_cursor INTO @inicio_contrato, @fin_contrato, @fecha_baja  
  
--esto para la primera iteracion.  
set @inicio_proximo_contrato = @fin_contrato  
  
--loop sobre el cursor  
WHILE @@FETCH_STATUS = 0  
BEGIN  
 if dbo.fx_son_fechas_cercanas(@inicio_proximo_contrato, @fin_contrato) = 0  
 begin  

  --select  @inicio_proximo_contrato as desde  

	INSERT INTO #tempo 
	values ( @idcontparametro, @inicio_proximo_contrato )  

    
  --cerrar el cursor y salir  
  CLOSE contratos_cursor; DEALLOCATE contratos_cursor;  
  return  
 end  
  
 set @inicio_proximo_contrato = @inicio_contrato  
  
 --leer del cursor, en las variables  
 FETCH NEXT FROM contratos_cursor INTO @inicio_contrato, @fin_contrato, @fecha_baja  
END  
  
--cerrar el cursor  
CLOSE contratos_cursor; DEALLOCATE contratos_cursor;  
  

--select @inicio_proximo_contrato as desde  
INSERT INTO #tempo 
values ( @idcontparametro, @inicio_proximo_contrato )  ' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_RECEPCION_Otros_Documentos_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_RECEPCION_Otros_Documentos_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[LEG_ADD_RECEPCION_Otros_Documentos_Contratos]  
  @Tipo  [varchar](50),  
  @Foja  [char](10),  
  @idUsuario smallint,  
  @idContrato int  
AS   
  
  
  
Declare @idInterna int  
Declare @Documento int  
Declare @Intervino varchar(50)  
  
-- Determina Documento e IdInterna de la Persona según el Id de Contrato  
  
Select @idInterna = DP.id_interna, @Documento = DP.Nro_Documento  
FROM dbo.Datos_Personales DP  
INNER JOIN dbo.CTR_Contratos CT  
 on CT.id_Contrato = @idContrato   AND
	CT.Nro_Documento = DP.Nro_Documento
  
  
-- Determinacion del Nombre de Usuario que intervino  
  
Select @Intervino = U.nombre  
FROM dbo.RH_Usuarios U   
WHERE id = @idUsuario  
  
  
  
  
declare @id [smallint]  
set @id = (select max(id)+1 from [dbo].[Otros_Indice_Documentos]  where id_interna = @IdInterna )  
  
if @id is null begin  
 set @id =1  
end  
  
  
INSERT INTO [dbo].[Otros_Indice_Documentos]   
  ([Jurisdicción],  
  [Organismo],  
  [Tipo],  
  [Foja],  
  [Fecha_Agregado],  
  [Agr_Intervino],  
  [Des_Fecha],  
  [Des_Intervino],  
  [Id_Interna],  
  [Legajo],  
 id,  
 datodebaja,  
 datonoimprime)  
   
   
VALUES   
 (''MDS'',  
  ''MDS'',  
  @Tipo,  
  @Foja,  
  getdate(),  
  @Intervino,  
  ''01/01/1900'',  
  '''',  
  @idInterna,  
  @Documento,  
  @id,  
  0,  
  0)  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_UPD_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_UPD_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_UPD_Contratos]      
      
 (@Id_Domicilio_2  [int]=NULL,      
  @Nro_Documento_3  [int]=NULL,      
  @Tipo_Contrato_4  [smallint]=NULL,      
  @Nro_Contrato_5  [char](11)=NULL,      
  @Desde_6  [smalldatetime]=NULL,      
  @Hasta_7  [smalldatetime]=NULL,      
  @Nivel_8  [smallint]=NULL,      
  @Grado_9  [smallint]=NULL,      
  @Funcion_10  [smallint]=NULL,      
  @Rango_11  [smallint]=NULL,      
  @Monto_12  [money]=NULL,      
  @Id_Area_13  [int]=NULL,      
  @Contrato_Firmante_24  [smallint]=NULL,      
  @Excepcion_26  [bit]=NULL,      
  @Enmienda_27  [bit]=NULL,      
  @Observacion_31  [varchar](200)=NULL,      
  @Estado_32  [char](1)=NULL,      
  @Conserva_Area bit=NULL,      
  @Usuario smallint=NULL,      
  @Id_Contrato_1 int,      
  @Salvado bit=0)      
AS       
      
UPDATE  [dbo].[CTR_Contratos]       
SET      
  [Id_Domicilio]= @Id_Domicilio_2,      
  [Nro_Documento]= @Nro_Documento_3,      
  [Tipo_Contrato]= @Tipo_Contrato_4,      
  [Nro_Contrato]=  @Nro_Contrato_5,      
  [Desde]=@Desde_6,      
  [Hasta]=@Hasta_7,      
  [Nivel]=@Nivel_8,      
  [Grado]= @Grado_9,      
  [Funcion]= @Funcion_10,      
  [Rango]= @Rango_11,      
  [Monto]= @Monto_12,      
  [Id_Area]= @Id_Area_13,      
  [Contrato_Firmante]= @Contrato_Firmante_24,      
  [Excepcion]= @Excepcion_26,      
  [Enmienda]= @Enmienda_27,      
  [Observacion]= @Observacion_31,      
  [Estado]=@Estado_32,     
  impreso = 0  ,    
  Conserva_Area=@Conserva_Area,      
  usuario=@Usuario,      
  salvado = (CASE WHEN salvado = 0 then @Salvado ELSE Salvado END),      
  fecha_salvado=(CASE WHEN @salvado = 1 then getdate() ELSE Fecha_Salvado END),      
  usuario_salvado=(CASE WHEN @salvado = 1 then @Usuario ELSE usuario_salvado END)        
WHERE Id_contrato=@Id_Contrato_1      
      
    
    
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_CTR_Antiguedad_Grado_BKP_28092011]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_CTR_Antiguedad_Grado_BKP_28092011]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[RPT_CTR_Antiguedad_Grado_BKP_28092011]                        
  @Nro_Documento int,                        
  @id_contrato int          
as  
--NO TOMADAS      
      
SET NOCOUNT ON                    
          
DECLARE @FechaCorte smalldatetime      
DECLARE @Id_Certificado int      
          
select  @FechaCorte = FechaCorte,      
   @Id_Certificado = IdCertificado      
from dbo.CTR_Antiguedad_Certificados ac          
          
INNER JOIN dbo.CTR_Antiguedad_Reconocida_Grado ar          
 ON ar.id_calculo = ac.IdCalculo           
          
where IdContrato = @id_contrato          
 and IdCertificado = (select max(IdCertificado) from CTR_Antiguedad_Certificados where IdContrato = @id_contrato and impreso=1)          
          
    
create table #tempo          
(        
id_contrato int,      
id int,          
tipo char(1),          
lugar varchar(200),          
actividad varchar(100),          
fecha_desde smalldatetime,          
fecha_hasta smalldatetime,          
folio char(10),      
fecha_carga smalldatetime,      
Marca char(1)          
)          
          
                        
-- SERVICIOS ADM PUBLICA          
INSERT INTO #tempo                    
select distinct        
 @id_contrato id_contrato,       
 sap.id,                        
 ''E'' Tipo,            
 Jurisdiccion +'', ''+ Organismo lugar,            
 TFC.Descripcion  Actividad,            
 fecha_desde ,               
 fecha_hasta ,                    
 folio ,      
 Fecha_Carga,      
 ''''      
FROM dbo.LEG_Servicios_Adm_Publica SAP                        
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                        
 ON TFC.Id = SAP.Cargo                        
WHERE  SAP.Doc_Titular =  @Nro_Documento AND                        
 DatoDeBaja = 0                         
                      
        
--UNION -- OTROS SERVICIOS                        
            
INSERT INTO #tempo                                
select distinct       
 @id_contrato id_contrato,                       
 ots.id,        
 ''P'' Tipo,                  
 Institucion lugar,            
 TFC.Descripcion Actividad,            
 fecha_desde ,               
 fecha_hasta ,                         
 Folio,      
 '''',      
 ''''                  
FROM dbo.LEG_otros_servicios OTS                        
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                        
   ON TFC.Id = OTS.Cargo                        
WHERE OTS.Documento =  @Nro_Documento  AND                         
   DatoDeBaja = 0                         
                    
--UNION                     
  
-- CONTRATOS DEL MDS FAML 15/10/2009          
INSERT INTO #tempo                    
select distinct        
 @id_contrato id_contrato  
 ,ctr.id_Contrato id  
 ,''M'' Tipo  
 ,''Min. Desarrollo Social'' lugar  
 ,CASE ctr.tipo_contrato  
   WHEN 1 THEN ''Contrato (Nivel '' + ctrniv.Nivel + '')'' + ctrtipo.Descripcion  
   WHEN 2 THEN ''Contrato ('' + ctrfunc.Descripcion + '')'' + ctrtipo.Descripcion  
   ELSE ''Contrato MDS''  
 END    
  as Actividad  
 ,CTR.desde fecha_desde  
 ,CASE ctrbajas.Fecha_Baja  
  WHEN Null THEN convert(char(10),@FechaCorte,103)  
  ELSE case when ctr.Hasta > @FechaCorte   
   THEN convert(char(10),@FechaCorte,103)  
   else convert(char(10),ctrbajas.Fecha_Baja,103)  
   end               
   END Fecha_hasta              
 ,''99-999/999''  
 ,''''  
 ,''''      
FROM dbo.CTR_Contratos ctr  
 left join dbo.Tabla_Funciones_Contratos ctrfunc  
  on ctrfunc.id=ctr.funcion  
 left join dbo.Tabla_Niveles ctrniv  
  on ctrniv.id=ctr.nivel  
 left join dbo.Tabla_Resoluciones_Contratos ctrtipo  
  on ctrtipo.id=ctr.tipo_contrato  
 left join dbo.CTR_Contratos_Bajas ctrbajas  
  on ctr.nro_documento = ctrbajas.nro_documento and ctr.id_contrato = ctrbajas.id_contrato  
where ctr.aprobado=1 and (ctr.Desde < ctrbajas.Fecha_Baja or ctrbajas.Fecha_Baja is null ) and ctr.Desde < @FechaCorte and ctr.nro_documento = @Nro_Documento   
                
            
--COMENTADO POR FAML  
--INSERT INTO #tempo                                
--SELECT          
-- @id_contrato id_contrato,       
-- 999999,        
-- ''M'' Tipo,               
-- ''Ministerio de Desarrollo Social'' lugar,                                 
-- '''' actividad,            
-- fecha_min fecha_desde ,               
-- @FechaCorte fecha_hasta ,                           
-- ''00-000/000'' folio ,      
-- '''',      
-- ''''           
--FROM dbo.Designaciones_fechas df                        
--WHERE Nro_Doc  = @Nro_Documento                    
ORDER BY fecha_desde   --GER: 01/11/2007                      
                   
            
declare @fecha_min datetime                                
set @fecha_min = (select fecha_min from dbo.designaciones_fechas where Nro_Doc = @Nro_Documento)                        
                        
                    
 -- ELIMINA REGISTROS POSTERIORES A LA FECHA DE INGRESO AL MINISTERIO --                                 
-- update #tempo          
-- set fecha_hasta =  @fecha_min - 1          
-- where fecha_hasta > @fecha_min and tipo <> ''M''                      
--            
-- DELETE T                    
-- FROM #tempo T                    
-- WHERE Fecha_Desde >= @Fecha_Min and tipo <> ''M''                  
          
--  update #servicios                        
--  set fecha_hasta =  @fecha_min - 1          
--  where fecha_hasta > @fecha_min and tipo <> ''M''                           
--  DELETE T                    
--  FROM #Servicios T                    
--  WHERE Fecha_Desde >= @Fecha_Min and tipo <> ''M''                      
    
update t      
set marca =  case       
   when convert(char(10),t.fecha_carga,112) > convert(char(10),cac.FechaAsignacion,112) then ''X''      
  else       
   ''''      
  end       
FROM #tempo t       
      
INNER JOIN CTR_Antiguedad_Certificados cac      
   ON t.Id_Contrato = cac.IdContrato      
      
where cac.idcertificado = @Id_Certificado      
 and cac.IdContrato = @id_contrato      
      
    
----------------------------------------------------------------------------------------------  
--ESTAS SON LAS TOMADAS. SE COPIO EL SP "RPT_CTR_Antiguedad_Reconocida_Grado" Y SE PEGO ACA  
----------------------------------------------------------------------------------------------  
  
DECLARE --@Id_Calculo int                   
 @desde_ct char(10),                  
 @hasta_ct char(10),                  
 @id_certificado_ct  int,                  
 @FechaCertificado char(10),                  
 @FechaAsignacion char(10),              
 @Nivelcert char(5),              
 @Gradocert char (5),              
 @Antiguedadcert smallint  
                  
                  
select @id_certificado_ct = IdCertificado,                     
 @FechaCertificado = convert(char(10),FechaCertificado,103),                  
 @FechaAsignacion =  convert(char(10),FechaAsignacion,103),              
 @Nivelcert = Nivel,              
 @Gradocert = Grado,              
 @Antiguedadcert = Antiguedad                 
from dbo.CTR_Antiguedad_Certificados ac                    
where IdContrato = @id_contrato                    
 and IdCertificado = (select max(IdCertificado) from CTR_Antiguedad_Certificados where IdContrato = @id_contrato)                    
                    
                  
select  @desde_ct = convert(char(10),desde,103),                  
   @hasta_ct = convert(char(10),hasta,103)         
from ctr_contratos                  
where id_contrato = @id_contrato                  
                  
    
create table #tempo_tomadas                    
(                    
Nro_Documento int,                    
apellido varchar(100),                      
nombre varchar(100),                     
Funcion varchar(100),                     
FechaCorte char(10),      
id_lugar int,                  
tipo char(1),                    
lugar varchar(200),                    
actividad varchar(100),                    
desde char(10),                    
hasta char(10),                    
folio char(10)              
)                    
          
                    
insert into #tempo_tomadas                    
SELECT  arg.Nro_Documento,                      
 dp.apellido,                      
 dp.nombre,                       
 ac.Funcion,                      
 convert(char(10),arg.FechaCorte,103) FechaCorte,     
 sap.Id,                     
 arg.Tipo,                      
 sap.Jurisdiccion +'', ''+ sap.Organismo lugar,                      
 TFC.Descripcion  Actividad,                      
 convert(char(10),sap.Fecha_Desde,103) Desde,                            
 convert(char(10),sap.Fecha_Hasta,103) hasta,                      
 Folio                     
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                        
                      
INNER JOIN dbo.ctr_antiguedad_certificados AC                        
 ON AC.idCalculo = arg.id_calculo                        
                      
INNER JOIN dbo.datos_personales dp                        
 ON dp.nro_documento = arg.Nro_Documento                      
                      
INNER JOIN dbo.LEG_Servicios_Adm_Publica sap                      
 ON sap.id = arg.Id_Antiguedad                      
                      
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                                  
 ON TFC.Id = SAP.Cargo                         
                      
WHERE   ac.idcertificado = @id_certificado_ct                      
 and arg.Tipo = ''E''                      
                      
                      
-- Lo comenté para que no traiga el ingreso al MDS FAML 15/10/2009                      
--insert into #tempo_tomadas                    
--SELECT  arg.Nro_Documento,                      
-- dp.apellido,                      
-- dp.nombre,                       
-- ac.Funcion,                      
-- convert(char(10),arg.FechaCorte,103) FechaCorte,     
-- 999999,                     
-- ''M'' Tipo,                      
-- ''Ministerio de Desarrollo Social'' lugar,                      
-- ''''  Actividad,                      
-- convert(char(10),arg.desde,103) Desde,                 
-- convert(char(10),arg.hasta,103) hasta,                      
-- ''00-000/000'' folio              
--FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                        
--                      
--INNER JOIN dbo.ctr_antiguedad_certificados AC                        
-- ON AC.idCalculo = arg.id_calculo                        
--                      
--INNER JOIN dbo.datos_personales dp                        
-- ON dp.nro_documento = arg.Nro_Documento                      
--                      
--WHERE   ac.idcertificado = @id_certificado_ct                      
-- and arg.Tipo = ''X''                      
                    
---Lo agregue para que traiga los contratos del MDS  
insert into #tempo_tomadas                    
SELECT  arg.Nro_Documento,                      
 dp.apellido,                      
 dp.nombre,                       
 ac.Funcion,                      
 convert(char(10),arg.FechaCorte,103) FechaCorte,     
 ctr.Id_Contrato,                     
 arg.Tipo,                      
 ''Min. Desarrollo Social'' lugar,                      
 CASE ctr.tipo_contrato  
   WHEN 1 THEN ''Contrato (Nivel '' + ctrniv.Nivel + '')'' + ctrtipo.Descripcion  
   WHEN 2 THEN ''Contrato ('' + ctrfunc.Descripcion + '')'' + ctrtipo.Descripcion  
   ELSE ''Contrato MDS''  
 END    
  as Actividad,  
 convert(char(10),ctr.Desde,103) Desde,                            
 CASE ctrbajas.Fecha_Baja  
   WHEN Null THEN convert(char(10),FechaCorte,103)  
   ELSE convert(char(10),ctrbajas.Fecha_Baja,103)  
 END Hasta,  
 ''00-000/000''                     
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                        
                      
INNER JOIN dbo.ctr_antiguedad_certificados AC                        
 ON AC.idCalculo = arg.id_calculo                        
                      
INNER JOIN dbo.datos_personales dp                        
 ON dp.nro_documento = arg.Nro_Documento                      
                      
INNER JOIN dbo.CTR_Contratos CTR                      
 ON ctr.id_contrato = arg.Id_Antiguedad                      
   
left join dbo.Tabla_Funciones_Contratos ctrfunc  
  on ctrfunc.id=ctr.funcion  left join dbo.Tabla_Niveles ctrniv  
  on ctrniv.id=ctr.nivel  
left join dbo.Tabla_Resoluciones_Contratos ctrtipo  
  on ctrtipo.id=ctr.tipo_contrato  
left join dbo.CTR_Contratos_Bajas ctrbajas  
  on ctr.nro_documento = ctrbajas.nro_documento and ctr.id_contrato = ctrbajas.id_contrato  
WHERE   ac.idcertificado = @id_certificado_ct                      
 and arg.Tipo = ''M''  
---HASTA ACA AGREGUE FAML                    
        
        
insert into #tempo_tomadas                    
SELECT  arg.Nro_Documento,                      
 dp.apellido,                      
 dp.nombre,                       
 ac.Funcion,                      
 convert(char(10),arg.FechaCorte,103) FechaCorte,      
 ots.id,                    
 arg.Tipo,                      
 ots.Institucion lugar,                      
 TFC.Descripcion  Actividad,                      
 convert(char(10),ots.Fecha_Desde,103) Desde,                            
 convert(char(10),ots.Fecha_Hasta,103) hasta,                      
 Folio                     
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                        
                      
INNER JOIN dbo.ctr_antiguedad_certificados AC                        
 ON AC.idCalculo = arg.id_calculo                        
                      
INNER JOIN dbo.datos_personales dp                        
 ON dp.nro_documento = arg.Nro_Documento                      
                      
INNER JOIN dbo.LEG_otros_servicios ots                      
 ON ots.id = arg.Id_Antiguedad                      
                      
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                                  
 ON TFC.Id = ots.Cargo                         
                      
WHERE   ac.idcertificado = @id_certificado_ct                      
 and arg.Tipo = ''P''                     
  
  
----------------------------------------------------------------------------------------------  
--FIN TOMADAS  
----------------------------------------------------------------------------------------------  
  
SELECT         
t.id,        
tipo ,          
lugar ,          
actividad ,          
convert(char(10),fecha_desde,103) desde,          
convert(char(10),fecha_hasta,103) hasta,          
folio ,      
fecha_carga,      
marca      
FROM #tempo t           
WHERE t.id NOT IN (select id_lugar from #tempo_tomadas)        
order by fecha_desde                        
  
  
  
/*  
SELECT         
t.id,        
tipo ,          
lugar ,          
actividad ,          
convert(char(10),fecha_desde,103) desde,          
convert(char(10),fecha_hasta,103) hasta,          
folio ,      
fecha_carga,      
marca      
FROM #tempo t           
WHERE t.id NOT IN (select rg.Id_Antiguedad         
   from CTR_Antiguedad_Certificados cac        
   INNER JOIN CTR_Antiguedad_Reconocida_Grado rg        
   ON cac.idcalculo = rg.id_calculo        
   where cac.IdContrato = @id_contrato)        
order by fecha_desde                        
*/  ' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Primer_Fecha_Nivel]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Primer_Fecha_Nivel]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'                                                 
CREATE procedure [dbo].[CTR_GET_Primer_Fecha_Nivel]
 @id_contrato int                    
as        
set nocount on              
    
--Declaracion de variables    
DECLARE @nro_doc int, @inicio_contrato datetime, @fin_contrato datetime,     
 @nivel int, @fecha_baja smalldatetime, @inicio_proximo_contrato smalldatetime;    
    
    
--Seteo inicial de variables:    
-- nivel del cual se quiere saber, cuándo fue otorgado por primera vez a la persona.    
set @nivel = (select nivel from dbo.ctr_contratos where id_contrato = @id_contrato)    
set @nro_doc = (select nro_documento from dbo.ctr_contratos where id_contrato = @id_contrato)    
    
    
--cursor con contratos y bajas    
DECLARE contratos_cursor CURSOR FOR     
     
 SELECT ctr.desde, ctr.hasta, bajas.fecha_baja    
 FROM ctr_contratos ctr    
 LEFT JOIN ctr_contratos_bajas bajas    
  ON ctr.id_contrato = bajas.id_contrato    
 WHERE ctr.nro_documento = @nro_doc and ctr.nivel = @nivel     
  and ctr.id_contrato <= @id_contrato and ctr.aprobado = 1    
 ORDER BY ctr.desde desc;    
    
    
--abrir el cursor    
OPEN contratos_cursor;     
    
--leer del cursor, en las variables    
FETCH NEXT FROM contratos_cursor INTO @inicio_contrato, @fin_contrato, @fecha_baja    
    
--esto para la primera iteracion.    
set @inicio_proximo_contrato = @fin_contrato    
    
--loop sobre el cursor    
WHILE @@FETCH_STATUS = 0    
BEGIN    
 if dbo.fx_son_fechas_cercanas(@inicio_proximo_contrato, @fin_contrato) = 0    
 begin    

  select  @inicio_proximo_contrato as desde    
      
  --cerrar el cursor y salir    
  CLOSE contratos_cursor; DEALLOCATE contratos_cursor;    
  return    
 end    
    
 set @inicio_proximo_contrato = @inicio_contrato    
    
 --leer del cursor, en las variables    
 FETCH NEXT FROM contratos_cursor INTO @inicio_contrato, @fin_contrato, @fecha_baja    
END    
    
--cerrar el cursor    
CLOSE contratos_cursor; DEALLOCATE contratos_cursor;    


IF (@inicio_proximo_contrato is null)
	SET @inicio_proximo_contrato = (Select desde from ctr_contratos where id_contrato = @id_contrato and baja=0)


select @inicio_proximo_contrato as desde ' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Traspaso_Por_IdInterna]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Traspaso_Por_IdInterna]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[LEG_GET_Traspaso_Por_IdInterna]    
  @id_contrato int    
as    


declare @id_nivel int
set @id_nivel = (select nivel from ctr_contratos where id_contrato = @id_contrato)


select *, @id_nivel nivel from RH_Traspaso_Documentacion    
where tabla like ''%'' + convert(varchar(20),@id_contrato) +''%''    
 and codigo = ''CAPCL''    
 and fecha_rx is null    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Primer_Fecha_Nivel_1]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Primer_Fecha_Nivel_1]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'                                               
CREATE procedure [dbo].[CTR_GET_Primer_Fecha_Nivel_1]  
 @id_contrato int                  
as      

declare @idcontparametro int  
set @idcontparametro = @id_contrato  

set nocount on            
  
--Declaracion de variables  
DECLARE @nro_doc int, @inicio_contrato datetime, @fin_contrato datetime,   
 @nivel int, @fecha_baja smalldatetime, @inicio_proximo_contrato smalldatetime;  
  
  
--Seteo inicial de variables:  
-- nivel del cual se quiere saber, cuándo fue otorgado por primera vez a la persona.  
set @nivel = (select nivel from dbo.ctr_contratos where id_contrato = @id_contrato)  
set @nro_doc = (select nro_documento from dbo.ctr_contratos where id_contrato = @id_contrato)  
  
  
--cursor con contratos y bajas  
DECLARE contratos_cursor CURSOR FOR   
   
 SELECT ctr.desde, ctr.hasta, bajas.fecha_baja  
 FROM ctr_contratos ctr  
 LEFT JOIN ctr_contratos_bajas bajas  
  ON ctr.id_contrato = bajas.id_contrato  
 WHERE ctr.nro_documento = @nro_doc and ctr.nivel = @nivel   
  and ctr.id_contrato <= @id_contrato and ctr.aprobado = 1  
 ORDER BY ctr.desde desc;  
  
  
--abrir el cursor  
OPEN contratos_cursor;   
  
--leer del cursor, en las variables  
FETCH NEXT FROM contratos_cursor INTO @inicio_contrato, @fin_contrato, @fecha_baja  
  
--esto para la primera iteracion.  
set @inicio_proximo_contrato = @fin_contrato  
  
--loop sobre el cursor  
WHILE @@FETCH_STATUS = 0  
BEGIN  
 if dbo.fx_son_fechas_cercanas(@inicio_proximo_contrato, @fin_contrato) = 0  
 begin  

  --select  @inicio_proximo_contrato as desde  

	INSERT INTO #tempo 
	values ( @idcontparametro, @inicio_proximo_contrato )  

    
  --cerrar el cursor y salir  
  CLOSE contratos_cursor; DEALLOCATE contratos_cursor;  
  return  
 end  
  
 set @inicio_proximo_contrato = @inicio_contrato  
  
 --leer del cursor, en las variables  
 FETCH NEXT FROM contratos_cursor INTO @inicio_contrato, @fin_contrato, @fecha_baja  
END  
  
--cerrar el cursor  
CLOSE contratos_cursor; DEALLOCATE contratos_cursor;  
  

--select @inicio_proximo_contrato as desde  
INSERT INTO #tempo 
values ( @idcontparametro, @inicio_proximo_contrato )  ' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_LEG_Incorporacion_Contrato]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_LEG_Incorporacion_Contrato]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE  procedure [dbo].[RH_LEG_Incorporacion_Contrato]
	@Operacion char(1),
	@Id int,
	@Usuario_RX smallint=NULL,
	@Id_interna int=NULL,
	@FolioCarrera varchar(10)=NULL,
	@FolioOtrosDatos varchar(10)=NULL,
	@Regimen smallint=NULL,
	@Agrupamiento smallint= NULL,
	@Cargo smallint=NULL,
	@TipoCargo smallint=NULL

AS
SET NOCOUNT ON
IF @Operacion = ''S'' BEGIN
	SELECT	Registro,id
	FROM dbo.RH_Traspaso_Documentacion TD
	INNER JOIN dbo.Datos_Personales DP
		on DP.Nro_Documento = TD.Registro AND
		VisibleLegajos = 1
	WHERE 	Id = @Id 
END

IF @Operacion = ''I'' BEGIN
	UPDATE dbo.RH_Traspaso_Documentacion
	SET	Usuario_Rx = @Usuario_RX,	
		Fecha_Rx = Getdate()
	WHERE Id = @Id
	
	Declare @Registro int
	Set @Registro = (Select registro from dbo.RH_Traspaso_Documentacion Where Id = @Id)


	Declare @MaxCarrera int
	set @MaxCarrera = (select max(id_carrera)+1 from dbo.Carrera_Administrativa)

	--GENERAR CARRERA ADMINISTRATIVA
	INSERT INTO dbo.Carrera_Administrativa 
	SELECT 	''MDS'',
		''MDS'',
		@Regimen,
		@Agrupamiento,
		C.Grado,
		@Cargo,
		152, --''Aprobación de Contrato'',
		C.desde,
		C.Hasta,
		C.Acto_tipo,
		C.Acto_nro,
		C.Acto_Fecha,
		@FolioCarrera,
		@Id_interna,
		C.Nro_Documento,
		@MaxCarrera,
		C.Nivel,
		@TipoCargo,
		@Usuario_RX,
		0,
		0
	FROM dbo.Ctr_Contratos C
	--WHERE C.Id_Contrato = (Select max(id_contrato) from dbo.Ctr_Contratos where Nro_Documento = @Registro AND Aprobado =1)
	WHERE C.Id_Contrato = (Select cast(right(tabla,len(tabla)-11)as int) from dbo.RH_Traspaso_Documentacion Where Id = @Id)



	--GENERAR Otros_Indices_Documentos

	Declare @MaxOrden int
	Set @MaxOrden = (Select max(Id)+1 from dbo.Otros_Indice_Documentos)

	INSERT INTO dbo.Otros_Indice_Documentos
	SELECT  ''MDS'',
		''MDS'',
		''Contrato '' + C.Nro_Contrato,
		@FolioOtrosDatos,
		C.Desde,
		U.Nombre,
		''01/01/1900'',
		'''',
		@Id_interna,	
		C.Nro_Documento,		
		@MaxOrden,
		0,
		0
	FROM dbo.Ctr_Contratos C
	INNER JOIN RH_Usuarios U
		ON u.id = @Usuario_RX
	--WHERE C.Id_Contrato = (Select max(id_contrato) from dbo.Ctr_Contratos where Nro_Documento = @Registro AND Aprobado =1)
	WHERE C.Id_Contrato = (Select cast(right(tabla,len(tabla)-11)as int) from dbo.RH_Traspaso_Documentacion Where Id = @Id)

END



















' 
END
GO
/****** Object:  StoredProcedure [dbo].[Web_GetAgentesDelArea]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Web_GetAgentesDelArea]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================  
-- Author:  Agustin  
-- ALTER  date: 27/01/2009  
-- Description: Trae los Agentes de un Area  
-- =============================================  
CREATE   PROCEDURE [dbo].[Web_GetAgentesDelArea]
 @idArea int  
AS
BEGIN  
  
--Llena temporal
 SELECT 
  ctr.nro_documento, ctr.monto,   
  case when sendlegajos = 1 then 0 else 1 end Es1184  
  into #tmpTipoContrato  
 FROM  
  dbo.ctr_contratos ctr  
 LEFT JOIN  
  dbo.tabla_resoluciones_contratos res   
  ON  
   ctr.tipo_contrato = res.id  
 LEFT JOIN    
  dbo.tabla_tipos_contratos tipo  
  ON  
   tipo.id = res.tipo_contrato  
 WHERE  
  ctr.aprobado = 1 and  
  ctr.baja = 0  and 
  ctr.estado like ''A''
--Consulta Final
 SELECT 
  dp.nro_documento,   
  dp.apellido,   
  dp.nombre,  
  isnull(clin.nro_articulo, clsol.nro_articulo) nro_articulo,   
  isnull(clin.concepto, clsol.concepto) concepto, 
  case when ls.id_interna is null then 0 else 1 end aprobada,
  case when ls.id_interna is null then sweb.desde else ls.desde end desde,
  case when ls.id_interna is null then sweb.hasta else ls.hasta end hasta,
  isnull(pps.id, 0) idPasePendiente,  
  case when tmp.Es1184 = 1 then 1 else 0 end Es1184,  
  isnull(tmp.monto, 0) monto,  
  ttp.Descripcion planta,  
  niv.nivel,  
  gra.grado,
  isnull(dom.telefono,''-'') telefono,
  TADep.Descripcion dependencia,
  dp.id_interna legajo,
  left(dp.Cuil_Nro,2) +''-''+ left(right(dp.Cuil_Nro,9),8) +''-''+ right(dp.Cuil_Nro,1) cuit


 FROM dbo.datos_personales dp  

 INNER JOIN dbo.VW_Desglose_Area da on  
  da.id_interna = dp.id_interna  

 LEFT JOIN dbo.Licencias_Solicitadas ls on  
  dp.id_interna = ls.id_interna and  
  cast(cast(year(getdate())as varchar) + ''-'' + cast(day(getdate())as varchar) + ''-'' + cast(month(getdate())as varchar) as datetime) between ls.desde and ls.hasta  

 LEFT JOIN dbo.tabla_conceptos_licencias clin on  
  clin.id_concepto = ls.concepto  

 LEFT JOIN dbo.Asis_Solicitudes_Licencia_Web sweb on  
  sweb.id_interna = dp.id_interna and  
  cast(cast(year(getdate())as varchar) + ''-'' + cast(day(getdate())as varchar) + ''-'' + cast(month(getdate())as varchar) as datetime)  between sweb.desde and sweb.hasta  
  AND sweb.baja = 0

 LEFT JOIN dbo.tabla_conceptos_licencias clsol on  
  clsol.id_concepto = sweb.concepto  

 LEFT JOIN dbo.PLA_Pases_Solicitados pps on  
  pps.id_interna = dp.id_interna and  
  (pps.estado = 0)  

 LEFT JOIN #tmpTipoContrato tmp on  
  tmp.nro_documento = dp.nro_documento  

 LEFT JOIN  dbo.vw_desglose_nivelgrado vw on  
  vw.documento = dp.nro_documento  

 LEFT JOIN dbo.vw_desglose_planta dpl on  
  dpl.documento = dp.nro_documento  

 LEFT JOIN dbo.tipo_de_planta ttp on  
  ttp.id = dpl.id_planta  

 LEFT JOIN dbo.tabla_niveles niv on  
  niv.id = vw.id_nivel  

 LEFT JOIN dbo.tabla_grados gra on  
  gra.id = vw.id_grado  
  
 LEFT JOIN dbo.domicilio_personal dom on
  dom.nro_doc = dp.nro_documento
  and dom.id_domicilio = (select max(id_domicilio) from domicilio_personal where nro_doc = dp.nro_documento)  
  
 INNER join dbo.Tabla_Areas TADep       
  ON TADep.id = dbo.Fx_Primer_Nivel_Dependencia_Area (da.Id_Area)  

 LEFT JOIN dbo.legajo_bajas lbaj
   ON lbaj.nro_doc = dp.nro_documento

 WHERE  
  da.id_Area = @idArea  AND
  lbaj.nro_doc is null
-- Agregado FAML 08_01_2010
--	traje desde la consulta de todas las areas, 
--  (para que no salgan los ctros que no tienen ctro vigente)
	and ((ttp.id<>22) or
		((ttp.id=22) and
		dp.nro_documento in 
		(select nro_documento from dbo.ctr_contratos 
		where Aprobado=1 and Baja=0 
		group by nro_documento)))
-- Fin Agregado FAML 08_01_2010
 ORDER BY apellido, nombre  
   
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_DEL_Seleccion_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_DEL_Seleccion_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_DEL_Seleccion_Contratos]
	@documento int
as

declare @id_contrato int


select @id_contrato = id_contrato
from dbo.CTR_Contratos
where baja=0                     
 and nro_contrato = (select max(nro_contrato) 
			from dbo.ctr_contratos c2 
			where c2.nro_documento = @documento 
			and exp_nro is not null) 


DELETE FROM dbo.CTR_Seleccion_Contratos
where Id_Contrato = @Id_Contrato

' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_CTR_Antiguedad_Grado_Reconocidas]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_CTR_Antiguedad_Grado_Reconocidas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE  procedure [dbo].[RPT_CTR_Antiguedad_Grado_Reconocidas]      
 @Documento int,      
 @FechaCorte datetime,
 @IdCertificado int      
AS
SET NOCOUNT ON      
SELECT  Organismo,       
 TFC.Descripcion Cargo,       
 Convert(char(10),Desde, 103) Desde,      
 convert(char(10),Hasta, 103) Hasta,      
 Folio      
--INTO #Tmp      
FROM  dbo.LEG_Servicios_Adm_Publica P      
INNER JOIN dbo.CTR_Antiguedad_Reconocida_Grado AR      
 on AR.Nro_Documento =  P.Doc_Titular AND      
    AR.Id_Antiguedad = P.Id       
INNER JOIN dbo.Tabla_Funciones_Cargos TFC      
 on TFC.Id = P.Cargo      
INNER JOIN dbo.CTR_Antiguedad_Certificados AC
	ON AC.IdCalculo = AR.Id_Calculo
	AND AC.IdCertificado = @IdCertificado
WHERE  AR.Tipo = ''E''AND      
 P.Doc_Titular = @Documento AND       
 AR.FechaCorte = @Fechacorte       
      
UNION all      
      
SELECT  institucion,       
 tfc.descripcion cargo,       
 Convert(char(10),Desde, 103) Desde,      
 convert(char(10),Hasta, 103) Hasta,       
 folio       
FROM dbo.LEG_Otros_Servicios O      
INNER JOIN dbo.Tabla_Funciones_Cargos TFC      
 on TFC.Id = o.Cargo      
INNER JOIN dbo.CTR_Antiguedad_Reconocida_Grado AR      
 on AR.Nro_Documento =  O.Documento AND      
    AR.Id_Antiguedad = O.Id       
INNER JOIN dbo.CTR_Antiguedad_Certificados AC
	ON AC.IdCalculo = AR.Id_Calculo
	AND AC.IdCertificado = @IdCertificado
WHERE  AR.Tipo = ''P'' AND      
 O.Documento = @Documento AND       
 AR.FechaCorte = @Fechacorte       
      
--UNION all      
---- lo dejo para no perder lo de los certif viejos FAML 15/10/2009
--SELECT ''Ingreso Ministerio'',       
-- '''' ,      
-- Convert(char(10),Desde, 103) Desde,      
-- convert(char(10),Hasta, 103) Hasta,      
-- ''99-999/999''       
--FROM dbo.CTR_Antiguedad_Reconocida_Grado  AR      
--INNER JOIN dbo.CTR_Antiguedad_Certificados AC
--	ON AC.IdCalculo = AR.Id_Calculo
--	AND AC.IdCertificado = @IdCertificado
--WHERE  AR.Nro_Documento = @Documento AND       
-- AR.FechaCorte = @Fechacorte AND      
-- AR.Tipo = ''X''

UNION all      
-- lo agrego para que recupere los contratos FAML 15/10/2009
SELECT 
	''Min. Desarrollo Social''
	,CASE ctr.tipo_contrato
		 WHEN 1 THEN ''Contrato (Nivel '' + ctrniv.Nivel + '')'' + ctrtipo.Descripcion
		 WHEN 2 THEN ''Contrato ('' + ctrfunc.Descripcion + '')'' + ctrtipo.Descripcion
		 ELSE ''Contrato MDS''
	END  
		as Cargo
	,Convert(char(10),ctr.Desde, 103) Desde
	,convert(char(10),ctr.Hasta, 103) Hasta
	,''99-999/999''
FROM dbo.CTR_Contratos ctr
INNER JOIN dbo.CTR_Antiguedad_Reconocida_Grado AR      
 on AR.Nro_Documento =  ctr.Nro_Documento AND      
    AR.Id_Antiguedad = ctr.Id_Contrato       
INNER JOIN dbo.CTR_Antiguedad_Certificados AC
	ON AC.IdCalculo = AR.Id_Calculo
	AND AC.IdCertificado = @IdCertificado
	left join dbo.Tabla_Funciones_Contratos ctrfunc
		on ctrfunc.id=ctr.funcion
	left join dbo.Tabla_Niveles ctrniv
		on ctrniv.id=ctr.nivel
	left join dbo.Tabla_Resoluciones_Contratos ctrtipo
		on ctrtipo.id=ctr.tipo_contrato

WHERE AR.Tipo = ''M'' AND      
 ctr.Nro_Documento = @Documento AND       
 AR.FechaCorte = @Fechacorte       



      
select * from #tmp order by cast(desde as datetime)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Primer_Fecha_Nivel_AGU_2]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Primer_Fecha_Nivel_AGU_2]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'                                                  
                                             
create procedure [dbo].[CTR_GET_Primer_Fecha_Nivel_AGU_2]              
	@id_contrato int                
as    
set nocount on          

--Declaracion de variables
DECLARE @nro_doc int, @inicio_contrato datetime, @fin_contrato datetime, 
	@nivel int, @fecha_baja smalldatetime, @inicio_proximo_contrato smalldatetime;


--Seteo inicial de variables:
-- nivel del cual se quiere saber, cuándo fue otorgado por primera vez a la persona.
set @nivel = (select nivel from dbo.ctr_contratos where id_contrato = @id_contrato)
set @nro_doc = (select nro_documento from dbo.ctr_contratos where id_contrato = @id_contrato)


--cursor con contratos y bajas
DECLARE contratos_cursor CURSOR FOR 
	
	SELECT ctr.desde, ctr.hasta, bajas.fecha_baja
	FROM ctr_contratos ctr
	LEFT JOIN ctr_contratos_bajas bajas
		ON ctr.id_contrato = bajas.id_contrato
	WHERE ctr.nro_documento = @nro_doc and ctr.nivel = @nivel 
		and ctr.id_contrato <= @id_contrato and ctr.aprobado = 1
	ORDER BY ctr.desde desc;


--abrir el cursor
OPEN contratos_cursor; 

--leer del cursor, en las variables
FETCH NEXT FROM contratos_cursor INTO @inicio_contrato, @fin_contrato, @fecha_baja

--esto para la primera iteracion.
set @inicio_proximo_contrato = @fin_contrato

--loop sobre el cursor
WHILE @@FETCH_STATUS = 0
BEGIN
	if dbo.fx_son_fechas_cercanas(@inicio_proximo_contrato, @fin_contrato) = 0
	begin
		select  @inicio_proximo_contrato as resultado
		
		--cerrar el cursor y salir
		CLOSE contratos_cursor;	DEALLOCATE contratos_cursor;
		return
	end

	set @inicio_proximo_contrato = @inicio_contrato

	--leer del cursor, en las variables
	FETCH NEXT FROM contratos_cursor INTO @inicio_contrato, @fin_contrato, @fecha_baja
END

--cerrar el cursor
CLOSE contratos_cursor; DEALLOCATE contratos_cursor;

select @inicio_proximo_contrato as resultado
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Primer_Fecha_Nivel_AGU]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Primer_Fecha_Nivel_AGU]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE  procedure [dbo].[CTR_GET_Primer_Fecha_Nivel_AGU]              
	@id_contrato int                
as    

set nocount on          




--Declaracion de variables
DECLARE @id_contrato_actual int, @id_contrato_anterior int, @nro_doc int,
	@desde datetime, @nivel int, @fecha_baja smalldatetime, @fecha_baja_contrato_anterior smalldatetime;




--Seteo inicial de variables:
-- nivel del cual se quiere saber, cuándo fue otorgado por primera vez a la persona.
set @nivel = (select nivel from ctr_contratos where id_contrato = @id_contrato)
set @nro_doc = (select nro_documento from ctr_contratos where id_contrato = @id_contrato)



--cursor sobre los contratos anteriores aprobados, de ese nivel.
--y si tiene la baja, la trae.
DECLARE contratos_cursor CURSOR FOR 
	SELECT 
		ctr.id_contrato, 
		ctr.desde, 
		bajas.fecha_baja
	FROM ctr_contratos ctr
	LEFT JOIN ctr_contratos_bajas bajas
		ON ctr.id_contrato = bajas.id_contrato
	WHERE 
		ctr.nro_documento = @nro_doc 
		and ctr.nivel = @nivel 
		and ctr.id_contrato <= @id_contrato
		and ctr.aprobado = 1
	ORDER BY ctr.desde asc;




--Recorremos el cursor
OPEN contratos_cursor;
FETCH NEXT FROM contratos_cursor 
INTO @id_contrato, @desde, @fecha_baja

select @id_contrato id_contrato, @desde desde, @fecha_baja fecha_baja, ''son el id_contrato, desde, y fecha_baja''

--para el primero, presupongo que existe uno anterior dado de baja
set @fecha_baja_contrato_anterior = @desde

WHILE @@FETCH_STATUS = 0
BEGIN
	--para el primer contrato de la lista
	--si tiene baja
	--y su fecha de baja no es cuando inicio el contrato
	select ''comparando '', @fecha_baja_contrato_anterior, @desde
	if dbo.fx_son_fechas_cercanas(@fecha_baja_contrato_anterior, @desde) = 1
	begin
		--devolver la fecha de inicio de ese primer contrato
		select  @desde as resultado
		CLOSE contratos_cursor;
		DEALLOCATE contratos_cursor;
		return
	end

	set @fecha_baja_contrato_anterior = @fecha_baja
	set @id_contrato_anterior = @id_contrato


	FETCH NEXT FROM contratos_cursor
	INTO @id_contrato, @desde, @fecha_baja;
END

CLOSE contratos_cursor;
DEALLOCATE contratos_cursor;
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CON_CTR_GET_Recepcion_Contrato]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CON_CTR_GET_Recepcion_Contrato]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE  procedure [dbo].[CON_CTR_GET_Recepcion_Contrato]
as
select 	
	rece.Id Id_recepcion,
	perso.Nro_Documento DNI,
	perso.Apellido,
	perso.Nombre,
	rece.Id_Contrato,
	rece.Compro_Recepcion Num_Compro_Rececpion,
	rece.Compro_Recepcion_Fecha Fecha_Recepcion,
	rece.Compro_Recepcion_Usuario Id_usuario_Recepcion,
	usurec.Nombre Usuario_Recepcion,
	rece.Compro_Envio Num_Memo_Envio_a_Secretario,
	rece.Compro_Envio_Fecha Fecha_Envio,
	rece.Compro_Envio_Usuario Id_usuario_Envio,
	usuenv.Nombre Usuario_Envio
from CTR_Recepcion_Contratos rece
	left join dbo.CTR_Contratos ctr
		on ctr.id_contrato=rece.Id_contrato
	Left Join dbo.Datos_Personales perso
		on perso.Nro_Documento = ctr.Nro_Documento
	left join dbo.RH_Usuarios usurec
		on usurec.Id = rece.Compro_Recepcion_Usuario
	left join dbo.RH_Usuarios usuenv
		on usuenv.Id = rece.Compro_Envio_Usuario
order by rece.compro_recepcion
' 
END
GO
/****** Object:  StoredProcedure [dbo].[Web_GetAgentesDeTodaslasAreas]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Web_GetAgentesDeTodaslasAreas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'









-- =============================================  
-- Author:  Agustin  
-- ALTER  date: 27/01/2009  
-- Description: Trae los Agentes de un Area  
-- =============================================  
CREATE           PROCEDURE [dbo].[Web_GetAgentesDeTodaslasAreas]
 
AS
BEGIN  
Declare  @idArea int
Set @idArea = NULL  
--Llena temporal
 SELECT   
  ctr.nro_documento, ctr.monto,   
  case when sendlegajos = 1 then 0 else 1 end Es1184  
  into #tmpTipoContrato  
 FROM  
  dbo.ctr_contratos ctr  
 LEFT JOIN  
  dbo.tabla_resoluciones_contratos res   
  ON  
   ctr.tipo_contrato = res.id  
 LEFT JOIN    
  dbo.tabla_tipos_contratos tipo  
  ON  
   tipo.id = res.tipo_contrato  
 WHERE  
  ctr.aprobado = 1 and  
  ctr.baja = 0  

--- Llena contratosaprobados
--- xxx select Nro_Documento  
--- into #TMP_CTR_Aprobados  
---- FROM exec dbo.CTR_GET_Contratos_Aprobados()


-- DECLARE @CTR_Aprobados TABLE
-- ( DNI int )

-- (select nro_documento 
--		Into #CTR_Aprobados
--		from dbo.ctr_contratos 
--		where Aprobado=1 and Baja=0 
--		group by nro_documento)

---ZZZ

--- xxx  
--Consulta Final

SELECT dp.nro_documento,   
  dp.apellido,   
  dp.nombre,  
  isnull(clin.nro_articulo, clsol.nro_articulo) nro_articulo,   
  isnull(clin.concepto, clsol.concepto) concepto, 
  case when ls.id_interna is null then 0 else 1 end aprobada,
  case when ls.id_interna is null then sweb.desde else ls.desde end desde,
  case when ls.id_interna is null then sweb.hasta else ls.hasta end hasta,
  isnull(pps.id, 0) idPasePendiente,  
  case when tmp.Es1184 = 1 then 1 else 0 end Es1184,  
  isnull(tmp.monto, 0) monto,  
  ttp.Descripcion planta,  
  niv.nivel,  
  gra.grado,
  isnull(dom.telefono,''-'') telefono,
  TADep.Descripcion dependencia,
  dp.id_interna legajo,
  left(dp.Cuil_Nro,2) +''-''+ left(right(dp.Cuil_Nro,9),8) +''-''+ right(dp.Cuil_Nro,1) cuit


 FROM dbo.datos_personales dp  

 INNER JOIN dbo.VW_Desglose_Area da on  
  da.id_interna = dp.id_interna  

 LEFT JOIN dbo.Licencias_Solicitadas ls on  
  dp.id_interna = ls.id_interna and  
  cast(cast(year(getdate())as varchar) + ''-'' + cast(day(getdate())as varchar) + ''-'' + cast(month(getdate())as varchar) as datetime) between ls.desde and ls.hasta  

 LEFT JOIN dbo.tabla_conceptos_licencias clin on  
  clin.id_concepto = ls.concepto  

 LEFT JOIN dbo.Asis_Solicitudes_Licencia_Web sweb on  
  sweb.id_interna = dp.id_interna and  
  cast(cast(year(getdate())as varchar) + ''-'' + cast(day(getdate())as varchar) + ''-'' + cast(month(getdate())as varchar) as datetime)  between sweb.desde and sweb.hasta  
  AND sweb.baja = 0

 LEFT JOIN dbo.tabla_conceptos_licencias clsol on  
  clsol.id_concepto = sweb.concepto  

 LEFT JOIN dbo.PLA_Pases_Solicitados pps on  
  pps.id_interna = dp.id_interna and  
  (pps.estado = 0)  

 LEFT JOIN #tmpTipoContrato tmp on  
  tmp.nro_documento = dp.nro_documento  

 LEFT JOIN  dbo.vw_desglose_nivelgrado vw on  
  vw.documento = dp.nro_documento  

 LEFT JOIN dbo.vw_desglose_planta dpl on  
  dpl.documento = dp.nro_documento  

 LEFT JOIN dbo.tipo_de_planta ttp on  
  ttp.id = dpl.id_planta  

 LEFT JOIN dbo.tabla_niveles niv on  
  niv.id = vw.id_nivel  

 LEFT JOIN dbo.tabla_grados gra on  
  gra.id = vw.id_grado  
  
 LEFT JOIN dbo.domicilio_personal dom on
  dom.nro_doc = dp.nro_documento
  and dom.id_domicilio = (select max(id_domicilio) from domicilio_personal where nro_doc = dp.nro_documento)  
  
 INNER join dbo.Tabla_Areas TADep       
  ON TADep.id = dbo.Fx_Primer_Nivel_Dependencia_Area (da.Id_Area)  

 LEFT JOIN dbo.legajo_bajas lbaj
   ON lbaj.nro_doc = dp.nro_documento

 WHERE  
  --- FAML da.id_Area = @idArea  AND
 lbaj.nro_doc is null 
	and ((ttp.id<>22) or
		((ttp.id=22) and
		dp.nro_documento in 
		(select nro_documento from dbo.ctr_contratos 
		where Aprobado=1 and Baja=0 
		group by nro_documento)))
	



---

	
  ---

 ORDER BY apellido, nombre  
   

END










' 
END
GO
/****** Object:  View [dbo].[VW_DOTACION]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_DOTACION]'))
EXEC dbo.sp_executesql @statement = N'create view [dbo].[VW_DOTACION]

as
	select 	dp.nro_documento,
		dp.apellido,
		dp.nombre,
		dp.id_interna

	from dbo.Datos_personales dp

	--quita las Altas en Tramite
	left join dbo.Ctr_Contratos CTR
		on ctr.id_contrato = (select max(id_contrato) from ctr_contratos where nro_documento = dp.nro_documento and aprobado = 0 and baja = 0 and left(nro_contrato,2) = ''01'')

	--quita Contratos vencidos a la fecha
	left join ctr_contratos CTR2
		on ctr2.id_contrato = 
			(
			select c.id_contrato 
			from ctr_contratos C
			left join ctr_contratos c2
				on c2.nro_documento = c.nro_documento
				and c2.aprobado = 0 and c2.baja = 0
			where c.aprobado = 1 and c.baja = 0 and c.hasta < getdate()
			 and c2.id_contrato is null 	
			and c.nro_documento = dp.nro_documento
			)

	where ((dp.bajalegajos = 0 and visiblelegajos = 1 )or (visiblecontratos = 1 and bajacontratos = 0)) 
		and (ctr.id_contrato is null)	-- Filtra Altas en Tramite
		and (ctr2.id_contrato is null)	-- Filtra Contratos vencidos





'
GO
/****** Object:  StoredProcedure [dbo].[GET_ExperienciasXDNI]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GET_ExperienciasXDNI]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		Agustin
-- ALTER  date: 09/12/2009
-- Description:	Trae todas las experiencias laborales de todas las personas
-- =============================================
CREATE PROCEDURE [dbo].[GET_ExperienciasXDNI] (@DNI int)

AS
BEGIN
	SET NOCOUNT ON;
--dbo.GET_ExperienciasXDNI 29753914


select 
	doc_titular documento, 
	fecha_desde desde, 
	fecha_hasta hasta,
	''E'' tipo
from dbo.LEG_Servicios_Adm_Publica
where @DNI=doc_titular and year(fecha_desde)<2010 and year (fecha_hasta) is not null

union all

select 
	nro_documento documento,
	desde,
	hasta,
	''M'' tipo
from dbo.ctr_contratos
where @DNI=nro_documento and year(desde)<2010
and year (hasta) is not null
union all

select
	documento,
	fecha_desde desde,
	fecha_hasta hasta,
	''P'' tipo
from dbo.leg_otros_servicios
where @DNI=documento and year(fecha_desde)<2010
and year(fecha_hasta ) is not null
union all
select 
	nro_doc documento,
	fecha_min desde,
	getdate() as hasta,
	''M'' tipo
from dbo.designaciones_fechas
where @DNI=nro_doc and year(fecha_min)<2010
and year(fecha_min ) is not null 
order by documento

END

' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_CTR_Antiguedad_Grado]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_CTR_Antiguedad_Grado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'  
CREATE procedure [dbo].[RPT_CTR_Antiguedad_Grado]                            
  @Nro_Documento int,                            
  @id_contrato int = 0,    
  @Id_Certificado int = null    
as  
--NO TOMADAS          
          
SET NOCOUNT ON                        
              
DECLARE @FechaCorte smalldatetime          
             
IF @id_contrato > 0     
BEGIN    
    
 select  @FechaCorte = FechaCorte,          
   @Id_Certificado = IdCertificado          
 from dbo.CTR_Antiguedad_Certificados ac              
 INNER JOIN dbo.CTR_Antiguedad_Reconocida_Grado ar              
  ON ar.id_calculo = ac.IdCalculo               
 where IdContrato = @id_contrato              
  and IdCertificado = (select max(IdCertificado) from CTR_Antiguedad_Certificados 
		where IdContrato = @id_contrato) -- and impreso=1) ME LO DIJO FAML 14/11/2011
    
END    
ELSE    
BEGIN    
    
 select  @FechaCorte = FechaCorte,          
   @Id_Certificado = IdCertificado          
 from dbo.CTR_Antiguedad_Certificados ac              
 INNER JOIN dbo.CTR_Antiguedad_Reconocida_Grado ar              
  ON ar.id_calculo = ac.IdCalculo               
  and IdCertificado = @Id_Certificado    
    
END    
              
        
create table #tempo              
(            
id_contrato int,          
id int,              
tipo char(1),              
lugar varchar(200),              
actividad varchar(100),              
fecha_desde smalldatetime,              
fecha_hasta smalldatetime,              
folio char(10),          
fecha_carga smalldatetime,          
Marca char(1)              
)              
              
                            
-- SERVICIOS ADM PUBLICA              
INSERT INTO #tempo                        
select distinct            
 @id_contrato id_contrato,           
 sap.id,                            
 ''E'' Tipo,                
 Jurisdiccion +'', ''+ Organismo lugar,                
 TFC.Descripcion  Actividad,                
 fecha_desde ,                   
 fecha_hasta ,                        
 folio ,          
 Fecha_Carga,          
 ''''          
FROM dbo.LEG_Servicios_Adm_Publica SAP    
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                            
 ON TFC.Id = SAP.Cargo                            
WHERE  SAP.Doc_Titular = @Nro_Documento AND                            
 DatoDeBaja = 0                             
                          
            
--UNION -- OTROS SERVICIOS                            
                
INSERT INTO #tempo                                    
select distinct           
 @id_contrato id_contrato,                           
 ots.id,            
 ''P'' Tipo,                      
 Institucion lugar,                
 TFC.Descripcion Actividad,                
 fecha_desde ,                   
 fecha_hasta ,                             
 Folio,          
 '''',          
 ''''                      
FROM dbo.LEG_otros_servicios OTS                            
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                            
   ON TFC.Id = OTS.Cargo                            
WHERE OTS.Documento =  @Nro_Documento  AND                             
   DatoDeBaja = 0                             
                        
--UNION                         
                
    -- CONTRATOS DEL MDS FAML 15/10/2009            
INSERT INTO #tempo                      
select distinct          
 @id_contrato id_contrato    
 ,ctr.id_Contrato id    
 ,''M'' Tipo    
 ,''Min. Desarrollo Social'' lugar    
 ,CASE ctr.tipo_contrato    
   WHEN 1 THEN ''Contrato (Nivel '' + ctrniv.Nivel + '')'' + ctrtipo.Descripcion    
   WHEN 2 THEN ''Contrato ('' + ctrfunc.Descripcion + '')'' + ctrtipo.Descripcion    
   ELSE ''Contrato MDS''    
 END      
  as Actividad    
 ,CTR.desde fecha_desde    
 ,CASE ctrbajas.Fecha_Baja    
  WHEN Null THEN convert(char(10),@FechaCorte,103)    
  ELSE case when ctr.Hasta > @FechaCorte     
   THEN convert(char(10),@FechaCorte,103)    
   else convert(char(10),ctrbajas.Fecha_Baja,103)    
   end                 
   END Fecha_hasta                
 ,''99-999/999''    
 ,''''    
 ,''''        
FROM dbo.CTR_Contratos ctr    
 left join dbo.Tabla_Funciones_Contratos ctrfunc    
  on ctrfunc.id=ctr.funcion    
 left join dbo.Tabla_Niveles ctrniv    
  on ctrniv.id=ctr.nivel    
 left join dbo.Tabla_Resoluciones_Contratos ctrtipo    
  on ctrtipo.id=ctr.tipo_contrato    
 left join dbo.CTR_Contratos_Bajas ctrbajas    
  on ctr.nro_documento = ctrbajas.nro_documento and ctr.id_contrato = ctrbajas.id_contrato    
where ctr.aprobado=1 and (ctr.Desde < ctrbajas.Fecha_Baja or ctrbajas.Fecha_Baja is null ) and ctr.Desde < @FechaCorte and ctr.nro_documento = @Nro_Documento     
                  
              
--COMENTADO POR FAML    
--INSERT INTO #tempo                                  
--SELECT            
-- @id_contrato id_contrato,         
-- 999999,          
-- ''M'' Tipo,                 
-- ''Ministerio de Desarrollo Social'' lugar,                                   
-- '''' actividad,              
-- fecha_min fecha_desde ,                 
-- @FechaCorte fecha_hasta ,                             
-- ''00-000/000'' folio ,        
-- '''',        
-- ''''             
--FROM dbo.Designaciones_fechas df                          
--WHERE Nro_Doc  = @Nro_Documento                      
ORDER BY fecha_desde   --GER: 01/11/2007                        
                   
                
declare @fecha_min datetime                                    
set @fecha_min = (select fecha_min from dbo.designaciones_fechas where Nro_Doc = @Nro_Documento)                            
                            
                        
 -- ELIMINA REGISTROS POSTERIORES A LA FECHA DE INGRESO AL MINISTERIO --                                     
-- update #tempo              
-- set fecha_hasta =  @fecha_min - 1              
-- where fecha_hasta > @fecha_min and tipo <> ''M''                          
--                
-- DELETE T                        
-- FROM #tempo T                        
-- WHERE Fecha_Desde >= @Fecha_Min and tipo <> ''M''                      
              
--  update #servicios                            
--  set fecha_hasta =  @fecha_min - 1              
--  where fecha_hasta > @fecha_min and tipo <> ''M''                               
--  DELETE T                        
--  FROM #Servicios T                        
--  WHERE Fecha_Desde >= @Fecha_Min and tipo <> ''M''                          
    
        
update t          
set marca =  case           
   when convert(char(10),t.fecha_carga,112) > convert(char(10),cac.FechaAsignacion,112) then ''X''          
  else           
   ''''          
  end           
FROM #tempo t           
          
INNER JOIN CTR_Antiguedad_Certificados cac          
   ON t.Id_Contrato = cac.IdContrato          
          
where cac.idcertificado = @Id_Certificado          
--PROBABLEMENTE SOBRA => and cac.IdContrato = @id_contrato          
          
        
----------------------------------------------------------------------------------------------      
--ESTAS SON LAS TOMADAS. SE COPIO EL SP "RPT_CTR_Antiguedad_Reconocida_Grado" Y SE PEGO ACA      
----------------------------------------------------------------------------------------------      
  
                            
DECLARE --@Id_Calculo int                       
 @desde_ct char(10),                      
 @hasta_ct char(10),                                        
 @FechaCertificado char(10),                      
 @FechaAsignacion char(10),                  
 @Nivelcert char(5),                  
 @Gradocert char (5),                  
 @Antiguedadcert smallint,                  
 -- @Nro_Documento    int  
 @Marca    int                  
         
                 
IF @id_contrato > 0    
BEGIN    
 select @id_certificado = IdCertificado,                         
  @FechaCertificado = convert(char(10),FechaCertificado,103),                      
  @FechaAsignacion =  convert(char(10),FechaAsignacion,103),                  
  @Nivelcert = Nivel,                  
  @Gradocert = Grado,                  
  @Antiguedadcert = Antiguedad                     
 from dbo.CTR_Antiguedad_Certificados ac                        
 where IdContrato = @id_contrato                        
  and IdCertificado = (select max(IdCertificado) from CTR_Antiguedad_Certificados where IdContrato = @id_contrato)                        
    
 select  @desde_ct = convert(char(10),desde,103),                      
   @hasta_ct = convert(char(10),hasta,103),                  
  @Nro_Documento = Nro_Documento                      
 from ctr_contratos                      
 where id_contrato = @id_contrato      
    
END    
ELSE    
BEGIN           
                 
 select @id_certificado = IdCertificado,                         
  @FechaCertificado = convert(char(10),FechaCertificado,103),                      
  @FechaAsignacion =  convert(char(10),FechaAsignacion,103),                  
  @Nivelcert = Nivel,                  
  @Gradocert = Grado,                  
  @Antiguedadcert = Antiguedad                     
 from dbo.CTR_Antiguedad_Certificados ac                        
 where IdCertificado = @id_certificado    
    
 SET @desde_ct = ''''                      
 SET @hasta_ct = ''''     
    
 select  @Nro_Documento = rc.Nro_Documento    
 from dbo.CTR_Antiguedad_Certificados ac    
  INNER JOIN dbo.CTR_Antiguedad_Reconocida_Grado rc    
   ON ac.idcalculo = rc.Id_Calculo    
 where idcertificado = @id_certificado    
    
END    
    
        
create table #tempo_tomadas                        
(                        
Nro_Documento int,                        
apellido varchar(100),                          
nombre varchar(100),                         
Funcion varchar(100),                         
FechaCorte char(10),          
id_lugar int,                      
tipo char(1),                        
lugar varchar(200),                        
actividad varchar(100),                        
desde char(10),                        
hasta char(10),                        
folio char(10)                  
)                        
              
                        
insert into #tempo_tomadas                        
SELECT  arg.Nro_Documento,                          
 dp.apellido,                          
 dp.nombre,                           
 ac.Funcion,                          
 convert(char(10),arg.FechaCorte,103) FechaCorte,         
 sap.Id,                         
 arg.Tipo,                          
 sap.Jurisdiccion +'', ''+ sap.Organismo lugar,                          
 TFC.Descripcion  Actividad,                          
 convert(char(10),sap.Fecha_Desde,103) Desde,                                
 convert(char(10),sap.Fecha_Hasta,103) hasta,                          
 Folio                         
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                            
                          
INNER JOIN dbo.ctr_antiguedad_certificados AC                            
 ON AC.idCalculo = arg.id_calculo                            
                          
INNER JOIN dbo.datos_personales dp                       
 ON dp.nro_documento = arg.Nro_Documento                          
                          
INNER JOIN dbo.LEG_Servicios_Adm_Publica sap                          
 ON sap.id = arg.Id_Antiguedad                          
                          
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                                      
 ON TFC.Id = SAP.Cargo                             
                          
WHERE   ac.idcertificado = @id_certificado                          
 and arg.Tipo = ''E''                          
                          
                          
-- Lo comenté para que no traiga el ingreso al MDS FAML 15/10/2009                            
                        
--insert into #tempo                          
--SELECT  arg.Nro_Documento,                            
-- dp.apellido,                            
-- dp.nombre,                             
-- ac.Funcion,                            
-- convert(char(10),arg.FechaCorte,103) FechaCorte,           
-- 999999,                           
-- ''M'' Tipo,                            
-- ''Ministerio de Desarrollo Social'' lugar,                            
-- ''''  Actividad,                            
-- convert(char(10),arg.desde,103) Desde,                       
-- convert(char(10),arg.hasta,103) hasta,                            
-- ''00-000/000'' folio                    
--FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                              
--                            
--INNER JOIN dbo.ctr_antiguedad_certificados AC                              
-- ON AC.idCalculo = arg.id_calculo                              
--                            
--INNER JOIN dbo.datos_personales dp                              
-- ON dp.nro_documento = arg.Nro_Documento                            
--                            
--WHERE   ac.idcertificado = @id_certificado                            
-- and arg.Tipo = ''X''                            
                     
---Lo agregue para que traiga los contratos del MDS        
insert into #tempo_tomadas                          
SELECT  arg.Nro_Documento,                            
 dp.apellido,                            
 dp.nombre,                             
 ac.Funcion,                            
 convert(char(10),arg.FechaCorte,103) FechaCorte,           
 ctr.Id_Contrato,                           
 arg.Tipo,                            
 ''Min. Desarrollo Social'' lugar,                            
 CASE ctr.tipo_contrato        
   WHEN 1 THEN ''Contrato (Nivel '' + ctrniv.Nivel + '')'' + ctrtipo.Descripcion        
   WHEN 2 THEN ''Contrato ('' + ctrfunc.Descripcion + '')'' + ctrtipo.Descripcion        
   ELSE ''Contrato MDS''        
 END          
  as Actividad,        
 convert(char(10),ctr.Desde,103) Desde,                                  
 CASE ctrbajas.Fecha_Baja        
   WHEN Null THEN convert(char(10),FechaCorte,103)        
   ELSE convert(char(10),isnull(ctrbajas.Fecha_Baja, arg.FechaCorte),103)        
 END Hasta,        
 ''00-000/000''  
--  ,convert(char(10),@fecha_nivel,103)      
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                              
                            
INNER JOIN dbo.ctr_antiguedad_certificados AC                              
 ON AC.idCalculo = arg.id_calculo                              
                            
INNER JOIN dbo.datos_personales dp                              
 ON dp.nro_documento = arg.Nro_Documento                            
                            
INNER JOIN dbo.CTR_Contratos CTR                            
 ON ctr.id_contrato = arg.Id_Antiguedad                            
         
left join dbo.Tabla_Funciones_Contratos ctrfunc        
  on ctrfunc.id=ctr.funcion        
left join dbo.Tabla_Niveles ctrniv        
  on ctrniv.id=ctr.nivel        
left join dbo.Tabla_Resoluciones_Contratos ctrtipo        
  on ctrtipo.id=ctr.tipo_contrato        
left join dbo.CTR_Contratos_Bajas ctrbajas        
  on ctr.nro_documento = ctrbajas.nro_documento and ctr.id_contrato = ctrbajas.id_contrato        
WHERE   ac.idcertificado = @id_certificado                            
 and arg.Tipo = ''M''        
---HASTA ACA AGREGUE FAML                                 
                           
                        
                        
            
            
insert into #tempo_tomadas                        
SELECT  arg.Nro_Documento,                          
 dp.apellido,                          
 dp.nombre,                           
 ac.Funcion,                          
 convert(char(10),arg.FechaCorte,103) FechaCorte,          
 ots.id,                        
 arg.Tipo,                          
 ots.Institucion lugar,                          
 TFC.Descripcion  Actividad,                          
 convert(char(10),ots.Fecha_Desde,103) Desde,                                
 convert(char(10),ots.Fecha_Hasta,103) hasta,                          
 Folio                         
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg                            
                          
INNER JOIN dbo.ctr_antiguedad_certificados AC                            
 ON AC.idCalculo = arg.id_calculo                            
                          INNER JOIN dbo.datos_personales dp                            
 ON dp.nro_documento = arg.Nro_Documento                          
                          
INNER JOIN dbo.LEG_otros_servicios ots                          
 ON ots.id = arg.Id_Antiguedad                          
                          
INNER JOIN dbo.Tabla_Funciones_Cargos TFC                                      
 ON TFC.Id = ots.Cargo                             
                          
WHERE   ac.idcertificado = @id_certificado                          
 and arg.Tipo = ''P''                         
            
    
----------------------------------------------------------------------------------------------    
--FIN TOMADAS    
----------------------------------------------------------------------------------------------    
    
SELECT           
t.id,          
tipo ,            
lugar ,            
actividad ,            
convert(char(10),fecha_desde,103) desde,            
convert(char(10),fecha_hasta,103) hasta,            
folio ,        
fecha_carga,        
marca        
FROM #tempo t             
WHERE t.id NOT IN (select id_lugar from #tempo_tomadas)          
order by fecha_desde                          
    
    
    
/*    
SELECT           
t.id,          
tipo ,            
lugar ,            
actividad ,            
convert(char(10),fecha_desde,103) desde,            
convert(char(10),fecha_hasta,103) hasta,            
folio ,        
fecha_carga,        
marca        
FROM #tempo t             
WHERE t.id NOT IN (select rg.Id_Antiguedad           
   from CTR_Antiguedad_Certificados cac          
   INNER JOIN CTR_Antiguedad_Reconocida_Grado rg          
   ON cac.idcalculo = rg.id_calculo          
   where cac.IdContrato = @id_contrato)          
order by fecha_desde                          
*/  
                  
  
SET ANSI_NULLS OFF  ' 
END
GO
/****** Object:  StoredProcedure [dbo].[GET_Experiencias]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GET_Experiencias]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 09/12/2009
-- Description:	Trae todas las experiencias laborales de todas las personas
-- =============================================
CREATE PROCEDURE [dbo].[GET_Experiencias]
AS
BEGIN
	SET NOCOUNT ON;

select 
	doc_titular documento, 
	fecha_desde desde, 
	fecha_hasta hasta,
	''E'' tipo
from dbo.LEG_Servicios_Adm_Publica
where DatoDeBaja=0 and datonoimprime=0
union all
select 
	nro_documento documento,
	desde,
	hasta,
	''M'' tipo
from dbo.ctr_contratos
--el anio 2010 hay que modificarlo para cada anio 
--2009 seria 2010 para 2011 seria 2012
where baja=0 and year(desde)<2010
union all
select
	documento,
	fecha_desde desde,
	fecha_hasta hasta,
	''P'' tipo
from dbo.leg_otros_servicios
where  DatoDeBaja=0 and datonoimprime=0
union all
select 
	nro_doc documento,
	fecha_min desde,
	null hasta,
	''M'' tipo
from dbo.designaciones_fechas

order by documento

END



' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_UPD_Asignar_Expediente]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_UPD_Asignar_Expediente]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CTR_UPD_Asignar_Expediente]
	(@Id [int],
	@Exp [varchar](30))
AS
UPDATE dbo.CTR_Contratos  
SET Exp_Nro= @Exp
WHERE  Id_contrato = @id



' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Capacitacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

/****** Object:  StoredProcedure [dbo].[LEG_ADD_Capacitacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Capacitacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[LEG_ADD_Capacitacion]
	(@Jurisdicción_1 	[varchar](50),
	 @Organismo_2 	[varchar](50),
	 @Tema_3 	[varchar](100),
	 @Establecimiento_4 	[varchar](50),
	 @Depende_de_5 	[varchar](50),
	 @Fecha_Desde_6 	[datetime],
	 @Fecha_Hasta_7 	[datetime],
	 @Folio_Nro_8 	[char](10),
	 @Id_Interna_9 	[int],
	@Legajo [int],
	@horas [smallint],
	@Datodebaja bit,
	@datonoimprime bit)

AS

Declare	 @Id_Capacitacion	[int]
SET @Id_Capacitacion = (select max(id_capacitacion)+1 from dbo.Capacitacion)		
IF @Id_Capacitacion is null BEGIN
	SET @Id_Capacitacion =1
END

INSERT INTO [dbo].[Capacitacion] 
	 ( [Jurisdicción],
	 [Organismo],
	 [Tema],
	 [Establecimiento],
	 [DependeDe],
	 [Fecha_Desde],
	 [Fecha_Hasta],
	 [Folio_Nro],
	 [Id_Interna],
	 [Id_Capacitacion],
	doc_titular,
	horas	, DATODEBAJA,
	DATONOIMPRIME) 
 
VALUES 	( @Jurisdicción_1,
	 @Organismo_2,
	 @Tema_3,
	 @Establecimiento_4,
	 @Depende_de_5,
	 @Fecha_Desde_6,
	 @Fecha_Hasta_7,
	 @Folio_Nro_8,
	 @Id_Interna_9,
	 @Id_Capacitacion,
	@legajo,
	@horas, @DATODEBAJA,
	@DATONOIMPRIME )


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Capacitacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Capacitacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[LEG_UPD_Capacitacion]
	(@Jurisdicción_12 	[varchar](50),
	 @Organismo_13 	[varchar](50),
	 @Tema_14 	[varchar](100),
	 @Establecimiento_15 	[varchar](50),
	 @DependeDe_16 	[varchar](50),
	 @Fecha_Desde_17 	[datetime],
	 @Fecha_Hasta_18 	[datetime],
	 @Folio_Nro_19 	[char](10),
	 @Id_Interna_20 	[int],
	 @Id_Capacitacion_21 	[int],
	 @Doc_Titular_22 	[int],
	@horas			[smallint],
	@Datodebaja bit,
	@datonoimprime bit)

AS UPDATE [dbo].[Capacitacion] 

SET  	[Jurisdicción]	 = @Jurisdicción_12,
	[Organismo]	 = @Organismo_13,
	[Tema]	 = @Tema_14,
	[Establecimiento]	 = @Establecimiento_15,
	[DependeDe]	 = @DependeDe_16,
	[Fecha_Desde]	 = @Fecha_Desde_17,
	[Fecha_Hasta]	 = @Fecha_Hasta_18,
	[Folio_Nro]	 = @Folio_Nro_19,
	horas = @horas	,
	datodebaja = @datodebaja,
	datonoimprime = @datonoimprime
WHERE	[Id_Capacitacion]= @Id_Capacitacion_21


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Capacitacion_Id]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Capacitacion_Id]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_GET_Capacitacion_Id]
	@id int,
	@cap int
AS
SELECT 	*
FROM 	dbo.Capacitacion 
WHERE	id_interna= @id and 
	Id_Capacitacion= @cap


' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Capacitacion]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Capacitacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[RPT_LEG_Capacitacion]
	@Id_interna int
as
SELECT	Jurisdicción,
	Organismo,
	Tema,
	Establecimiento,
	DependeDe,
	case when Fecha_Desde = ''01/01/1900'' then
		''''
	else
		convert(char(10),Fecha_Desde,103)
	end Fecha_Desde,
	case when fecha_hasta = ''01/01/1900'' then
		''''
	else
		convert(char(10),Fecha_Hasta,103)
	end Fecha_Hasta
FROM 	dbo.Capacitacion
WHERE 	Id_interna = @id_interna AND
	DatoDeBaja=0 AND
	datonoimprime =0

order by fecha_desde



' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_ADD_Usuarios_Detalles]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_ADD_Usuarios_Detalles]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE    procedure [dbo].[RH_ADD_Usuarios_Detalles]
	@usuario smallint,
	@Sector smallint=null,
	@Apellido varchar(50),
	@Nombre varchar(50),
	@mail varchar(200)=null,
	@Temporal bit,
	@Bloqueo bit,
	@Desbloqueo bit,
	@Web bit
AS
IF exists (SELECT id_usuario FROM dbo.RH_Usuarios_Detalles WHERE id_usuario = @Usuario) BEGIN
	UPDATE dbo.RH_Usuarios_Detalles
	SET	id_sector = @sector,
		apellido = @apellido,
		nombre = @nombre,
		mail = @mail,
		leer_TMP = @Temporal,
		bloqueoLegajo = @Bloqueo,
		DesBloqueoLegajo = @DesBloqueo,
		Acceso_Web = @Web
	WHERE id_usuario = @Usuario
END
ELSE
BEGIN
	INSERT INTO dbo.RH_Usuarios_Detalles
	VALUES (@usuario,
		@sector,
		@apellido,
		@nombre,
		@mail,
		@Temporal,
		@Bloqueo,
		@DesBloqueo,
		@Web)
END

if @web = 0 BEGIN
	UPDATE dbo.RH_Usuarios_Areas_WEB SET baja = 1 WHERE id_Usuario = @usuario
END



' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_ADD_AREAS_USUARIO]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_ADD_AREAS_USUARIO]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'





CREATE procedure [dbo].[RH_ADD_AREAS_USUARIO] 
@usuario int,
@area int,
@solo_web bit = NULL,
@baja bit = NULL
AS

IF @solo_web = 1 
BEGIN

	INSERT INTO [dbo].[RH_USUARIOS_AREAS_WEB] 
	(id_usuario, id_area, baja)
	
	VALUES 
	(@usuario, @area, @baja)

END ELSE BEGIN

	INSERT INTO [dbo].[RH_USUARIOS_AREAS] 
	(id_usuario, id_area)

	VALUES 
	(@usuario, @area)

END


' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_DEL_Areas_Usuario ]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_DEL_Areas_Usuario ]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[RH_DEL_Areas_Usuario ] 
@id_usuario int,
@solo_web bit = NULL
AS

IF @solo_web = 1
BEGIN

	DELETE FROM [dbo].[RH_USUARIOS_AREAS_WEB] 
	WHERE [id_usuario] = @id_usuario

END
ELSE
BEGIN

	DELETE FROM [dbo].[RH_USUARIOS_AREAS] 
	WHERE [id_usuario] = @id_usuario

END


' 
END
GO
/****** Object:  StoredProcedure [dbo].[get_Licencias_Esp_Tomadas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[get_Licencias_Esp_Tomadas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[get_Licencias_Esp_Tomadas] (@id_interna int, @periodo int) AS


SELECT Nro_articulo, TCL.Concepto, Descripcion, desde, hasta, periodo FROM LICENCIAS_SOLICITADAS LS INNER JOIN 
	TABLA_CONCEPTOS_LICENCIAS TCL ON 
		LS.CONCEPTO = TCL.ID_CONCEPTO
	where @periodo between year(Desde) and year(hasta) and id_interna = @id_interna
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CALC_getUsufructosLicencias]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CALC_getUsufructosLicencias]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 19/11/2009
-- Description:	Trae todas las licencias tomadas
-- =============================================
CREATE PROCEDURE [dbo].[CALC_getUsufructosLicencias]
AS
BEGIN
	SELECT id_tabla_autorizacion, desde, hasta, dias_a_tomar
	FROM dbo.licencias_solicitadas
	WHERE concepto = 1
END

' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GetConsulta10cIndividual]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GetConsulta10cIndividual]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ASIS_GetConsulta10cIndividual] 
@id_interna int
AS
BEGIN
	SET NOCOUNT ON;

SELECT

dp.id_interna legajo, dp.nro_documento documento, 
dp.apellido, dp.nombre, ls.desde, 
ls.hasta,
ls.periodo,
datediff (d, ls.desde ,ls.hasta) + 1 dias

FROM dbo.licencias_solicitadas ls
INNER JOIN dbo.datos_personales dp
	ON dp.id_interna = ls.id_interna
WHERE concepto = 4 AND (ls.id_interna = @id_interna)
ORDER BY ls.desde

END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_LicenciasMes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_LicenciasMes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ASIS_GET_LicenciasMes] 
@PrimerDiaDelMes smalldatetime, 
@UltimoDiaDelMes smalldatetime,
@id_interna int

AS
SELECT LS.DESDE, LS.HASTA, TCL.NRO_ARTICULO +''-'' + TCL.CONCEPTO con, TCL.DESCRIPCION, LS.Periodo
FROM dbo.LICENCIAS_SOLICITADAS LS 
INNER JOIN dbo.TABLA_CONCEPTOS_LICENCIAS TCL ON 
LS.CONCEPTO = TCL.ID_CONCEPTO
WHERE ID_INTERNA = @ID_INTERNA
AND (
	  (Desde <= @UltimoDiaDelMes and  Hasta >= @UltimoDiaDelMes )OR 
	  (Desde <= @PrimerDiaDelMes and Hasta >= @PrimerDiaDelMes ) OR 
          (Hasta <= @UltimoDiaDelMes and Desde >= @PrimerDiaDelMes )
  )



' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_FechasOrdinaria]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_FechasOrdinaria]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ASIS_GET_FechasOrdinaria] 
@id_interna int,
@periodo int
AS
select * from dbo.licencias_solicitadas 
where id_interna = @id_interna and periodo = @periodo and (concepto = 1)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_UPD_Licencias]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_UPD_Licencias]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ASIS_UPD_Licencias]
	@id_interna [int],
	@id [int],
	@Tipo [smallint],
	@Concepto  [smallint],
	@Periodo [smallint],
	@Dias_Utilizados [smallint],
	@Desde [smalldatetime],
	@Hasta [smalldatetime], 
	@Autorizo_Descuento [varchar](100) ,
	@Dias_Descuento [varchar](4) ,
	@Goce [smallint],
	@Observaciones [varchar](100) ,
	@DiasATomarAnteriores	 int,
	@id_diagnostico int = null
as
declare @DiasGrabadosAntes int



if @tipo = 0 begin --PENDIENTES

set @DiasGrabadosAntes = (select Dias_A_Tomar from dbo.Licencias_pendientes where ID_INTERNA = @ID_INTERna and id= @id)



   UPDATE [dbo].[Licencias_pendientes]
   SET  [Concepto]=@Concepto,
	[Periodo]=@Periodo, 
	[Dias_A_Tomar]=@Dias_Utilizados,
	[Desde]=@Desde,
	[Hasta]=@Hasta,
	[Autorizo_Descuento]=@Autorizo_Descuento,
	[Dias_Descuento]=@Dias_Descuento,
	[Goce]=@Goce,
	[Observaciones]=@Observaciones
	WHERE ID_INTERNA = @ID_INTERna and id= @id
end



if @tipo = 1 begin --SOLICITADAS
declare @id_auth int


set @DiasGrabadosAntes = (select Dias_A_Tomar from dbo.Licencias_SOLICITADAS WHERE ID_INTERNA = @ID_INTERna and id= @id)
set @Id_Auth = (select Id_Tabla_Autorizacion from dbo.Licencias_SOLICITADAS WHERE ID_INTERNA = @ID_INTERna and id= @id)


   UPDATE [dbo].[Licencias_Solicitadas]
   SET  [Concepto]=@Concepto,
	[Periodo]=@Periodo, 
	[Dias_a_tOMAR]=@Dias_Utilizados,
	[Desde]=@Desde,
	[Hasta]=@Hasta,
	[Autorizo_Descuento]=@Autorizo_Descuento,
	[Dias_Descuento]=@Dias_Descuento,
	[Goce]=@Goce,
	[Observaciones]=@Observaciones
	WHERE ID_INTERNA = @ID_INTERna and id= @id
end
--UPDATE Autorizaciones_licencias set dias_tomados = (dias_tomados - @DiasGrabadosAntes) + @Dias_Utilizados where id = @Id_Auth

--MLD:22-05-07 : SE ANULA POR ERRORRRR EN INSERT NULL EN CAMPO ID
/*
	IF NOT @id_diagnostico IS NULL BEGIN
		IF @id_diagnostico <> -1 BEGIN
			UPDATE dbo.MED_DIAGNOSTICOS_LICENCIAS SET
				id_diagnostico = @id_diagnostico
			WHERE
				id_licencia = @id
		END
	END
*/

' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_AnularSolicitudLicencia]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_AnularSolicitudLicencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
  CREATE PROCEDURE [dbo].[ASIS_AnularSolicitudLicencia]   
  
@pendiente bit,  
@id_solicitud int,  
@id_interna int  
  
AS  

DECLARE @documento int
  
if @pendiente = 0 begin  
  
--DECLARE @Dias int  
--DECLARE @Autorizacion int  
--set @Dias = (Select Dias_A_Tomar from LICENCIAS_SOLICITADAS WHERE ID = @id_solicitud AND id_Interna = @id_interna)  
--set @Autorizacion = (Select Id_Tabla_Autorizacion from LICENCIAS_SOLICITADAS WHERE ID = @id_solicitud AND id_Interna = @id_interna)  

	DELETE FROM dbo.LICENCIAS_SOLICITADAS  
	WHERE ID = @id_solicitud AND id_Interna = @id_interna  

--UPDATE AUTORIZACIONES_LICENCIAS SET Dias_Tomados = Dias_Tomados - @DIAS WHERE id = @Autorizacion  
  
end  
  
if @pendiente =1 begin  
 DELETE FROM LICENCIAS_PENDIENTES  
 WHERE ID = @id_solicitud AND id_Interna = @id_interna  
end  




	--BORRO LA LICENCIA ASIGNADA EN MEDICO SI EXISTE
	SET @documento = (SELECT nro_documento FROM datos_personales WHERE id_interna = @id_interna)

	IF (SELECT count(*) FROM MED_Atenciones WHERE IdLicencia = @id_solicitud and  Nro_Documento = @documento) > 0 
	BEGIN
		UPDATE MED_Atenciones
		SET IdLicencia = 0
		WHERE IdLicencia = @id_solicitud and  Nro_Documento = @documento
	END

' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Interrpciones_Licencias]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Interrpciones_Licencias]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE   procedure [dbo].[ASIS_GET_Interrpciones_Licencias]
	@IdUsuario smallint=Null
AS
SELECT 	IL.Documento,
	convert(char(10),IL.Fecha,103) Fecha,
	Apellido +'', ''+	Nombre  Agente,
	TCL.Descripcion Concepto
	
FROM dbo.ASIS_Interrupcion_Licencias IL
INNER JOIN dbo.Datos_Personales DP
	on DP.nro_Documento = IL.Documento

INNER JOIN dbo.VW_Desglose_Area DA
	on DA.Id_Interna = DP.Id_Interna

INNER JOIN dbo.RH_Usuarios_Areas UA
	on (UA.Id_Usuario = @IdUsuario or @IdUsuario IS NULL) AND
	   (UA.Id_Area = DA.Id_Area or Ua.id_area = 0)

INNER JOIN dbo.Licencias_Solicitadas LS
	on LS.Id_Interna = DP.Id_Interna AND
	IL.Fecha BETWEEN LS.Desde and LS.Hasta
INNER JOIN dbo.Tabla_Conceptos_Licencias TCL
	on TCL.Id_Concepto = LS.Concepto		


' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_PisaLicencia]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_PisaLicencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[ASIS_GET_PisaLicencia]
 @id_Interna int,      
 @Desde smalldatetime=NULL,      
 @Hasta smalldatetime=NULL,  
 @Concepto smallint=NULL,  
 @idLicencia int=NULL --Esto es para la modificacion porque me toma la misma licencia que se pisa.
     
AS
IF @desde is NULL BEGIN Set @Desde = convert(char,getdate(),103) END      
IF @Hasta is NULL BEGIN SET @hasta = convert(char,getdate(),103) END      
      

IF (@concepto = 1) --9A
BEGIN  
  
 --SI ES VACACIONES TRAIGO TODAS  
 SELECT  LS.*,       
  TCL.DESCRIPCION,       
  (TCL.Nro_Articulo +''-''+ tcl.Concepto) Abreviatura    
 FROM LICENCIAS_SOLICITADAS LS      
  INNER JOIN TABLA_CONCEPTOS_LICENCIAS TCL        
   ON LS.CONCEPTO = TCL.ID_CONCEPTO      
 WHERE LS.ID_INTERNA = @id_Interna   
  AND (((@Desde BETWEEN LS.DESDE AND LS.HASTA) OR (@Hasta BETWEEN LS.DESDE AND LS.HASTA))        
   OR (@Desde <= LS.DESDE AND @Hasta >= LS.HASTA))   
--  AND LS.FH_FIN_ANTES_INTERR IS NULL  
  AND (LS.id <> @idLicencia or @idLicencia is null)
    
END  
ELSE  
BEGIN  
  
 --SI NO ES VACACIONES TRAIGO TODAS MENOS LAS VACACIONES PARA QUE SE INTERRUMPAN DESPUES EN OTRO SP SI ES NECESARIO 
 SELECT  LS.*,       
  TCL.DESCRIPCION,       
  (TCL.Nro_Articulo +''-''+ tcl.Concepto) Abreviatura    
 FROM LICENCIAS_SOLICITADAS LS      
  INNER JOIN TABLA_CONCEPTOS_LICENCIAS TCL        
   ON LS.CONCEPTO = TCL.ID_CONCEPTO      
 WHERE LS.ID_INTERNA = @id_Interna   
  AND (((@Desde BETWEEN LS.DESDE AND LS.HASTA) OR (@Hasta BETWEEN LS.DESDE AND LS.HASTA))        
   OR (@Desde <= LS.DESDE AND @Hasta >= LS.HASTA))   
--  AND LS.FH_FIN_ANTES_INTERR IS NULL  
  AND (LS.concepto <> 1 and LS.concepto <> 6)--no traigo el 9A o 10 E porque si se pisa la tengo que interrumpir.  
  and (LS.id <> @idLicencia or @idLicencia is null)
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[Web_GetPisaLicencia]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Web_GetPisaLicencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		Agustin
-- Create date: 29/01/2009
-- Description:	Devuelve las licencias que se pisan con el periodo recibido.
-- =============================================
CREATE PROCEDURE [dbo].[Web_GetPisaLicencia]
	@nro_documento int, @desde datetime, @hasta datetime
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	select 
		Id, ''Aprobada'' Aprobada 
	from
		dbo.licencias_solicitadas ls
	inner join 
		dbo.datos_personales dp on
		dp.id_interna = ls.id_interna
	where 
		nro_documento = @nro_documento and
		(
			desde between @desde and @hasta or
			@desde between desde and hasta
		)

	union all

	select 
		Id, ''Solicitada'' Aprobada 
	from
		dbo.asis_solicitudes_licencia_web
	where 
		id_interna = 
				(select 
					id_interna 
				from	
					dbo.datos_personales
				where
					nro_documento = @nro_documento 
				)
		and
		(
			desde between @desde and @hasta or
			@desde between desde and hasta
		)
		and baja = 0


END' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GetLicencias_X_Id_Licencia]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GetLicencias_X_Id_Licencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[ASIS_GetLicencias_X_Id_Licencia]
	@id [int]

as 

Select L.desde, L.Hasta, L.Periodo, TCL.Descripcion DescLicencia 
from dbo.licencias_solicitadas L
inner join tabla_conceptos_licencias TCL
	on TCL.id_concepto = L.concepto
where L.id = @id
	




' 
END
GO
/****** Object:  StoredProcedure [dbo].[Web_GetLicenciasTomadasEnElAnio]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Web_GetLicenciasTomadasEnElAnio]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 15/04/2009
-- Description:	Trae todas las licencias de un concepto para una persona en un año determinado
-- Se usa para calcular el saldo de ese concepto para una persona.
-- =============================================
CREATE PROCEDURE [dbo].[Web_GetLicenciasTomadasEnElAnio]
	-- Add the parameters for the stored procedure here
	@documento int,
	@periodo int,
	@idConcepto int
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	SELECT desde, hasta
	FROM dbo.licencias_solicitadas 
	WHERE 
		concepto = @idConcepto and
		id_interna = (select id_interna from dbo.datos_personales where nro_documento = @documento)
		and @periodo between (year(desde)) and year(hasta)

END' 
END
GO
/****** Object:  View [dbo].[VW_LIC_ESP_TOMADAS]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_LIC_ESP_TOMADAS]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_LIC_ESP_TOMADAS]
AS
select id_interna, año, lic_esp_dias, concepto_licencia, id_autorizacion, Fecha_inicio,Fecha_fin from licencias union
select id_interna, Periodo, Dias_A_Tomar, Concepto, id_tabla_autorizacion, Desde, Hasta from licencias_solicitadas

'
GO
/****** Object:  StoredProcedure [dbo].[MED_GET_Atenciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_Atenciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[MED_GET_Atenciones]                                              
  @Nro_Documento int                                          
AS                                          
SELECT  DISTINCT                                      
 TCL.Nro_Articulo + '' '' + upper(TCL.Concepto) Licencia,                                    
 MA.Id,                                          
 convert(char(10),FechaAtencion,103) Fecha,                                          
 isnull(MA.IdDiagnostico,'''') IdDiagnostico,                            
 isnull(TMD.Codigo,'''') CodigoDiagnostico,                            
 isnull(TMD.Descripcion,'''') Diagnostico,                                          
  CASE WHEN MANA.IdAtencion IS NULL THEN                                          
   ''No''                                          
  ELSE                                          
   ''Si''                                          
  END SolicitoAnalisis,                                          
  CASE WHEN MAP.IdPractica IS NULL THEN                                          
   ''No''                                          
  ELSE                                          
   ''Si''                                          
  END RealizoPracticas,                                          
  CASE WHEN MA.IdLicencia IS NULL OR MA.IdLicencia = 0 THEN                                          
   ''No''                                          
  ELSE                                          
   ''Si''                                          
  END OtorgoLicencia,                                          
  CASE WHEN MA.ConsultorioExterno = 0 THEN                                          
   ''No''                                          
  ELSE                                          
   ''Si''                                          
  END ConsultorioExterno,                                     
  CASE WHEN MA.regresa = 0 THEN                                          
   ''No''                                          
  ELSE                                          
   ''Si''                                          
  END regresa,                  
 CASE WHEN MA.regreso = 0 THEN                                          
   ''No''                                          
  ELSE                                          
   ''Si''                                          
  END regreso,                  
                                           
 MA.FechaAtencion,                
 MA.VolverEnDias Dias_Tomados,                                     
 MA.Observaciones,                              
 LS.Desde desde_licencia,                              
 LS.Dias_A_Tomar dias_licencia,                              
 LS.Hasta hasta_licencia,        
 CASE WHEN ma.fecha_parto IS NULL THEN                                          
   ''''                                          
  ELSE                                          
    CASE WHEN convert(datetime,ma.fecha_parto) > convert(datetime,getdate()) THEN   
  ''EMBARAZADA''  
 ELSE  
  ''''   
 END                                          
  END embarazo,        
    
 CASE WHEN convert(datetime,ma.fecha_parto) > convert(datetime,getdate())  THEN   
  ma.fecha_parto  
 ELSE  
  ''''   
 END fecha_parto  
                    
FROM dbo.MED_Atenciones  MA                                             
LEFT JOIN dbo.Tabla_Medicos_Diagnosticos TMD                                          
 ON TMD.Codigo = MA.IdDiAgnostico                          
LEFT JOIN dbo.MED_Analisis MANA                                          
 ON MANA.IdAtencion = MA.ID                                          
LEFT JOIN dbo.MED_Atenciones_Practicas MAP                                          
 ON MAP.IdAtencion = MA.Id                                        
LEFT JOIN dbo.Licencias_Solicitadas LS                                    
 ON LS.Id = MA.IdLicencia                                    
LEFT JOIN dbo.Tabla_Conceptos_Licencias TCL                                    
 ON TCL.id_Concepto = LS.Concepto                            
                                    
WHERE  MA.Nro_Documento = @Nro_Documento AND MA.Baja=0                      
                    
ORDER BY FechaAtencion Desc ' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Cardex_Solicitadas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Cardex_Solicitadas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ASIS_GET_Cardex_Solicitadas] 
@FECHA int,
@id_interna int
AS
SELECT DESDE, NRO_ARTICULO, TCL.CONCEPTO, HASTA , ''ls'' TIPO FROM dbo.LICENCIAS_SOLICITADAS LS 
INNER JOIN 
dbo.TABLA_CONCEPTOS_LICENCIAS TCL ON LS.Concepto = tcl.id_concepto
WHERE (@FECHA BETWEEN YEAR(DESDE) AND YEAR(HASTA))
AND id_interna = @id_interna

UNION all

select LI.FECHA_INICIO DESDE, NRO_ARTICULO, TCL.CONCEPTO, LI.FECHA_FIN HASTA, ''li'' TIPO
FROM dbo.LICENCIAS LI
INNER JOIN dbo.TABLA_CONCEPTOS_LICENCIAS TCL ON 
LI.Concepto_LICENCIA = tcl.id_concepto
WHERE (@FECHA BETWEEN YEAR(FECHA_INICIO) AND YEAR(FECHA_FIN))

ORDER BY DESDE

' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GetConsulta10c]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GetConsulta10c]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ASIS_GetConsulta10c] 
@fecha smalldatetime 
AS
BEGIN
	SET NOCOUNT ON;

SELECT

dp.id_interna legajo, dp.nro_documento documento, 
dp.apellido, dp.nombre, ls.desde, 
case 
	when ls.hasta > @fecha then	@fecha
	else ls.hasta
end hasta,
ls.hasta hastaFormulario,

ls.periodo ,
datediff (d, ls.desde ,case 
	when ls.hasta > @fecha then	@fecha
	else ls.hasta
end) + 1 dias

FROM dbo.licencias_solicitadas ls
INNER JOIN dbo.datos_personales dp
	ON dp.id_interna = ls.id_interna
WHERE concepto = 4 AND desde <= @fecha
ORDER BY ls.id_interna, ls.desde

END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_DEL_Embarazadas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_DEL_Embarazadas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[MED_DEL_Embarazadas]             
 @IdEmbarazo  int  
AS            

DECLARE @Id int
DECLARE @Nro_Documento int
DECLARE @id_interna int
DECLARE @IdLicencia int


select	@Nro_Documento = Nro_Documento, 
		@IdLicencia = IdLicencia 
from MED_Embarazadas
where Id = @IdEmbarazo

DELETE FROM dbo.LICENCIAS_SOLICITADAS    
WHERE ID = @IdLicencia --AND id_Interna = @id_interna    

UPDATE dbo.MED_Embarazadas             
SET Baja = 1,
	IdLicencia = null
WHERE Id = @IdEmbarazo

' 
END
GO
/****** Object:  View [dbo].[WEB_Licencias_Activas]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[WEB_Licencias_Activas]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[WEB_Licencias_Activas]

as
SELECT	id_interna,
	concepto,
	desde,
	hasta 
FROM licencias_solicitadas
WHERE getdate() between desde and hasta

'
GO
/****** Object:  View [dbo].[VW_LIC_ORD_TOMADAS]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_LIC_ORD_TOMADAS]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[VW_LIC_ORD_TOMADAS]
AS
select id_interna, lic_ord_año, lic_ord_dias, concepto_licencia, id_autorizacion from licencias  union 
select id_interna, Periodo, Dias_A_Tomar, Concepto, id_tabla_autorizacion from licencias_solicitadas


'
GO
/****** Object:  StoredProcedure [dbo].[MED_GET_Licencia]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_Licencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[MED_GET_Licencia]  
 @IdLicencia int  
AS  
SELECT CL.Nro_Articulo,  
 upper(CL.Concepto) Concepto,  
 CL.Descripcion,  
 convert(char(10),LS.Desde,103) Desde,  
 convert(Char(10),LS.Hasta,103) Hasta  
FROM dbo.Licencias_Solicitadas LS  
INNER JOIN dbo.Tabla_Conceptos_Licencias CL  
 ON CL.Id_Concepto = Ls.Concepto  
WHERE Ls.Id = @IdLicencia  
' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Dias_Licencia_Mes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Dias_Licencia_Mes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[ASIS_GET_Dias_Licencia_Mes]
	@Concepto smallint,
	@Id_interna int,
	@Mes smallint,
	@Año smallint
AS
SELECT	count(Dias_a_Tomar) DiasTomados
FROM 	dbo.Licencias_Solicitadas
WHERE 	(Concepto = @Concepto) AND
	(ID_interna = @Id_Interna) AND
	(
	month(desde) = @mes and year(desde) = @Año or
	month(hasta) = @mes and year(hasta) = @año 
	)
	




' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_GET_Falta_Regresar]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_Falta_Regresar]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[MED_GET_Falta_Regresar]                
  @Nro_Documento int = null                
AS                                        
SELECT                 
 dp.Nro_Documento,                
 dp.Id_Interna,                
 dp.Apellido,                
 dp.Nombre,                
 MA.Id,                   
 TCL.Nro_Articulo + '' '' + upper(TCL.Concepto) Articulo,                               
 convert(char(10),MA.FechaAtencion,103) Fecha_Atencion,                                           
 LS.Dias_A_Tomar Dias_Licencia,                            
 datediff(day,getdate(),LS.Hasta) Regresa_En,  
 LS.Desde Desde_Licencia,      
 LS.Hasta Hasta_Licencia,         
 LS.Informo            
                                        
FROM dbo.MED_Atenciones  MA                                           
                                   
--LEFT JOIN dbo.Tabla_Medicos_Diagnosticos TMD                                          
-- ON TMD.id = MA.IdDiAgnostico                          
--LEFT JOIN dbo.MED_Analisis MANA                                          
-- ON MANA.IdAtencion = MA.ID                                          
--LEFT JOIN dbo.MED_Atenciones_Practicas MAP                                          
-- ON MAP.IdAtencion = MA.Id                                        
LEFT JOIN dbo.Licencias_Solicitadas LS                                    
 ON LS.Id = MA.IdLicencia                                    
LEFT JOIN dbo.Tabla_Conceptos_Licencias TCL                                    
 ON TCL.id_Concepto = LS.Concepto                                                    
INNER JOIN dbo.datos_personales dp                
 ON dp.nro_documento = MA.nro_documento                
          
WHERE  (MA.Nro_Documento = @Nro_Documento OR @Nro_Documento is null)                
  AND MA.Baja=0                
  AND MA.regresa = 1                
  AND MA.regreso = 0    
  AND datediff(day,getdate(),LS.Hasta) <= 0    
    
ORDER BY LS.Hasta DESC' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_LicTomadoasNoGeneranOrd ]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_LicTomadoasNoGeneranOrd ]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ASIS_GET_LicTomadoasNoGeneranOrd ] 
@ID_INTERNA INT,
@PERIODO INT

AS

SELECT SUM(DATEDIFF(D, DESDE, HASTA) + 1) dias_ausencia 
FROM LICENCIAS_SOLICITADAS LS
INNER JOIN TABLA_CONCEPTOS_LICENCIAS TC
	ON TC.ID_CONCEPTO = LS.CONCEPTO
WHERE ID_INTERNA = @ID_INTERNA AND PERIODO = @PERIODO AND (TC.GENERADERECHOORDINARIA = 0 OR GOCE=3)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CON_MED_Atenciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CON_MED_Atenciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CON_MED_Atenciones]  
 @DesdeAtencion smalldatetime = NULL,  
 @HastaAtencion smalldatetime = NULL  
AS  
SELECT MA.Nro_Documento,  
 DP.Apellido +'', ''+ DP.Nombre Agente,  
 CONVERT(Char(10),FechaAtencion,103) FechaAtencion,  
 TCL.Nro_Articulo +'' ('' + upper(TCL.Concepto) + '') '' + TCL.Descripcion LicenciaConcepto,  
 CONVERT(Char(10),LS.Desde,103) LicenciaDesde,  
 CONVERT(Char(10),LS.Hasta,103) LicenciaHasta,  
 CASE WHEN MA.ConsultorioExterno = 0 THEN  
  ''No''  
 ELSE  
  ''Si''  
 END ConsultorioExterno  
   
FROM  dbo.MED_Atenciones MA  
INNER JOIN dbo.Datos_Personales DP  
 ON DP.Nro_Documento = MA.Nro_Documento  
LEFT JOIN dbo.Licencias_Solicitadas LS  
 ON LS.Id = MA.IdLicencia  
LEFT JOIN dbo.Tabla_Conceptos_Licencias TCL  
 on TCL.Id_Concepto = LS.Concepto  
   
  
WHERE  ((FechaAtencion between @DesdeAtencion AND @HastaAtencion) OR (@DesdeAtencion IS NULL AND @HastaAtencion IS NULL)) AND  
 (MA.Baja =0 )  
  ' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Parte_Diario_Asistencias]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Parte_Diario_Asistencias]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ASIS_GET_Parte_Diario_Asistencias]
@area int,
@fecha smalldatetime


AS

SELECT DP.Nro_Documento, DP.Apellido, DP.Nombre, MAX(DA.Desde) DESDE, LS.Id Id_Licencia, TCL.Nro_Articulo + '' - '' + TCL.Concepto Asistencia, TCL.Descripcion, LS.Desde, LS.Hasta
FROM dbo.LEG_DESGLOSE_AREA DA
INNER JOIN dbo.Datos_Personales DP ON
	DP.Id_interna = DA.Id_Interna
LEFT JOIN dbo.Licencias_Solicitadas LS ON
	DA.Id_Interna = LS.Id_Interna
	AND @fecha BETWEEN LS.Desde AND LS.Hasta
LEFT JOIN dbo.Tabla_conceptos_licencias TCL ON
	LS.concepto = TCL.id_concepto
WHERE DA.id_area = @area and DA.DESDE <= @fecha
GROUP BY DP.Nro_Documento, DP.Nombre, DP.Apellido, LS.Id, LS.Concepto, TCL.Nro_Articulo, TCL.Concepto, TCL.Descripcion, LS.Desde, LS.Hasta



' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_UPD_Informa_Licencia_Liquidacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_UPD_Informa_Licencia_Liquidacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[ASIS_UPD_Informa_Licencia_Liquidacion]    
@Id_Licencia int,    
@usuario smallint    
as    
    
UPDATE Licencias_solicitadas    
set informo_a_liquidacion = 1,    
 informo_Fecha = getdate(),    
 informo_usuario = @usuario    
where id = @Id_Licencia    ' 
END
GO
/****** Object:  StoredProcedure [dbo].[MNS_GET_Asignables]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MNS_GET_Asignables]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[MNS_GET_Asignables]  
AS  
SELECT  U.Id_Usuario,  
 U.Apellido +'', ''+ U.Nombre Nombre  
FROM dbo.MNS_Asignables A  
INNER JOIN dbo.RH_Usuarios_Detalles U  
 ON U.Id_Usuario = A.Id_Usuario  
  
ORDER BY Apellido, Nombre




' 
END
GO
/****** Object:  StoredProcedure [dbo].[MNS_GET_Usuarios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MNS_GET_Usuarios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[MNS_GET_Usuarios]
	@Id_Usuario smallint=NULL
AS

SELECT A.Id_Usuario, U.Nombre, A.VerTodos

FROM dbo.MNS_Asignables A
INNER JOIN dbo.RH_Usuarios U
	ON U.Id = A.Id_Usuario
WHERE (A.Id_Usuario = @Id_Usuario OR @Id_Usuario IS NULL)



' 
END
GO
/****** Object:  StoredProcedure [dbo].[MNS_ADD_Usuarios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MNS_ADD_Usuarios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[MNS_ADD_Usuarios]
	@Id_Usuario smallint,
	@Administrador bit = 0

AS



INSERT INTO dbo.MNS_Asignables
VALUES (@Id_Usuario, @Administrador)




' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_ADD_ObservacionesPA]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_ADD_ObservacionesPA]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[MED_ADD_ObservacionesPA]  
 @nro_documento int,  
 @ObservacionesPA text  
as  

DELETE FROM dbo.MED_ObservacionesPA 
WHERE Nro_Documento = @nro_documento
  
INSERT INTO dbo.MED_ObservacionesPA 
VALUES (@nro_documento, @ObservacionesPA)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_GET_ObservacionesPA]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_ObservacionesPA]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create  procedure [dbo].[MED_GET_ObservacionesPA]  
 @nro_documento int  
as  

SELECT	Nro_Documento,
		ObservacionesPA 
FROM dbo.MED_ObservacionesPA 
WHERE Nro_Documento = @nro_documento

' 
END
GO
/****** Object:  View [dbo].[VW_tabla_fam_escolaridad]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_tabla_fam_escolaridad]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_tabla_fam_escolaridad]
AS
SELECT  *
FROM tabla_fam_escolaridad


'
GO
/****** Object:  StoredProcedure [dbo].[LIQ_GET_Tabla_Limite_Tarjeta_Banco]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_GET_Tabla_Limite_Tarjeta_Banco]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[LIQ_GET_Tabla_Limite_Tarjeta_Banco]

as

select * from Tabla_Limite_Tarjeta_Banco
where baja = 0

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CGet_NroContrato]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CGet_NroContrato]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[CGet_NroContrato]

@doc int

AS

select max(nro_contrato) nro_contrato, max(desde) desde, max(hasta) hasta,estado,ttc.sendlegajos,tipo_contrato,dp.send_legajos
from ccontrato c

left join tabla_tipos_contratos ttc
	on ttc.id=c.tipo_contrato

left join cdatos_personales dp
	on dp.legajo=c.legajo

where c.legajo=@doc
group by estado,ttc.sendlegajos,tipo_contrato,dp.Send_Legajos

order by nro_contrato desc
' 
END
GO
/****** Object:  StoredProcedure [dbo].[Cget_contrato]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Cget_contrato]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[Cget_contrato] 

@doc int,
@cont varchar (15)

AS
select c.*, 
	tc.descripcion Resolucion

from ccontrato c

left join dbo.Tabla_Tipos_Resoluciones TC
	on TC.id = c.tipo_contrato

where legajo=@doc and nro_contrato=@cont

' 
END
GO
/****** Object:  StoredProcedure [dbo].[Cmodif_dep_contrato]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Cmodif_dep_contrato]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[Cmodif_dep_contrato] 

@dep int,
@sec int,
@firma int,
@id int

AS

update ccontrato set Id_Area=@dep,  ID_Secretaria=@sec, Firmado=@firma

where id=@id 


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CON_CTR_Antiguedad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CON_CTR_Antiguedad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[CON_CTR_Antiguedad]
	@legajo int
as
select desde,hasta from ccontrato
where legajo = @legajo
order by desde


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CMarca_Impresos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CMarca_Impresos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CMarca_Impresos]

@legajo int,
@id int

AS

update ccontrato set 
	impreso=1
	 
where legajo=@legajo and id=@id
' 
END
GO
/****** Object:  StoredProcedure [dbo].[C_Exportar_Txt_Bco]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[C_Exportar_Txt_Bco]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[C_Exportar_Txt_Bco]
	@id int
as

select 	nb.nro_cta_empresa,
	dp.apellido,
	dp.nombre,
	case when dp.tipo_doc=1 or dp.tipo_doc=2 or dp.tipo_doc=3 then 
		''001''
	else
		case when dp.tipo_doc=4 then
			''004''
		else
			''Corregir Tipo_Doc''
		end
	end Tipo_Doc,

	dp.legajo,
	case when dp.tipo_doc=1 or dp.tipo_doc=2 or dp.tipo_doc=3 then 
		''00''
	else
		case when dp.tipo_doc=4 then
			''04''
		else
			''Corregir Prov_doc''
		end
	end Prov_Doc,

	case when dp.nacionalidad=1 then
		''A''
		else
		''E''
	end Nacionalidad,


	right(convert(char(8),dp.fecha_nac,112),2) + left(right(convert(char(8),dp.fecha_nac,112),4),2) + left(convert(char(8),dp.fecha_nac,112),4) fecha_nacimiento,

	case when dp.sexo=1 then
		''M''
		else
		''F''
	end Sexo,

	case when dp.estado_civil=1 or dp.estado_civil=7 then
		''S''
		else
		case when dp.estado_civil=2 or dp.estado_civil=5 or dp.estado_civil=6 then
			''C''
			else
			case when dp.estado_civil=3  then
				''V''
			else
			case when dp.estado_civil=4  then
				''D''
			end
		end
	end

	end estado_civil,
	--max(dom.id_domicilio) Id_dom,

	dom.calle,
	dom.Nro ,
	dom.ppiso Piso,
	dom.dpto,
	l.nombrelocalidad Localidad,
	dom.cp,	
	
	p.cod_bco as Cod_Prov,	
	nc.tipo_cta,
	nc.cia,
	dp.cuit,
	nc.sueldo,
	db.codigo_dependencia Cod_Dep,
	db.codigo_postal CP_Dep,
	db.id_area,
	--(select min(desde) from ccontrato where legajo = dp.legajo) desde
	right(convert(char(8),(select min(desde) from ccontrato where legajo = dp.legajo),112),2) + left(right(convert(char(8),(select min(desde) from ccontrato where legajo = dp.legajo),112),4),2) + left(convert(char(8),(select min(desde) from ccontrato where legajo = dp.legajo),112),4) Fecha_Ingreso

from cdatos_personales dp
 
inner join cDomicilio Dom
	on dp.legajo=dom.legajo 

inner join cnro_cuenta NC
	on nc.legajo=dp.legajo

inner join localidadesafip L
	on L.idlocalidad=dom.id_localidad

inner join provincias p
	on p.codafip=l.id_provincia and l.codigopostal=dom.cp

inner join ccontrato cc
	on dp.legajo=cc.legajo and hasta = (select max(hasta) from ccontrato where legajo = dp.legajo)

inner join tabla_areas_detalle db
	on db.id_area = cc.id_area

inner join tabla_nomina_bancos NB
	on nb.codigo=nc.id_banco

where nc.id=@id

' 
END
GO
/****** Object:  View [dbo].[VW_CTodos_Traspaso]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CTodos_Traspaso]'))
EXEC dbo.sp_executesql @statement = N'

CREATE view [dbo].[VW_CTodos_Traspaso]
as
select c.legajo,dp.apellido,dp.nombre,c.nro_contrato
from ccontrato c

inner join cdatos_personales dp
	on dp.legajo=c.legajo

where c.aprobado=1 and c.baja=0 and dp.send_legajos=0



'
GO
/****** Object:  StoredProcedure [dbo].[CGet_Facturas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CGet_Facturas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CGet_Facturas]

@doc int

as
select f.id, f.nro_factura,f.legajo, f.id_contrato, cdp.cuit, f.mes_factura, f.año_factura, f.fecha_factura, f.fecha_recibida, f.fecha_pase, f.nro_resolucion, f.acto_tipo, f.monto, f.anulada, cdp.apellido, cdp.nombre, f.id_area, f.id_secretaria, f.id_firma, c.desde,c.hasta from cfacturas f

inner join cdatos_personales cdp
	on cdp.legajo=f.legajo	

inner join ccontrato c
	on c.id=f.id_contrato

where f.legajo=@doc and anulada=0 

order by año_factura desc , mes_factura desc
' 
END
GO
/****** Object:  StoredProcedure [dbo].[SEG_Buscar_por_Apellido]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[SEG_Buscar_por_Apellido]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[SEG_Buscar_por_Apellido]
	@Apellido varchar(50),
	@Documento int=null
as
if @documento is null begin
	--LEGAJOS
	select apellido,nombre,nro_documento,''L'' tipo from dbo.datos_personales
	where apellido like @apellido +''%'' and id_interna 
	not in (select id_Interna from dbo.legajo_bajas)
	
	union all
	
	--CONTRATOS
	select apellido,nombre,dp.legajo,''C'' from cdatos_personales dp
	inner join dbo.ccontrato cct on 
		cct.Legajo = dp.legajo
	inner join dbo.tabla_resoluciones_contratos ta  on
		ta.id = cct.tipo_contrato
	inner join dbo.tabla_tipos_contratos ttc on
		ttc.id = ta.tipo_contrato
	where 	send_legajos = 0 and 
		apellido like @apellido + ''%''
		and aprobado = 1
		and ttc.sendlegajos=1
		and cct.baja=0
	order by apellido, nombre
end
else
	--LEGAJOS
	select apellido,nombre,nro_documento,''L'' tipo 
	from dbo.datos_personales
	where nro_documento = @documento and id_interna 
	not in (select id_Interna from dbo.legajo_bajas)
	
	union all
	
	--CONTRATOS
	select apellido,nombre,dp.legajo,''C'' from cdatos_personales dp
	inner join dbo.ccontrato cct on 
		cct.Legajo = dp.legajo
	inner join dbo.tabla_resoluciones_contratos ta  on
		ta.id = cct.tipo_contrato
	inner join dbo.tabla_tipos_contratos ttc on
		ttc.id = ta.tipo_contrato
	where 	send_legajos =0 and 
		dp.legajo = @documento 
		and aprobado = 1
		and ttc.sendlegajos=1
		and cct.baja=0
	order by apellido, nombre

' 
END
GO
/****** Object:  View [dbo].[VW_CONTRATOS_VIGENTES]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CONTRATOS_VIGENTES]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_CONTRATOS_VIGENTES]
AS
SELECT     Legajo, MAX(Desde) AS DESDE
FROM         dbo.CContrato
GROUP BY Legajo
HAVING      (MAX(Desde) < GETDATE())

'
GO
/****** Object:  View [dbo].[VW_maxid_contrato]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_maxid_contrato]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_maxid_contrato]
as
select max(id) id from ccontrato


'
GO
/****** Object:  StoredProcedure [dbo].[GetCalcular_Dotacion_Area]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetCalcular_Dotacion_Area]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'






CREATE procedure [dbo].[GetCalcular_Dotacion_Area]
	@area [int],
	@nivel smallint
as
select

	permanente= (select count(id_interna) from dbo.designaciones D
	inner join dbo.tipo_de_planta TP 
		on TP.id = D.id_planta
	where (area =@area or ((left(area,@nivel) = left(@area,@nivel) and right(area,3)>900)))and fecha_hasta = ''01/01/2006'' and TP.tipo = ''P'' and id_interna not in (select id_interna from legajo_bajas) ) 
	,	
	transitoria=(select count(id_interna) from dbo.designaciones D
	inner join dbo.tipo_de_planta TP 
		on TP.id = D.id_planta
	where (area =@area or ((left(area,@nivel) = left(@area,@nivel) and right(area,3)>900))) and fecha_hasta = ''01/01/2006'' and TP.tipo = ''T'' and id_interna not in (select id_interna from legajo_bajas))	
	,
	gabinete=(select count(id_interna) from dbo.designaciones D
	inner join dbo.tipo_de_planta TP 
		on TP.id = D.id_planta
	where (area =@area or ((left(area,@nivel) = left(@area,@nivel) and right(area,3)>900))) and fecha_hasta = ''01/01/2006'' and TP.tipo = ''G'' and id_interna not in (select id_interna from legajo_bajas))	
	,
	contratada=(select count (area) from designaciones d
	inner join dbo.tipo_de_planta TP 
		on TP.id = D.id_planta
	where (area =@area or ((left(area,@nivel) = left(@area,@nivel) and right(area,3)>900))) and fecha_hasta = ''01/01/2006'' and TP.tipo = ''C'' and id_interna not in (select id_interna from legajo_bajas))	
	,
	contratos = (select distinct count(id_area) from ccontrato C
	inner join Cdatos_personales DP
		on dp.legajo = c.legajo
	where (id_area =@area or ((left(id_area,@nivel) = left(@area,@nivel) and right(id_area,3)>900))) and  dp.send_legajos=0 and dp.baja=0 and c.id = (select max(id) from ccontrato where legajo = dp.legajo and baja =0 and aprobado=1))

--(id_area =@area or(left(id_area,@nivel) = left(@area,@nivel) and right(id_area,3)>900)) and c.baja =0 and dp.send_legajos=0 and c.aprobado=1 and dp.baja=0)
	,
	externa=(select count (area) from designaciones d
	inner join dbo.tipo_de_planta TP 
		on TP.id = D.id_planta
	where d.fecha_hasta = ''01/01/2006'' and  TP.tipo = ''E''
	and (area =@area or ((left(area,@nivel) = left(@area,@nivel) and right(area,3)>900))) and id_interna not in (select id_interna from legajo_bajas))

	



























' 
END
GO
/****** Object:  StoredProcedure [dbo].[LIQ_UPD_Nro_Cuenta_Nacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_UPD_Nro_Cuenta_Nacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
 CREATE procedure [dbo].[LIQ_UPD_Nro_Cuenta_Nacion]          
@Proceso	char(2),
@Servicio	varchar(4),
@Sucur_Bco	int,
@id_banco	int,
@Moneda	char(1),
@Limite_Tarjeta	int,
@Documento	int,
@Id_Estado_Civil_Bco	smallint,
@Id_Dom_Pago	int,
@CBU	varchar(22) =NULL,
@Tarjeta_Debito	varchar(19) =NULL,
@Tarjeta_1er_Titular	varchar(19) =NULL,
@Tarjeta_2do_Titular	varchar(19) =NULL,
@Boton int        
as          

 update dbo.liq_nro_cuenta_nacion          
 set	Proceso = @Proceso,
		Servicio = @Servicio,
		Sucur_Bco = @Sucur_Bco,
		id_banco = @id_banco,
		Moneda = @Moneda,
		Limite_Tarjeta = @Limite_Tarjeta,
		Id_Estado_Civil_Bco = @Id_Estado_Civil_Bco,
		Id_Dom_Pago = @Id_Dom_Pago,
		CBU = @CBU,
		Tarjeta_Debito = @Tarjeta_Debito,
		Tarjeta_1er_Titular = @Tarjeta_1er_Titular,
		Tarjeta_2do_Titular = @Tarjeta_2do_Titular
 where documento= @Documento          
         
  
--Saco la marca de exportado por modificacion de datos  
if @Boton=3   
begin  
 update dbo.liq_nro_cuenta_nacion          
  set  exportado=0  
  where documento= @documento
end   
      

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LIQ_UPD_Impor_Nro_Cuenta_Nacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_UPD_Impor_Nro_Cuenta_Nacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LIQ_UPD_Impor_Nro_Cuenta_Nacion]  
@CUIL varchar(15),    
@CBU varchar(22) =NULL,    
@Tarjeta_Debito varchar(19) =NULL,    
@Tarjeta_1er_Titular varchar(19) =NULL,  
@usuario int  
as              

declare @Documento int
set @Documento = (select nro_documento from datos_personales where Cuil_Nro = @CUIL )
    
 update dbo.liq_nro_cuenta_nacion              
 set     
  CBU = @CBU,    
  Tarjeta_Debito = @Tarjeta_Debito,    
  Tarjeta_1er_Titular = @Tarjeta_1er_Titular,  
  Usua_Reci=@usuario,      
  Fecha_Reci=getdate()   
 where documento = @Documento' 
END
GO
/****** Object:  StoredProcedure [dbo].[LIQ_GET_Consul_Indiv_NroCuentas_Nacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/****** Object:  StoredProcedure [dbo].[LIQ_Marca_Exportado_Nacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_Marca_Exportado_Nacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

 CREATE PROCEDURE [dbo].[LIQ_Marca_Exportado_Nacion]    
 @id int ,  
 @usua int  
    
AS     
    
Update [dbo].[Liq_Nro_Cuenta_Nacion]    
set     
 exportado=1  ,  
 Usua_Envia=@usua,  
 Fecha_Envia=getdate()      
where id=@id    
  

' 
END
GO
/****** Object:  View [dbo].[VW_LIQ_Get_Listado_Bco_Nacion]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_LIQ_Get_Listado_Bco_Nacion]'))
EXEC dbo.sp_executesql @statement = N'

CREATE view [dbo].[VW_LIQ_Get_Listado_Bco_Nacion]            
AS        
SELECT  nc.[Id],         
 dp.apellido,         
 dp.nombre,        
 dp.cuil_nro,         
 dp.nro_documento,        
 nc.Id_Banco    
       
       
from liq_nro_cuenta_nacion NC        
        
inner join datos_personales dp        
 on dp.nro_documento=nc.documento        
        
where nc.Id_Banco is not null                         
	and abs(nc.Id_Dom_Pago)>0        
	and nc.exportado=0       
        
  

'
GO
/****** Object:  StoredProcedure [dbo].[LIQ_ALTA_Nro_Cuenta_Nacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_ALTA_Nro_Cuenta_Nacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[LIQ_ALTA_Nro_Cuenta_Nacion]

@Proceso	char(2) = null,
@Servicio	varchar(4) = null,
@Sucur_Bco	int,
@id_banco	int,
@Moneda	char(1),
@Limite_Tarjeta	int = null,
@Documento	int,
@Id_Estado_Civil_Bco	smallint = null,
@Id_Dom_Pago	int,
@CBU	varchar(22) = null,
@Tarjeta_Debito	varchar(19) = null,
@Tarjeta_1er_Titular	varchar(19) = null,
@Tarjeta_2do_Titular	varchar(19) = null,
@Exportado	bit,
@Usua_Ingre	smallint,
@Fecha_Ingre	smalldatetime,
@Usua_Envia	smallint = null,
@Fecha_Envia	smalldatetime = null,
@Usua_Reci	smallint = null,
@Fecha_Reci	smalldatetime = null

AS         
        
Declare @id [int]        
set @id = (select max(id)+1 from dbo.Liq_Nro_Cuenta_nacion)        
if @id is null begin        
 set @id=1        
end        
        
        
INSERT INTO dbo.Liq_Nro_Cuenta_Nacion
(        
Id,
Proceso,
Servicio,
Sucur_Bco,
id_banco,
Moneda,
Limite_Tarjeta,
Documento,
Id_Estado_Civil_Bco,
Id_Dom_Pago,
CBU,
Tarjeta_Debito,
Tarjeta_1er_Titular,
Tarjeta_2do_Titular,
Exportado,
Usua_Ingre,
Fecha_Ingre,
Usua_Envia,
Fecha_Envia,
Usua_Reci,
Fecha_Reci        
)         
VALUES         
(         
@Id,
@Proceso,
@Servicio,
@Sucur_Bco,
@id_banco,
@Moneda,
@Limite_Tarjeta,
@Documento,
@Id_Estado_Civil_Bco,
@Id_Dom_Pago,
@CBU,
@Tarjeta_Debito,
@Tarjeta_1er_Titular,
@Tarjeta_2do_Titular,
@Exportado,
@Usua_Ingre,
getdate(),
@Usua_Envia,
@Fecha_Envia,
@Usua_Reci,
@Fecha_Reci        
)        

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CGet_CEstudios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CGet_CEstudios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[CGet_CEstudios]
	(@Legajo_1 	[int])

AS 

Select    [Legajo],
	 [ID_nivel],
	 [ID_Institucion],
	 [Insititucion],
	 [Carrera],
	 [Titulo],
	 [Finalizado],
	 [Ultimo_Año],
	 [Mat_Aprob] ,
	NE.descripcion DescNivel,
	e.baja,
	e.id

from  dbo.CEstudios  E
inner join dbo.tabla_nivel_estudios NE
	on NE.id = e.id_nivel

	



where legajo =  @Legajo_1




' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Grado_Segun_AntFuncion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Grado_Segun_AntFuncion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'







CREATE procedure [dbo].[CTR_GET_Grado_Segun_AntFuncion]
	@Nivel smallint,
	@Mes smallint
AS

SELECT max(cast(g.Grado as int)) Grado 
FROM dbo.Tabla_Meses_Grados_Funciones GF
INNER JOIN dbo.Tabla_Grados G
	on g.Id = GF.Grado
WHERE GF.Nivel = @Nivel AND
	GF.Meses <= @Mes 







' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Tabla_Meses_Grados_Funciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Tabla_Meses_Grados_Funciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[CTR_GET_Tabla_Meses_Grados_Funciones]
@Nivel int,
@Grado int

as
set nocount on
select Meses from Tabla_Meses_Grados_Funciones
    where  Nivel = @Nivel
    and Grado = @Grado
' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_CTR_Grado_Segun_AntFuncion]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_CTR_Grado_Segun_AntFuncion]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_CTR_Grado_Segun_AntFuncion]  ( @Nivel smallint, @Mes smallint )  
  
RETURNS  int AS    
  
BEGIN  
  
declare @Grado int

set @grado = ( SELECT max(cast(g.Grado as int)) Grado     
FROM dbo.Tabla_Meses_Grados_Funciones GF    
INNER JOIN dbo.Tabla_Grados G    
 on g.Id = GF.Grado    
WHERE GF.Nivel = @Nivel AND    
 GF.Meses <= @Mes )  
   

return @grado

END  
    
    
    
  



' 
END
GO
/****** Object:  View [dbo].[VW_Dias_Licencia_Ordinaria]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Dias_Licencia_Ordinaria]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[VW_Dias_Licencia_Ordinaria]
AS
SELECT     [Años_Antiguedad], Dias_Correspondientes
FROM         dbo.Tabla_Dias_Licencia_Ordinaria


'
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Get_Dias_Vacaciones_Segun_años_De_Antiguedad]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Get_Dias_Vacaciones_Segun_años_De_Antiguedad]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_Get_Dias_Vacaciones_Segun_años_De_Antiguedad] (@Años smallint)
RETURNS  smallint

BEGIN 

	declare @return_value int

	set @return_value = (select top 1 dias_correspondientes 
	from dbo.tabla_dias_licencia_ordinaria
	where años_antiguedad <= @Años
	order by años_antiguedad desc)


RETURN @return_value
END' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[fx_calcular_dias]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[fx_calcular_dias]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: ''10/12/2008''
-- Description:	Me devuelve la cantidad de dias que corresponden segun los años de antiguedad
-- =============================================
CREATE FUNCTION [dbo].[fx_calcular_dias]
(
	@antiguedad char(8)
)
RETURNS int
AS
BEGIN
	declare @return_value int
	set @return_value = 
	(
		select top 1 dias_correspondientes 
		from dbo.tabla_dias_licencia_ordinaria
		where años_antiguedad <= dbo.fx_get_años_de_antiguedad(@antiguedad)
		order by años_antiguedad desc
	)

	return @return_value
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Cargos_Agentes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Cargos_Agentes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[LEG_GET_Cargos_Agentes]
	@Cargo smallint=null
as

select dp.nro_documento, dp.id_interna, 
	dp.apellido +'', ''+ dp.nombre ApeyNombre,
	tc.descripcion Cargo, ca.fecha_desde 
from dbo.datos_personales DP
inner join carrera_administrativa CA
	on ca.id_interna  = dp.id_interna
inner join dbo.tabla_cargos TC
	on tc.id = ca.id_tipo_cargo
where (tc.id = @cargo or @cargo is null)
and ca.fecha_hasta is null



' 
END
GO
/****** Object:  View [dbo].[VW_tabla_cargos]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_tabla_cargos]'))
EXEC dbo.sp_executesql @statement = N'

CREATE  VIEW [dbo].[VW_tabla_cargos]
AS
SELECT top 100 percent id, Descripcion
FROM dbo.tabla_cargos
where baja =0
Order by Descripcion

'
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Cargos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Cargos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[GABM_Tabla_Cargos]
	@Operacion char(1),
	@Id_1 	[int]=null,
	@Descripcion_2 	[varchar](30)=null

AS 
IF @operacion =''A''
BEGIN
	Declare @MAx [int]
	set @Max = (select max(id)+1 from dbo.Tabla_Cargos)
	if @Max is null begin
		set @max=1
	end
	INSERT INTO dbo.Tabla_Cargos 
		 ([Id],
		 [Descripcion],
		Baja) 
 	VALUES 
		( @max,
		 @Descripcion_2,
		0)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_Cargos
	set 	[Descripcion] =  @Descripcion_2
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_Cargos
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_Cargos
	set 	baja =  0
	where 	id = @Id_1
END


IF @operacion =''S''
BEGIN
	SELECT	Id,
		descripcion Descripción,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja 
	FROM  dbo.Tabla_Cargos
	WHERE (id = @ID_1) OR (@ID_1 is null)
	ORDER BY descripcion
END








' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_UPD_Firma_Contrato]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_UPD_Firma_Contrato]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CTR_UPD_Firma_Contrato]  
 @Id_Contrato int,  
 @Orden smallint  
AS  
SET NOCOUNT ON  
  
--ELIMINA EL CONTRATO SI ESTA EN LA TEMPORAL  
DELETE FROM dbo.CTR_Contratos   
WHERE  Id_Contrato in (SELECT top 1 id_contrato FROM dbo.CTR_Contratos_Tmp_Impresion WHERE id_contrato = @Id_Contrato)  
  
  
--MARCA EL CONTRATO COMO FIRMADO EN LA TEMPORAL  
  
UPDATE  dbo.CTR_Contratos_Tmp_Impresion  
SET  Firmado = 1  
WHERE  Id_Contrato = @Id_Contrato AND  
 OrdenImpresion = @Orden   
  
--MIGRA DEL TMP A CONTRATOS EL CTR FIRMADO   
  
INSERT INTO dbo.CTR_Contratos  
SELECT  Tmp.[Id_Contrato],   
 Tmp.[Id_Domicilio],   
 Tmp.[Nro_Documento],   
 Tmp.[Tipo_Contrato],   
 Tmp.[Nro_Contrato],   
 Tmp.[Desde],   
 Tmp.[Hasta],   
 Tmp.[Nivel],   
 Tmp.[Grado],   
 Tmp.[Funcion],   
 Tmp.[Rango],   
 Tmp.[Monto],   
 Tmp.[Id_Area],   
 Tmp.[Firmado],   
 Tmp.[Impreso],   
 Tmp.[Fecha_Impresion],   
 Tmp.[Fecha_Dia_Impresion],   
 Tmp.[Exp_Nro],   
 Tmp.[Aprobado],   
 Tmp.[Acto_Tipo],   
 Tmp.[Acto_Nro],   
 Tmp.[Acto_Fecha],   
 Tmp.[Acto_Firmante],   
 Tmp.[Contrato_Firmante],   
 Tmp.[Baja],   
 Tmp.[Excepcion],   
 Tmp.[Enmienda],   
 Tmp.[Salvado],   
 Tmp.[Fecha_Salvado],   
 Tmp.[Usuario_Salvado],   
 Tmp.[Observacion],   
 Tmp.[Estado],   
 Tmp.[Conserva_Area],   
 Tmp.[Usuario],   
 Tmp.[Reservado],  
 tmp.Alta_Prov_Leg,  
 tmp.Usua_Alta_Prov_Leg,  
 tmp.Fecha_Alta_Prov_Leg  
FROM  dbo.CTR_Contratos_Tmp_Impresion Tmp  
LEFT JOIN dbo.CTR_Contratos  CC  
 on CC.Id_Contrato = Tmp.Id_Contrato  
WHERE  tmp.Id_Contrato = @Id_Contrato AND  
 tmp.OrdenImpresion = @Orden AND  
 CC.Id_Contrato is null  
  
  
--DEVUELDE DATOS DEL CONTRATO FIRMADO  
SELECT  C.Id_Contrato,   
 @Orden Orden,  
 C.Nro_Contrato,   
 DP.Apellido +'', ''+ DP.Nombre Apellido  
FROM  dbo.CTR_Contratos C  
INNER JOIN dbo.Datos_Personales DP  
 on DP.Nro_Documento = C.Nro_Documento  
WHERE  C.Id_Contrato in (SELECT top 1 id_contrato FROM dbo.CTR_Contratos_Tmp_Impresion WHERE id_contrato = @Id_Contrato)  
  
--C.Id_Contrato = @Id_Contrato AND  
-- C.Baja = 0 AND  
-- C.Aprobado = 0  
  
  
  
  
  
  
  
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_DEL_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_DEL_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[CTR_DEL_Contratos]
	(@Nro_Documento 	[int],
	 @Id_Contrato_2 	[int],
	 @Acto_Tipo_3 	[smallint],
	 @Acto_Nro_4 	[char](10),
	 @Acto_Fecha_5 	[smalldatetime],
	 @Acto_Firmante_6 	[int],
	 @Motivo_Baja_7 	[smallint],
	 @Fecha_Baja_8 	[smalldatetime],
	 @Usuario_9 	[int])

AS 
INSERT INTO [dbo].[CTR_Contratos_Bajas] 
	 ( [Nro_Documento],
	 [Id_Contrato],
	 [Acto_Tipo],
	 [Acto_Nro],
	 [Acto_Fecha],
	 [Acto_Firmante],
	 [Motivo_Baja],
	 [Fecha_Baja],
	 [Usuario]) 
 
VALUES 
	( @Nro_Documento,
	 @Id_Contrato_2,
	 @Acto_Tipo_3,
	 @Acto_Nro_4,
	 @Acto_Fecha_5,
	 @Acto_Firmante_6,
	 @Motivo_Baja_7,
	 @Fecha_Baja_8,
	 @Usuario_9)


--MARCA BAJA EN CTR_CONTRATOS
	UPDATE CTR_Contratos
	SET Baja=1
	WHERE Id_Contrato = @Id_Contrato_2

--ELIMINA TEMPORAL DE IMPRESIONES
	DELETE FROM dbo.CTR_Contratos_Tmp_Impresion
	WHERE Id_Contrato = @Id_Contrato_2
	


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Orden_Impresion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Orden_Impresion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CTR_GET_Orden_Impresion]
	@Id_Contrato int
AS
SELECT ISNULL(MAX(OrdenImpresion),0) + 1  Orden
FROM dbo.CTR_Contratos_Tmp_Impresion
WHERE Id_Contrato = @Id_Contrato

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_UPD_Impresion_Contrato]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_UPD_Impresion_Contrato]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[CTR_UPD_Impresion_Contrato]
	@Id_Contrato int
AS
	--MARCO CONTRATO COMO IMPRESO
	UPDATE dbo.CTR_CONTRATOS
	SET 	impreso = 1,
		Fecha_Dia_Impresion = getdate()
	WHERE Id_Contrato = @Id_Contrato

	--GENERO TEMPORAL DE CONTRATOS IMPRESOS
	DECLARE @NextOrden int
	SET @NextOrden = (SELECT ISNULL(MAX(OrdenImpresion),0) + 1 FROM dbo.CTR_Contratos_Tmp_Impresion WHERE Id_Contrato = @Id_Contrato)

	INSERT INTO dbo.CTR_Contratos_Tmp_Impresion
	SELECT *, @NextOrden 
	FROM dbo.CTR_Contratos
	WHERE Id_Contrato = @Id_Contrato



' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_Get_CarreraAdm]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Get_CarreraAdm]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'






CREATE procedure [dbo].[LEG_Get_CarreraAdm]
	@id int
 AS
select	CA.ID_CARRERA,
	CA.Jurisdicción Jurisdiccion,
	CA.Organismo,
--	TRE.regimen ,
--	TA.DESCRIPCION AGRUPAMIENTO,
	CA.Id_agrupamiento, 
	CA.Regimen ,
--	TN.NIVEL,                    
--	TG.GRADO,
	--TC.DESCRIPCION CARGO,
	CA.Id_Cargos Id_Cargo,
	CA.Causas,                                             
	CA.Fecha_Desde,
	CA.Fecha_Hasta,
--	TTR.descripcion Acto_tipo,
	CA.Acto_Tipo,
	CA.Acto_nro,
	CA.Acto_Fecha,
	CA.Folio ,
	ca.id_tipo_cargo,
--	tmc.descripcion CAUSA       ,
	CA.causas Motivo,
	dbo.Fx_GET_IDNivel_Fecha (CA.id_interna,CA.Fecha_Desde) Id_NIvel,
	dbo.Fx_GET_IDGrado_Fecha (CA.id_interna,CA.Fecha_Desde) Id_Grado,
	dbo.Fx_GET_IDPlanta_Fecha (CA.id_interna,CA.Fecha_Desde) Id_Planta,
	dbo.Fx_GET_IDArea_Fecha (CA.id_interna,CA.Fecha_Desde) Area,
	CA.DatodeBaja,
	CA.DatoNoImprime
	

           
from [dbo].carrera_administrativa CA
--left join [dbo].tabla_agrupamiento TA
--	on TA.id = CA.Id_agrupamiento 

--left join [dbo].Tabla_Niveles TN
--	on TN.id = CA.Id_Nivel

--left join [dbo].Tabla_Grados TG
--	on TG.id = CA.Id_Grado

--left join [dbo].tabla_cargos TC
--	on TC.id = CA.Id_Cargos

--left join [dbo].tabla_tipos_resoluciones TTR
--	on TTR.id = CA.Acto_Tipo

--left join [dbo].Tabla_Regimen_Escalafonario TRE
--	on TRE.id = CA.Regimen

--left join dbo.Tabla_Motivos_Causas TMC
--	on TMC.id = CA.causas

Where ca.id_carrera = @id
order by ca.folio


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Designacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Designacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[LEG_GET_Designacion]
	@id_designacion [int]
AS
SELECT 	D.fecha_desde,
	D.Jurisdiccion,
	D.Organismo,
	DF.Fecha_adm_pub,
	DF.FEcha_Min,
	D.Acto_Tipo,
	D.Acto_Nro,
	D.Acto_Fecha,
	D.Fecha_Hasta,
	D.Folio,
	D.DatoNoImprime,
	D.DatodeBaja,
--	ttd.descripcion Tipo_Designacion,
	D.Tipo_Designacion tipo_designacion,
	ttd.esingreso,
	D.Motivo,
	D.Id_Cargo,
	dbo.Fx_GET_IdPlanta_Fecha(D.id_Interna,D.fecha_desde) Id_Planta,
	dbo.Fx_GET_IdArea_Fecha (D.id_Interna,D.fecha_desde) Area,
	dbo.Fx_GET_IdGrado_Fecha (D.id_Interna,D.fecha_desde) Id_Grado,
	dbo.Fx_GET_IdNivel_Fecha (D.id_Interna,D.fecha_desde) Id_Nivel
FROM dbo.Designaciones D
INNER JOIN dbo.designaciones_fechas  DF  
	ON DF.Id_Interna = D.Id_Interna
INNER JOIN dbo.tabla_tipos_designaciones  ttd 
	ON ttd.id = D.Tipo_Designacion	
WHERE Id_Designacion = @id_designacion





' 
END
GO
/****** Object:  View [dbo].[VW_Tabla_Designacion]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Designacion]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_Tabla_Designacion]

as
SELECT 	id,
	Descripcion
FROM dbo.Tabla_Designacion


'
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Embargos]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Embargos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE PROCEDURE [dbo].[RPT_LEG_Embargos]
	@Id_Interna int
as
SELECT 	Exped_Nro,
	convert(char(10),Exped_Fecha,103) Exp_fecha,
	Fuero,
	Juzgado,
	Secretaria,
	Autos,
	Monto,
	convert(char(10),Trabado_Fecha,103) Trab_Fecha,
	convert(char(10),Levantado_Fecha,103) Lev_Fecha
FROM dbo.Embargos
WHERE id_interna = @Id_interna AND
	DatoDeBaja = 0 AND
	datonoimprime = 0
ORDER BY convert(datetime,Exped_Fecha)




' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Embargos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Embargos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[LEG_UPD_Embargos]
	(@Exped_Nro_13 	[varchar](20),
	 @Exped_Fecha_14 	[smalldatetime],
	 @Fuero_15 	[varchar](50),
	 @Juzgado_16 	[varchar](50),
	 @Secretaria_17 	[varchar](50),
	 @Autos_18 	[varchar](50),
	 @Monto_19 	[smallint],
	 @Trabado_Fecha_20 	[smalldatetime],
	 @Levantado_Fecha_21 	[smalldatetime]=NULL,
	 @Folio_22 	[char](10),
	 @Id_Interna_23 	[int],
	 @Legajo_24 	[int],@Datodebaja bit,
	@datonoimprime bit,
	@Id_Embargo int)
AS 
UPDATE [dbo].[Embargos] 
SET  	[Exped_Nro]	 = @Exped_Nro_13,
	[Exped_Fecha]	 = @Exped_Fecha_14,
	[Fuero]	 = @Fuero_15,
	[Juzgado]	 = @Juzgado_16,
	[Secretaria]	 = @Secretaria_17,
	[Autos]	 = @Autos_18,
	[Monto]	 = @Monto_19,
	[Trabado_Fecha]	 = @Trabado_Fecha_20,
	[Levantado_Fecha]	 = @Levantado_Fecha_21,
	[Folio]	 = @Folio_22,
        datodebaja = @datodebaja,
	datonoimprime = @datonoimprime

WHERE	id_embargo = @id_embargo

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Embargos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Embargos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_ADD_Embargos]
	(@Exped_Nro_1 	[varchar](20),
	 @Exped_Fecha_2 	[datetime],
	 @Fuero_3 	[nvarchar](15),
	 @Juzgado_4 	[nvarchar](15),
	 @Secretaria_5 	[nvarchar](50),
	 @Autos_6 	[nvarchar](30),
	 @Monto_7 	[smallint],
	 @Trabado_Fecha_8 	[smalldatetime],
	 @Levantado_Fecha_9 	[smalldatetime],
	 @Folio_10 	[char](10),
	 @Id_Interna_11 	[int],
	 @Legajo 	[int],
	 @Datodebaja bit,
	 @datonoimprime bit)
AS 
declare @id int
set  @id = (select max(id_embargo)+1 from dbo.embargos)

INSERT INTO [dbo].[Embargos] 
	 ( [Exped_Nro],
	 [Exped_Fecha],
	 [Fuero],
	 [Juzgado],
	 [Secretaria],
	 [Autos],
	 [Monto],
	 [Trabado_Fecha],
	 [Levantado_Fecha],
	 [Folio],
	id_Interna,
	legajo,
	 DATODEBAJA,
	DATONOIMPRIME,
	id_embargo) 
 
VALUES 
	(@Exped_Nro_1,
	 @Exped_Fecha_2,
	 @Fuero_3,
	 @Juzgado_4,
	 @Secretaria_5,
	 @Autos_6,
	 @Monto_7,
	 @Trabado_Fecha_8,
	 @Levantado_Fecha_9,
	 @Folio_10,
	 @Id_Interna_11,
	@legajo, @DATODEBAJA,
	@DATONOIMPRIME,	
	@id)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Embargos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Embargos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[LEG_GET_Embargos]
	@Id_Interna 	[int],
	@legajo [int]

AS 
select * 
from dbo.Embargos 
where	(Id_Interna = @id_interna or legajo =  @legajo) and 
	datodebaja = 0
order by folio



' 
END
GO
/****** Object:  View [dbo].[VW_Config_Mostrar_Controles]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Config_Mostrar_Controles]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_Config_Mostrar_Controles]
AS
SELECT Control,Formulario
FROM dbo.RH_Config_Mostrar_Controles


'
GO
/****** Object:  UserDefinedFunction [dbo].[FxCadena_Dependencia_TEST]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[FxCadena_Dependencia_TEST]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[FxCadena_Dependencia_TEST] (@Area int)  
  
 RETURNS varchar(5000)  
  
AS    
BEGIN   
  
declare @RT varchar(5000)  
  
set @RT = ''''  
set @RT = (  
select top 1  
left(ta7.descripcion + '';'' +  
case when(ta6.descripcion <> ta7.descripcion) then ta6.descripcion + '';'' else '''' end +   
case when(ta5.descripcion <> ta7.descripcion and ta5.descripcion <> ta6.descripcion) then ta5.descripcion + '';'' else '''' end +   
case when(ta4.descripcion <> ta7.descripcion and ta4.descripcion <> ta6.descripcion and ta4.descripcion <> ta5.descripcion) then ta4.descripcion + '';'' else '''' end +   
case when(ta3.descripcion <> ta7.descripcion and ta3.descripcion <> ta6.descripcion and ta3.descripcion <> ta5.descripcion and ta3.descripcion <> ta4.descripcion) then ta3.descripcion + '';'' else '''' end +  
case when(ta2.descripcion <> ta7.descripcion and ta2.descripcion <> ta6.descripcion and ta2.descripcion <> ta5.descripcion and ta2.descripcion <> ta4.descripcion and ta2.descripcion <> ta3.descripcion) then ta2.descripcion + '';'' else '''' end +  
case when(ta1.descripcion <> ta7.descripcion and ta1.descripcion <> ta6.descripcion and ta1.descripcion <> ta5.descripcion and ta1.descripcion <> ta4.descripcion and ta1.descripcion <> ta3.descripcion and ta1.descripcion <> ta2.descripcion) then 
ta1.descripcion + '';'' else '''' end ,  
len(ta7.descripcion + '';'' +  
case when(ta6.descripcion <> ta7.descripcion) then ta6.descripcion + '';'' else '''' end +   
case when(ta5.descripcion <> ta7.descripcion and ta5.descripcion <> ta6.descripcion) then ta5.descripcion + '';'' else '''' end +   
case when(ta4.descripcion <> ta7.descripcion and ta4.descripcion <> ta6.descripcion and ta4.descripcion <> ta5.descripcion) then ta4.descripcion + '';'' else '''' end +   
case when(ta3.descripcion <> ta7.descripcion and ta3.descripcion <> ta6.descripcion and ta3.descripcion <> ta5.descripcion and ta3.descripcion <> ta4.descripcion) then ta3.descripcion + '';'' else '''' end +  
case when(ta2.descripcion <> ta7.descripcion and ta2.descripcion <> ta6.descripcion and ta2.descripcion <> ta5.descripcion and ta2.descripcion <> ta4.descripcion and ta2.descripcion <> ta3.descripcion) then ta2.descripcion + '';'' else '''' end   
  

--case when(ta1.descripcion <> ta7.descripcion and ta1.descripcion <> ta6.descripcion and ta1.descripcion <> ta5.descripcion and ta1.descripcion <> ta4.descripcion and ta1.descripcion <> ta3.descripcion and ta1.descripcion <> ta2.descripcion) 
--then ta1.descripcion + '';'' else '''' end    
  
)- 1)  
  
from dbo.tabla_areas_estructura ta7  			
inner join dbo.tabla_areas_estructura ta6 on  
''01'' + left(right(ta7.codigo,22),17) + ''00000'' = ta6.codigo  
left join dbo.tabla_areas_estructura ta5 on  
''01'' + left(right(ta7.codigo,22),14) + ''00000000'' = ta5.codigo  
left join dbo.tabla_areas_estructura ta4 on  
''01'' + left(right(ta7.codigo,22),11) + ''00000000000'' = ta4.codigo  
left join dbo.tabla_areas_estructura ta3 on  
''01'' + left(right(ta7.codigo,22),8) + ''00000000000000'' = ta3.codigo  
LEFT join dbo.tabla_areas_estructura ta2 on  
''01'' + left(right(ta7.codigo,22),5) + ''00000000000000000'' = ta2.codigo  
left join dbo.tabla_areas_estructura ta1 on  
''01'' + left(right(ta7.codigo,22),2) + ''00000000000000000000'' = ta1.codigo  
where ta7.id_area = @Area)  
return @RT  
END  
  
  

' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[FxCadena_Dependencia]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[FxCadena_Dependencia]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[FxCadena_Dependencia] (@Area int)  
  
 RETURNS varchar(5000)  
  
AS    
BEGIN   
  
declare @RT varchar(5000)  
  
set @RT = ''''  
set @RT = (  
select top 1  
left(ta7.descripcion + '';'' +  
case when(ta6.descripcion <> ta7.descripcion) then ta6.descripcion + '';'' else '''' end +   
case when(ta5.descripcion <> ta7.descripcion and ta5.descripcion <> ta6.descripcion) then ta5.descripcion + '';'' else '''' end +   
case when(ta4.descripcion <> ta7.descripcion and ta4.descripcion <> ta6.descripcion and ta4.descripcion <> ta5.descripcion) then ta4.descripcion + '';'' else '''' end +   
case when(ta3.descripcion <> ta7.descripcion and ta3.descripcion <> ta6.descripcion and ta3.descripcion <> ta5.descripcion and ta3.descripcion <> ta4.descripcion) then ta3.descripcion + '';'' else '''' end +  
case when(ta2.descripcion <> ta7.descripcion and ta2.descripcion <> ta6.descripcion and ta2.descripcion <> ta5.descripcion and ta2.descripcion <> ta4.descripcion and ta2.descripcion <> ta3.descripcion) then ta2.descripcion + '';'' else '''' end +  
case when(ta1.descripcion <> ta7.descripcion and ta1.descripcion <> ta6.descripcion and ta1.descripcion <> ta5.descripcion and ta1.descripcion <> ta4.descripcion and ta1.descripcion <> ta3.descripcion and ta1.descripcion <> ta2.descripcion) then 
ta1.descripcion + '';'' else '''' end ,  
len(ta7.descripcion + '';'' +  
case when(ta6.descripcion <> ta7.descripcion) then ta6.descripcion + '';'' else '''' end +   
case when(ta5.descripcion <> ta7.descripcion and ta5.descripcion <> ta6.descripcion) then ta5.descripcion + '';'' else '''' end +   
case when(ta4.descripcion <> ta7.descripcion and ta4.descripcion <> ta6.descripcion and ta4.descripcion <> ta5.descripcion) then ta4.descripcion + '';'' else '''' end +   
case when(ta3.descripcion <> ta7.descripcion and ta3.descripcion <> ta6.descripcion and ta3.descripcion <> ta5.descripcion and ta3.descripcion <> ta4.descripcion) then ta3.descripcion + '';'' else '''' end +  
case when(ta2.descripcion <> ta7.descripcion and ta2.descripcion <> ta6.descripcion and ta2.descripcion <> ta5.descripcion and ta2.descripcion <> ta4.descripcion and ta2.descripcion <> ta3.descripcion) then ta2.descripcion + '';'' else '''' end   
  

--case when(ta1.descripcion <> ta7.descripcion and ta1.descripcion <> ta6.descripcion and ta1.descripcion <> ta5.descripcion and ta1.descripcion <> ta4.descripcion and ta1.descripcion <> ta3.descripcion and ta1.descripcion <> ta2.descripcion) 
--then ta1.descripcion + '';'' else '''' end    
  
  
)- 1)  
  
from dbo.tabla_areas_estructura ta7  
inner join dbo.tabla_areas_estructura ta6 on  
''01'' + left(right(ta7.codigo,22),17) + ''00000'' = ta6.codigo  
inner join dbo.tabla_areas_estructura ta5 on  
''01'' + left(right(ta7.codigo,22),14) + ''00000000'' = ta5.codigo  
inner join dbo.tabla_areas_estructura ta4 on  
''01'' + left(right(ta7.codigo,22),11) + ''00000000000'' = ta4.codigo  
inner join dbo.tabla_areas_estructura ta3 on  
''01'' + left(right(ta7.codigo,22),8) + ''00000000000000'' = ta3.codigo  
inner join dbo.tabla_areas_estructura ta2 on  
''01'' + left(right(ta7.codigo,22),5) + ''00000000000000000'' = ta2.codigo  
inner join dbo.tabla_areas_estructura ta1 on  
''01'' + left(right(ta7.codigo,22),2) + ''00000000000000000000'' = ta1.codigo  
where ta7.id_area = @Area)  
return @RT  
END  
  
  

' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Primer_Nivel_Dependencia_Area]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Primer_Nivel_Dependencia_Area]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_Primer_Nivel_Dependencia_Area]  (@Id_Area int)  
RETURNS int  AS

BEGIN





	RETURN 	(select id_area from tabla_areas_estructura
			where codigo = 
			(select max(left(codigo,10)) + ''00000000000000'' from tabla_areas_estructura
			where left(codigo,19) = (select top 1 left(codigo,19)  from tabla_areas_estructura 
						where id_area = @id_area ))
)


END







' 
END
GO
/****** Object:  StoredProcedure [dbo].[Web_GetAreas]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Web_GetAreas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		Agustin
-- Create date: 16/02/2009
-- Description:	Devuelve todas las areas
-- =============================================
CREATE PROCEDURE [dbo].[Web_GetAreas]
AS
BEGIN

-- esta trae repetidas y areas de baja
	SELECT 
		codigo,
		id_area,
		descripcion
	FROM
		dbo.tabla_areas_estructura
	WHERE
		baja = 0

-- esta version trae una por cada una y el codigo menor o sea el que termina en 0
--SELECT
--	estrutempo.Codigo as codigo,
--	estrutempo.id as id_area,
--	areas_base_2.descripcion
--FROM	(SELECT
--				min(ta_estru.codigo) as codigo,
--				areas_base.id
--		 FROM dbo.Tabla_Areas areas_base
--			left join dbo.tabla_areas_estructura ta_estru
--				on areas_base.id=ta_estru.id_area
--		WHERE areas_base.baja = 0
--		GROUP BY areas_base.id)  estrutempo
--	left join dbo.Tabla_Areas areas_base_2
--		on areas_base_2.id=estrutempo.id


END
' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[FxIds_Dependencia]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[FxIds_Dependencia]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[FxIds_Dependencia] (@Area int)

	RETURNS varchar(5000)

AS  
BEGIN 

declare @RT varchar(5000)

set @RT = ''''
set @RT = (
select top 1
left(cast(ta7.id_area as varchar) + '';'' +
case when(cast(ta6.id_area as varchar) <> cast(ta7.id_area as varchar)) then cast(ta6.id_area as varchar) + '';'' else '''' end + 
case when(cast(ta5.id_area as varchar) <> cast(ta7.id_area as varchar) and cast(ta5.id_area as varchar) <> cast(ta6.id_area as varchar)) then cast(ta5.id_area as varchar) + '';'' else '''' end + 
case when(cast(ta4.id_area as varchar) <> cast(ta7.id_area as varchar) and cast(ta4.id_area as varchar) <> cast(ta6.id_area as varchar) and cast(ta4.id_area as varchar) <> cast(ta5.id_area as varchar)) then cast(ta4.id_area as varchar) + '';'' else '''' end + 
case when(cast(ta3.id_area as varchar) <> cast(ta7.id_area as varchar) and cast(ta3.id_area as varchar) <> cast(ta6.id_area as varchar) and cast(ta3.id_area as varchar) <> cast(ta5.id_area as varchar) and cast(ta3.id_area as varchar) <> cast(ta4.id_area as varchar)) then cast(ta3.id_area as varchar) + '';'' else '''' end +
case when(cast(ta2.id_area as varchar) <> cast(ta7.id_area as varchar) and cast(ta2.id_area as varchar) <> cast(ta6.id_area as varchar) and cast(ta2.id_area as varchar) <> cast(ta5.id_area as varchar) and cast(ta2.id_area as varchar) <> cast(ta4.id_area as varchar) and cast(ta2.id_area as varchar) <> cast(ta3.id_area as varchar)) then cast(ta2.id_area as varchar) + '';'' else '''' end +
case when(cast(ta1.id_area as varchar) <> cast(ta7.id_area as varchar) and cast(ta1.id_area as varchar) <> cast(ta6.id_area as varchar) and cast(ta1.id_area as varchar) <> cast(ta5.id_area as varchar) and cast(ta1.id_area as varchar) <> cast(ta4.id_area as varchar) and cast(ta1.id_area as varchar) <> cast(ta3.id_area as varchar) and cast(ta1.id_area as varchar) <> cast(ta2.id_area as varchar)) then cast(ta1.id_area as varchar) + '';'' else '''' end ,
len(cast(ta7.id_area as varchar) + '';'' +
case when(cast(ta6.id_area as varchar) <> cast(ta7.id_area as varchar)) then cast(ta6.id_area as varchar) + '';'' else '''' end + 
case when(cast(ta5.id_area as varchar) <> cast(ta7.id_area as varchar) and cast(ta5.id_area as varchar) <> cast(ta6.id_area as varchar)) then cast(ta5.id_area as varchar) + '';'' else '''' end + 
case when(cast(ta4.id_area as varchar) <> cast(ta7.id_area as varchar) and cast(ta4.id_area as varchar) <> cast(ta6.id_area as varchar) and cast(ta4.id_area as varchar) <> cast(ta5.id_area as varchar)) then cast(ta4.id_area as varchar) + '';'' else '''' end + 
case when(cast(ta3.id_area as varchar) <> cast(ta7.id_area as varchar) and cast(ta3.id_area as varchar) <> cast(ta6.id_area as varchar) and cast(ta3.id_area as varchar) <> cast(ta5.id_area as varchar) and cast(ta3.id_area as varchar) <> cast(ta4.id_area as varchar)) then cast(ta3.id_area as varchar) + '';'' else '''' end +
case when(cast(ta2.id_area as varchar) <> cast(ta7.id_area as varchar) and cast(ta2.id_area as varchar) <> cast(ta6.id_area as varchar) and cast(ta2.id_area as varchar) <> cast(ta5.id_area as varchar) and cast(ta2.id_area as varchar) <> cast(ta4.id_area as varchar) and cast(ta2.id_area as varchar) <> cast(ta3.id_area as varchar)) then cast(ta2.id_area as varchar) + '';'' else '''' end 

+
case when(cast(ta1.id_area as varchar) <> cast(ta7.id_area as varchar) and cast(ta1.id_area as varchar) <> cast(ta6.id_area as varchar) and cast(ta1.id_area as varchar) <> cast(ta5.id_area as varchar) and cast(ta1.id_area as varchar) <> cast(ta4.id_area as varchar) and cast(ta1.id_area as varchar) <> cast(ta3.id_area as varchar) and cast(ta1.id_area as varchar) <> cast(ta2.id_area as varchar)) then cast(ta1.id_area as varchar) + '';'' else '''' end  


)- 1)

from dbo.tabla_areas_estructura ta7
inner join dbo.tabla_areas_estructura ta6 on
''01'' + left(right(ta7.codigo,22),17) + ''00000'' = ta6.codigo
inner join dbo.tabla_areas_estructura ta5 on
''01'' + left(right(ta7.codigo,22),14) + ''00000000'' = ta5.codigo
inner join dbo.tabla_areas_estructura ta4 on
''01'' + left(right(ta7.codigo,22),11) + ''00000000000'' = ta4.codigo
inner join dbo.tabla_areas_estructura ta3 on
''01'' + left(right(ta7.codigo,22),8) + ''00000000000000'' = ta3.codigo
inner join dbo.tabla_areas_estructura ta2 on
''01'' + left(right(ta7.codigo,22),5) + ''00000000000000000'' = ta2.codigo
inner join dbo.tabla_areas_estructura ta1 on
''01'' + left(right(ta7.codigo,22),2) + ''00000000000000000000'' = ta1.codigo
where cast(ta7.id_area as varchar) = @Area)
return @RT
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Recepcion_Contrato_ValidaExist]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Recepcion_Contrato_ValidaExist]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Recepcion_Contrato_ValidaExist]
	@id_contrato int
as

select count(*) existe_id from CTR_Recepcion_Contratos
where id_contrato = @id_contrato

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Recepcion_Contratos_ValidaEnvio]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Recepcion_Contratos_ValidaEnvio]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Recepcion_Contratos_ValidaEnvio]
	@Compro_Envio int 
as

select count(1) Envio  
from CTR_Recepcion_Contratos
where Compro_Envio = @Compro_Envio


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Recepcion_Contratos_MaxRecep]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Recepcion_Contratos_MaxRecep]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Recepcion_Contratos_MaxRecep]
    
as  
  
select isnull(max(Compro_Recepcion),0) + 1  Compro_Recepcion
from dbo.CTR_Recepcion_Contratos  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_ADD_Recepcion_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ADD_Recepcion_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_ADD_Recepcion_Contratos]  
  
@Id_Contrato int,  
@Recepcion int,  
@Usuario int  
  
as  
  
declare @id int  
set @id = (select isnull(max(id),0) + 1 from dbo.CTR_Recepcion_Contratos)  
  
  
insert into dbo.CTR_Recepcion_Contratos  
(  
Id,  
Id_Contrato,  
Compro_Recepcion,  
Compro_Recepcion_Fecha,  
Compro_Recepcion_Usuario  
)  
values  
(  
@Id,  
@Id_Contrato,  
@Recepcion,  
getdate(),  
@Usuario  
)  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_UPD_Recepcion_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_UPD_Recepcion_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_UPD_Recepcion_Contratos]  
  
@Id_Contrato int,  
@Envio int,  
@Usuario int  
  
as  
  
Update dbo.CTR_Recepcion_Contratos  
set 	Compro_Envio = @Envio,
	Compro_Envio_Fecha = getdate(),
	Compro_Envio_Usuario = @Usuario
where id_contrato = @Id_Contrato


' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_UDP_Recepcion_Planillas_Firmas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_UDP_Recepcion_Planillas_Firmas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ASIS_UDP_Recepcion_Planillas_Firmas]

	@agente int,
	@area int,
	@periodo varchar(7),
	@Usuario smallint,
	@recibio bit

as
if @recibio = 1 begin
declare @existe int
set @existe = (SELECT recepciono FROM dbo.ASIS_Planillas_Recibidas
where	agente = @agente and
	periodo = @periodo)-- and
--	area = @area)

if @existe is null begin
	INSERT INTO dbo.ASIS_Planillas_Recibidas values 
(
	@agente ,
	@area ,
	@periodo ,@Usuario, getDate()
)
end

UPDATE 	dbo.ASIS_Planillas_Recibidas
SET	Recepciono = @usuario,
	Fecha_Recepcion = getdate()

where	agente = @agente and
	periodo = @periodo and
	area = @area
end
if @recibio = 0 begin
delete from dbo.ASIS_Planillas_Recibidas
where	agente = @agente and
	periodo = @periodo and
	area = @area

end

' 
END
GO
/****** Object:  View [dbo].[VW_PRUEBA_MESES_ASIS_Planillas_Recibidas]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_PRUEBA_MESES_ASIS_Planillas_Recibidas]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_PRUEBA_MESES_ASIS_Planillas_Recibidas] AS
SELECT Agente, LEFT(periodo, 2) as mes, RIGHT(periodo, 4) as anyo
FROM dbo.ASIS_Planillas_Recibidas

'
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Meses_Cardex_Revisados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Meses_Cardex_Revisados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ASIS_GET_Meses_Cardex_Revisados] 
@id_Interna int,
@periodo int
AS

SELECT [a].[agente] [id_interna], * 

FROM [dbo].[ASIS_Planillas_Recibidas] [a]

WHERE [agente] = @ID_INTERNA AND right([periodo], 4) = @PERIODO

ORDER BY [periodo]


' 
END
GO
/****** Object:  View [dbo].[VW_Tabla_Areas_Detalles]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Areas_Detalles]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_Tabla_Areas_Detalles]
AS
SELECT [Id_Area], [Codigo_Dependencia], [Calle], [Nro], [Piso], [Dpto], [Localidad], [Codigo_Postal], [Contacto], [Telefono], [Fax], [Baja]
FROM [dbo].[Tabla_Areas_Detalle]

'
GO
/****** Object:  StoredProcedure [dbo].[MNS_ADD_Solicitante]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MNS_ADD_Solicitante]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[MNS_ADD_Solicitante]
	@Solicitante varchar(100)
AS
INSERT INTO dbo.MNS_Solicitantes (Solicitante)
VALUES (@Solicitante)



' 
END
GO
/****** Object:  StoredProcedure [dbo].[MNS_GET_Solicitante]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MNS_GET_Solicitante]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE PROCEDURE [dbo].[MNS_GET_Solicitante]
AS
SELECT Id, Solicitante FROM  dbo.MNS_Solicitantes 
ORDER BY Solicitante




' 
END
GO
/****** Object:  StoredProcedure [dbo].[GET_tabla_doc_borrar]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GET_tabla_doc_borrar]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[GET_tabla_doc_borrar]
as

select * from table_doc_borrar' 
END
GO
/****** Object:  View [dbo].[VW_LEG_Tabla_Tipo_URetributivas]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_LEG_Tabla_Tipo_URetributivas]'))
EXEC dbo.sp_executesql @statement = N'create view [dbo].[VW_LEG_Tabla_Tipo_URetributivas]  
as  
  
select *   
from dbo.LEG_Tabla_Tipo_URetributivas  
where baja = 0  

'
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Estudios_Idiomas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Estudios_Idiomas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE   PROCEDURE [dbo].[LEG_GET_Estudios_Idiomas]  
  @NroDocumento [int]  
AS   
select  EI.Id,
	TI.Descripcion Idioma,
	EI.folio  
FROM  [dbo].LEG_Estudios_Idiomas EI  
INNER JOIN dbo.tabla_idiomas TI 
	ON TI.id = EI.Id_Idioma
WHERE [Nro_doc] =@NroDocumento AND   
 datodebaja=0  
  
  



' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Estudios_Idiomas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Estudios_Idiomas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE  PROCEDURE [dbo].[LEG_ADD_Estudios_Idiomas]
	(@Idioma_1 	[smallint],
	 @Habla_2 	[smallint],
	 @Lee_3 	[smallint],
	 @Escribe_4 	[smallint],
	 @Id_Interna_5 	[int],
	 @Nro_doc_6 	[int],
	 @Folio_4 	[char](10),
	@datodebaja bit,
	@datonoimprime bit,
	@Usuario smallint)

AS 

INSERT INTO dbo.LEG_Estudios_Idiomas 
	 (Id_Idioma,
	 [Habla],
	 [Lee],
	 [Escribe],
	 [Id_Interna],
	 [Nro_doc],
	 [folio],
	 datodebaja,
	 datonoimprime,
	Usuario,
	FechaProceso) 
 VALUES 
	(@Idioma_1,
	 @Habla_2,
	 @Lee_3,
	 @Escribe_4,
	 @Id_Interna_5,
	 @Nro_doc_6,
	 @Folio_4,
	 0,
	 @datonoimprime,
	 @Usuario,
	getdate())




' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Estudios_Idiomas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Estudios_Idiomas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

Create PROCEDURE [dbo].[LEG_UPD_Estudios_Idiomas]
	(@Id_Estudio int,
  	 @Idioma_1 	[smallint],
	 @Habla_2 	[smallint],
	 @Lee_3 	[smallint],
	 @Escribe_4 	[smallint],
	 @Folio_4 	[char](10),
	 @datodebaja bit,
	 @datonoimprime bit,
	 @Usuario smallint)
AS 
UPDATE dbo.LEG_Estudios_Idiomas 
SET	 Id_Idioma = @Idioma_1,
	 [Habla]=@Habla_2,
	 [Lee]=@Lee_3,
	 [Escribe]=@Escribe_4,
	 [folio]=@Folio_4,
	 datodebaja=@datodebaja,
	 datonoimprime= @datonoimprime,
	 Usuario= @Usuario,
	 FechaProceso= Getdate()
WHERE Id = @Id_Estudio
	
	

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_DEL_Estudio_Idiomas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_DEL_Estudio_Idiomas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

create procedure [dbo].[LEG_DEL_Estudio_Idiomas]
	@IdEstudio int
AS
UPDATE dbo.LEG_Estudios_Idiomas
SET DatoDeBaja = 1
WHERE Id = @IdEstudio

' 
END
GO
/****** Object:  StoredProcedure [dbo].[MNS_GET_Motivos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MNS_GET_Motivos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[MNS_GET_Motivos]
AS 
SELECT Id, Descripcion FROM  dbo.MNS_Motivos 
ORDER BY Descripcion



' 
END
GO
/****** Object:  StoredProcedure [dbo].[MNS_ADD_Motivos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MNS_ADD_Motivos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[MNS_ADD_Motivos]
	@descripcion varchar(200)
AS 
INSERT INTO dbo.MNS_Motivos (Descripcion)
VALUES (@Descripcion)



' 
END
GO
/****** Object:  StoredProcedure [dbo].[LIQ_ABM_Nro_Cuenta_Activa]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_ABM_Nro_Cuenta_Activa]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[LIQ_ABM_Nro_Cuenta_Activa]              
@id int = 0,              
@Documento int,              
@CBU varchar(22) = null,              
@Usuario int = null,        
@Operacion char(1)= null --A:Alta, M:Modif, B:Baja, C: Consulta, D: Datos Banco        
as              
              
declare @maxid int              
set @maxid = (select max(id)+1 from dbo.LIQ_Nro_Cuenta_Activa )              
              
if @maxid is null begin              
 set @maxid =1              
end              
              
--ALTA              
IF  upper(@Operacion) = ''A''               
BEGIN              
 INSERT INTO dbo.LIQ_Nro_Cuenta_Activa              
  (id,              
  Documento,              
  CBU,              
  Fecha_Alta,              
  Usua_Alta)               
 VALUES               
  (@maxid,              
  @Documento,              
  @CBU,              
  getdate(),              
  @Usuario)          
END              
              
-- MODIFICACION              
IF  upper(@Operacion) = ''M''               
BEGIN              
 UPDATE dbo.LIQ_Nro_Cuenta_Activa               
 SET Fecha_Baja = getdate(),              
  Usua_Baja = @Usuario              
 WHERE ID =  @ID               
          
 INSERT INTO dbo.LIQ_Nro_Cuenta_Activa              
  (id,              
  Documento,              
  CBU,              
  Fecha_Alta,              
  Usua_Alta)               
 VALUES               
  (@maxid,              
  @Documento,              
  @CBU,              
  getdate(),              
  @Usuario)             
END              
              
              
-- BAJA              
IF  upper(@Operacion) = ''B''               
BEGIN              
 UPDATE dbo.LIQ_Nro_Cuenta_Activa               
 SET Fecha_Baja = getdate(),              
  Usua_Baja = @Usuario              
 WHERE ID =  @ID                
END            
            
            
-- CONSULTA            
IF  upper(@Operacion) = ''C''               
BEGIN              
 SELECT ca.id,
		ca.Documento,
		ca.CBU,
		ca.Fecha_Alta,
		ca.Usua_Alta,
		ca.Fecha_Baja,
		ca.Usua_Baja,
		u.Nombre LoginUsuario,
		m.descripcion moneda,
		tcb.descripcion tipo_cuenta

 FROM dbo.LIQ_Nro_Cuenta_Activa ca
    
 INNER JOIN dbo.RH_Usuarios u    
	ON u.id = ca.Usua_Alta    

 LEFT JOIN dbo.Tabla_Moneda_Banco m
	on m.id_banco = LEFT(ca.CBU,3)
	AND m.id_moneda = RIGHT(LEFT(ca.CBU,10),1)

 LEFT JOIN dbo.Tabla_Tipo_Cuenta_Banco tcb
	on tcb.id_banco = LEFT(ca.CBU,3)
	AND tcb.id_tipo_cuenta = RIGHT(LEFT(ca.CBU,9),1)   

 WHERE ca.Documento =  @Documento             
 and ca.Fecha_Baja is null               
END        
        
        
-- DATOS BANCO        
IF  upper(@Operacion) = ''D''               
BEGIN              
 SELECT Documento,  
 sb.CodBancoBCRA CodBanco,      
   nb.Descripcion Banco,      
   sb.CodSucursalBCRA,      
   sb.CodSucursalINTERNA,      
   sb.Denominacion Sucursal,      
   sb.Observaciones         
 FROM dbo.LIQ_Nro_Cuenta_Activa ca      
        
 INNER JOIN dbo.Tabla_Nomina_Bancos nb      
	ON nb.Codigo = left(ca.CBU,3)      
      
 INNER JOIN dbo.Tabla_Sucursales_Banco sb      
	ON CodBancoBCRA = left(ca.CBU,3)      
	and CodSucursalBCRA = right(left(ca.CBU,7),4)    

 where Fecha_Baja is null
END      
      
      

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LIQ_GET_Nro_Cuenta_Activa]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_GET_Nro_Cuenta_Activa]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[LIQ_GET_Nro_Cuenta_Activa]   
@operacion char(1) -- O: No Nacion, N: Nacion  
as  
  
set nocount on  
  
IF @operacion=''O''  
BEGIN  
 SELECT ca.*, u.Nombre LoginUsuario  
 INTO #TMP_Cuenta  
 FROM dbo.LIQ_Nro_Cuenta_Activa ca    
	INNER JOIN dbo.RH_Usuarios u    
		ON u.id = ca.Usua_Alta    
 WHERE ca.Fecha_Baja is null             

 SELECT Documento,  
  sb.CodBancoBCRA CodBanco,      
    nb.Descripcion Banco,      
    sb.CodSucursalBCRA,      
    sb.CodSucursalINTERNA,      
    sb.Denominacion Sucursal,      
    sb.Observaciones   
  INTO #TMP_Banco  
  FROM dbo.LIQ_Nro_Cuenta_Activa ca      
	LEFT JOIN dbo.Tabla_Nomina_Bancos nb      
		ON nb.Codigo = left(ca.CBU,3)      
	LEFT JOIN dbo.Tabla_Sucursales_Banco sb      
		ON CodBancoBCRA = left(ca.CBU,3)      
		and CodSucursalBCRA = right(left(ca.CBU,7),4)       
  WHERE ca.Fecha_Baja is null  
  

 select tc.Documento,  
  dp.apellido +'',''+ dp.nombre nombre,  
  dp.id_interna,  
  tc.cbu,  
  tb.codbanco,  
  tb.banco,  
  tb.sucursal,  
  tb.codsucursalBCRA,  
  tb.codsucursalInterna,  
  tcb.descripcion TipoCuenta,
  LEFT(RIGHT(tc.CBU,12),11) cuenta, --11 a 21  
  m.descripcion moneda,
  convert(char(10),tc.fecha_alta,103) fecha_alta,  
  tc.loginUsuario  
 from #TMP_Cuenta tc  

 INNER JOIN #TMP_Banco tb  
	on tc.documento = tb.documento  

 INNER JOIN datos_personales dp  
	on dp.Nro_Documento = tb.documento  

 LEFT JOIN dbo.Tabla_Moneda_Banco m
	on m.id_banco = tb.codbanco
	AND m.id_moneda = RIGHT(LEFT(tc.CBU,10),1)

 LEFT JOIN dbo.Tabla_Tipo_Cuenta_Banco tcb
	on tcb.id_banco = tb.codbanco
	AND tcb.id_tipo_cuenta = RIGHT(LEFT(tc.CBU,9),1)

END  
  
  
IF @operacion=''N''  
BEGIN  
  
 select cn.Documento,  
  dp.apellido +'',''+ dp.nombre nombre,  
  dp.id_interna,  
  cn.cbu,  
  cn.id_banco codbanco,  
  nb.Descripcion banco,  
  sb.Denominacion sucursal,  
  sb.CodSucursalBCRA,  
  cn.sucur_bco codsucursalInterna,  
  tcb.descripcion TipoCuenta,
  LEFT(RIGHT(cn.CBU,12),11) cuenta, --11 a 21  
  m.descripcion moneda,  
  convert(char(10),cn.fecha_ingre,103) fecha_alta,  
  cn.usua_ingre loginUsuario,  
  cn.Fecha_Reci

 INTO #tempo

 from liq_nro_cuenta_nacion cn  
   
 INNER JOIN datos_personales dp  
  on dp.Nro_Documento = cn.documento  
  
 LEFT JOIN dbo.Tabla_Nomina_Bancos nb      
  ON nb.Codigo = cn.id_banco --left(cn.CBU,3)      
       
 LEFT JOIN dbo.Tabla_Sucursales_Banco sb      
  ON CodBancoBCRA = cn.id_banco  --left(cn.CBU,3)      
  and CodSucursalinterna = cn.sucur_bco --right(left(cn.CBU,7),4)  
  
 LEFT JOIN dbo.Tabla_Moneda_Banco m
	on m.id_banco = cn.id_banco
	AND m.id_moneda = RIGHT(LEFT(cn.CBU,10),1)

 LEFT JOIN dbo.Tabla_Tipo_Cuenta_Banco tcb
	on tcb.id_banco = cn.id_banco
	AND tcb.id_tipo_cuenta = RIGHT(LEFT(cn.CBU,9),1)

 where   ((cn.Tarjeta_Debito<>'''')            
 OR (cn.Tarjeta_1er_Titular<>''''))  
 and cn.Id_Banco is not null                                                                           
 and abs(cn.Id_Dom_Pago)>0                                        
 and cn.exportado=1     
  
	delete t
	from #tempo t
		INNER JOIN LIQ_Nro_Cuenta_Activa a
		ON t.Documento = a.documento
		OR (t.Fecha_Reci > a.Fecha_Alta AND a.Fecha_Baja is null)

	select * from #tempo

END

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CGetCContrato_Funciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CGetCContrato_Funciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CGetCContrato_Funciones]
	@ID_Nivel_2 	[smallint]
AS 
Select 	 [ID],
	 [CargaHsSemLetras],
	 [CargaHsSemNro],
	 [Funcion],
	 [Objeto]

from  [dbo].[CContrato_Funciones] 

Where id_nivel =  @ID_Nivel_2

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CAltaMod_CContrato_Funciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CAltaMod_CContrato_Funciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CAltaMod_CContrato_Funciones]
	(@ID_1 	[int],
	 @ID_Nivel_2 	[smallint],
	 @CargaHsSemLetras_3 	[varchar](20),
	 @CargaHsSemNro_4 	[smallint],
	 @Funcion_5 	[varchar](50),
	 @Objeto_6 	[text])

AS 

if @ID_1 <> 0 
begin
	Update [dbo].[CContrato_Funciones] 
	set	 [ID_Nivel]=@ID_Nivel_2,
		 [CargaHsSemLetras]=@CargaHsSemLetras_3,
		 [CargaHsSemNro]=@CargaHsSemNro_4,
		 [Funcion]=@Funcion_5,
		 [Objeto]= @Objeto_6
	where	[ID] = @ID_1
 
end

if @ID_1 = 0 
begin
	set @Id_1 = (select max(id)+1 from [dbo].[CContrato_Funciones] )
	if @id_1 is null begin
		set @id_1 = 1
	end
	INSERT INTO [dbo].[CContrato_Funciones] 
		 ( [ID],
		 [ID_Nivel],
		 [CargaHsSemLetras],
		 [CargaHsSemNro],
		 [Funcion],
		 [Objeto]) 
 
	VALUES 
		( @ID_1,
		 @ID_Nivel_2,
		 @CargaHsSemLetras_3,
		 @CargaHsSemNro_4,
		 @Funcion_5,
		 @Objeto_6)
end



' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Desglose_UR_Reemplazos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Desglose_UR_Reemplazos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_ADD_Desglose_UR_Reemplazos]                
 @Documento int = null,        
 @id_UR_a_reempla int = null,    
 @id_new int = 0         
AS                
           
IF @id_new = 0      
BEGIN         
  declare @Id_UR int          
           
  select @Id_UR = max(id)          
  from dbo.LEG_Desglose_UR           
  where documento = @Documento           
         
         
  INSERT INTO dbo.LEG_Desglose_UR_Reemplazos          
  values(@Documento, @id_UR_a_reempla, @Id_UR)          
      
END        
ELSE        
BEGIN        
          
  INSERT INTO dbo.LEG_Desglose_UR_Reemplazos          
  values(@Documento, @id_UR_a_reempla, @id_new)         
         
END        
        
      
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_DEL_Desglose_UR]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_DEL_Desglose_UR]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_DEL_Desglose_UR]      
 @id int,      
 @acto_tipo_baja smallint,      
 @acto_nro_baja varchar(10),      
 @acto_fecha_baja datetime,      
 @acto_firmante_baja int, 
 @motivo_baja int,
 @fecha_baja datetime,   
 @Usuario smallint,      
 @Documento int    
AS      
    
UPDATE dbo.LEG_Desglose_UR      
SET   hasta = case when hasta is null then getdate() else hasta end,      
 acto_tipo_baja= @acto_tipo_baja,      
 acto_nro_baja= @acto_nro_baja,      
 acto_fecha_baja= @acto_fecha_baja,     
 acto_firmante_baja= @acto_firmante_baja,     
 baja = 1,      
 usuario = @Usuario,      
 motivo_baja = @motivo_baja,
 fecha_baja = @fecha_baja,
 estado = ''B''    
WHERE  Id = @id      
 and documento = @Documento   
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Desglose_UR_Expediente]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Desglose_UR_Expediente]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_UPD_Desglose_UR_Expediente]      
 @id int,     
 @exp varchar(30),
 @Documento int
    
AS      
    
UPDATE dbo.LEG_Desglose_UR      
SET    exp_nro = @exp    
WHERE Id = @id      
	and documento = @Documento 
' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Desglose_UR]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Desglose_UR]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_UPD_Desglose_UR]    
 @id int,    
 @ID_Area Bigint,    
 @Cant_Ur int,    
 @desde datetime,    
 @Hasta datetime=null,    
 @Usuario smallint,    
 @Documento int
AS    
  
UPDATE dbo.LEG_Desglose_UR    
SET   id_area = @id_area,    
 cant_ur = @cant_ur,    
 desde = @desde,    
 hasta = @hasta,    
 usuario=@Usuario    
WHERE 	Id = @id    
	and documento = @Documento 
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Desglose_UR]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Desglose_UR]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_ADD_Desglose_UR]          
 @id_interna int,          
 @Documento int,          
 @ID_Area Bigint,          
 @Cant_Ur int,          
 @desde datetime,          
 @Hasta datetime=null,          
 @Usuario smallint,          
 @Tipo_UR varchar(100)          
            
AS          
        
DECLARE @Id int          
SET @Id = (select max(id) + 1 from dbo.LEG_Desglose_UR where documento = @Documento)          
IF @Id is null BEGIN          
 SET @Id = 1          
END          
          
INSERT INTO dbo.LEG_Desglose_UR          
 (id,          
 id_interna,          
 documento,          
 id_area,          
 cant_ur,          
 desde,          
 hasta,          
 baja,          
 usuario,          
 Tipo_UR,      
 Estado)          
VALUES (@id,          
 @id_interna ,          
 @Documento ,          
 @ID_Area ,          
 @Cant_Ur ,          
 @desde ,          
 @Hasta ,          
 0,          
 @Usuario,          
 @Tipo_UR,      
 ''NA'')          
            
               
          
          
          
        
              
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_DELETE_Desglose_UR]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_DELETE_Desglose_UR]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_DELETE_Desglose_UR]      
 @id int,         
 @Documento int    
AS      
    
DELETE dbo.LEG_Desglose_UR      
WHERE  Id = @id      
 and documento = @Documento   
    

DELETE dbo.LEG_Desglose_UR_Reemplazos 
WHERE  Id_UR_nueva = @id      
 and documento = @Documento

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CON_Obras_Sociales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CON_Obras_Sociales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[CON_Obras_Sociales]
	@Cod_os int=null,
	@IdUsuario smallint

as
Select 
	Nro_Documento,
	Dp.Id_Interna,
	Apellido +'', ''+ dp.Nombre ApeyNombre,
	isnULL(os.sigla,'''') Sigla,
	isnULL(os.Nombre,'''') Nombre	
from dbo.datos_personales DP
left join dbo.Tabla_ObraSocial OS
	on os.id = dp.Obra_Social
INNER JOIN dbo.VW_Desglose_AREA DA
	ON DA.ID_Interna = DP.Id_Interna
INNER JOIN dbo.RH_Usuarios_Areas UA
	on UA.Id_Usuario = @IdUsuario AND
	   (UA.Id_Area = DA.Id_Area or Ua.id_area = 0)
where  Os.id = @Cod_os or @cod_os is null
	And VisibleLegajos = 1 and
	bajaLegajos = 0
order by apellido,dp.nombre









' 
END
GO
/****** Object:  StoredProcedure [dbo].[CON_Regimen_Jubilacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CON_Regimen_Jubilacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[CON_Regimen_Jubilacion]
 	@Tipo smallint=null,
	@IdUsuario smallint

as
Select 
	Nro_Documento,
	Dp.Id_Interna,
	Apellido +'', ''+ Nombre ApeyNombre,
	case when Regimen_Jubilatorio = 1 then
		''Reparto''
	else
		''Capitalización''
	end Regimen,
	case when Regimen_Jubilatorio = 1 then
		''''
	else
		r.descripcion 
	end Denominacion

from dbo.datos_personales DP
left join dbo.Tabla_Regimen_Jubilatorio R
	on r.id = dp.denominacion
INNER JOIN dbo.VW_Desglose_Area DA
	on DA.Id_interna = DP.Id_Interna
INNER JOIN dbo.RH_Usuarios_Areas UA
	on UA.Id_Usuario = @IdUsuario AND
	   (UA.Id_Area = DA.Id_Area or Ua.id_area = 0)
where regimen_jubilatorio = @tipo or @tipo is null
	AND VisibleLegajos = 1 and bajalegajos = 0
order by apellido,nombre






' 
END
GO
/****** Object:  StoredProcedure [dbo].[CON_Buscar_por_Apellido]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CON_Buscar_por_Apellido]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'






CREATE procedure [dbo].[CON_Buscar_por_Apellido]
	@Apellido varchar(50)=null,
	@Documento int=null,
	@IdUsuario smallint = null
as

if @documento is null begin
	select apellido,nombre,nro_documento,
	Case When VisibleLegajos = 1 AND VisibleContratos = 0 THEN
		''L''
	ELSE
		Case when visibleLegajos = 0 and VisibleContratos = 1 THEN
			''C''
		ELSE
			--MLD:29/08/07: SI ESTA VISIBLE EN LOS 2, ES LEGAJOS
			--case when BajaLegajos = 1 then
			--	''C''
			--ELSE
			--	''L''
			--END
				''L''
		END
	END Tipo	from dbo.datos_personales DP
	INNER JOIN dbo.VW_Desglose_Area DA
		on DA.Documento = dp.Nro_Documento 
	INNER JOIN dbo.RH_Usuarios_Areas UA
		on UA.Id_Usuario = @IdUsuario AND
	   (UA.Id_Area = DA.Id_Area or Ua.id_area = 0)
	

	where apellido like @apellido +''%''
	
	order by apellido, nombre
end
else
	select apellido,nombre,nro_documento,

	Case When VisibleLegajos = 1 AND VisibleContratos = 0 THEN
		''L''
	ELSE
		Case when visibleLegajos = 0 and VisibleContratos = 1 THEN
			''C''
		ELSE
			--case when BajaLegajos = 1 then
			--	''C''
			--ELSE
			--	''L''
			--END
				''L''
		END
	END Tipo	from dbo.datos_personales DP
	INNER JOIN dbo.VW_Desglose_Area DA
		on DA.Documento = dp.Nro_Documento 
	INNER JOIN dbo.RH_Usuarios_Areas UA
		on UA.Id_Usuario = @IdUsuario AND
		   (UA.Id_Area = DA.Id_Area or Ua.id_area = 0)
	
	where nro_documento = @documento
	
	order by apellido, nombre	











' 
END
GO
/****** Object:  View [dbo].[VW_ARTICULOS]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_ARTICULOS]'))
EXEC dbo.sp_executesql @statement = N'




CREATE    VIEW [dbo].[VW_ARTICULOS]
AS
SELECT  a.* ,
	case when (select top 1licencia_medica from dbo.tabla_conceptos_licencias where nro_articulo = a.nro_articulo and licencia_medica = 1) is null then
		0
	else
		1
	end Licencia_medica
FROM TABLA_ARTICULOS A





'
GO
/****** Object:  StoredProcedure [dbo].[PLA_DEL_Agentes_Incorporados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_DEL_Agentes_Incorporados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[PLA_DEL_Agentes_Incorporados]
	@Id int
AS
UPDATE dbo.PLA_Agentes_Incorporados 
SET Confirmado = 1
WHERE 	id = @Id



' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_DEL_Desglose_UR_Reemplazos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_DEL_Desglose_UR_Reemplazos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_DEL_Desglose_UR_Reemplazos]            
 @Documento int = null,    
 @id int       
AS            
       
DELETE FROM dbo.LEG_Desglose_UR_Reemplazos      
WHERE documento = @Documento     
 and id_UR_nueva = @Id    
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_ADD_Usuarios_Modulos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_ADD_Usuarios_Modulos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[RH_ADD_Usuarios_Modulos]
	(@Id_Usuario_1 [smallint],
	 @Id_Modulo_2 	[smallint])

AS 
INSERT INTO [dbo].[Usuarios_Modulos] 
	 ([Id_Usuario],
	 [Id_Modulo]) 
 
VALUES 
	( @Id_Usuario_1,
	 @Id_Modulo_2)

if (select id_usuario from dbo.perfiles INNER JOIN accesos ON perfiles.id_acceso = accesos.id where id_usuario = @id_usuario_1 and accesos.id_modulo = @Id_Modulo_2) is null begin
	exec  dbo.RH_ADD_Usuarios_Accesos @Id_Usuario_1, @Id_Modulo_2 	
end












' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_GET_Usuario_Accesos]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_GET_Usuario_Accesos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE procedure [dbo].[RH_GET_Usuario_Accesos]
	(@user 	smallint)
AS 
SELECT P.Id_acceso, PP.Permisos
FROM dbo.Perfiles  P
INNER JOIN dbo.Perfiles_Permisos_Usuarios  PP
	on PP.Id_Acceso = P.Id_Acceso 
WHERE 	(PP.Id_Usuario = @user ) AND
	(P.Id_Usuario = @user )


	










' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_GET_Menu]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_GET_Menu]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[RH_GET_Menu]
	@User [int],
	@Modulo [int]
AS
SELECT a.mnu, p.id_usuario, p.id_acceso 
FROM dbo.accesos A
INNER JOIN dbo.perfiles P
	on P.id_Acceso = A.id

WHERE P.id_usuario = @user and a.ID_modulo = @modulo












' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_DEL_Usuarios_Perfiles]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_DEL_Usuarios_Perfiles]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[RH_DEL_Usuarios_Perfiles]
	@Id_Usuario smallint
AS

DELETE FROM dbo.Perfiles Where Id_Usuario = @Id_Usuario

' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_ADD_Usuarios_Perfiles]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_ADD_Usuarios_Perfiles]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[RH_ADD_Usuarios_Perfiles]
	@Id_Usuario smallint,
	@Id_Acceso  smallint
AS

INSERT INTO dbo.Perfiles
VALUES (@Id_Usuario, @Id_Acceso)



' 
END
GO
/****** Object:  StoredProcedure [dbo].[CNom_Documento_Word]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CNom_Documento_Word]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[CNom_Documento_Word]

@tipo smallint,
@Enmienda bit=0

AS

select * from tabla_doc_contrato
where tipo_contrato=@tipo and enmienda=@Enmienda


' 
END
GO
/****** Object:  View [dbo].[VW_Tabla_Bajas_Personas]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Bajas_Personas]'))
EXEC dbo.sp_executesql @statement = N'
--select * from datos_familiares
--where id_interna = 68


CREATE view [dbo].[VW_Tabla_Bajas_Personas]

as

select * from Tabla_Bajas_Personas
where baja =0



'
GO
/****** Object:  StoredProcedure [dbo].[GetProximo_Dotacion_Area]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetProximo_Dotacion_Area]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GetProximo_Dotacion_Area]

AS
declare @id [int]

set @id = (select max(id)+1 from dbo.tmp_dotacion_area)

if @id is null begin
	set @id = 1
end

select @id
' 
END
GO
/****** Object:  StoredProcedure [dbo].[DelTMP_Dotacion_Area]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[DelTMP_Dotacion_Area]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[DelTMP_Dotacion_Area]
	(@Id_1 	[smallint])

AS 

DELETE [dbo].[TMP_Dotacion_Area] 
WHERE 
	( [Id]	 = @Id_1)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[AddTMP_Dotacion_Area]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[AddTMP_Dotacion_Area]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[AddTMP_Dotacion_Area]
	(@Id_1 	[smallint],
	 @Area_2 	[int],
	 @Secretaria_3 	[varchar](200),
	 @SubSecretaria_4 	[varchar](200),
	 @Dirección_5 	[varchar](200),
	 @Permanente_6 	[smallint],
	 @Transitoria_7 	[smallint],
	@Gabinete [smallint],
	 @Contratada_8 	[smallint],
	 @Externa_9 	[smallint],
	 @Direccion2 	[varchar](200),
	 @Direccion3 	[varchar](200))

AS 


INSERT INTO [dbo].[TMP_Dotacion_Area] 
	 ( [Id],
	 [Area],
	 [Secretaria],
	 [SubSecretaria],
	 [Dirección],
	 [Permanente],
	 [Transitoria],
	gabinete,
	 [Contratada],
	 [Externa],
	[Direccion2], 
	[Direccion3])
 
VALUES 
	( @Id_1,
	 @Area_2,
	 @Secretaria_3,
	 @SubSecretaria_4,
	 @Dirección_5,
	 @Permanente_6,
	 @Transitoria_7,
	@gabinete,
	 @Contratada_8,
	 @Externa_9,
	 @Direccion2,
	 @Direccion3)






' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_DEL_Partes_Solicitados_Pendientes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_DEL_Partes_Solicitados_Pendientes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ASIS_DEL_Partes_Solicitados_Pendientes]
	@Fecha datetime,
	@Id_Area int
AS
DELETE FROM dbo.ASIS_Partes_Pendientes
WHERE 	Id_area = @Id_Area AND
	Fecha = @Fecha




' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_ADD_Partes_Pendientes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_ADD_Partes_Pendientes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[ASIS_ADD_Partes_Pendientes]
	@Area int,
	@Fecha datetime
AS

INSERT INTO dbo.ASIS_Partes_Pendientes
VALUES (@Area, @Fecha, 0)

' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Certificados_Antiguedad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Certificados_Antiguedad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create procedure [dbo].[GABM_Certificados_Antiguedad]
	@Operacion char(1)
AS
IF @Operacion = ''C'' BEGIN
	SELECT Id, Descripcion
	FROM dbo.Tabla_Certificados_Antiguedad
	WHERE Baja = 0 
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CGetDatos_Personales_por_Apellido]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CGetDatos_Personales_por_Apellido]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[CGetDatos_Personales_por_Apellido]
	@apellido varchar(20)
as
select  apellido,nombre,legajo Legajo from dbo.cdatos_personales
where apellido like  @apellido + ''%'' and send_legajos =0

union all

select  apellido,nombre,legajo Legajo from dbo.cdatos_personales
where apellido like  @apellido + ''%'' and send_legajos =1 and legajo in (select legajo from dbo.TMP_CONTRATOS_LEGAJOS  where recibido is null)

union all

select dp.apellido,dp.nombre,nro_documento Legajo from dbo.datos_personales DP
inner join cdatos_personales CDP
	on CDp.legajo = dp.nro_documento
where dp.apellido like  @apellido + ''%'' and CDP.send_legajos =1

order by apellido,nombre

/*
union all

select dp.apellido,dp.nombre,nro_documento Legajo from dbo.datos_personales DP 
inner join designaciones D
	on d.id_interna = dp.id_interna and d.fecha_hasta =''01/01/2006'' and id_planta =22
where dp.apellido like  @apellido + ''%'' and nro_documento not in (select legajo from cdatos_personales where send_legajos =1)
order by apellido,nombre

*/
' 
END
GO
/****** Object:  View [dbo].[VW_CGET_Consulta_Sin_Nro_Cuenta]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CGET_Consulta_Sin_Nro_Cuenta]'))
EXEC dbo.sp_executesql @statement = N'
CREATE View [dbo].[VW_CGET_Consulta_Sin_Nro_Cuenta]
as
select top 100 percent nc.legajo,dp.apellido, dp.nombre
from cnro_cuenta NC

inner join cdatos_personales dp
	on dp.legajo=nc.legajo

where nro_cta is null

order by dp.apellido



'
GO
/****** Object:  StoredProcedure [dbo].[CTR_ADD_LEG_Temprana]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ADD_LEG_Temprana]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_ADD_LEG_Temprana]    
 (@Id_Cont [int],    
 @user int)    
AS    
  
   
Declare @Documento int --SE USA TAMBIEN EN SETEO DE VISIBILIDAD      
SET @Documento = (SELECT Nro_Documento FROM dbo.CTR_Contratos where Id_Contrato = @Id_Cont)      
  
      
--MLD 06-10-06: SETEO DE VISUALIZACION DE DATOS PERSONALES    
 DECLARE @VLeg Bit --Si es Visible para LEGAJOS    
 SET @VLeg = (SELECT TTC.SendLegajos    
   FROM dbo.CTR_Contratos C    
   INNER JOIN  dbo.Tabla_Resoluciones_Contratos TRC    
    ON TRC.id = C.Tipo_Contrato     
   INNER JOIN  dbo.Tabla_tipos_Contratos TTC --: sendlegajos --> 1 or 0    
    ON TTC.Id = TRC.Tipo_Contrato    
   WHERE C.Id_Contrato = @Id_Cont)    
     
     
 --SETEA VISIBILIDAD DE LEGAJOS SEGUN MODALIDAD DE CONTRATO    
 UPDATE  dbo.Datos_Personales    
 SET  BajaLegajos = case when @VLeg = 1 then 0 else VisibleLegajos  END--,  --VisibleLegajos,    
--  VisibleLegajos = @VLeg    
 WHERE  Nro_Documento = @Documento    
    
 --GENERA TRASPASO A LIQUIDACIONES SI CORRESPONDE    
 IF @VLEG = 1 BEGIN    
  IF (Select Id_interna from dbo.Datos_personales where Nro_Documento = @Documento) = @Documento BEGIN     
   exec dbo.RH_ADD_Traspaso_Documentacion 1,@user,''Incorporación de Contratado'',''Datos Personales'',@Documento,5,''CCMPL''    
  END    
       
 -- MLD 02-03-07: GENERA PASE A LEGAJO DEL CONTRATO APROBADO    
 -- exec dbo.RH_ADD_Traspaso_Documentacion 1,@user,''Aprobación de Contrato'',''Contratos'',@Documento,2,''CAPCL''    
      
    
  --GPR 26-02-07: INGRESA NIVEL Y GRADO EN DESGLOSE     
  declare @nivel int,    
   @grado int,    
   @desde datetime,    
   @id_int int    
    
  create table #Desg_NG    
   (nivel smallint,    
   grado smallint,    
   desde datetime,    
   estado char(1),    
   IdInterna int)      
      
  insert into #Desg_NG     
  (nivel,grado,desde,estado,idinterna)    
  select  nivel,    
   grado,    
   desde,    
   estado,    
   id_interna    
  from ctr_contratos c    
  inner join datos_personales dp    
   on dp.nro_documento=c.nro_documento    
  where id_contrato=@id_cont    
    
  set @nivel=(select nivel from #Desg_NG)    
  set @grado=(select grado from #Desg_NG)    
  set @desde=(select desde from #Desg_NG)    
  set @id_int=(select idinterna from #Desg_NG)    
      
  IF (select estado from #Desg_NG)<>''A'' BEGIN    
    
   exec LEG_ADD_Desglose_NivelGrado @id_int, @Documento, @nivel, @grado, @desde,    
     ''Ministerio de Desarrollo Social'',''Ministerio de Desarrollo Social'',''00-000/000'',NULL,NULL,NULL,@user        
 --''Ministerio de Desarrollo Social'',''Ministerio de Desarrollo Social'',''00-000/000'',@actotipo,@actonro,@actofecha,@user      
END     
  drop table #Desg_NG    
 END    
     
  
-- MARCO EL CONTRATO COMO ENVIADO A LEGAJO PROVISORIO  
UPDATE ctr_contratos  
SET Alta_Prov_Leg=1,   
Usua_Alta_Prov_Leg=@user,  
Fecha_Alta_Prov_Leg=getdate()  
WHERE id_contrato=@id_cont  
    
    
    
  
  
  


' 
END
GO
/****** Object:  View [dbo].[VW_Resoluciones_Contratos]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Resoluciones_Contratos]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_Resoluciones_Contratos] 
AS 
SELECT TRC.[Id], TRC.[Descripcion], TTC.descripcion AS Tipo_Contrato 
FROM [Tabla_Resoluciones_Contratos] TRC 

INNER JOIN tabla_tipos_contratos TTC 
	ON TTC.id = TRC.tipo_contrato


'
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Tabla_Tipo_Contrato]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Tabla_Tipo_Contrato]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CTR_GET_Tabla_Tipo_Contrato]
@id int
as
select 	distinct
	TRC.Id,
	TTC.Id Id_Cont,	TTC.Descripcion
	
from Tabla_Tipos_Contratos TTC

inner join Tabla_Resoluciones_Contratos TRC
	on TRC.Tipo_Contrato=TTC.id
where TRC.id=@id



' 
END
GO
/****** Object:  View [dbo].[VW_Tabla_Tipos_Contratos]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Tipos_Contratos]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_Tabla_Tipos_Contratos]
as
SELECT [Id], [Descripcion] 
FROM [dbo].[Tabla_Tipos_Contratos]

'
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Resoluciones_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Resoluciones_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[GABM_Tabla_Resoluciones_Contratos]
	@Operacion char(1),
	@Id_1 	Smallint=null,
	@Descripcion 	[varchar](50)=null,
	@Tipo_Contrato smallint=null,
	@MontoDesde money=null,
	@MontoHasta money=null
AS 
IF @operacion =''A''
BEGIN
	Declare @MAx [int]
	set @Max = (select max(id)+1 from dbo.Tabla_Resoluciones_Contratos)
	if @Max is null begin
		set @max=1
	end
	INSERT INTO dbo.Tabla_Resoluciones_Contratos
		([Id],
		[Descripcion],
		Tipo_Contrato,
		Monto_Desde,
		Monto_Hasta,
		baja) 
 	VALUES 
		(@max,
		@Descripcion,
		@Tipo_Contrato,
		@MontoDesde,
		@MontoHasta,
		0)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_Resoluciones_Contratos
	set 	[Descripcion] =  @Descripcion,
		Tipo_Contrato =  @Tipo_Contrato,
		Monto_desde = @MontoDesde,
		Monto_hasta = @MontoHasta
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_Resoluciones_Contratos
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_Resoluciones_Contratos
	set 	baja =  0
	where 	id = @Id_1
END

IF @operacion =''S''
BEGIN
	SELECT	TRC.Id,
		TRC.descripcion Descripción,
		TRC.Tipo_Contrato CtrId,
		TTC.Descripcion CtrDesc,
		Monto_Desde,
		Monto_Hasta,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja 
	FROM  dbo.Tabla_Resoluciones_Contratos TRC
	INNER JOIN dbo.Tabla_Tipos_Contratos TTC
		on TTC.Id = TRC.Tipo_Contrato
	WHERE (TRC.id = @ID_1) OR (@ID_1 is null)
	ORDER BY TRC.descripcion
END










' 
END
GO
/****** Object:  View [dbo].[VW_Resoluciones_Contratos_Completa]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Resoluciones_Contratos_Completa]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_Resoluciones_Contratos_Completa]

as

SELECT tc.[Id],tc.[Descripcion], tc.[Tipo_Contrato], tc.[Monto_Desde], tc.[Monto_Hasta],
ttc.Descripcion DescripTipoCOntrato
FROM [dbo].[Tabla_Resoluciones_Contratos] TC
inner join dbo.Tabla_Tipos_Contratos TTC
	on ttc.id = tc.tipo_contrato
where baja =0

'
GO
/****** Object:  View [dbo].[VW_Tipos_Contratos]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tipos_Contratos]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_Tipos_Contratos]

as

SELECT [Id], [Descripcion], [SendLegajos] 
FROM [dbo].[Tabla_Tipos_Contratos]

'
GO
/****** Object:  StoredProcedure [dbo].[Cred_Get_PersonasParaAsignarCredencialDefinitiva]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Cred_Get_PersonasParaAsignarCredencialDefinitiva]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE Procedure [dbo].[Cred_Get_PersonasParaAsignarCredencialDefinitiva]
as
select	persRel.Documento [Documento], 
		persRel.Apellido + '', '' + persRel.Nombre [Apellido y Nombres], 
		org.Descripcion [Organismo],
        asig.fecha [Fecha de impresión],
		Case cred.IdTipo 
		when 1 then ''Provisoria'' else ''Definitiva'' 
		end as [Tipo de credencial]
		
from dbo.CRED_PersonasRelevadas persRel
inner join dbo.CRED_Domicilios dom
ON persRel.Documento = dom.Documento
left join dbo.Cred_LugaresDeTrabajo lt
on lt.OficinaN = persRel.Lugar_de_trabajo
inner join dbo.CRED_Personas pers
ON pers.Documento = persRel.Documento
INNER join dbo.CRED_Asignaciones asig
ON asig.IdPersona = pers.Id
inner join dbo.CRED_Credenciales cred
ON cred.Id = asig.IdCredencial
inner join dbo.CRED_PedidoAltaPersonas pedAlta
ON pedAlta.IdPersona = pers.Id
inner join dbo.CRED_ConceptoRelacion conRel
ON conRel.Id = pedAlta.IdConceptoRelacion
inner join dbo.CRED_Organismos org
ON org.Id = pedAlta.IdOrganismo
left join dbo.LocalidadesAFIP localAfip
ON localAfip.idLocalidad = dom.IdLocalidad
left join dbo.Partidos part
ON part.Partido = localAfip.ID_Partido
left join dbo.Provincias prov
ON prov.codAFIP = localAfip.id_provincia
WHERE asig.IdBaja is null
AND cred.CodigoMagnetico = 0
order by persRel.Apellido, asig.fecha' 
END
GO
/****** Object:  StoredProcedure [dbo].[Cred_Get_DatosParaMigracionAltas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Cred_Get_DatosParaMigracionAltas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE Procedure [dbo].[Cred_Get_DatosParaMigracionAltas]
as
select	persRel.Apellido + '', '' + persRel.Nombre [Apellido y Nombres], 
		persRel.Documento Documento, 
		cred.CodigoMagnetico,		
		conRel.Descripcion,
		''--'' Categorias,
		--persRel.Lugar_de_trabajo,
		isnull(lt.Denominacion,org.Descripcion)Denominacion ,
		1 CentroDeCostos,
		org.Descripcion,
		''DNI'' TipoDeDocumento,
		persRel.Documento,
		'''' FechaDeIngreso,
		'''' FechaDeNacimiento,
		'''' TipoDeSexo,
		'''' EstadoCivil,
		'''' ControlDeAcceso,
		'''' ControlDeHorario,
		'''' ControlDeVisitas,
		'''' ControlDeVisitasMultiples,		
		CAST(persRel.Documento as varchar) + ''.jpg'' ImagenesDelPersonal,
		dom.Calle + dom.Numero + dom.Piso Calle,
		'''' EntreCalle,
		dom.Barrio,
		localAfip.nombrelocalidad,
		'''' CodigoPostal,
		prov.nombreProvincia,
		persRel.Telefono,
		cred.IdTipo TipoDeCredencial,
		asig.fecha
from dbo.CRED_PersonasRelevadas persRel
inner join dbo.CRED_Domicilios dom
ON persRel.Documento = dom.Documento
left join dbo.Cred_LugaresDeTrabajo lt
on lt.OficinaN = persRel.Lugar_de_trabajo
inner join dbo.CRED_Personas pers
ON pers.Documento = persRel.Documento
inner join dbo.CRED_Asignaciones asig
ON asig.IdPersona = pers.Id
inner join dbo.CRED_Credenciales cred
ON cred.Id = asig.IdCredencial
inner join dbo.CRED_PedidoAltaPersonas pedAlta
ON pedAlta.IdPersona = pers.Id
inner join dbo.CRED_ConceptoRelacion conRel
ON conRel.Id = pedAlta.IdConceptoRelacion
inner join dbo.CRED_Organismos org
ON org.Id = pedAlta.IdOrganismo
left join dbo.LocalidadesAFIP localAfip
ON localAfip.idLocalidad = dom.IdLocalidad
left join dbo.Partidos part
ON part.Partido = localAfip.ID_Partido
left join dbo.Provincias prov
ON prov.codAFIP = localAfip.id_provincia
WHERE asig.IdBaja is null
AND cred.CodigoMagnetico <> 0
order by asig.fecha' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Estudios_Relaciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Estudios_Relaciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create PROCEDURE [dbo].[GABM_Tabla_Estudios_Relaciones]
	@Operacion char(1),    
	@Id_1  [int]=null,    
	@nivel smallint=Null,
	@Area smallint=null,
	@Titulo int=null,
	@Especialidad int=null
AS     
IF @operacion =''A''    
BEGIN    
 Declare @MAx [int]    
 set @Max = (select max(id)+1 from dbo.Tabla_Estudios_Relaciones)    
 IF @Max is null BEGIN    
  set @max=1    
 END  
  
    
 INSERT INTO dbo.Tabla_Estudios_Relaciones     
   	([Id],    
	Nivel,
	Area,	
	Titulo,
	Especialidad)
  VALUES     
	( @max,    
	@Nivel,
	@Area,
	@Titulo,
	@Especialidad)
END    
    
IF @operacion =''M''    
BEGIN    
	UPDATE  dbo.Tabla_Estudios_Relaciones    
	SET 	Nivel = @Nivel,
		Area = @Area,
		Titulo = @Titulo,
		Especialidad = @Especialidad 
	WHERE id = @Id_1    
END    
    
    
IF @operacion =''B''    
BEGIN    
	DELETE FROM dbo.Tabla_Estudios_Relaciones    
	WHERE  id = @Id_1    
END    
    
--IF @operacion =''R''    
--BEGIN    	
--   update  dbo.Tabla_Estudios_Relaciones    
--   set  baja =  0    
--   where  id = @Id_1    
--END    
    
    
IF @operacion =''S''    
BEGIN    
 SELECT ER.Id,    
	EN.Id IdNIvel,
	EN.Descripcion Nivel,    
	EA.Id IdArea,
	EA.Descripcion Area,
	ET.Id IdTitulo,
	ET.Descripcion Titulo,
	EE.Id IdEspecialidad,
	EE.Descripcion Especialidad
	FROM  dbo.Tabla_Estudios_Relaciones    ER
	INNER JOIN dbo.Tabla_Estudios_Niveles	EN
		ON EN.Id = ER.Nivel
	INNER JOIN dbo.Tabla_Estudios_Areas EA
		on EA.Id = ER.Area
	INNER JOIN dbo.Tabla_Estudios_Titulos ET
		ON ET.Id = ER.Titulo
	INNER JOIn dbo.Tabla_Estudios_Especialidades EE
		ON EE.Id = ER.Especialidad
 WHERE (ER.id = @ID_1) OR (@ID_1 is null)    
 ORDER BY ER.nivel, area
END    
    
    
    
    
    
    
    
    
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Estudios_Areas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Estudios_Areas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create PROCEDURE [dbo].[GABM_Tabla_Estudios_Areas]
 @Operacion char(1),  
 @Id_1  [int]=null,  
 @Descripcion_2  [varchar](200)=null  
  
AS   
IF @operacion =''A''  
BEGIN  
 Declare @MAx [int]  
 set @Max = (select max(id)+1 from dbo.Tabla_Estudios_Areas)  
 if @Max is null begin  
  set @max=1  
 end  
 INSERT INTO dbo.Tabla_Estudios_Areas   
   ([Id],  
   [Descripcion],  
  Baja)   
  VALUES   
  ( @max,  
   @Descripcion_2,  
  0)  
END  
  
IF @operacion =''M''  
BEGIN  
 update  dbo.Tabla_Estudios_Areas  
 set  [Descripcion] =  @Descripcion_2  
 where  id = @Id_1  
END  
  
  
IF @operacion =''B''  
BEGIN  
 update  dbo.Tabla_Estudios_Areas  
 set  baja =  1  
 where  id = @Id_1  
END  
  
IF @operacion =''R''  
BEGIN  
 update  dbo.Tabla_Estudios_Areas  
 set  baja =  0  
 where  id = @Id_1  
END  
  
  
IF @operacion =''S''  
BEGIN  
 SELECT Id,  
  descripcion Descripción,  
  case when baja = 1 then  
   ''Si''  
  else  
   ''No''  
  end Baja   
 FROM  dbo.Tabla_Estudios_Areas  
 WHERE (id = @ID_1) OR (@ID_1 is null)  
 ORDER BY descripcion  
END  
  
  
  
  
  
  
  
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Areas_X_Facultad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Areas_X_Facultad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_GET_Areas_X_Facultad]    
 @Facultad int    
AS    
  
  
Select  EA.Id,    
  EA.Descripcion Area    
FROM dbo.Tabla_Estudios_Facultad_Areas FA    
INNER JOIN dbo.Tabla_Estudios_Areas EA    
 ON EA.Id =  FA.IdArea   
Where FA.IdFacultad = @Facultad  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Estudios_Especialidades]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Estudios_Especialidades]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create  PROCEDURE [dbo].[GABM_Tabla_Estudios_Especialidades]
 @Operacion char(1),  
 @Id_1  [int]=null,  
 @Descripcion_2  [varchar](200)=null  
  
AS   
IF @operacion =''A''  
BEGIN  
 Declare @MAx [int]  
 set @Max = (select max(id)+1 from dbo.Tabla_Estudios_Especialidades)  
 if @Max is null begin  
  set @max=1  
 end  
 INSERT INTO dbo.Tabla_Estudios_Especialidades   
   ([Id],  
   [Descripcion],  
  Baja)   
  VALUES   
  ( @max,  
   @Descripcion_2,  
  0)  
END  
  
IF @operacion =''M''  
BEGIN  
 update  dbo.Tabla_Estudios_Especialidades  
 set  [Descripcion] =  @Descripcion_2  
 where  id = @Id_1  
END  
  
  
IF @operacion =''B''  
BEGIN  
 update  dbo.Tabla_Estudios_Especialidades  
 set  baja =  1  
 where  id = @Id_1  
END  
  
IF @operacion =''R''  
BEGIN  
 update  dbo.Tabla_Estudios_Especialidades  
 set  baja =  0  
 where  id = @Id_1  
END  
  
  
IF @operacion =''S''  
BEGIN  
 SELECT Id,  
  descripcion Descripción,  
  case when baja = 1 then  
   ''Si''  
  else  
   ''No''  
  end Baja   
 FROM  dbo.Tabla_Estudios_Especialidades  
 WHERE (id = @ID_1) OR (@ID_1 is null)  
 ORDER BY descripcion  
END  
  
  
  
  
  
  
  
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Especialidades_X_Titulo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Especialidades_X_Titulo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE      procedure [dbo].[LEG_GET_Especialidades_X_Titulo]
 	@IdTitulo int,
	@Especialidad varchar(200) = null
AS
SELECT 	EE.Id,
 	EE.Descripcion Especialidad
FROM dbo.Tabla_Estudios_Especialidades EE
INNER JOIN dbo.Tabla_Estudios_Relaciones ER
	on ER.Especialidad = EE.Id
--WHERE ER.Titulo = @IdTitulo AND
--	(EE.Descripcion like ''%'' + @Especialidad +''%'' OR @Especialidad IS NULL) OR patindex(''%'' + @Especialidad +''%'', EE.Descripcion)<>0
  where ( (ER.Titulo = @idTitulo) and    patindex(''%''+@Especialidad+ ''%'',  EE.Descripcion)<>0 )      or (@Especialidad IS NULL)


order by EE.Descripcion








' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Estudios_Facultad_Areas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Estudios_Facultad_Areas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[GABM_Tabla_Estudios_Facultad_Areas]      
 @Operacion char(1),        
 @Facultad int = null,    
 @Area smallint = null    
AS         
IF @operacion =''A''        
BEGIN        
 INSERT INTO dbo.Tabla_Estudios_Facultad_Areas    
   (IdFacultad,        
  IdArea)         
  VALUES         
  (@Facultad,        
   @Area)        
END        
        
--IF @operacion =''M''        
--BEGIN        
-- update  dbo.Tabla_Estudios_Facultades        
-- set  [Descripcion] =  @Descripcion_2        
-- where  id = @Id_1        
--END        
        
        
IF @operacion =''B''        
BEGIN        
 DELETE FROM dbo.Tabla_Estudios_Facultad_Areas        
 where  IdFacultad = @Facultad
END        
        
--IF @operacion =''R''        
--BEGIN        
-- update  dbo.Tabla_Estudios_Facultades        
-- set  baja =  0        
-- where  id = @Id_1        
--END        
        
        
--IF @operacion =''S''        
--BEGIN        
-- SELECT Id,        
--   Descripcion,        
--   case when baja = 1 then        
--    ''Si''        
--   else        
--    ''No''        
--   end Baja         
-- FROM  dbo.Tabla_Estudios_Facultades        
-- WHERE (id = @ID_1) OR (@ID_1 is null)        
-- ORDER BY Descripcion      
--END        
        
        
        
GRANT  EXECUTE  ON [dbo].[GABM_Tabla_Estudios_Facultad_Areas]  TO [RRHH_SIS_LEG_ADM]      
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Titulos_X_Facultad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Titulos_X_Facultad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'






CREATE        procedure [dbo].[LEG_GET_Titulos_X_Facultad]
	@IdFacultad int,
	@Titulo varchar(200) = null
AS
SELECT 	distinct ET.Id,
  	ET.Descripcion Titulo
FROM dbo.Tabla_Estudios_Titulos et
INNER JOIN dbo.Tabla_Estudios_Relaciones er
	on er.titulo = et.id
INNER JOIN dbo.Tabla_Estudios_Facultad_Areas fa
	on fa.idArea = er.Area
WHERE fa.IdFacultad = @IdFacultad AND
	(ET.Descripcion like ''%'' + @Titulo +''%'' OR @Titulo IS NULL)

ORDER BY Descripcion





' 
END
GO
/****** Object:  StoredProcedure [dbo].[LIQ_GET_Consul_Indiv_NroCuentas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/****** Object:  View [dbo].[VW_Nomina_Bancos]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Nomina_Bancos]'))
EXEC dbo.sp_executesql @statement = N' CREATE view [dbo].[VW_Nomina_Bancos]  
as  
select * from dbo.Tabla_Nomina_Bancos  
 where baja = 0'
GO
/****** Object:  StoredProcedure [dbo].[GABM_Relacion_Funcion_Nivel]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Relacion_Funcion_Nivel]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

create procedure [dbo].[GABM_Relacion_Funcion_Nivel]
	@Operacion char(1),
	@IdNivel smallint,
	@IdFuncion smallint
AS

IF @Operacion = ''A'' BEGIN
	INSERT INTO dbo.Tabla_Relacion_Funcion_Nivel
	VALUES (@IdNIvel, @IdFuncion)
END


IF @Operacion = ''C'' BEGIN
	SELECT *
	FROM dbo.Tabla_Relacion_Funcion_Nivel
END

' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Estudios_Facultades]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Estudios_Facultades]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[GABM_Tabla_Estudios_Facultades]  
 @Operacion char(1),      
 @Id_1  [int]=null,      
 @Descripcion_2  [varchar](200)=null      
AS       
SET NOCOUNT ON  
IF @operacion =''A''      
BEGIN      
 Declare @MAx [int]      
 set @Max = (select max(id)+1 from dbo.Tabla_Estudios_Facultades)      
 if @Max is null begin      
  set @max=1      
 end      
 INSERT INTO dbo.Tabla_Estudios_Facultades       
   ([Id],      
   [Descripcion],      
  Baja)       
  VALUES       
  ( @max,      
   @Descripcion_2,      
  0)      
      
  select @MAx IdFacultad    
END      
      
IF @operacion =''M''      
BEGIN      
 update  dbo.Tabla_Estudios_Facultades      
 set  [Descripcion] =  @Descripcion_2      
 where  id = @Id_1      
END      
      
      
IF @operacion =''B''      
BEGIN      
 update  dbo.Tabla_Estudios_Facultades      
 set  baja =  1      
 where  id = @Id_1      
END      
      
IF @operacion =''R''      
BEGIN      
 update  dbo.Tabla_Estudios_Facultades      
 set  baja =  0      
 where  id = @Id_1      
END      
      
      
IF @operacion =''S''      
BEGIN      
 SELECT Id,      
   Descripcion,      
   case when baja = 1 then      
    ''Si''      
   else      
    ''No''      
   end Baja       
 FROM  dbo.Tabla_Estudios_Facultades      
 WHERE (id = @ID_1) OR (@ID_1 is null)      
 ORDER BY Descripcion    
END      
      
      
      
      
   
      
      
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Facultades_X_Universidad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Facultades_X_Universidad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE   procedure [dbo].[LEG_GET_Facultades_X_Universidad] 
	 @Universidad int,
	@Nombre varchar(200)=NULL
AS
SELECT  Facultad Id,
	EF.Descripcion Facultad
FROM dbo.Tabla_Estudios_Uni_Facultad Uf
INNER JOIN dbo.Tabla_Estudios_Facultades EF
	on EF.iD = UF.Facultad
WHERE 	Universidad = @Universidad AND
	ef.Baja = 0 AND
	(EF.Descripcion like ''%'' + @Nombre +''%'' or @Nombre IS NULL)
ORDER BY Descripcion	
	


' 
END
GO
/****** Object:  View [dbo].[VW_Tipo_de_planta]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tipo_de_planta]'))
EXEC dbo.sp_executesql @statement = N'

CREATE  VIEW [dbo].[VW_Tipo_de_planta]
AS
SELECT  *
FROM dbo.Tipo_de_planta


where baja =0

'
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_AntiguedadesIdInterna]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_AntiguedadesIdInterna]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[ASIS_GET_AntiguedadesIdInterna] 
@Id_Interna int
AS

declare @AnyoUsufructoActual int
declare @ProrrogaUsuDesde int

declare @ProrrogaUsuHasta int
set @AnyoUsufructoActual = (
select
case when month(getdate()) = 12 then 
	year(getdate()) 
else 
	year(getdate())-1
end)

set @ProrrogaUsuDesde = (select Prorroga_Desde from ASIS_Prorrogas_Licencias where Periodo_Usufructo = @AnyoUsufructoActual)




SELECT df.id_interna, fecha_min, tp.tipo, ant_estado, ant_total,
case when tp.tipo like ''C'' then
	ant_total
else
	ant_estado
end antiguedad, 
case when @ProrrogaUsuDesde > year(fecha_min) then
		cast(''01/12/'' + cast(@ProrrogaUsuDesde as varchar) as smalldatetime)
	else
		fecha_min
	end primerUsufructo
FROM dbo.designaciones_fechas df
LEFT JOIN dbo.antiguedad an
	ON df.id_interna = an.id_interna
INNER JOIN designaciones de 
	ON de.id_interna = df.id_interna
INNER JOIN Tipo_de_Planta tp
	ON tp.id = de.id_planta
WHERE de.fecha_hasta =''01/01/2006'' and fecha_min <> ''01/01/1900'' and df.Id_Interna = @Id_Interna
ORDER BY df.id_interna

/*


ALTER   PROCEDURE [dbo].[ASIS_Get_AntiguedadesIdInterna] 
@Id_Interna int
AS

SELECT df.id_interna, fecha_min, tp.tipo, ant_estado, ant_total,
case when tp.tipo like ''C'' then
	ant_total
else
	ant_estado
end antiguedad
FROM dbo.designaciones_fechas df
LEFT JOIN dbo.antiguedad an
	ON df.id_interna = an.id_interna

INNER JOIN dbo.VW_Desglose_Planta de
	ON de.id_interna = df.id_interna

INNER JOIN Tipo_de_Planta tp
	ON tp.id = de.id_planta

WHERE fecha_min <> ''01/01/1900'' and df.Id_Interna = @Id_Interna
ORDER BY df.id_interna

*/


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Desglose_Planta]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Desglose_Planta]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE       procedure [dbo].[LEG_ADD_Desglose_Planta]    
 @Id_interna [int] ,    
 @Documento [int] ,    
 @Id_Planta [smallint],    
 @Desig_Planta [tinyint],    
 @Desde [datetime] ,    
 @Jurisdiccion [varchar] (25)=null  ,    
 @Organismo [varchar] (25) =null ,    
 @Folio [char] (10) =null ,    
 @Acto_Tipo [smallint]=null ,    
 @Acto_Nro [varchar] (10) =null ,    
 @Acto_Fecha [datetime] =null ,    
 @Usuario smallint    
    
AS    
DECLARE @Id int    
    
SET @id = (select max(id)+1 from dbo.LEG_Desglose_Planta)    
IF @ID is null BEGIN    
 SET @Id = 1    
END    
INSERT INTO dbo.LEG_Desglose_Planta    
VALUES (@id,    
 @id_interna,    
 @Documento,    
 @Id_Planta,    
 @Desig_Planta,    
 @Desde,    
 @Jurisdiccion,    
 @Organismo,    
 @Folio,    
 @Acto_Tipo,    
 @ACto_Nro,    
 @Acto_Fecha,    
 @Usuario)    
    
--- MLD: 05-12-06 SETEA CONFIGURACION DE VISIBILIDA    
    
DECLARE @Tipo_Planta char(1)    
SET @Tipo_Planta = (Select Tipo from dbo.Tipo_de_planta where Id = @Id_Planta)    
    
IF @Tipo_Planta <> ''C'' AND @Tipo_Planta <> ''G''   
BEGIN    
 UPDATE dbo.Datos_Personales    
 SET VisibleContratos = 0    
 WHERE Nro_Documento = @Documento    
END    
ELSE    
BEGIN    
 UPDATE dbo.Datos_Personales    
 SET VisibleContratos = 1    
 WHERE Nro_Documento = @Documento    
    
END    
    
    
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_get_firmantes_fecha]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_get_firmantes_fecha]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[PLA_get_firmantes_fecha]
@periodo as varchar(7)
as
--creado por agustin 12/11/2008
--de urgencia para ponerle firmantes a los recibos

select dp.id_interna, max(dp.desde)desde , max(apellido) apellido, max(nombre) nombre
from dbo.leg_desglose_planta dp
inner join dbo.tipo_de_planta  tp on 
	dp.id_planta = tp.id
inner join dbo.datos_personales dat_p on
	dat_p.id_interna = dp.id_interna
	
where dp.desde <= ''28/'' + @periodo and tp.firma_recibos = 1

group by dp.id_interna
' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_PERIODOS_PISADOS]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_PERIODOS_PISADOS]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <18/03/2008>
-- Description:	<Evalua que no se pisen los peridos de evaluacion para una misma planta>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_GET_PERIODOS_PISADOS]
@id_planta int, @desde smalldatetime, @hasta smalldatetime
AS
BEGIN
	SET NOCOUNT ON;

	select pe.id, pe.descripcion, pe.desde, pe.hasta, tdp.descripcion planta
	from dbo.eval_periodos_evaluacion pe
	inner join dbo.eval_plantas_periodos_evaluacion pp
		on pp.id_periodo = pe.id
	left join dbo.tipo_de_planta tdp
		on tdp.id = pp.id_planta
	where @id_planta = pp.id_planta and
		(pe.desde between @desde and @hasta or 
		pe.hasta between @desde and @hasta or
		@desde between pe.desde and pe.hasta or
		@hasta between pe.desde and pe.hasta)

END


' 
END
GO
/****** Object:  View [dbo].[VW_Tipo_Planta]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tipo_Planta]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_Tipo_Planta]
AS SELECT [Tipo_de_planta].[Id], [Tipo_de_planta].[Descripcion]
FROM [Tipo_de_planta]
where baja =0




'
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_GET_DescPlanta_Fecha]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_GET_DescPlanta_Fecha]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_GET_DescPlanta_Fecha]  (@id_interna int, @fecha datetime)  
RETURNS   Varchar(50)  AS  
BEGIN 

Return (	SELECT TOP 1	isnull(TP.Descripcion,'''')
	FROM dbo.leg_desglose_Planta P
	INNER JOIN dbo.Tipo_de_Planta TP
		ON TP.id = P.Id_Planta
	WHERE Id_interna = @Id_interna and  desde <=  @fecha
	Order by desde desc)


END






' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_Tipos_Planta]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_Tipos_Planta]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[EVAL_GET_Tipos_Planta]
@id_periodo int = NULL
AS
BEGIN
	SET NOCOUNT ON;

	select distinct(tp.id), tp.Descripcion, tp.baja, tp.tipo
	from dbo.tipo_de_planta tp
	left join dbo.EVAL_Plantas_Periodos_Evaluacion pe
		on pe.id_planta = tp.id
	where tp.baja = 0 and (@id_periodo IS NULL or @id_periodo = pe.id_periodo)
	order by tp.descripcion

END


' 
END
GO
/****** Object:  StoredProcedure [dbo].[GEN_GET_Tipo_Planta]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GEN_GET_Tipo_Planta]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		<Agustin>
-- Create date: <26/03/2008>
-- Description:	<Trae los datos de un tipo de planta>
-- =============================================
CREATE PROCEDURE [dbo].[GEN_GET_Tipo_Planta]
@id_planta int
AS

BEGIN
	SET NOCOUNT ON;
	
	SELECT tipo, descripcion, baja 
	FROM dbo.tipo_de_planta 
	where id = @id_planta

END

' 
END
GO
/****** Object:  StoredProcedure [dbo].[GEN_GET_Planta_Agente]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GEN_GET_Planta_Agente]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		<Agustin>
-- Create date: <28/04/2008>
-- Description:	<Trae la planta de un agente en una determinada fecha>
-- =============================================

CREATE PROCEDURE [dbo].[GEN_GET_Planta_Agente]
	@id_interna int,
	@fecha smalldatetime
AS
BEGIN
	SET NOCOUNT ON;
	select top 1 dp.id_planta, dp.desde, tp.descripcion
	from dbo.leg_desglose_planta dp
	inner join dbo.tipo_de_planta tp
		on tp.id = dp.id_planta
	where dp.id_interna = @id_interna and dp.desde < @fecha
	order by dp.desde desc
END



' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_GET_Aptos_Medicos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_Aptos_Medicos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[MED_GET_Aptos_Medicos]           
	@nro_documento int          
AS          
          
SELECT 	AP.IdApto,
	MA.id IdTipoApto,
	MA.Descripcion TipoApto,
	Convert(char(10),desde, 103) Desde,
	convert(char(10),desde + cant_dias,103)  Hasta,
	CASE WHEN MA.DiasValido = 0 THEN
		''Definitivo''
	ELSE
		CASE WHEN (desde + cant_dias) < getdate() then
			''Vencido''
		ELSE
			''Pendiente''
		END	
	END Estado

FROM dbo.MED_Apto_Medico AP  
INNER JOIN    dbo.Tabla_Medicos_Aptos MA
	ON MA.Id = AP.IdTipoApto
WHERE	(nro_documento = @nro_documento) AND
	(AP.Baja = 0)
ORDER BY Desde desc, IdApto Desc

        




' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_GET_Apto_Medico_X_ID]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_Apto_Medico_X_ID]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create PROCEDURE [dbo].[MED_GET_Apto_Medico_X_ID]             
 @IdApto int            
AS            
SELECT  IdTipoApto,  
 Convert(char(10),desde, 103) Desde,  
 cant_dias  Cant_Dias,  
 convert(char(10),desde + cant_dias,103) Hasta,  
 ISNULL(observaciones,'''') ObservacionesGenerales,  
 ISNULL(Obs_Discapacidad,'''') ObservacionesDiscapacidad,  
     ISNULL(id_Discapacidad,'''') IdDiscapacidad ,  
 ISNULL(Porcen_Discapacidad,'''') PorcentajeDiscapacidad  
FROM dbo.MED_Apto_Medico   
WHERE IdApto = @IdApto  
          
  
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CON_MED_Aptos_Medicos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CON_MED_Aptos_Medicos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CON_MED_Aptos_Medicos]  
 @TipoApto smallint = null,  
 @DesdeEmitido smalldatetime = NULL,  
 @HastaEmitido smalldatetime = NULL,  
 @SinApto bit = 0,  
 @Vencido bit = 0,  
 @Enfermedades bit=0,  
 @Discapacidad bit =0,  
 @Pendiente bit=0,  
 @Definitivo bit=0  
  
AS  
SELECT distinct
AM.Nro_Documento,  
 DP.Apellido +'', ''+ DP.Nombre Agente,  
 MA.Descripcion Apto,  
 convert(char(10),AM.Desde,103) FechaEmision,  
 CASE WHEN EPE.Nro_Documento IS NULL THEN  
  ''No''  
 ELSE  
  ''Si''  
 END EnfermedadesPreExistentes,  
 CASE WHEN Id_Discapacidad IS NULL THEN  
  ''No''  
 ELSE  
  ''Si''  
 END Discapacidad,  
 CASE WHEN Cant_Dias = 0 THEN  
  ''Definitivo''  
 ELSE  
  CASE WHEN (desde + cant_dias) < Getdate() THEN  
   ''Vencido''  
  ELSE  
   ''Pendiente''  
  END  
 END Estado  
  
FROM dbo.MED_Apto_Medico AM  
INNER JOIN dbo.Tabla_Medicos_Aptos MA  
 ON MA.Id = AM.IdTipoApto  
LEFT JOIN dbo.MED_Enfermedades_PreExistentes EPE  
 ON EPE.Nro_Documento = AM.Nro_Documento  
LEFT JOIN dbo.Datos_Personales DP  
 ON DP.Nro_Documento = AM.Nro_Documento  
--LEFT JOIN dbo.MED_Pacientes MP  
-- ON MP.Nro_Documento   
  
WHERE (AM.Baja = 0) AND  
 (AM.IdTipoApto = @TipoApto OR @TipoApto IS NULL) AND  
 ((Desde between @DesdeEmitido AND @HastaEmitido) OR (@DesdeEmitido IS NULL AND @HastaEmitido IS NULL)) AND  
 ((((desde + cant_dias) < Getdate()) AND @Vencido = 1 and Cant_dias >0) OR @Vencido=0) AND  
 ((NOT EPE.Nro_Documento IS NULL AND @Enfermedades = 1) OR (@Enfermedades = 0)) AND  
 ((NOT AM.Id_Discapacidad IS NULL AND @Discapacidad = 1) OR (@Discapacidad = 0)) AND  
 ((((desde + cant_dias) > Getdate()) AND @Pendiente =1 and cant_dias >0) OR @Pendiente = 0) AND  
 ((Cant_Dias = 0 and @Definitivo = 1) OR @Definitivo = 0)  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_DEL_Apto_Medico]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_DEL_Apto_Medico]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[MED_DEL_Apto_Medico]  
 @IdApto int  
AS  

UPDATE dbo.MED_Apto_Medico  
SET Baja = 1  
WHERE IdApto = @IdApto  

delete from MED_Enfermedades_Preexistentes
where Nro_Documento = (select Nro_Documento from MED_Apto_Medico where IdApto = @IdApto)
  ' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetParentescos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetParentescos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[GetParentescos]
	@baja bit
 AS

SELECT *
FROM [dbo].tabla_parentesco
where baja = @baja




' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Parentescos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Parentescos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[GABM_Tabla_Parentescos]
	@Operacion char(1),
	@Id_1 	[int]=null,
	@Descripcion_2 	[varchar](50)=null

AS 
IF @operacion =''A''
BEGIN
	Declare @MAx [int]
	set @Max = (select max(id)+1 from dbo.Tabla_Parentesco)
	if @Max is null begin
		set @max=1
	end
	INSERT INTO dbo.Tabla_Parentesco 
		 ([Id],
		 [Descripcion],
		Baja) 
 	VALUES 
		( @max,
		 @Descripcion_2,
		0)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_Parentesco
	set 	[Descripcion] =  @Descripcion_2
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_Parentesco
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_Parentesco
	set 	baja =  0
	where 	id = @Id_1
END


IF @operacion =''S''
BEGIN
	SELECT	Id,
		descripcion Descripción,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja 
	FROM  dbo.Tabla_Parentesco
	WHERE (id = @ID_1) OR (@ID_1 is null)
	ORDER BY descripcion
END









' 
END
GO
/****** Object:  View [dbo].[VW_Tabla_Parentescos]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Parentescos]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_Tabla_Parentescos]

as

SELECT [Id], [Descripcion]

FROM [dbo].[Tabla_Parentesco]
Where [Baja] =0

'
GO
/****** Object:  StoredProcedure [dbo].[ASIS_DEL_Licencias_Pendientes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_DEL_Licencias_Pendientes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[ASIS_DEL_Licencias_Pendientes]
	@id_interna int,
	@concepto int,
	@desde smalldatetime,
	@hasta smalldatetime
--	@Id int ,
--	@Borrar bit=0

AS

	INSERT INTO [dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas]

	SELECT id, id_interna, concepto, desde, hasta, usuario, fecha_solicitud,
	id_area, convert(smalldatetime, floor(cast(getdate() as float)))
	FROM [dbo].[ASIS_Solicitudes_Licencia_Web]
	WHERE [id_interna] = @id_interna 
		AND [concepto] = @concepto
		AND convert(smalldatetime, floor(cast([desde] as float))) BETWEEN @desde and @Hasta
		AND convert(smalldatetime, floor(cast([hasta] as float))) BETWEEN @desde and @Hasta

	DELETE FROM [dbo].[ASIS_Solicitudes_Licencia_Web]
	WHERE [id_interna] = @id_interna 
		AND [concepto] = @concepto
		AND convert(smalldatetime, floor(cast([desde] as float))) BETWEEN @desde and @Hasta
		AND convert(smalldatetime, floor(cast([hasta] as float))) BETWEEN @desde and @Hasta

/*IF @Borrar = 1 BEGIN
	UPDATE dbo.ASIS_Parte_Detalle
	set Confirmado = 3
	WHERE Id_Detalle = @Id
END
ELSE
	UPDATE dbo.ASIS_Parte_Detalle
	set Confirmado = 2
	WHERE Id_Detalle = @Id
*/



' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_DEL_Licencia_Pendiente]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_DEL_Licencia_Pendiente]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[ASIS_DEL_Licencia_Pendiente]    
 @id_pendiente int,  
 @operacion char(1) --Acepto licencia="A" , Rechazo licencia="R"  
AS    
    
IF @operacion = ''R''  
BEGIN  
	INSERT INTO [DB_RRHH].[dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas]    
	([id], [id_interna], [concepto], [desde], [hasta], [usuario], [fecha_solicitud], [id_area], [fecha_Rechazo])    
	SELECT      
	[id], [id_interna], [concepto], [desde], [hasta], [usuario], [fecha_solicitud], [id_area], GETDATE()    
	FROM [dbo].[ASIS_Solicitudes_Licencia_Web]     
	WHERE id = @id_pendiente    
END  

  
IF @@error = 0    
BEGIN
	UPDATE [dbo].[ASIS_Solicitudes_Licencia_Web]     
	set baja = 1    
	WHERE Id = @id_pendiente    
END    


-- DELETE FROM [dbo].[ASIS_Solicitudes_Licencia_Web]     
-- WHERE Id = @id_pendiente  
  
' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Estudios_Instituciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Estudios_Instituciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE     PROCEDURE [dbo].[GABM_Tabla_Estudios_Instituciones]
 @Operacion char(1),  
 @Id_1  [int]=null,  
 @Nivel smallint=null,
 @Nombre  [varchar](200)=null,
 @Nro int= null,
 @Denominacion varchar(200)=Null,
 @Localidad varchar(200) = null 
AS   
IF @operacion =''A''  
BEGIN  
 Declare @MAx [int]  
 set @Max = (select max(id)+1 from dbo.Tabla_Estudios_Instituciones)  
 if @Max is null begin  
  set @max=1  
 end  
 INSERT INTO dbo.Tabla_Estudios_Instituciones   
   	([Id],  
    	nivel,
	nombre,
	nro,
	denominacion,
	localidad,
	  Baja)   
  VALUES   
	  ( @max,  
	   @Nivel,
	@Nombre,
	@nro,
	@Denominacion,
	@Localidad,
	  0)  
END  
  
IF @operacion =''M''  
BEGIN  
 UPDATE dbo.Tabla_Estudios_Instituciones  
 set  nivel =  @nivel,
	nombre = @nombre,
	nro = @nro,
	denominacion =@denominacion,
	localidad = @localidad
 where  id = @Id_1  
END  
  
  
IF @operacion =''B''  
BEGIN  
 update  dbo.Tabla_Estudios_Instituciones  
 set  baja =  1  
 where  id = @Id_1  
END  
  
IF @operacion =''R''  
BEGIN  
 update  dbo.Tabla_Estudios_Instituciones  
 set  baja =  0  
 where  id = @Id_1  
END  
  
  
IF @operacion =''S''  
BEGIN  
 SELECT e.Id,  
  E.Nivel Id_nivel,
  N.Descripcion DescNivel,
  E.nombre,	
  E.nro, 
  E.denominacion,
  E.localidad,
  case when E.baja = 1 then  
   ''Si''  
  else  
   ''No''  
  end Baja   
 FROM  dbo.Tabla_Estudios_Instituciones   E
 INNER JOIN dbo.Tabla_Estudios_Niveles n
	ON N.Id = e.Nivel
  WHERE (E.id = @ID_1) OR (@ID_1 is null)  
 ORDER BY descripcion , Nombre
END  
  
  
  
  
  
  
  
  




' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Instituciones_X_Nivel]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Instituciones_X_Nivel]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'











CREATE             procedure [dbo].[LEG_GET_Instituciones_X_Nivel]   
 @Nivel smallint,  
 @Nombre varchar(200) = null  
AS  
  
SELECT Id, rtrim(Nombre) +'' - ''+ rtrim(cast(isnull(Nro,'''') as char))+ '' - '' + rtrim(isnull(Denominacion,'''')) + '' - '' + rtrim(isnull(localidad,'''')) Nombre  
FROM dbo.Tabla_Estudios_Instituciones  
--Where Nivel = @NIvel AND  
-- Baja = 0 AND  
-- (Nombre+'' '' +''%''+ cast(nro as char) like (''%'' +  @Nombre + ''%'') OR @Nombre IS NULL) --OR patindex(''%'' + @Nombre +''%'', Nombre )<>0 
where ((Nivel = @Nivel) and (Baja = 0) and patindex(''%'' + @Nombre +''%'', Nombre + '' ''+ Denominacion )<>0 )or  @Nombre IS NULL
  
ORDER BY Nombre  
  
  













' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Funciones_Cargos_Antiguedad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Funciones_Cargos_Antiguedad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE    PROCEDURE [dbo].[GABM_Tabla_Funciones_Cargos_Antiguedad]
	@Operacion char(1),
	@Id_1 	[int]=null,
	@Descripcion_2 	[varchar](50)=null,
	@Certificado bit=0

AS 
IF @operacion =''A''
BEGIN
	INSERT INTO dbo.Tabla_Funciones_Cargos 
		 ([Descripcion],
		Baja,
		CertificadoAntiguedad) 
 	VALUES 
		(@Descripcion_2,
		0,
		@Certificado)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_Funciones_Cargos
	set 	[Descripcion] =  @Descripcion_2,
	   	CertificadoAntiguedad = @Certificado
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_Funciones_Cargos
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_Funciones_Cargos
	set 	baja =  0
	where 	id = @Id_1
END


IF @operacion =''S''
BEGIN
	SELECT	Id,
		descripcion Descripción,
		case when CertificadoAntiguedad = 1 then
			''Si''
		else
			''No''
		end Certificado,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja
	FROM  dbo.Tabla_Funciones_Cargos
	WHERE (id = @ID_1) OR (@ID_1 is null)
	ORDER BY descripcion
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Servicios_Adm_Publica_Detalles]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Servicios_Adm_Publica_Detalles]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[LEG_GET_Servicios_Adm_Publica_Detalles]  
 @Id_interna int,  
 @Folio varchar(10)  
AS  
SELECT  ambito,   
 jurisdiccion,   
 organismo,   
 tc.descripcion cargo,   
 remunerativo,   
 fecha_desde,   
 fecha_hasta,   
 causa_egreso,   
 folio,   
 id_interna,   
 caja,  
 afiliado,  
 datodebaja,  
 datonoimprime,  
 ctr_cert,  
 tc.id Id_Cargo,
 sap.Id id_adm_publica  
FROM [dbo].LEG_Servicios_adm_publica sap  
INNER JOIN dbo.Tabla_Ambitos_Antiguedad TAA  
 ON TAA.Id = SAP.ambito  
INNER JOIN dbo.Tabla_Funciones_Cargos TC  
 on TC.id = sap.cargo  
WHERE  sap.id_interna= @id_Interna and datodebaja = 0 AND  
 Folio = @Folio  
ORDER BY Fecha_Desde  
  
  
  
  
  
  ' 
END
GO
/****** Object:  View [dbo].[VW_Tabla_Funciones_Cargos]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Funciones_Cargos]'))
EXEC dbo.sp_executesql @statement = N'

CREATE view [dbo].[VW_Tabla_Funciones_Cargos]
AS
SELECT TOP 100 Percent Id, Descripcion
FROM dbo.Tabla_Funciones_Cargos
WHERE Baja = 0
ORDER BY Descripcion



'
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Serv_Adm_Publica]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Serv_Adm_Publica]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'





CREATE procedure [dbo].[RPT_LEG_Serv_Adm_Publica]
	@Id_interna int
as

SELECT  TAA.Descripcion	Ambito,
	Jurisdiccion,
	Organismo,
	TFC.Descripcion Cargo,
	case when Remunerativo=''1'' then
		''Sí''
	else
		''No''
	end Remunerativo,
	case when fecha_desde = ''01/01/1900'' then
		'' ''
	else	
		convert(char(10),Fecha_Desde,103) 
	end Desde,
	case when fecha_hasta = ''01/01/1900'' then	
		'' ''
	else
		convert(char(10),Fecha_Hasta,103) 
	end Hasta,
	Causa_Egreso,
	Caja,
	Afiliado
FROM dbo.LEG_Servicios_Adm_Publica AP
INNER JOIN dbo.Tabla_Ambitos_Antiguedad TAA
	ON TAA.Id = AP.Ambito
INNER JOIN dbo.Tabla_Funciones_Cargos TFC
	ON TFC.Id = AP.Cargo
WHERE Id_interna = @Id_Interna AND
	DatoDeBaja = 0 AND
	datonoimprime = 0
ORDER BY convert(datetime,Fecha_Desde)






' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Otros_Servicios]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Otros_Servicios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[RPT_LEG_Otros_Servicios]
	@Id_interna int
as

SELECT 	Institucion Institución,
	Domicilio,
	tfc.descripcion Cargo,
	case when Remun = 1 then
		''Sí''
	else
		''No''
	end Remunera,
	convert(char(10),Fecha_Desde,103) desde,
	convert(char(10),Fecha_Hasta,103) hasta,
	Causa_Egreso
FROM dbo.LEG_Otros_Servicios Os
INNER JOIN dbo.Tabla_Funciones_Cargos TFC
	ON tfc.id = os.cargo
WHERE Id_interna = @Id_Interna AND
	DatoDeBaja = 0 AND
	datonoimprime = 0
ORDER BY Fecha_Desde




' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Otros_Servicios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Otros_Servicios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[LEG_GET_Otros_Servicios]  
 @Legajo int,  
 @id int  
  
AS  
  
SELECT DAT_P.Id_Interna as IdPersona, 
DAT_P.Apellido, 
DAT_P.Nombre, 
OTS.*, 
DAT_P.Nro_Documento, 
DAT_P.id_Interna ,
TFC.descripcion Cargo_Desc  

FROM [dbo].Datos_Personales as DAT_P   
LEFT JOIN [dbo].LEG_Otros_Servicios as OTS   
 ON DAT_P.id_Interna = OTS.id_Interna   
  and datodebaja = 0 
inner join Tabla_Funciones_Cargos TFC
	on TFC.id=OTS.cargo
 
WHERE (Nro_Documento = @Legajo or DAT_P.id_interna = @id)  ORDER BY folio DESC  
  
  
  
  
  
  
  
  
  
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_ADD_Recibos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_ADD_Recibos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[PLA_ADD_Recibos]                    
  @Id_Interna int,                    
  @mes smallint,                    
  @año smallint,                    
  @Cuil varchar(13),                    
  @Id_Oficina smallint,                    
  @Nro_Orden smallint,                    
  @Nivel char(1),                    
  @grado char(2),                    
  @F_Ingreso datetime,                    
  @SBruto float = 0,                   
  @SDescuento float = 0,                 
  @SNeto float = 0,                    
  @NroCta varchar(10),                    
  @Banco varchar(20),                    
  @F_Deposito datetime,                    
  @confirmado bit=0,                    
  @Usuario smallint,              
  @TipoLiquidacion varchar(2),                   
  @opcionJubilatoria varchar(2),             
  @afjp varchar(10),            
  @liquidacion int            
AS                    
SET NOCOUNT ON                  
            
            
declare @id int,            
 @Cuil_Ant varchar(13),                    
 @Nro_Orden_Ant smallint,             
 @liquidacion_Ant int                   
            
            
 set @id = (select isnull(max(Id_recibo),0) + 1 from dbo.Pla_Recibos)            
            
select  @Cuil_Ant = Cuil,            
   @Nro_Orden_Ant = Nro_Orden,            
   @liquidacion_Ant = liquidacion           
from dbo.Pla_Recibos            
where Id_Recibo = @id - 1            
            
            
--CONTROLO QUE SI ES EL MISMO QUE EL ANTERIOR NO AGREGUE EN LA CABECERA PERO ACTUALIZO EL MONTO CON EL NUEVO RECIBO.            
IF ((@Cuil = @Cuil_Ant) AND (@Nro_Orden = @Nro_Orden_Ant) AND (@liquidacion = @liquidacion_Ant))            
BEGIN            
            
            
 UPDATE dbo.PLA_Recibos            
 set  SBruto = @SBruto,            
  SDescuentos = @SDescuento,                
  SNeto = @SNeto            
 from dbo.PLA_Recibos              
 where Id_recibo = @id - 1    
            
 select @id - 1 Recibo            
            
END            
ELSE            
BEGIN            
              
 INSERT INTO [dbo].[PLA_Recibos]                    
  (Id_Recibo,        
  [Id_Interna],                     
  [mes],                     
  [año],                     
  [Cuil],                     
  [Id_Oficina],                     
  [Nro_Orden],                     
  [Nivel],                     
  [grado],                     
  F_Ingreso ,                    
  SBruto ,                    
  SDescuentos,                
  SNeto ,                    
  NroCta ,                    
  Banco ,                    
  F_Deposito,                     
  [confirmado],                     
  [Usuario],              
  TipoLiquidacion,            
  opcionjubilatoria,            
  afjp,          
  liquidacion)                    
 VALUES             
 (@id,        
  @Id_Interna ,                    
  @mes ,                    
  @año ,                    
  @Cuil ,                    
  @Id_Oficina ,                    
  @Nro_Orden ,                    
  @Nivel ,                    
  @grado ,                    
  @F_Ingreso ,                    
  @SBruto ,                    
  @SDescuento,                
  @SNeto ,                    
  @NroCta ,                    
  @Banco ,                    
  @F_Deposito ,                    
  @confirmado ,                    
  @Usuario,              
  @TipoLiquidacion,            
  @opcionjubilatoria,            
  @afjp,          
  @liquidacion)                    
            
            
 --select max(Id_recibo)Recibo from dbo.Pla_Recibos               
 select @id Recibo        
            
END            
                
            
            
            
          ' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Estudios_Niveles]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Estudios_Niveles]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GABM_Tabla_Estudios_Niveles]    
 @Operacion char(1),    
 @Id_1  [int]=null,    
 @Descripcion_2  [varchar](50)=null,    
 @Cod_Gest_Pub Char(1) = null,  
 @Orden smallint = Null  
AS     
IF @operacion =''A''    
BEGIN    
 Declare @MAx [int]    
 set @Max = (select max(id)+1 from dbo.Tabla_Estudios_Niveles)    
 IF @Max is null BEGIN    
  set @max=1    
 END  
  
 IF @Orden = 0 BEGIN  
   Set @Orden = (select max(orden)+1 from dbo.Tabla_Estudios_Niveles)  
 END  
    
 INSERT INTO dbo.Tabla_Estudios_Niveles     
   ([Id],    
   Descripcion,  
   Cod_Gest_Pub,  
  Baja,  
  Orden)     
  VALUES     
  ( @max,    
   @Descripcion_2,    
   @Cod_Gest_Pub,  
  0,  
  @Orden)    
END    
    
IF @operacion =''M''    
BEGIN    
 update  dbo.Tabla_Estudios_Niveles    
 set  Descripcion =  @Descripcion_2,  
  Cod_Gest_Pub = @Cod_Gest_Pub,  
 Orden =  @Orden    
 where  id = @Id_1    
END    
    
    
IF @operacion =''B''    
BEGIN    
 update  dbo.Tabla_Estudios_Niveles    
 set  baja =  1    
 where  id = @Id_1    
END    
    
IF @operacion =''R''    
BEGIN    
 update  dbo.Tabla_Estudios_Niveles    
 set  baja =  0    
 where  id = @Id_1    
END    
    
    
IF @operacion =''S''    
BEGIN    
 SELECT Id,    
  Descripcion,    
 Cod_Gest_Pub,  
  case when baja = 1 then    
   ''Si''    
  else    
   ''No''    
  end Baja,  
 Orden     
 FROM  dbo.Tabla_Estudios_Niveles    
 WHERE (id = @ID_1) OR (@ID_1 is null)    
 ORDER BY Orden
END    
    
    
    
    
    
    
    
    
  


' 
END
GO
/****** Object:  View [dbo].[VW_Tabla_Estudios_Niveles]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Estudios_Niveles]'))
EXEC dbo.sp_executesql @statement = N'
create view [dbo].[VW_Tabla_Estudios_Niveles]
AS
SELECT top 100 percent Id, Descripcion 
FROM dbo.Tabla_Estudios_Niveles
WHERE Baja = 0
ORDER BY Descripcion

'
GO
/****** Object:  StoredProcedure [dbo].[RPT_MED_Solicitud_Analisis]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_MED_Solicitud_Analisis]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[RPT_MED_Solicitud_Analisis]     
 @IdApto int = 0,    
 @IdAtencion int = 0    
AS    
    
SELECT  TMA.Descripcion Analisis,  
 CASE WHEN DP.Nro_Documento IS NULL THEN  
  P.Apellido +'', ''+ P.Nombre  
 ELSE  
  DP.Apellido +'', ''+ DP.Nombre  
 END Agente,  
 CASE WHEN DP.Nro_Documento IS NULL THEN  
  P.Nro_Documento  
 ELSE  
  DP.Nro_Documento  
 END Documento,
 FechaSolicitud   
  
FROM dbo.MED_Analisis A    
INNER JOIN dbo.Tabla_Medicos_Analisis TMA    
 ON TMA.Id = A.IdAnalisis  
LEFT JOIN dbo.Datos_Personales DP  
 ON DP.Nro_Documento = A.Nro_Documento  
LEFT JOIN dbo.MED_Pacientes P  
 on P.Nro_Documento = A.Nro_Documento    
WHERE  (IdApto = @IdApto OR IdAtencion = @IdAtencion) AND    
 (SP = 0)    
' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_GET_Analisis_X_Atencion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_Analisis_X_Atencion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[MED_GET_Analisis_X_Atencion]
	@IdAtencion int
AS
SELECT 	IdAnalisis,
	Sp,
	Repite
FROM dbo.MED_Analisis
WHERE IdAtencion = @IdAtencion


' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_DEL_Analisis]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_DEL_Analisis]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create  procedure [dbo].[MED_DEL_Analisis]
	@IdApto int = null,
	@IdAtencion int = null
as

DELETE dbo.MED_Analisis
where 	(IdApto = @IdApto) OR 
	(IdAtencion = @IdAtencion)  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_ADD_Analisis]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_ADD_Analisis]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create  procedure [dbo].[MED_ADD_Analisis]
	@Nro_Documento int,
	@Analisis int,
	@SP bit ,
	@Repite bit,
	@IdApto int = NULL,
	@IdAtencion int = NULL
as

INSERT INTO dbo.MED_Analisis
	(Nro_Documento,
	IdAnalisis,
	FechaSolicitud,
	Sp,
	Repite,
	IdApto,
	IdAtencion)
VALUES
	(@Nro_Documento,
	@Analisis,
	getdate(),
	@SP,
	@Repite,
	@IdApto,
	@IdAtencion)


' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_GET_Analisis_X_Apto]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_Analisis_X_Apto]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[MED_GET_Analisis_X_Apto]
	@IdApto int
AS
SELECT 
	IdAnalisis,
	Sp,
	Repite
FROM dbo.MED_Analisis
WHERE IdApto = @IdApto

' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_Categorias]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_Categorias]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[EVAL_GET_Categorias] @id_nivel smallint
AS
SELECT 
Deficiente, Regular, Bueno, Destacado
FROM dbo.EVAL_Categorias 
WHERE Id_Nivel = @id_nivel
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_UPD_Habilitar_Contrato]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_UPD_Habilitar_Contrato]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_UPD_Habilitar_Contrato]
	@Id_Contrato int
AS

UPDATE dbo.CTR_Contratos
SET Baja = 0
WHERE Id_Contrato = @Id_Contrato


DELETE FROM dbo.CTR_Contratos_Bajas
WHERE Id_Contrato = @Id_Contrato 




' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_CTR_Contratos_Baja]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_CTR_Contratos_Baja]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_GET_CTR_Contratos_Baja]
       @doc int
AS
SELECT c.nro_contrato,
c.baja,
cb.fecha_baja,
c.aprobado 

FROM CTR_Contratos c

LEFT JOIN CTR_Contratos_Bajas cb
	on cb.id_contrato=c.id_contrato

WHERE 
Nro_Contrato=(select max(nro_contrato) from CTR_Contratos where nro_documento=@doc)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Verifica_Contrato_Baja]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Verifica_Contrato_Baja]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[CTR_GET_Verifica_Contrato_Baja]
    @doc int
as

select 	Baja,
	case when baja=0 then
		case when hasta < getdate()then
			hasta
		end 
	else
		b.fecha_baja
	end fecha_baja

from ctr_contratos c
left join CTR_Contratos_Bajas b
	on b.id_contrato=c.Id_contrato 

where aprobado=1 and
Nro_Contrato=(select max(nro_contrato) from CTR_Contratos where Nro_Documento=@doc)






/*
	select aprobado,baja
	from dbo.ctr_contratos 
	where	aprobado=1  and
		Baja=1 and
	Nro_Contrato=(select max(nro_contrato) from CTR_Contratos where Nro_Documento=@doc)
*/
/*
select nro_contrato,baja,fecha_baja,aprobado,cuil_nro 
from CTR_Contratos c 

left join CTR_Contratos_Bajas b
	on b.id_contrato=c.Id_contrato 

inner join datos_personales dp
	on dp.nro_documento=c.nro_documento

where 
Nro_Contrato=(select max(nro_contrato) from CTR_Contratos where Nro_Documento=@doc)
*/
--SET NOCOUNT ON
	--create table #t
	--	(nro_contrato varchar(11))
--	insert into #t
/*	
select max(nro_contrato)
	from dbo.ctr_contratos 
	where	aprobado=1  and
		Baja=1 and
		Nro_Documento=@doc
		--nro_documento not in (select nro_documento from ctr_contratos
			--where --(estado=''R'' or estado=''E'') and 
			--baja=0 and aprobado=0  
			--Nro_Documento=@doc
			--group by nro_documento)
*/
	--group by nro_documento
/*	
select c.nro_contrato,baja,fecha_baja,aprobado,cuil_nro 
from CTR_Contratos c 

left join CTR_Contratos_Bajas b
	on b.id_contrato=c.Id_contrato 

inner join datos_personales dp
	on dp.nro_documento=c.nro_documento

INNER JOIN #t t
	on t.nro_contrato = c.nro_contrato
	
order by DP.Apellido, dp.nombre 

drop table #t
*/






' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_GET_Domicilio_Laboral]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_GET_Domicilio_Laboral]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[PLA_GET_Domicilio_Laboral]
	@id int
AS

SELECT  Fecha_Comunicacion,
	Calle,
	Número,
	Piso,
	Dpto,
	Casa,
	Manzana,
	Barrio,
	Torre,
	UF,
	Codigo_Postal,
	L.nombrelocalidad Localidad,
	Pa.descripcion Partido,
	Pv.nombreprovincia Provincia

FROM [dbo].Domicilio_laboral  D
inner join dbo.localidadesafip L
	on L.idlocalidad = D.localidad
inner join provincias Pv
	on Pv.codafip = L.id_provincia
inner join partidos Pa
	on Pa.partido = L.id_partido

WHERE id_interna = @id 
and id_domicilio = (select max(id_domicilio) from dbo.domicilio_laboral where id_interna = @id)



' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_ADD_Domicilio_Laboral]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_ADD_Domicilio_Laboral]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[PLA_ADD_Domicilio_Laboral]

	(@Fecha_Comunicacion smalldatetime,
	@Calle varchar(50),
	@Número int,
	@Piso varchar(5),
	@Dpto varchar(5), 
	@Casa varchar(10), 
	@Manzana varchar(10),
	@Barrio varchar(20), 
	@Torre varchar(10), 
	@UF varchar(10),
	@Codigo_Postal int,
	@Localidad int,
	@Id_Interna int,
	@Nro_Doc int,
	@Usuario smallint)


as

if exists (select id_domicilio from [dbo].[Domicilio_Laboral] where id_interna = @Id_Interna) 
	begin
	update [dbo].[Domicilio_Laboral]
	set 	[Fecha_Comunicacion]=@Fecha_Comunicacion,
		[Calle]=@Calle,
		[Número]= @Número,
		[Piso]= @Piso,
		[Dpto]= @Dpto,
		[Casa]= @Casa,
		[Manzana]=@Manzana,
		[Barrio]= @Barrio,
		[Torre]= @Torre,
		[UF]= @UF,
		[Codigo_Postal]= @Codigo_Postal,
		[Localidad]= @Localidad,
		[Usuario]=@Usuario

	where [Id_Interna]= @Id_Interna

	end
else
	begin
	DECLARE @IDDOM INT
	set @IDDOM = (select max(id_domicilio)+1 from [dbo].[Domicilio_Laboral])
	IF @iddom is null begin
		set @iddom =1
	END
	
	INSERT INTO [dbo].[Domicilio_Laboral]([Fecha_Comunicacion], [Calle], [Número], [Piso], [Dpto], [Casa], [Manzana], [Barrio], [Torre], [UF], [Codigo_Postal], [Localidad], [Id_Interna], [Nro_Doc], [ID_Domicilio], [Usuario])
	VALUES	(@Fecha_Comunicacion,
		@Calle,
		@Número,
		@Piso,
		@Dpto,
		@Casa,
		@Manzana,
		@Barrio,
		@Torre,
		@UF,
		@Codigo_Postal,
		@Localidad,
		@Id_Interna,
		@Nro_Doc,
		@IDDom, 
		@Usuario)
	

end


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Titulos_X_Nivel]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Titulos_X_Nivel]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'





CREATE       procedure [dbo].[LEG_GET_Titulos_X_Nivel]
 @Nivel smallint ,
	@Titulo varchar(200) = null
AS  
SELECT  distinct ET.Id,  
   ET.Descripcion Titulo  
FROM dbo.Tabla_Estudios_Titulos et  
INNER JOIN dbo.Tabla_Estudios_Relaciones er  
 on er.titulo = et.id  
WHERE er.Nivel = @Nivel AND
	(et.descripcion like ''%'' + @Titulo +''%'' Or @Titulo IS NULL)OR patindex(''%'' + @Titulo +''%'', et.descripcion)<>0

ORDER BY Descripcion





' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Designaciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Designaciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE  procedure [dbo].[LEG_ADD_Designaciones]
	(@Jurisdiccion_1 	[varchar](50),
	 @Organismo_2 	[varchar](50),
	 @Acto_Tipo_4 	[smallint],
	 @Acto_Nro_5 	[varchar](10),
	 @Acto_Fecha_6 	[datetime],
	 @Motivo_7 	[INT],
	 @Folio_8 	[char](10),
	 @Id_Cargo_11 	[smallint],
	 @Id_Interna_12 	[int],
	 @Nro_Doc_13 	[int],
	 @Fecha_desde [datetime],
	 @Id_Tipo_designacion [int],
	 @Usuario smallint,
	 @DatoDeBaja bit,
	 @datonoimprime bit)
AS 
Declare	 @Id_Designacion	[int]
set  @Id_Designacion = (select max(id_designacion)+1 from dbo.designaciones)		
if @Id_Designacion is null begin
	set @Id_Designacion =1
end


-- ACTUALIZA FECHA_HASTA DE LA CARRERA ANTERIOR (CORRESPONDE UN DIA MENOS A LA ASIGNACION DE LA NUEVA CARRERA)
--exec  dbo.LEG_UPD_Cierra_Designaciones   @Fecha_Desde, @Id_Interna_12, @Nro_Doc_13, NULL, @Id_Designacion,@Usuario


-- ALTA DE NUEVA DESIGNACION
INSERT INTO dbo.Designaciones 
	 ( [Jurisdiccion],
	 [Organismo],
	 [Acto_Tipo],
	 [Acto_Nro],
	 [Acto_Fecha],
	 [Motivo],
	 [Folio],
	 [Id_Cargo],
	 [Id_Interna],
	 [Nro_Doc],
	 Fecha_Desde,
	[Id_Designacion],
	Tipo_Designacion,
	usuario,
	DatoDeBaja,
	datonoimprime) 
 
VALUES 
	( @Jurisdiccion_1,
	 @Organismo_2,
	 @Acto_Tipo_4,
	 @Acto_Nro_5,
	 @Acto_Fecha_6,
	 @Motivo_7,
	 @Folio_8,
	 @Id_Cargo_11,
	 @Id_Interna_12,
	 @Nro_Doc_13,
	 @Fecha_Desde,
	@Id_Designacion,
	@Id_Tipo_designacion ,
	@usuario,
	@DatoDeBaja,
	@datonoimprime)



' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Designaciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Designaciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_UPD_Designaciones]
	(@Jurisdiccion_17 	[varchar](50),
	@Organismo_18 	[varchar](50),
	@Acto_Tipo_20 	[smallint],
	@Acto_Nro_21 	[varchar](10),
	@Acto_Fecha_22 	[datetime],
	@Motivo_23 	[int],
	@Folio_24 	[char](10),
	@Id_Cargo_27 [smallint],
	@Id_Interna_28 	[int],
	@Nro_Doc_29 	[int],
	@Fecha_desde_30 	[datetime],
	@Fecha_Hasta 	[datetime]=null,
	@Id_Designacion_32 	[int],
	@Id_Tipo_designacion [int],
	@usuario smallint,
	@datodebaja bit,
	@datonoimprime bit)
AS 
UPDATE [dbo].[Designaciones] 
SET	[Jurisdiccion]	 = @Jurisdiccion_17,
	[Organismo]	 = @Organismo_18,
	[Acto_Tipo]	 = @Acto_Tipo_20,
	[Acto_Nro]	 = @Acto_Nro_21,
	[Acto_Fecha]	 = @Acto_Fecha_22,
	[Motivo]	 = @Motivo_23,
	[Folio]	 = @Folio_24,
	[Id_Cargo] = @Id_Cargo_27,
	[Id_Interna]	 = @Id_Interna_28,
	[Nro_Doc]	 = @Nro_Doc_29,
	[Fecha_desde]	 = @Fecha_desde_30,
	[Fecha_Hasta]	 = @Fecha_Hasta,
	[Tipo_Designacion] = @Id_Tipo_designacion,
	usuario = @usuario,
	datodebaja = @datodebaja,
	datonoimprime = @datonoimprime
WHERE	[Id_Designacion] = @Id_Designacion_32




' 
END
GO
/****** Object:  View [dbo].[VW_AREAS_LEGAJOS]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_AREAS_LEGAJOS]'))
EXEC dbo.sp_executesql @statement = N'

CREATE VIEW [dbo].[VW_AREAS_LEGAJOS] -- VB: Usar VW_Desglose_Area
AS
SELECT     Id_Interna, Area
FROM         dbo.Designaciones
WHERE     (Fecha_hasta = ''01/01/2006'')

/*

ALTER VIEW dbo.VW_Designaciones  VB: Ver campos Utilizados 
AS
SELECT  *
FROM dbo.designaciones

*/

'
GO
/****** Object:  View [dbo].[VW_Designaciones]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Designaciones]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_Designaciones]
AS
SELECT  *
FROM dbo.designaciones


'
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Validar_Fecha_Designacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Validar_Fecha_Designacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_GET_Validar_Fecha_Designacion]
	@Id_interna int,
	@Fecha datetime,
	@Designacion int=null

AS
select id_interna 
from dbo.Designaciones
where id_interna = @Id_interna AND
	fecha_desde =  @fecha AND
	(Id_Designacion <> @Designacion or  @Designacion is null)



' 
END
GO
/****** Object:  StoredProcedure [dbo].[VW_Tabla_Estudios_Tipo_Maquina]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Estudios_Tipo_Maquina]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create procedure [dbo].[VW_Tabla_Estudios_Tipo_Maquina]
As
SELECT Id, Descripcion
FROM dbo.Tabla_Estudios_Tipo_Maquina
WHERE Baja = 0

' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_GET_Modulos_Usuario]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_GET_Modulos_Usuario]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE PROCEDURE [dbo].[RH_GET_Modulos_Usuario]
	@Usuario smallint
AS

SELECT 	m.id, 
	m.caption 
FROM [dbo].Usuarios_modulos UM
INNER JOIN [dbo].modulos M on m.id = UM.id_modulo
WHERE um.id_usuario  = @usuario


' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_GET_Modulos_Sistema]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_GET_Modulos_Sistema]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE  [dbo].[RH_GET_Modulos_Sistema]
AS 
SELECT  Id,
	descripcion   
FROM 	[dbo].[Modulos] 




' 
END
GO
/****** Object:  View [dbo].[VW_RH_Modulos]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_RH_Modulos]'))
EXEC dbo.sp_executesql @statement = N'


CREATE  view [dbo].[VW_RH_Modulos]
as
SELECT top 100 percent *
FROM dbo.modulos
order by descripcion



'
GO
/****** Object:  StoredProcedure [dbo].[GetModulos_Sistema]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetModulos_Sistema]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE  [dbo].[GetModulos_Sistema]
	
AS 
Select  id,descripcion   
from [dbo].[Modulos] 


' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_INS_Evaluacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_INS_Evaluacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[EVAL_INS_Evaluacion] 
@id_evaluacion int output, @id_evaluador int,
@id_evaluado int, @fecha smalldatetime,
@id_formulario int, @id_periodo int, @estado bit, @baja bit
AS

SET NOCOUNT ON;

INSERT INTO dbo.EVAL_Evaluaciones
(fecha, id_evaluado, id_evaluador, id_formulario, id_periodo, estado, baja)
VALUES
(@fecha, @id_evaluado, @id_evaluador, @id_formulario, @id_periodo, @estado, @baja)

SET @id_evaluacion = (SELECT max(id_evaluacion) FROM dbo.EVAL_Evaluaciones)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_Evaluaciones_Periodo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_Evaluaciones_Periodo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE  PROCEDURE [dbo].[EVAL_GET_Evaluaciones_Periodo] 
@id_periodo int 

AS

SELECT 
ev.id_evaluacion, ev.fecha, ev.id_evaluado, ev.id_evaluador, ev.id_formulario, ev.id_periodo, ev.estado,
dpl.id_planta
FROM dbo.Eval_Evaluaciones ev
INNER JOIN dbo.EVAL_Periodos_Evaluacion pe
	on ev.id_periodo = pe.id
inner join dbo.leg_desglose_planta dpl
	on ev.id_evaluado = dpl.id_interna
	and dpl.desde < pe.hasta
WHERE id_periodo = @id_periodo
ORDER BY id_evaluador, dpl.desde desc
' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_Evaluacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_Evaluacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[EVAL_GET_Evaluacion]
@id_evaluacion int

AS

SELECT Ev.fecha, Ev.id_evaluado, Ev.id_evaluador,
Ev.id_formulario, Ev.id_periodo, Ev.estado, Ev.baja,
De.id_pregunta, De.opcion_elegida
FROM dbo.EVAL_Evaluaciones Ev
INNER JOIN dbo.EVAL_Evaluaciones_Detalle De
	on Ev.id_evaluacion = De.id_Evaluacion
WHERE Ev.id_evaluacion = @id_evaluacion
ORDER BY id_pregunta
' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_Evaluacion_Evaluado]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_Evaluacion_Evaluado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[EVAL_GET_Evaluacion_Evaluado] 
@id_evaluado int, @id_periodo int 

AS

SELECT 
E.id_evaluacion, E.fecha, E.id_evaluador, E.id_evaluado,
E.id_formulario, E.id_periodo, E.estado, D.id_pregunta, 
D.opcion_elegida, P.enunciado, F.id_nivel, N.Descripcion Desc_Nivel
FROM dbo.Eval_Evaluaciones E
INNER JOIN dbo.Eval_Evaluaciones_Detalle D
	on E.id_evaluacion = D.id_evaluacion
INNER JOIN dbo.Eval_Preguntas P
	on P.id_pregunta = D.id_pregunta
INNER JOIN dbo.Eval_Formularios F
	on E.id_formulario = f.id_formulario
INNER JOIN dbo.Eval_Niveles N
	on N.id_Nivel = F.id_Nivel
WHERE E.id_evaluado = @id_evaluado And E.id_periodo = @id_periodo
Order by E.id_formulario, E.id_periodo, D.id_evaluacion, D.id_pregunta
' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_Nivel_Evaluacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_Nivel_Evaluacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <24/04/2008>
-- Description:	<Trae el nivel de la ultima evaluacion de un agente respecto del periodo>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_GET_Nivel_Evaluacion]
	@id_periodo int,
    @id_interna int
AS
BEGIN
	SET NOCOUNT ON;

	declare @desde as smalldatetime

	set @desde = (select desde from dbo.Eval_Periodos_Evaluacion where id = @id_periodo)

	SELECT top 1 Fo.id_nivel, Ni.descripcion
	FROM dbo.Eval_Evaluaciones Ev
	INNER JOIN dbo.Eval_Periodos_Evaluacion Pe
		on Ev.id_periodo = Pe.id
	INNER JOIN dbo.Eval_Formularios Fo
		on Fo.id_formulario = Ev.id_formulario
	INNER JOIN dbo.Eval_Niveles Ni
		on Ni.id_nivel = Fo.id_nivel
	WHERE id_evaluado = @id_interna and Pe.desde <= @desde
	ORDER BY Pe.Desde Desc

	END


' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_UPD_Evaluacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_UPD_Evaluacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[EVAL_UPD_Evaluacion] 
@id_evaluacion int, @id_evaluador int,
@id_evaluado int, @fecha smalldatetime,
@id_formulario int, 
@id_periodo int, 
@estado bit, 
@baja bit

AS

SET NOCOUNT ON;

UPDATE dbo.EVAL_Evaluaciones
set fecha = @fecha,
id_evaluado = @id_evaluado,
id_evaluador = @id_evaluador,
id_formulario = @id_formulario,
id_periodo = @id_periodo,
estado = @estado,
baja = @baja
where id_evaluacion = @id_evaluacion
' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Estudios_Titulos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Estudios_Titulos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

Create   PROCEDURE [dbo].[GABM_Tabla_Estudios_Titulos]
 @Operacion char(1),  
 @Id_1  [int]=null,  
 @Descripcion_2  [varchar](200)=null  

AS   
IF @operacion =''A''  
BEGIN  
 Declare @MAx [int]  
 set @Max = (select max(id)+1 from dbo.Tabla_Estudios_Titulos)  
 if @Max is null begin  
  set @max=1  
 end  
 INSERT INTO dbo.Tabla_Estudios_Titulos   
   ([Id],  
   [Descripcion],  
  Baja)   
  VALUES   
  ( @max,  
   @Descripcion_2,  
  0)  
END  
  
IF @operacion =''M''  
BEGIN  
 update  dbo.Tabla_Estudios_Titulos  
 set  [Descripcion] =  @Descripcion_2  
 where  id = @Id_1  
END  
  
  
IF @operacion =''B''  
BEGIN  
 update  dbo.Tabla_Estudios_Titulos  
 set  baja =  1  
 where  id = @Id_1  
END  
  
IF @operacion =''R''  
BEGIN  
 update  dbo.Tabla_Estudios_Titulos  
 set  baja =  0  
 where  id = @Id_1  
END  
  
  
IF @operacion =''S''  
BEGIN  
 SELECT Id,  
  descripcion Descripción,  
  case when baja = 1 then  
   ''Si''  
  else  
   ''No''  
  end Baja   
 FROM  dbo.Tabla_Estudios_Titulos  
 WHERE (id = @ID_1) OR (@ID_1 is null)  
 ORDER BY descripcion  
END  
  
  
  
  
  
  
  
  



' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_INS_Evaluacion_Detalle]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_INS_Evaluacion_Detalle]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[EVAL_INS_Evaluacion_Detalle] 
@id_evaluacion int, @id_pregunta int, @opcion_elegida int
AS

SET NOCOUNT ON;

INSERT INTO dbo.EVAL_Evaluaciones_Detalle
(id_evaluacion, id_pregunta, opcion_elegida)
VALUES
(@id_evaluacion, @id_pregunta, @opcion_elegida)

' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_DEL_Evaluacion_Detalle]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_DEL_Evaluacion_Detalle]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[EVAL_DEL_Evaluacion_Detalle]
@id_evaluacion int,
@id_pregunta int
AS
BEGIN
	SET NOCOUNT ON;

DELETE FROM dbo.EVAL_Evaluaciones_Detalle
WHERE id_evaluacion = @id_evaluacion
AND id_pregunta = id_pregunta
END

' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_UPD_Evaluacion_Detalle]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_UPD_Evaluacion_Detalle]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[EVAL_UPD_Evaluacion_Detalle]
@id_evaluacion int,
@id_pregunta int,
@opcion_elegida int
AS
BEGIN
	SET NOCOUNT ON;

UPDATE dbo.EVAL_Evaluaciones_Detalle
set opcion_elegida = @opcion_elegida
where id_evaluacion = @id_evaluacion and id_pregunta = @id_pregunta

END

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Universidad_X_Facultad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Universidad_X_Facultad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE  procedure [dbo].[LEG_GET_Universidad_X_Facultad]
	 @Facultad int
AS
SELECT  distinct EU.Id ,
	EU.Descripcion Universidad
FROM dbo.Tabla_Estudios_Uni_Facultad Uf
INNER JOIN dbo.Tabla_Estudios_Universidades EU
	on EU.iD = UF.Universidad
WHERE 	Facultad = @Facultad AND
	eU.Baja = 0 
	
	



' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Estudios_Uni_Facultad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Estudios_Uni_Facultad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[GABM_Tabla_Estudios_Uni_Facultad]    
 @Operacion char(1),      
 @Id_1  [int]=null,      
 @Universidad int = Null,  
 @Facultad int = NULL  
AS       
IF @operacion =''A''      
BEGIN      
 Declare @MAx [int]      
 set @Max = (select max(id)+1 from dbo.Tabla_Estudios_Uni_Facultad)      
 if @Max is null begin      
  set @max=1      
 end      
 INSERT INTO dbo.Tabla_Estudios_Uni_Facultad       
   ([Id],      
   universidad,  
 facultad,  
 baja)       
  VALUES       
  ( @max,      
   @Universidad,  
 @Facultad,  
  
  0)      
END      
      
--IF @operacion =''M''      
--BEGIN      
-- update  dbo.Tabla_Estudios_Uni_Facultad      
-- set  [Descripcion] =  @Descripcion_2      
-- where  id = @Id_1      
--END      
      
      
IF @operacion =''B''      
BEGIN      
 delete dbo.Tabla_Estudios_Uni_Facultad      
 where  Facultad = @Facultad
END      
      
--IF @operacion =''R''      
--BEGIN      
-- update  dbo.Tabla_Estudios_Uni_Facultad      
-- set  baja =  0      
-- where  id = @Id_1      
--END      
      
      
--IF @operacion =''S''      
--BEGIN      
-- SELECT Id,      
--   Descripcion,      
--   case when baja = 1 then      
--    ''Si''      
--   else      
  --  ''No''      
--   end Baja       
-- FROM  dbo.Tabla_Estudios_Uni_Facultad      
-- WHERE (id = @ID_1) OR (@ID_1 is null)      
-- ORDER BY Descripcion    
--END      
      
      
      
      
      
      
      
      
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Seleccion_Contratos_Consulta2]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/****** Object:  StoredProcedure [dbo].[CTR_GET_Generados_Memo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Generados_Memo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Generados_Memo]                   
 @usuario int,                
 @Ope int = 1          
as                    
                    
set nocount on                  
             
declare @fecha datetime  
SET @fecha = (select fecha_impresion from CTR_Tabla_Configuracion)  
       
create table #Cod_Area                                          
(id_area int)                                      
                  
insert into #cod_area                                          
select Id_Area                                   
from RH_USUARIOS_AREAS                                  
where Id_Usuario = @usuario                                  
                  

--MEMOS GENERADOS PARA RENOVAR                  
IF @ope = 1           
BEGIN          
 select  Memo,                  
  Renovar,                  
  convert(char(10),fecha,103)  fecha,   
  usuario,                          
  isnull(usuario_rrhh,0) usuario_rrhh,                  
  count(*) cantidad                  
 from dbo.ctr_seleccion_contratos                  
 where id_area in (select id_area from #cod_area)                  
 and (memo <> 0)                  
 and convert(datetime,fecha) between convert(datetime,''01/06/''+ convert(char(4),year(@fecha))) and convert(datetime,''01/06/''+ convert(char(4),year(@fecha)+1))            
 group by Memo,                  
 Renovar,                  
 fecha,                  
 usuario,                  
 usuario_rrhh                
 order by memo      
  
END          
          

--RECEPCION DE LOS MEMOS          
IF @ope = 2           
BEGIN          
    
create table #tempo    
(    
Memo int,    
Renovar char(1),    
fecha char(10),    
id_usuario int,    
usuario_rrhh int,     
cantidad int,    
doc int,    
area varchar(200),    
ape_nom varchar(200),    
usuario varchar(50)    
)    
    
INSERT INTO #tempo    
 select  Memo,                  
  Renovar,                  
  convert(char(10),fecha,103)  fecha,                
  c.usuario,                  
  isnull(usuario_rrhh,0) usuario_rrhh,                  
  count(*) cantidad,    
  ud.mail,    
  null,    
  null,    
  null                
 from dbo.ctr_seleccion_contratos c        
    
 INNER JOIN dbo.rh_usuarios_detalles ud              
  on ud.Id_Usuario = c.usuario      
          
 where memo <> 0      
 group by Memo,                  
 Renovar,                  
 fecha,                  
 c.usuario,              
 usuario_rrhh,    
 ud.mail                 
 order by memo           
    
    
UPDATE t      
SET  area = ta.descripcion  ,    
 ape_nom = dp.apellido +'', ''+ dp.nombre,    
 usuario = u.Nombre    
from #tempo t      
      
INNER JOIN dbo.rh_usuarios u              
 on u.Id = t.id_usuario      
     
INNER JOIN dbo.datos_personales dp              
 on dp.nro_documento = t.doc        
    
INNER JOIN dbo.vw_desglose_area da              
 on da.documento = dp.nro_documento              
              
INNER JOIN dbo.tabla_areas ta              
 on ta.id = da.id_area      
    
  
Select     
Memo,    
Renovar,    
fecha,    
id_usuario,    
usuario_rrhh,     
cantidad,    
doc,    
area,    
ape_nom,    
usuario     
from #tempo    
WHERE convert(datetime,fecha) between convert(datetime,''01/06/''+ convert(char(4),year(@fecha))) and convert(datetime,''01/06/''+ convert(char(4),year(@fecha)+1))                

END          
        
      ' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_ADD_Tabla_Configuracion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ADD_Tabla_Configuracion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_ADD_Tabla_Configuracion]
	@Fecha_Impresion_Dia bit = 0,
	@Fecha_Impresion smalldatetime = null
as

delete from dbo.CTR_Tabla_Configuracion

insert into dbo.CTR_Tabla_Configuracion
values (@Fecha_Impresion_Dia,@Fecha_Impresion)




' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Seleccion_Contratos_Consulta]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Seleccion_Contratos_Consulta]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Seleccion_Contratos_Consulta]      
                  
as
set nocount on                                      

declare @fecha datetime    
SET @fecha = (select fecha_impresion from CTR_Tabla_Configuracion)    
                                        
create table #T                                        
(tipo_contrato varchar(50),                                              
id_contrato int,  
Nro_Documento int,                                                 
Apellido varchar(100),                                                
Nombre varchar(100),                                                
Nro_Contrato varchar(11),                                                 
Desde smalldatetime,                                                 
Hasta smalldatetime,                                                 
Estado varchar(20),                                                
nivel varchar(50),              
Area_Real varchar(300),                                              
exp_nro varchar(30),                                                                                
aprobado int,                                            
renovar varchar(50),      
id_area_contrato int,                                  
Memo int,      
usuario varchar(200),      
doc_usuario int      
)                                        
                                        
                          
insert into #T                                            
select                                          
tc.descripcion Tipo_Contrato,      
c.id_contrato,                                          
c.Nro_Documento,                                                 
dp.Apellido,                                                
dp.Nombre,                                                
Nro_Contrato,                                                 
convert(char(10),c.Desde,103) Desde,                                                 
convert(char(10),c.Hasta,103) Hasta,                                                 
case when aprobado=1 then                                                
 ''Aprobado''                                                
else                                                
 ''En Tramite''                                
end Estado,                                                
                      
case when C.nivel is not null then                  
 TN.nivel              
else                  
 FC.descripcion              
end Nivel,                
              
null, -- Area_Real,          
                                          
c.exp_nro Expediente,                                            
c.Aprobado ,                                            
case s.renovar      
 when ''R'' then ''Renovado''      
 when ''N'' then ''No Renovado''      
 else ''''      
end Renovar,      
c.id_area Id_Area_Contrato,                      
isnull(s.Memo,0)memo,      
dp2.apellido +'', ''+ dp2.nombre,      
dp2.nro_documento      
                                  
from dbo.ctr_contratos c                                                
                                                     
inner join dbo.datos_personales DP                                                
 on DP.nro_documento = c.nro_documento                                                
                                              
inner join dbo.Tabla_Resoluciones_Contratos TC                                   
 on TC.id = c.tipo_contrato                                                
                                        
left join dbo.tabla_niveles TN                                                
 on tn.id = c.nivel                      
                                               
left join dbo.ctr_seleccion_contratos S                                            
 --	on s.id_contrato = c.id_contrato                  
	on s.nro_documento = c.nro_documento
	and convert(datetime,s.fecha) between convert(datetime,''01/06/''+ convert(char(4),year(@fecha))) and convert(datetime,''01/06/''+ convert(char(4),year(@fecha)+1))              
                                              
left join dbo.Tabla_Funciones_Contratos FC              
 on FC.id = C.funcion              
               
      
left JOIN dbo.rh_usuarios_detalles ud                
 on ud.Id_Usuario = s.usuario        
      
left JOIN dbo.datos_personales dp2                
 on dp2.nro_documento = ud.mail          
      
              
where  c.baja=0                           
 and c.nro_contrato = (select max(nro_contrato) from dbo.ctr_contratos c2 where c2.nro_documento = c.nro_documento and exp_nro is not null)                                              
       
                                  
update #T                                     
set Area_Real = TA2.descripcion                                           
from #T t                                             
                                  
inner join dbo.tabla_areas TA                                   
 on TA.id = t.Id_Area_Contrato                                     
                                  
inner join dbo.vw_desglose_area da                                                
 on  da.documento = t.nro_documento                                               
                                                
inner join dbo.tabla_areas TA2                                                
 on TA2.id = da.id_area                                                
                                  
inner join dbo.Tabla_Areas_Estructura E                                  
 on E.id_area = da.id_area                                  
                                                        
             
      
            
select       
Tipo_Contrato ,            
id_contrato,                                    
Nro_Contrato ,                                                 
Nro_Documento ,                                                 
Apellido ,                                                
Nombre ,                                                
Desde ,                                                 
Hasta ,                                                 
Estado ,                                                                                       
Nivel ,              
Area_Real Lugar_de_Trabajo ,                                              
Exp_Nro ,                                            
Renovar Accion,       
Memo,      
Usuario,      
Doc_Usuario       
from #T      
order by Apellido, Nombre
' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_ADM_Firmantes_DDJJ]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_ADM_Firmantes_DDJJ]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[PLA_ADM_Firmantes_DDJJ]  
	 @Operacion CHAR(1),  
	 @Legajo int=Null,  
	 @Certificante bit=NULL,
	 @NoCertificar bit=NULL  
AS  
IF @Operacion = ''A'' BEGIN  
	 INSERT INTO dbo.PLA_Certificantes_DDJJ  
	 VALUES (@Legajo, @Certificante, @NoCertificar)  
END  
  
IF @Operacion = ''B'' BEGIN  
	DELETE FROM dbo.PLA_Certificantes_DDJJ  
	WHERE Documento = @Legajo  
END  
  
IF @Operacion = ''M'' BEGIN  
	UPDATE 	dbo.PLA_Certificantes_DDJJ  
	SET 	Certificante = @Certificante,
		NoCertificar = @NoCertificar
	WHERE 	Documento = @Legajo  
END  
  
IF @Operacion = ''S'' BEGIN  
	SELECT  FF.Documento,
		DP.Apellido +'', ''+ DP.Nombre Apellido,  
		case when ff.Certificante = 1 then ''Si'' else ''No'' end Certificante,
		case when ff.NoCertificar  = 1 then ''Si'' else ''No'' end NoCertificar
	FROM 	dbo.PLA_Certificantes_DDJJ FF  
	INNER JOIN dbo.Datos_Personales DP  
		ON DP.Nro_Documento = FF.Documento  
END  




' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Estudios_Universidades]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Estudios_Universidades]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create  PROCEDURE [dbo].[GABM_Tabla_Estudios_Universidades]
 @Operacion char(1),  
 @Id_1  [int]=null,  
 @Descripcion_2  [varchar](200)=null  
AS   
IF @operacion =''A''  
BEGIN  
 Declare @MAx [int]  
 set @Max = (select max(id)+1 from dbo.Tabla_Estudios_Universidades)  
 if @Max is null begin  
  set @max=1  
 end  
 INSERT INTO dbo.Tabla_Estudios_Universidades   
   ([Id],  
   [Descripcion],  
  Baja)   
  VALUES   
  ( @max,  
   @Descripcion_2,  
  0)  
END  
  
IF @operacion =''M''  
BEGIN  
 update  dbo.Tabla_Estudios_Universidades  
 set  [Descripcion] =  @Descripcion_2  
 where  id = @Id_1  
END  
  
  
IF @operacion =''B''  
BEGIN  
 update  dbo.Tabla_Estudios_Universidades  
 set  baja =  1  
 where  id = @Id_1  
END  
  
IF @operacion =''R''  
BEGIN  
 update  dbo.Tabla_Estudios_Universidades  
 set  baja =  0  
 where  id = @Id_1  
END  
  
  
IF @operacion =''S''  
BEGIN  
 SELECT Id,  
  	Descripcion,  
	  case when baja = 1 then  
	   ''Si''  
	  else  
	   ''No''  
	  end Baja   
 FROM  dbo.Tabla_Estudios_Universidades  
 WHERE (id = @ID_1) OR (@ID_1 is null)  
 ORDER BY Descripcion
END  
  
  
  
  
  
  
  
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Universidades]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Universidades]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE   procedure [dbo].[LEG_GET_Universidades]  
	@Nombre as varchar(200)=null
  
AS  
  
SELECT id,  
       Descripcion Universidad  
FROM  dbo.Tabla_Estudios_Universidades  
WHERE 
	(Descripcion Like +''%'' + @Nombre +''%'' or @Nombre IS NULL) AND
	Baja = 0  OR patindex(''%'' + @Nombre +''%'', Descripcion)<>0  
 ORDER BY Descripcion


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_DatosPersonales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_DatosPersonales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CRED_Get_DatosPersonales] 
@DocumentoPersona int
as
select 
pr.Documento,
pr.Apellido,
pr.Nombre,
isnull(pr.Lugar_de_trabajo,'''') LugarDeTrabajo,
isnull(pr.Telefono,'''') Telefono,
isnull(pr.Email_mds, '''') Email_MDS,
isnull(pr.Email_personal,'''') Email_Personal,
isnull(pr.Fecha_comunicacion,'''') FechaDeComunicacion,
isnull(cd.Calle,'''') Calle,
isnull(cd.Numero,'''') Numero,
isnull(cd.Piso,'''') Piso,
isnull(cd.Depto,'''') Depto,
isnull(cd.Casa,'''') Casa,
isnull(cd.Manzana,'''') Manzana,
isnull(cd.Torre, '''') Torre,
isnull(cd.Uf, '''') Uf,
--isnull(cd.Codigo_postal, '''') CodigoPostal,
--isnull(cd.Localidad,'''') Localidad,
isnull(cd.Barrio,'''') Barrio,
isnull(cd.IdLocalidad,'''') IdLocalidad,
ISNULL (localidadesAFIP.codigopostal, '''') CodigoPostal,
ISNULL (localidadesAFIP.nombrelocalidad, '''') NombreLocalidad,
ISNULL (part.Descripcion, '''') NombreMunicipio,
ISNULL (prov.nombreProvincia, '''') NombreProvincia
from dbo.CRED_PersonasRelevadas pr inner join  dbo.CRED_Domicilios cd
on pr.Documento = cd.Documento
LEFT JOIN dbo.LocalidadesAFIP localidadesAFIP 
ON cd.IdLocalidad = localidadesAFIP.idLocalidad
LEFT JOIN dbo.Partidos part
ON localidadesAFIP.ID_Partido = part.Partido
LEFT JOIN dbo.Provincias prov
ON prov.codAFIP = localidadesAFIP.id_provincia
 where pr.Documento = @DocumentoPersona' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetProvinciasPorCP]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetProvinciasPorCP]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GetProvinciasPorCP] (@cpos smallint)
AS
SELECT p.codafip Id , P.[nombreProvincia]
FROM [dbo].[LocalidadesAFIP] L
LEFT JOIN [dbo].[Provincias] P
ON L.[id_provincia] = P.[codAFIP] 
WHERE L.[codigopostal] = @cpos
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_Localidades]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_Localidades]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CRED_Get_Localidades]
	@IdLocalidad int
AS
BEGIN
	--SELECT id, codigo_postal, id_localidad, nombre_localidad
	--FROM dbo.CRED_Localidades
SELECT 
localidadesAFIP.codigopostal Codigo_Postal,
localidadesAFIP.nombrelocalidad NombreLocalidad,
par.Descripcion NombreMunicipio,
prov.nombreProvincia NombreProvincia

FROM dbo.LocalidadesAFIP localidadesAFIP
LEFT JOIN dbo.Partidos par
ON par.Partido = localidadesAFIP.ID_Partido
LEFT JOIN dbo.Provincias prov
ON prov.codAFIP = localidadesAFIP.id_provincia
where idLocalidad = @IdLocalidad
END' 
END
GO
/****** Object:  StoredProcedure [dbo].[CGet_CDomicilio]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CGet_CDomicilio]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[CGet_CDomicilio]
	(@Legajo_1 	[int])

AS 
select     cd.Legajo,
	 cd.Calle,
	 cd.Nro,
	 cd.Ppiso,
	 cd.Dpto,
	 cd.CP,
	 cd.ID_localidad,
	 cd.Id_provincia,
	la.nombrelocalidad Localidad,
	p.nombreprovincia Provincia

from  [dbo].[CDomicilio] cd 

inner join dbo.localidadesafip la
	on la.idlocalidad= cd.id_localidad

inner join dbo.provincias p
	on p.codafip= cd.id_provincia

where legajo = @Legajo_1

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_DomicilioPorDNI]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_DomicilioPorDNI]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CRED_Get_DomicilioPorDNI]
@Documento int
as
SELECT dom.id, dom.Documento, dom.Calle, dom.Numero, dom.Piso, dom.Depto, dom.Casa, dom.Manzana, dom.Torre, dom.Uf, 
isnull(dom.IdLocalidad, 0) IdLocalidad, isnull(localidadesAFIP.codigopostal,0) Codigo_Postal, isnull(localidadesAFIP.nombrelocalidad, '''') NombreLocalidad, dom.Barrio, isnull(part.Descripcion, '''') NombreMunicipio, isnull(prov.nombreProvincia, '''') NombreProvincia
FROM 
	dbo.CRED_Domicilios dom 
LEFT JOIN dbo.LocalidadesAFIP localidadesAFIP 
ON dom.IdLocalidad = localidadesAFIP.idLocalidad
LEFT JOIN dbo.Partidos part
ON localidadesAFIP.ID_Partido = part.Partido
LEFT JOIN dbo.Provincias prov
ON prov.codAFIP = localidadesAFIP.id_provincia
	WHERE 
		dom.Documento = @Documento ' 
END
GO
/****** Object:  StoredProcedure [dbo].[Cred_Get_Cred_Get_DatosParaMigracionAltas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Cred_Get_Cred_Get_DatosParaMigracionAltas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'/*
Este procedimiento obtiene todas las personas activas con su credencial asignada, para ser migrados a INWIN
*/
Create Procedure [dbo].[Cred_Get_Cred_Get_DatosParaMigracionAltas]
as
select	persRel.Apellido + '', '' + persRel.Nombre [Apellido y Nombres], persRel.Documento Documento, 
		cred.CodigoMagnetico,
		cred.IdTipo,
		conRel.Descripcion,
		asig.fecha,
		persRel.Lugar_de_trabajo,
		org.Descripcion,
		persRel.Documento,
		dom.Calle +dom.Numero + dom.Piso,
		dom.Barrio,
		localAfip.nombrelocalidad,
		prov.nombreProvincia,
		persRel.Telefono
from dbo.CRED_PersonasRelevadas persRel
inner join dbo.CRED_Domicilios dom
ON persRel.Documento = dom.Documento
inner join dbo.CRED_Personas pers
ON pers.Documento = persRel.Documento
inner join dbo.CRED_Asignaciones asig
ON asig.IdPersona = pers.Id
inner join dbo.CRED_Credenciales cred
ON cred.Id = asig.IdCredencial
inner join dbo.CRED_PedidoAltaPersonas pedAlta
ON pedAlta.IdPersona = pers.Id
inner join dbo.CRED_ConceptoRelacion conRel
ON conRel.Id = pedAlta.IdConceptoRelacion
inner join dbo.CRED_Organismos org
ON org.Id = pedAlta.IdOrganismo
left join dbo.LocalidadesAFIP localAfip
ON localAfip.idLocalidad = dom.IdLocalidad
left join dbo.Partidos part
ON part.Partido = localAfip.ID_Partido
left join dbo.Provincias prov
ON prov.codAFIP = localAfip.id_provincia
WHERE asig.IdBaja is null
AND cred.CodigoMagnetico <> 0
order by asig.fecha



' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetLocalidadesXLocalidad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetLocalidadesXLocalidad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GetLocalidadesXLocalidad]

 (@loc [varchar](100))
AS
SELECT L.[codigopostal], L.[nombrelocalidad],  P.[nombreProvincia], L.idLocalidad
FROM [dbo].[LocalidadesAFIP] L
LEFT JOIN [dbo].[Provincias] P
ON L.[id_provincia] = P.[codAFIP] 

WHERE L.[nombrelocalidad] like @loc 
order by nombrelocalidad,nombreprovincia








' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_DatosDeLocalidad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_DatosDeLocalidad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create PROCEDURE [dbo].[CRED_Get_DatosDeLocalidad]
	
AS
BEGIN
	
	Select localidadAFIP.IdLocalidad, isnull(localidadAFIP.codigopostal,0) CodigoPostal, isnull(localidadAFIP.nombrelocalidad, '''') NombreLocalidad, isnull(part.Descripcion, '''') NombreMunicipio,
		 isnull(prov.nombreProvincia, '''') NombreProvincia
	from dbo.LocalidadesAFIP localidadAFIP
	LEFT JOIN dbo.Provincias prov
		on localidadAFIP.id_provincia = prov.codAFIP
	LEFT JOIN dbo.Partidos part
		on localidadAFIP.ID_Partido = part.Partido
	
END' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_HistoricoDeEntrevistasByDni]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_HistoricoDeEntrevistasByDni]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create PROCEDURE [dbo].[CRED_Get_HistoricoDeEntrevistasByDni]
	@DocumentoPersona int
AS
select 
	pr.Documento,
	pr.Apellido,
	pr.Nombre,
	isnull(pr.Lugar_de_trabajo,'''') LugarDeTrabajo,
	isnull(pr.Telefono,'''') Telefono,
	isnull(pr.Email_mds, '''') Email_MDS,
	isnull(pr.Email_personal,'''') Email_Personal,
	isnull(pr.Fecha_comunicacion,'''') FechaDeComunicacion,
	isnull(cd.Calle,'''') Calle,
	isnull(cd.Numero,'''') Numero,
	isnull(cd.Piso,'''') Piso,
	isnull(cd.Depto,'''') Depto,
	isnull(cd.Casa,'''') Casa,
	isnull(cd.Manzana,'''') Manzana,
	isnull(cd.Torre, '''') Torre,
	isnull(cd.Uf, '''') Uf,
	isnull(cd.Barrio,'''') Barrio,
	isnull(cd.IdLocalidad,'''') IdLocalidad,
	ISNULL (localidadesAFIP.codigopostal, '''') CodigoPostal,
	ISNULL (localidadesAFIP.nombrelocalidad, '''') NombreLocalidad,
	ISNULL (part.Descripcion, '''') NombreMunicipio,
	ISNULL (prov.nombreProvincia, '''') NombreProvincia
from dbo.CRED_PersonasRelevadasHistorica pr 
inner join  dbo.CRED_Domicilios cd
	on pr.Documento = cd.Documento
LEFT JOIN dbo.LocalidadesAFIP localidadesAFIP 
	ON cd.IdLocalidad = localidadesAFIP.idLocalidad
LEFT JOIN dbo.Partidos part
	ON localidadesAFIP.ID_Partido = part.Partido
LEFT JOIN dbo.Provincias prov
	ON prov.codAFIP = localidadesAFIP.id_provincia
where pr.Documento = @DocumentoPersona

' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetLocalidad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetLocalidad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GetLocalidad] (@localidad int)  
AS  
SELECT L.[idLocalidad], L.[nombrelocalidad], L.[codigopostal], P.[nombreProvincia],  
PA.partido,pa.descripcion DescPartido  ,
L.Id_Provincia
FROM [dbo].[LocalidadesAFIP] L  
LEFT JOIN [dbo].[Provincias] P  
 ON L.[id_provincia] = P.[codAFIP]   
left join dbo.Partidos PA  
 on PA.Partido = L.id_partido  
  
WHERE L.[idLocalidad] = @localidad  
  
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetLocalidadesPorCP]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetLocalidadesPorCP]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GetLocalidadesPorCP] (@cpos smallint)  
AS  
SELECT L.[idLocalidad], L.[nombrelocalidad], L.[codigopostal], P.[nombreProvincia]  
FROM [dbo].[LocalidadesAFIP] L  
LEFT JOIN [dbo].[Provincias] P  
ON L.[id_provincia] = P.[codAFIP]   
WHERE L.[codigopostal] = @cpos   AND
L.Baja = 0
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[Cred_Get_DomiciliosActuales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Cred_Get_DomiciliosActuales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[Cred_Get_DomiciliosActuales]
as

select per.Documento, per.Apellido, per.Nombres, persRelev.Fecha_comunicacion, tipoCred.Descripcion, dom.Barrio, dom.Calle, dom.Numero, dom.Casa, dom.Codigo_postal, dom.Depto,
dom.Localidad, dom.Manzana, dom.Piso, dom.Torre, dom.Uf, dom.IdLocalidad, partidos.Descripcion Partido, prov.nombreProvincia NombreProvincia
from dbo.CRED_Personas per
INNER JOIN dbo.CRED_Domicilios dom
ON per.Documento = dom.Documento
INNER JOIN dbo.LocalidadesAFIP localAfip
ON dom.IdLocalidad = localAfip.idLocalidad
INNER JOIN dbo.Partidos partidos
ON localAfip.ID_Partido = partidos.Partido
INNER JOIN dbo.Provincias prov
ON prov.codAFIP = localAfip.id_provincia
INNER JOIN dbo.CRED_CredencialesAsignablesAPersonas credAsig
ON per.Id = credAsig.IdPersona
INNER JOIN dbo.CRED_TiposCredenciales tipoCred
ON tipoCred.Id = credAsig.IdTipoCredencial
INNER JOIN dbo.CRED_PersonasRelevadas persRelev
ON persRelev.Documento = per.Documento

' 
END
GO
/****** Object:  View [dbo].[VW_Localidades]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Localidades]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_Localidades]
AS
SELECT     L.idLocalidad AS IDLoc, L.codigopostal AS CP, L.nombrelocalidad AS Loc, P.idProvincia AS IDProv, P.nombreProvincia AS Prov, 
                      L.ID_Partido AS IDPartido, dbo.Partidos.Descripcion AS Partido
FROM         dbo.localidadesafip L INNER JOIN
                      dbo.Provincias P ON P.idProvincia = L.id_provincia INNER JOIN
                      dbo.Partidos ON L.ID_Partido = dbo.Partidos.Partido

'
GO
/****** Object:  StoredProcedure [dbo].[Cred_Get_DatosParaMigracionModificaciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Cred_Get_DatosParaMigracionModificaciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'/*
Este procedimiento obtiene las personas a las cuales 
se les asignó más de una credencial, y el código magnético asignado.
*/
Create procedure [dbo].[Cred_Get_DatosParaMigracionModificaciones]
as

select	persRel.Apellido + '', '' + persRel.Nombre [Apellido y Nombres], persRel.Documento Documento, 
		cred.CodigoMagnetico,
		asig.IdBaja,
		asig.Fecha,
		conRel.Descripcion,
		persRel.Lugar_de_trabajo,
		org.Descripcion,
		persRel.Documento,
		dom.Calle +dom.Numero + dom.Piso,
		dom.Barrio,
		localAfip.nombrelocalidad,
		prov.nombreProvincia,
		persRel.Telefono
from dbo.CRED_PersonasRelevadas persRel
inner join dbo.CRED_Domicilios dom
ON persRel.Documento = dom.Documento
inner join dbo.CRED_Personas pers
ON pers.Documento = persRel.Documento
inner join dbo.CRED_Asignaciones asig
ON asig.IdPersona = pers.Id
inner join dbo.CRED_Credenciales cred
ON cred.Id = asig.IdCredencial
inner join dbo.CRED_PedidoAltaPersonas pedAlta
ON pedAlta.IdPersona = pers.Id
inner join dbo.CRED_ConceptoRelacion conRel
ON conRel.Id = pedAlta.IdConceptoRelacion
inner join dbo.CRED_Organismos org
ON org.Id = pedAlta.IdOrganismo
left join dbo.LocalidadesAFIP localAfip
ON localAfip.idLocalidad = dom.IdLocalidad
left join dbo.Partidos part
ON part.Partido = localAfip.ID_Partido
left join dbo.Provincias prov
ON prov.codAFIP = localAfip.id_provincia
WHERE asig.idPersona in (select asignaciones.IdPersona from dbo.cred_asignaciones asignaciones
group by asignaciones.IdPersona HAVING COUNT(asignaciones.IdPersona) > 1)
AND cred.CodigoMagnetico <> 0 AND asig.IdBaja is null
order by asig.Fecha






' 
END
GO
/****** Object:  View [dbo].[VW_Provincias]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Provincias]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_Provincias]
AS SELECT [Provincias].[idProvincia], [Provincias].[nombreProvincia], [Provincias].[codAFIP]
FROM dbo.[Provincias]


'
GO
/****** Object:  StoredProcedure [dbo].[ASIS_Graba_ObservCardex]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Graba_ObservCardex]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[ASIS_Graba_ObservCardex] 
@Nro_Documento [int],
@Periodo [int],
@Observaciones varchar (1500)
AS

Declare @obs  varchar (1500)

set @obs =  (SELECT Observaciones FROM DBO.Asis_OBSERVACIONES_CARDEX WHERE Nro_Documento = @Nro_Documento AND Periodo = @Periodo)
	
if  @obs is null begin
	INSERT INTO ASIS_OBSERVACIONES_CARDEX (Nro_Documento, Periodo, Observaciones) VALUES (@Nro_Documento, @Periodo, @Observaciones)
end
if not @obs is null begin
	update ASIS_OBSERVACIONES_CARDEX set Observaciones = @Observaciones where Nro_Documento = @Nro_Documento and Periodo = @Periodo
end


' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_GET_Embarazadas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_Embarazadas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create   PROCEDURE [dbo].[MED_GET_Embarazadas]  
	@Nro_Documento int = NULL  
AS  
SELECT	id,
	Convert(char(10),FechaProbable,103) FechaProbable, 
	convert(char(10),isnull(FechaParto,''''),103)	FechaParto,
	CASE WHEN IdLicencia IS NULL THEN
		''No''
	ELSE
		''Si''
	END	Licencia
FROM dbo.MED_Embarazadas
WHERE Nro_Documento = @Nro_Documento AND
	Baja = 0
ORDER BY FechaProbable Desc


' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_GET_Embarazo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_Embarazo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create PROCEDURE [dbo].[MED_GET_Embarazo]    
 @Id int   
AS    
SELECT id,  
 Convert(char(10),FechaProbable,103) FechaProbable,   
 ISNULL(ObservacionesPreParto,'''') ObservacionesPreParto,  
 convert(char(10),isnull(FechaParto,''''),103) FechaParto,  
 ISNULL(ObservacionesPosParto,'''') ObservacionesPosParto,
 ISNULL(IdLicencia,'''') IdLicencia
FROM dbo.MED_Embarazadas  
WHERE Id = @Id  
  
  
' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_ADD_Embarazadas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_ADD_Embarazadas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create PROCEDURE [dbo].[MED_ADD_Embarazadas]           
 @Nro_documento int,     
 @FechaPreParto smalldatetime,     
 @ObservacionesPreParto Text = NULL,  
 @FechaParto smalldatetime = NULL,  
 @ObservacionesPosParto text = NULL,  
 @IdLicencia int = NULL  
AS          
SET NOCOUNT ON
INSERT INTO dbo.MED_Embarazadas           
	 (Nro_documento,  
	 FechaProbable,  
	 ObservacionesPreParto,  
	 FechaParto,  
	 ObservacionesPosParto,  
	 IdLicencia)          
 VALUES          
	  (@Nro_documento,  
	 @FechaPreParto,  
	 @ObservacionesPreParto,  
	 @FechaParto,  
	 @ObservacionesPosParto,  
	 @IdLicencia)          

SELECT max(Id)IdEmbarazo from dbo.MED_Embarazadas
          
    
    
   
' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_UPD_Embarazo_Licencia]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_UPD_Embarazo_Licencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[MED_UPD_Embarazo_Licencia]  
 @IdEmbarazo int,  
 @IdLicencia int  
AS  
UPDATE dbo.MED_Embarazadas
SET IdLicencia = @IdLicencia  
WHERE Id = @IdEmbarazo

' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_UPD_Embarazadas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_UPD_Embarazadas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[MED_UPD_Embarazadas]           
 @Nro_documento int,     
 @FechaPreParto smalldatetime,     
 @ObservacionesPreParto Text = NULL,  
 @FechaParto smalldatetime = NULL,  
 @ObservacionesPosParto text = NULL,
 @IdLicencia int = Null,
 @IdEmbarazo  int
AS          
UPDATE dbo.MED_Embarazadas           
SET	FechaProbable= @FechaPreParto,  
	ObservacionesPreParto= @ObservacionesPreParto,  
	FechaParto= @FechaParto,  
	ObservacionesPosParto=  @ObservacionesPosParto,
	IdLicencia = @IdLicencia
WHERE Id =@IdEmbarazo




' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_ADD_Facturas_Detalle]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ADD_Facturas_Detalle]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_ADD_Facturas_Detalle]
	(@Id_Factura_1 	[int],
	 @Mes_Factura_2 	[int],
	 @Año_Factura_3 	[int],
	 @Monto_Factura_4 	[money],
	@Id_Contrato		int)

AS 
INSERT INTO [dbo].[CTR_Facturas_Detalle] 
	 ( [Id_Factura],
	 [Mes_Factura],
	 [Año_Factura],
	 [Monto_Factura],
	Id_Contrato) 
 
VALUES 
	( @Id_Factura_1,
	 @Mes_Factura_2,
	 @Año_Factura_3,
	 @Monto_Factura_4,
	@Id_Contrato)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_ADD_Recibos_Detalles]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_ADD_Recibos_Detalles]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[PLA_ADD_Recibos_Detalles]            
 @Id_recibo int,          
 @Id_interna int,             
 @Mes smallint,            
 @Año smallint,            
 @Concepto varchar(10),            
 @Aporte float  = 0,            
 @Descuento float = 0,        
 @TipoConcepto varchar(2)           
        
AS     
  
IF ltrim(rtrim(@Concepto)) = ''BORRAR''  return  
         
  
INSERT INTO [dbo].[PLA_Recibos_Detalle]            
 (Id_Recibo,          
 [Id_interna],             
 [Mes],             
 [Año],             
 [Concepto],             
 [Aporte],             
 [Descuento],        
 TipoConcepto)            
VALUES (          
 @Id_recibo,          
 @Id_interna ,             
 @Mes ,            
 @Año ,            
 @Concepto ,            
 @Aporte ,            
 @Descuento,        
 @TipoConcepto)          
          ' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Certificado_Escolaridad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Certificado_Escolaridad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[LEG_ADD_Certificado_Escolaridad]
	(@Id_Interna int,
	 @Id_Familiar int,
 	 @Nivel_Escolaridad smallint,
	 @Tipo_Certificado varchar(50),
	 @Fecha_Certificado datetime,
	 @Usuario smallint)

as 
declare @id int
set @id = (select max(id)+1 from  dbo.LEG_Certificados_Escolaridad)
if @id is null begin
	set @id = 1
end


INSERT into dbo.LEG_Certificados_Escolaridad
values (@Id_Interna,@Id_Familiar, @Nivel_Escolaridad ,	@Tipo_Certificado ,
	@Fecha_Certificado,getdate(),@Usuario,@id)






' 
END
GO
/****** Object:  StoredProcedure [dbo].[GETdomiciliofamiliares]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GETdomiciliofamiliares]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GETdomiciliofamiliares] 
@nrodocfam int,
@nrodoctit int,
@nroidint int,
@id_fam int
AS
Select
df.fechacomunicacion, 
df.folio, 
df.calle, 
df.nro, 
df.piso, 
df.dpto, 
df.casa, 
df.manzana, 
df.barrio, 
df.torre, 
df.uf, 
df.localidad, 
df.partido_dpto, 
df.provincia, 
df.telefono, 
df.correo_electronico, 
df.codigo_postal, 
df.orden, 
df.grabado 

from [dbo].domicilio_familiares df 
where  (df.id_fam = @id_fam) and  (df.doc_titular=@nrodoctit or df.id_interno=@nroidint)






' 
END
GO
/****** Object:  StoredProcedure [dbo].[Modificar_Domicilio_Familiares]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Modificar_Domicilio_Familiares]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[Modificar_Domicilio_Familiares]
	(@Id_Interno_23 	[int],
	 @FechaComunicacion_25 	[datetime],
	 @Nro_Doc_26 	[int],
	 @Calle_27 	[char](40),
	 @Nro_28 	[smallint],
	 @Piso_29 	[char](5),
	 @Dpto_30 	[char](5),
	 @Casa_31 	[char](5),
	 @Manzana_32 	[char](5),
	 @Barrio_33 	[char](40),
	 @Torre_34 	[varchar](10),
	 @UF_35 	[varchar](10),
	 @Localidad_36 	[varchar](50),
	 @Codigo_postal_37 	[varchar](50),
	 @Partido_Dpto_38 	[varchar](50),
	 @Provincia_39 	[varchar](50),
	 @Telefono_40 	[varchar](20),
	 @Correo_Electronico_41 	[varchar](50),
	 @Folio_42 	[char] (10),
	 @Orden_43 	[int],
	 @Grabado_44 	[int],
	@doc_titular_24 [int],
	@id_fam [int])

AS UPDATE [dbo].[Domicilio_Familiares] 

SET      [FechaComunicacion]	 = @FechaComunicacion_25,
	 [Nro_Doc]	 = @Nro_Doc_26,
	 [Calle]	 = @Calle_27,
	 [Nro]	 = @Nro_28,
	 [Piso]	 = @Piso_29,
	 [Dpto]	 = @Dpto_30,
	 [Casa]	 = @Casa_31,
	 [Manzana]	 = @Manzana_32,
	 [Barrio]	 = @Barrio_33,
	 [Torre]	 = @Torre_34,
	 [UF]	 = @UF_35,
	 [Localidad]	 = @Localidad_36,
	 [Codigo_postal]	 = @Codigo_postal_37,
	 [Partido_Dpto]	 = @Partido_Dpto_38,
	 [Provincia]	 = @Provincia_39,
	 [Telefono]	 = @Telefono_40,
	 [Correo_Electronico]	 = @Correo_Electronico_41,
	 [Folio]	 = @Folio_42,
	-- [Orden]	 = @Orden_43,
	 [Grabado]	 = @Grabado_44
	 
WHERE 
	( [Id_Interno]= @Id_Interno_23 and [doc_titular]= @doc_titular_24 )   and (id_fam =@id_fam AND orden=@orden_43) 






' 
END
GO
/****** Object:  StoredProcedure [dbo].[Alta_Domicilio_Familiares]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Alta_Domicilio_Familiares]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[Alta_Domicilio_Familiares]
	(@Id_Interno_1 	[int],
	 @FechaComunicacion_2 	[datetime],
	 @Nro_Doc_3 	[int],
	 @Calle_4 	[char](40),
	 @Nro_5 	[smallint],
	 @Piso_6 	[char](5),
	 @Dpto_7 	[char](5),
	 @Casa_8 	[char](5),
	 @Manzana_9 	[char](5),
	 @Barrio_10 	[char](40),
	 @Torre_11 	[varchar](10),
	 @UF_12 	[varchar](10),
	 @Localidad_13 	[varchar](50),
	 @Codigo_postal_14 	[varchar](50),
	 @Partido_Dpto_15 	[varchar](50),
	 @Provincia_16 	[varchar](50),
	 @Telefono_17 	[varchar](20),
	 @Correo_Electronico_18 	[varchar](50),
	 @Folio_19 	[char](10),
	 @Orden_20 	[int],
	 @Grabado_21  [int],
	 @doctit_22     [int],
	 @Id_fam    [int])

AS INSERT INTO [dbo].[Domicilio_Familiares] 
	 ( [Id_Interno],
	 [FechaComunicacion],
	 [Nro_Doc],
	 [Calle],
	 [Nro],
	 [Piso],
	 [Dpto],
	 [Casa],
	 [Manzana],
	 [Barrio],
	 [Torre],
	 [UF],
	 [Localidad],
	 [Codigo_postal],
	 [Partido_Dpto],
	 [Provincia],
	 [Telefono],
	 [Correo_Electronico],
	 [Folio],
	 [Orden],
	 [Grabado],
	 [doc_titular],
	id_fam) 
 
VALUES 
	( @Id_Interno_1,
	 @FechaComunicacion_2,
	 @Nro_Doc_3,
	 @Calle_4,
	 @Nro_5,
	 @Piso_6,
	 @Dpto_7,
	 @Casa_8,
	 @Manzana_9,
	 @Barrio_10,
	 @Torre_11,
	 @UF_12,
	 @Localidad_13,
	 @Codigo_postal_14,
	 @Partido_Dpto_15,
	 @Provincia_16,
	 @Telefono_17,
	 @Correo_Electronico_18,
	 @Folio_19,
	 @Orden_20,
              @Grabado_21,
	@doctit_22,
	 @id_fam )


' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_Periodo_Evaluacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_Periodo_Evaluacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <13/03/2008>
-- Description:	<Trae los datos de un periodo>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_GET_Periodo_Evaluacion]
	@id_periodo int
AS
BEGIN
	SET NOCOUNT ON;

	select pe.desde, pe.hasta, pe.descripcion, pe.id_interna_coordinador, pl.id_planta planta, pe.baja
	from dbo.EVAL_Periodos_Evaluacion pe
	inner join dbo.EVAL_Plantas_Periodos_evaluacion pl
		on pe.id = pl.id_periodo
	where pe.id = @id_periodo
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_DEL_Planta_Periodo_Evaluacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_DEL_Planta_Periodo_Evaluacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <17/03/2008>
-- Description:	<Elimina la excepcion agente-evaluador>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_DEL_Planta_Periodo_Evaluacion]
	@id_planta int, @id_periodo int
AS
BEGIN
	SET NOCOUNT ON;
	
	DELETE FROM dbo.eval_plantas_periodos_evaluacion
	WHERE id_planta = @id_planta and id_periodo = @id_periodo

END


' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_INS_PLANTA_PERIODO_EVALUACION]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_INS_PLANTA_PERIODO_EVALUACION]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <18/03/2008>
-- Description:	<Da de alta los tipos de planta de un periodo de evaluacion>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_INS_PLANTA_PERIODO_EVALUACION]
@id_planta int,
@id_periodo int

AS
BEGIN
	SET NOCOUNT ON;

	insert into dbo.EVAL_Plantas_Periodos_Evaluacion
	(id_planta, id_periodo)
	values
	(@id_planta, @id_periodo)
	
END

' 
END
GO
/****** Object:  View [dbo].[VW_Tabla_Oficinas]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Oficinas]'))
EXEC dbo.sp_executesql @statement = N'

CREATE view [dbo].[VW_Tabla_Oficinas]
as
select id,descripcion
from dbo.Tabla_Oficinas


'
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Oficinas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Oficinas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

--MLD: 30-03-2006
CREATE procedure [dbo].[GABM_Tabla_Oficinas]
	@Operacion char(1),
	@Id_1 	[int]=null,
	@Descripcion_2 	[varchar](50)=null
AS 

IF @operacion =''A''
BEGIN
	Declare @MAx [int]
	set @Max = (select max(id)+1 from dbo.Tabla_Oficinas)
	if @Max is null begin
		set @max=1
	end
	INSERT INTO dbo.Tabla_Oficinas 
		 ([Id],
		 [descripcion],
		Baja) 
 	VALUES 
		( @max,
		 @Descripcion_2,
		0)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_Oficinas
	set 	[descripcion] =  @Descripcion_2
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_Oficinas
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_Oficinas
	set 	baja =  0
	where 	id = @Id_1
END


IF @operacion =''S''
BEGIN
	SELECT	Id,
		descripcion Descripción,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja 
	FROM  dbo.Tabla_Oficinas
	WHERE (id = @ID_1) OR (@ID_1 is null)
	ORDER BY id
END





' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_UDP_Estado_Pases]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_UDP_Estado_Pases]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[PLA_UDP_Estado_Pases]
	@id int,
	@Estado smallint,
	@Usuario smallint,
	@MotivoRechazo varchar(200)=Null
as

UPDATE dbo.PLA_Pases_Solicitados
SET 	Estado = @estado,
	reviso = @Usuario,
	motivo_Rechazo = @MotivoRechazo
WHERE id = @id




' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_UPD_PasesRechazos_Impresion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_UPD_PasesRechazos_Impresion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[PLA_UPD_PasesRechazos_Impresion]
	@Id int
AS
UPDATE dbo.PLA_Pases_Solicitados 
SET RechazoImpreso = 1
WHERE	Id = @Id

' 
END
GO
/****** Object:  StoredProcedure [dbo].[WEB_EliminarSolicitudDePase]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_EliminarSolicitudDePase]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 03/03/09
-- Description:	Elimina pases solicitados desde la web
-- =============================================
CREATE PROCEDURE [dbo].[WEB_EliminarSolicitudDePase]
	@idPase int
AS
BEGIN
	SET NOCOUNT ON;

	DELETE FROM dbo.pla_pases_solicitados
	where id = @idPase
	
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[WEB_AltaSolicitudPase]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_AltaSolicitudPase]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================  
-- Author:  Agustín  
-- Create date: 14/02/09  
-- Description: Alta de solicitudes de pases desde la web  
-- =============================================  
CREATE PROCEDURE [dbo].[WEB_AltaSolicitudPase]  
 @documento int,  
 @idAreaActual int,   
 @idAreaNueva int,  
 @idUsuarioSolicito int  
AS  
BEGIN  
   
 SET NOCOUNT ON;  
  
 declare @idInterna int  
 set @idInterna = (select id_interna from dbo.datos_personales where nro_documento = @documento)  
   
 declare @id int  
   
 set @id = (select isnull(max(id),0) + 1 from dbo.pla_pases_solicitados)  
   
  
 INSERT INTO [dbo].[PLA_Pases_Solicitados]  
 (  
  [Id_Interna],   
  [Area_Actual],   
  [Area_Nueva],   
  [fecha_Solicitud],   
  [Estado],   
  [Solicito],   
  [Fecha_pase],   
  [Ultima_modificacion],  
  [id]  
 )  
 values  
 (  
  @idInterna,  
  @idAreaActual,   
  @idAreaNueva,  
  getdate(),  
  0,  
  @idUsuarioSolicito,  
  getdate(),  
  null,  
  @id  
 )  
  
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_DEL_Practicas_Atenciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_DEL_Practicas_Atenciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create  procedure [dbo].[MED_DEL_Practicas_Atenciones]        
	@Id_Atencion int,  
	@Practica int
as        
        
DELETE FROM dbo.MED_Atenciones_Practicas         
WHERE  	IdAtencion= @Id_Atencion   AND
	IdPractica = @Practica  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_ADD_Practicas_Atenciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_ADD_Practicas_Atenciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create  procedure [dbo].[MED_ADD_Practicas_Atenciones]      
	@Id_Atencion int,      
	@Id_Practica varchar(100)
AS      
      
	INSERT INTO dbo.MED_Atenciones_Practicas       
		(IdAtencion,IdPractica,Baja)        
	VALUES     
		(@Id_Atencion, @Id_Practica,0)  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_GET_Atenciones_Practicas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_Atenciones_Practicas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create  procedure [dbo].[MED_GET_Atenciones_Practicas]    
	 @IdAtencion int    
AS  
    
select  TP.id Id_Practica,  
 	TP.descripcion Practica     
from dbo.MED_Atenciones_Practicas  P  
inner join dbo.Tabla_Medicos_Practicas TP  
	ON TP.id = P.IdPractica  
WHERE P.IdAtencion = @IdAtencion    

    
    
    
    
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_SuperEvaluador]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_SuperEvaluador]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <08/05/2008>
-- Description:	<Trae el superEvaluador de un cierto evaluador para el periodo>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_GET_SuperEvaluador]
	@idSubEvaluador int, @idPeriodo int
AS
BEGIN
	SET NOCOUNT ON;
	
	SELECT idEvaluador 
	FROM dbo.EVAL_SubEvaluadores
	WHERE idSubEvaluador = @idSubEvaluador And idPeriodo = @idPeriodo
END


' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_SubEvaluadores]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_SubEvaluadores]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <08/05/2008>
-- Description:	<Trae los SubEvaluadores de un cierto evaluador para el periodo>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_GET_SubEvaluadores]
	@idEvaluador int, @idPeriodo int
AS
BEGIN
	SET NOCOUNT ON;
	
	SELECT idSubEvaluador
	FROM dbo.EVAL_SubEvaluadores
	WHERE idEvaluador = @idEvaluador And idPeriodo = @idPeriodo
END


' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_DEL_SubEvaluador]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_DEL_SubEvaluador]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[EVAL_DEL_SubEvaluador] 
@idEvaluador int, @idSubEvaluador int,
@idPeriodo int
AS

SET NOCOUNT ON;

DELETE FROM dbo.EVAL_SubEvaluadores
WHERE idEvaluador = @idEvaluador
AND idSubEvaluador = @idSubEvaluador 
AND idPeriodo = @idPeriodo
' 
END
GO
/****** Object:  StoredProcedure [dbo].[IMP_Estudios_Especialidades]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[IMP_Estudios_Especialidades]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[IMP_Estudios_Especialidades]
	@Id_interna 	int,
	@operacion bit

AS 

if @operacion = 0 begin
	
	insert into dbo.L_IMP_Estudios_Especilidades 
	select 	Tipo_maqui,P_Min_Maq,Idiomas,P_Min_Idi,id_interna,Folio
	from [dbo].Estudios_Especilidades 
	where  Id_interna = @Id_interna
end
if @operacion = 1 begin
	delete from dbo.L_IMP_Estudios_Especilidades 
	where Id_interna = @Id_interna
end


' 
END
GO
/****** Object:  StoredProcedure [dbo].[update_Estudios_Especilidades]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[update_Estudios_Especilidades]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[update_Estudios_Especilidades]
	(@Tipo_maqui_8 	[char](20),
	 @P_Min_Maq_9 	[smallint],
	 @Idiomas_10 	[char](20),
	 @P_Min_Idi_11 	[smallint],
	 @Doc_Tit_12 	[int],
	 @Id_interna_13 	[int],
	 @Folio_14 	[char](10),
	@id_estudio [int],
	@datodebaja bit,
	@datonoimprime bit)

AS UPDATE [dbo].[Estudios_Especilidades] 

SET  [Tipo_maqui]	 = @Tipo_maqui_8,
	 [P_Min_Maq]	 = @P_Min_Maq_9,
	 [Idiomas]	 = @Idiomas_10,
	 [P_Min_Idi]	 = @P_Min_Idi_11,
	 [Folio]	 = @Folio_14 ,
	datodebaja=@datodebaja ,
	datonoimprime=@datonoimprime 

WHERE 
	 [Id_interna]	 = @Id_interna_13 and id_estudio=@id_estudio 
	 

' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Estudios_Especialidad]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Estudios_Especialidad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'





CREATE procedure [dbo].[RPT_LEG_Estudios_Especialidad]
	@Id_interna int
as
select  top 3
	isnull(Tipo_maqui,'''') Tipo_maqui,
	isnull(P_Min_Maq,'''')P_Min_Maq,
	isnull(Idiomas,'''')Idiomas,
	isnull(P_Min_Idi,'''')P_Min_Idi,
	ER.ID_interna
FROM dbo.Estudios_Especilidades ER
where id_interna =  @Id_interna AND
	DatoDeBaja = 0 AND
	DatoNoImprime = 0 








' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetEstudios_Especilidades]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetEstudios_Especilidades]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[GetEstudios_Especilidades]
	 @Doc_Tit_5 	[int],
	 @Id_interna_6 	[int]

AS 
select * from [dbo].Estudios_Especilidades 
where ( Doc_Tit = @Doc_Tit_5 or  Id_interna = @Id_interna_6) and datodebaja=0
' 
END
GO
/****** Object:  StoredProcedure [dbo].[Alta_Estudios_Especilidades]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Alta_Estudios_Especilidades]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[Alta_Estudios_Especilidades]
	(@Tipo_maqui_1 	[char](20),
	 @P_Min_Maq_2 	[smallint],
	 @Idiomas_3 	[char](20),
	 @P_Min_Idi_4 	[smallint],
	 @Doc_Tit_5 	[int],
	 @Id_interna_6 	[int],
	@Folio_2 	[char](10),
	@datodebaja bit,
	@datonoimprime bit)

AS 

Declare  @id_estudio int
set @id_estudio =(select max(id_estudio)+1 from [dbo].estudios_especilidades where id_interna = @id_interna_6 and Doc_Tit=@Doc_Tit_5)

if @id_estudio is null begin
	set @id_estudio =1
end

INSERT INTO dbo.Estudios_Especilidades
	 ( [Tipo_maqui],
	 [P_Min_Maq],
	 [Idiomas],
	 [P_Min_Idi],
	 [Doc_Tit],
	 [Id_interna],
	[Folio],
	id_estudio,
	datodebaja,
	datonoimprime) 
 
VALUES 
	( @Tipo_maqui_1,
	 @P_Min_Maq_2,
	 @Idiomas_3,
	 @P_Min_Idi_4,
	 @Doc_Tit_5,
	 @Id_interna_6,
	@Folio_2,
	@id_estudio,
	@datodebaja,
	@datonoimprime )


select @id_estudio id_estudio
' 
END
GO
/****** Object:  View [dbo].[VW_Rangos]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Rangos]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_Rangos]
AS SELECT [Tabla_Rangos].[Id], [Tabla_Rangos].[Descripcion]
FROM [Tabla_Rangos]

where baja =0
'
GO
/****** Object:  View [dbo].[VW_Desglose_FE]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Desglose_FE]'))
EXEC dbo.sp_executesql @statement = N'

CREATE           view [dbo].[VW_Desglose_FE]

AS
SELECT top 100 percent *
FROM dbo.LEG_Desglose_FE
WHERE (
	convert(char(8),cast(desde as int),112) +
	cast(documento as varchar)+
	cast(id as varchar)  
 	) in
	(SELECT max(
	convert(char(8),cast(desde as int),112) +
	cast(documento as varchar) +
	cast(id as varchar)  	
	
	
	)
	FROM dbo.LEG_Desglose_FE
	where desde <=getdate()
	GROUP BY id_interna)
ORDER BY id_interna'
GO
/****** Object:  StoredProcedure [dbo].[GEN_GET_Funcion_Ejecutiva_Area]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GEN_GET_Funcion_Ejecutiva_Area]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		<Agustin>
-- Create date: <01/04/2008>
-- Description:	<Trae todos los ids de las dependencias de un area hacia arriva searados por punto y coma>
-- =============================================
CREATE PROCEDURE [dbo].[GEN_GET_Funcion_Ejecutiva_Area]
@id_area int,
@fecha smalldatetime
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	SELECT * FROM dbo.Leg_Desglose_Fe
	WHERE @fecha >= desde and (@fecha <= hasta or hasta is null)
	and id_area = @id_area

END


' 
END
GO
/****** Object:  StoredProcedure [dbo].[Alta_Estudios_Idiomas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Alta_Estudios_Idiomas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[Alta_Estudios_Idiomas]
	(@Idioma_1 	[smallint],
	 @Habla_2 	[smallint],
	 @Lee_3 	[smallint],
	 @Escribe_4 	[smallint],
	 @Id_Interna_5 	[int],
	 @Nro_doc_6 	[int],
	 @Folio_4 	[char](10),
	@datodebaja bit,
	@datonoimprime bit)

AS 

Declare  @id_estudio int
set @id_estudio =(select max(id_estudio)+1 from [dbo].estudios_idiomas where id_interna = @id_interna_5 and Nro_Doc=@Nro_Doc_6)

if @id_estudio is null begin
	set @id_estudio =1
end


INSERT INTO dbo.Estudios_Idiomas 
	 ( [Idioma],
	 [Habla],
	 [Lee],
	 [Escribe],
	 [Id_Interna],
	 [Nro_doc],
	[folio],
	id_estudio,
	datodebaja,
	datonoimprime) 
 

VALUES 
	( @Idioma_1,
	 @Habla_2,
	 @Lee_3,
	 @Escribe_4,
	 @Id_Interna_5,
	 @Nro_doc_6,
	@Folio_4,
	@id_estudio,
	@datodebaja,
	@datonoimprime)

select @id_estudio id_estudio
' 
END
GO
/****** Object:  StoredProcedure [dbo].[update_Estudios_Idiomas]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[update_Estudios_Idiomas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[update_Estudios_Idiomas]
	(@Idioma_4 	[smallint],
	 @Habla_5 	[smallint],
	 @Lee_6 	[smallint],
	 @Escribe_7 	[smallint],
	 @Id_Interna_8 	[int],
	 @Nro_doc_9 	[int],
	 @Folio_10 	[char](10),
	@id_estudio [int],
	@datodebaja bit,
	@datonoimprime bit)

AS UPDATE [dbo].[Estudios_Idiomas] 

SET  [Idioma]	 = @Idioma_4,
	 [Habla]	 = @Habla_5,
	 [Lee]	 = @Lee_6,
	 [Escribe]	 = @Escribe_7,
	 [Id_Interna]	 = @Id_Interna_8,
	 [Nro_doc]	 = @Nro_doc_9,
	 [Folio]	 = @Folio_10,
	datodebaja=@datodebaja ,
	datonoimprime=	@datonoimprime  

WHERE 

	 [Id_Interna]	 = @Id_Interna_8 and id_estudio=@id_estudio 



' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Otros_Datos]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Otros_Datos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE PROCEDURE [dbo].[RPT_LEG_Otros_Datos]
	@Id_interna int

As

SELECT 	Jurisdiccion,
	Organismo,
	convert(char(10),Fecha,103) Fecha,
	Motivo,
	Detalle
FROM dbo.Otros_Datos
WHERE 	id_interna = @Id_Interna AND
	DatoDeBaja = 0 AND
	DatoNoImprime = 0
ORDER BY  convert(datetime,Fecha)





' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Otros_Datos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Otros_Datos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[LEG_UPD_Otros_Datos]
	(@Jurisdiccion_1 	[varchar](50),
	 @Organismo_2 	[varchar](50),
	 @Fecha_3 	[datetime],
	 @Detalle_4 	[varchar](250),
	 @Id_Interna_5 	[int],
	@doc_tit_6 	[int],
	@Orden [int],
	@folio [char](10),
	@motivo varchar(20)=null,
	@datodebaja bit,
	@datonoimprime bit)

AS 

update  [dbo].[Otros_Datos] 
set 	 [Jurisdiccion]=@Jurisdiccion_1,
	 [Organismo]=@Organismo_2,
	 [Fecha]=@Fecha_3,
	 [Detalle]=@Detalle_4,
	folio = @folio,
	motivo = @motivo,
	datodebaja=@datodebaja,
	datonoimprime=@datonoimprime

Where id_interna = @Id_Interna_5  and  nro_orden = @orden

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Otros_Datos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Otros_Datos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[LEG_ADD_Otros_Datos]
	(@Jurisdiccion_1 [varchar](50),
	 @Organismo_2 	[varchar](50),
	 @Fecha_3 	[datetime],
	 @Detalle_4 	[varchar](250),
	 @Id_Interna_5 	[int],
	 @doc_tit_6 	[int],
	 @folio [char](10),
	 @motivo varchar(20)=null,
	 @datodebaja bit,
	 @datonoimprime bit)

AS 
DECLARE @orden [int]
SET @orden = (select max(nro_orden)+1 from dbo.otros_datos where id_interna = @id_interna_5)
IF @orden is null BEGIN
	SET @orden = 1
END

INSERT INTO [dbo].[Otros_Datos] 
	 ( [Jurisdiccion],
	 [Organismo],
	 [Fecha],
	 [Detalle],
	 [Id_Interna], 
 	 [Doc_Titular],
	 nro_orden,
	 Folio,
	 motivo,
	 datodebaja,
	 datonoimprime) 

VALUES 
	( @Jurisdiccion_1,
	 @Organismo_2,
	 @Fecha_3,
	 @Detalle_4,
	 @Id_Interna_5,
	 @doc_tit_6,
	 @orden,
	 @Folio,
	 @motivo,
	 @datodebaja,
	 @datonoimprime)

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Otros_Datos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Otros_Datos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE PROCEDURE [dbo].[LEG_GET_Otros_Datos]
@doc int,
@id int
AS
select jurisdiccion, organismo, fecha, detalle, DAP.Nro_Documento, o.Id_Interna,o.Nro_Orden, o.folio, o.motivo, datodebaja, datonoimprime
from [dbo].otros_datos o 
INNER JOIN [dbo].[Datos_Personales] as DAP 
ON o.id_interna = DAP.id_Interna
where (o.doc_titular=@doc or  o.id_interna=@id) and datodebaja=0
order by folio


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Antiguedad_Contratos_Certificados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Antiguedad_Contratos_Certificados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Antiguedad_Contratos_Certificados]    
 @FechaCorte datetime,    
 @Nro_Documento int,    
 @Nivel varchar(5),    
 @Grado varchar(5)    
AS    
SELECT  top 1
 Id_Contrato,     
 Nro_Contrato,     
 convert(char(10),Desde,103) desde,    
 Convert(char(10),hasta,103) Hasta,    
 TN.Nivel,    
 TG.GRado,     
 isnull(IdCertificado,0) NCertificado    
FROM dbo.CTR_Contratos C    
INNER JOIN dbo.Tabla_Niveles TN     
 on TN.Id = C.Nivel    
INNER JOIN dbo.Tabla_Grados TG    
 ON TG.Id = C.Grado    
LEFT JOIN dbo.CTR_Antiguedad_Certificados AC    
 ON AC.IdContrato = C.Id_Contrato    
    
WHERE C.Nro_Documento = @Nro_Documento AND    
      C.Desde >=  @FechaCorte AND    
-- C.Aprobado = 0 AND   GER: Segun COLO 31/10/2007  
 C.Baja = 0  AND    
 TN.Nivel = @Nivel AND    
 TG.GRado = @Grado --AND    
 --AC.IdContrato IS NULL
    
 order by IdCalculo desc   
  



' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Historico_Antiguedad_Reconocidas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Historico_Antiguedad_Reconocidas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Historico_Antiguedad_Reconocidas]      
  @Documento int      
AS      
SELECT distinct AC.IdCalculo,    
 AC.IdCertificado,    
 AC.NIvel,    
 AC.Grado,    
 AC.Funcion,    
 convert(char(10),ARG.FechaCorte,103) FechaCorte,  
 convert(char(10),AC.FechaCertificado,103) FechaCertificado,    
 AC.Antiguedad,    
 CASE WHEN CTR.Nro_Contrato IS NULL THEN    
  ''''    
 ELSE    
  CTR.Nro_Contrato    
 END AsignadoaCTR  

FROM dbo.CTR_Antiguedad_Certificados AC    
  
inner JOIN dbo.CTR_Antiguedad_Reconocida_Grado ARG    
 on ARG.Id_Calculo = AC.IdCalculo     
  
LEFT JOIN dbo.CTR_Contratos CTR    
 ON CTR.Id_Contrato = AC.IdContrato    
    
WHERE  ARG.Nro_Documento = @Documento     
    
  
  
  





' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Max_Antiguedad_Reconocida]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Max_Antiguedad_Reconocida]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CTR_GET_Max_Antiguedad_Reconocida]
AS
Declare @MaxIdCalculo int
--COMENTADO POR PROBLEMAS CON LOS CERTIFICADOS SIN ANTIGUEDAD TOMADA
--set @MaxIdCalculo = (SELECT Max(Id_Calculo)+1 From dbo.CTR_Antiguedad_Reconocida_Grado)
set @MaxIdCalculo = (SELECT Max(IdCalculo)+1 From CTR_Antiguedad_Certificados)
IF @MaxIdCalculo IS NULL BEGIN
	SET @MaxIdCalculo = 1
END
select @MaxIdCalculo IdCalculo
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Antiguedad_Reconocida_Grado]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Antiguedad_Reconocida_Grado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CTR_GET_Antiguedad_Reconocida_Grado]    
@Id_Certificado int   
AS
SELECT Tipo,    
 id_Antiguedad,    
 convert(char(10),desde,103) Desde,    
 convert(char(10),hasta,103) hasta    
FROM  dbo.CTR_Antiguedad_Reconocida_Grado  arg
INNER JOIN dbo.ctr_antiguedad_certificados AC
	ON AC.idCalculo = arg.id_calculo
WHERE   ac.idcertificado = @id_certificado
' 
END
GO
/****** Object:  View [dbo].[VW_LIQ_GET_Nro_Cuenta]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_LIQ_GET_Nro_Cuenta]'))
EXEC dbo.sp_executesql @statement = N'
CREATE  View [dbo].[VW_LIQ_GET_Nro_Cuenta]    
    
as    
    
select count(1) Registros 
from dbo.liq_nro_cuenta    
    
  


'
GO
/****** Object:  View [dbo].[VW_LIQ_Get_Listado_Bco]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_LIQ_Get_Listado_Bco]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_LIQ_Get_Listado_Bco]          
AS      
SELECT  nc.[Id],       
 dp.apellido,       
 dp.nombre,      
 dp.cuil_nro,       
 dp.nro_documento,           
  nc.Tipo_Cta,       
 nc.Nro_Cta,       
 nc.Sueldo,       
 nc.Id_Banco  
     
     
from liq_nro_cuenta NC      
      
inner join datos_personales dp      
 on dp.nro_documento=nc.documento      
      
where  abs(nc.Sueldo)>0           
     and nc.Id_Banco is not null           
     and nc.Tipo_Cta is not null           
 and abs(nc.Id_Dom_Pago)>0      
     and nc.exportado=0     
      
      
      
      
    
  


'
GO
/****** Object:  StoredProcedure [dbo].[LIQ_UPD_Impor_Nro_Cuenta]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_UPD_Impor_Nro_Cuenta]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[LIQ_UPD_Impor_Nro_Cuenta]          
 @doc int,      
 @Nro_Cta char(10)=0,      
 @CBU varchar(22)=0,  
 @Sucur int,  
 @Usuario int          
as          
          
update dbo.liq_nro_cuenta          
set   Nro_Cta=@Nro_Cta,      
  CBU=@CBU,  
 Sucur_Bco=@sucur,  
 Usua_Reci=@usuario,  
 Fecha_Reci=getdate()       
where documento= @doc          
          
        
      
    
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LIQ_UPD_Nro_Cuenta]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_UPD_Nro_Cuenta]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[LIQ_UPD_Nro_Cuenta]        
 @Banco smallint,        
 @Tipo_cuenta char(1),        
 @Id_Estado_Civil_Bco int,        
 @Estado_Civil_bco char(1),        
 @sueldo float,        
 @id_dom_pago int,        
 @doc int,    
 @Nro_Cta char(10)=0,    
 @CBU varchar(22)=0,
 @Boton int      
as        
        

 update liq_nro_cuenta        
 set  id_banco= @Banco,        
  tipo_cta= @Tipo_cuenta,        
  Id_Estado_Civil_Bco= @Id_Estado_Civil_Bco,        
  estado_civil_bco= @Estado_Civil_bco,        
  sueldo= @sueldo,        
  id_dom_pago= @id_dom_pago,    
  Nro_Cta=@Nro_Cta,    
  CBU=@CBU    
 where documento= @doc        
       

--Saco la marca de exportado por modificacion de datos
if @Boton=3 
begin
	update liq_nro_cuenta        
 	set  exportado=0
 	where documento= @doc      
end 
    
  




' 
END
GO
/****** Object:  StoredProcedure [dbo].[LIQ_Marca_Exportado]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_Marca_Exportado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[LIQ_Marca_Exportado]  
 @id int ,
 @usua int
  
AS   
  
Update [dbo].[Liq_Nro_Cuenta]  
set   
 exportado=1  ,
 Usua_Envia=@usua,
 Fecha_Envia=getdate()
  
where id=@id  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LIQ_ALTA_Nro_Cuenta]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_ALTA_Nro_Cuenta]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[LIQ_ALTA_Nro_Cuenta]      
(@Documento int,      
@Id_Estado_Civil_Bco int=null,      
@Tipo_Cta char(1)=null,      
@Nro_Cta char(10)=null,      
@Sueldo int=null,      
@CBU varchar(22)=null,      
@Id_Banco smallint=null,      
@Sucur_Bco int=null,      
@Estado_Civil_Bco char(1)=null,      
@Id_Dom_Pago int=null,      
@Exportado bit=null,      
@Usua_Ingre smallint=null,      
@Fecha_Ingre smalldatetime=null,      
@Usua_Envia smallint=null,      
@Fecha_Envia smalldatetime=null,      
@Usua_Reci smallint=null,      
@Fecha_Reci smalldatetime=null)      
      
AS       
      
Declare @id [int]      
set @id = (select max(id)+1 from [dbo].[Liq_Nro_Cuenta])      
if @id is null begin      
 set @id=1      
end      
      
      
INSERT INTO [dbo].[Liq_Nro_Cuenta]       
(      
Id,      
Documento,      
Id_Estado_Civil_Bco,      
Tipo_Cta,      
Nro_Cta,      
Sueldo,      
CBU,      
Id_Banco,      
Sucur_Bco,      
Estado_Civil_Bco,      
Id_Dom_Pago,      
Exportado,      
Usua_Ingre,      
Fecha_Ingre,      
Usua_Envia,      
Fecha_Envia,      
Usua_Reci,      
Fecha_Reci       
)       
       
VALUES       
(       
@Id,      
@Documento,      
@Id_Estado_Civil_Bco,      
@Tipo_Cta,      
@Nro_Cta,      
@Sueldo,      
@CBU,      
@Id_Banco,      
@Sucur_Bco,      
@Estado_Civil_Bco,      
@Id_Dom_Pago,      
@Exportado,      
@Usua_Ingre,      
getdate(),      
@Usua_Envia,      
@Fecha_Envia,      
@Usua_Reci,      
@Fecha_Reci      
)      
      
      
    
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_UPD_Parametros]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_UPD_Parametros]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[RH_UPD_Parametros]
	@Tipo varchar(50),
	@Valor varchar(50),
	@Usuario smallint
AS
UPDATE dbo.Tabla_Parametros
SET valor = @Valor,
	usuario = @usuario
WHERE tipo = @Tipo


' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_GET_Parametros]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_GET_Parametros]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[RH_GET_Parametros]
	@Tipo varchar(50)
AS
SELECT Valor
FROM  dbo.Tabla_Parametros
WHERE tipo = @tipo


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Anti_Reco_Grado_Meses_Nuevos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Anti_Reco_Grado_Meses_Nuevos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_GET_Anti_Reco_Grado_Meses_Nuevos]  
@id_calculo int --9454  
as
SET NOCOUNT ON  
  
  
create table #tempo  
(  
Nro_Documento int,  
Tipo char(1),  
Id_Antiguedad int,  
Desde DateTime,  
Hasta DateTime  
)  
  
INSERT INTO #tempo  
select Nro_Documento,Tipo,Id_Antiguedad,Desde,Hasta  
from dbo.CTR_Antiguedad_Reconocida_Grado   
where id_calculo= @id_calculo and tipo <> ''X''  
  
  
declare @FechaCorte datetime,  
  @Nro_Documento int  
  
select top 1  
  @Nro_Documento = Nro_Documento,   
  @FechaCorte = FechaCorte  
from dbo.CTR_Antiguedad_Reconocida_Grado   
--where id_calculo= @id_calculo and tipo <> ''X''  
where id_calculo= @id_calculo 
  
INSERT INTO #tempo  
select  
 ctr.nro_documento Nro_Documento  
 --,''Ministerio''  
 ,''M'' tipo  
 ,ctr.id_contrato Id_Antiguedad  
 ,ctr.Desde Desde  
 ,isnull(ctrbajas.Fecha_Baja, @FechaCorte) hasta

-- ,CASE ctrbajas.Fecha_Baja  
--   WHEN is nul THEN @FechaCorte  
--   ELSE ctrbajas.Fecha_Baja  
-- END    
--  as Hasta  
  
-- ,CASE ctrbajas.Fecha_Baja  
--   WHEN Null THEN dbo.fx_Calcula_Antiguedad (ctr.Desde,@FechaCorte)  
--   ELSE dbo.fx_Calcula_Antiguedad (ctr.Desde,  
--     case when ctrbajas.Fecha_Baja > @FechaCorte   
--      THEN @FechaCorte  
--      else ctrbajas.Fecha_Baja  
--      END  
--      )  
-- END    
--  as Antiguedad  
-- ,convert(char(10),ctr.Desde,103) DesdeOriginal              
-- ,CASE ctrbajas.Fecha_Baja  
--  WHEN Null THEN convert(char(10),@FechaCorte,103)  
--  ELSE case when ctr.Hasta > @FechaCorte   
--   THEN convert(char(10),@FechaCorte,103)  
--   else convert(char(10),ctrbajas.Fecha_Baja,103)  
--   end               
--   END HastaOriginal              
-- ,ctr.Id_Contrato  
-- ,''Min. Desarrollo Social''  
-- ,''00-000/000''  
-- --trae el Cargo  
-- ,CASE ctr.tipo_contrato  
--   WHEN 1 THEN ''Contrato (Nivel '' + ctrniv.Nivel + '')'' + ctrtipo.Descripcion  
--   WHEN 2 THEN ''Contrato ('' + ctrfunc.Descripcion + '')'' + ctrtipo.Descripcion  
--   ELSE ''Contrato MDS''  
-- END    
--  as Cargo  
from dbo.CTR_Contratos CTR  
 left join dbo.CTR_Contratos_Bajas ctrbajas  
  on ctr.nro_documento = ctrbajas.nro_documento and ctr.id_contrato = ctrbajas.id_contrato  
 left join dbo.Tabla_Funciones_Contratos ctrfunc  
  on ctrfunc.id=ctr.funcion  
 left join dbo.Tabla_Niveles ctrniv  
  on ctrniv.id=ctr.nivel  
 left join dbo.Tabla_Resoluciones_Contratos ctrtipo  
  on ctrtipo.id=ctr.tipo_contrato  
where ctr.aprobado=1 and (ctr.Desde < ctrbajas.Fecha_Baja or ctrbajas.Fecha_Baja is null ) and ctr.Desde < @FechaCorte and ctr.nro_documento = @Nro_Documento   
	and (ctr.tipo_contrato = 1 or ctr.tipo_contrato = 4) 
  
  
Select Nro_Documento,  
Tipo,  
Id_Antiguedad,  
Desde,  
Hasta  
from #tempo
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Anti_Reco_Grado_Meses_Originales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Anti_Reco_Grado_Meses_Originales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CTR_GET_Anti_Reco_Grado_Meses_Originales]
@id_calculo int --9454
as

select Id_Calculo,
Nro_Documento,
Tipo,
Id_Antiguedad,
Desde,
Hasta,
FechaCorte,
FechaProceso,
UsuarioProceso
from dbo.CTR_Antiguedad_Reconocida_Grado 
where id_calculo= @id_calculo
' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Prorroga_Vigente]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Prorroga_Vigente]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[ASIS_GET_Prorroga_Vigente] AS
SELECT * FROM dbo.ASIS_PRORROGAS_LICENCIAS
ORDER BY FECHA_PRORROGA DESC
' 
END
GO
/****** Object:  StoredProcedure [dbo].[WEB_GetProrrogaOrdinaria]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[WEB_GetProrrogaOrdinaria]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 13/04/2009
-- Description:	Trae La prorroga vigente este año
-- =============================================
CREATE PROCEDURE [dbo].[WEB_GetProrrogaOrdinaria]
	@periodo int
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	SELECT 
		Prorroga_Desde, 
		Prorroga_Hasta 
	FROM
		dbo.asis_prorrogas_licencias
	WHERE
		@periodo = periodo_usufructo + 1 or
		@periodo = periodo_usufructo

	order by periodo_usufructo desc

END

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_ADD_Doc_Presentados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ADD_Doc_Presentados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_ADD_Doc_Presentados]
	(@Documento 	int,
	 @id		int)

AS INSERT INTO [dbo].[CTR_Doc_Presentados] 
	 ([Documento],
	 Id_Doc) 
 
VALUES 
	( @Documento,
	 @id)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Documentacion_Presentada_1Ctr]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Documentacion_Presentada_1Ctr]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[CTR_GET_Documentacion_Presentada_1Ctr]
	@Documento int
AS

declare @total int
set @total=(SELECT count(id)total
		FROM dbo.Tabla_Doc_Presentados 
		WHERE Baja = 0 )

IF (SELECT count(id_contrato) FROM dbo.CTR_Contratos WHERE nro_Documento = @Documento) = 1 BEGIN
	SELECT  count(dp.id) CantidadFaltante,@total Total
	FROM dbo.Tabla_Doc_Presentados DP
	LEFT JOIN dbo.CTR_Doc_Presentados CP
		on CP.id_Doc = DP.ID  AND
		CP.Documento = @Documento
	WHERE	DP.Baja = 0 AND
		CP.id_Doc is null 
	

END
ELSE
BEGIN
	SELECT  1 CantidadFaltante, 0 Total
END







' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Doc_Presentados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Doc_Presentados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[CTR_GET_Doc_Presentados] 
	@doc int
AS

SELECT id_doc FROM dbo.CTR_Doc_Presentados
WHERE Documento=@doc

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_ELIMINAR_Doc_Presentados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ELIMINAR_Doc_Presentados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_ELIMINAR_Doc_Presentados] 
	@doc int
AS

DELETE FROM CTR_Doc_Presentados
WHERE Documento=@doc
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_PersonasCredencialesAsignables]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_PersonasCredencialesAsignables]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CRED_Get_PersonasCredencialesAsignables]
	@IdTipoCredencial smallint,
	@IdPersona int = null
AS

SELECT 
	p.Id, 
	pr.Documento Documento, 
	pr.Apellido Apellido, 
	pr.Nombre Nombres,  
	
	docPedidoAlta.FolioDesde FolioDesde, 
	docPedidoAlta.Foliohasta FolioHasta,
	pr.Fecha_comunicacion FechaDeRelevamiento,
	
	tipo_doc_ped.Id IdTipoDocumentoPedidoDeAlta, tipo_doc_ped.Descripcion DescripcionTipoDocumentoPedidoDeAlta,
	docPedidoAlta.Id IdDocumentoAlta, docPedidoAlta.IdTipoDocumento IdTipoDeDocumentoDePedidoDeAlta, docPedidoAlta.FolioDesde FolioDesdePedidoDeAlta, docPedidoAlta.Foliohasta FolioHastaPedidoDeAlta, docPedidoAlta.Fecha FechaPedidoDeAlta,
	orgPedidoDeAlta.Id IdOrganismoPedidoDeAlta, orgPedidoDeAlta.Descripcion DescripcionOrganismoPedidoDeAlta,
	conRelPedidoAlta.Id IdConceptoRelacionDePedidoAlta, conRelPedidoAlta.Descripcion DescripcionPedidoDeAlta,
	pers_auth_pedidoAlta.Id IdAutorizantePedidoDeAlta, pers_auth_pedidoAlta.Documento DocumentoAutorizantePedidoAlta, pers_auth_pedidoAlta.Apellido ApellidoAutorizantePedidoAlta, pers_auth_pedidoAlta.Nombres NombreAutorizantePedidoAlta,
	pap.Id IdPedidoAlta, pap.FechaAlta FechaPedidoAlta, pap.Observacion ObservacionAltaPersona,
	
	
	asig.Id IdAsignacion, asig.Fecha FechaAsignacion, asig.IdBaja IdBajaAsignacion, bajaAsignacion.Fecha fechaBajaAsignacion,
	p.Id IdIngresante, pr.Documento DocumentoIngresante, pr.Apellido ApellidoIngresante, pr.Nombre NombreIngresante, p.IdBaja IdBajaPersona,
	pers_auth.Id IdAutorizanteAsignacion, pers_auth.Documento DocumentoAutorizanteAsignacion, pers_auth.Apellido ApellidoAutorizanteAsignacion, pers_auth.Nombres NombreAutorizanteAsignacion,
	org.Id IdOrganismo, org.Descripcion DescripcionOrganismo,
	cred.Id IdCredencial, cred.CodigoMagnetico, cred.FechaAlta FechaAltaCredencial, cred.UsuarioAlta UsuarioAltaFechaAlta, cred.idTipo,
	doc_asig.Id IdDocumentoAsignacion, doc_asig.FolioDesde FolioDesdeAsignacion, doc_asig.FolioHasta FolioHastaAsignacion, doc_asig.Fecha fechaDocumentoAsignacion,
	tipo_doc.Id IdTipoDocumentoAsignacion, tipo_doc.Descripcion DescripcionTipoDocumentoAsignacion,
	pers_relev.Fecha_comunicacion FechaComunicacion,
	bajaAsignacion.Id IdBajaAsignacion, bajaAsignacion.IdAutorizante IdAutorizanteDeBajaAsignacion, bajaAsignacion.IdDocumento IdDocumentoDeBajaAsignacion, bajaAsignacion.Motivo MotivoBajaAsignacion,
	docBajaAsig.Id IdDocumentoBajaAsignacion,
	tipoDocumentoBaja.Id IdTipoDocumentoBaja, tipoDocumentoBaja.Descripcion DescripcionTipoDocumentoBaja,
	docBajaAsig.FolioDesde DocumentoBajaAsigFolioDesde, docBajaAsig.Foliohasta DocumentoBajaAsigFolioHasta, docBajaAsig.Fecha fechaDocumentoBajaAsignacion,
	persBaja.Id IdAutorizanteBaja, persBaja.Documento DocumentoAutorizanteBaja, persBaja.Apellido ApellidoAutorizanteBaja, persBaja.Nombres NombreAutorizanteBaja,
	org.ImagenCredencial AS ImagenCredencialOrganismo, org.TemplateWord AS TemplateWordOrganismo,
	vtoAsig.FechaVencimiento

FROM
	dbo.CRED_Personas p
	INNER JOIN dbo.CRED_PedidoAltaPersonas pap
		ON p.Id = pap.IdPersona
	INNER JOIN dbo.CRED_CredencialesAsignablesAPersonas pca
		ON p.Id = pca.IdPersona
	INNER JOIN dbo.CRED_Organismos orgPedidoDeAlta
		ON pap.IdOrganismo = orgPedidoDeAlta.Id
	INNER JOIN dbo.CRED_PersonasRelevadas pr
		ON p.Documento = pr.Documento
	INNER JOIN dbo.CRED_TiposCredenciales tc
		ON pca.IdTipoCredencial = tc.Id 
	INNER JOIN dbo.CRED_Documentos docPedidoAlta
		ON pap.IdDocumento = docPedidoAlta.Id
	INNER JOIN dbo.CRED_TiposDocumentos tipo_doc_ped
		ON docPedidoAlta.IdTipoDocumento = tipo_doc_ped.Id
	INNER JOIN dbo.CRED_ConceptoRelacion conRelPedidoAlta
		ON conRelPedidoAlta.Id = pap.IdConceptoRelacion
	INNER JOIN dbo.CRED_Autorizantes aut_pedidoAlta
		ON aut_pedidoAlta.Id = pap.IdAutorizante
	INNER JOIN dbo.CRED_Personas pers_auth_pedidoAlta
		ON pers_auth_pedidoAlta.Id = aut_pedidoAlta.IdPersona
	
	LEFT JOIN dbo.CRED_Asignaciones asig
		ON asig.IdPersona = p.Id
	LEFT JOIN dbo.CRED_Credenciales cred
		ON cred.Id = asig.IdCredencial
	LEFT JOIN dbo.CRED_Organismos org
		ON org.Id = asig.IdOrganismo
	LEFT JOIN dbo.CRED_Documentos doc_asig
		ON doc_asig.Id = asig.IdDocumento
	LEFT JOIN dbo.CRED_TiposDocumentos tipo_doc
		ON tipo_doc.Id = doc_asig.IdTipoDocumento
	LEFT JOIN dbo.CRED_Autorizantes aut
		ON aut.Id = asig.IdAutorizante
	LEFT JOIN dbo.CRED_Personas pers_auth
		ON pers_auth.Id = aut.IdPersona
	LEFT JOIN dbo.CRED_PersonasRelevadas pers_relev
		ON pers_relev.Documento = p.Documento
	LEFT JOIN dbo.CRED_Bajas bajaAsignacion
		ON bajaAsignacion.Id = asig.IdBaja
	LEFT JOIN dbo.CRED_Autorizantes authBaja
		ON bajaAsignacion.IdAutorizante = authBaja.Id
	LEFT JOIN dbo.CRED_Personas persBaja
		ON authBaja.IdPersona = persBaja.Id
	LEFT JOIN dbo.CRED_Documentos docBajaAsig
		ON bajaAsignacion.IdDocumento = docBajaAsig.Id
	LEFT JOIN dbo.CRED_TiposDocumentos tipoDocumentoBaja
		ON docBajaAsig.IdTipoDocumento = tipoDocumentoBaja.Id	 
	LEFT JOIN dbo.Cred_Vencimientos_Asignaciones vtoAsig
		ON vtoAsig.IdAsignacion = asig.Id
	
WHERE 
	tc.Id = @IdTipoCredencial
	and (@IdPersona is null or p.Id = @IdPersona)
	ORDER BY p.Id' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_AsignacionPorPersona]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_AsignacionPorPersona]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[CRED_Get_AsignacionPorPersona]
	@IdPersona int,
	@Documento int
AS
BEGIN

SELECT 
	asig.Id IdAsignacion, asig.Fecha FechaAsignacion, asig.IdBaja IdBajaAsignacion, bajaAsignacion.Fecha fechaBajaAsignacion,
	pers_asig.Id IdIngresante, pers_relev.Documento DocumentoIngresante, pers_relev.Apellido ApellidoIngresante, pers_relev.Nombre NombreIngresante,
	pers_auth.Id IdAutorizanteAsignacion, pers_auth.Documento DocumentoAutorizanteAsignacion, pers_auth.Apellido ApellidoAutorizanteAsignacion, pers_auth.Nombres NombreAutorizanteAsignacion,
	org.Id IdOrganismo, org.Descripcion DescripcionOrganismo,
	cred.Id IdCredencial, cred.CodigoMagnetico, cred.FechaAlta FechaAltaCredencial, cred.UsuarioAlta UsuarioAltaFechaAlta, cred.idTipo,
	doc_asig.Id IdDocumentoAsignacion, doc_asig.FolioDesde FolioDesdeAsignacion, doc_asig.FolioHasta FolioHastaAsignacion, doc_asig.Fecha fechaDocumentoAsignacion,
	tipo_doc.Id IdTipoDocumentoAsignacion, tipo_doc.Descripcion DescripcionTipoDocumentoAsignacion,
	pers_relev.Fecha_comunicacion FechaComunicacion,
	bajaAsignacion.Id IdBajaAsignacion, bajaAsignacion.IdAutorizante IdAutorizanteDeBajaAsignacion, bajaAsignacion.IdDocumento IdDocumentoDeBajaAsignacion, bajaAsignacion.Motivo MotivoBajaAsignacion,
	docBajaAsig.Id IdDocumentoBajaAsignacion, docBajaAsig.Fecha fechaDocumentoBajaAsignacion,
	tipoDocumentoBaja.Id IdTipoDocumentoBaja, tipoDocumentoBaja.Descripcion DescripcionTipoDocumentoBaja,
	docBajaAsig.FolioDesde DocumentoBajaAsigFolioDesde, docBajaAsig.Foliohasta DocumentoBajaAsigFolioHasta,
	persBaja.Id IdAutorizanteBaja, persBaja.Documento DocumentoAutorizanteBaja, persBaja.Apellido ApellidoAutorizanteBaja, persBaja.Nombres NombreAutorizanteBaja,
	org.ImagenCredencial AS ImagenCredencialOrganismo, org.TemplateWord AS TemplateWordOrganismo,
	vtoAsig.FechaVencimiento
		 
FROM 
	dbo.CRED_Asignaciones asig
	INNER JOIN dbo.CRED_Personas pers_asig
		ON asig.IdPersona = pers_asig.Id
	INNER JOIN dbo.CRED_Credenciales cred
		ON cred.Id = asig.IdCredencial
	INNER JOIN dbo.CRED_Organismos org
		ON org.Id = asig.IdOrganismo
	INNER JOIN dbo.CRED_Documentos doc_asig
		ON doc_asig.Id = asig.IdDocumento
	INNER JOIN dbo.CRED_TiposDocumentos tipo_doc
		ON tipo_doc.Id = doc_asig.IdTipoDocumento
	INNER JOIN dbo.CRED_Autorizantes aut
		ON aut.Id = asig.IdAutorizante
	INNER JOIN dbo.CRED_Personas pers_auth
		ON pers_auth.Id = aut.IdPersona
	INNER JOIN dbo.CRED_PersonasRelevadas pers_relev
		ON pers_relev.Documento = pers_asig.Documento
	LEFT JOIN dbo.CRED_Bajas bajaAsignacion
		ON bajaAsignacion.Id = asig.IdBaja
	LEFT JOIN dbo.CRED_Autorizantes authBaja
		ON bajaAsignacion.IdAutorizante = authBaja.Id
	LEFT JOIN dbo.CRED_Personas persBaja
		ON authBaja.IdPersona = persBaja.Id
	LEFT JOIN dbo.CRED_Documentos docBajaAsig
		ON bajaAsignacion.IdDocumento = docBajaAsig.Id
	LEFT JOIN dbo.CRED_TiposDocumentos tipoDocumentoBaja
		ON docBajaAsig.IdTipoDocumento = tipoDocumentoBaja.Id	
	LEFT JOIN dbo.Cred_Vencimientos_Asignaciones vtoAsig
		ON vtoAsig.IdAsignacion = asig.Id	
	WHERE
		asig.IdPersona = @IdPersona
		--AND asig.IdBaja is null
		AND pers_relev.Documento = @Documento
END' 
END
GO
/****** Object:  View [dbo].[CRED_Vista_AsignacionesPorPersona]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Vista_AsignacionesPorPersona]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[CRED_Vista_AsignacionesPorPersona]
   AS

SELECT 
	/*Datos de Asignación*/
    asig.Id IdAsignacion, 
	asig.Fecha FechaAsignacion, 
	asig.IdBaja IdBajaAsignacion,
	vtoAsig.FechaVencimiento FechaVencimientoCredencial,
		
	/*Datos de la Persona consultada*/
	pers_asig.Id IdPersonaDeAsignacion,
	pers_asig.Documento DocumentoPersonaDeAsignacion,
	pers_asig.Apellido ApellidoPersonaDeAsignacion, 
	pers_asig.Nombres NombrePersonaDeAsignacion,
	pedAlta.Observacion ObservacionPersonaDeAsignacion,
	pers_relev.Fecha_comunicacion FechaRelevamientoDePersonaDeAsignacion,
		
	/*Datos de Organismo*/
	org.Id IdOrganismoAsignacion, 
	org.Descripcion DescripcionOrganismoAsignacion,
	
	/*Datos de Documento*/
	doc.Id IdDocumentoEnAsignacion, 
	tipo_doc.Id IdTipoDocumentoDeAsignacion,
	tipo_doc.Descripcion DescripcionDelTipoDeDocumentoDeAsignacion,
	doc.FolioDesde FolioDesdeDelDocumentoDeAsignacion, 
	doc.FolioHasta FoliohastaDelDocumentoDeAsignacion, 
	doc.Observacion ObservacionDocumentoDeAsignacion,
		
	/*Datos de Autorizante*/
	pers_auth.Id IdAutorizanteDeAsignacion, 
	pers_auth.Documento DocumentoAutorizanteDeAsignacion, 
	pers_auth.Apellido ApellidoAutorizanteDeAsignacion, 
	pers_auth.Nombres NombreAutorizanteDeAsignacion,
	
	/*Datos de la credencial*/
	cred.Id IdCredencialDeAsignacion, 
	cred.CodigoMagnetico CodigoMagneticoCredencialDeAsignacion, 
	cred.IdTipo IdTipoCredencialDeAsignacion,
	tipocred.Descripcion DescripcionTipoCredencialDeAsignacion,
	cred.FechaAlta FechaAltaDeCredencialDeAsignacion, 
	cred.UsuarioAlta UsuarioAltaDeCredencialDeAsignacion,
	cred.IdBaja IdBajaDeCredencialDeAsignacion,
	
	
	/*Datos de la Baja*/
	bajaAsignacion.Id IdBajaDeAsignacion,
	bajaAsignacion.Fecha FechaBajaDeAsignacion,
	bajaAsignacion.IdAutorizante IdAutorizanteDeBajaDeAsignacion, 
	bajaAsignacion.IdDocumento IdDocumentoDeBaja, 
	bajaAsignacion.Motivo MotivoBajaDeAsignacion,
	docBaja.Id IdDocumentoBajaDeAsignacion,
	tipoDocumentoBaja.Id IdTipoDocumentoBajaDeAsignacion, 
	tipoDocumentoBaja.Descripcion DescripcionTipoDocumentoBajaDeAsignacion,
	docBaja.FolioDesde DocumentoFolioDesdeDeBajaDeAsignacion, 
	docBaja.Foliohasta DocumentoFolioHastaDeBajaDeAsignacion,
	persBaja.Id IdAutorizanteBajaDeBajaDeAsignacion, 
	persBaja.Documento DocumentoAutorizanteBajaDeAsignacion,
	persBaja.Apellido ApellidoAutorizanteBajaDeAsignacion, 
	persBaja.Nombres NombreAutorizanteBajaDeAsignacion,
	org.ImagenCredencial AS ImagenCredencialOrganismo, 
	org.TemplateWord AS TemplateWordOrganismo
		 
FROM 
	dbo.CRED_Asignaciones asig
	INNER JOIN dbo.CRED_Personas pers_asig
		ON asig.IdPersona = pers_asig.Id
	INNER JOIN dbo.CRED_Credenciales cred
		ON cred.Id = asig.IdCredencial
		
	INNER JOIN dbo.CRED_TiposCredenciales tipocred
	on tipocred.Id = cred.IdTipo
		
	INNER JOIN dbo.CRED_Organismos org
		ON org.Id = asig.IdOrganismo
	INNER JOIN dbo.CRED_Documentos doc
		ON doc.Id = asig.IdDocumento
	INNER JOIN dbo.CRED_TiposDocumentos tipo_doc
		ON tipo_doc.Id = doc.IdTipoDocumento
	INNER JOIN dbo.CRED_Autorizantes aut
		ON aut.Id = asig.IdAutorizante
	INNER JOIN dbo.CRED_Personas pers_auth
		ON pers_auth.Id = aut.IdPersona
	INNER JOIN dbo.CRED_PersonasRelevadas pers_relev
		ON pers_relev.Documento = pers_asig.Documento
	LEFT JOIN dbo.CRED_Bajas bajaAsignacion
		ON bajaAsignacion.Id = asig.IdBaja
	LEFT JOIN dbo.CRED_Autorizantes authBaja
		ON bajaAsignacion.IdAutorizante = authBaja.Id
	LEFT JOIN dbo.CRED_Personas persBaja
		ON authBaja.IdPersona = persBaja.Id
	LEFT JOIN dbo.CRED_Documentos docBaja
		ON bajaAsignacion.IdDocumento = docBaja.Id
	LEFT JOIN dbo.CRED_TiposDocumentos tipoDocumentoBaja
		ON docBaja.IdTipoDocumento = tipoDocumentoBaja.Id	
	LEFT JOIN dbo.CRED_PedidoAltaPersonas pedAlta
		ON pedAlta.IdPersona = pers_asig.Id
	LEFT JOIN dbo.Cred_Vencimientos_Asignaciones vtoAsig
		ON vtoAsig.IdAsignacion = asig.Id
		
	    --WHERE
		--asig.IdPersona = @IdPersona
		--AND asig.IdBaja is null
		--pers_relev.Documento = 28982949
		--order by asig.Fecha desc





'
GO
/****** Object:  StoredProcedure [dbo].[CRED_Ins_Asignacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Ins_Asignacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CRED_Ins_Asignacion]
@IdCredencial smallint,
@IdPersona int,
@Fecha smalldatetime = null,
@IdDocumento smallint,
@IdAutorizante int,
@IdOrganismo smallint,
@IdUsuario smallint,
@FechaVencimiento datetime = null 
AS

BEGIN
/*Ver donde agregar validación para evitar asignar 2 veces a la misma persona, con la misma credencial*/	

insert into dbo.CRED_Asignaciones (IdCredencial,IdPersona,Fecha,IdDocumento,IdAutorizante, IdOrganismo, IdUsuario)
values (@IdCredencial,@IdPersona,GETDATE()/*@Fecha*/,@IdDocumento,@IdAutorizante,@IdOrganismo,@IdUsuario  )

select SCOPE_IDENTITY() 


IF (@FechaVencimiento is not null)
BEGIN
	insert into Cred_Vencimientos_Asignaciones(IdAsignacion, FechaVencimiento)
	values (SCOPE_IDENTITY(),@FechaVencimiento )

END

END' 
END
GO
/****** Object:  View [dbo].[CRED_ConsultaPedidoDeAltas]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[CRED_ConsultaPedidoDeAltas]'))
EXEC dbo.sp_executesql @statement = N'CREATE VIEW [dbo].[CRED_ConsultaPedidoDeAltas] 
AS
SELECT 	
-- datos del pedido de alta (documento, folio, organismo, relacion, autorizante)
		pa.Id as IdPedidoAlta,
		td.Id as IdTipoDocumento,
		td.Descripcion as TipoDocumento,	
		
		pa.IdDocumento,
		d.FolioDesde, d.Foliohasta,
		d.Observacion as ObservacionDeDocumento,
		
		pa.IdOrganismo,
		o.Descripcion as DescripcionOrganismo,
		pa.IdAutorizante,
		per.Nombres as NombreAutorizante,
		per.Apellido as ApellidoAutorizante,
		per.Documento as DocumentoAutorizante,
		pa.IdConceptoRelacion,
		cr.Descripcion as ConceptoRelacion,
		cas.IdTipoCredencial,
-- datos de la persona		
		p.Id as IdPersona,
		p.Documento,
		p.Apellido,
		p.Nombres,
		pa.Observacion as ObservacionDePersona,
-- fecha releveamiento, asignacion y credencial		
		persRel.Fecha_comunicacion as FechaRelevamiento,
		asig.Id as NumeroDeAsigancion,
		asig.IdCredencial as CredencialAsignada,
		cred.CodigoMagnetico as CodigoMagnetico,
		vtoAsig.FechaVencimiento as FechaVencimientoCredencial
		
	FROM dbo.CRED_PedidoAltaPersonas pa
	INNER JOIN dbo.CRED_Personas p
		ON p.Id = pa.IdPersona 
	INNER JOIN dbo.CRED_Documentos d
		ON d.Id = pa.IdDocumento
	INNER JOIN dbo.CRED_TiposDocumentos td
		ON td.Id = d.IdTipoDocumento
	INNER JOIN dbo.CRED_Organismos o
		ON o.Id = pa.IdOrganismo	
	INNER JOIN dbo.CRED_Autorizantes au
		ON au.Id = pa.IdAutorizante
	INNER JOIN dbo.CRED_Personas per
		ON au.IdPersona = per.Id	
	INNER JOIN dbo.CRED_ConceptoRelacion cr
		ON cr.Id = pa.IdConceptoRelacion 
	INNER JOIN dbo.CRED_CredencialesAsignablesAPersonas cas
		ON cas.IdPersona = p.Id
	LEFT JOIN dbo.CRED_PersonasRelevadas persRel
		ON p.Documento = persRel.Documento
	LEFT JOIN dbo.CRED_Asignaciones asig
		ON p.Id = asig.IdPersona
	LEFT JOIN dbo.CRED_Credenciales cred
		ON asig.IdCredencial = cred.Id
	LEFT JOIN dbo.Cred_Vencimientos_Asignaciones vtoAsig
		ON vtoAsig.IdAsignacion = asig.Id'
GO
/****** Object:  View [dbo].[VW_Accesos]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Accesos]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_Accesos]
AS SELECT [Accesos].[Mnu], [Accesos].[Descripcion], [Accesos].[Id_Modulo]
FROM [Accesos]

'
GO
/****** Object:  StoredProcedure [dbo].[Del_Accesos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Del_Accesos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[Del_Accesos]
	(@Id_1 	[smallint])

AS DELETE [dbo].[Accesos] 

WHERE 
	( [Id]	 = @Id_1)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_GET_Permisos_Modulos_Usuario]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_GET_Permisos_Modulos_Usuario]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE  PROCEDURE [dbo].[RH_GET_Permisos_Modulos_Usuario]  
 @id_usuario [int],
 @Frm varchar(100) = NULL
AS  
  
SELECT id_modulo, mnu, ISNULL(permisos ,''000'') Permisos
  
FROM dbo.accesos AS ACC   
LEFT JOIN dbo.Perfiles_Permisos_Usuarios AS PER   
 ON PER.Id_acceso  = ACC.ID  and
 PER.ID_USUARIO = @id_usuario  
WHERE (ACC.Mnu = @Frm OR @Frm IS NULL)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetAccesosModulo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetAccesosModulo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GetAccesosModulo]
	@id_modulo int
AS

SELECT * FROM DBO.ACCESOS 
WHERE  ID_MODULO = @id_modulo 

' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_GET_Accesos_Modulo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_GET_Accesos_Modulo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[RH_GET_Accesos_Modulo]
	@Id_Modulo int
AS

SELECT * FROM dbo.Accesos
WHERE  Id_Modulo = @Id_Modulo
order by id



' 
END
GO
/****** Object:  View [dbo].[VW_RH_Accesos]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_RH_Accesos]'))
EXEC dbo.sp_executesql @statement = N'


CREATE  view [dbo].[VW_RH_Accesos]
AS 
SELECT *
FROM [Accesos]



'
GO
/****** Object:  StoredProcedure [dbo].[Alta_Accesos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Alta_Accesos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[Alta_Accesos]
	(@Mnu_2 	[varchar](100),
	 @Descripcion_3 	[varchar](100),
	 @Id_Modulo_4 	[smallint])

AS
declare @id [int]
set @id = (select max (id)+1 from dbo.accesos)
if @id is null begin
	set @id =1
end

if (select top 1 id from dbo.accesos where mnu = @mnu_2 and id_modulo = @id_modulo_4) is null begin


	INSERT INTO [dbo].[Accesos] 
		 ( [Id],
		 [Mnu],
		 [Descripcion],
		 [Id_Modulo]) 
 
	VALUES 
		( @Id,
		 @Mnu_2,
		 @Descripcion_3,
		 @Id_Modulo_4)

end
' 
END
GO
/****** Object:  View [dbo].[VW_tipo_incremento]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_tipo_incremento]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_tipo_incremento]
as
select id,descripcion,monto,baja from tabla_incremento


where baja =0
'
GO
/****** Object:  StoredProcedure [dbo].[GET_PermisosUsuarios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GET_PermisosUsuarios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GET_PermisosUsuarios]

@idUsuario [int],
@idModulo [int]

AS
select id_acceso, permisos from dbo.Perfiles_Permisos_Usuarios where id_usuario = @idUsuario and id_acceso = @idModulo






' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_DEL_Usuario_Permisos_Acceso]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_DEL_Usuario_Permisos_Acceso]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE PROCEDURE [dbo].[RH_DEL_Usuario_Permisos_Acceso]
	(@User 	smallint)
AS 


DELETE FROM [dbo].[Perfiles_Permisos_Usuarios] 
WHERE  [Id_Usuario]= @User








' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_ADD_Usuario_Permisos_Acceso]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_ADD_Usuario_Permisos_Acceso]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE PROCEDURE [dbo].[RH_ADD_Usuario_Permisos_Acceso]
	(@User 	smallint,
	 @Acceso smallint,
	 @Permisos [char](3))
AS 
/*
if exists (select * from [dbo].[Perfiles_Permisos_Usuarios] where [Id_Acceso] = @acceso and [Id_Usuario]= @user) begin

	UPDATE [dbo].[Perfiles_Permisos_Usuarios] 
	SET  [permisos] = @permisos
	WHERE  [Id_Acceso] = @acceso and [Id_Usuario]= @user
end
else
*/
INSERT INTO [dbo].[Perfiles_Permisos_Usuarios] (Id_Usuario,[Id_Acceso],[permisos] )
VALUES (@User, @Acceso, @Permisos)	








' 
END
GO
/****** Object:  View [dbo].[VW_Tabla_Reparticiones]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Reparticiones]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_Tabla_Reparticiones]
as 
select id,descripcion from tabla_reparticiones

'
GO
/****** Object:  StoredProcedure [dbo].[ASIS_Get_Partes_Recibidos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Get_Partes_Recibidos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[ASIS_Get_Partes_Recibidos]
as
select * from dbo.asis_partes_recibidos
' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_Alta_Partes_Recibidos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Alta_Partes_Recibidos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[ASIS_Alta_Partes_Recibidos]
@id_area int,  @fh_parte smalldatetime, @fh_recepcion smalldatetime
as
insert into dbo.asis_partes_recibidos
(id_area, fh_parte, fh_recepcion, fh_carga)
values
(@id_area, @fh_parte, @fh_recepcion, getdate())
' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_ADD_Atenciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_ADD_Atenciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'    
CREATE procedure [dbo].[MED_ADD_Atenciones]                
 @Nro_Documento int,                
 @FechaAtencion smalldatetime,      
 @VolverEnDias smallint = Null,      
 @PresionDia smallint = Null,      
 @PresionHora varchar(5) = Null,      
 @PresionDiastolica  smallint = Null,      
 @PresionSistolica smallint = Null,      
 @IdDiagnostico smallint,      
 @Observaciones varchar(200) = Null,      
 @IdAtencion int = NULL,      
 @ConsultorioExterno bit,      
 @regresa int,    
 @regreso int,    
 @fecha_parto smalldatetime = null,  
 @Usuario smallint = NULL    
AS      
SET NOCOUNT ON      
  
IF @IdAtencion IS NULL BEGIN      
 INSERT INTO Dbo.MED_Atenciones      
  (Nro_Documento,      
  FechaAtencion,      
  VolverEnDias,      
  PresionDia,      
  PresionHora,      
  PresionDiastolica,      
  PresionSistolica,      
  IdDiagnostico,      
  Observaciones,      
  ConsultorioExterno,      
  IdUsuario,    
  regresa,    
  regreso,  
  fecha_parto)      
 VALUES (@Nro_Documento,      
  @FechaAtencion,      
  @VolverEnDias,      
  @PresionDia,      
  @PresionHora,      
  @PresionDiastolica,      
  @PresionSistolica,      
  @IdDiagnostico,      
  @Observaciones,      
  @ConsultorioExterno,      
  @Usuario,    
  @regresa,    
  @regreso,  
  @fecha_parto)      
       
 (SELECT MAX(Id) IdAtencion FROM dbo.MED_Atenciones)      
END      
ELSE      
BEGIN      
 UPDATE dbo.MED_Atenciones      
 SET FechaAtencion = @FechaAtencion,      
  VolverEnDias = @VolverEnDias,      
  PresionDia = @PresionDia,      
  PresionHora =  @PresionHora,      
  PresionDiastolica = @PresionDiastolica,      
  PresionSistolica =  @PresionSistolica,      
  IdDiagnostico = @IdDiagnostico,      
  Observaciones = @Observaciones,      
  ConsultorioExterno = @ConsultorioExterno,      
  IdUsuario = @Usuario,    
  regresa = @regresa,    
  regreso = @regreso,  
  fecha_parto = @fecha_parto  
 WHERE Id = @IdAtencion      
       
 (SELECT @IdAtencion IdAtencion)      
END      
      
      ' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_Valida_Diagnostico]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_Valida_Diagnostico]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[MED_Valida_Diagnostico]
	@IdDiagnostico	smallint
as

select * from MED_Atenciones where IdDiagnostico = @IdDiagnostico' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_GET_Atencion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_Atencion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[MED_GET_Atencion]                          
 @IdAtencion int                          
AS                          
SELECT MA.Nro_Documento,                          
 MA.FechaAtencion,                           
 isnull(MA.VolverEnDias,0) VolverEnDias,                           
 ISNULL(MA.PresionDia, '''') PresionDia,                          
 ISNULL(MA.PresionHora, '''')PresionHora,                          
 ISNULL(MA.PresionDiastolica, '''') PresionDiastolica,                          
 ISNULL(MA.PresionSistolica, '''')PresionSistolica,                          
 ISNULL(MA.IdDiagnostico,0) IdDiagnostico,                          
 ISNULL(MD.Descripcion,'''') DescripcionDiagnostico,                          
 ISNULL(MA.Observaciones,'''') Observaciones ,                        
 ISNULL(IdLicencia,'''') IdLicencia,                        
 ISNULL(MA.ConsultorioExterno,0) ConsultorioExterno,            
 MA.Regresa,                
 MA.Regreso,    
 MA.fecha_parto    
FROM dbo.MED_Atenciones MA                          
left JOIN dbo.Tabla_Medicos_Diagnosticos MD                          
 ON MD.codigo = MA.IdDiagnostico                        
WHERE MA.Id = @IdAtencion ' 
END
GO
/****** Object:  StoredProcedure [dbo].[CGetFirmantes_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CGetFirmantes_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[CGetFirmantes_Contratos]
	@Id_1 	[int]


AS 

Select     [Apellido],
	 [Cargo],
	 [Direccion],
	firma_contrato

from [dbo].[CFirmantes_Contratos] 
where id = @Id_1 and baja =0


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CAltaFirmantes_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CAltaFirmantes_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CAltaFirmantes_Contratos]
	( @Secretaria_2 	[int],
	 @Apellido_3 	[varchar](100),
	 @Cargo_4 	[varchar](200),
	 @Direccion_5 	[varchar](200),
	@firma bit)

AS 

DECLARE @id [int]
SET @id = (select max(id)+1 from [dbo].[CFirmantes_Contratos] )

IF @id is null BEGIN
	set @id = 1
END

INSERT INTO [dbo].[CFirmantes_Contratos] 
	 ( [Id],
	 [Secretaria],
	 [Apellido],
	 [Cargo],
	 [Direccion],
	firma_contrato) 

 
VALUES 
	( @Id,
	 @Secretaria_2,
	 @Apellido_3,
	 @Cargo_4,
	 @Direccion_5,
	@firma)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CGetFirmantes_X_Secretaria]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CGetFirmantes_X_Secretaria]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CGetFirmantes_X_Secretaria]
	 @Secretaria_2 	[int]

AS 

Select    [Id],
	 [Apellido]
	 
from [dbo].[CFirmantes_Contratos] 
where left(secretaria,2) =  left(@Secretaria_2,2) and baja =0
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CUptFirmantes_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CUptFirmantes_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CUptFirmantes_Contratos]
	(@Id_1 	[int],
	 @Apellido_4 	[varchar](100),
	 @Cargo_5 	[varchar](200),
	 @Direccion_6 	[varchar](200),
	@firma bit)

AS 
UPDATE [dbo].[CFirmantes_Contratos] 
SET  	 [Apellido]	 = @Apellido_4,
	 [Cargo]	 = @Cargo_5,
	 [Direccion]	 = @Direccion_6, 
	firma_contrato=@firma

WHERE ( [Id]	 = @Id_1)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[BajaFirmantes_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[BajaFirmantes_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[BajaFirmantes_Contratos]
	@Id_1 	[int]

AS 
UPDATE [dbo].[CFirmantes_Contratos] 

SET  Baja = 1
WHERE 	( [Id]	 = @Id_1)
' 
END
GO
/****** Object:  View [dbo].[VW_CFirmantes_Contratos]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CFirmantes_Contratos]'))
EXEC dbo.sp_executesql @statement = N'CREATE view [dbo].[VW_CFirmantes_Contratos]  
as  


select  id,apellido 
from cfirmantes_contratos  
where baja=0  


-- Select 	top 100 percent
-- 	TF.id,  
-- 	ttt.Descripcion +'' ''+ DP.Apellido +'' ''+ DP.Nombre Apellido    
--   
-- from dbo.Tabla_Firmantes TF  
--   
-- inner join dbo.datos_personales DP  
--  on DP.nro_documento = TF.nro_documento   
--   
-- LEFT join dbo.tabla_tratamientos TT    
--  on TT.id = tf.id_tratamiento    
-- 
-- LEFT join dbo.tabla_tratamientos_titulos TTT    
--  on TTT.id = tf.id_titulo 
-- 
-- where TF.Baja =0  
-- order by apellido  
 


'
GO
/****** Object:  StoredProcedure [dbo].[Alta_Certificados_Escolaridad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Alta_Certificados_Escolaridad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[Alta_Certificados_Escolaridad]
	(@id_interna_1 	[int],
	 @id_fam_2 	[smallint],
	 @Tipo_Cert_3 	[char](1),
	 @Fecha_4 	[smalldatetime])

AS 
if @fecha_4 ='''' begin
	set @fecha_4 = getdate()
end

if not exists (select id_interna from certificados_escolaridad where id_interna = @id_interna_1 and tipo_cert = @tipo_cert_3 and id_fam =  @id_fam_2)  begin
	INSERT INTO [dbo].[Certificados_Escolaridad] 
	 ( [id_interna],
	 [id_fam],
	 [Tipo_Cert],
	 [Fecha]) 
	VALUES 
	( @id_interna_1,
	 @id_fam_2,
	 @Tipo_Cert_3,
	 @Fecha_4)
end

if exists (select id_interna from certificados_escolaridad where id_interna = @id_interna_1 and tipo_cert = @tipo_cert_3 and id_fam = @id_fam_2)  begin
	update [dbo].[Certificados_Escolaridad] 
	set  [Fecha] =  @Fecha_4
 	where	id_interna = @id_interna_1 and tipo_cert = @tipo_cert_3 and id_fam = @id_fam_2
end


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Ins_Credenciales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Ins_Credenciales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CRED_Ins_Credenciales]
@IdTipo smallint,
@FechaAlta smalldatetime,
@UsuarioAlta varchar(20), 
@CodigoMagnetico int,
@CodigoImpreso int = null 
as

insert into dbo.CRED_Credenciales (IdTipo,FechaAlta,UsuarioAlta, CodigoMagnetico)
values (@IdTipo,GETDATE(),@UsuarioAlta, @CodigoMagnetico )

select SCOPE_IDENTITY()


IF (@CodigoImpreso is not null)
BEGIN
	insert into dbo.Cred_CodigoImpresoCredencial(IdCredencial,CodigoImpreso)
	values (SCOPE_IDENTITY(),@CodigoImpreso )

END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_CredencialesByCodigoImpreso]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_CredencialesByCodigoImpreso]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CRED_Get_CredencialesByCodigoImpreso]
	@CodigoImpreso int
AS
BEGIN

select cred.Id, cred.IdTipo, cred.CodigoMagnetico, codImp.CodigoImpreso
from dbo.Cred_CodigoImpresoCredencial codImp
INNER JOIN dbo.CRED_Credenciales cred
	ON codImp.IdCredencial = cred.Id
where codImp.CodigoImpreso = @CodigoImpreso
	AND cred.IdBaja is null

END' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_CredencialPorDocumento]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_CredencialPorDocumento]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CRED_Get_CredencialPorDocumento]
@Documento int
as
SELECT pers.Id IdPersona, persRel.Documento, persRel.Apellido, persRel.Nombre Nombres, pers.IdBaja,
		persRel.Fecha_comunicacion,
		asig.Id IdAsignacion,
		cred.Id IdCredencial, cred.IdTipo, cred.FechaAlta, cred.UsuarioAlta, cred.CodigoMagnetico, cred.IdBaja,
		codImpr.CodigoImpreso
FROM 
	dbo.CRED_Personas pers
	INNER JOIN dbo.CRED_Asignaciones asig
		ON pers.Id = asig.IdPersona
	INNER JOIN dbo.CRED_Credenciales cred
		ON asig.IdCredencial = cred.Id  
	INNER JOIN dbo.CRED_PersonasRelevadas persRel
		ON pers.Documento = persRel.Documento
	LEFT JOIN dbo.Cred_CodigoImpresoCredencial codImpr
		ON cred.Id = codImpr.IdCredencial
	WHERE 
		pers.Documento = @Documento 
		AND	pers.IdBaja is null 
		--AND cred.IdBaja is null
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_CredencialesByCodigoMagnetico]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_CredencialesByCodigoMagnetico]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CRED_Get_CredencialesByCodigoMagnetico]
	@CodigoMagnetico varchar(30)
AS
BEGIN

select cred.Id, cred.IdTipo, cred.CodigoMagnetico, codImpr.CodigoImpreso 
from dbo.CRED_Credenciales cred
LEFT JOIN dbo.Cred_CodigoImpresoCredencial codImpr
	ON cred.Id = codImpr.IdCredencial
where cred.CodigoMagnetico = @CodigoMagnetico
	AND cred.IdBaja is null

END' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_ADD_Pacientes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_ADD_Pacientes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
 CREATE   PROCEDURE [dbo].[MED_ADD_Pacientes]       
 @Tipo_Documento smallint,      
 @Nro_Documento int,      
 @Apellido varchar(300),      
 @Nombre varchar(300),      
 @FechaNac smalldatetime,      
 @Sexo smallint,      
 @area int,      
 @observaciones varchar(300),      
 @grupo varchar(1),      
 @factor varchar(20)    
AS      
      
--DECLARE @id AS INT      
--SET @id = (SELECT MAX(ID) + 1 FROM dbo.MED_PACIENTES)      
--IF @id IS NULL BEGIN      
-- SET @id = 1      
--END      
    
DECLARE @doc_exist int      
SET @doc_exist = (SELECT Nro_Documento FROM dbo.MED_PACIENTES WHERE Nro_Documento = @Nro_Documento)      
      
IF @doc_exist IS NULL BEGIN      
     
  INSERT INTO dbo.MED_PACIENTES      
   (--id,     
   tipo_documento,    
   nro_documento,    
   apellido,    
   nombre,    
   Fecha_nacimiento,    
   sexo,    
   area,    
   Grupo_Sanguineo,    
   Factor_Sanguineo,  
   Observaciones)      
  VALUES      
   (--@id,    
   @Tipo_Documento,     
   @Nro_Documento,     
   @Apellido,     
   @Nombre,     
   @FechaNac,     
   @Sexo,     
   @area,    
   @grupo,    
   @factor,  
   @observaciones)      
    
END     
ELSE     
BEGIN      
    
 UPDATE dbo.MED_PACIENTES   
 SET     nro_documento = @Nro_Documento,      
  apellido = @Apellido,      
  nombre = @Nombre,      
  Fecha_nacimiento = @FechaNac,      
  Sexo = @Sexo,      
  Area = @area,      
  Grupo_Sanguineo=@grupo,    
  Factor_Sanguineo=@factor,    
  Observaciones = @observaciones  
 WHERE nro_documento = @Nro_Documento      
      
END      
    

' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_GET_Tabla_Practicas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_Tabla_Practicas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[MED_GET_Tabla_Practicas]           
 @id int =null  ,        
 @Descripcion varchar(100) = NULL  
AS          
          
SELECT id, descripcion       
FROM dbo.Tabla_Medicos_Practicas         
WHERE Baja = 0  AND         
  (id=@id AND NOT @id is null)       OR  
  (Descripcion like ''%''+ @Descripcion +''%''  AND not @Descripcion is null)  
  
          
ORDER BY descripcion          
          
        
      
      
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Medicos_Practicas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Medicos_Practicas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE   PROCEDURE [dbo].[GABM_Tabla_Medicos_Practicas]
	 @Operacion char(1),  
	 @Id_1  [smallint]=null,  
	 @Descripcion_2  [varchar](100)=null 
 
AS

 
IF @operacion =''A''  
BEGIN  
 INSERT INTO dbo.Tabla_Medicos_Practicas      
	(Descripcion)
  VALUES   
  (@Descripcion_2)  
END  
  
IF @operacion =''M''  

BEGIN  
 update  dbo.Tabla_Medicos_Practicas   
 set  [Descripcion] =  @Descripcion_2 
 where  id = @Id_1  
END  
  
  
IF @operacion =''B''  
BEGIN  
 update  dbo.Tabla_Medicos_Practicas     
 set  baja =  1  
 where  id = @Id_1  
END  
  
IF @operacion =''R''  
BEGIN  
 update  dbo.Tabla_Medicos_Practicas     
 set  baja =  0  
 where  id = @Id_1  
END  
  
  
IF @operacion =''S''  
BEGIN  
  SELECT Id,  
  descripcion Descripción, 
  case when baja = 1 then  
   ''Si''  
  else  
   ''No''  
  end Baja   
 FROM  dbo.Tabla_Medicos_Practicas     
 WHERE ((id = @ID_1) OR (@ID_1 is null))  

 ORDER BY descripcion  
END  



' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_ADD_Seleccion_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ADD_Seleccion_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_ADD_Seleccion_Contratos]                    
@Memo int,                    
@Id_Contrato char(11),                    
@Observacion varchar(200),                    
@Renovar char(1),  
@id_area int,
@doc int

as                    
                      
IF not exists (select Id_Contrato from  dbo.CTR_Seleccion_Contratos where Id_Contrato=@id_contrato)                  
BEGIN                  
  INSERT INTO dbo.CTR_Seleccion_Contratos                     
  (Memo,                     
  Id_Contrato,                     
  Observacion,                     
  Renovar,  
  id_area,
  nro_documento)                       
  VALUES(@Memo,                     
  @Id_Contrato,                     
  @Observacion,                     
  @Renovar,  
  @id_area,
  @doc)                    
END          
ELSE          
BEGIN          
 IF (select Renovar from  dbo.CTR_Seleccion_Contratos where Id_Contrato=@id_contrato) <> @Renovar          
 BEGIN                  
                   
   UPDATE dbo.CTR_Seleccion_Contratos                       
   set  Memo = 0,          
   Renovar = @Renovar          
   where Id_Contrato = @Id_Contrato                    
                  
 END          
 ELSE          
 BEGIN                
      UPDATE dbo.CTR_Seleccion_Contratos                       
   set  Memo = @Memo          
   where Id_Contrato = @Id_Contrato            
 END          
END          
        
      
IF @Renovar = ''P''       
BEGIN    
  DELETE FROM dbo.CTR_Seleccion_Contratos     
 where Id_Contrato = @Id_Contrato                    
END    
    
  ' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_UPD_Seleccion_Contratos_Recepcion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_UPD_Seleccion_Contratos_Recepcion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_UPD_Seleccion_Contratos_Recepcion]
	@memo int,
	@año int,
	@usuario int,
	@usuario_recep int
as

UPDATE dbo.CTR_Seleccion_Contratos
set 	fecha_rrhh = getdate(),
	usuario_rrhh = @usuario_recep
where memo = @memo
	and year(fecha) = @año
	and usuario = @usuario





' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_UPD_Seleccion_Contratos_Paginas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_UPD_Seleccion_Contratos_Paginas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[CTR_UPD_Seleccion_Contratos_Paginas]
	@memo int,
	@paginas int
as

UPDATE dbo.ctr_seleccion_contratos
set paginas = @paginas
where memo = @memo
' 
END
GO
/****** Object:  StoredProcedure [dbo].[Web_GetConceptosLicenciaAgrupados]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Web_GetConceptosLicenciaAgrupados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 28/01/2009
-- Description:	Devuelve los conceptos de licencia agrupados
-- =============================================
CREATE PROCEDURE [dbo].[Web_GetConceptosLicenciaAgrupados]
AS
BEGIN
	SET NOCOUNT ON;
	SELECT 
		tcl.Nro_Articulo,
		tcl.Concepto inciso,
		tcl.id_Concepto idConcepto,
		tcl.descripcion descripcionConcepto,
		tcl.PathFormularioWeb,
		tcl.Dias_Habiles diasHabiles,
		gcl.idGrupo,
		gcl.descripcion descripcionGrupo,
		gcl.detalle detalleGrupo
		
		
		
	FROM dbo.tabla_conceptos_licencias tcl
	INNER JOIN dbo.WEB_AgrupacionConceptosLicencia wacl on
		tcl.id_concepto = wacl.idConcepto
	INNER JOIN dbo.Web_GruposConceptosLicencia gcl on
		wacl.idGrupo = gcl.idGrupo
	ORDER BY gcl.idGrupo
END' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Planillas_Firmas_Faltantes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Planillas_Firmas_Faltantes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[ASIS_GET_Planillas_Firmas_Faltantes]    
 @PeriodoDesde varchar(6),    
 @PeriodoHasta varchar(6),    
 @Area1 Int = NULL,    
 @Area2 Int = NULL,    
 @Area3 Int = NULL,    
 @Area4 Int = NULL,    
 @Area5 Int = NULL,    
 @Area6 Int = NULL,    
 @Area7 Int = NULL,    
 @Area8 Int = NULL,    
 @Area9 Int = NULL,    
 @Area10 Int = NULL,    
 @id_interna int= NULL    
AS    
  
set nocount on  
  
create table #tempo_Area    
(    
id int identity ,    
documento int,    
id_area int,    
desde smalldatetime,    
hasta smalldatetime,    
desdeAM varchar(6),    
hastaAM varchar(6),    
marca int    
)    
--Llama al SP que llena el area con el desde y el hasta de cada persona   
exec LEG_GET_Desglose_Area  
  
--select ''BORRAR'', * from #tempo_Area  
--RETURN  
  
DECLARE @PDesde varchar(6)     
 create table #tempo  
 (id int identity,  
 Periodos varchar(6))  
  
 set @PDesde = @PeriodoDesde  
  
 WHILE (@PDesde <= @PeriodoHasta)  
 BEGIN  
  insert into #tempo values (@PDesde)  
  set @PDesde =  @PDesde + 1  
 END  
  
  
SELECT   distinct  
DP.Id_Interna ,  
DP.Apellido + '', '' + DP.Nombre Apellido,  
--PR.Periodo,  
t.Periodos,  
tda.id id_area,  
TA.Descripcion,  
substring(convert(char(10),DF.Fecha_Min,103),7,4) + substring(convert(char(10),DF.Fecha_Min,103),4,2) Fecha_Min  
  
--Year(Fecha_Min) * 100 + case when month(Fecha_Min) < 10 then ''0'' + month(fecha_min)  else month(fecha_min) end minis,  
--@PeriodoDesde desde,  
--@PeriodoHasta hasta  
  
FROM dbo.Datos_Personales DP  
  
LEFT JOIN dbo.ASIS_Planillas_Recibidas PR    
 ON DP.Id_Interna = PR.Agente AND    
 (RIGHT(PR.Periodo,4) + LEFT(PR.Periodo,2) BETWEEN @PeriodoDesde AND @PeriodoHasta OR PR.Periodo IS NULL)     
  
--INNER JOIN dbo.VW_Desglose_Area DA     
-- ON DP.Id_Interna = DA.id_Interna

LEFT JOIN #tempo_Area tda
 ON tda.documento = dp.nro_documento
  and (RIGHT(PR.Periodo,4) + LEFT(PR.Periodo,2)) BETWEEN tda.desdeAM and tda.hastaAM
  
left JOIN dbo.Tabla_Areas TA     
ON tda.Id_Area = TA.id    
  
LEFT JOIN dbo.Designaciones_Fechas DF    
 ON DP.Id_Interna = DF.Id_Interna    
LEFT JOIN dbo.Legajos_No_Firman LNF    
 on LNF.Id_interna = DP.Id_Interna    
LEFT JOIN dbo.Legajo_Bajas LB    
 on lb.id_interna = dp.id_interna    
  
LEFT JOIN #tempo t  
 on t.periodos not in (select RIGHT(PR1.Periodo,4) + LEFT(PR1.Periodo,2)   
      from dbo.ASIS_Planillas_Recibidas PR1   
      where PR1.Agente = dp.id_interna and RIGHT(PR1.Periodo,4) + LEFT(PR1.Periodo,2) between @PeriodoDesde AND @PeriodoHasta  )  
  
WHERE       
LNF.Id_Interna IS NULL AND    
LB.Id_Interna IS NULL AND     
DP.VisibleLegajos = 1 AND     
(DP.Id_Interna = @id_interna OR @id_interna IS NULL) AND    
(((tDA.Id_Area = @Area1) OR    
(tDA.Id_Area = @Area2) OR     
(tDA.Id_Area = @Area3) OR    
(tDA.Id_Area = @Area4) OR     
(tDA.Id_Area = @Area5) OR    
(tDA.Id_Area = @Area6) OR    
(tDA.Id_Area = @Area7) OR    
(tDA.Id_Area = @Area8) OR    
(tDA.Id_Area = @Area9)) or @Area1 IS NULL)    
AND Year(Fecha_Min) * 100 + case when month(Fecha_Min) < 10 then ''0'' + month(fecha_min)  else month(fecha_min) end <= @PeriodoHasta    
AND t.periodos is not null  
AND substring(convert(char(10),DF.Fecha_Min,103),7,4) + substring(convert(char(10),DF.Fecha_Min,103),4,2) < t.periodos  
  
  
ORDER BY --TA.id, DP.Apellido, DP.Nombre, RIGHT(PR.Periodo,4) + LEFT(PR.Periodo,2)    
DP.Id_Interna , 
DP.Apellido + '', '' + DP.Nombre,  
t.Periodos,  
tda.id,  
TA.Descripcion, 
substring(convert(char(10),DF.Fecha_Min,103),7,4) + substring(convert(char(10),DF.Fecha_Min,103),4,2)  
' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Felicitaciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Felicitaciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[LEG_ADD_Felicitaciones]
	(@Jurisdicción_1 	[varchar](50),
	 @Organismo_2 	[varchar](50),
	 @Concepto_3 	[varchar](100),
	 @MotivadaPor_4 [varchar](100),
	 @Acto_Tipo_5 	[varchar](25),
	 @Acto_Nro_6 	[varchar](10),
	 @Fecha_7 	[smalldatetime],
	 @Folio_Nro_8 	[char](10),
	 @Id_Interna_9 	[int],
	@Datodebaja bit,
	@datonoimprime bit)


AS 
DECLARE @id [int]
SET @id = (select max(id_felicitaciones)+1 from dbo.felicitaciones where id_interna = @id_interna_9)
IF @id is null BEGIN
	set @id =1
END

INSERT INTO [dbo].[Felicitaciones] 
	 ( [Jurisdicción],
	 [Organismo],
	 [Concepto],
	 [MotivadaPor],
	 [Acto_Tipo],
	 [Acto_Nro],
	 [Fecha],
	 [Folio_Nro],
	 [Id_Interna],
	 [Id_Felicitaciones], 
	DATODEBAJA,
	DATONOIMPRIME) 
 
VALUES 
	( @Jurisdicción_1,
	 @Organismo_2,
	 @Concepto_3,
	 @MotivadaPor_4,
	 @Acto_Tipo_5,
	 @Acto_Nro_6,
	 @Fecha_7,
	 @Folio_Nro_8,
	 @Id_Interna_9,
	 @id, @DATODEBAJA,
	@DATONOIMPRIME)






' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Felicitaciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Felicitaciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[LEG_UPD_Felicitaciones]
	(@Jurisdicción_1 	[varchar](50),
	 @Organismo_2 	[varchar](50),
	 @Concepto_3 	[varchar](100),
	 @MotivadaPor_4 	[varchar](100),
	 @Acto_Tipo_5 	[varchar](25),
	 @Acto_Nro_6 	[varchar](10),
	 @Fecha_7 	[smalldatetime],
	 @Folio_Nro_8 	[char](10),
	 @Id_Interna_9 	[int],
	@Datodebaja bit,
	@datonoimprime bit,@id [int])


AS 
update [dbo].[Felicitaciones] 
set	 [Jurisdicción]= @Jurisdicción_1,
	 [Organismo]=@Organismo_2,
	 [Concepto]=@Concepto_3,
	 [MotivadaPor]=@MotivadaPor_4,
	 [Acto_Tipo]=@Acto_Tipo_5,
	 [Acto_Nro]=@Acto_Nro_6,
	 [Fecha]=@Fecha_7,
	 [Folio_Nro]=@Folio_Nro_8, 
	datodebaja = @datodebaja,
	datonoimprime = @datonoimprime

where  [Id_Interna]=@Id_Interna_9 	and  [Id_Felicitaciones] =@id
	

 
	 



' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Felicitaciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Felicitaciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[LEG_GET_Felicitaciones]
	@Legajo int,
	@id int

AS

SELECT DAT_P.Id_Interna as IdPersona, DAT_P.Apellido, DAT_P.Nombre, DAT_P.Nro_Documento, DAT_P.id_Interna, Fel.*, TTR.Descripcion as Acto_Desc 
FROM dbo.Datos_Personales as DAT_P 
LEFT JOIN dbo.Felicitaciones as Fel 
	ON DAT_P.id_Interna = Fel.id_Interna 
		AND datodebaja =0
LEFT JOIN dbo.Tabla_Tipos_Resoluciones AS TTR 
	ON TTR.id = Fel.Acto_TIpo 
WHERE (Nro_Documento = @Legajo or DAT_P.id_interna = @id)  
ORDER BY fecha DESC






' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Felicitaciones]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Felicitaciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE PROCEDURE [dbo].[RPT_LEG_Felicitaciones]
	@Id_Interna int
as

SELECT	Jurisdicción,
	Organismo,
	Concepto,
	MotivadaPor,
	ttr.descripcion Tipo_Acto,
	Acto_Nro,
	convert(char(10),Fecha,103) fecha
FROM dbo.Felicitaciones F
INNER JOIN dbo.Tabla_Tipos_Resoluciones TTR
	on TTR.id = F.Acto_tipo

WHERE	Id_Interna = @Id_Interna AND
	DatoDeBaja = 0 AND
	datonoimprime =0
ORDER BY convert(datetime,Fecha)





' 
END
GO
/****** Object:  View [dbo].[VW_Setup]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Setup]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_Setup]
AS
SELECT  *
FROM dbo.Setup


'
GO
/****** Object:  StoredProcedure [dbo].[Cupt_TMP_Cont_Leg]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Cupt_TMP_Cont_Leg]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[Cupt_TMP_Cont_Leg]

@doc int,
@id int=null,
@usuario varchar(20)=null,
@operacion int

AS

if @operacion=1 begin
	update tmp_contratos_legajos set
		recibido = @usuario
	where id=@id
end

if @operacion=2 begin
	update tmp_contratos_legajos set
		Aprobado = 1,
		Fecha=getdate()
	where legajo=@doc
end

' 
END
GO
/****** Object:  View [dbo].[VW_TMP_Cont_Leg]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_TMP_Cont_Leg]'))
EXEC dbo.sp_executesql @statement = N'

CREATE  view [dbo].[VW_TMP_Cont_Leg]
as
select legajo,fecha,motivo,envio,recibido,referencia,id 
from dbo.tmp_contratos_legajos
where (recibido='''' or recibido is null) and
           (aprobado=1)











'
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Medicos_Discapacidad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Medicos_Discapacidad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GABM_Tabla_Medicos_Discapacidad]
 @Operacion char(1),  
 @Id  [smallint]=null,  
 @Descripcion  [varchar](100)=null  
AS   

IF @operacion =''A''  
BEGIN  
 INSERT INTO dbo.Tabla_Medicos_Discapacidad   
	(Descripcion)
  VALUES   
	(@Descripcion)  
END  
  
IF @operacion =''M''  

BEGIN  
 UPDATE dbo.Tabla_Medicos_Discapacidad
 SET [Descripcion] =  @Descripcion
 WHERE  id = @Id
END  
  
  
IF @operacion =''B''  
BEGIN  
 UPDATE  dbo.Tabla_Medicos_Discapacidad  
 SET  baja =  1  
 WHERE  id = @Id  
END  
  
IF @operacion =''R''  
BEGIN  
 UPDATE dbo.Tabla_Medicos_Discapacidad  
 SET baja =  0  
 WHERE id = @Id  
END  
  
  
IF @operacion =''S''  
BEGIN  
  SELECT Id,  
  descripcion Descripción,  
  case when baja = 1 then  
   ''Si''  
  else  
   ''No''  
  end Baja   
 FROM  dbo.Tabla_Medicos_Discapacidad  
 WHERE (id = @ID) OR (@ID is null)  
 ORDER BY descripcion  
END  
' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Folio_Servicios_Adm_Publica]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Folio_Servicios_Adm_Publica]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_UPD_Folio_Servicios_Adm_Publica]    
 (@id int,
  @Folio char(10))     
    
AS     
    
UPDATE [dbo].[LEG_Servicios_Adm_Publica]     
SET Folio = @Folio
WHERE Id = @id' 
END
GO
/****** Object:  StoredProcedure [dbo].[get_servicios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[get_servicios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[get_servicios]
@hasta smalldatetime
as

select 
	e.id_interna legajo,
	dp.nombre,
	dp.apellido,
	''estado'' tipo,
	e.fecha_desde desde,
	case when e.fecha_hasta < @hasta then
		e.fecha_hasta
	else
		@hasta
	end
	hasta,
	df.fecha_min FechaDeIngreso
 from leg_servicios_adm_publica e
 inner join dbo.designaciones_fechas df on
	df.id_interna = e.id_interna
 inner join dbo.datos_personales dp on
	dp.id_interna = df.id_interna
 where e.datodebaja = 0 and
	e.fecha_desde < @hasta
union all
select 
	p.id_interna legajo,
	dp.nombre, dp.apellido,
	''privado'' tipo,
	p.fecha_desde desde,
	case when p.fecha_hasta < @hasta then
		p.fecha_hasta
	else
		@hasta
	end
	hasta,
	df.fecha_min FechaDeIngreso
from 
	leg_otros_servicios p
	inner join dbo.designaciones_fechas df on
		df.id_interna = p.id_interna
	inner join dbo.datos_personales dp on
		dp.id_interna = p.id_interna
	
 
where p.datodebaja = 0 and
	p.fecha_desde < @hasta

union all
select 
	distinct df.id_interna legajo, dp.nombre, dp.apellido,
	''ministerio'' tipo,
	df.fecha_min desde,
	@hasta hasta,
	df.fecha_min FechaDeIngreso
from dbo.designaciones_fechas df
	inner join dbo.datos_personales dp on
	dp.id_interna = df.id_interna
	where fecha_min < @hasta
order by legajo' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_DEL_Servicios_Adm_Publica]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_DEL_Servicios_Adm_Publica]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[LEG_DEL_Servicios_Adm_Publica]
	@Id_Interna int,
	@Folio varchar(10)
AS

DELETE FROM dbo.LEG_Servicios_Adm_Publica
WHERE 	Id_Interna = @Id_Interna AND
	Folio = @Folio



' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Servicios_Adm_Publica_Principal]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Servicios_Adm_Publica_Principal]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE PROCEDURE [dbo].[LEG_GET_Servicios_Adm_Publica_Principal]
	@Id_Interna int
AS

SELECT  
	max(sap.id) Id,
	max(TAA.Descripcion) Ambito, 
	max(jurisdiccion) Jurisdiccion, 
	max(folio) Folio, 
	max(caja) Caja,
	max(afiliado) Afiliado
FROM	[dbo].LEG_Servicios_adm_publica sap
INNER JOIN Tabla_Ambitos_Antiguedad TAA
	on TAA.Id = SAP.Ambito
WHERE	sap.id_interna=@Id_Interna and datodebaja = 0
GROUP BY Folio
ORDER BY folio






' 
END
GO
/****** Object:  StoredProcedure [dbo].[getPeriodosTrabajadosPublica]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[getPeriodosTrabajadosPublica]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[getPeriodosTrabajadosPublica]    
AS    
 SELECT Fecha_Desde desde, Fecha_Hasta hasta, Id_Interna legajo    
 FROM LEG_SERVICIOS_ADM_PUBLICA     
 where  DatoDeBaja<>1 ' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Servicios_Adm_Publica]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Servicios_Adm_Publica]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_ADD_Servicios_Adm_Publica]  
 (@Ambito_1  smallint,  
  @Jurisdiccion_2  [varchar](50),  
  @Organismo_3  [varchar](50),  
  @Cargo_4  smallint,  
  @Remunerativo_5  bit,  
  @Fecha_Desde_6  [datetime],  
  @Fecha_Hasta_7  [datetime],  
  @Causa_Egreso_8  [varchar](100),  
  @Folio_9  [char](10),  
  @Id_Interna_10  [int],  
  @doc_tit_11   [int] ,  
  @Caja_12  [varchar](50),   
  @Afiliado_13  [varchar](50),  
--   @Datodebaja bit,  
  @datonoimprime bit,  
  @Ctr_Cert bit =null,  
   @Usuario smallint)   
  
AS   
declare @ID [int]  
set @ID = (select max(id) +1 from [dbo].[LEG_Servicios_Adm_Publica]  where id_interna = @Id_Interna_10 and doc_titular = @doc_tit_11)  
  
if @ID is null begin  
 set @ID=1  
end  
  

IF @Cargo_4 = 0 BEGIN
	Set @Cargo_4 = 1
END
  
INSERT INTO [dbo].[LEG_Servicios_Adm_Publica]   
  ( [Ambito],  
  [Jurisdiccion],  
  [Organismo],  
  [Cargo],  
  [Remunerativo],  
  [Fecha_Desde],  
  [Fecha_Hasta],  
  [Causa_Egreso],  
  [Folio],  
  [Id_Interna],  
  [doc_titular],  
  [Caja],  
  [Afiliado],  
--  ID,   
  DATODEBAJA,  
  DATONOIMPRIME,  
  Ctr_Cert,  
  Usuario,  
  Fecha_Carga)   
   
VALUES   
 ( @Ambito_1,  
  @Jurisdiccion_2,  
  @Organismo_3,  
  @Cargo_4,  
  @Remunerativo_5,  
  @Fecha_Desde_6,  
  @Fecha_Hasta_7,  
  @Causa_Egreso_8,  
  @Folio_9,  
  @Id_Interna_10,  
  @doc_tit_11,  
  @Caja_12,  
  @Afiliado_13,  
--  @ID,   
  0, --@DATODEBAJA,  
  @DATONOIMPRIME,  
  @Ctr_Cert,  
  @Usuario,  
  getdate())  
  
  
  
  
  
  
  
  
  
  
  
  
  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Existencia_Folio_Administracion_Publica]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Existencia_Folio_Administracion_Publica]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[LEG_GET_Existencia_Folio_Administracion_Publica]
	@Id_Interna int,
	@Folio char(10)
AS
SELECT 	Id_Interna
FROM 	dbo.LEG_Servicios_Adm_Publica
WHERE 	Id_Interna = @Id_Interna AND
	Folio = @Folio

' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Pasividad]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Pasividad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[RPT_LEG_Pasividad]
	@Id_Interna int
as

SELECT	Caja_Jubilación,
	Nro_Beneficio_Jubilación,
	Fecha_Jub,
	
	Caja_de_Retiro,
	Nro_Beneficio_Retiro,
	Fecha_Retiro,
	
	Caja_de_Pensión,
	Nro_Beneficio_Pensión,
	Pension_Fecha
FROM dbo.Pasividad
WHERE id_interna = @Id_interna



' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Pasividad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Pasividad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_ADD_Pasividad]
	(@Caja_Jubilación_1 	[varchar](50),
	 @Nro_Beneficio_Jubilación_2 	[varchar](25),
	 @Fecha_Jub_3 	[datetime],
	 @Caja_de_Retiro_4 	[varchar](50),
	 @Nro_Beneficio_Retiro_5 	[varchar](25),
	 @Fecha_Retiro_6 	[datetime],
	 @Caja_de_Pensión_7 	[varchar](50),
	 @Nro_Beneficio_Pensión_8 	[varchar](25),
	 @Pension_Fecha_9 	[datetime],
	 @Folio_Nro_10 	[char](10),
	 @Id_Interna_11 	[int],
	 @Nro_doc_12 	[int])

AS INSERT INTO dbo.[Pasividad] 
	 ( [Caja_Jubilación],
	 [Nro_Beneficio_Jubilación],
	 [Fecha_Jub],
	 [Caja_de_Retiro],
	 [Nro_Beneficio_Retiro],
	 [Fecha_Retiro],
	 [Caja_de_Pensión],
	 [Nro_Beneficio_Pensión],
	 [Pension_Fecha],
	 [Folio_Nro],
	 [Id_Interna],
	 [Nro_doc]) 
 
VALUES 
	( @Caja_Jubilación_1,
	 @Nro_Beneficio_Jubilación_2,
	 @Fecha_Jub_3,
	 @Caja_de_Retiro_4,
	 @Nro_Beneficio_Retiro_5,
	 @Fecha_Retiro_6,
	 @Caja_de_Pensión_7,
	 @Nro_Beneficio_Pensión_8,
	 @Pension_Fecha_9,
	 @Folio_Nro_10,
	 @Id_Interna_11,
	 @Nro_doc_12)


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Pasividad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Pasividad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[LEG_GET_Pasividad]
	@id_interna int
AS
SELECT	P.* 
FROM dbo.Pasividad P
WHERE  	P.Id_interna = @id_interna
ORDER BY  folio_nro







' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Pasividad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Pasividad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_UPD_Pasividad]
	(@Id_Interna_1 	[int],
	 @Nro_doc_2 	[int],
	 @Caja_Jubilación_3 	[nvarchar](50),
	 @Nro_Beneficio_Jubilación_4 	[nvarchar](25),
	 @Fecha_Jub_5 	[datetime],
	 @Caja_de_Retiro_6 	[nvarchar](50),
	 @Nro_Beneficio_Retiro_7 	[nvarchar](25),
	 @Fecha_Retiro_8 	[datetime],
	 @Caja_de_Pensión_9 	[nvarchar](50),
	 @Nro_Beneficio_Pensión_10 	[nvarchar](25),
	 @Pension_Fecha_11 	[datetime],
	 @Folio_Nro_12 	[char](10),
	 @Id_Interna_13 	[int],
	 @Nro_doc_14 	[int])

AS 

UPDATE dbo.Pasividad

SET  [Caja_Jubilación]	 = @Caja_Jubilación_3,
	 [Nro_Beneficio_Jubilación]	 = @Nro_Beneficio_Jubilación_4,
	 [Fecha_Jub]	 = @Fecha_Jub_5,
	 [Caja_de_Retiro]	 = @Caja_de_Retiro_6,
	 [Nro_Beneficio_Retiro]	 = @Nro_Beneficio_Retiro_7,
	 [Fecha_Retiro]	 = @Fecha_Retiro_8,
	 [Caja_de_Pensión]	 = @Caja_de_Pensión_9,
	 [Nro_Beneficio_Pensión]	 = @Nro_Beneficio_Pensión_10,
	 [Pension_Fecha]	 = @Pension_Fecha_11,
	 [Folio_Nro]	 = @Folio_Nro_12

WHERE 
	( [Id_Interna]	 = @Id_Interna_1 AND
	 [Nro_doc]	 = @Nro_doc_2)





' 
END
GO
/****** Object:  View [dbo].[VW_Tabla_Doc_Presentados]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Doc_Presentados]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_Tabla_Doc_Presentados]
as
SELECT top 100 percent 
	id,
	descripcion 
FROM dbo.tabla_doc_presentados
WHERE baja=0 
ORDER BY posicion


'
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Medicos_Analisis]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Medicos_Analisis]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
Create PROCEDURE [dbo].[GABM_Tabla_Medicos_Analisis]
 @Operacion char(1),  
 @Id_1  [smallint]=null,  
 @Descripcion_2  [varchar](50)=null ,
 @Obligatorio bit = null
 
AS   
 
IF @operacion =''A''  
BEGIN  
 INSERT INTO dbo.Tabla_Medicos_Analisis   
	(Descripcion, Obligatorio)
  VALUES   
  (@Descripcion_2 , @Obligatorio)  
END  
  
IF @operacion =''M''  

BEGIN  
 update  dbo.Tabla_Medicos_Analisis
 set  [Descripcion] =  @Descripcion_2 ,
      Obligatorio = @Obligatorio
 where  id = @Id_1  
END  
  
  
IF @operacion =''B''  
BEGIN  
 update  dbo.Tabla_Medicos_Analisis  
 set  baja =  1  
 where  id = @Id_1  
END  
  
IF @operacion =''R''  
BEGIN  
 update  dbo.Tabla_Medicos_Analisis  
 set  baja =  0  
 where  id = @Id_1  
END  
  
  
IF @operacion =''S''  
BEGIN  
  SELECT Id,  
  descripcion Descripción, 
  case when Obligatorio = 1 then  
   ''Si''  
  else  
   ''No''  
  end Obligatorio,
  case when baja = 1 then  
   ''Si''  
  else  
   ''No''  
  end Baja   
 FROM  dbo.Tabla_Medicos_Analisis  
 WHERE ((id = @ID_1) OR (@ID_1 is null))  AND
	(Obligatorio = @Obligatorio OR @Obligatorio iS NULL)

 ORDER BY descripcion  
END  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Sanciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Sanciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[LEG_ADD_Sanciones]
	(@Jurisdicción_1 [varchar](50),
	 @Organismo_2 	[varchar](50),
	 @Acto_Tipo_3 	[varchar](25),
	 @Acto_Nro_4 	[varchar](10),
	 @Fecha_5 	[smalldatetime],
	 @Medida_6 	[varchar](50),
	 @Motivo_7 	[varchar](100),
	 @Fecha_Cumplimiento_desde_8 	[smalldatetime],
	 @Fecha_Cumplimiento_Hasta_9 	[smalldatetime],
	 @Folio_Nro_10 	[char](10),
	 @Id_Interna_11 	[int],
	 @Datodebaja bit,
	 @datonoimprime bit)


AS
declare 	 @Id [int]
set @id = ( select max(id)+1 from dbo.sanciones) 

 INSERT INTO [dbo].[Sanciones] 
	 ( [Jurisdicción],
	 [Organismo],
	 [Acto_Tipo],
	 [Acto_Nro],
	 [Fecha],
	 [Medida],
	 [Motivo],
	 [Fecha_Cumplimiento_desde],
	 [Fecha_Cumplimiento_Hasta],
	 [Folio_Nro],
	 [Id_Interna],
	 [Id], DATODEBAJA,
	DATONOIMPRIME) 
 
VALUES 
	( @Jurisdicción_1,
	 @Organismo_2,
	 @Acto_Tipo_3,
	 @Acto_Nro_4,
	 @Fecha_5,
	 @Medida_6,
	 @Motivo_7,
	 @Fecha_Cumplimiento_desde_8,
	 @Fecha_Cumplimiento_Hasta_9,
	 @Folio_Nro_10,
	 @Id_Interna_11,
	 @Id, @DATODEBAJA,
	@DATONOIMPRIME)






' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Sanciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Sanciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[LEG_GET_Sanciones]
	@Legajo int,
	@id int

AS

SELECT DAT_P.Id_Interna as IdPersona, DAT_P.Apellido, DAT_P.Nombre, San.*, DAT_P.Nro_Documento, DAT_P.id_Interna, TTR.Descripcion as Desc_Acto 
FROM [dbo].Datos_Personales as DAT_P 
LEFT JOIN [dbo].Sanciones as San 
	ON DAT_P.id_Interna = San.id_Interna 
	and datodebaja = 0
LEFT JOIN  [dbo].Tabla_Tipos_Resoluciones AS TTR 
	ON San.Acto_Tipo = TTR.id 
WHERE (Nro_Documento = @Legajo or DAT_P.id_interna = @id) 
ORDER BY fecha DESC














' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Sanciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Sanciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[LEG_UPD_Sanciones]
	(@Jurisdicción_1 [varchar](50),
	 @Organismo_2 	[varchar](50),
	 @Acto_Tipo_3 	[varchar](25),
	 @Acto_Nro_4 	[varchar](10),
	 @Fecha_5 	[smalldatetime],
	 @Medida_6 	[varchar](50),
	 @Motivo_7 	[varchar](100),
	 @Fecha_Cumplimiento_desde_8 	[smalldatetime],
	 @Fecha_Cumplimiento_Hasta_9 	[smalldatetime],
	 @Folio_Nro_10 	[char](10),
	 @Id_Interna_11 	[int],
	@Datodebaja bit,
	@datonoimprime bit,@id [int])


AS
update [dbo].[Sanciones] 
set	 [Jurisdicción]= @Jurisdicción_1,
	 [Organismo]=@Organismo_2,
	 [Acto_Tipo]=@Acto_Tipo_3,
	 [Acto_Nro]=@Acto_Nro_4,
	 [Fecha]=@Fecha_5,
	 [Medida]=@Medida_6,
	 [Motivo]=@Motivo_7,
	 [Fecha_Cumplimiento_desde]=@Fecha_Cumplimiento_desde_8,
	 [Fecha_Cumplimiento_Hasta]=@Fecha_Cumplimiento_Hasta_9,
	 [Folio_Nro]=@Folio_Nro_10, datodebaja = @datodebaja,
	datonoimprime = @datonoimprime
	 
where 	 [Id_Interna]= 	@Id_Interna_11 and  
	[Id]= @Id


	 
	 






' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Sanciones]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Sanciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[RPT_LEG_Sanciones]
	@ID_Interna int
as

SELECT	Jurisdicción,
	Organismo,
	ttr.descripcion Acto_tipo,
	Acto_Nro,
	convert(char(10),Fecha,103) Fecha_acto,
	Medida,
	Motivo,
	convert(char(10),Fecha_Cumplimiento_desde,103) Desde,
	convert(char(10),Fecha_Cumplimiento_Hasta,103) hasta
FROM dbo.Sanciones S
INNER JOIN dbo.Tabla_Tipos_Resoluciones TTR
	on TTR.id = S.acto_tipo
WHERE Id_Interna = @Id_Interna AND
	DatoDeBaja = 0 AND
	datonoimprime = 0
ORDER BY Fecha


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Antiguedad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Antiguedad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[LEG_UPD_Antiguedad] 
	@estado char(8),
	@privada char (8),
	@total char(8),
	@id_interna int,
	@legajo int

AS

if (select id_interna  from dbo.antiguedad where id_interna=@id_interna) is not null begin

	update dbo.antiguedad set ant_estado=@estado, ant_privada=@privada, ant_total=@total, id_interna=@id_interna , legajo=@legajo where id_interna = @id_interna
end


if (select id_interna  from antiguedad where id_interna=@id_interna) is null begin

	insert into dbo.antiguedad (ant_estado,ant_privada,ant_total,id_interna,legajo) values (@estado,@privada,@total,@id_interna,@legajo)
end









' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Antiguedad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Antiguedad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ASIS_GET_Antiguedad] 
@Id_Interna int
AS
select * from dbo.antiguedad where id_interna = @id_interna
' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Recepcion_DDJJ_Cargos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Recepcion_DDJJ_Cargos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[LEG_GET_Recepcion_DDJJ_Cargos]
	@Nro_Documento int,
	@Año smallint
AS
SELECT FechaRecepciono 
FROM dbo.LEG_DDJJ_Cargos
WHERE Nro_Documento = @Nro_Documento AND
	Año = @Año

	
	


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Recepcion_DDJJ_Cargos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Recepcion_DDJJ_Cargos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE   procedure [dbo].[LEG_ADD_Recepcion_DDJJ_Cargos]  
 @Nro_Documento int,  
 @Año smallint,  
 @Usuario smallint,
 @Folio varchar(10),  
 @Id_Comprobante int
AS  
INSERT INTO dbo.LEG_DDJJ_Cargos  
VALUES (@Nro_Documento, @Año, @Usuario, getdate(), @Folio,@Id_comprobante)  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_DDJJ_Cargos_Recepcionadas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_DDJJ_Cargos_Recepcionadas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[LEG_GET_DDJJ_Cargos_Recepcionadas]
	@Nro_Documento int,
	@Año int = NULL
AS
SELECT Año
FROM dbo.LEG_DDJJ_Cargos
WHERE Nro_Documento = @Nro_Documento  AND
	(Año = @Año OR @Año IS NULL)

	
	




' 
END
GO
/****** Object:  StoredProcedure [dbo].[CON_LEG_DDJJ_Cargos_Pendientes_Recepcion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CON_LEG_DDJJ_Cargos_Pendientes_Recepcion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[CON_LEG_DDJJ_Cargos_Pendientes_Recepcion]
	@Año smallint= NULL
AS
SELECT 	IDJ.Documento,
	Dp.Apellido +'', ''+ DP.Nombre Agente,
	IDJ.Año,
	convert(Char(10),IDJ.Fecha_Impresion,103) Fecha_Impresion

FROM dbo.LEG_Impresiones_DDJJ_Cargos IDJ
LEFT JOIN dbo.LEG_DDJJ_Cargos DJ
	on DJ.Nro_Documento = IDJ.Documento
INNER JOIN dbo.Datos_Personales DP
	ON DP.Nro_Documento = IDJ.Documento
WHERE DJ.Nro_Documento IS NULL AND
	(IDJ.Año = @año or @Año IS NULL)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Licencias_Autorizadas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Licencias_Autorizadas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[LEG_ADD_Licencias_Autorizadas]
	@Id_Interna int,
	@Año smallint
AS
IF (SELECT count(Id_Interna) FROM dbo.LEG_Licencias_Autorizadas WHERE Id_Interna = @Id_interna) = 0 BEGIN
	INSERT INTO dbo.LEG_Licencias_Autorizadas 
	VALUES (@Id_Interna, @Año)
END






' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_TMP_Indice_Documentos]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_TMP_Indice_Documentos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[RPT_LEG_TMP_Indice_Documentos]
	@id_interna int
as

select * from tmp_rpt_indice_documentos
where id_interna = @id_interna
ORDER BY left(folio,2)+right(left(folio,6),3)+right(folio,3)




' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_DEL_TMP_Indice_Documentos]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_DEL_TMP_Indice_Documentos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[RPT_LEG_DEL_TMP_Indice_Documentos]
	@Id_interna int
as
delete from dbo.TMP_RPT_Indice_Documentos
where id_interna = @Id_interna


' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Medicos_Enfermedades]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Medicos_Enfermedades]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

Create PROCEDURE [dbo].[GABM_Tabla_Medicos_Enfermedades]
 @Operacion char(1),  
 @Id  [smallint]=null,  
 @Descripcion  [varchar](50)=null
  
AS   
IF @operacion =''A''  
BEGIN  
	 INSERT INTO dbo.Tabla_Medicos_Enfermedades_PreExistentes    
		(Descripcion)
	 VALUES   
		(@Descripcion)  
END  
  
IF @operacion =''M''  
BEGIN  
	 UPDATE	dbo.Tabla_Medicos_Enfermedades_PreExistentes 
	 SET	[Descripcion] =  @Descripcion 
	 WHERE	Id = @Id  
END  
  
  
IF @operacion =''B''  
BEGIN  
	UPDATE	dbo.Tabla_Medicos_Enfermedades_PreExistentes   
	SET	Baja =  1  
	WHERE  	Id = @Id  
END  
  
IF @operacion =''R''  
BEGIN  
	UPDATE	dbo.Tabla_Medicos_Enfermedades_PreExistentes   
	SET	Baja =  0 
	WHERE  	Id = @Id  
END  
  
  
IF @operacion =''S''  
BEGIN  
  SELECT Id,  
  descripcion Descripción,  
  case when baja = 1 then  
   ''Si''  
  else  
   ''No''  
  end Baja   
 FROM  dbo.Tabla_Medicos_Enfermedades_PreExistentes   
 WHERE (id = @ID) OR (@ID is null)  
 ORDER BY descripcion  
END  



' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_GET_Enfermedad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_Enfermedad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[MED_GET_Enfermedad]       
 @Id int   = NULL,
 @Descripcion varchar(200) = NULL
AS      
SELECT  Id, TE.Descripcion  DescripcionEnfermedad  
FROM dbo.Tabla_Medicos_Enfermedades_PreExistentes  TE    
WHERE (Id = @Id  AND NOT @Id IS NULL) OR
	(Descripcion like ''%'' + @Descripcion +''%'' AND NOT @Descripcion IS NULL)
	
      
    
  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_ALTA_PARTE_Cabecera]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_ALTA_PARTE_Cabecera]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE     PROCEDURE [dbo].[ASIS_ALTA_PARTE_Cabecera] 
@FECHA smalldatetime, 
@ID_AREA int, 
@ID_USUARIO int

AS

INSERT INTO [dbo].[ASIS_PARTE_Cabecera] VALUES (
@Fecha, @Id_Area,
@Id_Usuario, 0
)



' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Parte_Diario_Asistencias_BC]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Parte_Diario_Asistencias_BC]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE  procedure [dbo].[ASIS_GET_Parte_Diario_Asistencias_BC]
	@Area int,
	@Fecha datetime,
	@Confirmado [bit] = 0
AS



SELECT	A.id_Detalle, 
	A.Id_Parte,
	DP.Id_Interna,
	A.Asistencia, 
	A.fecha ,
	(DP.Apellido + '', '' + DP.Nombre )Nombre  ,
	TCL.Descripcion Motivo_Parte, 
	ISNULL((SELECT Concepto FROM dbo.Licencias_Solicitadas LS WHERE Id_interna = DP.ID_Interna  AND A.fecha between desde AND hasta AND ls.FH_FIN_Antes_Interr IS NULL),0) Lic_Solicitada,
	ISNULL((SELECT Id FROM dbo.Licencias_Solicitadas LS WHERE Id_interna = DP.ID_Interna  AND A.fecha between desde AND hasta  AND ls.FH_FIN_Antes_Interr IS NULL),0) Id_Licencia,
	(SELECT TCL2.Descripcion FROM dbo.Licencias_Solicitadas LS
		INNER JOIN dbo.Tabla_Conceptos_licencias TCL2
			ON TCL2.id_concepto = ls.concepto
		WHERE LS.Id_interna = DP.ID_Interna  AND 
		(A.fecha between Ls.desde AND Ls.hasta)  AND ls.FH_FIN_Antes_Interr IS NULL) Motivo_Solicitado,
	DP.Nro_Documento

FROM dbo.ASIS_Parte_Detalle A 

INNER JOIN dbo.ASIS_Parte_Cabecera PC
	on PC.Id = A.Id_Parte

INNER JOIN dbo.Datos_Personales DP
	ON DP.Nro_Documento = A.Documento

INNER JOIN Tabla_Conceptos_licencias TCL
	ON TCL.id_concepto = A.Asistencia


WHERE 	PC.Fecha = @Fecha AND
	PC.Id_Area = @Area AND
	(A.confirmado = @confirmado or (@Confirmado = 0 AND A.Confirmado = 2)) AND
	(A.Confirmado <> 3) AND
	(A.Asistencia <> ISNULL((SELECT Id FROM dbo.Licencias_Solicitadas LS WHERE Id_interna = DP.ID_Interna  AND A.fecha between desde AND hasta  AND ls.FH_FIN_Antes_Interr IS NULL),0))


UNION 

--CON LICENCIAS SOLICITADAS y PRESENTE

SELECT  0, 
	PC.ID,
	DP.Id_Interna,
	0, 
	PC.Fecha ,
	(DP.Apellido + '', '' + DP.Nombre )Nombre  ,
	''Presente'', 
	Ls.Concepto,
	ls.Id,
	TCL.Descripcion, 
	DP.Nro_Documento
FROM dbo.Licencias_Solicitadas LS
INNER JOIN dbo.ASIS_Parte_Cabecera  PC
	on PC.id_area =@Area AND
	   PC.Fecha = @Fecha
INNER JOIN dbo.Datos_Personales DP
	on DP.id_Interna = LS.Id_Interna
INNER JOIN dbo.Tabla_Conceptos_licencias TCL
	ON TCL.id_concepto = ls.concepto
LEFT JOIN dbo.ASIS_Parte_Detalle PD
	on --PD.Asistencia = Ls.Concepto AND
	   PD.Documento = DP.Nro_Documento AND
	   PD.Id_Parte = PC.id
WHERE (LS.Desde <= PC.Fecha AND LS.HASTA >= PC.Fecha) AND
	PD.Id_Detalle IS NULL and
	ls.FH_FIN_Antes_Interr IS NULL

ORDER BY Nombre




' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Servicios_Jubilatorios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Servicios_Jubilatorios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_ADD_Servicios_Jubilatorios]
	(@Caja_1 	[varchar](15),
	 @Afiliacion_Nro_2 	[varchar](30),
	 @Fecha_Desde_3 	[datetime],
	 @Fecha_Hasta_4 	[datetime],
	 @Folio_8 	[char](10),
	 @Id_Interna_9 	[int],
	@doc_tit_10 	[int])

AS INSERT INTO [dbo].[Servicios_Jubilatorios] 
	 ( [Caja],
	 [Afiliacion_Nro],
	 [Fecha_Desde],
	 [Fecha_Hasta],
	 [Folio],
	 [Id_Interna],
	[doc_titular]) 
 
VALUES 
	( @Caja_1,
	 @Afiliacion_Nro_2,
	 @Fecha_Desde_3,
	 @Fecha_Hasta_4,
	 @Folio_8,
	 @Id_Interna_9,
	@doc_tit_10 )



' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetDatosPersonales_Baja]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetDatosPersonales_Baja]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[GetDatosPersonales_Baja]
	@id int
as
select dp.* , lb.*
from dbo.legajo_bajas lb

inner join datos_personales dp
on dp.id_interna=lb.id_interna

where lb.id_interna=@id

' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetTitulares_por_Apellido]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetTitulares_por_Apellido]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[GetTitulares_por_Apellido]
	@Apellido varchar(50)
AS

select Apellido,
	Nombre,
	Nro_Documento,
	id_interna Identificacion_Interna
from [dbo].datos_personales
where apellido like @apellido + ''%''
and id_interna not in (select id_interna from legajo_bajas)


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_LEGAJO]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_LEGAJO]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_GET_LEGAJO]  
 @Documento int,  
 @Id_Interna int  
AS  
  
SELECT DP.Id_Interna,  
 dp.nro_Documento,  
 dp.apellido,  
 dp.nombre,  
 dp.apellido +'', ''+ dp.nombre ApellidoyNombre,  
 lb.fecha_baja,  
 tdoc.descripcion TipoDoc,  
 cv.descripcion EstadoCivil,
 dp.Sexo
FROM [dbo].Datos_Personales DP   
inner join dbo.tabla_docidentidad Tdoc  
 on tdoc.id = dp.tipo_documento  
inner join dbo.tabla_estado_civil CV  
 on cv.id = dp.estado_civil  
LEFT join dbo.legajo_bajas LB  
     on lb.id_interna = dp.id_interna  
WHERE dp.Nro_Documento = @Documento or DP.id_interna = @id_Interna    
  
  
--LEFT JOIN ([dbo].Domicilio_Personal as DOM_P INNER JOIN [dbo].LocalidadesAFIP as LAFIP ON DOM_P.Localidad = LAFIP.idLocalidad) ON   
 -- DAT_P.id_Interna = DOM_P.id_Interna )   
--LEFT JOIN dbo.Designaciones_Fechas as DEF ON DAT_P.Id_Interna = DEF.Id_Interna  
  
  
  
  
  ' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetLegajo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetLegajo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[GetLegajo]
	@Legajo int,
	@id int
AS

select dp.* 
from [dbo].datos_personales dp

where (dp.Nro_Documento= @Legajo or dp.id_interna = @id)  
and  dp.id_interna not in (select id_interna from dbo.legajo_bajas)

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Legajo_Bajas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Legajo_Bajas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[LEG_GET_Legajo_Bajas]
	@Id_Interna int
AS

SELECT 	nro_doc,
	fecha_baja,
	Motivo_Baja,
	Usuario,
	Acto_Tipo,
	Acto_Nro,
	Acto_Fecha,
	Acto_Firmante
FROM dbo.Legajo_Bajas
WHERE Id_Interna =  @Id_Interna



' 
END
GO
/****** Object:  View [dbo].[CNPA_Personal]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[CNPA_Personal]'))
EXEC dbo.sp_executesql @statement = N'


CREATE  view [dbo].[CNPA_Personal]

as

--create table #CNPA
--	(Id int)

--insert into #CNPA
select dp.id_interna ,
	dp.nro_documento
from datos_personales DP
LEFT JOIN dbo.Legajo_bajas LB
	on lb.id_interna = dp.id_interna
where 	lb.Id_interna IS NULL AND -- SOLO ACTIVOS
	Visiblelegajos = 1 AND -- SOLO LEGJOS
	dp.id_interna in ( --QUE ESTEN EN PENSIONES
	select id_interna from vw_desglose_area 
	where id_area in (
		select distinct id_area from tabla_areas_estructura
		where left(codigo,7) = ''0101005''))

--select * from #CNPA

---drop table #CNPA



'
GO
/****** Object:  StoredProcedure [dbo].[LEG_DEL_Legajo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_DEL_Legajo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_DEL_Legajo]
	@Id_Interna int,
	@Nro_Doc int,
	@Fecha_Baja datetime,
	@Motivo_Baja smallint,
	@usuario smallint,
	@acto smallint,
	@nro char(10),
	@fecha_acto smalldatetime,
	@firmante int


AS
INSERT INTO dbo.Legajo_Bajas (Id_Interna, Nro_Doc, Fecha_Baja, Motivo_Baja, Usuario,acto_tipo,acto_nro,acto_fecha,acto_firmante) 
VALUES (@id_interna,@nro_doc,@fecha_baja, @motivo_baja, @usuario,@acto,@nro,@fecha_acto,@firmante)


--Marco baja en datos personales
UPDATE datos_personales
SET 	bajacontratos=visiblecontratos, 
	bajalegajos=visiblelegajos
WHERE nro_documento=@nro_doc



' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ReIncorporaciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ReIncorporaciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE procedure [dbo].[LEG_ReIncorporaciones]
	@Id_Interna int,
	@FechaReIngreso datetime
AS

UPDATE dbo.Designaciones_Fechas
SET Fecha_MIn = @FechaReIngreso
where ID_interna = @Id_Interna


DELETE FROM dbo.Legajo_Bajas
WHERE ID_interna = @Id_Interna


UPDATE dbo.Datos_Personales
SET BajaLegajos = 0
WHERE Id_Interna = @Id_Interna







' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Legajo_Bajas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Legajo_Bajas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[LEG_UPD_Legajo_Bajas]
	@Id_interna int,
	@Fecha_baja datetime,
	@Motivo_Baja smallint,
	@Usuario smallint,
	@Acto_Tipo smallint,
	@Acto_Nro varChar(10),
	@Acto_Fecha datetime,
	@Acto_Firmante smallint
AS

UPDATE dbo.Legajo_Bajas
SET	fecha_baja =  @Fecha_baja,
	motivo_baja = @Motivo_baja,
	Usuario = @Usuario,
	Acto_tipo = @Acto_tipo,
	Acto_Nro =  @Acto_Nro,
	Acto_Fecha =  @Acto_fecha,
	Acto_Firmante = @Acto_Firmante
WHERE Id_Interna = @Id_interna




' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_Rehabilita_Legajo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_Rehabilita_Legajo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_Rehabilita_Legajo]
	@nro_doc int
as

update datos_personales
set bajacontratos=0,
    bajalegajos=0
where nro_documento=@nro_doc


DELETE dbo.Legajo_Bajas
where nro_doc=@nro_doc



' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_UNIDAD_EVALUACION_AGENTE]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_UNIDAD_EVALUACION_AGENTE]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <13/03/2008>
-- Description:	<Trae el area de un agente>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_GET_UNIDAD_EVALUACION_AGENTE]
	@id_interna int,
	@id_periodo int
AS
BEGIN
	SET NOCOUNT ON;
    declare @hasta smalldatetime

	set @hasta = (select hasta
	from dbo.eval_periodos_evaluacion
	where id = @id_periodo)

	select da.id_area, da.desde
	from dbo.leg_desglose_area da
	left join dbo.legajo_bajas lb on
		lb.id_interna = da.id_interna
	where da.id_interna = @id_interna and da.desde < @hasta
	order by da.desde desc
END


' 
END
GO
/****** Object:  View [dbo].[VW_Legajo_Bajas]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Legajo_Bajas]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_Legajo_Bajas]

as

Select id_interna from dbo.legajo_bajas

'
GO
/****** Object:  StoredProcedure [dbo].[LIQ_GET_Dom_Pago]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_GET_Dom_Pago]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[LIQ_GET_Dom_Pago]    
 @id int    
as    
    
select  Id_DomPago id_area,    
 calle,    
 Numero nro,    
 piso,    
 Unidad dpto,    
 Denominacion Area    
       
from dbo.Tabla_Domicilio_Pago_Banco 

where Id_DomPago=@id    
    
    
    
    
    
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Situaciones_Revista]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Situaciones_Revista]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[LEG_GET_Situaciones_Revista]
	@Legajo int,
	@id int

AS

SELECT TTR.Descripcion, DAT_P.Id_Interna as IdPersona, DAT_P.Apellido, DAT_P.Nombre, Sit.*, DAT_P.Nro_Documento, DAT_P.id_Interna FROM [dbo].Datos_Personales as DAT_P 
	LEFT JOIN ([dbo].Situaciones_Especiales as Sit INNER JOIN [dbo].[Tabla_Tipos_Resoluciones] AS TTR ON Sit.Tipo_Acto = TTR.id ) ON 
		DAT_P.id_Interna = Sit.id_Interna 
	WHERE (Nro_Documento = @Legajo or DAT_P.id_interna = @id) AND DATODEBAJA = 0 ORDER BY folio_nro 






' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Situaciones_Especiales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Situaciones_Especiales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[LEG_UPD_Situaciones_Especiales]
	 (@Jurisdicción_15 	[varchar](50),
	 @Organismo_16 	[varchar](50),
	 @Situación_17 	[varchar](50),
	 @Motivo_18 	[varchar](50),
	 @Dest_Jurisdicc_19 	[varchar](50),
	 @Dest_Org_20 	[varchar](50),
	 @Fecha_Desde_21 	[smalldatetime],
	 @Fecha_Hasta_22 	[smalldatetime],
	 @Tipo_Acto_23 	[smallint],
	 @Acto_Nro_24 	[varchar](50),
	 @Fecha_Acto_25 	[smalldatetime],
	 @Folio_Nro_26 	[char](10),
	 @Id_Interna_27 	[int],
	 @Id_Situaciones_28 	[int],
	@Datodebaja bit,
	@datonoimprime bit)

AS UPDATE [dbo].[Situaciones_Especiales] 

SET  [Jurisdicción]	 = @Jurisdicción_15,
	 [Organismo]	 = @Organismo_16,
	 [Situación]	 = @Situación_17,
	 [Motivo]	 = @Motivo_18,
	 [Dest_Jurisdicc]	 = @Dest_Jurisdicc_19,
	 [Dest_Org]	 = @Dest_Org_20,
	 [Fecha_Desde]	 = @Fecha_Desde_21,
	 [Fecha_Hasta]	 = @Fecha_Hasta_22,
	 [Tipo_Acto]	 = @Tipo_Acto_23,
	 [Acto_Nro]	 = @Acto_Nro_24,
	 [Fecha_Acto]	 = @Fecha_Acto_25,
	 [Folio_Nro]	 = @Folio_Nro_26,
	 [Id_Interna]	 = @Id_Interna_27,
	datodebaja = @datodebaja,
	datonoimprime = @datonoimprime

WHERE 
	([Id_Situaciones]	 = @Id_Situaciones_28)



' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Situaciones_Revista]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Situaciones_Revista]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE procedure [dbo].[RPT_LEG_Situaciones_Revista]
	@Id_Interna int
AS
SELECT 	Jurisdicción,
	Organismo,
	Situación,
	Motivo,
	Dest_Jurisdicc,
	Dest_Org,
	case when fecha_desde = ''01/01/1900'' then
		''''
	else
	  convert(char(10),Fecha_Desde,103)
	end Fecha_Desde,
	case when fecha_hasta = ''01/01/1900'' then
		''''
	else
	convert(char(10),Fecha_Hasta,103)
	end Fecha_Hasta,
	ttr.descripcion Tipo_acto,
	Acto_Nro,
	Fecha_Acto,
	Folio_Nro

FROM  [dbo].[Situaciones_Especiales]  SE
INNER JOIN [dbo].Tabla_Tipos_Resoluciones  TTR
	ON SE.Tipo_Acto = TTR.Id
WHERE SE.Id_Interna = @Id_Interna AND
	DatoDeBaja = 0 AND
	DatoNoImprime = 0 
ORDER BY Fecha_Acto









' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Situaciones_Especiales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Situaciones_Especiales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[LEG_ADD_Situaciones_Especiales]
	(@Jurisdicción_1 [varchar](50),
	 @Organismo_2 	[varchar](50),
	 @Situación_3 	[varchar](50),
	 @Motivo_4 	[varchar](50),
	 @Dest_Jurisdicc_5 	[varchar](50),
	 @Dest_Org_6 	[varchar](50),
	 @Fecha_Desde_7 	[smalldatetime],
	 @Fecha_Hasta_8 	[smalldatetime],
	 @Tipo_Acto_9 	[smallint],
	 @Acto_Nro_10 	[varchar](10),
	 @Fecha_Acto_11 	[smalldatetime],
	 @Folio_Nro_12 	[char](10),
	 @Id_Interna_13 	[int],
	@Datodebaja bit,
	@datonoimprime bit)

AS 

Declare	 @Id_Situaciones_14	[int]
set  @Id_Situaciones_14 = (select max(Id_Situaciones)+1 from dbo.Situaciones_Especiales)		
if @Id_Situaciones_14 is null begin
	set @Id_Situaciones_14 =1
end


INSERT INTO [dbo].[Situaciones_Especiales] 
	 ( [Jurisdicción],
	 [Organismo],
	 [Situación],
	 [Motivo],
	 [Dest_Jurisdicc],
	 [Dest_Org],
	 [Fecha_Desde],
	 [Fecha_Hasta],
	 [Tipo_Acto],
	 [Acto_Nro],
	 [Fecha_Acto],
	 [Folio_Nro],
	 [Id_Interna],
	 [Id_Situaciones],
	DATODEBAJA,
	DATONOIMPRIME) 
 
VALUES 
	( @Jurisdicción_1,
	 @Organismo_2,
	 @Situación_3,
	 @Motivo_4,
	 @Dest_Jurisdicc_5,
	 @Dest_Org_6,
	 @Fecha_Desde_7,
	 @Fecha_Hasta_8,
	 @Tipo_Acto_9,
	 @Acto_Nro_10,
	 @Fecha_Acto_11,
	 @Folio_Nro_12,
	 @Id_Interna_13,
	 @Id_Situaciones_14,
	@DATODEBAJA,
	@DATONOIMPRIME)


' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetSituacionEspecialRevista]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetSituacionEspecialRevista]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[GetSituacionEspecialRevista]
	@id [int]
 AS

SELECT *
FROM [dbo].Situaciones_Especiales
where id_Situaciones = @id
order by folio_nro







' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_GET_Diagnosticos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_Diagnosticos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N' CREATE  PROCEDURE [dbo].[MED_GET_Diagnosticos]           
 --@id int   = NULL,      
@codigo varchar(5) = null ,  
@Descripcion varchar(600) = NUll  
       
AS          
SELECT  id, Descripcion, codigo         
FROM  dbo.Tabla_Medicos_Diagnosticos        
WHERE   --(id= @id  and NOT @Id Is NULL) OR  
 (ltrim(rtrim(codigo)) = ltrim(rtrim(@codigo))  OR @codigo Is NULL)     
 AND (Descripcion like ''%''+ @Descripcion +''%'' OR @descripcion is NULL)      
 AND Baja = 0 
order by Descripcion' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Medicos_Diagnosticos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Medicos_Diagnosticos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N' CREATE PROCEDURE [dbo].[GABM_Tabla_Medicos_Diagnosticos]  
 @Operacion char(1),    
 @Id  [smallint]=null,    
 @Codigo varchar(5)= Null,  
 @Descripcion  [varchar](600)=null    
AS     
  
IF @operacion =''A''    
BEGIN    
 INSERT INTO dbo.Tabla_Medicos_Diagnosticos     
 (Descripcion,
  codigo)  
  VALUES     
 (@Descripcion,
 @Codigo)    
END    
    
IF @operacion =''M''      
BEGIN    
 UPDATE dbo.Tabla_Medicos_Diagnosticos  
 SET [Descripcion] =  @Descripcion ,
	Codigo = @Codigo
 WHERE  id = @Id  
END    
    
    
IF @operacion =''B''    
BEGIN    
 UPDATE  dbo.Tabla_Medicos_Diagnosticos    
 SET  baja =  1    
 WHERE  id = @Id    
END    
    
IF @operacion =''R''    
BEGIN    
 UPDATE dbo.Tabla_Medicos_Diagnosticos    
 SET baja =  0    
 WHERE id = @Id    
END    
    
    
IF @operacion =''S''    
BEGIN    
  SELECT Id,    
  descripcion Descripción,    
  case when baja = 1 then    
   ''Si''    
  else    
   ''No''    
  end Baja,
 Codigo     
 FROM  dbo.Tabla_Medicos_Diagnosticos    
 WHERE (id = @ID) OR (@ID is null)    
 ORDER BY descripcion    
END    ' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_GET_Informacion_de_Persona]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_GET_Informacion_de_Persona]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
/*
Autor:Aza
FECHA: 21/03/2012
ESTE PROCEDIMIENTO CONSULTA POR DNI LAS DIFERENTES TABLAS EN DONDE SE ENCUENTRA UNA PERSONA
*/
CREATE procedure [dbo].[CRED_GET_Informacion_de_Persona]
@Documento int
as

set nocount on


declare @idpersona int

select ''TABLA: CRED_PERSONAS'',* 
from dbo.cred_personas
where documento = @Documento

select ''TABLA: CRED_PersonasRelevadas(Entrevistas)'', * 
from dbo.cred_personasrelevadas
where documento = @Documento

select ''TABLA: CRED_Domicilios(Entrevistas)'',* 
from dbo.cred_domicilios
where documento = @Documento

select @idpersona = id from dbo.cred_personas where documento = @Documento
select ''TABLA: CRED_PedidoAltaPersona(Autorizaciones)'',cp.*, cd.* 
from dbo.cred_pedidoaltapersonas cp, dbo.cred_documentos cd 
where cp.iddocumento = cd.id 
and idpersona = @idpersona

select  ''TABLA: CRED_ASIGNACIONES(Asign de credenciales)'',* 
from dbo.cred_asignaciones 
where idpersona = @idpersona

select  ''TABLA: CRED_credenciales'', cc.id, cc.idtipo, ct.descripcion,cc.CodigoMagnetico,cc.IdBaja,cc.FechaAlta,cc.UsuarioAlta 
from dbo.cred_credenciales cc, dbo.cred_asignaciones ca, dbo.cred_tiposcredenciales ct
where ca.idpersona = @idpersona
and ca.idcredencial = cc.id
and ct.id = cc.idtipo

select  ''TABLA: CRED_bajas'', cb.Id, cb.Fecha, cb.IdDocumento,cb.Motivo, cd.foliodesde, cd.foliohasta, cd.observacion,cb.IdAutorizante,cb.IdUsuario 
from dbo.cred_asignaciones ca, dbo.cred_bajas cb, dbo.cred_documentos cd 
where ca.idbaja = cb.id 
and ca.Idpersona = @idpersona
and cd.id = cb.IdDocumento

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_Persona_y_Organismo_por_Dni]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_Persona_y_Organismo_por_Dni]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CRED_Get_Persona_y_Organismo_por_Dni]
	@IdDocumento smallint
AS
BEGIN
	
select p.id, p.Apellido, p.Nombres, o.descripcion, o.ImagenCredencial AS ImagenCredencialOrganismo, o.TemplateWord AS TemplateWordOrganismo
from dbo.CRED_PedidoAltaPersonas pa, dbo.CRED_organismos o, dbo.CRED_personas p
where   pa.IdPersona = p.Id
	and pa.IdOrganismo = o.id
	and p.Documento = @IdDocumento
		
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_Organismo_de_persona_por_Dni]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_Organismo_de_persona_por_Dni]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CRED_Get_Organismo_de_persona_por_Dni]
	@Documento int
AS
BEGIN
	
select o.descripcion DescripcionOrganismo, o.ImagenCredencial AS ImagenCredencialOrganismo, o.TemplateWord AS TemplateWordOrganismo
from dbo.CRED_PedidoAltaPersonas pa, dbo.CRED_organismos o, dbo.CRED_personas p
where   pa.IdPersona = p.Id
	and pa.IdOrganismo = o.id
	and p.Documento = @Documento
		
END' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_Personas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_Personas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[CRED_Get_Personas]
as

select Id, Documento, Apellido, Nombres, IdBaja
from dbo.CRED_Personas' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Val_ExistePersonasPorDocumento]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Val_ExistePersonasPorDocumento]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[CRED_Val_ExistePersonasPorDocumento]
@Documento int
as

if exists (select 1
	   from dbo.CRED_Personas
	   where Documento = @Documento) 
select 1
else
select 0 ' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Ins_Personas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Ins_Personas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		Aza
-- Create date: 08/08/2011
-- Descripción:	Inserta nuevas personas.
-- =============================================
CREATE procedure [dbo].[CRED_Ins_Personas] 
 @documento int,
 @Apellido VARCHAR(50),
 @Nombres VARCHAR(50),
 @UsuarioAlta VARCHAR (20),
 @IdTipoCredencialAsignable smallint
 as

  insert into dbo.CRED_Personas (Documento,Apellido,Nombres,FechaAlta, UsuarioAlta)
  values (@documento, @Apellido, @Nombres, getdate(), @UsuarioAlta)
 
  declare @IdPersonaInsertada int
  set @IdPersonaInsertada = SCOPE_IDENTITY() 

  insert into dbo.CRED_CredencialesAsignablesAPersonas (idTipoCredencial, idPersona)
  values (@IdTipoCredencialAsignable, @IdPersonaInsertada)

  select @IdPersonaInsertada

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_PersonaPorDocumento]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_PersonaPorDocumento]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CRED_Get_PersonaPorDocumento]
	@Documento int
as
select pers.Id, pers.Apellido, pers.Nombres, pers.IdBaja, relev.Fecha_comunicacion,
bajaPersona.Id IdBajaPersona, bajaPersona.IdAutorizante IdAutorizanteDeBajaPersona, bajaPersona.IdDocumento IdDocumentoDeBajaPersona, bajaPersona.Motivo MotivoBajaPersona,
	docBajaPersona.Id IdDocumentoBajaPersona,
	tipoDocumentoBaja.Id IdTipoDocumentoBaja, tipoDocumentoBaja.Descripcion DescripcionTipoDocumentoBaja,
	docBajaPersona.FolioDesde DocumentoBajaPersonaFolioDesde, docBajaPersona.Foliohasta DocumentoBajaPersonaFolioHasta,
	persBaja.Id IdAutorizanteBaja, persBaja.Documento DocumentoAutorizanteBaja, persBaja.Apellido ApellidoAutorizanteBaja, persBaja.Nombres NombreAutorizanteBaja

from dbo.CRED_Personas pers
left join dbo.CRED_PersonasRelevadas relev on 
	pers.Documento = relev.Documento
LEFT JOIN dbo.CRED_Bajas bajaPersona
	ON bajaPersona.Id = pers.IdBaja
LEFT JOIN dbo.CRED_Autorizantes authBaja
	ON bajaPersona.IdAutorizante = authBaja.Id
LEFT JOIN dbo.CRED_Personas persBaja
	ON authBaja.IdPersona = persBaja.Id
LEFT JOIN dbo.CRED_Documentos docBajaPersona
	ON bajaPersona.IdDocumento = docBajaPersona.Id
LEFT JOIN dbo.CRED_TiposDocumentos tipoDocumentoBaja
	ON docBajaPersona.IdTipoDocumento = tipoDocumentoBaja.Id	
where pers.Documento = @Documento


' 
END
GO
/****** Object:  StoredProcedure [dbo].[Cred_Get_PersonasPendientesParaAsignarProvisoria]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Cred_Get_PersonasPendientesParaAsignarProvisoria]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE Procedure [dbo].[Cred_Get_PersonasPendientesParaAsignarProvisoria]
as

select	persRel.Documento [Documento], 
	persRel.Apellido + '', '' + persRel.Nombre [Apellido y Nombres], 
	org.Descripcion [Organismo]

FROM dbo.CRED_PersonasRelevadas persRel
INNER join dbo.CRED_Personas pers
ON pers.Documento = persRel.Documento
inner join dbo.CRED_PedidoAltaPersonas pedAlta
ON pedAlta.IdPersona = pers.Id
inner join dbo.CRED_Organismos org
ON org.Id = pedAlta.IdOrganismo
inner join dbo.CRED_credencialesasignablesapersonas cap
ON  pedAlta.IdPersona = cap.idpersona
WHERE pers.IdBaja is null
and persRel.Fecha_comunicacion > ''2010-01-01 00:00:00''
and cap.IdTipoCredencial = 1 
and pedAlta.IdPersona not in (select idpersona from dbo.cred_asignaciones asig
				where asig.idbaja is null)
order by persRel.Apellido asc

' 
END
GO

/****** Object:  StoredProcedure [dbo].[CRED_Get_Baja]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_Baja]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- ==========================================================================
-- Author:FC
-- Create date: 14/10/2011
-- Description:	Traigo el documento de baja de una asignacion
-- ==========================================================================
CREATE PROCEDURE [dbo].[CRED_Get_Baja]
	@IdAsignacion int
AS

SELECT 
	d.Id, 
	b.Motivo,
	td.Id IdTipoDocumento, td.Descripcion,
	d.FolioDesde, d.Foliohasta,d.Fecha,
	per.Documento, per.Apellido, per.Nombres
FROM
	dbo.CRED_Asignaciones asig
	INNER JOIN dbo.CRED_Bajas b
	ON asig.IdBaja = b.Id 
	INNER JOIN dbo.CRED_Documentos d
	ON b.IdDocumento = d.Id	
	INNER JOIN dbo.CRED_TiposDocumentos td
	ON d.IdTipoDocumento = td.Id
	INNER JOIN dbo.CRED_Autorizantes auth
	ON b.IdAutorizante = auth.Id
	INNER JOIN dbo.CRED_Personas per
	ON auth.IdPersona = per.Id
WHERE
	asig.Id = @IdAsignacion
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Upd_DatosPersonalesRelevados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Upd_DatosPersonalesRelevados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CRED_Upd_DatosPersonalesRelevados]
@Dni int,
@Apellido varchar(50),
@Nombre varchar(50),
@LugarTrabajo varchar(8),
@Telefono varchar(26),
@EmailMds varchar(60),
@EmailPersonal varchar(60),
@FechaComunicacion smalldatetime = null,
@Calle varchar(50),
@Numero varchar(6),
@Piso varchar(3),
@Depto varchar(255),
@Casa varchar(20),
@Manzana varchar(20),
@Torre varchar(20),
@Uf varchar(20),
@Codigo_Postal varchar(12),
@Localidad varchar(60),
@Barrio varchar(50),
@IdLocalidad int,
@IdUsuario smallint

as

DECLARE @Textosiesnulo varchar(3)
set @Textosiesnulo = ''N/E''

IF @FechaComunicacion is null BEGIN
set @FechaComunicacion = GETDATE()
END

IF exists (select 1 from dbo.CRED_PersonasRelevadas where Documento = @Dni and Fecha_comunicacion < @FechaComunicacion)  
BEGIN  
	UPDATE p
	SET Apellido = ISNULL(@Apellido,@Textosiesnulo),
	Nombre = ISNULL(@Nombre,@Textosiesnulo),
	Lugar_de_trabajo = ISNULL(@LugarTrabajo,@Textosiesnulo),
	Telefono = ISNULL(@Telefono,@Textosiesnulo),
	Email_mds = ISNULL(@EmailMds,@Textosiesnulo),
	Email_personal = ISNULL(@EmailPersonal,@Textosiesnulo),
	Fecha_comunicacion = @FechaComunicacion
	from dbo.CRED_PersonasRelevadas as p inner join dbo.CRED_domicilios as d 
	on p.Documento = d.Documento
	where p.Documento = @Dni
	--and p.Fecha_comunicacion < @FechaComunicacion
	
	UPDATE d
	SET Calle = ISNULL(@Calle,@Textosiesnulo),
        Numero=  ISNULL(@Numero,@Textosiesnulo),
		Piso = ISNULL(@Piso ,@Textosiesnulo),
		Depto = ISNULL(@Depto,@Textosiesnulo),
		Casa = ISNULL(@Casa ,@Textosiesnulo),
		Manzana= ISNULL(@Manzana ,@Textosiesnulo),
		Torre = ISNULL(@Torre,@Textosiesnulo),
		Uf = ISNULL(@Uf,@Textosiesnulo),
		Codigo_Postal= ISNULL(@Codigo_Postal,@Textosiesnulo) ,
		Localidad = ISNULL(@Localidad,@Textosiesnulo),
		Barrio = ISNULL(@Barrio,@Textosiesnulo),
		IdLocalidad = ISNULL(@IdLocalidad, @Textosiesnulo) 
	from dbo.CRED_PersonasRelevadas as p inner join dbo.CRED_domicilios as d 
	on p.Documento = d.Documento
	where p.Documento = @Dni
	END
	
	UPDATE dbo.CRED_Personas
	SET
		Nombres = @nombre,
		Apellido = @apellido
	WHERE 
		Documento = @Dni


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_PedidoAltaPersonasbyDni]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_PedidoAltaPersonasbyDni]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CRED_Get_PedidoAltaPersonasbyDni]
	@Documento int
AS
BEGIN

	SELECT 	
		pa.Id,
		p.Id as IdPersona,
		pa.IdDocumento,
		d.FolioDesde, d.Foliohasta,
		td.Id as IdTipoDocumento,
		td.Descripcion as DescripcionTipoDocumento,
		pa.IdOrganismo,
		o.Descripcion as DescripcionOrganismo,
		pa.IdAutorizante,
		per.Nombres as NombreAutorizante,
		per.Apellido as ApellidoAutorizante,
		per.Documento as DocumentoAutorizante,
		pa.IdConceptoRelacion,
		cr.Descripcion as DescripcionConceptoRelacion,
		cas.IdTipoCredencial,
		o.ImagenCredencial AS ImagenCredencialOrganismo, 
		o.TemplateWord AS TemplateWordOrganismo,
		pa.FechaAlta as FechaPedidoAlta,
		pa.Observacion ObservacionAltaPersona
	FROM dbo.CRED_PedidoAltaPersonas pa
	INNER JOIN dbo.CRED_Personas p
		ON p.Id = pa.IdPersona AND p.Documento = @Documento
	INNER JOIN dbo.CRED_Documentos d
		ON d.Id = pa.IdDocumento
	INNER JOIN dbo.CRED_TiposDocumentos td
		ON td.Id = d.IdTipoDocumento
	INNER JOIN dbo.CRED_Organismos o
		ON o.Id = pa.IdOrganismo	
	INNER JOIN dbo.CRED_Autorizantes au
		ON au.Id = pa.IdAutorizante
	INNER JOIN dbo.CRED_Personas per
		ON au.IdPersona = per.Id	
	INNER JOIN dbo.CRED_ConceptoRelacion cr
		ON cr.Id = pa.IdConceptoRelacion 
	INNER JOIN dbo.CRED_CredencialesAsignablesAPersonas cas
		ON cas.IdPersona = p.Id
END' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Upd_Personas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Upd_Personas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CRED_Upd_Personas]
	--@id int,
	@documento int,
	@apellido varchar(50),
	@nombre varchar(50),	
	@baja int = null
	
AS

UPDATE dbo.CRED_Personas
SET
Documento = @documento,
Nombres = @nombre,
Apellido = @apellido,
IdBaja = @baja
WHERE 
Documento = @documento
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_PersonasRelevadasSinAutorizacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_PersonasRelevadasSinAutorizacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CRED_Get_PersonasRelevadasSinAutorizacion]
as

select pr.* 
from cred_personasrelevadas pr 
inner join cred_personas p
on pr.documento = p.documento
and p.id not in (select Idpersona from cred_pedidoaltapersonas)



' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_Autorizantes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_Autorizantes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CRED_Get_Autorizantes]
AS
BEGIN
	SELECT 	
	perso.Id,
	perso.Nombres,
	perso.Apellido,
	perso.Documento
	FROM dbo.CRED_Personas perso
	INNER JOIN dbo.CRED_Autorizantes autoriz
	ON autoriz.IdPersona = perso.Id
END' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Desglose_Detalles]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Desglose_Detalles]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[LEG_UPD_Desglose_Detalles] 
	@Tipo char(1),
	@Id int,
	@Fecha datetime
AS
IF @Tipo = ''A'' BEGIN
	UPDATE dbo.LEG_Desglose_Area
	SET Desde = @Fecha
	WHERE Id = @Id
END
	
IF @Tipo = ''P'' BEGIN
	UPDATE dbo.LEG_Desglose_Planta
	SET Desde = @Fecha
	WHERE Id = @Id
END

IF @Tipo = ''N'' BEGIN
	UPDATE dbo.LEG_Desglose_NivelGrado
	SET Desde = @Fecha
	WHERE Id = @Id
END




' 
END
GO
/****** Object:  StoredProcedure [dbo].[EVAL_GET_Agentes_Unidad_Evaluacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[EVAL_GET_Agentes_Unidad_Evaluacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
-- =============================================
-- Author:		<Agustin>
-- Create date: <10/03/2008>
-- Description:	<Trae todos los agentes que alguna vez estuvieron en un area antes
--					de finalizado el periodo>
-- =============================================
CREATE PROCEDURE [dbo].[EVAL_GET_Agentes_Unidad_Evaluacion]
	@id_area int, @id_periodo int
AS
BEGIN
	SET NOCOUNT ON;
    declare @hasta smalldatetime

	set @hasta = (select hasta
	from dbo.eval_periodos_evaluacion
	where id = @id_periodo)
	
	select dp.id_interna, max(da.desde) area_desde, max(dpl.desde) planta_desde
	into #tmp
	from dbo.leg_desglose_area da
	inner join dbo.datos_personales dp
		on da.id_interna = dp.id_interna
		and da.desde < @hasta
	inner join dbo.leg_desglose_planta dpl
		on dp.id_interna = dpl.id_interna 
		and dpl.desde < @hasta
	where da.id_area = @id_area and da.desde < @hasta
	group by dp.id_interna
	order by dp.id_interna

select datp.nombre, datp.apellido, t.id_interna, dpl.id_planta, dar.id_area, ta.descripcion, tp.descripcion
from #tmp t
inner join dbo.datos_personales datp
	on t.id_interna = datp.id_interna
inner join dbo.leg_desglose_planta dpl
	on dpl.desde = t.planta_desde and dpl.id_interna = t.id_interna
	inner join dbo.tipo_de_planta tp
	on dpl.id_planta = tp.id
inner join dbo.leg_desglose_area dar
	on dar.desde = t.area_desde and dar.id_interna = t.id_interna
inner join dbo.tabla_areas ta
	on ta.id = dar.id_area

drop table #tmp
END



--[dbo].[EVAL_GET_Agentes_Unidad_Evaluacion] 1, 1
' 
END
GO
/****** Object:  View [dbo].[VW_Desglose_Planta]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Desglose_Planta]'))
EXEC dbo.sp_executesql @statement = N'






CREATE           view [dbo].[VW_Desglose_Planta]

AS
SELECT top 100 percent *
FROM dbo.LEG_Desglose_Planta
WHERE (
	convert(char(8),cast(desde as int),112) +
	cast(documento as varchar)+
	cast(id as varchar)  
 	) in
	(SELECT max(
	convert(char(8),cast(desde as int),112) +
	cast(documento as varchar) +
	cast(id as varchar)  	
	
	
	)
	FROM dbo.LEG_Desglose_Planta
	where desde <=getdate()
	GROUP BY id_interna)
ORDER BY id_interna














'
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Medicos_Aptos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Medicos_Aptos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
--alter table Tabla_Medicos_Aptos
--add DiasValido smallint not null default(0)
--go

create PROCEDURE [dbo].[GABM_Tabla_Medicos_Aptos]
 @Operacion char(1),  
 @Id  [smallint]=null,  
 @Descripcion  [varchar](50)=null,
 @DiasValido smallint =0
  
AS   

IF @operacion =''A''  
BEGIN  
 INSERT INTO dbo.Tabla_Medicos_Aptos    
	(Descripcion, DiasVAlido)
  VALUES   
  (@Descripcion, @DiasValido)  
END  
  
IF @operacion =''M''  

BEGIN  
 update  dbo.Tabla_Medicos_Aptos 
 set  [Descripcion] =  @Descripcion ,
 	DiasValido = @DiasValido 
 where  id = @Id  
END  
  
  
IF @operacion =''B''  
BEGIN  
 update  dbo.Tabla_Medicos_Aptos   
 set  baja =  1  
 where  id = @Id  
END  
  
IF @operacion =''R''  
BEGIN  
 update  dbo.Tabla_Medicos_Aptos   
 set  baja =  0  
 where  id = @Id  
END  
  
  
IF @operacion =''S''  
BEGIN  
  SELECT Id,  
  descripcion Descripción,  
  DiasValido Validez,
  case when baja = 1 then  
   ''Si''  
  else  
   ''No''  
  end Baja   
 FROM  dbo.Tabla_Medicos_Aptos   
 WHERE (id = @ID) OR (@ID is null)  
 ORDER BY descripcion  
END  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_TipoDocumentoByName]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_TipoDocumentoByName]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:FC
-- Create date: 11/08/2011
-- Description:	Trae un tipoDocumento por nombre
-- =============================================
CREATE PROCEDURE [dbo].[CRED_Get_TipoDocumentoByName]
@nombreTipoDocumento varchar(30)
AS
BEGIN

select Id
from dbo.CRED_TiposDocumentos
where dbo.CRED_TiposDocumentos.Descripcion = @nombreTipoDocumento

END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_Documentos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_Documentos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CRED_Get_Documentos]
as
-- =============================================
-- Author:		Aza
-- Create date: 08/08/2011
-- Descripción:	Obtiene los documentos
-- =============================================
select documentos.Id docid, documentos.IdTipoDocumento, documentos.FolioDesde,
 documentos.FolioHasta, documentos.Fecha, documentos.Observacion, tipo.Descripcion, tipo.id tipoid
FROM dbo.CRED_Documentos documentos inner join dbo.CRED_TiposDocumentos tipo 
ON documentos.IdTipoDocumento = tipo.id' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_TiposDocumentos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_TiposDocumentos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[CRED_Get_TiposDocumentos]
as

select ID, Descripcion
from dbo.CRED_TiposDocumentos

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Documentacion_Legajo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Documentacion_Legajo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[LEG_ADD_Documentacion_Legajo]  
 @Id_interna int,  
 @Foto bit,  
 @PresentoAptoMedico smallint,  
 @Decreto894 bit,  
 @FotocDNI bit,  
 @Cuadernillo bit,  
 @FotocObraSocial bit,  
 @Titulo smallint,  
 @CertServAnt bit,  
 @AcredEstadoCivil bit,  
 @CV bit,  
 @NacimientoPresenta bit,  
 @NacimientoCantidad smallint,  
 @FotocDniHijosPresenta bit,  
 @FotocDniHijosCantidad smallint,  
 @AntecPenales bit,  
 @ComprobCuit bit,  
 @OpcionJub bit,  
 @InfoSumaria smallint,  
 @Observaciones text ,
 @DDJJCtr1 bit,
 @DDJJCtr2 bit,
 @DDJJCtr3 bit	
AS   
IF not exists (select id_interna from dbo.LEG_Documentacion_legajo where id_interna =@Id_interna) BEGIN  
 INSERT INTO [dbo].[LEG_Documentacion_Legajo]   
  ([Id_interna] ,  
  [Foto] ,  
  [PresentoAptoMedico] ,  
  [Decreto_894] ,  
  [FotocDNI] ,  
  [Cuadernillo],  
  [FotocObraSocial],  
  [Titulo] ,  
  [CertifServAnt] ,  
  [AcreditEstadoCivil] ,  
  [CV] ,  
  [ActasNacimientoPresenta] ,  
  [ActasNacimientoCantidad] ,  
  [FotocDNIHijosPresenta] ,  
  [FotocDNIHijosCantidad] ,  
  [AntecedentesPenales] ,  
  [ComprobCUIT] ,  
  [OpcionJ] ,  
  [InfoSumaria] ,  
  [Observaciones],
  DDJJCtr1,
  DDJJCtr2,
  DDJJCtr3)  
  VALUES   
  (@Id_interna,  
  @Foto,  
  @PresentoAptoMedico,  
  @Decreto894,  
  @FotocDNI,  
  @Cuadernillo,  
  @FotocObraSocial,  
  @Titulo,  
  @CertServAnt,  
  @AcredEstadoCivil,  
  @CV,  
  @NacimientoPresenta,  
  @NacimientoCantidad,  
  @FotocDniHijosPresenta,  
  @FotocDniHijosCantidad,  
  @AntecPenales,  
  @ComprobCuit,  
  @OpcionJub,  
  @InfoSumaria,  
  @Observaciones,
  @DDJJCtr1,
  @DDJJCtr2,
  @DDJJCtr3)  
END  
ELSE BEGIN  
 UPDATE [dbo].[leg_Documentacion_Legajo]   
 SET [Foto]  =@Foto,  
  [PresentoAptoMedico]  =@PresentoAptoMedico,  
  [Decreto_894]  =@Decreto894,  
  [FotocDNI]  =@FotocDNI,  
  [Cuadernillo] =@Cuadernillo,  
  [FotocObraSocial] =@FotocObraSocial,  
  [Titulo]  =@Titulo,  
  [CertifServAnt]  =@CertServAnt,  
  [AcreditEstadoCivil]  =@AcredEstadoCivil,  
  [CV]  =@CV,  
  [ActasNacimientoPresenta]  =@NacimientoPresenta,  
  [ActasNacimientoCantidad]  =@NacimientoCantidad,  
  [FotocDNIHijosPresenta]  =@FotocDniHijosPresenta,  
  [FotocDNIHijosCantidad]  =@FotocDniHijosCantidad,  
  [AntecedentesPenales]  =@AntecPenales,  
  [ComprobCUIT]  =@ComprobCuit,  
  [OpcionJ]  =@OpcionJub,  
  [InfoSumaria]  =@InfoSumaria,  
  [Observaciones]=@Observaciones,
  DDJJCtr1 = @DDJJCtr1,
  DDJJCtr2 = @DDJJCtr2,
  DDJJCtr3 = @DDJJCtr3
 WHERE Id_Interna = @Id_Interna  
END  
  
  
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Documentacion_Legajo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Documentacion_Legajo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[LEG_GET_Documentacion_Legajo]  
 (@Id_interna_1  [int])  
AS   
  
SELECT   [DL].[Id_interna], 
	[DL].[Foto], 
	[DL].[PresentoAptoMedico], 
	[DL].[Decreto_894],   
	DL.FotocDNI,  
	[DL].[Cuadernillo], 
	[DL].[FotocObraSocial], 
	[DL].[Titulo], 
	[DL].[CertifServAnt],   
	[DL].[AcreditEstadoCivil], 
	[DL].[CV], 
	[DL].[ActasNacimientoPresenta], 
	[DL].[ActasNacimientoCantidad], 
	[DL].[FotocDNIHijosPresenta], 
	[DL].[FotocDNIHijosCantidad],  
	[DL].[AntecedentesPenales], 
	[DL].[ComprobCUIT], 
	[DL].[OpcionJ], 
	[DL].[InfoSumaria], 
	[DL].[Observaciones],
	[DL].[DDJJCtr1] , 
	[DL].[DDJJCtr2], 
	[DL].[DDJJCtr3] 

FROM [dbo].[LEG_Documentacion_Legajo] [DL]  
WHERE [DL].[id_interna] =  @Id_interna_1  

' 
END
GO
/****** Object:  View [dbo].[CTR_GET_CTR_Tempo_Renovacion]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_CTR_Tempo_Renovacion]'))
EXEC dbo.sp_executesql @statement = N'CREATE view [dbo].[CTR_GET_CTR_Tempo_Renovacion]
as
select * from dbo.CTR_Tempo_Renovacion


'
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Validar_IdInterna]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Validar_IdInterna]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[LEG_GET_Validar_IdInterna]
	@Id_interna as int
AS
SELECT 	apellido +'', ''+ Nombre Apellido
FROM 	dbo.datos_personales
WHERE	id_interna = @Id_interna


' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_GET_Consulta_por_Apellido]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_GET_Consulta_por_Apellido]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create PROCEDURE [dbo].[MED_GET_Consulta_por_Apellido]     
	@Apellido varchar(40)    
AS    
    
SELECT Apellido, Nombre, Nro_Documento, id_interna    
FROM dbo.DATOS_PERSONALES    
WHERE apellido like @apellido + ''%''    
    
UNION ALL    
    
SELECT M.Apellido, M.Nombre, M.Nro_documento, null Id_interna    
FROM dbo.MED_PACIENTES   M  
WHERE M.apellido like @apellido + ''%''          
  
    
ORDER BY APELLIDO    
    
    
    
  
' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_GET_Recibo_por_Id]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_GET_Recibo_por_Id]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[PLA_GET_Recibo_por_Id]        
	@Id_Recibo int
AS        
SELECT  DP.Apellido +'', ''+ DP.Nombre Agente   
       
FROM dbo.PLA_Recibos R        
INNER JOIN dbo.Datos_Personales DP        
 on DP.Id_Interna = right(left(R.Cuil,11),8)
            
WHERE  Id_Recibo = @Id_Recibo 


' 
END
GO
/****** Object:  StoredProcedure [dbo].[Web_EliminarInasistenciaALaFecha]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Web_EliminarInasistenciaALaFecha]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 04/03/09
-- Description:	Eliminar las solicitudes de inasitencia de la web
-- =============================================
CREATE PROCEDURE [dbo].[Web_EliminarInasistenciaALaFecha]
	@nroDocumento int,
	@fecha datetime
AS
BEGIN
	SET NOCOUNT ON;
	
	declare @idInterna int
	set @idInterna = (Select id_interna from dbo.datos_personales where nro_documento = @nroDocumento)


	delete from dbo.asis_solicitudes_licencia_web 
	where 
		id_interna = @idInterna and
		cast(cast(year(@fecha)as varchar) + ''-'' + cast(day(@fecha)as varchar) + ''-'' + cast(month(@fecha)as varchar) as datetime)  between desde and hasta

END' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetAntec_Militares]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetAntec_Militares]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GetAntec_Militares]
	 @Id_Interna	[int],
	@Legajo	[int]

AS 
Select 
dp.apellido,
dp.nombre,
dp.Fecha_Nacimiento,
TD.descripcion   Tipo_Documento,
dp.Nro_Documento,
DM.descripcion,
AM.*

from [dbo].Antec_Militares  AM
inner join [dbo].Datos_Personales DP
	on DP.id_interna = AM.id_interna
inner join [dbo].tabla_docidentidad TD
	on td.id = DP.tipo_documento	
inner join[dbo].tabla_distritosmilitares DM
	on DM.id = DP.Distrito_Militar
Where AM.id_interna = @id_interna or AM.legajo = @legajo






' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_UPD_Datos_Personales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_UPD_Datos_Personales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_UPD_Datos_Personales]
(@Tipo_Documento 	[int],
@Nro_Documento 	[int],
@Id_Interna [int],
@Apellido 	[nvarchar](40),
@Nombre 	[nvarchar](60),
@Cuil_Nro 	[varchar](15),	 
@Estado_Civil 	[int],
@Fecha_Nacimiento 	[datetime],
@Sexo 	[smallint], 
@Nacionalidad 	[smallint],
@Regimen_Jubilatorio 	[smallint],
@Denominacion	 [smallint])	
AS 
UPDATE [dbo].[Datos_Personales] 
	SET
	 [Id_Interna]=@Id_Interna,
	 [Apellido]=@Apellido,
	 [Nombre]=@Nombre,
	 [Sexo]=@Sexo,
	 [Fecha_Nacimiento]=@Fecha_Nacimiento,
	 [Nacionalidad]=@Nacionalidad,
	 [Cuil_Nro]=@Cuil_Nro,
	 [Tipo_Documento]=@Tipo_Documento,
	 [Nro_Documento]=@Nro_Documento,
	 [Regimen_Jubilatorio]=@Regimen_Jubilatorio,
	 [Denominacion]=@Denominacion,
	 [Estado_Civil]=@Estado_Civil

WHERE Nro_Documento=@Nro_Documento
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Certificados_Antiguedad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Certificados_Antiguedad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Certificados_Antiguedad]  
	 @IdCertificado int= NULL,  
	 @Nro_Documento int = NULL  
AS  
SELECT  distinct convert(char(10),FechaCertificado,103) FechaCertificado,  
 DP.Apellido Apellido,  
 dp.Nombre Nombre,  
 dp.Nro_Documento,  
 AC.NIvel,  
  AC.Grado,  
 AC.Funcion,  
 ac.TipoCertificado,  
 convert(char(10),AR.FechaCorte,103) FechaCorte,  
 ac.antiguedad,  
 ac.IdCertificado  
FROM dbo.CTR_Antiguedad_Certificados AC  
INNER JOIN dbo.CTR_Antiguedad_Reconocida_grado AR  
 ON AR.Id_Calculo = AC.IdCalculo  
INNER JOIN dbo.Datos_Personales DP  
 on DP.Nro_Documento = AR.Nro_Documento  
WHERE (AC.IdCertificado = @IdCertificado OR @IdCertificado IS NULL) AND  
       (AR.Nro_Documento = @Nro_Documento OR @Nro_Documento IS NULL)  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[Modificar_Datos_Personales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Modificar_Datos_Personales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[Modificar_Datos_Personales]

	( @Apellido_3 	[nvarchar](40),
	 @Nombre_4 	[nvarchar](60),
	 @Tipo_Planta_5 	[int],
	 @Sexo_6 	[smallint],
	 @Fecha_Nacimiento_7 	[datetime],
	 @Lugar_Nacimiento_8 	[nvarchar](50),
	 @Nacionalidad_9 	[smallint],
	 @Fecha_Ingreso_Pais_10 	[datetime],
	 @Carta_Ciudadania_11 	[nvarchar](50),
	 @Juzgado_12 	[nvarchar](100),
	 @Secretario_13 	[nvarchar](100),
	 @Fecha_Juzgado_14 	[datetime],
	 @Cuil_Nro_15 	[varchar](15),
	 @Tipo_Documento_16 	[int],
	 @Nro_Documento_17 	[int],
	 @Distrito_Militar_18 	[smallint],
	 @Clase_19 	[int],
	 @Cedula_Identidad_20 	[char](11),
	 @Expedida_por_21 	[nvarchar](50),
	 @Regimen_Jubilatorio_22 	[nvarchar](50),
	 @Estado_Civil_24 	[smallint],
	 @Denominacion_23 	[smallint],
	 @Fecha_Matrimonio_25 	[datetime],
	 @Fecha_Matrimonio_2da_26 	[datetime],
	 @Grupo_Sanguineo_27 	[nvarchar](2),
	 @Factor_Sanguineo_28 	[nvarchar](20),
	 @Credencial_29 	[int],
	 @Obra_Social_30 	[smallint],
	 @Nro_Afiliado_31 	[varchar](50),
	 @Antiguedad_vacaciones_32 	[datetime],
	 @Antiguedad_reconocimiento_33 	[datetime],
 	 @Id_Interna_1 	[int])




AS UPDATE [dbo].[Datos_Personales] 

SET  	 [Apellido]	 = @Apellido_3,
	 [Nombre]	 = @Nombre_4,
	 [Tipo_Planta]	 = @Tipo_Planta_5,
	 [Sexo]	 = @Sexo_6,
	 [Fecha_Nacimiento]	 = @Fecha_Nacimiento_7,
	 [Lugar_Nacimiento]	 = @Lugar_Nacimiento_8,
	 [Nacionalidad]	 = @Nacionalidad_9,
	 [Fecha_Ingreso_Pais]	 = @Fecha_Ingreso_Pais_10,
	 [Carta_Ciudadania]	 = @Carta_Ciudadania_11,
	 [Juzgado]	 = @Juzgado_12,
	 [Secretario]	 = @Secretario_13,
	 [Fecha_Juzgado]	 = @Fecha_Juzgado_14,
	 [Cuil_Nro]	 = @Cuil_Nro_15,
	 [Tipo_Documento]	 = @Tipo_Documento_16,
	 [Nro_Documento]	 = @Nro_Documento_17,
	 [Distrito_Militar]	 = @Distrito_Militar_18,
	 [Clase]	 = @Clase_19,
	 [Cedula_Identidad]	 = @Cedula_Identidad_20,
	 [Expedida_por]	 = @Expedida_por_21,
	 [Regimen_Jubilatorio]	 = @Regimen_Jubilatorio_22,
	 [Denominacion]	 = @Denominacion_23,
	 [Estado_Civil]	 = @Estado_Civil_24,
	 [Fecha_Matrimonio]	 = @Fecha_Matrimonio_25,
	 [Fecha_Matrimonio_2da]	 = @Fecha_Matrimonio_2da_26,
	 [Grupo_Sanguineo]	 = @Grupo_Sanguineo_27,
	 [Factor_Sanguineo]	 = @Factor_Sanguineo_28,
	 [Credencial]	 = @Credencial_29,
	 [Obra_Social]	 = @Obra_Social_30,
	 [Nro_Afiliado]	 = @Nro_Afiliado_31

WHERE 
	( [Id_Interna]	 = @Id_Interna_1)

' 
END
GO
/****** Object:  StoredProcedure [dbo].[DOT_GetDatosPersonales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[DOT_GetDatosPersonales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 28/09/09
-- Description:	Trate todos los datos personales, para armar la dotacion.
-- =============================================
CREATE PROCEDURE [dbo].[DOT_GetDatosPersonales]
AS
BEGIN
	SET NOCOUNT ON;

	select 
		nombre,
		apellido,
		Nro_Documento documento, 
		visiblelegajos, 
		visiblecontratos,
		bajalegajos,
		bajacontratos
	from dbo.datos_personales
END

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Datos_Personales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Datos_Personales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_UPD_Datos_Personales]
	( @Apellido_3 	[nvarchar](40),
	 @Nombre_4 	[nvarchar](60),
	 @Sexo_6 	[smallint],
	 @Fecha_Nacimiento_7 	[datetime],
	 @Lugar_Nacimiento_8 	[nvarchar](50),
	 @Nacionalidad_9 	[smallint],
	 @Fecha_Ingreso_Pais_10 	[datetime],
	 @Carta_Ciudadania_11 	[nvarchar](50),
	 @Juzgado_12 	[nvarchar](100),
	 @Secretario_13 	[nvarchar](100),
	 @Fecha_Juzgado_14 	[datetime],
	 @Cuil_Nro_15 	[varchar](15),
	 @Tipo_Documento_16 	[int],
	 @Nro_Documento_17 	[int],
	 @Distrito_Militar_18 	[smallint],
	 @Clase_19 	[int],
	 @Cedula_Identidad_20 	[char](11),
	 @Expedida_por_21 	[nvarchar](50),
	 @Regimen_Jubilatorio_22 	[nvarchar](50),
	 @Estado_Civil_24 	[smallint],
	 @Denominacion_23 	[smallint],
	 @Fecha_Matrimonio_25 	[datetime],
	 @Fecha_Matrimonio_2da_26 	[datetime],
	 @Grupo_Sanguineo_27 	[nvarchar](2),
	 @Factor_Sanguineo_28 	[nvarchar](20),
	 @Credencial_29 	[int],
	 @Obra_Social_30 	[smallint],
	 @Nro_Afiliado_31 	[varchar](50),
 	 @Id_Interna_1 	[int])

AS UPDATE [dbo].[Datos_Personales] 

SET  	 [Apellido]	 = @Apellido_3,
	 [Nombre]	 = @Nombre_4,
	 [Sexo]	 = @Sexo_6,
	 [Fecha_Nacimiento]	 = @Fecha_Nacimiento_7,
	 [Lugar_Nacimiento]	 = @Lugar_Nacimiento_8,
	 [Nacionalidad]	 = @Nacionalidad_9,
	 [Fecha_Ingreso_Pais]	 = @Fecha_Ingreso_Pais_10,
	 [Carta_Ciudadania]	 = @Carta_Ciudadania_11,
	 [Juzgado]	 = @Juzgado_12,
	 [Secretario]	 = @Secretario_13,
	 [Fecha_Juzgado]	 = @Fecha_Juzgado_14,
	 [Cuil_Nro]	 = @Cuil_Nro_15,
	 [Tipo_Documento]	 = @Tipo_Documento_16,
	 [Nro_Documento]	 = @Nro_Documento_17,
	 [Distrito_Militar]	 = @Distrito_Militar_18,
	 [Clase]	 = @Clase_19,
	 [Cedula_Identidad]	 = @Cedula_Identidad_20,
	 [Expedida_por]	 = @Expedida_por_21,
	 [Regimen_Jubilatorio]	 = @Regimen_Jubilatorio_22,
	 [Denominacion]	 = @Denominacion_23,
	 [Estado_Civil]	 = @Estado_Civil_24,
	 [Fecha_Matrimonio]	 = @Fecha_Matrimonio_25,
	 [Fecha_Matrimonio_2da]	 = @Fecha_Matrimonio_2da_26,
	 [Grupo_Sanguineo]	 = @Grupo_Sanguineo_27,
	 [Factor_Sanguineo]	 = @Factor_Sanguineo_28,
	 [Credencial]	 = @Credencial_29,
	 [Obra_Social]	 = @Obra_Social_30,
	 [Nro_Afiliado]	 = @Nro_Afiliado_31
WHERE 	( [Id_Interna]	 = @Id_Interna_1)


' 
END
GO
/****** Object:  StoredProcedure [dbo].[Web_AltaSolicitudLicencia]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Web_AltaSolicitudLicencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 02/02/2009
-- Description: Alta de solicitudes de licencia via web
-- =============================================
CREATE PROCEDURE [dbo].[Web_AltaSolicitudLicencia]
	@documento int,
	@idConcepto int,
	@desde smalldatetime,
	@hasta smalldatetime,
	@idUsuario int,
	@idArea int
AS
BEGIN
	SET NOCOUNT ON;

	declare @id int
	set @id = (select isnull(max(id),0) + 1 from dbo.asis_solicitudes_licencia_web)
	
	declare @idInterna int
	set @idInterna = (select id_interna from dbo.datos_personales where nro_documento = @documento)

	INSERT INTO
		dbo.asis_solicitudes_licencia_web
		(
			id, 
			id_interna, 
			concepto, 
			desde, 
			hasta,
			usuario,
			fecha_solicitud,
			id_area,
			baja
		)
	values
		(
			@id,
			@idInterna,
			@idConcepto,
			@desde,
			@hasta,
			@idUsuario,
			getdate(),
			@idArea,
			0
		)
	
END' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Datos_Personales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Datos_Personales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'





CREATE procedure [dbo].[LEG_ADD_Datos_Personales]
	(@Id_Interna_1 	[int],
	 @Apellido_2 	[varchar](40),
	 @Nombre_3 	[varchar](60),
	 @Sexo_5 	[smallint],
	 @Fecha_Nacimiento_6 	[datetime],
	 @Lugar_Nacimiento_7 	[varchar](50),
	 @Nacionalidad_8 	[smallint],
	 @Fecha_Ingreso_Pais_9 	[datetime],
	 @Carta_Ciudadania_10 	[varchar](50),
	 @Juzgado_11 	[varchar](100),
	 @Secretario_12 	[varchar](100),
	 @Fecha_Juzgado_13 	[datetime],
	 @Cuil_Nro_14 	[varchar](15),
	 @Tipo_Documento_15 	[int],
	 @Nro_Documento_16 	[int],
	 @Distrito_Militar_17 	[varchar](25),
	 @Clase_18 	[int],
	 @Cedula_Identidad_19 	[int],
	 @Expedida_por_20 	[varchar](50),
	 @Regimen_Jubilatorio_21 	[varchar](50),
	 @Estado_Civil_22 	[int],
	 @Fecha_Matrimonio_23 	[datetime],
	 @Fecha_Matrimonio_2da_24 	[datetime],
	 @Grupo_Sanguineo_25 	[varchar](2),
	 @Factor_Sanguineo_26 	[varchar](4),
	 @Credencial_27 	[int],
	 @Obra_Social_28 	[int],
	 @Nro_Afiliado_29 	[varchar](50),
	@Usuario smallint =1)

AS INSERT INTO [dbo].[Datos_Personales] 
	 ( [Id_Interna],
	 [Apellido],
	 [Nombre],
	 [Tipo_Planta],
	 [Sexo],
	 [Fecha_Nacimiento],
	 [Lugar_Nacimiento],
	 [Nacionalidad],
	 [Fecha_Ingreso_Pais],
	 [Carta_Ciudadania],
	 [Juzgado],
	 [Secretario],
	 [Fecha_Juzgado],
	 [Cuil_Nro],
	 [Tipo_Documento],
	 [Nro_Documento],
	 [Distrito_Militar],
	 [Clase],
	 [Cedula_Identidad],
	 [Expedida_por],
	 [Regimen_Jubilatorio],
	 [Estado_Civil],
	 [Fecha_Matrimonio],
	 [Fecha_Matrimonio_2da],
	 [Grupo_Sanguineo],
	 [Factor_Sanguineo],
	 [Credencial],
	 [Obra_Social],
	 [Nro_Afiliado],
	 VisibleLegajos,
	Usuario) 
 VALUES 
	( @Id_Interna_1,
	 @Apellido_2,
	 @Nombre_3,
	 0, --@Tipo_Planta_4,
	 @Sexo_5,
	 @Fecha_Nacimiento_6,
	 @Lugar_Nacimiento_7,
	 @Nacionalidad_8,
	 @Fecha_Ingreso_Pais_9,
	 @Carta_Ciudadania_10,
	 @Juzgado_11,
	 @Secretario_12,
	 @Fecha_Juzgado_13,
	 @Cuil_Nro_14,
	 @Tipo_Documento_15,
	 @Nro_Documento_16,
	 @Distrito_Militar_17,
	 @Clase_18,
	 @Cedula_Identidad_19,
	 @Expedida_por_20,
	 @Regimen_Jubilatorio_21,
	 @Estado_Civil_22,
	 @Fecha_Matrimonio_23,
	 @Fecha_Matrimonio_2da_24,
	 @Grupo_Sanguineo_25,
	 @Factor_Sanguineo_26,
	 @Credencial_27,
	 @Obra_Social_28,
	 @Nro_Afiliado_29,	
	 1,
	@Usuario)

-- CARGA INCORPORACON PARA ASISTENCUA
exec dbo.RH_ADD_Traspaso_Documentacion 2, @Usuario,''Incorporación de Agente'', ''Datos Personales'', @Nro_Documento_16, 3, ''CAIPP''






' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_ObraSocial]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_ObraSocial]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'





create procedure [dbo].[LEG_GET_ObraSocial]
	@Id int = null,
	@documento int = null
AS
SELECT 	OS.documento,
	OS.idObrasocial,
	TOS.sigla SiglaObraSocial,
	TOS.nombre NombreObraSocial,
	ISNULL(TOS.RNOS,'''') RNOSObraSocial,
	OS.nroAfiliado,
	OS.fhDesde,
	OS.folio,	
	OS.habilitada_reciboHaberes,
	DP.Apellido +'', '' + DP.Nombre Apellido
FROM dbo.LEG_ObraSocial OS
INNER JOIN dbo.GEN_ObraSocial TOS
	ON TOS.id = OS.idObraSocial
INNER JOIN dbo.Datos_Personales DP
	ON DP.Nro_Documento = OS.Documento
WHERE 	(os.id = @id OR @id IS NULL) AND
	(dp.Nro_Documento = @Documento OR @Documento IS NULL)

' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_DDJJ_Ingresantes]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_DDJJ_Ingresantes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE procedure [dbo].[RPT_LEG_DDJJ_Ingresantes]
  	 @Id_Interna [int]
AS 
select dp.Apellido +'', ''+ dp.Nombre Apellido,                                                       

isnull(TDOC.descripcion,'''') Tipo_Documento, 
isnull(dp.Nro_Documento,'''')Nro_Documento,
isnull(DM.descripcion,'''') Distrito_Militar ,
isnull(dp.Clase, '''') Clase ,
isnull(dp.Cedula_Identidad ,'''')Cedula_Identidad,
isnull(dp.Expedida_por,'''')Expedida_por                                  


from  [dbo].Datos_Personales  DP
left join [dbo].Tabla_DocIdentidad TDOC
	on TDOC.id = dp.tipo_documento
left join [dbo].Tabla_DistritosMilitares DM
	on DM.id = DP.Distrito_Militar 

where id_interna = @id_Interna

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Datos_Personales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Datos_Personales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CTR_GET_Datos_Personales]    
 @doc int,    
 @baja int = Null   
as    
    
select *     
from datos_personales    
where  (bajacontratos = @baja OR @baja is null)
	and nro_documento = @doc  
' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_DatosPersonales]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_DatosPersonales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE procedure [dbo].[RPT_LEG_DatosPersonales]
  	 @Id_Interna [int]
AS 
select 
dp.Apellido,                                
dp.Nombre,                                                       
case when dp.Sexo = 1 then
	''Masculino''
else
	''Femenino''
end Sexo,
dp.Fecha_Nacimiento,            
isnull(Lugar_Nacimiento,'''') Lugar_Nacimiento,                                   
isnull(nac.descripcion,'''')  Nacionalidad, 
isnull(dp.Fecha_Ingreso_Pais,'''')Fecha_Ingreso_Pais ,          
isnull(dp.Carta_Ciudadania,'''') Carta_Ciudadania,                                   
isnull(dp.Juzgado,'''')Juzgado,
isnull(dp.Secretario,'''') Secretario,                                                                                           
isnull(dp.Fecha_Juzgado, '''')Fecha_Juzgado,             
isnull(dp.Cuil_Nro,'''')Cuil_Nro,        
isnull(TDOC.descripcion,'''') Tipo_Documento, 
isnull(dp.Nro_Documento,'''')Nro_Documento,
isnull(DM.descripcion,'''') Distrito_Militar ,
isnull(dp.Clase, '''') Clase ,
isnull(dp.Cedula_Identidad ,'''')Cedula_Identidad,
isnull(dp.Expedida_por,'''')Expedida_por,                                  
case dp.Regimen_Jubilatorio 
	when   1 then 	''Reparto''
	 when  2 then	''Capitalización''
	else ''No Especifica''
end Regimen_jubilatorio,
isnull(RJ.Descripcion,'''')  Denominacion ,
isnull(EC.Descripcion ,'''') Estado_Civil, 
isnull(dp.Fecha_Matrimonio,'''')Fecha_Matrimonio,
isnull(dp.Fecha_Matrimonio_2da,'''')Fecha_Matrimonio_2da     ,   

case dp.Grupo_Sanguineo 
when ''0'' then ''0''
when ''1'' then ''A''
when ''2'' then ''B''
when ''3'' then ''AB''
when ''4'' then '' ''
end Grupo_Sanguineo,

case dp.Factor_Sanguineo 
when ''0'' then ''RH +''
when ''1'' then ''RH -''
when ''2'' then '' ''
end Factor_Sanguineo,    
isnull(dp.Credencial,'''')Credencial  ,
isnull(os.sigla,'''')  Obra_Social, 
isnull(dp.Nro_Afiliado ,'''')Nro_Afiliado                                      

from  [dbo].Datos_Personales  DP
left join [dbo].tabla_nacionalidad NAC
	on NAC.id = DP.nacionalidad
left join [dbo].Tabla_DocIdentidad TDOC
	on TDOC.id = dp.tipo_documento
left join [dbo].Tabla_DistritosMilitares DM
	on DM.id = DP.Distrito_Militar 
left join [dbo].Tabla_estado_civil EC
	on EC.id = DP.Estado_Civil
left join [dbo].tabla_obrasocial OS
	on OS.id = DP.Obra_Social

left join [dbo].Tabla_Regimen_Jubilatorio RJ
	on RJ.id = DP.Denominacion

where id_interna = @id_Interna
' 
END
GO
/****** Object:  StoredProcedure [dbo].[ESTR_GET_Area_Libre]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ESTR_GET_Area_Libre]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ESTR_GET_Area_Libre]  
 @area int  
AS  
SELECT  top 1 count(DA.id_interna) Cantidad  
FROM dbo.VW_Desglose_Area  DA
INNER JOIN dbo.Datos_Personales DP
	on DP.Id_interna = DA.Id_Interna
WHERE 	Da.Id_area = @Area  AND
	((DP.VisibleLegajos = 1 and BajaLegajos = 0) OR (Dp.VisibleContratos = 1 and BajaContratos = 0))
GROUP BY DA.id_interna   



' 
END
GO
/****** Object:  View [dbo].[VW_Contratos_Activos]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Contratos_Activos]'))
EXEC dbo.sp_executesql @statement = N'




--MLD: 11-06-06:Listado de agentes q tienen algun contrato
--activo (en tramite o no)

CREATE     view [dbo].[VW_Contratos_Activos]

AS

--CONTRATOS
SELECT nro_documento
FROM dbo.Ctr_Contratos
WHERE 	Baja = 0 AND
	Hasta >= getdate() 

--LEGAJOS PLANTA PERMANENTE

UNION

SELECT Nro_Documento
FROM dbo.Datos_Personales DP
WHERE DP.VisibleLegajos = 1 AND
	DP.VisibleContratos = 0

GROUP BY nro_documento




'
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_CUIL]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_CUIL]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_GET_CUIL]
@doc int
as

select cuil_nro from datos_personales
where nro_documento=@doc

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Psicofisicos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Psicofisicos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[LEG_GET_Psicofisicos]
	@Legajo int,
	@id int
AS
SELECT 	DAT_P.Id_Interna as IdPersona, 
	DAT_P.Apellido, DAT_P.Nombre, 
	Psi.*, DAT_P.Nro_Documento, 
	DAT_P.id_Interna 
FROM 	[dbo].Datos_Personales as DAT_P 
LEFT JOIN [dbo].Psicofisico as Psi
	ON DAT_P.id_Interna = Psi.id_Interna  and 
	   psi.datodebaja=0
WHERE (DAT_P.Nro_Documento = @Legajo or DAT_P.id_interna = @id)
		
ORDER BY folio_nro


SET QUOTED_IDENTIFIER OFF


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_UPD_CUIL_FAC_DP]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_UPD_CUIL_FAC_DP]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CTR_UPD_CUIL_FAC_DP]

@Cuil char(11),
@Doc int

AS

update datos_personales 
	set cuil_nro=  @Cuil
where nro_documento=@Doc
' 
END
GO
/****** Object:  View [dbo].[VW_Obras_Sociales_con_Agentes]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Obras_Sociales_con_Agentes]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_Obras_Sociales_con_Agentes]

as

select distinct(os.sigla),os.id from dbo.Tabla_ObraSocial OS
inner join datos_personales DP
	on DP.Obra_Social = os.id
where os.baja =0


'
GO
/****** Object:  StoredProcedure [dbo].[VIAT_GET_documentoAgente]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[VIAT_GET_documentoAgente]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[VIAT_GET_documentoAgente]
@apellido varchar (40)
AS
BEGIN
SET NOCOUNT ON
SET @apellido = @apellido + ''%''
SELECT 	dp.apellido as Apellido, 
		dp.nombre as Nombre, 
		dp.Nro_documento as Nro_documento
FROM dbo.datos_personales dp
WHERE dp.apellido LIKE @apellido
ORDER BY dp.apellido ASC, dp.nombre ASC
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CALC_getAgentes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CALC_getAgentes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 18/11/2009
-- Description:	Trae todas las personas
-- =============================================
CREATE PROCEDURE [dbo].[CALC_getAgentes]
AS
BEGIN
	SELECT 
		dp.nro_documento, 
		dp.id_interna, 
		dp.apellido, 
		dp.nombre, 
		dp.bajaLegajos,
		dp.visibleLegajos,
		fecha_min
	FROM dbo.Datos_Personales dp
	INNER JOIN dbo.designaciones_fechas df
		on df.id_interna = dp.id_interna
END

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_ADD_Datos_Personales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ADD_Datos_Personales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

--MLD: 06-10-06: Se agrega seteo VisibleContratos
CREATE PROCEDURE [dbo].[CTR_ADD_Datos_Personales]
	(@Tipo_Documento 	[int],
	@Nro_Documento 	[int],
	@Id_Interna [int],
	@Apellido 	[nvarchar](40),
	@Nombre 	[nvarchar](60),
	@Cuil_Nro 	[varchar](15),	 
	@Estado_Civil 	[int],
	@Fecha_Nacimiento 	[datetime],
	@Sexo 	[smallint], 
	@Nacionalidad 	[smallint],
	@Regimen_Jubilatorio 	[smallint],
	@Denominacion	 [smallint],
	@Usuario smallint)	
AS 
INSERT INTO [dbo].[Datos_Personales] 
	 ( [Id_Interna],
	 [Apellido],
	 [Nombre],
	 [Sexo],
	 [Fecha_Nacimiento],
	 [Nacionalidad],
	 [Cuil_Nro],
	 [Tipo_Documento],
	 [Nro_Documento],
	 [Regimen_Jubilatorio],
	 [Denominacion],
	 [Estado_Civil],
	 VisibleContratos,
	 Usuario) 
VALUES 
	(@Id_Interna,
	 @Apellido,
	 @Nombre,
	 @Sexo,
	 @Fecha_Nacimiento,
	 @Nacionalidad,
	 @Cuil_Nro,
	 @Tipo_Documento,
	 @Nro_Documento,
	 @Regimen_Jubilatorio,
	 @Denominacion,
	 @Estado_Civil,
	 1,
	 @Usuario)


' 
END
GO
/****** Object:  View [dbo].[VW_Datos_personales]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Datos_personales]'))
EXEC dbo.sp_executesql @statement = N'



CREATE    VIEW [dbo].[VW_Datos_personales]
AS
SELECT  *
FROM dbo.Datos_personales






'
GO
/****** Object:  StoredProcedure [dbo].[Get_Fecha_Designacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Get_Fecha_Designacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE Procedure [dbo].[Get_Fecha_Designacion] (@DNI int)
as

select Fecha_Min
from dbo.Designaciones_Fechas desig, dbo.Datos_Personales datpers	
where desig.Id_Interna = datpers.Id_Interna and
	 @DNI=datpers.Nro_Documento
order by Fecha_Min desc 
' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_CALC_Get_Personas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_CALC_Get_Personas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 07/12/2009
-- Description:	Trae todas las personas y sus fechas de ingreso al ministerio
-- =============================================
CREATE PROCEDURE [dbo].[ASIS_CALC_Get_Personas] 
AS
BEGIN
	select dp.id_interna, nro_documento documento, max(fecha_min) ingreso
	from dbo.datos_personales  dp
	inner join dbo.designaciones_fechas df
		on dp.id_interna = df.id_interna
	where (visiblelegajos = 1 and bajalegajos = 0)
	or (visiblecontratos = 1 and bajacontratos = 0)
	group by nro_documento, dp.id_interna
END



' 
END
GO
/****** Object:  StoredProcedure [dbo].[Web_EliminarInasistenciaActual]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Web_EliminarInasistenciaActual]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 04/03/09
-- Description:	Eliminar las solicitudes de inasitencia de la web
-- =============================================
CREATE PROCEDURE [dbo].[Web_EliminarInasistenciaActual]
	@nroDocumento int
AS
BEGIN
	SET NOCOUNT ON;
	
	declare @idInterna int
	set @idInterna = (Select id_interna from dbo.datos_personales where nro_documento = @nroDocumento)

	delete from dbo.asis_solicitudes_licencia_web 
	where 
		id_interna = @idInterna and
		cast(cast(year(getdate())as varchar) + ''-'' + cast(day(getdate())as varchar) + ''-'' + cast(month(getdate())as varchar) as datetime)  between desde and hasta

END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[DOT_GetDesignacionesArea]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[DOT_GetDesignacionesArea]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 28/09/09
-- Description:	Trate todas desiganciones a areas de los agentes, para armar la dotacion.
-- =============================================
CREATE PROCEDURE [dbo].[DOT_GetDesignacionesArea]
AS
BEGIN
	SET NOCOUNT ON;
	
	select 
		documento,
		id_area,
		desde
	from 
		dbo.leg_desglose_area

END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Desglose_Area]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Desglose_Area]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CTR_GET_Desglose_Area]
@Doc as int
as
SELECT *
FROM dbo.leg_desglose_area
WHERE cast(desde as varchar) + cast(documento as varchar) +  cast(id as varchar) in
	(SELECT  cast(max(desde) as varchar)+ cast(documento as varchar) + cast(max(id) as varchar)
	FROM dbo.leg_desglose_area
	where desde <=getdate() and documento=@doc 
	GROUP BY documento)
ORDER BY documento


' 
END
GO
/****** Object:  View [dbo].[VW_Desglose_Area]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Desglose_Area]'))
EXEC dbo.sp_executesql @statement = N'create VIEW [dbo].[VW_Desglose_Area]  
AS  
  
  
SELECT top 100 percent *  
FROM dbo.leg_desglose_area A  
WHERE ( convert(char(8),cast(desde as int),112) + cast(documento as varchar)+cast(id as varchar)  ) in  
 (SELECT  max( convert(char(8),cast(desde as int),112) + cast(documento as varchar)+cast(id as varchar)  )   
 FROM dbo.leg_desglose_area  
 where Cast(desde as datetime) <= getdate()   
 GROUP BY documento  
)  
  
ORDER BY id_interna  
  
  
  
  
  
/*  
SELECT top 100 percent *  
FROM dbo.leg_desglose_area  
WHERE cast(desde as varchar) + cast(id_interna as varchar) +  cast(id as varchar) in  
 (SELECT  cast(max(desde) as varchar)+ cast(id_interna as varchar) + cast(max(id) as varchar)  
 FROM dbo.leg_desglose_area  
 where desde <=getdate()   
 GROUP BY id_interna)  
ORDER BY id_interna  
  
  
*/  
  
/*  
SELECT top 100 percent *  
FROM dbo.leg_desglose_area  
WHERE cast(desde as varchar) + cast(id_interna as varchar) in  
 (SELECT cast(max(desde) as varchar)+ cast(id_interna as varchar)  
 FROM dbo.leg_desglose_area  
 where desde <=getdate() and id=(select max(id) from dbo.leg_desglose_area)  
 GROUP BY id_interna)  
ORDER BY id_interna  
*/  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  

'
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Desglose_Area]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Desglose_Area]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'





CREATE procedure [dbo].[LEG_ADD_Desglose_Area]
	@Id_interna [int] ,
	@Documento [int] ,
	@Id_area [int] ,
	@Desde [datetime] ,
	@Jurisdiccion [varchar] (25)=null ,
	@Organismo [varchar] (25) =null,
	@Folio [char] (10) =null,
	@Acto_Tipo [smallint]=null,
	@Acto_Nro [varchar] (10) =null,
	@Acto_Fecha [datetime]=null,
	@Usuario smallint 

AS
DECLARE @Id int

SET @id = (select max(id)+1 from dbo.LEG_Desglose_Area)
IF @ID is null BEGIN
	SET @Id = 1
END
INSERT INTO dbo.LEG_Desglose_Area
VALUES	(@id,
	@id_interna,
	@Documento,
	@Id_area,
	@Desde,
	@Jurisdiccion,
	@Organismo,
	@Folio,
	@Acto_Tipo,
	@ACto_Nro,
	@Acto_Fecha,
	@Usuario)

	









' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_DEL_TMP_Serv_Jubilatorios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_DEL_TMP_Serv_Jubilatorios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'






CREATE procedure [dbo].[LEG_DEL_TMP_Serv_Jubilatorios]
	@Id_interna int
as

delete from dbo.TMP_LEG_Servicios_Jubilatorios
where id_interna = @Id_interna

/*

if exists (select * from dbo.sysobjects where id = object_id(N''[dbo].[#servicios]'') and OBJECTPROPERTY(id, N''IsUserTable'') = 1)
drop table [dbo].[#servicios]



--drop table #servicios


select distinct 
	sap.id_interna,	
	''Estado''  Corresponde,
	caja,
	afiliado,
	fecha_desde ,
	fecha_hasta ,
	no_computa ,
	dbo.Fx_Restar_Antiguedad (dbo.fx_Calcula_Antiguedad (fecha_desde,fecha_hasta),no_computa) Antiguedad,
	a.Ant_total,
	convert(char(10),fecha_desde,103) DesdeOriginal,
	convert(char(10),fecha_hasta,103) HastaOriginal
	
into #Servicios
from servicios_adm_publica SAP
INNER JOIN dbo.antiguedad A
	on a.id_interna = sap.id_interna
INNER JOIN dbo.designaciones_fechas DF
	on DF.id_interna= sap.id_interna
WHERE 	SAP.id_interna=  @Id_interna  AND
	DatoDeBaja = 0 AND
	datonoimprime = 0
union
select distinct 
	ots.id_interna,
	''Privado'' Corresponde,
	caja,
	afiliado,
	fecha_desde desde,
	fecha_hasta hasta,
	no_computa ,
	dbo.Fx_Restar_Antiguedad (dbo.fx_Calcula_Antiguedad (fecha_desde,fecha_hasta),no_computa) Antiguedad,
	a.Ant_total,
	convert (char(10),fecha_desde,103) DesdeOriginal, 
	convert (Char(10),fecha_hasta,103) HastaOriginal
	
from otros_servicios OTS
INNER JOIN dbo.antiguedad A
	on a.id_interna = OTS.id_interna
INNER JOIN dbo.designaciones_fechas DF
	on DF.id_interna= ots.id_interna
WHERE OTS.id_interna =  @Id_interna  AND 
	DatoDeBaja = 0 AND
	datonoimprime = 0
order by fecha_desde ,fecha_hasta 


declare @fecha_min datetime
declare @Desde datetime
Declare @hasta datetime
declare @i int

set @fecha_min = (select fecha_min from designaciones_fechas where id_interna = @id_interna)
set @desde = (select min(fecha_desde) from #servicios where fecha_hasta <>''01/01/1900'')
set @hasta = (select min(fecha_hasta) from #servicios where fecha_desde = @desde)
set @i = 1

-- DETERMINACION DE SUPERPOSICION DE FECHAS --
-- * --
WHILE  (select count(Corresponde) from #servicios) > @i BEGIN --AND (not @desde is null) BEGIN
	update #servicios
		set	fecha_desde = null,
			fecha_hasta = null
	where  ((fecha_desde < @Hasta and fecha_desde > @desde) and (fecha_hasta < @hasta))

	update #servicios
		set fecha_desde = @hasta,
  		    fecha_hasta = fecha_hasta -1 
	where (fecha_desde <= @Hasta  and fecha_hasta > @hasta )

	set @i = @i + 1
	set @desde = (select min(fecha_desde) from #servicios where fecha_desde > @desde and fecha_hasta <>''01/01/1900'')
	set @hasta = (select max(fecha_hasta) from #servicios where fecha_desde = @desde)
END
-- * --
	-- ELIMINA REGISTROS POSTERIORES A LA FECHA DE INGRESO AL MINISTERIO --
	-- ** --
	update #servicios
		set fecha_hasta = @fecha_min-1
	where fecha_hasta > @fecha_min

	update #servicios	
		set fecha_hasta = null,
		fecha_desde = null
	where fecha_desde >= @fecha_MIn

	-- ** --

select 	id_interna,
	Corresponde,	
	caja,	
	afiliado,
--	fecha_desde,	
--	fecha_hasta,	
	no_computa,	
	Antiguedad,	
	Ant_total,	
	DesdeOriginal,	
	HastaOriginal,	
	dbo.fx_Calcula_Antiguedad (fecha_desde,fecha_hasta) AntiguedadAReconocer 
FROM #servicios
	
*/






' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Serv_Jubilatorios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Serv_Jubilatorios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_GET_Serv_Jubilatorios]  
 @Id_interna int  
as  
  
Select * from dbo.TMP_LEG_Servicios_Jubilatorios  
where id_interna = @Id_interna  
order by corresponde, desdeoriginal, hastaoriginal
  
/*  
  
if exists (select * from dbo.sysobjects where id = object_id(N''[dbo].[#servicios]'') and OBJECTPROPERTY(id, N''IsUserTable'') = 1)  
drop table [dbo].[#servicios]  
  
  
  
--drop table #servicios  
  
  
select distinct   
 sap.id_interna,   
 ''Estado''  Corresponde,  
 caja,  
 afiliado,  
 fecha_desde ,  
 fecha_hasta ,  
 no_computa ,  
 dbo.Fx_Restar_Antiguedad (dbo.fx_Calcula_Antiguedad (fecha_desde,fecha_hasta),no_computa) Antiguedad,  
 a.Ant_total,  
 convert(char(10),fecha_desde,103) DesdeOriginal,  
 convert(char(10),fecha_hasta,103) HastaOriginal  
   
into #Servicios  
from servicios_adm_publica SAP  
INNER JOIN dbo.antiguedad A  
 on a.id_interna = sap.id_interna  
INNER JOIN dbo.designaciones_fechas DF  
 on DF.id_interna= sap.id_interna  
WHERE  SAP.id_interna=  @Id_interna  AND  
 DatoDeBaja = 0 AND  
 datonoimprime = 0  
union  
select distinct   
 ots.id_interna,  
 ''Privado'' Corresponde,  
 caja,  
 afiliado,  
 fecha_desde desde,  
 fecha_hasta hasta,  
 no_computa ,  
 dbo.Fx_Restar_Antiguedad (dbo.fx_Calcula_Antiguedad (fecha_desde,fecha_hasta),no_computa) Antiguedad,  
 a.Ant_total,  
 convert (char(10),fecha_desde,103) DesdeOriginal,   
 convert (Char(10),fecha_hasta,103) HastaOriginal  
   
from otros_servicios OTS  
INNER JOIN dbo.antiguedad A  
 on a.id_interna = OTS.id_interna  
INNER JOIN dbo.designaciones_fechas DF  
 on DF.id_interna= ots.id_interna  
WHERE OTS.id_interna =  @Id_interna  AND   
 DatoDeBaja = 0 AND  
 datonoimprime = 0  
order by fecha_desde ,fecha_hasta   
  
  
declare @fecha_min datetime  
declare @Desde datetime  
Declare @hasta datetime  
declare @i int  
  
set @fecha_min = (select fecha_min from designaciones_fechas where id_interna = @id_interna)  
set @desde = (select min(fecha_desde) from #servicios where fecha_hasta <>''01/01/1900'')  
set @hasta = (select min(fecha_hasta) from #servicios where fecha_desde = @desde)  
set @i = 1  
  
-- DETERMINACION DE SUPERPOSICION DE FECHAS --  
-- * --  
WHILE  (select count(Corresponde) from #servicios) > @i BEGIN --AND (not @desde is null) BEGIN  
 update #servicios  
  set fecha_desde = null,  
   fecha_hasta = null  
 where  ((fecha_desde < @Hasta and fecha_desde > @desde) and (fecha_hasta < @hasta))  
  
 update #servicios  
  set fecha_desde = @hasta,  
        fecha_hasta = fecha_hasta -1   
 where (fecha_desde <= @Hasta  and fecha_hasta > @hasta )  
  
 set @i = @i + 1  
 set @desde = (select min(fecha_desde) from #servicios where fecha_desde > @desde and fecha_hasta <>''01/01/1900'')  
 set @hasta = (select max(fecha_hasta) from #servicios where fecha_desde = @desde)  
END  
-- * --  
 -- ELIMINA REGISTROS POSTERIORES A LA FECHA DE INGRESO AL MINISTERIO --  
 -- ** --  
 update #servicios  
  set fecha_hasta = @fecha_min-1  
 where fecha_hasta > @fecha_min  
  
 update #servicios   
  set fecha_hasta = null,  
  fecha_desde = null  
 where fecha_desde >= @fecha_MIn  
  
 -- ** --  
  
select  id_interna,  
 Corresponde,   
 caja,   
 afiliado,  
-- fecha_desde,   
-- fecha_hasta,   
 no_computa,   
 Antiguedad,   
 Ant_total,   
 DesdeOriginal,   
 HastaOriginal,   
 dbo.fx_Calcula_Antiguedad (fecha_desde,fecha_hasta) AntiguedadAReconocer   
FROM #servicios  
   
*/  
  
  
  
  
  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[update_Estudios_Otros]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[update_Estudios_Otros]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[update_Estudios_Otros]
	(@id_establecimiento_19 	[int],
	 @Establecimeinto_20 	[varchar](50),
	 @Depende_de_21 	[varchar](50),
	 @Titulo_22 	[varchar](50),
	 @Expedido_por_23 	[varchar](50),
	 @Fecha_ingreso_24 	[datetime],
	 @Fecha_egreso_25 	[datetime],
	 @Fecha_26 	[datetime],
	 @Folio_Nro_27 	[char](10),
	 @Id_Interna_28 	[int],
	 @Nro_Doc_29 	[int],
	 @Cant_Horas_Totales_30 	[smallint],
	 @Cant_Horas_Cursadas_31 	[smallint],
	 @Cant_Materias_Totales_32 	[smallint],
	 @Cant_Materias_Aprob_33 	[smallint],
	 @Evaluacion_Final_34 	[smallint],
	 @Tesis_Nota_35 	[smallint],
	 @Tesis_Tema_36 	[char](30),
	@id_estudio [int],
	@datodebaja bit,
	@datonoimprime bit)

AS UPDATE [dbo].[Estudios_Otros] 

SET  [id_establecimiento]	 = @id_establecimiento_19,
	 [Establecimeinto]	 = @Establecimeinto_20,
	 [Depende_de]	 = @Depende_de_21,
	 [Titulo]	 = @Titulo_22,
	 [Expedido_por]	 = @Expedido_por_23,
	 [Fecha_ingreso]	 = @Fecha_ingreso_24,
	 [Fecha_egreso]	 = @Fecha_egreso_25,
	 [Fecha]	 = @Fecha_26,
	 [Folio_Nro]	 = @Folio_Nro_27,
	 [Cant_Horas_Totales]	 = @Cant_Horas_Totales_30,
	 [Cant_Horas_Cursadas]	 = @Cant_Horas_Cursadas_31,
	 [Cant_Materias_Totales]	 = @Cant_Materias_Totales_32,
	 [Cant_Materias_Aprob]	 = @Cant_Materias_Aprob_33,
	 [Evaluacion_Final]	 = @Evaluacion_Final_34,
	 [Tesis_Nota]	 = @Tesis_Nota_35,
	 [Tesis_Tema]	 = @Tesis_Tema_36 ,
	datodebaja=@datodebaja ,
	datonoimprime=@datonoimprime


WHERE 
	([Id_Interna]	 = @Id_Interna_28 and id_estudio= @id_estudio )
' 
END
GO
/****** Object:  StoredProcedure [dbo].[Alta_Estudios_Otros]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Alta_Estudios_Otros]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[Alta_Estudios_Otros]
	(@Establecimeinto_1 	[varchar](50),
	 @Depende_de_2 	[varchar](50),
	 @Titulo_3 	[varchar](50),
	 @Expedido_por_4 	[varchar](50),
	 @Fecha_I 	[datetime],
	 @Fecha_E 	[datetime],
	 @Fecha_5 	[datetime],
	 @Folio_Nro_6 	[char](10),
	 @Id_Interna_7 	[int],
	 @Nro_Doc_8 	[int],
	 @Cant_Horas_Totales_9 	[smallint],
	 @Cant_Horas_Cursadas_10 	[smallint],
	 @Cant_Materias_Totales_11 	[smallint],
	 @Cant_Materias_Aprob_12 	[smallint],
	 @Evaluacion_Final_13 	[smallint],
	 @Tesis_Nota_14 	[smallint],
	 @Tesis_Tema_15 	[char](30),
	@id_establecimiento [int],
	@datodebaja bit,
	@datonoimprime bit)

AS 

Declare  @id_estudio int
set @id_estudio =(select max(id_estudio)+1 from [dbo].estudios_otros where id_interna = @id_interna_7 and Nro_Doc=@Nro_Doc_8)

if @id_estudio is null begin
	set @id_estudio =1
end

INSERT INTO dbo.Estudios_Otros
	 ( [Establecimeinto],
	 [Depende_de],
	 [Titulo],
	 [Expedido_por],
	 [Fecha_ingreso],
	 [Fecha_egreso],
	 [Fecha],
	 [Folio_Nro],
	 [Id_Interna],
	 [Nro_Doc],
	 [Cant_Horas_Totales],
	 [Cant_Horas_Cursadas],
	 [Cant_Materias_Totales],
	 [Cant_Materias_Aprob],
	 [Evaluacion_Final],
	 [Tesis_Nota],
	 [Tesis_Tema], 
	id_establecimiento,
	id_estudio,
	datodebaja,
	datonoimprime) 

VALUES 
	( @Establecimeinto_1,
	 @Depende_de_2,
	 @Titulo_3,
	 @Expedido_por_4,
	 @Fecha_I,
	 @Fecha_E,
	 @Fecha_5,
	 @Folio_Nro_6,
	 @Id_Interna_7,
	 @Nro_Doc_8,
	 @Cant_Horas_Totales_9,
	 @Cant_Horas_Cursadas_10,
	 @Cant_Materias_Totales_11,
	 @Cant_Materias_Aprob_12,
	 @Evaluacion_Final_13,
	 @Tesis_Nota_14,
	 @Tesis_Tema_15,
	@id_establecimiento,
	@id_estudio,
	@datodebaja,
	@datonoimprime)


select @id_estudio id_estudio


' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetEstudios_Otros]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetEstudios_Otros]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GetEstudios_Otros]
	 @Id_Interna_7 	[int],
	 @Nro_Doc_8 	[int]

AS 
select * from [dbo].Estudios_Otros
where   (Id_Interna  =@Id_Interna_7  or Nro_Doc	= @Nro_Doc_8) and datodebaja=0
' 
END
GO
/****** Object:  StoredProcedure [dbo].[Get_Usuario_Traspaso]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Get_Usuario_Traspaso]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[Get_Usuario_Traspaso]

@usuario smallint,
@modulo smallint

AS

select id_usuario, id_modulo from usuarios_traspaso 
where id_usuario=@usuario and id_modulo=@modulo

' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Sinapa]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Sinapa]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GABM_Tabla_Sinapa]  
 @Operacion char(1),  
 @Id_1  [int]=NULL,  
 @Nivel varchar(2)=NULL,  
 @Grado smallint=NULL,  
 @Remuneracion_Fija money=NULL,  
 @Remuneracion_Variable money=NULL,  
 @Desde smalldatetime=NULL  
AS  
   
IF @operacion =''A''  
BEGIN  
 DECLARE @MAx [int]  
 set @Max = (select max(id)+1 from dbo.Tabla_Sinapa)  
 if @Max is null begin  
  set @max=1  
 end  
 INSERT INTO dbo.Tabla_Sinapa   
  ([Id],  
  Nivel,  
  Grado,  
  Remuneracion_Fija,  
  Remuneracion_var,  
  Baja,  
  Desde)   
  VALUES  (@max,  
  @Nivel,  
  @Grado,  
  @Remuneracion_Fija,  
  @Remuneracion_Variable,  
  0,  
  @Desde)  
END  
  
IF @operacion =''M''  
BEGIN  
 UPDATE dbo.Tabla_Sinapa  
 SET Remuneracion_Fija =  @Remuneracion_Fija,  
  Remuneracion_Var = @Remuneracion_Variable,  
  Desde = @Desde  
 WHERE Id = @Id_1  
END  
  
  
IF @operacion =''B''  
BEGIN  
 UPDATE  dbo.Tabla_Sinapa  
 SET  Baja =  1  
 WHERE Id = @Id_1  
END  
  
IF @operacion =''R''  
BEGIN  
 UPDATE dbo.Tabla_Sinapa  
 SET Baja =  0  
 WHERE Id = @Id_1  
END  
  
  
IF @operacion =''S''  
BEGIN  
 SELECT TS.Id,  
  Nivel,  
  Grado,  
  Remuneracion_fija Rem_Fija,  
  Remuneracion_Var Rem_Variable,  
  case when TS.baja = 1 then  
   ''Si''  
  else  
   ''No''  
  end Baja,  
  convert(char(10),desde,103) Desde  
 FROM  dbo.Tabla_Sinapa TS  
 WHERE (TS.Id = @ID_1) OR (@ID_1 is null)  
 ORDER BY Nivel, Grado  
END  
  
  
  
  
  
  
  
  
  
  


' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_Monto_Sinapa]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_Monto_Sinapa]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_Monto_Sinapa] (@Nivel char(2), @Grado smallint, @Fecha smalldatetime)  
RETURNS Money AS  
BEGIN 

return  (SELECT TOP 1 Remuneracion_Fija 
	FROM dbo.Tabla_Sinapa
	WHERE	Nivel = @Nivel AND
		Grado = @Grado AND
		Desde <= @Fecha
	ORDER BY Desde DEsc)

END

' 
END
GO
/****** Object:  View [dbo].[VW_tabla_tipos_designaciones]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_tabla_tipos_designaciones]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_tabla_tipos_designaciones]
AS
SELECT  *
FROM dbo.tabla_tipos_designaciones


where baja =0
'
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Tipos_Designaciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Tipos_Designaciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[GABM_Tabla_Tipos_Designaciones]
	(@Operacion char(1),
	@Id_1 	[int]=null,
	@Descripcion_2 	[varchar](30)=null,
	@EsIngreso bit=null)

AS 
IF @operacion =''A''
BEGIN
	Declare @MAx [int]
	set @Max = (select max(id)+1 from dbo.tabla_Tipos_Designaciones)
	if @Max is null begin
		set @max=1
	end
	INSERT INTO [dbo].[Tabla_Tipos_Designaciones] 
		 ([Id],
		 [Descripcion],
		 EsIngreso,
		Baja) 
 	VALUES 
		( @max,
		 @Descripcion_2,
		@Esingreso,
		0)
END

IF @operacion =''M''
BEGIN
	update 	[dbo].[Tabla_Tipos_Designaciones] 
	set 	[Descripcion] =  @Descripcion_2,
		EsIngreso = @EsIngreso
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	[dbo].[Tabla_Tipos_Designaciones] 
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	[dbo].[Tabla_Tipos_Designaciones] 
	set 	baja =  0
	where 	id = @Id_1
END


IF @operacion =''S''
BEGIN
	SELECT	Id,
		descripcion Descripción,
		case when esingreso = 1 then
			''Si''
		else
			''No''
		end Ingreso,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja 
	FROM  [dbo].[Tabla_Tipos_Designaciones] 
	WHERE (id = @ID_1) OR (@ID_1 is null)
	ORDER BY descripcion
END





' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_ReportesPersonasSinFotos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_ReportesPersonasSinFotos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CRED_ReportesPersonasSinFotos]
--(
	--@dniS VARCHAR(8000)
--)
@fechaDeComunicacion smalldatetime
AS

--DECLARE @tablaDni TABLE
--(
--	dni int
--)

--INSERT INTO @tablaDni SELECT * FROM dbo.SeparadoPorComas(@dniS, '','')

SELECT p.Apellido,
       p.Nombre,
       p.Documento AS [DNI - Persona Relevada],
       p.Fecha_comunicacion,
       '''' [DNI - FOTO]
       --COALESCE(CONVERT(varchar, t.dni), ''SIN FOTO AUN'') AS [DNI - FOTO]
FROM dbo.CRED_PersonasRelevadas AS p
WHERE p.Fecha_comunicacion > @fechaDeComunicacion' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Ins_DatosPersonales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Ins_DatosPersonales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:Aza
-- Create date: 15/09/2011
-- Descripción:	Inserta los datos personales importados desde el Access.
-- =============================================
create procedure [dbo].[CRED_Ins_DatosPersonales]
@Dni int,
@Apellido varchar(50),
@Nombre varchar(50),
@LugarTrabajo varchar(8),
@Telefono varchar(26),
@EmailMds varchar(60),
@EmailPersonal varchar(60),
@FechaComunicacion smalldatetime = null,
@Calle varchar(50),
@Numero varchar(6),
@Piso varchar(3),
@Depto varchar(255),
@Casa varchar(20),
@Manzana varchar(20),
@Torre varchar(20),
@Uf varchar(20),
@Codigo_Postal varchar(12),
@Localidad varchar(60),
@Barrio varchar(50)
as

DECLARE @Textosiesnulo varchar(3)
set @Textosiesnulo = ''N/E''

IF @FechaComunicacion is null BEGIN
set @FechaComunicacion = GETDATE()
END

--Si ya existe el documento que quiero insertar, salgo del proceso, asi no da error de clave duplicada.
IF exists (select 1 from PersonasRelevadas where Documento = @Dni)  
BEGIN  

	UPDATE p
	SET Apellido = ISNULL(@Apellido,@Textosiesnulo),
	Nombre = ISNULL(@Nombre,@Textosiesnulo),
	Lugar_de_trabajo = ISNULL(@LugarTrabajo,@Textosiesnulo),
	Telefono = ISNULL(@Telefono,@Textosiesnulo),
	Email_mds = ISNULL(@EmailMds,@Textosiesnulo),
	Email_personal = ISNULL(@EmailPersonal,@Textosiesnulo),
	Fecha_comunicacion = GETDATE()
	from dbo.CRED_PersonasRelevadas as p inner join dbo.CRED_domicilios as d 
	on p.Documento = d.Documento
	where p.Documento = @Dni
	and p.Fecha_comunicacion < @FechaComunicacion
	
	UPDATE d
	SET Calle = ISNULL(@Calle,@Textosiesnulo),
        Numero=  ISNULL(@Numero,@Textosiesnulo),
		Piso = ISNULL(@Piso ,@Textosiesnulo),
		Depto = ISNULL(@Depto,@Textosiesnulo),
		Casa = ISNULL(@Casa ,@Textosiesnulo),
		Manzana= ISNULL(@Manzana ,@Textosiesnulo),
		Torre = ISNULL(@Torre,@Textosiesnulo),
		Uf = ISNULL(@Uf,@Textosiesnulo),
		Codigo_Postal= ISNULL(@Codigo_Postal,@Textosiesnulo) ,
		Localidad = ISNULL(@Localidad,@Textosiesnulo),
		Barrio = ISNULL(@Barrio,@Textosiesnulo) 
	from dbo.CRED_PersonasRelevadas as p inner join dbo.CRED_domicilios as d 
	on p.Documento = d.Documento
	where p.Documento = @Dni
	and p.Fecha_comunicacion < @FechaComunicacion
	
RETURN  
END  

ELSE
  
BEGIN   
  
INSERT INTO dbo.CRED_PersonasRelevadas(Documento,Apellido,Nombre,Lugar_de_trabajo,Telefono,Email_mds,Email_personal,Fecha_comunicacion)  
VALUES (@Dni,ISNULL(@Apellido,@Textosiesnulo),ISNULL(@Nombre,@Textosiesnulo),ISNULL(@LugarTrabajo,@Textosiesnulo),ISNULL(@Telefono,@Textosiesnulo),ISNULL(@EmailMds,@Textosiesnulo),ISNULL(@EmailPersonal,@Textosiesnulo),@FechaComunicacion)  
  
INSERT INTO dbo.CRED_Domicilios (Documento,Calle,Numero,Piso,Depto,Casa,Manzana,Torre,Uf,Codigo_Postal,Localidad,Barrio)
values  (@Dni,ISNULL(@Calle,@Textosiesnulo),ISNULL(@Numero,@Textosiesnulo),ISNULL(@Piso,@Textosiesnulo),ISNULL(@Depto,@Textosiesnulo),ISNULL(@Casa,@Textosiesnulo),ISNULL(@Manzana,@Textosiesnulo),ISNULL(@Torre,@Textosiesnulo),ISNULL(@Uf,@Textosiesnulo),ISNULL(@Codigo_Postal,@Textosiesnulo),ISNULL(@Localidad,@Textosiesnulo),ISNULL(@Barrio,@Textosiesnulo)  )
  
END  ' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_DocumentosPersonasRelevadas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_DocumentosPersonasRelevadas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CRED_Get_DocumentosPersonasRelevadas]
AS
	SELECT documento FROM dbo.CRED_PersonasRelevadas
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_PersonasRelevadas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_PersonasRelevadas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 09/10/2011
-- Descripción:	Obtiene las personas relevadas
-- =============================================
create procedure [dbo].[CRED_Get_PersonasRelevadas]
as

select documento, Apellido, Nombre, Lugar_de_trabajo, Telefono, Email_mds, Email_personal, Fecha_comunicacion, IdBaja
from dbo.CRED_PersonasRelevadas
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Ins_DatosPersonalesRelevados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Ins_DatosPersonalesRelevados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CRED_Ins_DatosPersonalesRelevados]
@Dni int,
@Apellido varchar(50),
@Nombre varchar(50),
@LugarTrabajo varchar(8),
@Telefono varchar(26),
@EmailMds varchar(60),
@EmailPersonal varchar(60),
@FechaComunicacion smalldatetime = null,
@Calle varchar(50),
@Numero varchar(6),
@Piso varchar(3),
@Depto varchar(255),
@Casa varchar(20),
@Manzana varchar(20),
@Torre varchar(20),
@Uf varchar(20),
@Codigo_Postal varchar(12),
@Localidad varchar(60),
@Barrio varchar(50),
@IdLocalidad int,
@IdUsuario smallint
as

DECLARE @Textosiesnulo varchar(3)
set @Textosiesnulo = ''N/E''

IF @FechaComunicacion is null BEGIN
set @FechaComunicacion = GETDATE()
END

INSERT INTO dbo.CRED_PersonasRelevadas(Documento,Apellido,Nombre,Lugar_de_trabajo,Telefono,Email_mds,Email_personal,Fecha_comunicacion, IdUsuario)  
VALUES (@Dni,ISNULL(@Apellido,@Textosiesnulo),ISNULL(@Nombre,@Textosiesnulo),ISNULL(@LugarTrabajo,@Textosiesnulo),ISNULL(@Telefono,@Textosiesnulo),ISNULL(@EmailMds,@Textosiesnulo),ISNULL(@EmailPersonal,@Textosiesnulo),@FechaComunicacion, @IdUsuario)  
  
INSERT INTO dbo.CRED_Domicilios (Documento,Calle,Numero,Piso,Depto,Casa,Manzana,Torre,Uf,Codigo_Postal,Localidad,Barrio, IdLocalidad)
values  (@Dni,ISNULL(@Calle,@Textosiesnulo),ISNULL(@Numero,@Textosiesnulo),ISNULL(@Piso,@Textosiesnulo),ISNULL(@Depto,@Textosiesnulo),ISNULL(@Casa,@Textosiesnulo),ISNULL(@Manzana,@Textosiesnulo),ISNULL(@Torre,@Textosiesnulo),ISNULL(@Uf,@Textosiesnulo),ISNULL(@Codigo_Postal,@Textosiesnulo),ISNULL(@Localidad,@Textosiesnulo),ISNULL(@Barrio,@Textosiesnulo), ISNULL(@IdLocalidad,@Textosiesnulo)  )

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_PersonaRelevadaByDni]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_PersonaRelevadaByDni]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CRED_Get_PersonaRelevadaByDni]
	@Documento int
AS
BEGIN
	
	Select dom.id,  Apellido, Nombre, Lugar_de_trabajo, Telefono, Email_mds, Email_personal, Fecha_comunicacion,
	dp.documento, Calle, Numero, Piso, Depto, Casa, Manzana, Torre, Uf, Codigo_postal, Localidad, barrio,dom.IdLocalidad 
	from dbo.CRED_PersonasRelevadas dp 
	LEFT JOIN dbo.CRED_Domicilios dom 
		on dp.documento = dom.documento 
	Where dp.documento = @Documento 
END' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Ins_AccesosAUsuario]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Ins_AccesosAUsuario]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'Create procedure [dbo].[CRED_Ins_AccesosAUsuario]
@idUsuario smallint,
@idAcceso smallint
as

insert into dbo.CRED_UsuariosAccesos (IdUsuario, IdAcceso)
values (@idUsuario,@idAcceso )' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Del_AccesosAUsuario]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Del_AccesosAUsuario]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
Create procedure [dbo].[CRED_Del_AccesosAUsuario]
@idUsuario smallint

as

delete from dbo.CRED_UsuariosAccesos where IdUsuario = @idUsuario
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_usuario]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_usuario]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CRED_Get_usuario]
@Nombre varchar(30),
@Password varchar(200)
as

select  usu.Idusuario, usu.Nombre NombreUsuario, Nick NickUsuario,
		acce.Id IdAcceso, acce.Nombre NombrePantalla
from dbo.CRED_usuarios usu
LEFT JOIN dbo.CRED_UsuariosAccesos usuAcce
	ON usu.IdUsuario = usuAcce.IdUsuario
LEFT JOIN dbo.CRED_Accesos acce
	ON acce.Id = usuAcce.IdAcceso
where usu.Nick = @Nombre
and usu.clave = @Password' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Administracion_Folios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Administracion_Folios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[LEG_ADD_Administracion_Folios]
	@Id_interna int,
	@Folio varchar(10),
	@UsuarioIntervino smallint=null,
	@FechaIntervino datetime=null,
	@UsuarioDesglose smallint=null,
	@FechaDesglose datetime=null,
	@MotivoDesglose varchar(50)=null
as

IF (Select folio from dbo.LEG_Administracion_Folios
	   Where id_interna = @id_interna and Folio = @Folio) is null 
	BEGIN
		Insert into dbo.LEG_Administracion_Folios
			(Id_interna, Folio, UsuarioIntervino, FechaIntervino)
		values (@id_interna,
			@folio,
			@UsuarioIntervino,
			@FechaIntervino)
	END
ELSE
	BEGIN

	IF (Select desglosado from dbo.LEG_Administracion_Folios
	   Where id_interna = @id_interna and Folio = @Folio) = 1 
		BEGIN
			UPDATE 	dbo.LEG_Administracion_Folios
			SET	desglosado= 0,
			 	UsuarioIntervino = @UsuarioIntervino,
				FechaIntervino = @FechaIntervino
			WHERE Id_interna = @Id_interna and Folio = @Folio
		END
	ELSE
		BEGIN
			UPDATE 	dbo.LEG_Administracion_Folios
			SET	desglosado= 1,
			 	UsuarioDesglose = @UsuarioDesglose,
				FechaDesglose = @FechaDesglose,
				MotivoDesglose = @MotivoDesglose
			WHERE Id_interna = @Id_interna and Folio = @Folio
		END
	END	
	



' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Administracion_Folios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Administracion_Folios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[LEG_GET_Administracion_Folios]
	@Id_interna int
as
SELECT 	Folio,
	isnull(UI.nombre,'''') Intervino,
	FechaIntervino,
	isnull(UD.nombre,'''') Desgloso,
	isnull(FechaDesglose,'''')FechaDesglose,
	isnull(MotivoDesglose,'''')MotivoDesglose,
	Desglosado
FROM dbo.LEG_Administracion_Folios AF
LEFT JOIN dbo.RH_Usuarios UI
	on UI.id = AF.UsuarioIntervino
LEFT JOIN dbo.RH_Usuarios UD
	on UD.id = AF.UsuarioDesglose
WHERE id_interna = @Id_Interna




' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_UPD_Reserva_Contrato]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_UPD_Reserva_Contrato]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[CTR_UPD_Reserva_Contrato]
	@Id_Contrato int,
	@Id_Motivo smallint = null,
	@Usuario smallint = null
AS

--MARCA RESERVA EN CTR_CONTRATO
UPDATE dbo.CTR_Contratos
SET Reservado = CASE WHEN Reservado = 1 THEN 
			0
		ELSE 
			1
		END 
WHERE Id_Contrato = @Id_Contrato

--DETALLE DE LA RESERVA
IF (SELECT Id_Contrato FROM dbo.CTR_Contratos_Reservas WHERE Id_Contrato = @Id_Contrato) IS NULL BEGIN
	--ALTA DETALLE RESERVA
	INSERT INTO dbo.CTR_Contratos_Reservas
	VALUES (@Id_Contrato, @Id_Motivo, Getdate(), @Usuario)
END
ELSE
BEGIN
	--ELIMINA DETALLE RESERVA
	DELETE FROM dbo.CTR_Contratos_Reservas
	WHERE Id_Contrato = @Id_Contrato
END












' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_TiposCredenciales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_TiposCredenciales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[CRED_Get_TiposCredenciales]
as
select ID, Descripcion 
from dbo.CRED_TiposCredenciales' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Ins_CredencialesPersonas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Ins_CredencialesPersonas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:Aza
-- Create date: 25/08/2011
-- Descripción:	Inserta nuevas credenciales.
-- =============================================
create procedure [dbo].[CRED_Ins_CredencialesPersonas]
@IdTipo smallint,
@FechaAlta smalldatetime,
@UsuarioAlta varchar(20),
@IdPersona int 
as

Declare @elIdDeCredencial smallint

insert into dbo.CRED_Credenciales (IdTipo,FechaAlta,UsuarioAlta)
values (@IdTipo,@FechaAlta,@UsuarioAlta)

select @elIdDeCredencial = SCOPE_IDENTITY() 

insert into dbo.CRED_PersonasCredenciales(IdPersona,IdCredencial)
values(@IdPersona,@elIdDeCredencial)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Upd_CredencialesDefinitivas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Upd_CredencialesDefinitivas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:FC
-- Create date: 31/08/2011
-- Description:	Actualizo el codigo magnetico de una credencial definitiva
-- =============================================
CREATE PROCEDURE [dbo].[CRED_Upd_CredencialesDefinitivas]
	@Id smallint,
	@CodigoMagnetico varchar(30)
AS
BEGIN

UPDATE dbo.CRED_Credenciales
SET CodigoMagnetico = @CodigoMagnetico
WHERE Id = @Id

select Id, IdTipo, CodigoMagnetico 
from dbo.CRED_Credenciales
where Id = @Id

END' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_AsignacionPorCredencial]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_AsignacionPorCredencial]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:FC
-- Create date: 01/09/2011
-- Description:	Consulto si una credencial ya fue asignada
-- =============================================
CREATE PROCEDURE [dbo].[CRED_Get_AsignacionPorCredencial]
	@IdCredencial smallint
AS
BEGIN

SELECT 
	*
FROM 
	dbo.CRED_Asignaciones asig
	INNER JOIN dbo.CRED_Credenciales cre
		ON asig.IdCredencial = cre.Id	
	WHERE
		asig.IdCredencial = @IdCredencial
		AND asig.IdBaja is null
END' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Upd_BajaCredencial]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Upd_BajaCredencial]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:FC
-- Create date: 05/09/2011
-- Description:	Baja de Credencial
-- =============================================
CREATE PROCEDURE [dbo].[CRED_Upd_BajaCredencial]
	@IdBaja int,
	@IdCredencial smallint
AS
BEGIN

UPDATE dbo.CRED_Credenciales
SET IdBaja = @IdBaja
WHERE Id = @IdCredencial

select Id,IdBaja
from dbo.CRED_Credenciales
where Id = @IdCredencial

END' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_DEL_Recibos_Recibidos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_DEL_Recibos_Recibidos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure  [dbo].[PLA_DEL_Recibos_Recibidos]
	@id_recibo int
as

delete 
from dbo.PLA_Recibos_Recibidos
where id_recibo = @id_recibo
' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_UPD_Recibos_Recibidos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_UPD_Recibos_Recibidos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[PLA_UPD_Recibos_Recibidos]  
  @idUsuario int
as  
  
set nocount on  
  
declare @id int  
select @id = max(isnull(id_comprobante,0)) + 1 from PLA_Recibos_Recibidos  
  
  
update PLA_Recibos_Recibidos  
set id_comprobante = @id  
where id_comprobante is null  AND
	Usuario = @idUsuario
  
  
select @id id_comprobante  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Ins_Documento]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Ins_Documento]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
-- =============================================
-- Author:		Agustin
-- Create date: 08/08/2011
-- Description:	Inserta un nuevo documento
-- =============================================
CREATE procedure [dbo].[CRED_Ins_Documento]
	@IdTipoDocumento smallint,
	@FolioDesde varchar(10),
	@FolioHasta varchar(10),
	@Fecha smalldatetime,
	@Observacion VARCHAR(200),
	@IdUsuario smallint
AS

set @Fecha = GETDATE()

BEGIN
	INSERT INTO dbo.CRED_Documentos
	(IdTipoDocumento, FolioDesde, FolioHasta, Fecha, Observacion,IdUsuario)
	VALUES    
	(@IdTipoDocumento, @FolioDesde, @FolioHasta, @Fecha, @Observacion,@IdUsuario)
	
	select SCOPE_IDENTITY()
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_Organismos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_Organismos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[CRED_Get_Organismos]
as
select Id, Descripcion, ImagenCredencial AS ImagenCredencialOrganismo, TemplateWord TemplateWordOrganismo
from dbo.CRED_Organismos' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_OrganismosByName]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_OrganismosByName]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CRED_Get_OrganismosByName]
@organismo varchar(30)
AS
BEGIN

select Id, ImagenCredencial AS ImagenCredencialOrganismo, TemplateWord AS TemplateWordOrganismo
from dbo.CRED_Organismos
where dbo.CRED_Organismos.Descripcion = @organismo

END' 
END
GO
/****** Object:  StoredProcedure [dbo].[DOT_GetAsignacionesNivelGrado]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[DOT_GetAsignacionesNivelGrado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 02/10/2009
-- Description:	Trae todos los desgloses de Nivel Grado
-- =============================================
CREATE PROCEDURE [dbo].[DOT_GetAsignacionesNivelGrado]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	SELECT ng.documento, ng.desde, tn.nivel, tg.grado 
		FROM dbo.Leg_Desglose_NivelGrado ng
	LEFT JOIN dbo.tabla_niveles tn
		ON tn.Id = ng.id_Nivel
	LEFT JOIN dbo.tabla_grados tg
		ON tg.Id = ng.id_Grado

END' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Desglose_NivelGrado]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Desglose_NivelGrado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[LEG_ADD_Desglose_NivelGrado]
	@Id_interna [int] ,
	@Documento [int] ,
	@Id_Nivel [smallint],
	@Id_Grado [smallint],
	@Desde [datetime] ,
	@Jurisdiccion [varchar] (25)=null ,
	@Organismo [varchar] (25) =null ,
	@Folio [char] (10) =null ,
	@Acto_Tipo [smallint]=null ,
	@Acto_Nro [varchar] (10) =null ,
	@Acto_Fecha [datetime]=null ,
	@Usuario smallint 

AS
DECLARE @Id int

SET @id = (select max(id)+1 from dbo.LEG_Desglose_NivelGrado)
IF @ID is null BEGIN
	SET @Id = 1
END
INSERT INTO dbo.LEG_Desglose_NivelGrado
VALUES	(@id,
	@id_interna,
	@Documento,
	@Id_Nivel,
	@Id_Grado,
	@Desde,
	@Jurisdiccion,
	@Organismo,
	@Folio,
	@Acto_Tipo,
	@ACto_Nro,
	@Acto_Fecha,
	@Usuario)

	







' 
END
GO
/****** Object:  View [dbo].[VW_Desglose_NivelGrado]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Desglose_NivelGrado]'))
EXEC dbo.sp_executesql @statement = N'







CREATE       VIEW [dbo].[VW_Desglose_NivelGrado]
AS
SELECT top 100 percent *
FROM dbo.LEG_Desglose_NivelGrado
WHERE (convert(char(8),cast(desde as int),112)  + cast(documento as varchar)+ cast(id as varchar)) in
	(SELECT max((convert(char(8),cast(desde as int),112))+ cast(documento as varchar)+ cast(id as varchar))
	FROM dbo.LEG_Desglose_NivelGrado
	where desde <=getdate()
	GROUP BY id_interna)
ORDER BY id_interna














'
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_GET_DescNivel_Fecha]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_GET_DescNivel_Fecha]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_GET_DescNivel_Fecha]  (@id_interna int, @fecha datetime)  
RETURNS   Varchar(5)  AS  
BEGIN 

Return (	SELECT TOP 1	isnull(TN.Nivel ,'''')
	FROM dbo.leg_desglose_NivelGrado NG
	INNER JOIN dbo.Tabla_Niveles TN
		ON TN.id = NG.Id_Nivel
	WHERE Id_interna = @Id_interna and  desde <=  @fecha
	Order by desde desc)


END






' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_Tabla_Niveles]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_Tabla_Niveles]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[RH_Tabla_Niveles]
AS
SELECT  Id, Nivel
FROM dbo.tabla_Niveles
WHERE baja =0


' 
END
GO
/****** Object:  View [dbo].[VW_tabla_Niveles]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_tabla_Niveles]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_tabla_Niveles]
AS
SELECT  *
FROM dbo.tabla_Niveles

where baja =0

'
GO
/****** Object:  View [dbo].[VW_Niveles]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Niveles]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_Niveles]
AS
SELECT id, nivel
FROM dbo.Tabla_Niveles
where baja =0

'
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Niveles]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Niveles]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[GABM_Tabla_Niveles]
	@Operacion char(1),
	@Id_1 	[int]=null,
	@Descripcion_2 	[varchar](5)=null
AS 
IF @operacion =''A''
BEGIN
	Declare @MAx [int]
	set @Max = (select max(id)+1 from dbo.Tabla_Niveles)
	if @Max is null begin
		set @max=1
	end
	INSERT INTO dbo.Tabla_Niveles 
		 ([Id],
		 [nivel],
		Baja) 
 	VALUES 
		( @max,
		 @Descripcion_2,
		0)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_Niveles
	set 	[nivel] =  @Descripcion_2
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_Niveles
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_Niveles
	set 	baja =  0
	where 	id = @Id_1
END


IF @operacion =''S''
BEGIN
	SELECT	Id,
		nivel Descripción,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja 
	FROM  dbo.Tabla_Niveles
	WHERE (id = @ID_1) OR (@ID_1 is null)
	ORDER BY nivel
END









' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Impresion_DDJJ_Cargos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Impresion_DDJJ_Cargos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE   procedure [dbo].[LEG_ADD_Impresion_DDJJ_Cargos]
	@Documento int,
	@Usuario_Impresion smallint,
	@Año smallint = NULL
	
AS
IF EXISTS (SELECT Documento FROM dbo.LEG_Impresiones_DDJJ_Cargos Where Documento = @Documento AND Año = @Año) BEGIN
	UPDATE dbo.LEG_Impresiones_DDJJ_Cargos
	SET 	Fecha_Impresion = GetDate(),
		Usuario_Impresion = @Usuario_Impresion
	WHERE Documento =  @Documento
END
ELSE
BEGIN
	INSERT INTO dbo.LEG_Impresiones_DDJJ_Cargos 
	VALUES (@Documento,getdate(),@usuario_impresion,@Año)
END

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Upd_AsignacionDeCredencial]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Upd_AsignacionDeCredencial]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CRED_Upd_AsignacionDeCredencial]
	@Id int,
	@IdCredencial smallint,
	@IdPersona int,
	@Fecha smalldatetime,
	@IdDocumento smallint,
	@IdAutorizante int,
	@IdOrganismo smallint,
	@IdBaja int
		
AS

--set @Fecha = GETDATE()

--BEGIN

UPDATE 
	dbo.CRED_Asignaciones
SET 
	IdCredencial = @IdCredencial,
	IdPersona = @IdPersona,
	Fecha = @Fecha,
	IdDocumento = @IdDocumento,
	IdAutorizante = @IdAutorizante,
	IdOrganismo = @IdOrganismo,
	IdBaja = @IdBaja 
WHERE 
	Id = @Id' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Upd_BajaAsignacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Upd_BajaAsignacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:FC
-- Create date: 05/09/2011
-- Description:	Baja de Asignacion
-- =============================================
CREATE PROCEDURE [dbo].[CRED_Upd_BajaAsignacion]
	@IdBaja int,
	@IdAsignacion int
AS
BEGIN

UPDATE dbo.CRED_Asignaciones
SET IdBaja = @IdBaja
WHERE Id = @IdAsignacion

select Id,IdBaja
from dbo.CRED_Asignaciones
where Id = @IdAsignacion

END' 
END
GO
/****** Object:  StoredProcedure [dbo].[Cred_Get_DatosParaMigracionBajas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Cred_Get_DatosParaMigracionBajas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[Cred_Get_DatosParaMigracionBajas]
as

select * into #tempUltimasAsignaciones
from dbo.cred_asignaciones
where CAST(idpersona as varchar) + CAST(Fecha as varchar) in 
(select CAST(idpersona as varchar) + CAST(MAX(Fecha) as varchar)
from dbo.cred_asignaciones
group by idpersona) 
	
select pers.Documento, pers.Apellido, pers.Nombres,  cred.CodigoMagnetico, asig.Fecha FechaAsignacion, bajas.Fecha FechaBaja
from dbo.cred_personas pers
left join #tempUltimasAsignaciones asig
ON pers.Id = asig.idpersona
left join dbo.cred_credenciales cred
ON asig.idcredencial = cred.id
left join dbo.cred_bajas bajas
ON bajas.Id = pers.idBaja
where pers.idbaja <> 0 or asig.idbaja <> 0
order by  pers.Apellido, asig.Fecha 

Drop table #tempUltimasAsignaciones' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Otros_Servicios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Otros_Servicios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[LEG_UPD_Otros_Servicios]    
 (@Institución_1  [nvarchar](30),    
  @Domicilio_2  [nvarchar](50),    
  @Cargo_3  [varchar](50),    
  @Remun_4  [bit],    
  @Fecha_Desde_5  [smalldatetime],    
  @Fecha_Hasta_6  [smalldatetime],    
  @Causa_Egreso_7  [nvarchar](50),    
  @Id_Interna_8  [int],    
  @Folio_10  [char](10),    
 @Caja [varchar](50),    
 @afiliado [varchar](50),    
 @No_computa [varchar](9),
 @Datodebaja bit,    
 @datonoimprime bit,    
 @documento int,  
 @Id [int])    
    
AS     
update  [dbo].LEG_Otros_Servicios     
    
set    [Institucion]=  @Institución_1,    
  [Domicilio]=  @Domicilio_2,    
  [Cargo]=  @Cargo_3,    
  [Remun]=  @Remun_4,    
  [Fecha_Desde]=  @Fecha_Desde_5,    
  [Fecha_Hasta]=  @Fecha_Hasta_6,    
  [Causa_Egreso]=  @Causa_Egreso_7,    
  [Folio]=  @Folio_10,    
 caja= @caja,    
 afiliado= @afiliado,    
-- no_computa= @no_computa, 
 datodebaja = @datodebaja,    
 datonoimprime = @datonoimprime    
 where  id_interna =  @id_interna_8  and id =@id    
    
    
    
    
    
    
    
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Otros_Servicios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Otros_Servicios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[LEG_ADD_Otros_Servicios]  
 (@Institución_1 [varchar](30),  
  @Domicilio_2  [varchar](50),  
  @Cargo_3  smallint,  
  @Remun_4  [bit],  
  @Fecha_Desde_5  [smalldatetime],  
  @Fecha_Hasta_6  [smalldatetime],  
  @Causa_Egreso_7  [varchar](50),  
  @Id_Interna_8  [int],  
  @Folio_10  [char](10),  
 @Caja [varchar](50),  
 @afiliado [varchar](50),  
 @No_computa [varchar](9),
@Datodebaja bit,  
 @datonoimprime bit,
@documento int)  
  
AS   
 

 
INSERT INTO [dbo].[LEG_Otros_Servicios]   
  ( [Institucion],  
  [Domicilio],  
  [Cargo],  
  [Remun],  
  [Fecha_Desde],  
  [Fecha_Hasta],  
  [Causa_Egreso],  
  [Id_Interna],  
  [Folio],  
 caja,  
 afiliado,  
-- no_computa,  
-- id, 
 DATODEBAJA,  
 DATONOIMPRIME,
documento)   
   
VALUES   
 ( @Institución_1,  
  @Domicilio_2,  
  @Cargo_3,  
  @Remun_4,  
  @Fecha_Desde_5,  
  @Fecha_Hasta_6,  
  @Causa_Egreso_7,  
  @Id_Interna_8,  
  @Folio_10,  
 @caja,  
 @afiliado,  
-- @no_computa,  
-- @id, 
 @DATODEBAJA,  
 @DATONOIMPRIME,
@documento)  

  
  



' 
END
GO
/****** Object:  StoredProcedure [dbo].[getPeriodosTrabajadosPrivada]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[getPeriodosTrabajadosPrivada]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'  
  
CREATE PROCEDURE [dbo].[getPeriodosTrabajadosPrivada]    
AS    
 SELECT Fecha_Desde desde, Fecha_Hasta hasta, Id_Interna legajo    
 FROM LEG_OTROS_SERVICIOS   
 where  DatoDeBaja<>1 ' 
END
GO
/****** Object:  StoredProcedure [dbo].[GU_GET_Guarderias]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GU_GET_Guarderias]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[GU_GET_Guarderias]
	@Nombre varchar(100)=null,
	@CUIT varchar(11)=null
as
SELECT  distinct
	[Guarderia], 
	left([CUIT],2)+''-''+ right(left([CUIT],10),8)+''-''+ right([CUIT],1) CUIT , 
	[Calle], 
	[Nro], 
	[Piso], 
	[Dpto], 
	[CP], 	
	l.nombreLocalidad Localidad, 
	[Telefono] 
FROM [dbo].[GU_DDJJ_Guarderia] G
INNER JOIN dbo.localidadesafip L
	on l.idlocalidad = g.localidad
WHERE 	((g.guarderia like @nombre +''%'') or @nombre is null) and
	((g.cuit = @cuit) or @cuit is null)




' 
END
GO
/****** Object:  StoredProcedure [dbo].[ABM_localidadesAFIP]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ABM_localidadesAFIP]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ABM_localidadesAFIP]
	(@Id_loc [int],
	@cp 	[smallint],
	 @nom_localidad [varchar](50),
	@id_prov [tinyint],
	@operacion [int])

AS 
declare @MaxId_loc [int]
set @maxId_loc = (select max(idlocalidad) +1 from dbo.localidadesAFIP)
--ALTA
IF  @operacion = 1 
BEGIN
	INSERT INTO [dbo].[localidadesAFIP] 
	 ([Idlocalidad],
	 [codigopostal],
	 [nombrelocalidad],
	 [id_provincia]) 
	VALUES 
		(@MaxId_loc ,
		@cp,
	 	@nom_localidad,
		@id_prov)
END


-- MODIFICACION
IF @operacion = 2 
BEGIN
	UPDATE [dbo].[localidadesAFIP] 
	SET   [Idlocalidad] = @Id_loc,
	           [codigopostal] = @cp,
	           [nombrelocalidad]=@nom_localidad,
	            [id_provincia] =@id_prov

	WHERE 
		idlocalidad =  @id_loc		
END

--BAJA
IF @OPERACION =3  
BEGIN
	UPDATE [dbo].[localidadesAFIP] 
	SET   baja = 1
	WHERE 
		idlocalidad =  @id_loc		
END


--CONSULTA
IF @OPERACION =4 
BEGIN
	SELECT * FROM [dbo].[localidadesAFIP]
	where baja =0
	order by idlocalidad
END


' 
END
GO
/****** Object:  StoredProcedure [dbo].[GET_NombreLocalidad_ABM]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GET_NombreLocalidad_ABM]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GET_NombreLocalidad_ABM]

@loc [varchar](50),
@cp [smallint]

AS

select nombrelocalidad
from dbo.localidadesAFIP 
where nombrelocalidad = @loc and codigopostal = @cp


' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[FxDom_Personal_Bco]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[FxDom_Personal_Bco]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE   FUNCTION [dbo].[FxDom_Personal_Bco] (@id int,@operacion int)

	RETURNS varchar(100)
AS  

BEGIN 

declare @cadena varchar (5000)
set @cadena=''''


if @operacion=1 begin
	set @cadena=(select calle from domicilio_personal where id_domicilio=@id)
end

if @operacion=2 begin
	set @cadena=(select número from domicilio_personal where id_domicilio=@id)
end

if @operacion=3 begin
	set @cadena=(select piso from domicilio_personal where id_domicilio=@id)
end

if @operacion=4 begin
	set @cadena=(select dpto from domicilio_personal where id_domicilio=@id)
end

if @operacion=5 begin
	set @cadena=(select L.nombrelocalidad from domicilio_personal dom

	inner join localidadesafip L
		on L.idlocalidad=dom.localidad

where id_domicilio=@id)



end

if @operacion=6 begin
	set @cadena=(select codigo_postal from domicilio_personal where id_domicilio=@id)
end


	RETURN @cadena


END













' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Estudios_Especialidades]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Estudios_Especialidades]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[LEG_GET_Estudios_Especialidades]      
  @NroDocumento  [int]      
AS       
SELECT  Id,      
 isnull(Oficio,'''')Oficio,
 isnull(Conocimiento,'''')Conocimiento,      
 Folio    
FROM  dbo.LEG_Estudios_Especialidades       
WHERE Doc_Tit = @NroDocumento AND      
 datodebaja=0      
    
    
  

        
      
      
    
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Estudios_Especilidades]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Estudios_Especilidades]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE  PROCEDURE [dbo].[LEG_ADD_Estudios_Especilidades]
	(@Tipo_maqui_1 	[char](20),
	 @P_Min_Maq_2 	[smallint],
	 @Idiomas_3 	[char](20),
	 @P_Min_Idi_4 	[smallint],
	 @Doc_Tit_5 	[int],
	 @Id_interna_6 	[int],
 	 @Folio_2 	[char](10),
	 @datonoimprime bit,
	@Oficio varchar(200)=null,
	@Conocimiento varchar(200)=null,
	@Usuario smallint)
AS 


INSERT INTO dbo.LEG_Estudios_Especialidades
	([Tipo_maqui],
	[P_Min_Maq],
	Id_Idioma,
	[P_Min_Idi],
	[Doc_Tit],
	[Id_interna],
	[Folio],
	datonoimprime,
	Oficio,
	Conocimiento,
	Usuario,
	FechaProceso) 
VALUES 
	(@Tipo_maqui_1,
	@P_Min_Maq_2,
	@Idiomas_3,
	@P_Min_Idi_4,
	@Doc_Tit_5,
	@Id_interna_6,
	@Folio_2,
	@datonoimprime,
	@Oficio,
	@Conocimiento,
	@Usuario,
	getdate() )



' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Estudios_Especilidades]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Estudios_Especilidades]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE   PROCEDURE [dbo].[LEG_UPD_Estudios_Especilidades]
	(
	@id [int],
	@Tipo_maqui_8 	[smallint],
	@P_Min_Maq_9 	[smallint],
	@Idiomas_10 	smallint,
	@P_Min_Idi_11 	[smallint],
	@Folio_14 	[char](10),
	@Conocimiento varchar(200),
	@Oficio varchar(200),
	@datonoimprime bit,
	@Usuario smallint)
AS 
UPDATE	[dbo].LEG_Estudios_Especialidades
SET 	[Tipo_maqui]= @Tipo_maqui_8,
	[P_Min_Maq]= @P_Min_Maq_9,
	[Id_Idioma]= @Idiomas_10,
	[P_Min_Idi]= @P_Min_Idi_11,
	[Folio]= @Folio_14 ,
	oficio = @Oficio,
	conocimiento = @conocimiento,
	datonoimprime= @datonoimprime,
	Usuario = @Usuario,
	FechaProceso = getdate()
WHERE  	id = @id



' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_DEL_Estudio_Especialidad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_DEL_Estudio_Especialidad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

create procedure [dbo].[LEG_DEL_Estudio_Especialidad]
	@IdEstudio int
AS
UPDATE dbo.LEG_Estudios_Especialidades
SET DatoDeBaja = 1
WHERE Id = @IdEstudio

' 
END
GO
/****** Object:  StoredProcedure [dbo].[ABM_Tabla_Funciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ABM_Tabla_Funciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ABM_Tabla_Funciones]
	(@id_1 	[smallint],
	 @descripcion_2 	[varchar](10),
	 @importe_3 	[money],
	@Operacion [int])

AS 
DECLARE @MaxID [int]
set @MaxId = (select max(id)+1 from dbo.tabla_funciones)
IF @operacion =1
BEGIN
	INSERT INTO [dbo].[Tabla_Funciones] 
	 ([id],
	 [descripcion],
	 [importe]) 
 
	VALUES 
	( @maxid ,
	 @descripcion_2,
	 @importe_3)

END
IF @operacion =2
BEGIN
	 update [dbo].[Tabla_Funciones] 
	 set  [descripcion]=   @descripcion_2,
		 [importe]=@importe_3
	 where id = @id_1
END

IF @operacion =3
BEGIN
	 update [dbo].[Tabla_Funciones] 
	 set  baja=  1
	 where id = @id_1
END

IF @operacion =4
BEGIN
	select  * from dbo.Tabla_Funciones
	 where baja =0
	order by descripcion
END

-- VERIFICA SI EXISTE EN DB
IF @OPERACION=5
BEGIN
	SELECT * FROM dbo.Tabla_Funciones
	where  [descripcion]=   @descripcion_2
END




' 
END
GO
/****** Object:  View [dbo].[VW_Funciones]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Funciones]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_Funciones]
AS SELECT [Tabla_Funciones].[id], [Tabla_Funciones].[descripcion]
FROM [Tabla_Funciones]
where baja =0

'
GO
/****** Object:  StoredProcedure [dbo].[RH_GET_Usuarios]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_GET_Usuarios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE    PROCEDURE [dbo].[RH_GET_Usuarios]
	@id  int = NULL,
	@solo_web bit = NULL
AS

IF @solo_web = 1 

BEGIN

	SELECT 	[U].[id], [U].[nombre], [U].[password], [U].[vence_passw], [U].[baja], 
		[U].[actualizar_passw], [U].[administrador], UD.Nombre Nombre_real, UD.Apellido 
	
	FROM [dbo].[RH_Usuarios] [U]
	INNER JOIN [dbo].[RH_Usuarios_Detalles] [UD]
		ON [U].[id] = [UD].[id_usuario]

	WHERE	([id] = @id OR @id IS NULL) AND [UD].[Acceso_Web] = 1
	
	ORDER BY [U].[Nombre]
	
END
ELSE
BEGIN
	SELECT 	US.[id], US.[nombre], US.[password], US.[vence_passw], US.[baja], 
		US.[actualizar_passw], US.[administrador] , UD.Apellido, UD.Nombre Nombre_real
	
	FROM [dbo].[RH_Usuarios] US
	LEFT JOIN dbo.RH_Usuarios_Detalles UD
		ON US.id =UD.id_usuario
	
	WHERE	(Us.[id] = @id OR @id IS NULL)
	
	ORDER BY Us.[nombre]

END

' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_GET_Usuarios_Detalles]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_GET_Usuarios_Detalles]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[RH_GET_Usuarios_Detalles]
	@usuario smallint
AS
SELECT * 
FROM dbo.RH_Usuarios_Detalles
WHERE id_usuario = @Usuario


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Carrera_Administrativa]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Carrera_Administrativa]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE        PROCEDURE [dbo].[LEG_ADD_Carrera_Administrativa]
	(@Jurisdicción_1 	[varchar](50),
	 @Organismo_2 	[varchar](50),
	 @Regimen_3 	[smallint],
	 @Id_agrupamiento_4 	[smallint],
	 @Id_Cargos_6 	[smallint],
	 @Causas_7 	[varchar](50),
	 @Fecha_Desde_8 	[datetime],
	 @Acto_Tipo_10 	[smallint],
	 @Acto_nro_11 	[varchar](10),
	 @Acto_Fecha_12 	[datetime],
	 @Folio_13 	[char](10),
	 @Id_Interna_14 	[int],
	 @Doc_Tit_15 	[int],
 	 @id_tipo_cargo [smallint],
	 @Usuario smallint,
	 @datodebaja bit,
	 @datonoimprime bit,
	 @Fecha_Hasta smalldatetime=null

)

AS
Declare	 @Id_Carrera_16	[int]
set  @Id_Carrera_16 = (select max(id_carrera)+1 from dbo.Carrera_Administrativa)		
if @Id_Carrera_16 is null begin
	set @Id_Carrera_16 =1
end


-- ACTUALIZA FECHA_HASTA DE LA CARRERA ANTERIOR (CORRESPONDE UN DIA MENOS A LA ASIGNACION DE LA NUEVA CARRERA)
--exec  dbo.LEG_UDP_Cierra_Carrera_Administrativa   @Fecha_Desde_8, @Id_Interna_14, @Doc_Tit_15, NULL, @Id_Carrera_16



 INSERT INTO [dbo].[Carrera_Administrativa] 
	 ( [Jurisdicción],
	 [Organismo],
	 [Regimen],
	 [Id_agrupamiento],
	 [Id_Cargos],
	 [Causas],
	 [Fecha_Desde],
	 [Acto_Tipo],
	 [Acto_nro],
	 [Acto_Fecha],
	 [Folio],
	 [Id_Interna],
	 [Doc_Tit],
	 [Id_Carrera],
 	 id_tipo_cargo,
	 usuario,
	 datodebaja,
	 datonoimprime,
	 Fecha_Hasta) 
VALUES 
	(@Jurisdicción_1,
	 @Organismo_2,
	 @Regimen_3,
	 @Id_agrupamiento_4,
	 @Id_Cargos_6,
	 @Causas_7,
	 @Fecha_Desde_8,
	 @Acto_Tipo_10,
	 @Acto_nro_11,
	 @Acto_Fecha_12,
	 @Folio_13,
	 @Id_Interna_14,
	 @Doc_Tit_15,
	 @Id_Carrera_16,
 	 @id_tipo_cargo,
	 @usuario,
	 @datodebaja,
	 @datonoimprime,
	 @Fecha_Hasta)' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UDP_Cierra_Carrera_Administrativa]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UDP_Cierra_Carrera_Administrativa]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[LEG_UDP_Cierra_Carrera_Administrativa]
	(@Fecha 	[datetime],
	 @Id_Interna 	[int],
	 @Doc [int],
	@fecha_desde_anterior [datetime],
	@id_carrera [int])

AS 
update dbo.Carrera_Administrativa 
	set  [Fecha_Hasta] = @Fecha-1
where  
	(doc_tit = @doc and id_interna =  @Id_Interna) and 
	Id_Carrera <> @id_carrera and 
	(fecha_hasta is null )-- or fecha_hasta +1= @fecha_desde_anterior)



' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Carrera_Administrativa]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Carrera_Administrativa]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[LEG_UPD_Carrera_Administrativa]
	(@Id_Carrera_1 	[int],
	 @Jurisdiccion_2 	[varchar](50),
	 @Organismo_3 	[varchar](50),
	 @Regimen_4 	[smallint],
	 @Id_agrupamiento_5 	[smallint],
	 @Id_Cargos_7 	[smallint],
	 @Causas_8 	[varchar](50),
	 @Fecha_Desde_9 	[datetime],
	 @Acto_Tipo_11 	[smallint],
	 @Acto_nro_12 	[varchar](10),
	 @Acto_Fecha_13 	[datetime],
	 @Folio_14 	[char](10),
	 @Id_Interna_15 	[int],
	 @Doc_Tit_16 	[int],
	 @id_tipo_cargo [smallint],
	 @usuario smallint,
	 @datodebaja bit,
	 @datonoimprime bit,
	 @Fecha_Hasta smalldatetime=null)

AS 
UPDATE [dbo].[Carrera_Administrativa] 
SET  	[Jurisdicción]	 = @Jurisdiccion_2,
	[Organismo]	 = @Organismo_3,
	[Regimen]	 = @Regimen_4,
	[Id_agrupamiento]	 = @Id_agrupamiento_5,
	[Id_Cargos]	 = @Id_Cargos_7,
	[Causas]	 = @Causas_8,
	[Fecha_Desde]	 = @Fecha_Desde_9,
	[Acto_Tipo]	 = @Acto_Tipo_11,
	[Acto_nro]	 = @Acto_nro_12,
	[Acto_Fecha]	 = @Acto_Fecha_13,
	[Folio]	 = @Folio_14,
	[Id_Interna]	 = @Id_Interna_15,
	[Doc_Tit]	 = @Doc_Tit_16,
	id_tipo_cargo = @id_tipo_cargo,
	usuario = @usuario,
	datodebaja=@datodebaja,
	datonoimprime=@datonoimprime,
	Fecha_Hasta =  case when not @Fecha_Hasta is null then @Fecha_hasta else Fecha_hasta end
WHERE 	([Id_Carrera]= @Id_Carrera_1)


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Ins_PedidoDeAlta]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Ins_PedidoDeAlta]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CRED_Ins_PedidoDeAlta]
	@IdDocumento smallint,
	@IdOrganismo smallint,
	@IdAutorizante int,
	@IdConceptoRelacion smallint,
	@FechaAlta smalldatetime,
	@Observacion varchar(200),
	@UsuarioAlta varchar(20),
	@IdPersona int
	
AS
BEGIN
	INSERT INTO dbo.CRED_PedidoAltaPersonas
	(IdDocumento, IdOrganismo, IdAutorizante, IdConceptoRelacion, FechaAlta, UsuarioAlta,IdPersona, Observacion)
	VALUES    
	(@IdDocumento,@IdOrganismo,@IdAutorizante,@IdConceptoRelacion,GETDATE(),@UsuarioAlta,@IdPersona, @Observacion)
	
	--select @@IDENTITY
	select SCOPE_IDENTITY() 
END' 
END
GO
/****** Object:  StoredProcedure [dbo].[Cred_ConsultaGeneral]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Cred_ConsultaGeneral]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[Cred_ConsultaGeneral]
as

select * into #tempUltimosPedidosDeAlta 
from dbo.CRED_PedidoAltaPersonas pedAltaPersonas
where CAST(FechaAlta as varchar) in 
(select CAST(MAX(FechaAlta) as varchar)
from dbo.CRED_PedidoAltaPersonas pedAltaPers2
where pedAltaPersonas.idpersona = pedAltaPers2.idpersona
group by idpersona)


SELECT 
	/*Datos de la Persona consultada*/
	persPedAlta.Documento DNI,
	persPedAlta.Apellido Apellido, 
	persPedAlta.Nombres Nombres,
	tempPedAlta.Observacion [Observacion de Persona],	
	
	/*Datos de Documento*/	
	tipo_doc.Descripcion [Nota Autorizacion],
	doc.FolioDesde [Folio Desde], 
	doc.FolioHasta [Folio Hasta], 
			
	/*Datos de Autorizante*/
	pers_auth.Documento [DNI Autorizante], 
	pers_auth.Apellido [Apellido Autorizante], 
	pers_auth.Nombres [Nombre Autorizante],
	
	doc.Observacion [Observacion de Documento de Autorizacion],
	
	/*Datos de Organismo y Relacion*/
	org.Descripcion Organismo,	
	cr.Descripcion Relacion,
	
	tipocred.Descripcion [Tipo (Def - Prov)],
	
	pers_relev.Fecha_comunicacion [Fecha Relevamiento],
		
	/*Datos de Asignación*/	
	asig.Fecha [Fecha Asignacion], 
    asig.Id [Orden de Asignacion (id)], 
    
    codImpreso.CodigoImpreso [N Externo (prov)],
    
    cred.CodigoMagnetico [Codigo Magnetico], 
    
	vencAsig.FechaVencimiento [Fecha Venc Cred Prov],

	isnull(convert(varchar, bajaPersona.Fecha,120), ''Activa'') [Fecha De Baja Persona],

	bajaAsignacion.Fecha [Fecha Baja De Asignacion],
	
	'''''''' + docUltPedAlta.FolioDesde + '' - '' + docUltPedAlta.FolioHasta + '''''''' FolioPedidoAltaVigente
		 
FROM 
		#tempUltimosPedidosDeAlta tempPedAlta
	INNER JOIN dbo.CRED_Personas persPedAlta
		ON tempPedAlta.idpersona = persPedAlta.id
	LEFT JOIN dbo.CRED_Asignaciones asig
		ON asig.idpersona = persPedAlta.id
	LEFT JOIN dbo.CRED_Credenciales cred
		ON cred.Id = asig.IdCredencial		
	LEFT JOIN dbo.CRED_TiposCredenciales tipocred
		ON tipocred.Id = cred.IdTipo
	LEFT JOIN dbo.CRED_Organismos org
		ON org.Id = asig.IdOrganismo
	LEFT JOIN dbo.CRED_Documentos doc
		ON doc.Id = asig.IdDocumento
	LEFT JOIN dbo.CRED_TiposDocumentos tipo_doc
		ON tipo_doc.Id = doc.IdTipoDocumento
	LEFT JOIN dbo.CRED_Autorizantes aut
		ON aut.Id = asig.IdAutorizante
	LEFT JOIN dbo.CRED_Personas pers_auth
		ON pers_auth.Id = aut.IdPersona
	LEFT JOIN dbo.CRED_PersonasRelevadas pers_relev
		ON pers_relev.Documento = persPedAlta.Documento
	LEFT JOIN dbo.CRED_Bajas bajaAsignacion
		ON bajaAsignacion.Id = asig.IdBaja		
	LEFT JOIN dbo.CRED_ConceptoRelacion cr
		ON cr.Id = tempPedAlta.IdConceptoRelacion 
	LEFT JOIN dbo.CRED_CredencialesAsignablesAPersonas cas
		ON cas.IdPersona = persPedAlta.Id
	LEFT JOIN dbo.Cred_CodigoImpresoCredencial codImpreso
		ON codImpreso.IdCredencial = cred.Id
	LEFT JOIN dbo.Cred_Vencimientos_Asignaciones vencAsig
		ON vencAsig.IdAsignacion = asig.Id
	LEFT JOIN dbo.cred_bajas bajaPersona
		ON bajaPersona.Id = persPedAlta.IdBaja	
	LEFT JOIN dbo.CRED_Documentos docUltPedAlta
		ON docUltPedAlta.id = tempPedAlta.idDocumento				
		
	ORDER BY persPedAlta.Apellido, persPedAlta.Nombres, asig.Fecha, asig.id
	
	Drop table #tempUltimosPedidosDeAlta
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_ProximasBajas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_ProximasBajas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CRED_Get_ProximasBajas] 
@CantidadDias int
as

select * into #tempUltimosPedidosDeAlta 
from dbo.CRED_PedidoAltaPersonas pedAltaPersonas
where CAST(FechaAlta as varchar) in 
(select CAST(MAX(FechaAlta) as varchar)
from dbo.CRED_PedidoAltaPersonas pedAltaPers2
where pedAltaPersonas.idpersona = pedAltaPers2.idpersona
group by idpersona)


declare @FechaDeVencimiento smalldatetime
set @FechaDeVencimiento = (select dateadd(d, @CantidadDias, GETDATE()))

SELECT 
		pers.Documento,
		pers.Apellido,
		pers.Nombres,
		asig_vence.Fecha FechaDeEntregaDeCredencial,
		ven.FechaVencimiento,
		doc_asig.FolioDesde + ''-'' + doc_asig.FolioHasta SeAsignoConElFolio,
		case when 
		asignaciones_posteriores.Id  is null then
			''NO''
		else ''SI''
		end TieneUnaCredencialAsignadaDespues,
		org.Descripcion Organismo
		
       
  FROM [dbo].[Cred_Vencimientos_Asignaciones] ven
  LEFT JOIN [dbo].[CRED_Asignaciones] asig_vence
	ON ven.IdAsignacion = asig_vence.Id
  LEFT JOIN [dbo].[CRED_Personas] pers
	ON pers.Id = asig_vence.IdPersona
  LEFT JOIN [dbo].[CRED_Documentos] doc_asig
    ON doc_asig.Id = asig_vence.IdDocumento
  LEFT JOIN [dbo].[CRED_Asignaciones] asignaciones_posteriores
    ON asignaciones_posteriores.IdPersona = asig_vence.IdPersona
    and asig_vence.Fecha < asignaciones_posteriores.Fecha
  LEFT JOIN [dbo].[CRED_Credenciales] cred
    ON cred.Id = asig_vence.IdCredencial
  LEFT JOIN #tempUltimosPedidosDeAlta pedAlta
	ON pedAlta.IdPersona = pers.Id
  LEFT JOIN [dbo].[CRED_Organismos] org
	ON org.Id = pedAlta.IdOrganismo
  WHERE  ven.FechaVencimiento < @FechaDeVencimiento and 
   cred.IdBaja is null 
   and asig_vence.IdBaja is null
  ORDER BY ven.FechaVencimiento ASC 
  
  Drop table #tempUltimosPedidosDeAlta

' 
END
GO
/****** Object:  View [dbo].[VW_Grados]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Grados]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_Grados]
AS SELECT [Tabla_Grados].[Id], [Tabla_Grados].[Grado]
FROM [Tabla_Grados]
where baja =0



'
GO
/****** Object:  View [dbo].[VW_tabla_Grados]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_tabla_Grados]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_tabla_Grados]
AS
SELECT  *
FROM dbo.tabla_Grados


where baja =0
'
GO
/****** Object:  UserDefinedFunction [dbo].[Fx_GET_DescGrado_Fecha]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Fx_GET_DescGrado_Fecha]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'CREATE FUNCTION [dbo].[Fx_GET_DescGrado_Fecha]  (@id_interna int, @fecha datetime)  
RETURNS   Varchar(5)  AS  
BEGIN 

Return (	SELECT TOP 1	TG.Grado
	FROM dbo.leg_desglose_NivelGrado NG
	INNER JOIN dbo.Tabla_Grados TG
		ON TG.id = NG.Id_Grado
	WHERE Id_interna = @Id_interna and  desde <=  @fecha
	Order by desde desc)


END





' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Grados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Grados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[GABM_Tabla_Grados]
	@Operacion char(1),
	@Id_1 	[int]=null,
	@Descripcion_2 	[varchar](5)=null

AS 
IF @operacion =''A''
BEGIN
	Declare @MAx [int]
	set @Max = (select max(id)+1 from dbo.Tabla_Grados)
	if @Max is null begin
		set @max=1
	end
	INSERT INTO dbo.Tabla_Grados 
		 ([Id],
		 [grado],
		Baja) 
 	VALUES 
		( @max,
		 @Descripcion_2,
		0)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_Grados
	set 	[grado] =  @Descripcion_2
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_Grados
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_Grados
	set 	baja =  0
	where 	id = @Id_1
END


IF @operacion =''S''
BEGIN
	SELECT	Id,
		grado Descripción,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja 
	FROM  dbo.Tabla_Grados
	WHERE (id = @ID_1) OR (@ID_1 is null)
	ORDER BY grado
END









' 
END
GO
/****** Object:  StoredProcedure [dbo].[GU_ADD_Factura_Guarderia]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GU_ADD_Factura_Guarderia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[GU_ADD_Factura_Guarderia]
	@id_interna int,
	@Periodo varchar(7),
	@Fecha_Factura datetime,
	@comprobante varchar(11),
	@CUIT varchar(11),
	@importe money,
	@Observaciones text,
	@Usuario smallint
as

INSERT INTO [dbo].[GU_Facturas_Guarderia]([id_interna], [Periodo], [Fecha_Factura], [comprobante], [CUIT], [importe], [Observaciones],Usuario,FechaCarga)
VALUES(	@id_interna,
	@Periodo,
	@Fecha_Factura,
	@comprobante,
	@CUIT,
	@importe,
	@Observaciones,
	@Usuario,
	Getdate())


' 
END
GO
/****** Object:  StoredProcedure [dbo].[GU_Verificar_Periodo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GU_Verificar_Periodo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[GU_Verificar_Periodo]
	@CUIT varchar(11),
	@periodo varchar(7)
as

Select periodo 
from dbo.GU_Facturas_Guarderia
where cuit = @cuit and periodo = @periodo




' 
END
GO
/****** Object:  StoredProcedure [dbo].[GU_Verificar_Comprobante]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GU_Verificar_Comprobante]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[GU_Verificar_Comprobante]
	@CUIT varchar(11),
	@Nro varchar(11)
as

Select periodo 
from dbo.GU_Facturas_Guarderia
where cuit = @cuit and comprobante = @nro




' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Antec_Militares]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Antec_Militares]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_ADD_Antec_Militares]
	(@Cumplido_1 	[varchar](20),
	 @Fuerza_Armada_2 	[varchar](3),
	 @Fecha_Baja_3 	[datetime],
	 @Causa_4 	[varchar](25),
	 @Cumplido_en_5 	[varchar](10),
	 @Exalumno_de_6 	[varchar](10),
	 @Nombre_Escuela_7 	[varchar](10),
	 @Paso_Reserva_8 	[varchar](25),
	 @Reserva_Perm_de_9 	[varchar](10),
	 @Años_Servicio_10 	[smallint],
	 @Meses_Servicio_11 	[smallint],
	 @Ultimo_Destino_12 	[varchar](30),
	 @Ultimo_Cargo_13 	[varchar](25),
	 @Grado_Reserva_14 	[varchar](25),
	 @Id_Interna_15 	[int],
	 @Legajo_16 	[int])

AS 
INSERT INTO [dbo].[Antec_Militares] 
	 ( [Cumplido],
	 [Fuerza_Armada],
	 [Fecha_Baja],
	 [Causa],
	 [Cumplido_en],
	 [Exalumno_de],
	 [Nombre_Escuela],
	 [Paso_Reserva],
	 [Reserva_Perm_de],
	 [Años_Servicio],
	 [Meses_Servicio],
	 [Ultimo_Destino],
	 [Ultimo_Cargo],
	 [Grado_Reserva],
	 [Id_Interna],
	 [Legajo]) 
 
VALUES 
	( @Cumplido_1,
	 @Fuerza_Armada_2,
	 @Fecha_Baja_3,
	 @Causa_4,
	 @Cumplido_en_5,
	 @Exalumno_de_6,
	 @Nombre_Escuela_7,
	 @Paso_Reserva_8,
	 @Reserva_Perm_de_9,
	 @Años_Servicio_10,
	 @Meses_Servicio_11,
	 @Ultimo_Destino_12,
	 @Ultimo_Cargo_13,
	 @Grado_Reserva_14,
	 @Id_Interna_15,
	 @Legajo_16)

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Antec_Militares]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Antec_Militares]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_UPD_Antec_Militares]
	 @Cumplido_3 	[varchar](20),
	 @Fuerza_Armada_4 	[varchar](3),
	 @Fecha_Baja_5 	[datetime],
	 @Causa_6 	[varchar](25),
	 @Cumplido_en_7 	[varchar](10),
	 @Exalumno_de_8 	[varchar](10),
	 @Nombre_Escuela_9 	[varchar](10),
	 @Paso_Reserva_10 	[varchar](25),
	 @Reserva_Perm_de_11 	[varchar](10),
	 @Años_Servicio_12 	[smallint],
	 @Meses_Servicio_13 	[smallint],
	 @Ultimo_Destino_14 	[varchar](30),
	 @Ultimo_Cargo_15 	[varchar](25),
	 @Grado_Reserva_16 	[varchar](25),
	 @Id_Interna_17 	[int],
	 @Legajo_18 	[int]

AS 

UPDATE [dbo].[Antec_Militares] 
SET  	[Cumplido]	 = @Cumplido_3,
	[Fuerza_Armada]	 = @Fuerza_Armada_4,
	[Fecha_Baja]	 = @Fecha_Baja_5,
	[Causa]	 = @Causa_6,
	[Cumplido_en]	 = @Cumplido_en_7,
	[Exalumno_de]	 = @Exalumno_de_8,
	[Nombre_Escuela]	 = @Nombre_Escuela_9,
	[Paso_Reserva]	 = @Paso_Reserva_10,
	[Reserva_Perm_de]	 = @Reserva_Perm_de_11,
	[Años_Servicio]	 = @Años_Servicio_12,
	[Meses_Servicio]	 = @Meses_Servicio_13,
	[Ultimo_Destino]	 = @Ultimo_Destino_14,
	[Ultimo_Cargo]	 = @Ultimo_Cargo_15,
	[Grado_Reserva]	 = @Grado_Reserva_16

WHERE   ( [Id_Interna] = @Id_Interna_17 AND  [Legajo]	= @Legajo_18)


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CON_MED_Tipo_Concepto_Licencias]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CON_MED_Tipo_Concepto_Licencias]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CON_MED_Tipo_Concepto_Licencias]
@operacion char(1) --A: Articulos, C: Conceptos
as

IF @operacion = ''A''
BEGIN
	select distinct nro_articulo from Tabla_Conceptos_Licencias 
	where baja = 0
	and licencia_medica = 1
END

IF @operacion = ''C''
BEGIN
	select distinct concepto from Tabla_Conceptos_Licencias 
	where baja = 0
	and licencia_medica = 1
END' 
END
GO
/****** Object:  StoredProcedure [dbo].[Web_GetSaldoSegunConceptoDeLicencia]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Web_GetSaldoSegunConceptoDeLicencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 15/04/2009
-- Description:	Devuelve los días correspondientes según un concepto de licencia
-- =============================================
CREATE PROCEDURE [dbo].[Web_GetSaldoSegunConceptoDeLicencia]
	@idConcepto int
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	SELECT
		dias_autorizados SaldoAnual,
		diasmensuales SaldoMensual
	FROM dbo.tabla_conceptos_licencias
	WHERE id_concepto = @idconcepto

END' 
END
GO
/****** Object:  View [dbo].[VW_Conceptos_Licencias]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Conceptos_Licencias]'))
EXEC dbo.sp_executesql @statement = N'CREATE   VIEW [dbo].[VW_Conceptos_Licencias]  
AS  
SELECT     Nro_Articulo, Concepto, Descripcion, Dias_Autorizados, id_Concepto, Es_Ordinaria, goce_haberes, Dias_Habiles,licencia_medica, acumulativa, anual  
FROM       dbo.Tabla_Conceptos_Licencias  
where		baja = 0'
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_ConceptoRelacionByName]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_ConceptoRelacionByName]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:FC
-- Create date: 11/08/2011
-- Description:	Trae una relacion por nombre
-- =============================================
CREATE PROCEDURE [dbo].[CRED_Get_ConceptoRelacionByName]
@conceptoRelacion varchar(30)
AS
BEGIN

select Id
from dbo.CRED_ConceptoRelacion
where dbo.CRED_ConceptoRelacion.Descripcion = @conceptoRelacion

END' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_ConceptoRelacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_ConceptoRelacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CRED_Get_ConceptoRelacion]
AS
BEGIN
	SELECT Id, Descripcion
	FROM dbo.CRED_ConceptoRelacion
END' 
END
GO
/****** Object:  StoredProcedure [dbo].[ESTR_GET_Dependencias_Area]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ESTR_GET_Dependencias_Area]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ESTR_GET_Dependencias_Area]
	@Codigo char(24)
AS

declare @Id int
set @id = (select distinct(id_area) from tabla_areas_estructura where codigo = @Codigo)

select * from tabla_areas_estructura
where id_area in (select * from dbo.Fx_Listar_Dependencias_Areas (@id))






' 
END
GO
/****** Object:  StoredProcedure [dbo].[GU_ADD_Recibos_Haberes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GU_ADD_Recibos_Haberes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE procedure [dbo].[GU_ADD_Recibos_Haberes]
	@Id_interna int,
	@Fecha datetime,
	@Monto varchar(6)

as

if exists (select id_interna from dbo.GU_Recibos_Haberes where id_interna = @id_interna) begin
		update dbo.GU_Recibos_Haberes
		set fecha = @fecha,
		    monto =@monto
		where id_interna = @id_interna
	end

else
	begin
		insert into dbo.GU_Recibos_Haberes
		values (@id_interna,@fecha,@monto)
	end
	







' 
END
GO
/****** Object:  StoredProcedure [dbo].[GU_GET_Recibos_Haberes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GU_GET_Recibos_Haberes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[GU_GET_Recibos_Haberes]
	@Id_interna int
as
SELECT fecha,monto
FROM dbo.GU_Recibos_Haberes
where id_interna = @id_interna



' 
END
GO
/****** Object:  StoredProcedure [dbo].[ABM_Resoluciones_Contratos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ABM_Resoluciones_Contratos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE  Procedure [dbo].[ABM_Resoluciones_Contratos]
	@Operacion as smallint,
	@id smallint,
	@Descripcion varchar(50)=null,
	@Tipo_Contrato smallint=null,
	@montodesde money=null,
	@montohasta money=null
as
--ALTA
if @operacion =1 begin
	set @id = (select max(id)+1 from  dbo.Tabla_Resoluciones_Contratos)
	if @id is null begin
		set @id =1
	end
	insert into dbo.Tabla_Resoluciones_Contratos
	(id,descripcion,tipo_contrato,monto_desde,monto_hasta)
	values (@id,@descripcion,@tipo_contrato,@montodesde, @montohasta)
end

--MODIFICA
If @operacion =2 begin
	update dbo.Tabla_Resoluciones_Contratos
	set 	descripcion = @descripcion,
		tipo_contrato = @tipo_Contrato,
		monto_desde = @montodesde,
		monto_hasta = @montohasta
	where id = @id
end

IF @Operacion =3 begin
	update dbo.Tabla_Resoluciones_Contratos
	set 	Baja = 1
	where id = @id

end





' 
END
GO
/****** Object:  View [dbo].[VW_Resol_Cont]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Resol_Cont]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_Resol_Cont]
as
select * from tabla_resoluciones_contratos
where id=2

'
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Modalidad_Contrato]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Modalidad_Contrato]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CTR_GET_Modalidad_Contrato]
@Id_Contrato int
as
select tipo_contrato 
from dbo.Tabla_Resoluciones_Contratos
where id=@Id_Contrato

' 
END
GO
/****** Object:  View [dbo].[VW_Tabla_Resoluciones_Contratos]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Resoluciones_Contratos]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_Tabla_Resoluciones_Contratos]
as
SELECT Id,Descripcion
FROM dbo.Tabla_Resoluciones_Contratos

'
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Nacionalidad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Nacionalidad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GABM_Tabla_Nacionalidad]
	@Operacion char(1),
	@Id_1 	[int]=null,
	@Descripcion_2 	[varchar](30)=null,
	@Naturaliza bit=null

AS 
IF @operacion =''A''
BEGIN
	Declare @MAx [int]
	set @Max = (select max(id)+1 from dbo.Tabla_Nacionalidad)
	if @Max is null begin
		set @max=1
	end
	INSERT INTO dbo.Tabla_Nacionalidad 
		 ([Id],
		 [Descripcion],
		 naturaliza ,
		Baja) 
 	VALUES 
		( @max,
		 @Descripcion_2,
		@Naturaliza,
		0)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_Nacionalidad
	set 	[Descripcion] =  @Descripcion_2,
		naturaliza = @Naturaliza
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_Nacionalidad
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_Nacionalidad
	set 	baja =  0
	where 	id = @Id_1
END


IF @operacion =''S''
BEGIN
	SELECT	Id,
		descripcion Descripción,
		case when naturaliza = 1 then
			''Si''
		else
			''No''
		end Naturaliza, 
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja 
	FROM  dbo.Tabla_Nacionalidad
	WHERE (id = @ID_1) OR (@ID_1 is null)
	ORDER BY descripcion
END









' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetID_Nacionalidad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetID_Nacionalidad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[GetID_Nacionalidad] 
	@Nacio varchar(50)

AS

select id from [dbo].tabla_nacionalidad 
where descripcion = @Nacio


' 
END
GO
/****** Object:  View [dbo].[VW_Nacionalidades]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Nacionalidades]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_Nacionalidades]
AS
SELECT     TOP 100 PERCENT *
FROM         dbo.Tabla_Nacionalidad
WHERE     (Baja = 0)
ORDER BY Arg DESC, Descripcion

'
GO
/****** Object:  StoredProcedure [dbo].[GET_Nacionalidad_ABM]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GET_Nacionalidad_ABM]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GET_Nacionalidad_ABM] 

@desc [varchar](50)

AS

select descripcion 
from dbo.tabla_nacionalidad 
where descripcion = @desc
' 
END
GO
/****** Object:  View [dbo].[VW_Tabla_Nacionalidad]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Nacionalidad]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_Tabla_Nacionalidad]
AS
SELECT  *
FROM Tabla_Nacionalidad


where baja =0
'
GO
/****** Object:  StoredProcedure [dbo].[CRED_Ins_Bajas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Ins_Bajas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:FC
-- Create date: 05/09/2011
-- Descripción:	Inserta nuevas bajas.
-- =============================================
CREATE procedure [dbo].[CRED_Ins_Bajas]
@Fecha smalldatetime,
@IdDocumento smallint,
@Motivo varchar(30),
@IdAutorizante int,
@IdUsuario smallint
as

insert into dbo.CRED_Bajas (Fecha, IdDocumento, Motivo, IdAutorizante, IdUsuario)
values (@Fecha,@IdDocumento,@Motivo,@IdAutorizante, @IdUsuario)

select SCOPE_IDENTITY()
' 
END
GO
/****** Object:  StoredProcedure [dbo].[GU_ADD_Cert_Nacimiento]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GU_ADD_Cert_Nacimiento]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[GU_ADD_Cert_Nacimiento]
	@Id_Interna int,
	@Id_Fam int,
	@Certificado bit
as
IF exists(select id_interna from dbo.GU_Cert_Nacimiento where id_interna = @id_Interna and id_fam = @id_fam) 
  BEGIN
	if @Certificado =0 begin
		delete from dbo.GU_Cert_Nacimiento
		where id_interna = @id_interna and id_fam = @id_fam
	end
  END
ELSE
  BEGIN
	DECLARE @ID int
	SET @id = (select max(id)+1 from dbo.GU_Cert_Nacimiento)
	IF @id is null BEGIN
		SET @id = 1
	END
	INSERT into dbo.GU_Cert_Nacimiento
	values (@id_interna,@id_fam,@id)
  END 










' 
END
GO
/****** Object:  StoredProcedure [dbo].[GU_GET_Cert_Nacimiento]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GU_GET_Cert_Nacimiento]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[GU_GET_Cert_Nacimiento]
	@Id_Interna int,
	@Id_Fam int
AS

SELECT id from dbo.GU_Cert_Nacimiento
where id_interna =@id_interna and
	id_fam= @id_fam


' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_GET_Tipo_Liquidacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_GET_Tipo_Liquidacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[PLA_GET_Tipo_Liquidacion]

as

Select * from dbo.PLA_Tipo_Liquidacion' 
END
GO
/****** Object:  StoredProcedure [dbo].[GU_Verificar_Existencia_CUIT]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GU_Verificar_Existencia_CUIT]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[GU_Verificar_Existencia_CUIT]
	@CUIT varchar (11)
as
SELECT distinct guarderia,calle,nro,piso,dpto,cp,localidad,telefono
FROM dbo.GU_DDJJ_Guarderia
where cuit = @cuit




' 
END
GO
/****** Object:  StoredProcedure [dbo].[GU_GET_Datos_Guarderia]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GU_GET_Datos_Guarderia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[GU_GET_Datos_Guarderia]
	@id_interna int,
	@id_Fam int
as

SELECT  [Guarderia], 
	[Horario], 
	[CUIT], 
	FECHA,
	[Calle], 
	[Nro], 
	[Piso], 
	[Dpto], 
	[CP], 	
	[Localidad], 
	[Telefono] 
FROM [dbo].[GU_DDJJ_Guarderia]
where id_interna = @id_interna and id_fam = @id_Fam




' 
END
GO
/****** Object:  View [dbo].[VW_Usuarios]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Usuarios]'))
EXEC dbo.sp_executesql @statement = N'

CREATE  VIEW [dbo].[VW_Usuarios]
AS SELECT [Id]
FROM dbo.RH_Usuarios
where baja =0


'
GO
/****** Object:  StoredProcedure [dbo].[VBaja_Usuarios]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[VBaja_Usuarios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[VBaja_Usuarios]
	@usuario int,
	@baja [bit]
AS

if @baja = 1 begin
	update dbo.RH_Usuarios
		set baja =1,
		     fecha_baja =getdate()
	where id = @usuario
end


if @baja = 0 begin
	update dbo.RH_usuarios
		set baja =0,
		     fecha_baja =NULL
	where id = @usuario
end

' 
END
GO
/****** Object:  StoredProcedure [dbo].[Validar_User]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Validar_User]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[Validar_User]  
 @Usuario char(20)  
AS  
  
declare @usua int
SET @usua = (select top 1 isnull(id,0) 
from dbo.RH_Usuarios  
where nombre = @usuario)


select  id,  
 password,  
 vence_passw,  
 baja,  
 actualizar_passw,  
 administrador,  
 fecha_baja   
from dbo.RH_Usuarios  
where nombre = @usuario  
  

IF (@usua > 0)
BEGIN
	INSERT INTO dbo.Log_RRHH values (@usua, getdate())
END' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_UPD_Password_User]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_UPD_Password_User]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE procedure [dbo].[RH_UPD_Password_User]
	@usuario int,
	@passw char(60)
AS

UPDATE dbo.RH_Usuarios
SET 	password = ltrim(rtrim(@passw)),
	vence_passw =  convert(char(10),getdate()+90,103),
	actualizar_passw =0
WHERE id = @usuario












' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetExamenPsicofisico]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetExamenPsicofisico]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GetExamenPsicofisico]
	@id [int]
 AS

SELECT *
FROM [dbo].Psicofisico
where id_Psicofisico = @id






' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Examenes_Psicofisicos]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Examenes_Psicofisicos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[RPT_LEG_Examenes_Psicofisicos]
	@id_interna int
as
SELECT	Jurisdiccion,
	Organismo,
	Fecha,
	Motivo,
	Resultado,
	Org_Expidió,
	Folio_Nro
FROM dbo.Psicofisico
WHERE 	Id_Interna = @id_interna AND
	DatoDeBaja =0 AND
	DatoNoImprime =0





' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Psicofisico]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Psicofisico]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[LEG_UPD_Psicofisico]
		(@Jurisdiccion_1 [varchar](50),
	 @Organismo_2 	[varchar](50),
	 @Fecha_3 	[smalldatetime],
	 @Motivo_4 	[varchar](50),
	 @Resultado_5 	[varchar](100),
	 @Org_Expidió_6 [varchar](50),
	 @Folio_Nro_7 	[char](10),
	 @Id_Interna_8 	[int],
	 @Id_Psicofisico_9 [int],
         @DatoDeBaja bit,
	@DatoNoImprime bit)


AS UPDATE [dbo].[Psicofisico] 

SET  [Jurisdiccion]	 = @Jurisdiccion_1,
	 [Organismo]	 = @Organismo_2,
	 [Fecha]	 = @Fecha_3,
	 [Motivo]	 = @Motivo_4,
	 [Resultado]	 = @Resultado_5,
	 [Org_Expidió]	 = @Org_Expidió_6,
	 [Folio_Nro]	 = @Folio_Nro_7,
	 [Id_Interna]	 = @Id_Interna_8,
         DatoDeBaja = @DatoDeBaja,
	 DatoNoImprime = @DatoNoImprime

WHERE 
	([Id_Psicofisico]	 = @Id_Psicofisico_9 )



' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Psicofisico]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Psicofisico]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[LEG_ADD_Psicofisico]
	(@Jurisdiccion_1 	[varchar](50),
	 @Organismo_2 	[varchar](50),
	 @Fecha_3 	[smalldatetime],
	 @Motivo_4 	[varchar](50),
	 @Resultado_5 	[varchar](100),
	 @Org_Expidió_6 	[varchar](50),
	 @Folio_Nro_7 	[char](10),
	 @Id_Interna_8 	[int],
	@datodebaja bit,
	@datoNoImprime bit)

AS

DECLARE	 @Id_Psicofisico_9 [int]
SET  @Id_Psicofisico_9 = (select max(Id_Psicofisico)+1 from dbo.Psicofisico)		
IF @Id_Psicofisico_9 is null BEGIN
	set @Id_Psicofisico_9 =1
END

INSERT INTO [dbo].[Psicofisico] 
	 ( [Jurisdiccion],
	 [Organismo],
	 [Fecha],
	 [Motivo],
	 [Resultado],
	 [Org_Expidió],
	 [Folio_Nro],
	 [Id_Interna],
	 [Id_Psicofisico],
	DatoDeBaja,
	DatoNoImprime) 
 
VALUES 
	( @Jurisdiccion_1,
	 @Organismo_2,
	 @Fecha_3,
	 @Motivo_4,
	 @Resultado_5,
	 @Org_Expidió_6,
	 @Folio_Nro_7,
	 @Id_Interna_8,
	 @Id_Psicofisico_9,
	@DatoDeBaja,
	@DatoNoImprime)


' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Update_Personas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Update_Personas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CRED_Update_Personas]
@IdPersona int,
@TipoCredencialAsignable smallint
as

update dbo.CRED_CredencialesAsignablesAPersonas
set IdTipoCredencial = @TipoCredencialAsignable
where IdPersona = @IdPersona' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetEstudios_Realizados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetEstudios_Realizados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE  PROCEDURE [dbo].[GetEstudios_Realizados]
	 --@Id_Interna_10	[int],
	 --modificado LMY 17/11/2009
	 @Id_Interna_10	[int]=null,
	 @Nro_Doc_11 	[int],
	 @Nivel [smallint]=null

AS 
Select * from [dbo].Estudios_Realizados 
where  ([Id_Interna] =  @Id_Interna_10  or [Nro_Doc] = @Nro_Doc_11) AND ([Nivel] = @Nivel or @nivel is null)
and datodebaja=0

' 
END
GO
/****** Object:  StoredProcedure [dbo].[Alta_Estudios_Realizados]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Alta_Estudios_Realizados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[Alta_Estudios_Realizados]
	(@Nivel_1 	[smallint],
	 @Certificado_Expedido_por_2 	[nvarchar](50),
	 @Fecha_3 	[datetime],
	 @Fecha_4        [datetime],
	 @Facultad_4 	[varchar](50),
	 @Depende_de_5 	[varchar](50),
	 @Titulo_6 	[varchar](50),
	 @Exped_Revalid_Por_7 	[varchar](50),
	 @Matricula_Nro_8 	[nvarchar](50),
	 @Folio_Nro_9 	[char](10),
	 @Id_Interna_10 	[int],
	 @Nro_Doc_11 	[int],
	 @Cant_Materias_Totales_12 	[smallint],
	 @Cant_Materias_Aprob_13 	[char](10),
	@id_establecimiento [int],
	@Completo [bit],
	@datodebaja bit,
	@datonoimprime bit)

AS 

Declare  @id_estudio int
set @id_estudio =(select max(id_estudio)+1 from [dbo].estudios_realizados) -- where id_interna = @id_interna_10 and Nro_Doc=@Nro_Doc_11)

if @id_estudio is null begin
	set @id_estudio =1
end


INSERT INTO dbo.Estudios_Realizados 
	 ( [Nivel],
	 [Certificado_Expedido_por],
	 [Fecha_Ingreso],
	 [Fecha_Egreso],
	 [Facultad],
	 [Depende_de],
	 [Titulo],
	 [Exped_Revalid_Por],
	 [Matricula_Nro],
	 [Folio_Nro],
	 [Id_Interna],
	 [Nro_Doc],
	 [Cant_Materias_Totales],
	 [Cant_Materias_Aprob],
	id_establecimiento,
	id_estudio,
	completo,
	datodebaja,
	datonoimprime) 
 
VALUES 
	( @Nivel_1,
	 @Certificado_Expedido_por_2,
	 @Fecha_3,
	 @Fecha_4,
	 @Facultad_4,
	 @Depende_de_5,
	 @Titulo_6,
	 @Exped_Revalid_Por_7,
	 @Matricula_Nro_8,
	 @Folio_Nro_9,
	 @Id_Interna_10,
	 @Nro_Doc_11,
	 @Cant_Materias_Totales_12,
	 @Cant_Materias_Aprob_13,
	@id_establecimiento,
	@id_estudio,
	@completo,
	@datodebaja,
	@datonoimprime)

select @id_estudio id_estudio

' 
END
GO
/****** Object:  StoredProcedure [dbo].[update_Estudios_Realizados]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[update_Estudios_Realizados]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[update_Estudios_Realizados]
	(@Nivel_16 	[smallint],
	 @id_establecimiento_17 	[int],
	 @Certificado_Expedido_por_18 	[varchar](50),
	 @Fecha_Ingreso_19 	[datetime],
	 @Fecha_Egreso_20 	[datetime],
	 @Facultad_21 	[varchar](50),
	 @Depende_de_22 	[varchar](50),
	 @Titulo_23 	[varchar](50),
	 @Exped_Revalid_Por_24 	[varchar](50),
	 @Matricula_Nro_25 	[varchar](50),
	 @Folio_Nro_26 	[char](10),
	 @Id_Interna_27 	[int],
	 @Nro_Doc_28 	[int],
	 @Cant_Materias_Totales_29 	[smallint],
	 @Cant_Materias_Aprob_30 	[char](10),
	@id_estudio [int],
	@completo [bit],
	@datodebaja bit,
	@datonoimprime bit)

AS UPDATE [dbo].[Estudios_Realizados] 

SET  
	 [id_establecimiento]	 = @id_establecimiento_17,
	 [Certificado_Expedido_por]	 = @Certificado_Expedido_por_18,
	 [Fecha_Ingreso]	 = @Fecha_Ingreso_19,
	 [Fecha_Egreso]	 = @Fecha_Egreso_20,
	 [Facultad]	 = @Facultad_21,
	 [Depende_de]	 = @Depende_de_22,
	 [Titulo]	 = @Titulo_23,
	 [Exped_Revalid_Por]	 = @Exped_Revalid_Por_24,
	 [Matricula_Nro]	 = @Matricula_Nro_25,
	 [Folio_Nro]	 = @Folio_Nro_26,
	 [Cant_Materias_Totales]	 = @Cant_Materias_Totales_29,
	 [Cant_Materias_Aprob]	 = @Cant_Materias_Aprob_30,
	completo = @completo,
	datodebaja=@datodebaja,
	datonoimprime= @datonoimprime

WHERE 
	( [Nivel]	 = @Nivel_16 AND [Id_Interna]	 = @Id_Interna_27 and id_estudio = @id_estudio  )



' 
END
GO
/****** Object:  StoredProcedure [dbo].[CAlta_TMP_Fac_Cont]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CAlta_TMP_Fac_Cont]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CAlta_TMP_Fac_Cont]

@doc int,
@id_cont int,
@sec int,
@dep int,
@firma int,
@envia varchar(20),
@recibe varchar(20),
@f_envia smalldatetime,
@f_recibe smalldatetime

AS

insert into tmp_facturacion_contrato (legajo,id_contrato,id_sec,id_dep,id_firma,envio,recibio,fecha_envio,fecha_recibida) values (@doc,@id_cont,@sec,@dep,@firma, @envia,@recibe,@f_envia,@f_recibe)
' 
END
GO
/****** Object:  View [dbo].[VW_tabla_agrupamiento]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_tabla_agrupamiento]'))
EXEC dbo.sp_executesql @statement = N'

CREATE  VIEW [dbo].[VW_tabla_agrupamiento]
AS
SELECT  top 100 percent *
FROM dbo.tabla_agrupamiento

where baja =0
Order by Descripcion

'
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Agrupamientos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Agrupamientos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[GABM_Tabla_Agrupamientos]
	@Operacion char(1),
	@Id_1 	[int]=null,
	@Descripcion_2 	[varchar](20)=null

AS 
IF @operacion =''A''
BEGIN
	Declare @MAx [int]
	set @Max = (select max(id)+1 from dbo.Tabla_Agrupamiento)
	if @Max is null begin
		set @max=1
	end
	INSERT INTO dbo.Tabla_Agrupamiento
		 ([Id],
		 [Descripcion],
		Baja) 
 	VALUES 
		( @max,
		 @Descripcion_2,
		0)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_Agrupamiento
	set 	[Descripcion] =  @Descripcion_2
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_Agrupamiento
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_Agrupamiento
	set 	baja =  0
	where 	id = @Id_1
END

IF @operacion =''S''
BEGIN
	SELECT	Id,
		descripcion Descripción,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja 
	FROM  dbo.Tabla_Agrupamiento
	WHERE (id = @ID_1) OR (@ID_1 is null)
	ORDER BY descripcion
END









' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_Barrios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_Barrios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CRED_Get_Barrios]
AS
BEGIN
	SELECT distinct(barrio) barrio
	FROM dbo.CRED_Domicilios
END' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Otros_Indice_Documentos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Otros_Indice_Documentos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[LEG_UPD_Otros_Indice_Documentos]
	(@Jurisdicción_1 	[varchar](50),
	 @Organismo_2 	[varchar](50),
	 @Tipo_3 	[varchar](50),
	 @Foja_4 	[char](10),
	 @Fecha_Agregado_5 	[smalldatetime],
	 @Agr_Intervino_6 	[nvarchar](25),
	 @Des_Fecha_7 	[smalldatetime],
	 @Des_Intervino_8 	[varchar](50),
	 @Id_Interna_9 	[int],
	 @Legajo_10 	[int],
--	@id [smallint],
	@id [int],
	@datodebaja bit,
	@datonoimprime bit)

AS 

update [dbo].[Otros_Indice_Documentos] 
set 	 [Jurisdicción]=@Jurisdicción_1,
	 [Organismo]=@Organismo_2,
	 [Tipo]=@Tipo_3,
	 [Foja]=@Foja_4,
	 [Fecha_Agregado]=@Fecha_Agregado_5,
	 [Agr_Intervino]=@Agr_Intervino_6,
	 [Des_Fecha]=@Des_Fecha_7,
	 [Des_Intervino]=@Des_Intervino_8,
	datodebaja = @datodebaja,
	datonoimprime =	@datonoimprime
	
where id = @id and id_interna = @Id_Interna_9


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Otros_Indice_Documentos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Otros_Indice_Documentos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_GET_Otros_Indice_Documentos]
	 @Id_Interna	[int],
	 @Legajo 	[int]

AS 
select 	 [Jurisdicción],
	 [Organismo],
	 [Tipo],
	 [Foja],
	 [Fecha_Agregado],
	 [Agr_Intervino],
	 [Des_Fecha],
	 [Des_Intervino],
	id,
	datodebaja,
	datonoimprime

from [dbo].[Otros_Indice_Documentos] 

where (id_interna = @Id_Interna or legajo = @Legajo) and datodebaja=0
order by Foja




' 
END
GO
/****** Object:  StoredProcedure [dbo].[Eliminar_Otros_Documentos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Eliminar_Otros_Documentos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[Eliminar_Otros_Documentos]
	@id_interna [int],
	@id [int]


as

delete from dbo.Otros_Indice_Documentos
where Id_Interna = @id_interna and Id = @id


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Otros_Indice_Documentos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Otros_Indice_Documentos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



CREATE  PROCEDURE [dbo].[LEG_ADD_Otros_Indice_Documentos]
	(@Jurisdicción_1 	[varchar](50),
	 @Organismo_2 	[varchar](50),
	 @Tipo_3 	[varchar](50),
	 @Foja_4 	[char](10),
	 @Fecha_Agregado_5 	[datetime],
	 @Agr_Intervino_6 	[varchar](25),
	 @Des_Fecha_7 	[datetime],
	 @Des_Intervino_8 	[varchar](50),
	 @Id_Interna_9 	[int],
	 @Legajo_10 	[int],
	@datodebaja bit,
	@datonoimprime bit)

AS 
declare @id int
set @id = (select max(id)+1 from [dbo].[Otros_Indice_Documentos]  where id_interna = @Id_Interna_9 )

if @id is null begin
	set @id =1
end

INSERT INTO [dbo].[Otros_Indice_Documentos] 
	 ( [Jurisdicción],
	 [Organismo],
	 [Tipo],
	 [Foja],
	 [Fecha_Agregado],
	 [Agr_Intervino],
	 [Des_Fecha],
	 [Des_Intervino],
	 [Id_Interna],
	 [Legajo],
	id,
	datodebaja,
	datonoimprime)
 
 
VALUES 
	( @Jurisdicción_1,
	 @Organismo_2,
	 @Tipo_3,
	 @Foja_4,
	 @Fecha_Agregado_5,
	 @Agr_Intervino_6,
	 @Des_Fecha_7,
	 @Des_Intervino_8,
	 @Id_Interna_9,
	 @Legajo_10,
	@id,
	@datodebaja,
	@datonoimprime)


' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_ADD_Enfermedades_Preexistentes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_ADD_Enfermedades_Preexistentes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
create procedure [dbo].[MED_ADD_Enfermedades_Preexistentes]
	@Nro_Documento int,
	@Enfermedad int
as

INSERT INTO dbo.MED_Enfermedades_Preexistentes
(Nro_Documento,Enfermedad)
VALUES
(@Nro_Documento,@Enfermedad)


' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_DEL_Usuarios_Modulos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_DEL_Usuarios_Modulos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE PROCEDURE [dbo].[RH_DEL_Usuarios_Modulos]
	@id_usuario_1 [int]
AS

DELETE FROM [dbo].[Usuarios_Modulos] 
WHERE id_usuario = @id_usuario_1



' 
END
GO
/****** Object:  StoredProcedure [dbo].[Cred_Ins_Usuarios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Cred_Ins_Usuarios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'Create procedure [dbo].[Cred_Ins_Usuarios]
@Nombre varchar(30),
@Nick varchar(20),
@Clave varchar(200)
AS

BEGIN

INSERT INTO dbo.CRED_Usuarios(Nombre,Nick,Clave)
values (@Nombre,@Nick,@Clave)

END




' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_usuarios]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_usuarios]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CRED_Get_usuarios]
as

select Idusuario, Nombre, Nick, Clave
from dbo.CRED_usuarios' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Upd_Usuario]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Upd_Usuario]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CRED_Upd_Usuario]
@Nick varchar(20),
@Nombre varchar(30),
@Clave varchar(200)
as

update dbo.cred_usuarios
set Nombre = @Nombre,
Clave = @Clave
where Nick = @Nick
' 
END
GO
/****** Object:  StoredProcedure [dbo].[SEG_Get_Tipos_Seguros]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[SEG_Get_Tipos_Seguros]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[SEG_Get_Tipos_Seguros] AS

declare @cant int

set @cant = (select count(*) from dbo.TABLA_CONCEPTOS_RECIBOS WHERE Seguro = 1)

SELECT @cant cantidad, id, codigo FROM dbo.TABLA_CONCEPTOS_RECIBOS WHERE Seguro = 1
ORDER BY codigo
' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Regimen_Escalafonario]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Regimen_Escalafonario]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[GABM_Tabla_Regimen_Escalafonario]
	@Operacion char(1),
	@Id_1 	[int]=null,
	@Descripcion_2 	[varchar](30)=null

AS 
IF @operacion =''A''
BEGIN
	Declare @MAx [int]
	set @Max = (select max(id)+1 from dbo.Tabla_Regimen_Escalafonario)
	if @Max is null begin
		set @max=1
	end
	INSERT INTO dbo.Tabla_Regimen_Escalafonario 
		 ([Id],
		 regimen,
 		 Baja) 
 	VALUES 
		( @max,
		 @Descripcion_2,
		0)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_Regimen_Escalafonario
	set 	Regimen =  @Descripcion_2
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_Regimen_Escalafonario
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_Regimen_Escalafonario
	set 	baja =  0
	where 	id = @Id_1
END


IF @operacion =''S''
BEGIN
	SELECT	Id,
		Regimen Descripción,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja 
	FROM  dbo.Tabla_Regimen_Escalafonario
	WHERE (id = @ID_1) OR (@ID_1 is null)
	ORDER BY Regimen
END









' 
END
GO
/****** Object:  View [dbo].[VW_tabla_regimen_escalafonario]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_tabla_regimen_escalafonario]'))
EXEC dbo.sp_executesql @statement = N'

CREATE  VIEW [dbo].[VW_tabla_regimen_escalafonario]
AS
SELECT  top 100 percent *
FROM dbo.tabla_regimen_escalafonario
where baja =0
order by regimen



'
GO
/****** Object:  StoredProcedure [dbo].[Alta_Licencias]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Alta_Licencias]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[Alta_Licencias]
	(@Jurisdicción_1 	[nvarchar](50),
	 @Organismo_2 	[nvarchar](50),
	 @Año_3 	[smallint],
	 @Lic_Ord_Dias_4 	[smallint],
	 @Lic_Ord_Año_5 	[smallint],
	 @Licencia_Especial_Concepto_6 	[nvarchar](25),
	 @Licencia_Especial_Motivo_7 	[nvarchar](100),
	 @Lic_Esp_Diías_8 	[smallint],
	 @Regimen_Tipo_9 	[nvarchar](25),
	 @Regimen_Nro_10 	[nvarchar](15),
	 @Id__Interna_11 	[int],
	@folio [char](10),
	@Legajo [int],@Datodebaja bit,
	@datonoimprime bit)

AS 
declare @id [smallint]
set @id = (select max(id)+1 from dbo.Licencias )

if @id is null begin
	set @id =1
end

INSERT INTO dbo.Licencias
	 ( [Jurisdicción],
	 [Organismo],
	 [Año],
	 [Lic_Ord_Dias],
	 [Lic_Ord_Año],
	 [Licencia_Especial_Concepto],
	 [Licencia_Especial_Motivo],
	 [Lic_Esp_Dias],
	 [Regimen_Tipo],
	 [Regimen_Nro],
	 [Id_Interna],
	folio,
	legajo,
	id, DATODEBAJA,
	DATONOIMPRIME) 
 
VALUES 
	( @Jurisdicción_1,
	 @Organismo_2,
	 @Año_3,
	 @Lic_Ord_Dias_4,
	 @Lic_Ord_Año_5,
	 @Licencia_Especial_Concepto_6,
	 @Licencia_Especial_Motivo_7,
	 @Lic_Esp_Diías_8,
	 @Regimen_Tipo_9,
	 @Regimen_Nro_10,
	 @Id__Interna_11,
	@folio,
	@Legajo,
	@id, @DATODEBAJA,
	@DATONOIMPRIME )

' 
END
GO
/****** Object:  StoredProcedure [dbo].[Update_Licencias]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Update_Licencias]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[Update_Licencias]
	(@Jurisdicción_1 	[nvarchar](50),
	 @Organismo_2 	[nvarchar](50),
	 @Año_3 	[smallint],
	 @Lic_Ord_Dias_4 	[smallint],
	 @Lic_Ord_Año_5 	[smallint],
	 @Licencia_Especial_Concepto_6 	[nvarchar](25),
	 @Licencia_Especial_Motivo_7 	[nvarchar](100),
	 @Lic_Esp_Diías_8 	[smallint],
	 @Regimen_Tipo_9 	[nvarchar](25),
	 @Regimen_Nro_10 	[nvarchar](15),
	 @Id__Interna_11 	[int],
	@folio [char](10),
	@Legajo [int],@Datodebaja bit,
	@datonoimprime bit,
	@id [smallint])

AS 
update dbo.Licencias
set	 [Jurisdicción]=@Jurisdicción_1,
	 [Organismo]=@Organismo_2,
	 [Año]=@Año_3,
	 [Lic_Ord_Dias]=@Lic_Ord_Dias_4,
	 [Lic_Ord_Año]=@Lic_Ord_Año_5,
	 [Licencia_Especial_Concepto]=@Licencia_Especial_Concepto_6,
	 [Licencia_Especial_Motivo]=@Licencia_Especial_Motivo_7,
	 [Lic_Esp_Dias]=@Lic_Esp_Diías_8,
	 [Regimen_Tipo]=@Regimen_Tipo_9,
	 [Regimen_Nro]=@Regimen_Nro_10,
	folio=@folio, datodebaja = @datodebaja,
	datonoimprime = @datonoimprime
 
where  id= @id and   [Id_Interna]= @Id__Interna_11

' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Licencias]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Licencias]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[ASIS_GET_Licencias]
	 @Id__Interna_11 	[int],
	@Legajo 	[int]
AS 
select * from [dbo].Licencias 
where (id_interna = @Id__Interna_11 or  legajo  = @Legajo) and datodebaja = 0
' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Tratamientos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Tratamientos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[GABM_Tabla_Tratamientos]
	@Operacion char(1),
	@Id_1 	[int]=null,
	@Descripcion_2 	[varchar](10)=null,
	@Tipo char(1)=null
AS 
IF @operacion =''A''
BEGIN
	Declare @MAx [int]
	set @Max = (select max(id)+1 from dbo.Tabla_Tratamientos)
	if @Max is null begin
		set @max=1
	end
	INSERT INTO dbo.Tabla_Tratamientos 
		 ([Id],
		 [Descripcion],
		Baja,
		Tipo) 
 	VALUES 
		( @max,
		 @Descripcion_2,
		0,
		@Tipo)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_Tratamientos
	set 	[Descripcion] =  @Descripcion_2,
		Tipo = @Tipo
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_Tratamientos
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_Tratamientos
	set 	baja =  0
	where 	id = @Id_1
END


IF @operacion =''S''
BEGIN
	SELECT	Id,
		descripcion Descripción,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja,
		CASE 
			WHEN TIpo = ''A'' THEN ''Areas''
			WHEN TIpo = ''P'' THEN ''Personas''
			WHEN TIpo = ''F'' THEN ''Funciones Ejecutivas''
		END Tipo
	FROM  dbo.Tabla_Tratamientos
	WHERE (id = @ID_1) OR (@ID_1 is null)
	ORDER BY descripcion
END









' 
END
GO
/****** Object:  View [dbo].[VW_Tabla_Tratamientos_FE]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Tratamientos_FE]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_Tabla_Tratamientos_FE]

As
SELECT id, descripcion
FROM dbo.tabla_Tratamientos
WHERE baja =0 and tipo = ''F''

'
GO
/****** Object:  View [dbo].[VW_Tabla_Tratamientos_Areas]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Tratamientos_Areas]'))
EXEC dbo.sp_executesql @statement = N'

CREATE view [dbo].[VW_Tabla_Tratamientos_Areas]
AS
Select id, descripcion
from dbo.tabla_Tratamientos
where baja =0 and tipo = ''A''


'
GO
/****** Object:  View [dbo].[VW_Tabla_Tratamientos_Personas]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Tratamientos_Personas]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_Tabla_Tratamientos_Personas]
AS
Select id, descripcion
from dbo.tabla_Tratamientos
where baja =0 and tipo = ''P''


'
GO
/****** Object:  StoredProcedure [dbo].[LEG_DEL_ObraSocial]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_DEL_ObraSocial]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


create procedure [dbo].[LEG_DEL_ObraSocial]
@id int,
@usuarioProceso int
AS
UPDATE dbo.LEG_ObraSocial 
SET	bBaja = 1,
	usuarioProceso = @usuarioProceso,
	fhProceso= getdate()
WHERE id = @id

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_ObraSocial_HabilitadaReciboHaberes]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_ObraSocial_HabilitadaReciboHaberes]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

create procedure [dbo].[LEG_UPD_ObraSocial_HabilitadaReciboHaberes]
@id int,
@usuarioProceso int
AS
UPDATE dbo.LEG_ObraSocial 
SET	Habilitada_ReciboHaberes = 1,
	usuarioProceso = @usuarioProceso,
	fhProceso= getdate()
WHERE id = @id

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_ObraSocial]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_ObraSocial]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


create procedure [dbo].[LEG_ADD_ObraSocial]
@documento int,
@idObraSocial smallint,
@nroAfiliado varchar(30),
@fhDesde smalldatetime,
@folio char(10),
@usuarioProceso int
AS
INSERT INTO dbo.LEG_ObraSocial 
	(Documento ,
	idObraSocial,
	nroAfiliado ,
	fhDesde ,
	folio ,
	usuarioProceso,
	fhProceso)
VALUES (@Documento, @idObraSocial, @nroAfiliado, @fhDesde, @Folio,@usuarioProceso, getdate())

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_ObraSocial]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_ObraSocial]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'



create procedure [dbo].[LEG_UPD_ObraSocial]
@id int,
@documento int,
@idObraSocial smallint,
@nroAfiliado varchar(30),
@Habilitada_ReciboHaberes bit,
@fhDesde smalldatetime,
@folio char(10),
@usuarioProceso int
AS
UPDATE dbo.LEG_ObraSocial 
SET
	Documento = @Documento,
	idObraSocial =  @idObraSocial,
	nroAfiliado = @nroAfiliado ,
	fhDesde = @fhDesde, 
	folio =@Folio,
	Habilitada_ReciboHaberes = @Habilitada_ReciboHaberes,
	usuarioProceso = @usuarioProceso,
	fhProceso= getdate()
WHERE id = @id

' 
END
GO
/****** Object:  View [dbo].[VW_LEG_ObraSocial]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_LEG_ObraSocial]'))
EXEC dbo.sp_executesql @statement = N'



create view [dbo].[VW_LEG_ObraSocial]

AS

SELECT top 100 percent id, documento, idObraSocial, fhDesde, nroAfiliado, folio, Habilitada_ReciboHaberes
FROM dbo.LEG_ObraSocial A
WHERE ( convert(char(8),cast(fhdesde as int),112) + cast(documento as varchar)+cast(id as varchar)  ) in
	(SELECT  max( convert(char(8),cast(fhdesde as int),112) + cast(documento as varchar)+cast(id as varchar)  ) 
	FROM dbo.LEG_ObraSocial
	where Cast(fhDesde as datetime) <= getdate() 
	GROUP BY documento
)

ORDER BY documento

'
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Motivos_Reservas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Motivos_Reservas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[GABM_Tabla_Motivos_Reservas]
	@Operacion char(1),
	@Id_1 	[int]=null,
	@Descripcion_2 	[varchar](50)=null

AS 


IF @operacion =''A''
BEGIN
	Declare @MAx [int]
	set @Max = (select max(id)+1 from dbo.Tabla_Motivos_Reservas)
	if @Max is null begin
		set @max=1
	end
	INSERT INTO dbo.Tabla_Motivos_Reservas 
		 ([Id],
		 [Descripcion],
		Baja) 
 	VALUES 
		( @max,
		 @Descripcion_2,
		0)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_Motivos_Reservas
	set 	[Descripcion] =  @Descripcion_2
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_Motivos_Reservas
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_Motivos_Reservas
	set 	baja =  0
	where 	id = @Id_1
END


IF @operacion =''S''
BEGIN
	SELECT	Id,
		descripcion Descripción,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja 
	FROM  dbo.Tabla_Motivos_Reservas
	WHERE (id = @ID_1) OR (@ID_1 is null)
	ORDER BY descripcion
END










' 
END
GO
/****** Object:  View [dbo].[VW_Tabla_Motivos_Reservas]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Motivos_Reservas]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_Tabla_Motivos_Reservas]
AS
SELECT Id, Descripcion
FROM dbo.Tabla_Motivos_Reservas
WHERE baja =0

'
GO
/****** Object:  View [dbo].[VW_Tabla_Obra_Social]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Obra_Social]'))
EXEC dbo.sp_executesql @statement = N'

CREATE  VIEW [dbo].[VW_Tabla_Obra_Social]
AS
SELECT  top 100 percent *
FROM dbo.Tabla_ObraSocial


where baja =0
order by nombre

'
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Obra_Social]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Obra_Social]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[GABM_Tabla_Obra_Social]
	@Operacion char(1),
	@Id_1 	[smallint]=null,
	@Sigla	[varchar](50)=null,
	@Nombre	[varchar](200)=null,
	@RNOS	[varchar](50)=null
AS 
IF @operacion =''A''
BEGIN
	Declare @MAx [int]
	set @Max = (select max(id)+1 from dbo.Tabla_ObraSocial)
	if @Max is null begin
		set @max=1
	end
	INSERT INTO dbo.Tabla_ObraSocial 
		 ([Id],
		 sigla,
		nombre,
		RNOS,
		Baja) 
 	VALUES 
		(@max,
		 @Sigla,
		@Nombre,
		@RNOS,
		0)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_ObraSocial
	set 	Sigla =  @Sigla,
		Nombre = @Nombre,
		RNOS = @RNOS
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_ObraSocial
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_ObraSocial
	set 	baja =  0
	where 	id = @Id_1
END


IF @operacion =''S''
BEGIN
	SELECT	Id,
		Sigla,
		Nombre,
		Rnos,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja 
	FROM  dbo.Tabla_ObraSocial
	WHERE (id = @ID_1) OR (@ID_1 is null)
	ORDER BY Nombre
END









' 
END
GO
/****** Object:  View [dbo].[VW_obrasocial]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_obrasocial]'))
EXEC dbo.sp_executesql @statement = N'

CREATE  VIEW [dbo].[VW_obrasocial]
AS 
SELECT [Tabla_obrasocial].[Id], [Tabla_obrasocial].[nombre]
, sigla
FROM [Tabla_obrasocial]

where baja =0





'
GO
/****** Object:  StoredProcedure [dbo].[CRED_Ins_Accesos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Ins_Accesos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'Create procedure [dbo].[CRED_Ins_Accesos]
@menu_pantalla varchar(100)
as

insert into dbo.CRED_Accesos (Nombre)
values (@menu_pantalla)' 
END
GO
/****** Object:  StoredProcedure [dbo].[CRED_Get_Accesos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Get_Accesos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'Create procedure [dbo].[CRED_Get_Accesos]
as

select Id IdAcceso, Nombre NombreAcceso
from dbo.CRED_Accesos' 
END
GO
/****** Object:  View [dbo].[VW_tabla_motivos_causas]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_tabla_motivos_causas]'))
EXEC dbo.sp_executesql @statement = N'

CREATE  VIEW [dbo].[VW_tabla_motivos_causas]
AS
SELECT top 100 percent *
FROM dbo.tabla_motivos_causas

where baja =0
order by descripcion


'
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Motivos_Causas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Motivos_Causas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[GABM_Tabla_Motivos_Causas]
	@Operacion char(1),
	@Id_1 	[int]=null,
	@Descripcion_2 	[varchar](50)=null

AS 
IF @operacion =''A''
BEGIN
	Declare @MAx [int]
	set @Max = (select max(id)+1 from dbo.Tabla_Motivos_Causas)
	if @Max is null begin
		set @max=1
	end
	INSERT INTO dbo.Tabla_Motivos_Causas 
		 ([Id],
		 [Descripcion],
		Baja) 
 	VALUES 
		( @max,
		 @Descripcion_2,
		0)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_Motivos_Causas
	set 	[Descripcion] =  @Descripcion_2
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_Motivos_Causas
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_Motivos_Causas
	set 	baja =  0
	where 	id = @Id_1
END


IF @operacion =''S''
BEGIN
	SELECT	Id,
		descripcion Descripción,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja 
	FROM  dbo.Tabla_Motivos_Causas
	WHERE (id = @ID_1) OR (@ID_1 is null)
	ORDER BY descripcion
END









' 
END
GO
/****** Object:  View [dbo].[VW_Tabla_Tratamientos_Titulos]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_Tratamientos_Titulos]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_Tabla_Tratamientos_Titulos]
AS
SELECT id, Descripcion 
FROM dbo.Tabla_Tratamientos_Titulos
where baja = 0

'
GO
/****** Object:  StoredProcedure [dbo].[RH_ADD_Traspaso_Documentacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_ADD_Traspaso_Documentacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'






CREATE procedure [dbo].[RH_ADD_Traspaso_Documentacion]
	@Sector_TX smallint,
	@Usuario_TX smallint,
	@Motivo varchar(200),
	@Tabla varchar(100),
	@Registro varchar(100),
	@Sector_RX smallint,
	@Codigo varchar(5)=null
as
IF not exists (select id from dbo.RH_Traspaso_Documentacion 
	where 	(Sector_TX = @Sector_TX) and
		(Motivo = @Motivo)  and
		(Tabla = @Tabla) AND
		(Registro =  @Registro) AND
		Sector_Rx = @Sector_RX AND
		Fecha_RX IS NULL) BEGIN


	DECLARE @id int
	SET @Id = (select max(id)+1 from dbo.RH_Traspaso_Documentacion)
	IF @Id is null BEGIN
		Set @id = 1
	END
	
	INSERT INTO [dbo].[RH_Traspaso_Documentacion]([id], [Sector_TX], [Usuario_TX], [Fecha_TX], [Motivo],TABLA, [Registro], Sector_RX, codigo)
	VALUES	(@id,
		@Sector_TX,
		@Usuario_TX,
		getdate(),
		@Motivo,
		@Tabla,
		@Registro,
		@Sector_RX,
		@Codigo)

END






' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_UPD_RX_Traspaso]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_UPD_RX_Traspaso]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[RH_UPD_RX_Traspaso]  
 @Id int,      
 @Usuario_RX smallint      
AS     
  UPDATE dbo.RH_Traspaso_Documentacion      
  SET  Usuario_Rx = @Usuario_RX,       
    Fecha_Rx = Getdate()      
  WHERE Id = @Id      
   
  


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Designaciones_Fechas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Designaciones_Fechas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_UPD_Designaciones_Fechas]
	(@Fecha_Adm_Pub_2 	[smalldatetime],
	 @Fecha_Min_3 	[smalldatetime],
	 @Nro_Doc_4 	[int],
	 @Id_Interna_5 	[int])

AS
UPDATE [dbo].[Designaciones_Fechas] 
SET  	 [Fecha_Adm_Pub]	 = @Fecha_Adm_Pub_2,
	 [Fecha_Min]	 = @Fecha_Min_3,
	 [Nro_Doc]	 = @Nro_Doc_4,
	 [Id_Interna]	 = @Id_Interna_5 

WHERE 
	( [Id_Interna]	 = @Id_Interna_5)




' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Designaciones_Fechas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Designaciones_Fechas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[LEG_GET_Designaciones_Fechas]
	 @Nro_Doc_4 	[int],
	 @Id_Interna_5 	[int]

AS
SELECT	convert(char(10),[Fecha_Adm_Pub],103) Fecha_Adm_Pub,
	convert(char(10),[Fecha_Min],103) Fecha_Min,
	[Nro_Doc],
	[Id_Interna] 
FROM dbo.[Designaciones_Fechas] 
WHERE  id_interna = @Id_Interna_5 AND
	nro_doc = @Nro_Doc_4



' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Designaciones_Fechas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Designaciones_Fechas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[LEG_ADD_Designaciones_Fechas]
	(@Fecha_Adm_Pub_2 [datetime],
	 @Fecha_Min_3 	[datetime],
	 @Nro_Doc_4 	[int],
	 @Id_Interna_5 	[int])

AS
INSERT INTO dbo.[Designaciones_Fechas] 
	 ([Fecha_Adm_Pub],
	 [Fecha_Min],
	 [Nro_Doc],
	 [Id_Interna]) 
VALUES 	(@Fecha_Adm_Pub_2,
	 @Fecha_Min_3,
	 @Nro_Doc_4,
	 @Id_Interna_5)


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Fechas_Designacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Fechas_Designacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[LEG_GET_Fechas_Designacion]
	@id_interna 	[int]
AS 

select * from [dbo].Designaciones_fechas
where id_interna = @Id_interna
' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Regimen_Jubilatorio]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Regimen_Jubilatorio]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[GABM_Tabla_Regimen_Jubilatorio]
	@Operacion char(1),
	@Id_1 	[smallint]=null,
	@Descripcion_2 	[varchar](50)=null

AS 

IF @operacion =''A''
BEGIN
	Declare @MAx [int]
	set @Max = (select max(id)+1 from dbo.Tabla_Regimen_Jubilatorio)
	if @Max is null begin
		set @max=1
	end
	INSERT INTO dbo.Tabla_Regimen_Jubilatorio 
		 ([Id],
		 [Descripcion],
		Baja) 
 	VALUES 
		( @max,
		 @Descripcion_2,
		0)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_Regimen_Jubilatorio
	set 	[Descripcion] =  @Descripcion_2
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_Regimen_Jubilatorio
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_Regimen_Jubilatorio
	set 	baja =  0
	where 	id = @Id_1
END


IF @operacion =''S''
BEGIN
	SELECT	Id,
		descripcion Descripción,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja 
	FROM  dbo.Tabla_Regimen_Jubilatorio
	WHERE (id = @ID_1) OR (@ID_1 is null)
	ORDER BY descripcion
END










' 
END
GO
/****** Object:  View [dbo].[VW_RegimenesJubilatorios]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_RegimenesJubilatorios]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_RegimenesJubilatorios]
AS
SELECT *
FROM dbo.tabla_regimen_Jubilatorio
where baja =0



'
GO
/****** Object:  View [dbo].[VW_Regimen_jubilatorio]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Regimen_jubilatorio]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_Regimen_jubilatorio]
AS SELECT [Tabla_Regimen_jubilatorio].[Id], [Tabla_Regimen_jubilatorio].[Descripcion]
FROM [Tabla_Regimen_jubilatorio]

where baja =0



'
GO
/****** Object:  View [dbo].[VW_AFJP]    Script Date: 07/19/2012 19:45:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_AFJP]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_AFJP]
AS SELECT TOP 100 PERCENT [Tabla_Regimen_Jubilatorio].[Id], [Tabla_Regimen_Jubilatorio].[Descripcion]
FROM [Tabla_Regimen_Jubilatorio]

where baja=0
ORDER BY Tabla_Regimen_Jubilatorio.DESCRIPCION


'
GO
/****** Object:  StoredProcedure [dbo].[TG_Tabla_Ambitos_Antiguedad]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[TG_Tabla_Ambitos_Antiguedad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[TG_Tabla_Ambitos_Antiguedad]
AS
SELECT Id, Descripcion FROM dbo.Tabla_Ambitos_Antiguedad
WHERE Baja = 0



' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Documentacion_Legajo_Intimacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Documentacion_Legajo_Intimacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[LEG_ADD_Documentacion_Legajo_Intimacion]    

 @Id_interna int,    
 @Foto bit,    
 @PresentoAptoMedico smallint,    
 @Decreto894 bit,    
 @FotocDNI bit,    
 @Cuadernillo bit,    
 @FotocObraSocial bit,    
 @Titulo smallint,    
 @CertServAnt bit,    
 @AcredEstadoCivil bit,    
 @CV bit,    
 @NacimientoPresenta bit,    
 @NacimientoCantidad smallint,    
 @FotocDniHijosPresenta bit,    
 @FotocDniHijosCantidad smallint,    
 @AntecPenales bit,    
 @ComprobCuit bit,    
 @OpcionJub bit,    
 @InfoSumaria smallint,    
 @Observaciones text ,  
 @DDJJCtr1 bit,  
 @DDJJCtr2 bit,  
 @DDJJCtr3 bit   
AS     

 set nocount on
 INSERT INTO [dbo].[LEG_Documentacion_Legajo_Intimacion]     
   ([Id_interna] ,    
   [Foto] ,    
   [PresentoAptoMedico] ,    
   [Decreto_894] ,    
   [FotocDNI] ,    
   [Cuadernillo],    
   [FotocObraSocial],    
   [Titulo] ,    
   [CertifServAnt] ,    
   [AcreditEstadoCivil] ,    
   [CV] ,    
   [ActasNacimientoPresenta] ,    
   [ActasNacimientoCantidad] ,    
   [FotocDNIHijosPresenta] ,    
   [FotocDNIHijosCantidad] ,    
   [AntecedentesPenales] ,    
   [ComprobCUIT] ,    
   [OpcionJ] ,    
   [InfoSumaria] ,    
   [Observaciones],  
   DDJJCtr1,  
   DDJJCtr2,  
   DDJJCtr3,  
   FechaIntimacion)    
  VALUES     
   (@Id_interna,    
   @Foto,    
   @PresentoAptoMedico,    
   @Decreto894,    
   @FotocDNI,    
   @Cuadernillo,    
   @FotocObraSocial,    
   @Titulo,    
   @CertServAnt,    
   @AcredEstadoCivil,    
   @CV,    
   @NacimientoPresenta,    
   @NacimientoCantidad,    
   @FotocDniHijosPresenta,    
   @FotocDniHijosCantidad,    
   @AntecPenales,    
   @ComprobCuit,    
   @OpcionJub,    
   @InfoSumaria,    
   @Observaciones,  
   @DDJJCtr1,  
   @DDJJCtr2,  
   @DDJJCtr3,  
   Getdate())    
  
  
select max(Id_Reclamo) MaxId from dbo.LEG_Documentacion_Legajo_Intimacion
  
  


' 
END
GO
/****** Object:  View [dbo].[VW_Funciones_Rango]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Funciones_Rango]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_Funciones_Rango]
AS
SELECT *
FROM dbo.Tabla_funciones_rangos

'
GO
/****** Object:  StoredProcedure [dbo].[CGet_Funciones_Rangos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CGet_Funciones_Rangos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[CGet_Funciones_Rangos]

(@funcion int,
@rango int,
@monto int)

AS

declare @Ma [int]
declare @Mi [int]

set @Ma = (select monto_hasta from tabla_funciones_rangos where id_funciones = @funcion and id_rando = @rango) 
set @Mi = (select top 1 monto_hasta from tabla_funciones_rangos where monto_hasta < (select monto_hasta from tabla_funciones_rangos where ( id_funciones = @funcion and id_rando = @rango)))


if @mi is NULL begin
	set @mi = 0
end 

if @monto <= @ma and @monto >= @mi begin
	select 1 Valido
end

if @monto > @ma or @monto < @mi begin
	select 0 Valido
end

' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Distrito_Militar]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Distrito_Militar]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[GABM_Tabla_Distrito_Militar]
	@Operacion char(1),
	@Id_1 	[smallint]=null,
	@Descripcion_2 	[varchar](25)=null

AS 

IF @operacion =''A''
BEGIN
	Declare @MAx [int]
	set @Max = (select max(id)+1 from dbo.Tabla_DistritosMilitares)
	if @Max is null begin
		set @max=1
	end
	INSERT INTO dbo.Tabla_DistritosMilitares 
		 ([Id],
		 [Descripcion],
		Baja) 
 	VALUES 
		( @max,
		 @Descripcion_2,
		0)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_DistritosMilitares
	set 	[Descripcion] =  @Descripcion_2
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_DistritosMilitares
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_DistritosMilitares
	set 	baja =  0
	where 	id = @Id_1
END


IF @operacion =''S''
BEGIN
	SELECT	Id,
		descripcion Descripción,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja 
	FROM  dbo.Tabla_DistritosMilitares
	WHERE (id = @ID_1) OR (@ID_1 is null)
	ORDER BY descripcion
END










' 
END
GO
/****** Object:  StoredProcedure [dbo].[GET_DistritoMilitar_ABM]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GET_DistritoMilitar_ABM]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[GET_DistritoMilitar_ABM] 

@desc [varchar](25)

AS

select descripcion from tabla_distritosmilitares where descripcion = @desc


' 
END
GO
/****** Object:  StoredProcedure [dbo].[ABM_Tabla_DM]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ABM_Tabla_DM]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ABM_Tabla_DM]
	(@ID [smallint],
	@Descripcion	[varchar](25),
	@operacion [int])

AS 
declare @MaxId [int]
set @maxId = (select max(id) +1 from dbo.tabla_distritosmilitares )

--ALTA
IF  @operacion = 1 
BEGIN
	INSERT INTO dbo.tabla_distritosmilitares 
	 ([Id],
	 Descripcion) 
	VALUES 
		(@maxid,
		@Descripcion)
END


-- MODIFICACION
IF @operacion = 2 
BEGIN
	UPDATE dbo.tabla_distritosmilitares 
	SET   [Id]= @id,
	          Descripcion= @Descripcion
	WHERE 
		ID =  @ID		
END

--BAJA
IF @OPERACION =3  
BEGIN
	UPDATE dbo.tabla_distritosmilitares 
	SET   baja = 1
	WHERE 
		ID =  @ID		
END


--CONSULTA
IF @OPERACION =4 
BEGIN
	SELECT * FROM dbo.tabla_distritosmilitares
	where baja =0
	order by id
END

' 
END
GO
/****** Object:  View [dbo].[VW_DistritosMilitares]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_DistritosMilitares]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_DistritosMilitares]
AS
SELECT  *
FROM Tabla_DistritosMilitares


'
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Calificacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Calificacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_GET_Calificacion]
	@Id int
AS
SELECT	* 
FROM	dbo.Calificaciones 
WHERE	Id_Calificacion = @Id


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Calificaciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Calificaciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_UPD_Calificaciones]
	(@Jurisdiccion_10 	[varchar](50),
	 @Organismo_11 	[varchar](50),
	 @Calificacion_Final_12 	[varchar](25),
	 @Fecha_Desde_13 	[datetime],
	 @Fecha_Hasta_14 	[datetime],
	 @Folio_15 	[char](10),
	 @Id_Interna_16 	[int],
	 @Doc_Titular_17 	[int],
	 @Id_Calificacion_18 	[int],
	@DatoDeBaja bit,
	@DatoNoImprime bit)


AS UPDATE [dbo].[Calificaciones] 

SET  [Jurisdiccion]	 = @Jurisdiccion_10,
	 [Organismo]	 = @Organismo_11,
	 [Calificacion_Final]	 = @Calificacion_Final_12,
	 [Fecha_Desde]	 = @Fecha_Desde_13,
	 [Fecha_Hasta]	 = @Fecha_Hasta_14,
	 [Folio]	 = @Folio_15,
	 [Id_Interna]	 = @Id_Interna_16,
	 [Doc_Titular]	 = @Doc_Titular_17,
	datodebaja= @DatoDeBaja,
	datonoimprime= @DatoNoImprime
	


WHERE 
	([Id_Calificacion]	 = @Id_Calificacion_18 )

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Calificaciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Calificaciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE procedure [dbo].[LEG_GET_Calificaciones]
	@doc int,
	@id int
AS
SELECT	jurisdiccion, 
	organismo, 
	calificacion_final, 
	fecha_desde, 
	fecha_hasta, 
	folio, 
	Doc_Titular, 
	id_interna, 
	id_calificacion
FROM 	dbo.calificaciones C
WHERE	(c.doc_titular=@doc or c.id_interna=@id) AND
	datodebaja = 0

ORDER By Folio



' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Calificaciones]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Calificaciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'




CREATE procedure [dbo].[RPT_LEG_Calificaciones]
	@Id_interna int
as

SELECT	Jurisdiccion,
	Organismo,
	Calificacion_Final,
	case when Fecha_Desde=''01/01/1900'' THEN
		''''
	ELSE
		Fecha_Desde
	END Fecha_Desde,
	Fecha_Hasta,
	Folio
FROM 	dbo.Calificaciones
WHERE 	Id_Interna = @Id_Interna AND
	DatoDeBaja = 0 AND
	datonoimprime = 0

ORDER BY fecha_desde




' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Calificaciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Calificaciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LEG_ADD_Calificaciones]
	(@Jurisdicción_1 	[varchar](50),
	 @Organismo_2 	[varchar](50),
	 @Calificación_Final_3 	[varchar](25),
	 @Fecha_Desde_4 	[datetime],
	 @Fecha_Hasta_5 	[datetime],
	 @Folio_6 	[char](10),
	 @Id_Interna_7 	[int],
	@doc_tit_8  [int],
	@DatoDeBaja bit,
	@DatoNoImprime bit)

AS 

Declare	 @id_Calificacion	[int]
set  @id_Calificacion = (select max(Id_Calificacion)+1 from dbo.Calificaciones)		
if @id_Calificacion is null begin
	set @id_Calificacion =1
end

INSERT INTO[dbo].[Calificaciones] 
	 ( [Jurisdiccion],
	 [Organismo],
	 [Calificacion_Final],
	 [Fecha_Desde],
	 [Fecha_Hasta],
	 [Folio],
	 [Id_Interna], 
	[Doc_Titular],
	[Id_Calificacion],
	DatoDeBaja,
	DatoNoImprime)


 
VALUES 
	( @Jurisdicción_1,
	 @Organismo_2,
	 @Calificación_Final_3,
	 @Fecha_Desde_4,
	 @Fecha_Hasta_5,
	 @Folio_6,
	 @Id_Interna_7,
	@doc_tit_8,
	@Id_Calificacion,
	@DatoDeBaja,
	@DatoNoImprime)

' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetTipoDoc]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetTipoDoc]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[GetTipoDoc]
	@baja bit
 AS

SELECT *
FROM [dbo].tabla_docIdentidad
where baja = @baja


' 
END
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Doc_Identidad]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Doc_Identidad]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[GABM_Tabla_Doc_Identidad]
	@Operacion char(1),
	@Id_1 	[int]=null,
	@Descripcion_2 	[varchar](50)=null

AS 
IF @operacion =''A''
BEGIN
	Declare @MAx [int]
	set @Max = (select max(id)+1 from dbo.Tabla_DocIdentidad)
	if @Max is null begin
		set @max=1
	end
	INSERT INTO dbo.Tabla_DocIdentidad 
		 ([Id],
		 [Descripcion],
		Baja) 
 	VALUES 
		( @max,
		 @Descripcion_2,
		0)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_DocIdentidad
	set 	[Descripcion] =  @Descripcion_2
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_DocIdentidad
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_DocIdentidad
	set 	baja =  0
	where 	id = @Id_1
END


IF @operacion =''S''
BEGIN
	SELECT	Id,
		descripcion Descripción,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja 
	FROM  dbo.Tabla_DocIdentidad
	WHERE (id = @ID_1) OR (@ID_1 is null)
	ORDER BY descripcion
END









' 
END
GO
/****** Object:  View [dbo].[VW_Tabla_DocIndentidad]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Tabla_DocIndentidad]'))
EXEC dbo.sp_executesql @statement = N'
CREATE view [dbo].[VW_Tabla_DocIndentidad]

as
SELECT [Id], [Descripcion] 
FROM [dbo].[Tabla_DocIdentidad]
WHERE baja =0


'
GO
/****** Object:  View [dbo].[VW_Idiomas]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Idiomas]'))
EXEC dbo.sp_executesql @statement = N'


CREATE  VIEW [dbo].[VW_Idiomas]
AS
SELECT id,descripcion
FROM tabla_idiomas
where baja =0




'
GO
/****** Object:  StoredProcedure [dbo].[ABM_Idiomas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ABM_Idiomas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ABM_Idiomas]
	(@ID [smallint],
	@Descripcion	[varchar](25),
	@operacion [int])

AS 
declare @MaxId [int]
set @maxId = (select max(id) +1 from dbo.tabla_idiomas )

--ALTA
IF  @operacion = 1 
BEGIN
	INSERT INTO dbo.tabla_idiomas
	 ([Id],
	 Descripcion) 
	VALUES 
		(@maxid,
		@Descripcion)
END


-- MODIFICACION
IF @operacion = 2 
BEGIN
	UPDATE dbo.tabla_idiomas 
	SET   [Id]= @id,
	          Descripcion= @Descripcion
	WHERE 
		ID =  @ID		
END

--BAJA
IF @OPERACION =3  
BEGIN
	UPDATE dbo.tabla_idiomas 
	SET   baja = 1
	WHERE 
		ID =  @ID		
END


--CONSULTA
IF @OPERACION =4 
BEGIN
	SELECT * FROM dbo.tabla_idiomas
	where baja =0
	order by id
END


-- VERIFICA SI EXISTE EN DB
IF @OPERACION=5
BEGIN
	SELECT * FROM dbo.tabla_idiomas
	where descripcion=@descripcion
END




' 
END
GO
/****** Object:  StoredProcedure [dbo].[GetEstadosCiviles]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GetEstadosCiviles]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[GetEstadosCiviles]

	@baja bit
 AS

SELECT *
FROM dbo.tabla_estado_civil
where baja = @baja


' 
END
GO
/****** Object:  View [dbo].[VW_Estados_Civiles]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Estados_Civiles]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_Estados_Civiles]
AS SELECT [Tabla_Estado_Civil].[Id], [Tabla_Estado_Civil].[Descripcion]
FROM [Tabla_Estado_Civil]

where baja =0
'
GO
/****** Object:  StoredProcedure [dbo].[GABM_Tabla_Estado_Civil]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GABM_Tabla_Estado_Civil]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[GABM_Tabla_Estado_Civil]
	@Operacion char(1),
	@Id_1 	[int]=null,
	@Descripcion_2 	[varchar](50)=null

AS 

IF @operacion =''A''
BEGIN
	Declare @MAx [int]
	set @Max = (select max(id)+1 from dbo.Tabla_Estado_Civil)
	if @Max is null begin
		set @max=1
	end
	INSERT INTO dbo.Tabla_Estado_Civil 
		 ([Id],
		 [Descripcion],
		Baja) 
 	VALUES 
		( @max,
		 @Descripcion_2,
		0)
END

IF @operacion =''M''
BEGIN
	update 	dbo.Tabla_Estado_Civil
	set 	[Descripcion] =  @Descripcion_2
	where 	id = @Id_1
END


IF @operacion =''B''
BEGIN
	update 	dbo.Tabla_Estado_Civil
	set 	baja =  1
	where 	id = @Id_1
END

IF @operacion =''R''
BEGIN
	update 	dbo.Tabla_Estado_Civil
	set 	baja =  0
	where 	id = @Id_1
END


IF @operacion =''S''
BEGIN
	SELECT	Id,
		descripcion Descripción,
		case when baja = 1 then
			''Si''
		else
			''No''
		end Baja 
	FROM  dbo.Tabla_Estado_Civil
	WHERE (id = @ID_1) OR (@ID_1 is null)
	ORDER BY descripcion
END









' 
END
GO
/****** Object:  StoredProcedure [dbo].[ABM_nivel_estudio]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ABM_nivel_estudio]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ABM_nivel_estudio]
	(@ID [smallint],
	@Descripcion	[nvarchar](50),
	@operacion [int])

AS 
declare @MaxId [int]
set @maxId = (select max(id) +1 from dbo.tabla_nivel_estudios )

--ALTA
IF  @operacion = 1 
BEGIN
	INSERT INTO dbo.tabla_nivel_estudios
	 ([Id],
	 Descripcion) 
	VALUES 
		(@maxid,
		@Descripcion)
END


-- MODIFICACION
IF @operacion = 2 
BEGIN
	UPDATE dbo.tabla_nivel_estudios 
	SET   [Id]= @id,
	          Descripcion= @Descripcion
	WHERE 
		ID =  @ID		
END

--BAJA
IF @OPERACION =3  
BEGIN
	UPDATE dbo.tabla_nivel_estudios 
	SET   baja = 1
	WHERE 
		ID =  @ID		
END


--CONSULTA
IF @OPERACION =4 
BEGIN
	SELECT * FROM dbo.tabla_nivel_estudios
	where baja =0
	order by id
END


-- VERIFICA SI EXISTE EN DB
IF @OPERACION=5
BEGIN
	SELECT * FROM dbo.tabla_nivel_estudios
	where descripcion=@descripcion
END
' 
END
GO
/****** Object:  View [dbo].[VW_Nivel_Estudios]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_Nivel_Estudios]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_Nivel_Estudios]
AS SELECT [Tabla_Nivel_Estudios].[Id], [Tabla_Nivel_Estudios].[Descripcion]
FROM dbo.[Tabla_Nivel_Estudios]

'
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Designaciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Designaciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[LEG_GET_Designaciones]  
	@Doc int,
	@Id int
AS

select 
D.Id_Designacion,
D.jurisdiccion,
d.organismo,
TTR.descripcion acto_tipo,
d.acto_nro,
d.acto_fecha,
d.motivo,
dbo.Fx_GET_DescArea_Fecha (d.id_interna, d.Fecha_desde) Area,
dbo.Fx_GET_DescPlanta_Fecha (d.Id_interna, d.Fecha_desde)  +'' | '' +  dbo.Fx_GET_DescNivel_Fecha (d.id_interna, d.Fecha_desde)  +'' '' + dbo.Fx_GET_DescGrado_Fecha (d.id_interna, d.Fecha_desde) +'' | '' + tc.descripcion SR,
d.folio,
tmc.descripcion as motivoDesc,
d.fecha_desde,
d.area

from [dbo].designaciones D
inner join [dbo].datos_personales DP
	on DP.nro_documento = d.nro_doc and DP.id_interna = d.id_interna
inner join [dbo].tabla_cargos TC
	on TC.id = d.id_cargo

inner join [dbo].tabla_tipos_resoluciones TTR
	on TTR.id = d.acto_tipo

inner join dbo.Tabla_motivos_causas as TMC
	on d.motivo = tmc.id

where (d.id_interna = @id or d.nro_doc =  @doc) and datodebaja = 0

order by d.folio, D.id_designacion


' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Carrera_Administrativa]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Carrera_Administrativa]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'





CREATE PROCEDURE [dbo].[RPT_LEG_Carrera_Administrativa]
	@id int
 AS
select	CA.ID_CARRERA,
	CA.Jurisdicción,
	CA.Organismo,
	TRE.regimen ,
	TA.DESCRIPCION AGRUPAMIENTO,
--	TN.NIVEL,                    
--	TG.GRADO,
	dbo.Fx_GET_DescNivel_Fecha (@id, ca.fecha_desde)Nivel,
	dbo.Fx_GET_DescGrado_Fecha (@id, ca.fecha_desde)Grado,
	TC.DESCRIPCION CARGO,
	CA.Causas,                                             
	CA.Fecha_Desde,
	case when ca.fecha_hasta = ''01/01/1900'' then
		''''
	else	
		isnull(convert(char,CA.Fecha_Hasta,103), ''31/12/''+ convert(char(4),year(getdate()))) 
	end Fecha_hasta,
	
	TTR.descripcion Acto_tipo,
	CA.Acto_nro,
	CA.Acto_Fecha,
	CA.Folio ,
	ca.id_tipo_cargo,
	tmc.descripcion CAUSA                  

from [dbo].carrera_administrativa CA
left join [dbo].tabla_agrupamiento TA
	on TA.id = CA.Id_agrupamiento 

left join [dbo].Tabla_Niveles TN
	on TN.id = CA.Id_Nivel

left join [dbo].Tabla_Grados TG
	on TG.id = CA.Id_Grado

left join [dbo].tabla_cargos TC
	on TC.id = CA.Id_Cargos

left join [dbo].tabla_tipos_resoluciones TTR
	on TTR.id = CA.Acto_Tipo

left join [dbo].Tabla_Regimen_Escalafonario TRE
	on TRE.id = CA.Regimen

left join dbo.Tabla_Motivos_Causas TMC
	on TMC.id = CA.causas

Where 	ca.id_interna = @id AND
	DatoDeBaja = 0 and
	DatoNoImprime = 0 
order by CA.Fecha_Desde




' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_LEG_Designaciones]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_LEG_Designaciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[RPT_LEG_Designaciones]
	@Id int
AS
select 
	D.jurisdiccion,
	D.organismo,
	TTR.descripcion acto_tipo,
	d.acto_nro,
	d.acto_fecha,
	tmc.descripcion  motivoDesc,
	dbo.Fx_GET_DescArea_Fecha (D.Id_interna, D.Fecha_desde) Area,
	dbo.Fx_GET_DescNivel_Fecha (D.Id_interna, D.Fecha_desde) Nivel,
	dbo.Fx_GET_DescGrado_Fecha (D.Id_interna, D.Fecha_desde) Grado,
	dbo.Fx_GET_DescPlanta_Fecha (D.Id_interna, D.Fecha_desde) +'' | '' +  tc.descripcion SR

FROM [dbo].designaciones D
INNER JOIN [dbo].datos_personales DP
	on DP.nro_documento = d.nro_doc and DP.id_interna = d.id_interna
INNER JOIN [dbo].tabla_cargos TC
	on TC.id = d.id_cargo
INNER JOIN [dbo].tabla_tipos_resoluciones TTR
	on TTR.id = d.acto_tipo
INNER JOIN dbo.Tabla_motivos_causas as TMC
	on d.motivo = tmc.id
WHERE	d.id_interna = @id AND
	datodebaja = 0 and
	DatoNoImprime = 0 

ORDER BY d.acto_fecha


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Carreras_Admistrativas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Carreras_Admistrativas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'





CREATE procedure [dbo].[LEG_GET_Carreras_Admistrativas]
	@doc int,
	@id int
 AS
select CA.ID_Carrera,
	CA.Jurisdicción,
	CA.Organismo,
	TRE.regimen ,
	TA.DESCRIPCION AGRUPAMIENTO,
	ISNULL(dbo.Fx_GET_DescNivel_Fecha (ca.id_interna, CA.Fecha_desde),'''') Nivel,
	ISNULL(dbo.Fx_GET_DescGrado_Fecha (ca.id_interna, CA.Fecha_desde),'''') Grado,
--	isnull(TN.NIVEL,'''') nivel,                    
--	isnull(TG.GRADO,'''') grado,
	TC.DESCRIPCION CARGO,
	CA.Causas,                                             
	CA.Fecha_Desde,
	CA.Fecha_Hasta,
	TTR.descripcion Acto_tipo,
	CA.Acto_nro,
	CA.Acto_Fecha,
	CA.Folio ,
	ca.id_tipo_cargo,
	mc.descripcion DescCausa
FROM [dbo].carrera_administrativa CA
INNER join [dbo].tabla_agrupamiento TA
	on TA.id = CA.Id_agrupamiento 

--left join [dbo].Tabla_Niveles TN
--	on TN.id = CA.Id_Nivel

--left join [dbo].Tabla_Grados TG
--	on TG.id = CA.Id_Grado

inner join [dbo].tabla_cargos TC
	on TC.id = CA.Id_Cargos

inner join [dbo].tabla_tipos_resoluciones TTR
	on TTR.id = CA.Acto_Tipo

inner join [dbo].Tabla_Regimen_Escalafonario TRE
	on TRE.id = CA.Regimen

inner join dbo.tabla_motivos_Causas MC
	on mc.id = ca.causas

where (ca.doc_tit  = @doc  or ca.id_interna = @id) and datodebaja = 0

order by CA.Id_carrera






' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_VerificarCancelarVacaciones]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_VerificarCancelarVacaciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[ASIS_VerificarCancelarVacaciones]    
 @id_Interna int,        
 @Desde smalldatetime=NULL,        
 @Hasta smalldatetime=NULL,  
 @idLicencia int=NULL --Esto es para la modificacion porque me toma la misma licencia que se pisa.  
AS        
    
IF @desde is NULL BEGIN SET @Desde = (select convert(smalldatetime,convert(char(10),getdate(),103),103)) END        
IF @Hasta is NULL BEGIN SET @hasta = (select convert(smalldatetime,convert(char(10),getdate(),103),103)) END        
         
DECLARE @id_vac int    
DECLARE @desde_vac datetime    
DECLARE @hasta_vac datetime    
  
    
--LLENO EL CURSOR    
DECLARE Licencia_cursor CURSOR FOR      
SELECT  LS.id,     
  LS.desde,     
  LS.hasta    
FROM LICENCIAS_SOLICITADAS LS        
INNER JOIN TABLA_CONCEPTOS_LICENCIAS TCL          
 ON LS.CONCEPTO = TCL.ID_CONCEPTO        
WHERE LS.ID_INTERNA = @id_Interna     
AND (LS.Concepto = 1 OR LS.Concepto = 6) -->(9A)o(10E)    
AND     
((convert(smalldatetime,convert(char(10),@Desde,103),103) BETWEEN LS.DESDE AND LS.HASTA)    
OR(convert(smalldatetime,convert(char(10),@Hasta,103),103) BETWEEN LS.DESDE AND LS.HASTA)    
OR (convert(smalldatetime,convert(char(10),@Desde,103),103) <= LS.DESDE)     
AND (convert(smalldatetime,convert(char(10),@Hasta,103),103) >= LS.HASTA))    
AND (LS.id <> @idLicencia or @idLicencia is null)  
    
OPEN Licencia_cursor;      
FETCH NEXT FROM Licencia_cursor       
INTO @id_vac, @desde_vac, @hasta_vac    
    
 --LE: Licencia Enfermedad    
 --LV: Licencia Vacaciones      
    
WHILE @@FETCH_STATUS = 0      
BEGIN      
    
 select @id_vac id_vac, @desde_vac desde_vac, @hasta_vac hasta_vac    
    
 --Busco si la LE cae entre LV |------''---''------|    
 IF  (select count(*)     
  from LICENCIAS_SOLICITADAS ls     
  where ls.id = @id_vac    
   and (LS.DESDE < @Desde AND LS.HASTA > @Hasta)) > 0    
 BEGIN    
    
  DECLARE @Concepto smallint,    
   @Periodo smallint,     
   @Goce smallint,    
   @Id_Area int,    
   @Id_Tabla_Autorizacion int,    
   @desde_lic_nueva smalldatetime,    
   @DiasATomar int    
    
  select @Concepto = Concepto,    
    @Periodo = Periodo,       
    @Goce = Goce,    
    @Id_Area = Id_Area,    
    @Id_Tabla_Autorizacion = Id_Tabla_Autorizacion       
  from dbo.Licencias_solicitadas    
  where id = @id_vac     
    
    
  --CORTO LA LIC DE VACACIONES HASTA EL DESDE DE LA LIC POR ENFERMEDAD (1er PARTE)    
  UPDATE LICENCIAS_SOLICITADAS    
  SET hasta = @desde - 1,    
   Dias_A_Tomar = DATEDIFF ( D , desde , @desde - 1 ) + 1,    
   FH_FIN_ANTES_INTERR = @hasta_vac,    
   Motivo_Interrupcion = ''Interrupcion por licencia''    
  where id = @id_vac    
    
  SET @desde_lic_nueva = @hasta + 1     
  SET @DiasATomar = (select DATEDIFF ( D , @Hasta + 1 , @hasta_vac) + 1)    
    
  --GENERO LA NUEVA LIC DE VACACIONES DE LA 2da PARTE    
  exec dbo.ASIS_ALTA_Licencias_Solicitadas     
   @Id_Interna,    
   @Concepto,    
   @Periodo,    
   @desde_lic_nueva, --DESDE    
   @hasta_vac, --HASTA    
   '''', --@Autorizo_Descuento    
   0, --@Dias_Descuento    
   @Goce,    
   ''Licencia Automatica por interrupción'', --@Observaciones    
   ''ADMIN'', --@Informo    
   @DiasATomar,    
   @Id_Area,    
   @Id_Tabla_Autorizacion,    
   0, --@Estimada    
   1, --@auth    
   0, --@esMigrado    
   1, --@usuario    
   0, --@id_diagnostico    
   0 --@Id_Atencion     
 END    
    
    
 --Busco si el Desde(LE) < Desde(LV) y (hasta(LE) > Desde(LV) y hasta(LE) < Hasta(LV)) ''--|------''---------|    
 --Corro el Desde(LV)    
 IF  (select count(*)     
  from LICENCIAS_SOLICITADAS ls     
  where ls.id = @id_vac    
   and (LS.DESDE >= @Desde AND (LS.DESDE <= @Hasta and LS.HASTA > @Hasta))) > 0    
 BEGIN        
  --CORTO LA LIC DE VACACIONES HASTA EL DESDE DE LA LIC POR ENFERMEDAD (1er PARTE)    
  UPDATE LICENCIAS_SOLICITADAS    
  SET desde = @hasta + 1,    
   Dias_A_Tomar = DATEDIFF ( D , @hasta + 1 , hasta ) + 1,    
   Motivo_Interrupcion = ''Interrupcion por licencia''    
  where id = @id_vac    
 END    
    
    
 --Busco si el (Desde(LE) > Desde(LV) y Desde(LE) < hasta(LV)) y (hasta(LE) > Hasta(LV)) |---------''------|---''    
 --Corro el Hasta(LV)    
 IF  (select count(*)     
  from LICENCIAS_SOLICITADAS ls     
  where ls.id = @id_vac    
   and (LS.DESDE < @Desde AND @Desde <= LS.HASTA) and (LS.HASTA <= @Hasta)) > 0    
 BEGIN    
  --CORTO LA LIC DE VACACIONES HASTA EL DESDE DE LA LIC POR ENFERMEDAD (1er PARTE)    
  UPDATE LICENCIAS_SOLICITADAS    
  SET hasta = @desde - 1,    
   Dias_A_Tomar = DATEDIFF ( D , desde , @desde - 1 ) + 1,    
   Motivo_Interrupcion = ''Interrupcion por licencia'',
   FH_FIN_ANTES_INTERR = hasta
  where id = @id_vac    
 END    
    
    
 -- *** Estas licencias anulan la LV porque tiene mas o igual cantidad de dias ***    
    
 -- Desde(LE) = Desde (LV) y Hasta(LE) = Hasta(LV) ''|---------------|''    
 IF  (select count(*)     
  from LICENCIAS_SOLICITADAS ls     
  where ls.id = @id_vac    
   and (LS.DESDE = @Desde AND LS.HASTA = @Hasta)) > 0    
 BEGIN    
   EXEC ASIS_AnularSolicitudLicencia 0, @id_vac, @id_Interna    
 END    
    
    
 -- Desde(LE) = Desde (LV) y Hasta(LE) > Hasta(LV) ''|---------------|--''    
 IF  (select count(*)     
  from LICENCIAS_SOLICITADAS ls     
  where ls.id = @id_vac    
   and (LS.DESDE = @Desde AND LS.HASTA < @Hasta)) > 0    
 BEGIN    
   EXEC ASIS_AnularSolicitudLicencia 0, @id_vac, @id_Interna    
 END    
    
    
 -- Desde(LE) < Desde (LV) y Hasta(LE) = Hasta(LV) ''--|---------------|''    
 IF  (select count(*)     
  from LICENCIAS_SOLICITADAS ls     
  where ls.id = @id_vac    
   and (LS.DESDE > @Desde AND LS.HASTA = @Hasta)) > 0    
 BEGIN    
   EXEC ASIS_AnularSolicitudLicencia 0, @id_vac, @id_Interna    
 END    
    
    
 -- Desde(LE) < Desde (LV) y Hasta(LE) > Hasta(LV) ''--|---------------|--''    
 IF  (select count(*)     
  from LICENCIAS_SOLICITADAS ls     
  where ls.id = @id_vac    
   and (LS.DESDE > @Desde AND LS.HASTA < @Hasta)) > 0    
 BEGIN    
   EXEC ASIS_AnularSolicitudLicencia 0, @id_vac, @id_Interna    
 END    
    
    
 FETCH NEXT FROM Licencia_cursor      
 INTO @id_vac, @desde_vac, @hasta_vac    
    
END    
    
CLOSE Licencia_cursor;      
DEALLOCATE Licencia_cursor; 

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CON_CONSULTA_RAPIDA_LEGAJO]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CON_CONSULTA_RAPIDA_LEGAJO]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE                  PROCEDURE [dbo].[CON_CONSULTA_RAPIDA_LEGAJO]
	@Documento int
AS
SELECT	dp.apellido +'', ''+ dp.nombre Apellido,
	convert(varchar(10),dp.fecha_nacimiento,103) FechaNacimiento,
	dbo.FxCalcula_Edad (dp.fecha_nacimiento,getdate()) Edad,
	left(dp.cuil_nro,2)+''-''+right(left(dp.cuil_nro,10),8)+''-''+right(dp.cuil_nro,1)Cuil,
	case when dp.sexo = 1 then
		''Masculino''
	else
		''Femenino''
	end Sexo,
	ec.descripcion EstadoCivil,
	convert(varchar(10),DI.descripcion) +'' - ''+ convert(varchar(10),dp.nro_documento) Documento,
	domp.calle +'' ''+ convert(varchar(5),domp.número) + 
			case when piso is null then
				''''
			else
				'' Piso: '' + piso
			end +
			case when dpto is null	then
				''''
			else
				'' Dpto: '' + dpto
			end + ''  CP: '' + Codigo_postal + ''-'' +
			(select nombrelocalidad from dbo.LocalidadesAFIP where idlocalidad = localidad) Domicilio,
	
---	er.titulo + '' ('' + ne.descripcion + '')'' + CASE WHEN er.completo = 0 THEN '' (Incompleto)'' ELSE '''' END   Estudio,
	
	TET.descripcion +  '' ('' + TEN.descripcion + '')'' + CASE WHEN LER.completo = 1 THEN '' (Incompleto)'' ELSE '''' END   Estudio,

	d.fecha_desde Desde,
isnull(tn.nivel + tg.grado,''--'') Nivel,
ta.descripcion Sector,
ttp.descripcion Planta,
	tc.descripcion Cargo,
	TAG.descripcion Agrupamiento,
	df.fecha_Min IngresoMinisterio,
	dbo.Fx_Calcula_Antiguedad(convert(varchar(10),df.fecha_Min,103),convert(varchar(10), case when (select fecha_baja from dbo.Legajo_bajas where id_interna = dp.id_interna) is null then
					convert(varchar(10),Getdate(),103)
				else
					(select fecha_baja from dbo.Legajo_bajas where id_interna = dp.id_interna)
				end,103))AntMinisterio,
	ant.ant_estado AntEstado,
	ant.ant_privada AntPrivada,
	ant.ant_total AntTotal,
	ant.resta_ant_min RestaAnt,
	dbo.fx_sumar_antiguedad (
		dbo.Fx_Calcula_Antiguedad(convert(varchar(10),df.fecha_Min,103),convert(varchar(10), case when (select fecha_baja from dbo.Legajo_bajas where id_interna = dp.id_interna) is null then
					convert(varchar(10),Getdate(),103)
				else
					(select fecha_baja from dbo.Legajo_bajas where id_interna = dp.id_interna)
				end,103))
	,ant.ant_total) ANTTotalTotal,
	convert(varchar(10),lb.fecha_baja,103) FechaBaja,
	dp.nro_documento,
	dp.id_interna
	

FROM dbo.Datos_Personales DP
LEFT JOIN dbo.Tabla_Estado_Civil EC
	on EC.id = dp.estado_civil
LEFT JOIN dbo.Tabla_DocIdentidad DI
	on DI.id = dp.tipo_documento
LEFT JOIN dbo.Domicilio_Personal DOMP
	on DOMP.id_interna = dp.id_interna
	--and domp.id_domicilio = (select max(id_domicilio) from dbo.Domicilio_Personal where id_interna = dp.id_interna)
	and domp.Fecha_Comunicacion = (select max(Fecha_Comunicacion) from dbo.Domicilio_Personal where id_interna = dp.id_interna)


--LEFT JOIN dbo.Estudios_realizados ER
--	on er.id_interna = dp.id_interna and
--	er.nivel = (select max(nivel) from dbo.estudios_realizados where id_interna = dp.id_interna)

--LEFT JOIN dbo.tabla_nivel_estudios NE
--	on ne.id = er.nivel

  LEFT JOIN dbo.LEG_Estudios_Realizados LER
	ON 	LER.id = (select top 1 LER1.id from dbo.LEG_Estudios_Realizados LER1
		  LEFT JOIN dbo.Tabla_Estudios_Niveles TEN1
		on TEN1.id = LER1.Id_Nivel
		where LER1.Id_Interna = dp.id_interna
		and LER1.DatoDeBaja =0
		order by  TEN1.ORDEN desc,LER1.fecha_egreso desc)
	
  LEFT JOIN dbo.Tabla_Estudios_Titulos TET
	on TET.id = LER.Id_Titulo

  LEFT JOIN dbo.Tabla_Estudios_Niveles TEN
	on TEN.id = LER.Id_Nivel
	



LEFT JOIN dbo.Carrera_Administrativa CA
	on CA.id_INterna = dp.id_interna
	and id_Carrera = (select top 1 id_carrera from dbo.Carrera_administrativa where id_interna = dp.id_interna and datodebaja =0 and datonoimprime = 0 order by fecha_desde desc )

LEFT JOIN dbo.VW_Desglose_NivelGrado DNG
	on DNG.id_interna = DP.Id_Interna

LEFT JOIN dbo.designaciones D
	on D.id_interna = dp.id_interna AND
--	and d.fecha_hasta =''01/01/2006''	
	-- ORIGINAL (FAML 14/04/2010 lo cambie porque al convertir a texto, no tomaba la MAYOR FECHA)convert(char,D.Fecha_Desde,103)+ cast(id_designacion as char) = (Select Max( convert(char,Fecha_Desde,103)+cast(id_designacion as char)) from dbo.Designaciones Where Id_Interna = DP.Id_Interna)  
D.Fecha_Desde=(Select Max( Fecha_Desde) from dbo.Designaciones Where Id_Interna = DP.Id_Interna)

LEFT JOIN dbo.Tabla_Niveles TN
--	on tn.id = d.id_nivel
---	on tn.id = CA.id_nivel
	ON tn.id = DNG.Id_Nivel


LEFT JOIN dbo.Tabla_Grados TG
--	on tg.id = d.id_grado
--	on tg.id = CA.id_grado
	on TG.id = DNG.Id_Grado


INNER JOIN dbo.VW_Desglose_Area DSA
	on DSA.Id_interna = DP.Id_Interna

LEFT JOIN dbo.Tabla_Areas TA
--	on TA.id = d.area
	on TA.Id = DSA.Id_Area


INNER JOIN dbo.VW_Desglose_Planta DSP
	on DSP.Id_Interna = DP.ID_Interna

LEFT JOIN dbo.Tipo_de_Planta TTP
--	on TTP.id = d.id_planta
	on TTP.id = DSP.Id_Planta

LEFT JOIN dbo.Tabla_cargos TC
	on tc.id = d.id_cargo


LEFT JOIN dbo.Tabla_Agrupamiento TAG
	on TAG.id = ca.id_agrupamiento

LEFT JOIN dbo.Designaciones_fechas DF
	on DF.id_interna = dp.id_interna

LEFT JOIN dbo.Antiguedad ANT
	on ANT.id_interna = dp.id_Interna

LEFT JOIN dbo.Legajo_bajas LB
	on LB.id_Interna = dp.id_interna


WHERE  dp.nro_documento = @documento

--order by er.fecha_egreso desc
order by LER.fecha_egreso desc
' 
END
GO
/****** Object:  StoredProcedure [dbo].[CON_CONSULTA_RAPIDA_CONTRATOS]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CON_CONSULTA_RAPIDA_CONTRATOS]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE            PROCEDURE [dbo].[CON_CONSULTA_RAPIDA_CONTRATOS]  
 @Documento int  
AS
SELECT dp.apellido +'', ''+ dp.nombre Apellido,  
 convert(varchar(10),dp.fecha_nacimiento,103) FechaNacimiento,  
 dbo.FxCalcula_Edad (dp.fecha_nacimiento,getdate()) Edad,  
 left(dp.cuil_nro,2)+''-''+right(left(dp.cuil_nro,10),8)+''-''+right(dp.cuil_nro,1)Cuit,  
 case when dp.sexo = 1 then  
  ''Masculino''  
 else  
  ''Femenino''  
 end Sexo,  
 ec.descripcion EstadoCivil,  
 DI.descripcion +''- '' + Convert(varchar,dp.nro_documento)   Documento,  
 domp.calle +''-''+ convert(varchar(5),domp.número) +  
 case when (not domp.piso is null) and (domp.piso <>'' '') then  
  '' Piso: '' + isnull(domp.piso,'''')  
 else  
  ''''  
 end +   
 case when (not domp.dpto is null) and (domp.dpto <> '''') then  
  '' Dpto: '' + isnull(domp.dpto,'''')  
 else ''''  
 end +   
 ''-('' + convert(varchar,domp.codigo_postal) + '') '' + loc.nombrelocalidad Domicilio,  
   

-- er.titulo + '' ('' + ne.descripcion + '')'' Estudio,  
 TET.descripcion +  '' ('' + TEN.descripcion + '')'' + CASE WHEN LER.completo = 1 THEN '' (Incompleto)'' ELSE '''' END   Estudio,

 convert(varchar(10),c.desde,103) Desde,  
 convert(varchar(10),c.hasta,103) Hasta,  
 tn.nivel + tg.grado NivelGrado,  
 tf.descripcion + tr.descripcion FuncionRango,  
  
 ta.descripcion Sector,  
  
 convert(varchar(10),cB.fecha_baja,103) FechaBajaContrato,  
 convert(varchar(10),LB.fecha_baja,103) FechaBajaContratado,  
 c.nro_Contrato NroContrato,  
 trc.descripcion TipoContrato,  
 case when c.excepcion = 1 then  
  ''Sí''  
 else  
  ''No''    
 end excepcion,  
 case when c.enmienda = 1 then  
  ''Sí''  
 else  
  ''No''  
 end enmienda,  
 case when c.aprobado = 1 then  
  ''Sí''  
 else  
  ''No''  
 end aprobado,  
 case when c.impreso = 1 then  
  ''Sí''  
 else  
  ''No''  
 end impreso,  
 --fc.apellido Firmante,  
ttt.Descripcion +'' ''+ DPF.Apellido +'' ''+ DPF.Nombre  Firmante,
case when firmado = 1 then  
  ''Sí''  
 else  
  ''No''   
 end Firmado,  
 monto,  
 c.baja BajaContrato,  
 case when LB.Fecha_baja IS NULL THEN  
  0  
 ELSE  
  1  
 END BajaPersona  
   
  
  
FROM dbo.Datos_Personales DP  
  
LEFT JOIN dbo.Legajo_Bajas LB  
 on LB.Nro_Doc = DP.Nro_Documento  
  
LEFT JOIN dbo.Tabla_Estado_Civil EC  
 on EC.id = dp.estado_civil  
  
LEFT JOIN dbo.Tabla_DocIdentidad DI  
 on DI.id = dp.tipo_documento  
  
LEFT JOIN dbo.Domicilio_Personal DOMP  
 on DOMP.nro_doc = dp.Nro_Documento  
  
--	LEFT JOIN dbo.Estudios_Realizados ER  
--	 on er.nro_doc = dp.nro_documento and  
--	 er.id_estudio = (select max(id_estudio) from dbo.Estudios_Realizados where nro_doc = dp.nro_Documento)  
	  
--	LEFT JOIN dbo.tabla_nivel_estudios NE  
--	 on ne.id = er.nivel  



  LEFT JOIN dbo.LEG_Estudios_Realizados LER
	ON 	LER.id = (select top 1 LER1.id from dbo.LEG_Estudios_Realizados LER1
		  LEFT JOIN dbo.Tabla_Estudios_Niveles TEN1
		on TEN1.id = LER1.Id_Nivel
		where LER1.Id_Interna = dp.id_interna
		and LER1.DatoDeBaja =0
		order by  TEN1.ORDEN desc,LER1.fecha_egreso desc)
	
  LEFT JOIN dbo.Tabla_Estudios_Titulos TET
	on TET.id = LER.Id_Titulo

  LEFT JOIN dbo.Tabla_Estudios_Niveles TEN
	on TEN.id = LER.Id_Nivel
  
LEFT JOIN dbo.CTR_Contratos C  
 on C.Nro_Documento = dp.Nro_Documento  
 and c.id_Contrato = (select max(id_Contrato) from dbo.CTR_Contratos where Nro_Documento = dp.Nro_Documento and (Aprobado = 1 OR Alta_Prov_Leg = 1))  
  
left join dbo.CTR_Contratos_Bajas CB  
 on CB.Id_Contrato = C.Id_Contrato  
  
LEFT JOIN dbo.Tabla_Niveles TN  
 on tn.id = c.nivel  
  
LEFT JOIN dbo.Tabla_Grados TG  
 on tg.id = c.grado  
  
LEFT JOIN dbo.Tabla_Funciones_Contratos TF  
 on tf.id = c.funcion  
  
LEFT JOIN dbo.Tabla_Rangos TR  
 on tr.id = c.rango  
  
INNER JOIN dbo.VW_Desglose_Area DA  
 on DA.Documento = DP.Nro_Documento  
  
LEFT JOIN dbo.Tabla_Areas TA  
 on TA.id = DA.id_area  
 --on TA.id = c.id_area  
  
LEFT JOIN dbo.Tabla_resoluciones_Contratos TRC  
 on TRC.id = c.tipo_contrato  
  
--left JOIN dbo.CFirmantes_Contratos FC  
 --on FC.id = c.Contrato_Firmante  
LEFT join dbo.Tabla_Firmantes TFC
	on TFC.id = c.Contrato_Firmante
left join dbo.datos_personales DPF
	on TFC.nro_documento=DPF.nro_documento
inner join dbo.tabla_tratamientos TT
	on TT.id=tfc.id_tratamiento
inner join dbo.tabla_tratamientos_titulos TTT
	on TTT.id=tfc.id_titulo  


left join dbo.localidadesafip LOC  
 on LOC.idlocalidad = domp.localidad  
  
  
WHERE dp.Nro_Documento = @documento
' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_GET_Dotacion_Completa_Calculo_Vacaciones]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_GET_Dotacion_Completa_Calculo_Vacaciones]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[RH_GET_Dotacion_Completa_Calculo_Vacaciones]  
--legajo  
--documento  
--ingreso_ministerio  
as  
declare @algo int    
Begin  
    
exec @algo=dbo.RH_GET_Dotacion_Completa_Parametro @Borrar_Tabla_Temporal=1    
    
    
select dota.id_interna legajo,    
       dota.nro_documento documento,    
       dat_pers.Tipo_Documento,    
       dat_pers.Cuil_Nro,    
       dat_pers.apellido,    
       dat_pers.nombre,    
       dat_pers.Sexo,    
       dat_pers.Estado_Civil Id_Estado_Civil,    
       dat_pers.Fecha_Nacimiento,    
       dat_pers.Lugar_Nacimiento,    
       dat_pers.Nacionalidad Id_Nacionalidad,    
       domicilio.ID_Domicilio,    
       domicilio.Fecha_Comunicacion fecha_comunicacion,    
       desig_fecha.Fecha_Min ingreso_ministerio,  
 domicilio.Calle calle,    
  domicilio.Número numero,    
 domicilio.Dpto,    
  domicilio.piso,    
 domicilio.Localidad,    
  domicilio.Provincia,    
       dota.Id_Planta,    
       dota.Id_Designacion_Planta,    
        dota.id_area,    
       dota.id_nivel,    
        dota.id_grado,    
        dota.Id_Contrato    
      
from dbo.tabla_Temporal_Dotacion_Completa dota    
    
INNER join     
 dbo.Datos_Personales dat_pers    
 ON    
 dat_pers.id_interna = dota.id_interna    
inner join     
  dbo.Domicilio_Personal domicilio    
  on      
  domicilio.Nro_Doc=dat_pers.nro_documento --dp2.Nro_Doc    
 and domicilio.Fecha_Comunicacion = (select max(dp2.Fecha_Comunicacion) from Domicilio_Personal dp2 where dp2.Nro_Doc = domicilio.nro_doc and dp2.DatoDeBaja<>1  group by dp2.Nro_Doc  )    
 and domicilio.ID_Domicilio = (select max(dp2.Id_Domicilio) from Domicilio_Personal dp2 where dp2.Nro_Doc = domicilio.nro_doc and dp2.DatoDeBaja<>1 and dp2.Fecha_Comunicacion = (select max(dp3.Fecha_Comunicacion) from Domicilio_Personal dp3 where dp3.Nro_Doc = domicilio.nro_doc and dp3.DatoDeBaja<>1  group by dp3.Nro_Doc)  group by dp2.Nro_Doc  )    
inner join dbo.Designaciones_Fechas desig_fecha  
   on   
   desig_fecha.id_Interna=dota.id_interna   
   and desig_fecha.Nro_Doc=dota.nro_documento  
    
     
    
End   
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_Impresion_Contrato_GER]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Impresion_Contrato_GER]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_Impresion_Contrato_GER]
 @Id_Contrato int            
AS        
--declare @Id_Contrato int            
--set @Id_contrato = 11465    
           
declare @Doc int            
declare @Max_Iddom int            
            
set @Doc=(select nro_documento from ctr_contratos where id_contrato=@Id_Contrato)            
            
IF (select aprobado from dbo.ctr_contratos where id_contrato = @Id_contrato) = 1 BEGIN            
 set @Max_Iddom=(select id_domicilio from ctr_contratos where id_contrato=@Id_Contrato)            
end             
else begin            
 set @Max_Iddom=(select max(id_domicilio) from domicilio_personal where nro_doc=@doc and datodebaja=0)            
end            
            
            
SELECT  d.id_domicilio,            
 c.nro_contrato,            
 TC.id Tipo_Contrato,            
 TC.descripcion Desc_Contrato,             
 td.descripcion Tipo_Doc,              
 C.Nro_Documento,            
 C.[Id_contrato],            
 DP.Apellido,            
  DP.Nombre,            
 d.calle,            
 d.número nro,            
 d.Piso,            
 d.dpto,            
 d.casa,            
 d.manzana,            
 d.Barrio,            
 d.torre,            
 d.UF,            
            
 convert (char(10), C.[Desde],103) Desde ,            
 convert (char(10), C.[Hasta],103) Hasta,            
            
 case when  c.[Impreso] = 1 then            
  ''Si''            
 else            
  ''No''            
 end Impreso,            
            
 case when C.[Aprobado] =1 then            
  ''Si''            
 else            
  ''No''            
 end Aprobado,            
            
 dbo.FxCadena_Dependencia (ta.id) Dependencia,            
            
 ta.descripcion Secretaria,             
            
 --da.id_area,            
 c.id_area,            
-- ta.de_dela,            
 isnull(TT.Descripcion,'''')  de_DeLa,      
  
 ttff.descripcion +'' '' + ttt.Descripcion +'' ''+ DPF.Apellido +'' ''+ DPF.Nombre cargo,  
 isnull(TTFIR.Descripcion,'''') + '' '' +  TAFF.descripcion     Nombre_Cont,    
  
 -- ORIGINARIOS  
 --ttff.descripcion +'' '' + tcf.descripcion   + '' '' +  isnull(TT.Descripcion,'''') + '' '' +  TAFF.descripcion  cargo ,  -- cfc.cargo            
 -- ttt.Descripcion +'' ''+ DPF.Apellido +'' ''+ DPF.Nombre  Nombre_Cont,  --cfc.Apellido Nombre_Cont,            
  
TADF.calle +'' ''+ TADF.nro +'' piso ''+ tadf.piso +'', ''+ LF.nombrelocalidad direccion, -- cfc.direccion,            
    
 case when tc.tipo_contrato = 1 then            
  fc.descripcion              
 else            
  ccf.funcion            
 end Funcion,            
 case when tc.tipo_contrato = 2 then            
  ccf.CargaHsSemLetras            
 else            
  ''No Corresponde''             
 end HS_Letra,            
 case when tc.tipo_contrato = 2 then            
  ccf.CargaHsSemNro            
 else            
  0            
 end hs_nro,            
 case when tc.tipo_contrato = 1 then            
  fc.objeto            
 else            
  ccf.objeto            
 end Objeto,            
 tn.nivel,            
 tg.grado,            
 tgl.letra,             
 c.excepcion,            
 tr.descripcion Rango,            
 c.monto,            
  '', '' + loc.nombrelocalidad  + (case when prov.nombreProvincia <> '''' then '', Provincia de ''+  prov.nombreProvincia else '''' end) Localidad,            
 c.firmado,            
            
 case when c.fecha_impresion is null THEN            
  Getdate()            
 else            
  c.fecha_impresion            
 end Fecha_Impresion,            
            
 c.enmienda,             
 c.acto_nro,            
 ttc.sendlegajos,  --MODALIDAD            
 left(tae.codigo,4) codigo 

           
          
FROM dbo.CTR_Contratos  C            
            
--LEFT JOIN dbo.Domicilio_personal DomLeg            
-- on DomLeg.nro_doc =c.Nro_Documento and domleg.fecha_comunicacion = (select max(fecha_comunicacion) from domicilio_personal where nro_doc = c.Nro_Documento)            
            
LEFT JOIN dbo.Domicilio_Personal D            
 on D.id_domicilio = @max_iddom            
    
LEFT JOIN dbo.tabla_funciones_contratos FC  --1184            
 on fc.id=c.funcion            
            
LEFT JOIN dbo.tabla_rangos TR            
 on tr.id = c.rango            
            
LEFT JOIN  dbo.Datos_Personales DP            
 on DP.Nro_Documento = C.Nro_Documento            
            
LEFT JOIN dbo.Tabla_DocIdentidad TD            
 on td.id = dp.tipo_documento             
            
LEFT JOIN dbo.Tabla_Resoluciones_Contratos TC            
 on TC.id = C.tipo_contrato            
        
INNER JOIN dbo.Tabla_Tipos_Contratos TTC            
 on TTC.Id = TC.Tipo_Contrato            
            
--LEFT JOIN dbo.vw_desglose_area da            
-- on c.nro_documento = da.documento            
            
LEFT JOIN dbo.tabla_areas TA            
 on (TA.id = c.id_area)             
            
LEFT JOIN dbo.Tabla_Areas_Detalle TAD            
 on TAD.Id_Area = TA.id            
            
LEFT JOIN dbo.Tabla_Tratamientos TT            
 on TT.Id = TAD.Tratamiento_Area AND TT.Tipo = ''A''            
  
  
LEFT JOIN dbo.Tabla_Tratamientos TTFF            
 on TTff.Id = TAD.Tratamiento AND ttff.Tipo = ''P''            
  
             
--LEFT JOIN dbo.cfirmantes_contratos cfc            
-- on cfc.id= c.Contrato_Firmante            
-------------        
LEFT join dbo.Tabla_Firmantes TFC      
 on TFC.id = C.contrato_Firmante      
      
left join dbo.datos_personales DPF      
 on TFC.nro_documento = DPF.nro_documento      
      
left join dbo.tabla_tratamientos TTF      
 on TTF.id = tfc.id_tratamiento      
      
left join dbo.tabla_tratamientos_titulos TTT      
 on TTT.id = tfc.id_titulo      
      
left join dbo.tabla_cargos TCF      
 on TCF.id = TFC.cargo        
      
LEFT join dbo.domicilio_personal DF                    
 on df.nro_doc = TFC.nro_documento       
 and d.id_domicilio = (select max(id_domicilio) from domicilio_personal where nro_doc = TFC.nro_documento)         
      
      
left join dbo.tabla_areas_detalle TADF      
 on tadf.id_area = TFC.area      
      
LEFT JOIN dbo.tabla_areas TAFF            
 on TAFF.id = TADF.id_area    
    
LEFT JOIN dbo.Tabla_Tratamientos TTFIR            
 on TTFIR.Id = TADF.Tratamiento_Area AND TTFIR.Tipo = ''A''


left join dbo.localidadesafip LF      
 on LF.idLocalidad  = TADF.Localidad      
                 
-------------      
          
LEFT JOIN dbo.tabla_niveles TN            
 on tn.id=c.nivel            
            
LEFT JOIN dbo.tabla_grados TG            
 on tg.id=c.grado            
            
LEFT JOIN dbo.tabla_grado_letras TGL            
 on tgl.grado=tg.grado            
            
LEFT JOIN dbo.ccontrato_funciones CCF  --1421            
 on ccf.id_nivel=tn.id            
            
LEFT JOIN dbo.localidadesafip LOC            
 on (LOC.idLocalidad = d.localidad)             
            
LEFT JOIN dbo.provincias Prov            
 on prov.codAFIP = loc.id_provincia                     
            
inner join Tabla_Areas_Estructura TAE          
 on TAE.id_area=c.id_area          
 and right(TAE.codigo,5)= convert(varchar(5),replicate(''0'', 5 - datalength(ltrim(rtrim(tae.id_area))))) + convert(varchar(5),tae.id_area)          
          
WHERE Id_Contrato = @Id_Contrato            
            
            
--***** ACTUALIZA ID_DOMICILIO EN CTR_CONTRATOS ****----            
IF (select aprobado from dbo.ctr_contratos where id_contrato = @Id_contrato) = 0 BEGIN            
 IF (select Impreso from dbo.ctr_contratos where id_contrato = @Id_contrato) = 0 BEGIN            
  update ctr_contratos            
  set id_domicilio=@max_iddom            
  where id_contrato=@id_contrato            
 END            
 else BEGIN            
  update ctr_contratos            
  set id_domicilio=@max_iddom,             
   firmado=0,            
      exp_nro=null            
  where id_contrato=@id_contrato             
 end            
end            
            
            
            
    
  ' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_GET_Recibo_X_Id]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_GET_Recibo_X_Id]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'  
CREATE procedure [dbo].[PLA_GET_Recibo_X_Id]        
 @Id_Recibo int,        
 @Impreso bit=NULL,        
 @Entregado bit=Null,        
 @Recibido bit=NULL        
AS  
SELECT  R.Id_Interna,        
 Mes,        
 Año,        
 Cuil,        
 Nivel,        
 Grado,        
 Impreso,        
 id_Oficina,        
 Entregado,        
 Recibido,        
 DP.Apellido +'', ''+ DP.Nombre Agente ,      
 TA.Descripcion Area  ,    
 ISNULL(     
 ISNULL(DM.Calle,'''') +'' ''+ ISNULL(cast(DM.número as varchar),'''') +''''+     
 CASE WHEN NOT DM.Piso IS NULL THEN    
 '' Piso: '' + DM.Piso    
 END  +''''+     
 CASE WHEN NOT DM.Dpto IS NULL THEN    
 '' Dpto: '' + DM.Dpto    
 END,'''')  Domicilio    
       
FROM dbo.PLA_Recibos R        
INNER JOIN dbo.Datos_Personales DP        
 on right(left(dp.Cuil_Nro,10),8) =  right(left(R.cuil,11),8) --on DP.Id_Interna = R.Id_Interna        
INNER JOIN dbo.VW_Desglose_Area DA      
 on DA.Documento = DP.Nro_Documento      
INNER JOIN dbo.Tabla_Areas TA      
 on TA.Id = Da.Id_Area      
LEFT JOIN dbo.Domicilio_Personal DM    
 ON Id_Domicilio = (select top 1 id_domicilio From dbo.Domicilio_Personal     
   Where Nro_Doc = DP.Nro_Documento and DatoDeBaja = 0    
   order by convert(char,fecha_comunicacion,112) desc )    
    
WHERE  Id_Recibo = @Id_Recibo AND        
 (Impreso =  @Impreso OR @Impreso IS NULL) AND        
 (Entregado = @Entregado OR @Entregado IS NULL) AND        
 (Recibido = @Recibido OR @Recibido IS NULL)  ' 
END
GO
/****** Object:  StoredProcedure [dbo].[LIQ_Exportar_Txt_Bco_Nacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_Exportar_Txt_Bco_Nacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[LIQ_Exportar_Txt_Bco_Nacion]  
 @id int              
AS
SELECT
  
--DATOS BANCO  
NC.Proceso,  
NC.Servicio,  
NC.Sucur_Bco,  
dp.Id_Interna,  
isnull(NC.Moneda,''P'') Moneda,  
''SF'' Titularidad,  
Limite_Tarjeta,  
   
--DATOS PERSONALES  
''F'' Tipo_Persona,  
dp.apellido,              
dp.nombre,              
case when dp.tipo_documento=1 then               
 ''DU''              
else              
case when dp.tipo_documento=2 or dp.tipo_documento=3 then              
 TD.Descripcion              
else              
 ''CF''              
end              
end Tipo_Doc,                        
dp.nro_documento,              
''EXE'' IVA,  
''2'' CUIL,  
DP.CUIL_Nro,  
convert(char(8),dp.fecha_nacimiento,112) Fecha_Nacimiento,  
TN.Codigo_Banco_Nacion Nacionalidad,  
case when dp.sexo=1 then              
 ''M''              
else              
 ''F''              
end Sexo,              
EC.Codigo_Banco_Nacion Estado_Civil,  
  
--DOMICILIO PARTICULAR  
DOM.calle Dom_Calle,  
case when DOM.Número is null or ltrim(rtrim(DOM.Número)) = 0  then               
 ''''              
else              
 DOM.Número   
end Dom_Numero,    
DOM.piso Dom_Piso,              
DOM.dpto Dom_Dpto,              
DOM.codigo_postal Dom_CP,               
L.nombrelocalidad Dom_Localidad,             
P.cod_bco_nacion Dom_Cod_Prov,              
DOM.Telefono Dom_Telefono,  
      
--DOMICILIO LABORAL  
DPB.Calle Lab_Calle,  
case when DPB.Numero is null or ltrim(rtrim(DPB.Numero)) = 0  then               
 ''''              
else              
 DPB.Numero   
end Lab_Numero,   
DPB.Piso Lab_Piso,  
DPB.CP Lab_CP,  
LL.nombrelocalidad Lab_Localidad,  
PL.cod_bco_nacion Lab_Cod_Prov,  
DPB.Telefono Lab_Telefono,  
DPB.Fax Lab_Fax  
  
FROM datos_personales DP              
               
inner join Domicilio_Personal DOM              
-- on dp.nro_documento=dom.nro_doc and id_domicilio = (select max(id_domicilio) from domicilio_personal where id_interna = dp.id_interna)              
   on dp.nro_documento=dom.nro_doc and id_domicilio = (select max(id_domicilio) from domicilio_personal where nro_doc = dp.nro_documento)                        
    
inner join liq_nro_cuenta_nacion NC              
 on nc.documento=dp.nro_documento              
              
inner join localidadesafip L              
 on L.idlocalidad=dom.localidad              
              
inner join provincias P              
 on p.codafip=l.id_provincia and l.codigopostal=dom.codigo_postal     
          
left join ctr_contratos C            
 on c.nro_documento=dp.nro_documento and c.id_contrato=(select max(id_contrato) from CTR_Contratos where nro_documento=dp.nro_documento)          
          
left join dbo.vw_desglose_area DA  
 on da.documento = dp.nro_documento  
              
left join tabla_nomina_bancos NB  
 on nb.codigo=nc.id_banco  
      
  
INNER JOIN dbo.Tabla_DocIdentidad TD  
 on td.id = dp.Tipo_Documento  
  
INNER JOIN dbo.Tabla_Nacionalidad TN  
 on TN.id = DP.Nacionalidad  
  
INNER JOIN dbo.Tabla_Estado_Civil EC  
 on EC.id = DP.Estado_Civil  
  
INNER JOIN Tabla_Domicilio_Pago_Banco DPB  
 on DPB.Id_DomPago = NC.Id_Dom_Pago  
  
LEFT join localidadesafip LL              
 on LL.codigopostal = DPB.CP  
  
inner join provincias PL              
 on PL.codafip = LL.id_provincia and LL.codigopostal = DPB.CP  
  
where nc.id=@id
' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_LEG_Incorporacion_Contratado]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_LEG_Incorporacion_Contratado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[RH_LEG_Incorporacion_Contratado]            
 @Operacion char(1),            
 @Id int,            
 @Usuario_RX smallint=NULL,            
 @Id_Interna int=null            
            
AS            
IF @Operacion = ''S'' BEGIN            
 SELECT DP.Nro_Documento Documento,            
  Apellido +'', ''+ Nombre Apellido            
 FROM dbo.RH_Traspaso_Documentacion TD            
 INNER JOIN dbo.Datos_Personales DP            
  on DP.Nro_Documento = TD.Registro            
 WHERE  Id = @Id             
END            
            
IF @Operacion = ''I'' BEGIN            
  UPDATE dbo.RH_Traspaso_Documentacion            
  SET Usuario_Rx = @Usuario_RX,             
   Fecha_Rx = Getdate()            
  WHERE Id = @Id            
             
 --REGISTRA INCORPORACION PARA ASISTENCIA Y LEGAJOS           
 Declare @Documento int          
 set @Documento =(select Registro from dbo.RH_Traspaso_Documentacion where Id = @Id)          
        
 exec RH_ADD_Traspaso_Documentacion 5, @Usuario_RX,''Incorporación de Agente'', ''Datos Personales'', @Documento, 3, ''CAIPP''        
      
-- NO SE INFORMA MAS DE LA INCORPORACION DE CONTRATADO A LEGAJOS      
-- exec RH_ADD_Traspaso_Documentacion 5, @Usuario_RX,''Incorporación de Agente'', ''Datos Personales'', @Documento, 2, ''ILAG''          
         
        
        
--ACTUALIZACION DE ID_INTERNA             
 DECLARE @Doc int            
 Set @Doc = (SELECT Registro from dbo.RH_Traspaso_Documentacion WHERE Id = @Id)            
             
-- DELETE FROM dbo.web_sincronizacion_datospersonales where id_interna = @Doc            
            
 UPDATE dbo.Datos_Personales            
 SET Id_Interna =  @Id_interna,            
  VisibleLegajos = 1            
 WHERE Nro_Documento = @Doc            
            
 UPDATE dbo.Domicilio_Personal            
 SET Id_Interna = @Id_Interna            
 WHERE Nro_Doc = @Doc            
            
 UPDATE dbo.Estudios_Realizados            
 SET  Id_Interna = @Id_interna            
 WHERE Nro_Doc = @Doc            
            
 UPDATE dbo.LEG_Desglose_Area             
 SET  Id_Interna = @Id_interna            
 WHERE Documento = @Doc            
            
 UPDATE dbo.LEG_Desglose_Planta             
 SET  Id_Interna = @Id_interna            
 WHERE Documento = @Doc            
            
 UPDATE dbo.LEG_Otros_Servicios            
 SET  Id_Interna = @Id_interna,            
  Folio = ''99-999/999''            
 WHERE Id_interna = @Doc            
            
 UPDATE dbo.LEG_Servicios_Adm_Publica            
 SET  Id_Interna = @Id_interna--,            
--  Folio = ''99-999/999''            
 WHERE Doc_Titular = @Doc            
            
 UPDATE dbo.leg_desglose_ur  
 SET  Id_Interna = @Id_interna   
 WHERE Documento = @Doc            
             
 DECLARE @IdContrato int            
 DECLARE @MaxId int            
 SET @IdContrato = (            
  SELECT max(Id_Contrato)             
  FROM dbo.CTR_Contratos             
  WHERE nro_Documento = @Doc and Aprobado = 1 and Baja =0)            
            
 SET @MaxId = (Select max(Id)+1 FROM dbo.Leg_Desglose_NivelGrado)            
            
 INSERT INTO dbo.LEG_Desglose_NivelGrado            
 SELECT  @MAxId,            
  @Id_interna,            
  @Doc,            
  Nivel,             
  Grado,            
  Desde,            
  ''MDS'',            
  ''MDS'',            
  ''99-999/999'',            
  Acto_Tipo,            
  Acto_Nro,            
  Acto_Fecha,            
  Usuario             
  from dbo.Ctr_Contratos             
  Where Id_Contrato = @IdContrato            
            
            
            
            
 UPDATE dbo.LEG_Desglose_NivelGrado            
 SET  Id_Interna = @Id_interna            
 WHERE Documento = @Doc            
            
 DECLARE @FechaMin datetime            
 SET @FechaMin = (          
          
Select min(Desde)           
 from dbo.CTR_Contratos C          
 INNER JOIN dbo.tabla_resoluciones_Contratos TRC          
  ON TRC.Id = C.Tipo_Contrato          
 INNER JOIN dbo.Tabla_Tipos_Contratos TTC          
  ON TTC.Id = TRC.Tipo_Contrato          
 WHERE Nro_Documento = @Doc           
  and SendLegajos =  1)            
          
            
 INSERT INTO dbo.Designaciones_Fechas            
 VALUES (NULL,ISNULL(@FechaMin,GETDATE()) , @Doc, @Id_interna)            
            
END            
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_PLA_Recibo_Haberes_Header]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_PLA_Recibo_Haberes_Header]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[RPT_PLA_Recibo_Haberes_Header]                                      
 @Id_recibo int                      
AS
DECLARE @canti int    
DECLARE @nota varchar(5000)  
set @nota = ''''
          
select @canti = count(*) from dbo.pla_recibos_detalle            
where id_recibo = @Id_recibo            
  
  
IF (select Count(*) from PLA_Recibos_Detalle   
 where Id_Recibo = @Id_Recibo and ltrim(rtrim(Concepto)) = ''148''   
 and mes = 4 and año = 2012) > 0  
BEGIN   
 SET @nota = ''Nota: Para aquellos recibos del mes 03/2012 donde se haya consignado el concepto "148 - ANTIGUEDAD PERS.JUBIL."  
 deberá considerarse la leyenda "148 - COMPENS.DCTO.39/2012"''  
END  
            
            
SELECT                           
 R.Id_Recibo ,                          
 R.Id_Interna Legajo,                            
 Dp.Apellido +'', ''+ DP.Nombre Agente,                            
 R.CUIL,                            
 R.Id_Oficina Oficina,                            
 R.Nro_Orden Orden,                            
 R.Nivel +''-''+ R.Grado NivelGrado,                            
 cast(R.Mes as varchar(2)) +''/''+ cast(R.Año as varchar(4)) F_Liquidacion ,                            
 (CASE WHEN R.F_Ingreso IS NULL       
  THEN desfecha.Fecha_Min       
  ELSE       
   (CASE WHEN R.F_Ingreso = ''01/01/1900''       
    THEN desfecha.Fecha_Min      
    ELSE R.F_Ingreso       
    END )       
    END )      
     AS FechaIngreso,      
 R.NroCta +'' ''+ R.Banco Banco,                            
 convert(varchar(12),CONVERT(DECIMAL(10,2),R.SBruto)) SBruto,    
 convert(varchar(12),CONVERT(DECIMAL(10,2),R.SNeto)) SNeto,    
 convert(varchar(12),CONVERT(DECIMAL(10,2),R.SDescuentos)) SDescuentos,       
 R.F_Deposito,                    
 ISNULL(                     
 ISNULL(DM.Calle,'''') +'' ''+ ISNULL(cast(DM.número as varchar),'''') +''''+                     
 CASE WHEN NOT DM.Piso IS NULL THEN                    
 '' Piso: '' + DM.Piso                    
 END  +''''+                     
 CASE WHEN NOT DM.Dpto IS NULL THEN                    
 '' Dpto: '' + DM.Dpto                    
 END,'''')  + ''(''+ loc.NombreLocalidad +'')'' Domicilio,                    
-- AE.Codigo Area,                    
 DP.Nro_Documento    ,                
 TipoLiquidacion  ,              
 dbo.FxCadena_Dependencia (da.id_area) area    ,              
ISNULL(opcionJubilatoria,'''') opcionJubilatoria,              
ISNULL(afjp,'''') afjp,              
@canti canti,  
@nota nota      
            
FROM dbo.pla_recibos R                            
INNER JOIN dbo.Datos_Personales DP                               
  on right(left(dp.Cuil_Nro,10),8) =  right(left(R.cuil,11),8)   -- ON DP.Id_interna = R.Id_Interna             
      
Left Join dbo.Designaciones_Fechas desfecha      
 on desfecha.Nro_Doc = DP.Nro_Documento      
          
LEFT JOIN dbo.Domicilio_Personal DM                    
 ON Id_Domicilio = (select top 1 id_domicilio From dbo.Domicilio_Personal                     
   Where Nro_Doc = DP.Nro_Documento and DatoDeBaja = 0                    
   order by convert(char,fecha_comunicacion,112) desc )                    
              
inner join localidadesafip loc              
 on loc.idlocalidad = dm.localidad              
                    
left JOIN dbo.VW_Desglose_Area DA                    
 on DA.Documento = DP.Nro_Documento                    
--   and desde = (Select top 1 max(desde) from LEG_Desglose_Area         
 -- where desde <= ''28/'' + cast(R.Mes as varchar(2)) +''/''+ cast(R.Año as varchar(4)))              
          
left JOIN dbo.Tabla_Areas_Estructura AE                    
 ON AE.Id_Area = DA.Id_Area           
  AND right(codigo,5) = ''00000''                    
          
WHERE R.Id_Recibo = @Id_Recibo
' 
END
GO
/****** Object:  View [dbo].[VW_LIQ_Datos_Banco]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_LIQ_Datos_Banco]'))
EXEC dbo.sp_executesql @statement = N'CREATE view [dbo].[VW_LIQ_Datos_Banco]               
as                  
select  top 100 percent   
 dp.nro_documento,                         
 dp.Apellido +'', ''+ dp.Nombre  NomApe,                                   
   NULL id_area, -- ta.id id_area,                        
   NULL area,    -- ta.Descripcion area,                         
     
 case when id_provincia=0 then                        
     l.nombrelocalidad                         
   else                        
     l.nombrelocalidad +'' / ''+ p.nombreProvincia                         
   end localidad,                         
                         
    NULL Id_dom_pago, -- tad.id_area Id_dom_pago,                        
                         
 ltrim(rtrim(dom.calle)) Calle_dom,                          
 ltrim(rtrim(dom.Número)) Nro_dom,                          
 ltrim(rtrim(dom.piso)) Piso_dom,                          
 ltrim(rtrim(dom.dpto)) dpto_dom,                                                
  
 NULL calle_pago,                         
 NULL nro_pago,                        
 NULL piso_pago,                        
 NULL dpto_pago,                                        
 LDP.Id_Planta Tipo_Planta,                        
 TTP.descripcion planta,                                            
  
  CASE WHEN TN.Nivel IS NOT NULL THEN            
     TN.Nivel            
  END Nivel,            
           
  CASE WHEN TG.Grado IS NOT NULL THEN              
    TG.Grado            
  END Grado,            
           
  CASE WHEN TF.descripcion IS NOT NULL THEN           
    TF.descripcion                    
  end funcion,             
            
  CASE WHEN TRG.descripcion IS NOT NULL THEN           
    TRG.descripcion           
  end  rango,                           
           
  CASE WHEN TN.Nivel IS NULL THEN            
    c.monto             
  ELSE            
   -- TS.Remuneracion_Fija  --mld:09/08/07 Modifacion tabla Sinapa        
     dbo.Fx_Monto_Sinapa (tn.nivel, tg.grado, c.Desde)        
  END Monto,          
          
  ec.id id_estado_civil,                        
  EC.descripcion Estado_civil,                    
                    
 case ec.id                    
  when 0  then ''S''                    
  when 1  then ''S''                    
  when 7  then ''S''                    
  when 2  then ''C''                    
  when 5  then ''C''                    
  when 6  then ''C''                    
  when 3 then ''V''                     
  when 4 then ''D''                    
 end letra_EC,                    
                    
 ''2'' Id_Tipo_Cuenta,                    
 null Tipo_Cuenta,                    
 NULL Nro_cuenta,                    
 NULL CBU,                    
 ''34'' id_banco,                    
 NULL Sucur_bco,                    
 NULL exportado,     
 DP.Cuil_Nro CUIL  
  
                  
from dbo.datos_personales dp                        
                  
inner join dbo.Domicilio_Personal Dom                          
 on dp.nro_documento=dom.nro_doc and id_domicilio = (select max(id_domicilio) from domicilio_personal where nro_doc = dp.nro_documento)                          
                        
inner join dbo.localidadesafip L                          
 on L.idlocalidad=dom.localidad                         
                        
inner join dbo.provincias p                          
 on  p.codafip=l.id_provincia                         
 and  l.codigopostal=dom.codigo_postal                        
                  
--left join dbo.vw_desglose_area da                        
-- on dp.nro_documento = da.documento                        
--LEFT join dbo.tabla_areas TA                        
-- on TA.id = da.id_area                        
--LEFT join dbo.tabla_areas_detalle TAD                        
-- on tad.id_area=TA.id                        
                    
left join dbo.leg_desglose_planta LDP                        
 on dp.nro_documento = ldp.Documento                       
     
left join dbo.tipo_de_planta TTP                        
 on ttp.id=LDP.Id_Planta    
                          
left join dbo.ctr_contratos C                        
 on c.nro_documento=dp.nro_documento                      
 --and nro_contrato = (select max(nro_contrato)                         
 --     from ctr_contratos                         
 --     where nro_documento = dp.nro_documento and c.baja=0)                          
                       
left  join dbo.tabla_niveles TN                          
 on TN.id = C.nivel                          
                          
left join dbo.tabla_grados TG                          
 on TG.id = c.grado                          
                        
left join dbo.tabla_funciones_contratos TF                          
 on TF.id = c.funcion                          
                          
LEFT join dbo.tabla_rangos TRG                          
 on TRG.id = c.rango                          
                  
inner join dbo.Tabla_Estado_Civil EC                        
 on ec.id=dp.estado_civil                        
                  
left join dbo.legajo_bajas LB                  
 on lb.ID_INTERNA =  DP.Id_interna                  
                  
-------------------------------------------------------------        
--LEFT JOIN dbo.Tabla_Sinapa TS     --MLD: MOdificacion SINAPA        
-- on (TS.Nivel = tn.nivel) AND            
--    (TS.grado = tg.grado)          
-------------------------------------------------------------        
where  lb.nro_doc IS NULL                       
 and (nro_contrato = (select max(nro_contrato) from ctr_contratos where nro_documento = dp.nro_documento and c.baja=0)  
	or nro_contrato is null)
  
order by apellido               
                  
                  
                  
                  
                
              
            
          
        
      
    
    
  

'
GO
/****** Object:  StoredProcedure [dbo].[CTR_Impresion_Contrato]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_Impresion_Contrato]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'    
CREATE procedure [dbo].[CTR_Impresion_Contrato]    
 @Id_Contrato int                
AS    
--declare @Id_Contrato int                
--set @Id_contrato = 11465        
               
declare @Doc int                
declare @Max_Iddom int                
                
set @Doc=(select nro_documento from ctr_contratos where id_contrato=@Id_Contrato)                
                
IF (select aprobado from dbo.ctr_contratos where id_contrato = @Id_contrato) = 1 BEGIN                
 set @Max_Iddom=(select id_domicilio from ctr_contratos where id_contrato=@Id_Contrato)                
end                 
else begin                
 set @Max_Iddom=(select max(id_domicilio) from domicilio_personal where nro_doc=@doc and datodebaja=0)                
end                
                
                
SELECT  d.id_domicilio,                
 c.nro_contrato,                
 TC.id Tipo_Contrato,                
 TC.descripcion Desc_Contrato,                 
 td.descripcion Tipo_Doc,                  
 C.Nro_Documento,                
 C.[Id_contrato],                
 DP.Apellido,                
  DP.Nombre,                
 d.calle,                
 d.número nro,                
 d.Piso,                
 d.dpto,                
 d.casa,                
 d.manzana,                
 d.Barrio,                
 d.torre,                
 d.UF,                
                
 convert (char(10), C.[Desde],103) Desde ,                
 convert (char(10), C.[Hasta],103) Hasta,                
                
 case when  c.[Impreso] = 1 then                
  ''Si''                
 else                
  ''No''                
 end Impreso,                
                
 case when C.[Aprobado] =1 then                
  ''Si''                
 else                
  ''No''                
 end Aprobado,                
                
 dbo.FxCadena_Dependencia (ta.id) Dependencia,                
                
 ta.descripcion Secretaria,                 
                
 --da.id_area,                
 c.id_area,                
-- ta.de_dela,                
 isnull(TT.Descripcion,'''')  de_DeLa,          
      
 ttff.descripcion +'' '' + ttt.Descripcion +'' ''+ DPF.Apellido +'' ''+ DPF.Nombre cargo,      
 isnull(TTFIR.Descripcion,'''') + '' '' +  TAFF.descripcion     Nombre_Cont,        
      
 -- ORIGINARIOS      
 --ttff.descripcion +'' '' + tcf.descripcion   + '' '' +  isnull(TT.Descripcion,'''') + '' '' +  TAFF.descripcion  cargo ,  -- cfc.cargo                
 -- ttt.Descripcion +'' ''+ DPF.Apellido +'' ''+ DPF.Nombre  Nombre_Cont,  --cfc.Apellido Nombre_Cont,                
      
TADF.calle +'' ''+ TADF.nro +'' piso ''+ tadf.piso +'', ''+ LF.nombrelocalidad direccion, -- cfc.direccion,                
        
 case when tc.tipo_contrato = 1 then                
  fc.descripcion                  
 else                
  ccf.funcion                
 end Funcion,                
 case when tc.tipo_contrato = 2 then                
  ccf.CargaHsSemLetras                
 else                
  ''No Corresponde''                 
 end HS_Letra,                
 case when tc.tipo_contrato = 2 then                
  ccf.CargaHsSemNro                
 else                
  0                
 end hs_nro,                
 case when tc.tipo_contrato = 1 then                
  fc.objeto                
 else                
  ccf.objeto                
 end Objeto,                
 tn.nivel,                
 tg.grado,                
 tgl.letra,                 
 c.excepcion,                
 tr.descripcion Rango,                
 c.monto, 

 case when prov.idprovincia = 2 then --C.A.B.A
	'', '' + loc.nombrelocalidad
 else                
	'', '' + loc.nombrelocalidad  + (case when prov.nombreProvincia <> '''' then '', Provincia de ''+  prov.nombreProvincia else '''' end)
 end Localidad,
 
c.firmado,                                
 case when c.fecha_impresion is null THEN                
  Getdate()                
 else                
  c.fecha_impresion                
 end Fecha_Impresion,                
                
 c.enmienda,                 
 c.acto_nro,                
 ttc.sendlegajos,  --MODALIDAD                
-- COMENTADO POR FABIAN PARA RENOVAR INAI XX -- left(tae.codigo,4) codigo     
''0101'' codigo,    
c.estado               
              
FROM dbo.CTR_Contratos  C                
                
--LEFT JOIN dbo.Domicilio_personal DomLeg     
-- on DomLeg.nro_doc =c.Nro_Documento and domleg.fecha_comunicacion = (select max(fecha_comunicacion) from domicilio_personal where nro_doc = c.Nro_Documento)                
                
LEFT JOIN dbo.Domicilio_Personal D                
 on D.id_domicilio = @max_iddom                
        
LEFT JOIN dbo.tabla_funciones_contratos FC  --1184                
 on fc.id=c.funcion                
                
LEFT JOIN dbo.tabla_rangos TR                
 on tr.id = c.rango                
                
LEFT JOIN  dbo.Datos_Personales DP                
 on DP.Nro_Documento = C.Nro_Documento                
                
LEFT JOIN dbo.Tabla_DocIdentidad TD                
 on td.id = dp.tipo_documento                 
                
LEFT JOIN dbo.Tabla_Resoluciones_Contratos TC                
 on TC.id = C.tipo_contrato                
            
INNER JOIN dbo.Tabla_Tipos_Contratos TTC                
 on TTC.Id = TC.Tipo_Contrato                
                
--LEFT JOIN dbo.vw_desglose_area da                
-- on c.nro_documento = da.documento                
                
LEFT JOIN dbo.tabla_areas TA                
 on (TA.id = c.id_area)                 
                
LEFT JOIN dbo.Tabla_Areas_Detalle TAD                
 on TAD.Id_Area = TA.id                
                
LEFT JOIN dbo.Tabla_Tratamientos TT                
 on TT.Id = TAD.Tratamiento_Area AND TT.Tipo = ''A''                
      
--faby  30/09/2010    
LEFT join dbo.Tabla_Firmantes TFC          
 on TFC.id = C.contrato_Firmante      
    
LEFT JOIN dbo.Tabla_Tratamientos TTFF                
 on TTff.Id = TFC.Id_Tratamiento AND ttff.Tipo = ''P''                
     
     
--LEFT JOIN dbo.Tabla_Tratamientos TTFF                
-- on TTff.Id = TAD.Tratamiento AND ttff.Tipo = ''P''                
--faby    30/09/2010    
      
                 
--LEFT JOIN dbo.cfirmantes_contratos cfc                
-- on cfc.id= c.Contrato_Firmante                
-------------            
--faby 30/09/2010    
--LEFT join dbo.Tabla_Firmantes TFC          
-- on TFC.id = C.contrato_Firmante          
-- faby 30/09/2010          
left join dbo.datos_personales DPF          
 on TFC.nro_documento = DPF.nro_documento          
          
left join dbo.tabla_tratamientos TTF          
 on TTF.id = tfc.id_tratamiento          
          
left join dbo.tabla_tratamientos_titulos TTT          
 on TTT.id = tfc.id_titulo          
          
left join dbo.tabla_cargos TCF          
 on TCF.id = TFC.cargo            
          
LEFT join dbo.domicilio_personal DF                        
 on df.nro_doc = TFC.nro_documento           
 and d.id_domicilio = (select max(id_domicilio) from domicilio_personal where nro_doc = TFC.nro_documento)             
          
          
left join dbo.tabla_areas_detalle TADF          
 on tadf.id_area = TFC.area          
          
LEFT JOIN dbo.tabla_areas TAFF                
 on TAFF.id = TADF.id_area        
        
LEFT JOIN dbo.Tabla_Tratamientos TTFIR                
 on TTFIR.Id = TADF.Tratamiento_Area AND TTFIR.Tipo = ''A''    
    
    
left join dbo.localidadesafip LF          
 on LF.idLocalidad  = TADF.Localidad          
                     
-------------          
              
LEFT JOIN dbo.tabla_niveles TN                
 on tn.id=c.nivel                
                
LEFT JOIN dbo.tabla_grados TG                
 on tg.id=c.grado                
                
LEFT JOIN dbo.tabla_grado_letras TGL                
 on tgl.grado=tg.grado                
                
LEFT JOIN dbo.ccontrato_funciones CCF  --1421                
 on ccf.id_nivel=tn.id                
                
LEFT JOIN dbo.localidadesafip LOC                
 on (LOC.idLocalidad = d.localidad)                 
                
LEFT JOIN dbo.provincias Prov                
 on prov.codAFIP = loc.id_provincia                         
                
inner join Tabla_Areas_Estructura TAE              
 on TAE.id_area=c.id_area              
 and right(TAE.codigo,5)= convert(varchar(5),replicate(''0'', 5 - datalength(ltrim(rtrim(tae.id_area))))) + convert(varchar(5),tae.id_area)              
              
WHERE Id_Contrato = @Id_Contrato                
                
                
--***** ACTUALIZA ID_DOMICILIO EN CTR_CONTRATOS ****----              
IF (select aprobado from dbo.ctr_contratos where id_contrato = @Id_contrato) = 0 BEGIN                
 IF (select Impreso from dbo.ctr_contratos where id_contrato = @Id_contrato) = 0 BEGIN                
  update ctr_contratos                
  set id_domicilio=@max_iddom                
  where id_contrato=@id_contrato                
 END                
 else BEGIN                
  update ctr_contratos                
  set id_domicilio=@max_iddom,                 
   firmado=0,                
      exp_nro=null                
  where id_contrato=@id_contrato                 
 end                
end    ' 
END
GO
/****** Object:  StoredProcedure [dbo].[CON_Informe_Gral_UR]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CON_Informe_Gral_UR]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CON_Informe_Gral_UR]          
 @Doc int = null    
as          
         
select  ur.Documento,          
 dp.Apellido,           
 dp.Nombre,          
 ur.cant_ur Cantidad,          
 ta2.descripcion Origen_UR,          
 tur.descripcion Tipo_Unidad_Retributiva,          
 ta.descripcion Lugar_Trabajo,          
 TADep.Descripcion  SECRETARIA,          
 case ur.Estado          
  when ''NA'' then ''En Tramite''          
  when ''A'' then ''Aprobado''          
  when ''B'' then ''Baja''          
 end Estado,          
 UR.Exp_Nro,      
 tr.descripcion Acto_Administrativo,          
 ur.Acto_Nro,          
 ur.Acto_Fecha,          
 ttt.Descripcion +'' ''+ DPF.Apellido +'' ''+ DPF.Nombre  Acto_Firmante          
          
      
from leg_desglose_ur ur          
          
inner join dbo.datos_personales dp          
 on dp.nro_documento = ur.documento          
          
inner join dbo.LEG_Tabla_Tipo_URetributivas tur          
 on tur.id = ur.Tipo_UR          
              
LEFT join dbo.vw_desglose_area da              
 on ur.documento = da.documento              
              
LEFT join dbo.tabla_areas TA              
 on TA.id = da.id_area              
          
LEFT join dbo.tabla_areas TA2              
 on TA2.id = ur.id_area            
          
LEFT join dbo.tabla_tipos_resoluciones TR              
 on TR.id = ur.acto_tipo              
          
LEFT join dbo.Tabla_Firmantes TFC              
 on TFC.id = ur.Acto_Firmante          
  
LEFT join dbo.datos_personales DPF              
 on TFC.nro_documento=DPF.nro_documento              
  
LEFT join dbo.tabla_tratamientos TT              
 on TT.id=tfc.id_tratamiento              
  
LEFT join dbo.tabla_tratamientos_titulos TTT              
 on TTT.id=tfc.id_titulo              
        
inner join dbo.Tabla_Areas TADep        
 ON TADep.id = dbo.Fx_Primer_Nivel_Dependencia_Area (da.Id_Area)         
          
where (ur.Documento = @doc or @doc is null )    
order by dp.apellido, dp.nombre, estado          
          
        
      
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[UCTR_GET_Legajo]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[UCTR_GET_Legajo]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[UCTR_GET_Legajo]    
 @Id_Interna int=null,    
 @Documento int=null,    
 @Planta smallint=null,    
 @EsContrato bit = 0,    
 @IdUsuario smallint= NULL,    
 @Todos bit = 0 --MLD11-06    
AS
SELECT  dp.Id_interna,    
 dp.Nro_Documento,     
 dp.apellido,    
 dp.nombre,    
 case when LB.Fecha_baja is null then    
  0    
 else    
  1    
 end Baja,    
 isnull(LB.Fecha_baja,'''')Fecha_Baja,    
 case when lq.fecha is null then    
  -- SI NO TIENE CONTRATO ACTIVO BLOQUEO LEGAJO    
  CASE WHEN @EsContrato = 1 THEN    
   case when NOT VCA.Nro_Documento IS NULL THEN    
    0    
   ELSE    
    --SE ANULO PORQ MOLESTA    
    0 --1    
   END    
  ELSE    
   0    
  END    
 else    
  1    
 end Bloqueo,    
 BajaLegajos,    
 BajaContratos    
FROM dbo.Datos_Personales DP    
  
LEFT JOIN dbo.Legajo_Bajas LB    
 on DP.Id_interna = LB.ID_Interna    
  
LEFT JOIN dbo.Leg_Bloqueos LQ    
 on LQ.legajo = DP.Id_interna  
  
LEFT JOIN dbo.leg_desglose_planta ldp  
 on ldp.documento = dp.nro_documento    
  
LEFT JOIN dbo.Tipo_de_Planta TP    
 on TP.id = ldp.Id_Planta  
    
INNER JOIN dbo.VW_Desglose_Area DA    
 on DA.Documento = dp.Nro_Documento     
    
INNER JOIN dbo.RH_Usuarios_Areas UA    
 on UA.Id_Usuario = @IdUsuario AND    
    (UA.Id_Area = DA.Id_Area or Ua.id_area = 0)    
    
-- SI TIENE CONTRATOS ACTIVOS    
LEFT JOIN dbo.VW_Contratos_Activos VCA    
 on VCA.Nro_Documento = DP.Nro_Documento    
     
WHERE  (DP.Id_Interna = @Id_interna OR DP.Nro_Documento = @Documento) AND    
 ((DP.VisibleContratos = 1 and @EsContrato = 1) 
	or (@EsContrato = 0 and dp.visiblelegajos = 1
	or @EsContrato = 1 and dp.visiblelegajos = 0
	or DP.VisibleContratos = 1 and dp.visiblelegajos = 0 )
	OR @Todos = 1)
' 
END
GO
/****** Object:  StoredProcedure [dbo].[LCons_Paramet_Datos_Personales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LCons_Paramet_Datos_Personales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[LCons_Paramet_Datos_Personales]

	@legajo  [int]=null,
	@id_interna [int]=null,
	@apellido  [varchar](40)=null,
	@planta [int]=null,	
	@sexo [smallint]=null,
	@FechaNAcDesde [smalldatetime]=null,
	@FechaNAcHasta [smalldatetime]=null,
	@regimen [smallint]=null,
	@denominacion [smallint]=null,
	@os [smallint]=null,
	@EstadoCivil [int]=null,
	@grupo [varchar](2)=null,
       	@factor [varchar](20)=null

AS 

SELECT nro_documento DNI, 
	 apellido +'', ''+ DP.nombre [Apellido y Nombre],
	 TP.descripcion Planta,
	 S.descripcion Sexo,
	convert (char(10), fecha_nacimiento,103) [Fecha de Nacimiento],
	 --regimen_jubilatorio,
	RE.descripcion Denominación,
	EC.descripcion [Estado Civil],
	--grupo_sanguineo,
	--factor_sanguineo,
	OS.nombre [Obra Social],

	case DP.[regimen_jubilatorio]  when  1 then
		''Reparto''
	when  2 then
		''Capitalización''
	else
		''''
	end [Regimen Jubilatorio]
	
	
FROM dbo.Datos_Personales DP 

inner join dbo.Tabla_Estado_civil EC
	on EC.id = DP.estado_civil

INNER JOIN dbo.VW_Desglose_Planta DPP
	On DPP.id_interna = dP.id_interna

INNER JOIN dbo.tipo_de_planta TP
	on TP.id = DPP.id_planta

inner join dbo.Tabla_sexo S
	on S.id = DP.sexo

inner join dbo.Tabla_regimen_jubilatorio RE
	on RE.id = DP.denominacion

left join dbo.Tabla_obrasocial OS
	on OS.id = DP.obra_social

WHERE (nro_documento = @legajo or @legajo is null) and
	(dp.id_interna = @id_interna or @id_interna is null) and
	 (apellido like @apellido + ''%'' or @apellido is null) and
	 (dPP.id_planta = @planta or @planta is null) and
	 (sexo = @sexo or @sexo is null) and
	((fecha_nacimiento between @fechanacdesde and @fechanachasta) or (@fechanacdesde is null or @fechanachasta is null)) and
	(regimen_jubilatorio = @regimen or @regimen is null) and
	(denominacion = @denominacion or @denominacion is null) and
	(estado_civil = @estadocivil or @estadocivil is null) and
	(grupo_sanguineo = @grupo or @grupo is null) and
	(factor_sanguineo = @factor or @factor is null) and
	(obra_social = @os or @os is null)


' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_Get_Pendiente_Areas]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_Get_Pendiente_Areas]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ASIS_Get_Pendiente_Areas] 
@id_area int ,
@usuario int =null --GPR lo puse porque tira error en VB
AS
declare @AnyoUsufructoActual int

set @AnyoUsufructoActual = (
select
case when month(getdate()) = 12 then 
	year(getdate()) 
else 
	year(getdate())-1
end)
  
SELECT TA.Descripcion, Dp.Apellido, Dp.Nombre, Dp.Nro_Documento, Al.periodo, Al.Dias_Autorizados, Al.Dias_Tomados, Al.Dias_Autorizados - Al.Dias_Tomados Dias_Pendientes  
FROM dbo.Autorizaciones_licencias Al   
INNER JOIN dbo.Datos_Personales DP   
  ON Al.id_interna = DP.id_interna  
INNER JOIN dbo.vw_desglose_area DA on  
  DA.id_interna = DP.id_interna  
INNER JOIN dbo.tabla_areas ta ON  
  TA.id = da.id_area
INNER JOIN dbo.vw_desglose_planta vw ON
 DP.Id_Interna = vw.id_interna
--WHERE  Al.Dias_Autorizados - Al.Dias_Tomados > 0 AND  (Comentado por FAML 20/10/2009 para que aparezcan los que tienen CERO) 
WHERE  Al.id_Concepto_licencia = 1 AND   
 (DA.id_area = @id_area or @id_area = -1) aND   
 dp.id_interna not in (select id_interna FROM dbo.legajo_bajas) 
 and
 (vw.id_planta <> 22 or (vw.id_planta = 22 and al.periodo >= @AnyoUsufructoActual - 1))
ORDER BY id_area, Apellido, Nombre, Periodo
' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Licencia]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_GET_Licencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE PROCEDURE [dbo].[ASIS_GET_Licencia] 
(@id_interna int, @SoloOrdinarias bit) AS
if @SoloOrdinarias = 1
begin

DECLARE @ProrrogaDesde int
DECLARE @ProrrogaHasta int
DECLARE @FechaProrroga smalldatetime
DECLARE @AnyoUsufructoActual smallint
DECLARE @ProrrogaUsuDesde smallint
DECLARE @ProrrogaUsuHasta smallint

--obtengo el año del cual se pueden tomar licencias ahora
set @AnyoUsufructoActual = year(getdate())-1

--(
--select
--case when month(getdate()) = 12 then 
--	year(getdate()) 
--else 
--	year(getdate())-1
--end)

set @ProrrogaUsuDesde = (select Prorroga_Desde from dbo.ASIS_Prorrogas_Licencias where Periodo_Usufructo = @AnyoUsufructoActual) --or Periodo_Usufructo = @AnyoUsufructoActual-1)
set @ProrrogaUsuHasta = (select Prorroga_Hasta from dbo.ASIS_Prorrogas_Licencias where Periodo_Usufructo = @AnyoUsufructoActual) --or Periodo_Usufructo = @AnyoUsufructoActual-1)

	SELECT 
	max(Periodo) año, 
	max(AL.Dias_Autorizados) dias_autorizados, 
	max(al.dias_tomados) dias_tomados, 
	max(AL.Dias_Autorizados) - max(
	case when AL.DIAS_tomados is null then
	   0
	else
                AL.DIAS_tomados
	end
              ) Restan, 
	max(id_concepto)  Id_Concepto, 
	max(al.id) id_Autorizacion
	FROM DBO.AUTORIZACIONES_LICENCIAS AL
	LEFT JOIN dbo.VW_Lic_Ord_Tomadas LI ON 
		LI.ID_Autorizacion = AL.Id and LI.id_interna = AL.ID_INTERNA
	INNER JOIN dbo.TABLA_CONCEPTOS_LICENCIAS CL ON 
		AL.id_concepto_licencia = CL.Id_Concepto
	INNER JOIN dbo.vw_desglose_planta vw on
		al.id_interna = vw.id_interna
	WHERE AL.ID_INTERNA =  @id_interna AND CL.Es_Ordinaria = @SoloOrdinarias AND 
	(Periodo = @AnyoUsufructoActual or Periodo = @AnyoUsufructoActual+1 or (Periodo between @ProrrogaUsuDesde and @ProrrogaUsuHasta and vw.id_planta <> 22) or (vw.id_planta = 22 and Periodo = @AnyoUsufructoActual -1))
	GROUP BY Periodo
	ORDER BY Periodo
end

if @SoloOrdinarias = 0
begin
	SELECT max(Periodo) año, max(AL.Dias_Autorizados) dias_autorizados, SUM(Lic_Esp_Dias) dias_tomados, max(AL.Dias_Autorizados) - SUM(Lic_Esp_Dias) Restan,  Id_Concepto, Anual, Acumulativa
	FROM dbo.AUTORIZACIONES_LICENCIAS AL
	LEFT JOIN dbo.VW_Lic_Esp_Tomadas LI ON LI.ID_Autorizacion = AL.Id and LI.id_interna = AL.ID_INTERNA
	INNER JOIN dbo.TABLA_CONCEPTOS_LICENCIAS CL ON AL.id_concepto_licencia = CL.Id_Concepto
	WHERE AL.ID_INTERNA =  @Id_Interna AND CL.Es_Ordinaria = @SoloOrdinarias
	GROUP BY Periodo, Anual, Acumulativa,Id_Concepto
	ORDER BY Periodo DESC
end
' 
END
GO
/****** Object:  StoredProcedure [dbo].[MED_ADD_Apto_Medico]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[MED_ADD_Apto_Medico]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[MED_ADD_Apto_Medico]        
 @IdTipoApto smallint,      
 @Nro_Documento int,           
 @desde smalldatetime,           
 @cant_dias int,           
 @observaciones varchar(300)=NULL,           
 @Obs_Discapacidad varchar(255) = NULL,        
 @Id_Discapacidad int = NULL,        
 @porcen_discapacidad int  =NULL,      
 @IdApto int = 0,      
 @Usuario smallint =NULL      
AS            
SET NOCOUNT ON      
      
IF  @IdApto <> 0 BEGIN      
 -- ELIMINA Datos del Apto si ya existe y lo vuelve a crear      
 DELETE FROM dbo.MED_Analisis      
 WHERE IdApto = @IdApto      
      
 UPDATE dbo.MED_Apto_Medico      
 SET IdtipoApto = @idTipoapto,      
  Desde = @Desde,      
  Cant_Dias = @Cant_dias,      
  Observaciones = @Observaciones,      
  Obs_Discapacidad = @Obs_Discapacidad,      
  Id_Discapacidad = @Id_Discapacidad,      
  Porcen_Discapacidad = @Porcen_Discapacidad,      
  IdUsuario = @Usuario      
        
 WHERE IdApto = @IdApto      
      
 SELECT @IdApto Id      
END      
ELSE      
BEGIN      
 UPDATE dbo.MED_Apto_Medico      
 SET Baja = 1      
 WHERE Baja = 0 AND Nro_Documento = @Nro_Documento      
      
 INSERT INTO dbo.MED_Apto_Medico      
  (IdTIpoApto,      
  Nro_Documento,      
  Desde,      
  Cant_Dias,      
  Observaciones,      
  Obs_Discapacidad,      
  Id_Discapacidad,      
  Porcen_Discapacidad,      
  IdUsuario      
  )      
 VALUES       
  (@IdTipoApto,      
  @Nro_Documento,      
  @Desde,      
  @Cant_Dias,      
  @Observaciones,      
  @Obs_Discapacidad,      
  @Id_Discapacidad,      
  @Porcen_Discapacidad,      
  @Usuario      
  )      
      
      
 -- GPR 10-10-11: GENERA EL AVISO A LEGAJO   
 Declare @Motivo varchar(50)      
 Declare @tabla varchar(50)           
 Declare @DescripApto varchar(50)    
    
 set @IdApto = (Select isnull(max(IdApto),1) from dbo.MED_Apto_Medico)    
 set @DescripApto = (select Descripcion from dbo.Tabla_Medicos_Aptos where Id = @IdTipoApto)    
    
 set  @Motivo = @DescripApto    
 set @tabla = ''Apto Medico :'' + cast(@IdApto as varchar)      
 exec dbo.RH_ADD_Traspaso_Documentacion 8, @Usuario, @Motivo, @tabla, @Nro_Documento,2,''MAPML''      
    
     
 Select max(IdApto) Id from dbo.MED_Apto_Medico      
END            
      
GRANT  EXECUTE  ON [dbo].[MED_ADD_Apto_Medico]  TO [RRHH_SIS_LEG_ADM] ' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_UPD_Desglose_UR_Aprobar]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_UPD_Desglose_UR_Aprobar]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_UPD_Desglose_UR_Aprobar]                          
 @id int,                         
 @Acto_Tipo smallint,                        
 @Acto_Nro varchar(10),                        
 @Acto_Fecha datetime,                        
 @Acto_Firmante int,                        
 @user smallint,                      
 @Documento int,                
 @id_tipo_ur int                        
AS                          
                        
set nocount on                
                
DECLARE @error int                
                
set @error = 0                
                
BEGIN TRAN t                
                    
                
UPDATE dbo.LEG_Desglose_UR                          
SET    Acto_Tipo = @Acto_Tipo,                        
 Acto_Nro = @Acto_Nro,                        
 Acto_Fecha = @Acto_Fecha,                        
 Acto_Firmante = @Acto_Firmante,                        
 usuario = @user,                        
 estado = ''A''                        
WHERE  Id = @id                          
 and documento = @Documento                       
                      
if @@error <> 0 begin                
 SET @error = 1                
end                
                
---DOY DE BAJA LAS UR APROBADAS QUE ESTAN COMO REEMPLAZO                
IF (SELECT count(1) FROM dbo.LEG_Desglose_UR_Reemplazos                    
   WHERE  Id_UR_nueva = @id                          
    and documento = @Documento ) > 0                    
BEGIN                    
  create table #tempo                    
  (documento int,                    
  id_UR_a_reempla int,                    
  marca int)                    
                    
  INSERT INTO #tempo                    
  select documento , id_UR_a_reempla, null                    
  from dbo.LEG_Desglose_UR_Reemplazos                    
  WHERE  Id_UR_nueva = @id                          
   and documento = @Documento                       
                    
  declare @id_reempla int                    
                     
  WHILE (SELECT count(1) FROM #tempo WHERE marca is null) > 0                    
  BEGIN                    
     SET @id_reempla = (SELECT top 1 id_UR_a_reempla                     
        FROM #tempo                    
        WHERE marca is null)                    
                      
     EXEC dbo.LEG_DEL_Desglose_UR     @id_reempla,                     
          @acto_tipo ,                    
          @acto_nro ,                    
          @acto_fecha,                     
          @acto_firmante ,                    
          @user,                           
          @Documento                     
                 
                      
     UPDATE #tempo                    
     SET marca = 1                    
     where id_UR_a_reempla = @id_reempla                    
                 
                  
    if @@error <> 0 begin                
     SET @error = 1                
    end                
                 
  END                   
END                    
                    
              
declare @tipo char(3)                
select @tipo = tipo from LEG_Tabla_Tipo_URetributivas                    
where id= @id_tipo_ur                
              
              
IF (select count(*) 
	from dbo.datos_personales 
	where nro_documento = @documento
	and nro_documento = Id_Interna 
	and VisibleLegajos = 0) > 0    
BEGIN    
	 IF ltrim(rtrim(@tipo)) = ''DUR''             
	 BEGIN            
	  EXEC RH_ADD_Traspaso_Documentacion 2, @user, ''Designación de Asosor/Axiliar de U.R.'', @id, @Documento, 5, ''CCMPL''    
	 END            
END    
            
    
IF ltrim(rtrim(@tipo)) = ''AUR''             
BEGIN            
	 Declare @Motivo varchar(50)    
	 set @Motivo = ''Asig. Suplemento de U.R. - RES: '' + @acto_nro    
	 EXEC RH_ADD_Traspaso_Documentacion 2, @user, @motivo , @id, @Documento, 2, ''AUR''    
END            
                  
              
if @@error <> 0 begin                
 SET @error = 1                
end                
                    
              
IF @error = 1                 
BEGIN              
  ROLLBACK Tran t                
END               
ELSE              
BEGIN              
  COMMIT Tran t                
END               
                
              
Select @error R                    
                      
        
      
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_UPD_Aprobar_Contrato]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_UPD_Aprobar_Contrato]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE  procedure [dbo].[CTR_UPD_Aprobar_Contrato]  
 (@Id_Cont [int],  
 @actotipo int,  
 @actonro varchar(10),  
 @actofecha smalldatetime,  
 @actofirma int,  
 @user int)  
  
AS  
  
--APRUEBA EL CONTRATO ACTUAL  
 UPDATE  dbo.CTR_Contratos    
 SET  Acto_tipo= @actotipo,  
  Acto_nro= @actonro,  
  Acto_fecha= @actofecha,  
  Acto_firmante= @actofirma,  
  Usuario= @user,  
  Aprobado= 1  
 WHERE  Id_Contrato = @Id_Cont  
  
  
--BAJA DE CONTRATOS ANTERIORES  
 Declare @Documento int --SE USA TAMBIEN EN SETEO DE VISIBILIDAD  
 SET @Documento = (SELECT Nro_Documento FROM dbo.CTR_Contratos where Id_Contrato = @Id_Cont)  
 CREATE TABLE #Tmp  
  (id_Ctr int,  
  Legajo int,  
  hasta datetime,
  Nivel smallint,
  Tipo_Contrato smallint)  
  

 INSERT INTO #Tmp  
 SELECT top 1 id_contrato, 
	nro_Documento, 
	hasta,
	CASE WHEN nivel is not null THEN  
	   nivel
	ELSE   
	   funcion
	END, 
	Tipo_Contrato	   
 FROM dbo.CTR_Contratos  
 WHERE  Aprobado = 1 AND  
  Baja = 0 AND  
  id_Contrato <> @Id_Cont AND  
  Nro_Documento = @Documento  
  order by id_contrato desc
    
 --Marca contratos de BAJA   
 UPDATE dbo.CTR_Contratos  
  SET baja = 1  
 WHERE id_contrato in (SELECT id_Ctr FROM #Tmp)  
   
 --Para determinar si el contrato a Aprobar es Enmienda o Renovacion  
 DECLARE @Enmienda bit   
 SET @Enmienda = (SELECT Enmienda FROM dbo.CTR_Contratos WHERE Id_Contrato = @Id_Cont)  
   

 --Genera Detalle de las Baja  
DECLARE @Motivo_Baja smallint
DECLARE @Fecha_Baja smalldatetime

SET @Fecha_Baja = (SELECT desde - 1 FROM dbo.CTR_Contratos WHERE Id_Contrato = @Id_Cont)

IF @Enmienda = 1
BEGIN 
	set @Motivo_Baja = 24 --ENMIENDA
END

IF @Enmienda <> 1
BEGIN 
	IF (select hasta from #Tmp) >= (SELECT desde - 1 FROM dbo.CTR_Contratos WHERE Id_Contrato = @Id_Cont)
	BEGIN
		IF (select tipo_contrato from #Tmp) <> (SELECT tipo_contrato FROM dbo.CTR_Contratos WHERE Id_Contrato = @Id_Cont)
		BEGIN
			set @Motivo_Baja = 26 --CAMBIO DE MARCO
		END
		
		IF (select tipo_contrato from #Tmp) = (SELECT tipo_contrato FROM dbo.CTR_Contratos WHERE Id_Contrato = @Id_Cont)
		BEGIN
			IF (select nivel from #Tmp) = (SELECT nivel FROM dbo.CTR_Contratos WHERE Id_Contrato = @Id_Cont)	
			BEGIN
				set @Motivo_Baja = 23 --RENOVACION
			END
			ELSE
			BEGIN
				set @Motivo_Baja = 29 --ADECUACION DE NIVEL
			END
		END
	END
	ELSE
	BEGIN 
		SET @Motivo_Baja = 4 --FIN CONTRATO
		SET @Fecha_Baja = (select hasta from #Tmp)
	END	
END


 INSERT INTO dbo.CTR_Contratos_Bajas  
 SELECT  legajo, id_Ctr,   
  @ActoTipo, @ActoNro,   
  @ActoFecha, @ActoFirma,  
  @Motivo_Baja,
  @Fecha_Baja,
  @User  
 FROM #Tmp  
   

 DROP TABLE #Tmp  
  
-- ELIMINA IMPRESIONES TEMPORALES DE CONTRATOS  
  
 DELETE FROM dbo.CTR_Contratos_Tmp_Impresion  
 WHERE Id_Contrato = @Id_Cont  
  
--MLD 06-10-06: SETEO DE VISUALIZACION DE DATOS PERSONALES  
 DECLARE @VLeg Bit --Si es Visible para LEGAJOS  
 SET @VLeg = (SELECT TTC.SendLegajos  
   FROM dbo.CTR_Contratos C  
   INNER JOIN  dbo.Tabla_Resoluciones_Contratos TRC  
    ON TRC.id = C.Tipo_Contrato   
   INNER JOIN  dbo.Tabla_tipos_Contratos TTC --: sendlegajos --> 1 or 0  
    ON TTC.Id = TRC.Tipo_Contrato  
   WHERE C.Id_Contrato = @Id_Cont)  
   
   
 --SETEA VISIBILIDAD DE LEGAJOS SEGUN MODALIDAD DE CONTRATO  
 UPDATE  dbo.Datos_Personales  
 SET  BajaLegajos = case when @VLeg = 1 then 0 else VisibleLegajos  END--,  --VisibleLegajos,  
--  VisibleLegajos = @VLeg  
 WHERE  Nro_Documento = @Documento  
  
 --GENERA TRASPASO A LIQUIDACIONES SI CORRESPONDE  --ANTERIORMENTE ERA LEGAJOS
 IF @VLEG = 1 BEGIN  
  IF (Select Id_interna from dbo.Datos_personales where Nro_Documento = @Documento) = @Documento BEGIN   
   exec dbo.RH_ADD_Traspaso_Documentacion 1,@user,''Incorporación de Contratado'',''Datos Personales'',@Documento,5,''CCMPL''  
  END  
     
  -- MLD 02-03-07: GENERA PASE A LEGAJO DEL CONTRATO APROBADO  
	
  Declare @Motivo varchar(50)
  declare @tabla varchar(50)
  set  @Motivo = ''Aprobación de Contrato Res: '' +  @actonro
  set @tabla = ''Contratos :'' + cast(@Id_Cont as varchar)
  exec dbo.RH_ADD_Traspaso_Documentacion 1, @user, @Motivo, @tabla, @Documento,2,''CAPCL''
    
  
  --GPR 26-02-07: INGRESA NIVEL Y GRADO EN DESGLOSE   
  declare @nivel int,  
   @grado int,  
   @desde datetime,  
   @id_int int  
  
  create table #Desg_NG  
   (nivel smallint,  
   grado smallint,  
   desde datetime,  
   estado char(1),  
   IdInterna int)    
    
  insert into #Desg_NG   
  (nivel,grado,desde,estado,idinterna)  
  select  nivel,  
   grado,  
   desde,  
   estado,  
   id_interna  
  from ctr_contratos c  
  inner join datos_personales dp  
   on dp.nro_documento=c.nro_documento  
  where id_contrato=@id_cont  
  
  set @nivel=(select nivel from #Desg_NG)  
  set @grado=(select grado from #Desg_NG)  
  set @desde=(select desde from #Desg_NG)  
  set @id_int=(select idinterna from #Desg_NG)  
  -- SE REGISTRA SIEMPRE EL NIVEL Y GRADO CUANDO SE APRUEBA EL CONTRATO  
--  IF (select estado from #Desg_NG)<>''A'' BEGIN  
  
   exec LEG_ADD_Desglose_NivelGrado @id_int, @Documento, @nivel, @grado, @desde,  
   ''Ministerio de Desarrollo Social'',''Ministerio de Desarrollo Social'',''00-000/000'',@actotipo,@actonro,@actofecha,@user    
--  END   

  drop table #Desg_NG  
 END  
   
' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_MED_Apto_Medico]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_MED_Apto_Medico]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
 CREATE  procedure [dbo].[RPT_MED_Apto_Medico]  
 @IdApto int  
AS  

SELECT CASE WHEN DP.Apellido IS NULL THEN  
  MP.Apellido +'', ''+ MP.Nombre  
 ELSE  
  DP.Apellido +'', ''+ DP.Nombre  
 END Paciente,  
 CASE WHEN DP.Nro_Documento IS NULL THEN  
  MP.Nro_Documento  
 ELSE  
  DP.Nro_Documento  
 END Nro_Documento,  
 IdApto,  
 TMA.Descripcion Tipo_Apto,  
 convert(char(10),AM.Desde,103) FechaEmision,  
 CASE WHEN TADP.Id IS NULL THEN  
  TAMP.Descripcion   
 ELSE  
  TADP.Descripcion  
 END Area,  
ISNULL(AM.Observaciones,'''') Observaciones,
Cant_Dias
 
FROM dbo.MED_Apto_Medico AM  
LEFT JOIN dbo.Datos_Personales DP  
 ON DP.Nro_Documento = AM.Nro_Documento  
LEFT JOIN dbo.MED_Pacientes MP  
 ON MP.Nro_Documento = AM.Nro_Documento  
INNER JOIN dbo.Tabla_Medicos_Aptos TMA  
 ON TMA.Id = AM.IdTipoApto  
  
LEFT JOIN dbo.VW_Desglose_Area DA  
 ON DA.Documento = DP.Nro_Documento  
LEFT JOIN dbo.Tabla_Areas TADP  
 on TADP.Id = DA.Id_Area  
  
LEFT JOIN dbo.Tabla_Areas TAMP  
 on TAMP.Id = MP.Area  
WHERE IdApto =  @IdApto   

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_por_NivelGrado]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_por_NivelGrado]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[LEG_GET_por_NivelGrado]
	@nivel [varchar](2),
	@grado [varchar](2)
as
SELECT d.id_interna Legajo,
	dp.nro_documento Documento,
	dp.apellido +'', ''+ dp.nombre [Apellido y Nombre],
	tn.nivel Nivel,
	tg.grado Grado,
	convert(char(10),d.desde,103) Desde,
	ta.descripcion [Lugar de trabajo]

FROM dbo.VW_Desglose_Area D

INNER JOIN datos_personales DP
	on DP.id_interna = d.id_interna

INNER JOIN dbo.VW_Desglose_NivelGrado DNG
	On DNG.id_interna = d.id_interna

INNER JOIN tabla_niveles TN
	on tn.id = DNG.id_nivel 

INNER JOIN tabla_grados Tg
	on tg.id = DNG.id_grado


INNER JOIN tabla_areas TA
	on ta.id = d.id_area

WHERE (tn.nivel = @nivel or @nivel ='''') and
(tg.grado = @grado or @grado ='''')



' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Asignar_Nuevo_Expediente]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Asignar_Nuevo_Expediente]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CTR_GET_Asignar_Nuevo_Expediente]        
  @Documento [int]=null,        
  @exp [varchar](30)=null,  
  @IdUsuario int  
        
AS         
select  C.Id_Contrato,        
 C.Nro_Documento,        
 DP.Apellido,        
  DP.Nombre,        
 TC.descripcion Desc_Contrato,         
 C.Nro_Contrato,        
 convert (char(10), C.[Desde],103) Desde ,        
 convert (char(10), C.[Hasta],103) Hasta,        
         
 case when c.conserva_area=1 then        
  TA.descripcion         
 else        
  TA2.descripcion         
 end Lugar_de_trabajo,        
 C.Exp_Nro,    
isnull(tn.nivel,'' '') nivel,    
isnull(tg.grado,'' '') grado        
        
        
From dbo.CTR_Contratos  C        
        
inner join dbo.Datos_Personales DP        
 on DP.nro_documento = C.Nro_documento        
        
inner join dbo.Tabla_Resoluciones_Contratos TC        
 on TC.id = C.tipo_contrato        
        
LEFT join dbo.tabla_areas TA        
 on TA.id = c.id_area        
        
LEFT join dbo.vw_desglose_area da        
 on c.nro_documento = da.documento        
        
LEFT join dbo.tabla_areas TA2        
 on TA2.id = da.id_area        
        
LEFT join dbo.tabla_niveles TN      
 on TN.id = C.nivel      
      
LEFT join dbo.tabla_grados TG      
 on TG.id = C.grado      
        
INNER JOIN dbo.RH_Usuarios_Areas UA  
 on UA.Id_Usuario = @IdUsuario AND          
 (UA.Id_Area = DA.Id_Area or Ua.id_area = 0)      
    
Where   c.aprobado= 0 and           
 c.firmado=1 and        
 c.impreso=1 and        
 c.Baja=0 and        
        
 (C.nro_documento = @documento or @documento is null) and        
 (c.exp_nro=@exp or @exp is null)         
        
order by DP.Apellido, DP.Nombre        
      
    ' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Impresion_Anexos]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Impresion_Anexos]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Impresion_Anexos]                      
 @Expediente varchar(30),                      
 @Marca char(1)                      
AS                      
                      
SELECT  dp.Apellido,                       
 dp.nombre,                      
 --DI.Descripcion + '' '' + cast(dp.Nro_Documento as varchar) Documento,                      
 cast(dp.Nro_Documento as varchar) Documento,                      
 CASE WHEN TN.Nivel IS NULL THEN                      
  TFC.Descripcion                      
 ELSE                      
  TN.Nivel                      
 END Nivel,                      
 CASE WHEN TN.Nivel IS NULL THEN                      
  Tr.Descripcion                      
 ELSE                      
  TG.Grado                      
 END Grado,                      
 CASE WHEN TN.Nivel IS NULL THEN                      
  c.monto  
 ELSE                      
  --  TS.Remuneracion_Fija --MLD: 09/08/07: Modifiacion tabla SInapa usando Vigencia                
  dbo.Fx_Monto_Sinapa (tn.nivel, tg.grado, c.desde)  
                
 END MontoMensual,                      
                      
-- CASE WHEN TN.Nivel IS NULL THEN                      
 -- c.monto * datediff(month,desde,hasta)                      
-- ELSE                      
 -- TS.Remuneracion_Fija * datediff(month,desde,hasta)                      
-- END Monto,                      
                      
 convert(char(10),c.Desde,103) Desde,                      
 convert(char(10),hasta,103) Hasta,                      
 ttc.SendLegajos Tipo,                      
                       
 case when @marca=1 then                      
  --AREA CONTRATO                      
  isnull(Te2.descripcion,'''')                       
 else                      
  --AREA DESGLOSE                      
  isnull(Te3.descripcion,'''')                       
 end Secretaria  ,  
          
null resolucion ,               

 case when @marca=1 then                      
  --AREA CONTRATO                      
  isnull(Te2.codigo,'''')                       
 else                      
  --AREA DESGLOSE                      
  isnull(Te3.codigo,'''')                       
 end codigo                    
                      
FROM dbo.Ctr_Contratos C                      
                      
INNER JOIN dbo.Datos_Personales Dp                      
 on DP.Nro_Documento = C.Nro_Documento                      
LEFT JOIN dbo.Tabla_Niveles TN                      
 on TN.Id = c.Nivel                      
LEFT JOIN dbo.Tabla_Grados TG                      
 on TG.Id = c.Grado                      
LEFT JOIN dbo.Tabla_Rangos TR                      
 on TR.id = C.Rango                      
LEFT JOIN dbo.Tabla_Funciones_Contratos TFC                      
 on TFC.Id = C.Funcion                      
                      
INNER JOIN dbo.Tabla_DocIdentidad DI                      
 on DI.Id = dp.Tipo_documento                      
                      
INNER JOIN dbo.Tabla_Resoluciones_Contratos TRC                      
 on TRC.id = C.Tipo_Contrato                      
                      
Inner join dbo.Tabla_tipos_Contratos TTC                      
 on TTC.id = TRC.Tipo_Contrato                      
                      
--LEFT JOIN dbo.Tabla_Sinapa TS       --MLD: 09/08/07 Modifiacion SINAPA                
-- on (TS.Nivel = tn.nivel) AND                      
--    (TS.grado = tg.grado)                        
                      
LEFT JOIN dbo.CTR_Expedientes_Anexados EA                      
 ON EA.Id_Contrato = C.Id_Contrato                      
                      
                    
 LEFT JOIN dbo.tabla_areas_estructura TE                      
  ON TE.id_area=c.id_area and right(te.codigo,5)<>''00000''                      
                       
 LEFT JOIN dbo.tabla_areas_estructura TE2                      
  on te2.codigo=(left(te.codigo,10)+''00000000000000'')                      
                      
                      
--LEFT join dbo.tabla_areas TA                      
-- on TA.id = da.id_area                      
                       
 LEFT join dbo.vw_desglose_area da                      
  on c.nro_documento = da.documento                      
                      
 LEFT join dbo.tabla_areas TA                      
  on TA.id = da.id_area                       
                      
 LEFT JOIN dbo.tabla_areas_estructura TE4                      
  ON TE4.id_area=da.id_area and right(te4.codigo,5)<>''00000''                      
                      
 LEFT JOIN dbo.tabla_areas_estructura TE3                      
  on te3.codigo=(left(te4.codigo,10)+''00000000000000'')                      
            
WHERE  rtrim(C.Exp_nro) = @Expediente                      
-- AND C.Baja = 0 -- COLO: 06/02/2008 - Filtrar solo lo que bajas = 0                    
   -- FABI: 08/05/2008 - No Filtrar solo lo que bajas = 0                    
-- AND C.Aprobado =0         
-- AND EA.Id_Contrato IS NULL                       
                      
Order by codigo,secretaria,apellido,nombre ' 
END
GO
/****** Object:  StoredProcedure [dbo].[VIAT_GET_datosAgente2]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[VIAT_GET_datosAgente2]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'

CREATE PROCEDURE [dbo].[VIAT_GET_datosAgente2] 
@Nro_documento int
AS
BEGIN
SELECT
	dp.apellido 		Apellido, 
	UPPER(dp.nombre) 	Nombre, 
	tdi.Descripcion		TDoc,
	dp.Nro_documento 	Nro_documento, 
	niv.nivel 		Nivel_Funcion,
	gra.grado 		Grado_Rango,
	UPPER(pla.descripcion) 	TPlanta,
	CONVERT(VARCHAR(10),dp.fecha_nacimiento,103) 	FNacimiento,
	UPPER(ta.descripcion) 		Area,
	tae.codigo codigoestructura,
	tae2.Descripcion Dep_SecSubs,
	tae3.Descripcion Dep_Sec
FROM dbo.datos_personales dp
inner join dbo.vw_desglose_area da on
	dp.id_interna = da.id_interna
inner join dbo.tabla_areas ta on
	ta.id = da.id_area
inner join dbo.vw_desglose_nivelGrado vwng on
	dp.id_interna = vwng.id_interna
inner join dbo.tabla_niveles niv on
	niv.id = vwng.id_nivel
inner join dbo.tabla_grados gra on
	gra.id = vwng.id_grado
inner join dbo.vw_desglose_planta vwdp on
	dp.id_interna = vwdp.id_interna
inner join dbo.tipo_de_planta pla on
	vwdp.id_planta = pla.id
inner join dbo.Tabla_DocIdentidad tdi
	ON dp.tipo_documento = tdi.Id
inner join dbo.Tabla_Areas_Estructura tae
	on tae.Id_area = ta.id and substring(tae.codigo,20,5) <> ''00000''
inner join dbo.Tabla_Areas_Estructura tae2
	on tae2.codigo = substring(tae.codigo,1,10)+''00000000000000''
inner join dbo.Tabla_Areas_Estructura tae3
	on tae3.codigo = substring(tae.codigo,1,7)+''00000000000000000''

WHERE  
	dp.Nro_documento = @Nro_documento 
END


' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Datos_Personales]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Datos_Personales]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_GET_Datos_Personales]        
@doc int        
as        
SELECT dp.[Id_Interna],         
 [Apellido],         
 [Nombre],         
 P.Id_Planta Tipo_Planta , --   [Tipo_Planta],         
 [Sexo],         
 [Fecha_Nacimiento],        
 [Lugar_Nacimiento],         
 [Nacionalidad],         
 [Fecha_Ingreso_Pais],         
 [Carta_Ciudadania],         
 [Juzgado],         
 [Secretario],         
 [Fecha_Juzgado],         
 left(Cuil_Nro,2) +''-''+ right(left(Cuil_Nro,10),8) +''-''+ right(rtrim(Cuil_Nro),1) Cuil_Nro,         
 [Tipo_Documento],         
 [Nro_Documento],         
 [Distrito_Militar],         
 [Clase],         
 [Cedula_Identidad],         
 [Expedida_por],         
 [Regimen_Jubilatorio],         
 [Denominacion],         
 [Estado_Civil],         
 [Fecha_Matrimonio],         
 [Fecha_Matrimonio_2da],         
 [Grupo_Sanguineo],         
 [Factor_Sanguineo],         
 [Credencial],         
 [Obra_Social],         
 [Nro_Afiliado],         
 DP.[Usuario],        
 A.Id_Area ,        
 TA.Descripcion Area,        
 TP.descripcion Tipo_planta_Desc,    
 CASE WHEN month(DP.Fecha_Nacimiento) > month(getdate())  
 THEN datediff(yy,DP.Fecha_Nacimiento,getdate())-1    
 ELSE datediff(yy,DP.Fecha_Nacimiento,getdate())    
  END edad        
        
FROM [dbo].[Datos_Personales]DP        
        
inner join VW_Desglose_Area A        
 on A.documento=DP.nro_documento        
left join tabla_areas TA        
 on ta.id= a.Id_area        
        
LEFT JOIN dbo.VW_Desglose_Planta P        
 on P.Documento = DP.Nro_Documento        
left join dbo.tipo_de_planta TP        
 on TP.Id = p.id_planta        
        
where nro_documento=@doc        
        
        
        
        ' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Asignar_Expediente]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Asignar_Expediente]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[CTR_GET_Asignar_Expediente]        
  @Area [int]=null,        
  @Documento [int]=null,        
  @tipo_cont [int]=null,        
  @exp [varchar](30)=null,        
  @IdUsuario int        
  
AS         
select  C.Id_Contrato,        
 C.Nro_Documento,        
 DP.Apellido,        
  DP.Nombre,        
 TC.descripcion Desc_Contrato,         
 C.Nro_Contrato,        
 convert (char(10), C.[Desde],103) Desde ,        
 convert (char(10), C.[Hasta],103) Hasta,        
         
 case when c.conserva_area=1 then        
  TA.descripcion         
 else        
  TA2.descripcion         
 end Lugar_de_trabajo ,       
        
isnull(tn.nivel,'' '') nivel,    
isnull(tg.grado,'' '') grado    
        
From dbo.CTR_Contratos  C        
        
inner join dbo.Datos_Personales DP        
 on DP.nro_documento = C.Nro_documento        
        
inner join dbo.Tabla_Resoluciones_Contratos TC        
 on TC.id = C.tipo_contrato        
        
LEFT join dbo.tabla_areas TA        
 on TA.id = c.id_area        
        
LEFT join dbo.vw_desglose_area da        
 on c.nro_documento = da.documento        
        
LEFT join dbo.tabla_areas TA2        
 on TA2.id = da.id_area        
    
LEFT join dbo.tabla_niveles TN      
 on TN.id = C.nivel      
      
LEFT join dbo.tabla_grados TG      
 on TG.id = C.grado      
        
INNER JOIN dbo.RH_Usuarios_Areas UA  
 on UA.Id_Usuario = @IdUsuario AND          
 (UA.Id_Area = DA.Id_Area or Ua.id_area = 0)   
  
Where   c.aprobado= 0 and           
 c.firmado=1 and        
 c.impreso=1 and        
 c.Baja=0 and        
        
        
 (@area is null or @area =        
 case when c.conserva_area = 0 then        
  da.id_area        
 else        
  c.id_area        
 end         
 ) and        
        
 (C.nro_documento = @documento or @documento is null) and        
 (c.exp_nro=@exp or (@exp is null and c.exp_nro is null)) and        
 (c.tipo_contrato=@tipo_cont or @tipo_cont is null)         
        
order by DP.Apellido, DP.Nombre        
      
    
    ' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_GET_Desglose_UR_Traspaso]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_GET_Desglose_UR_Traspaso]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_GET_Desglose_UR_Traspaso]     
 @id_transpaso int,        
 @documento int        
as        
  
declare @id int  
  
select @id = tabla   
from RH_Traspaso_Documentacion  
where id = @id_transpaso  
 and registro = @documento  
        
  
--Esta es para la pantalla de Otros Datos de Legajo.        
SELECT  convert(char(10),ur.Acto_Fecha,103) fecha,    
 ur.acto_tipo,    
 ur.acto_nro,     
  ''Ministerio de Desarrollo Social'' Jurisdiccion,        
  TADep.Descripcion  Organismo,         
  tur.descripcion Motivo,        
  ''Se le asignan '' + convert(varchar(10),ur.Cant_UR) + '' U.R. a partir del '' + convert(char(10),ur.desde,103)         
  +'' al ''+ convert(char(10),ur.hasta,103) detalle,      
  ur.Documento,      
  ur.id_interna,    
 ur.Tipo_UR    
     
FROM dbo.LEG_Desglose_UR ur        
        
LEFT join dbo.vw_desglose_area da       
 ON ur.documento = da.documento       
INNER join dbo.Tabla_Areas TADep       
  ON TADep.id = dbo.Fx_Primer_Nivel_Dependencia_Area (da.Id_Area)      
INNER join dbo.LEG_Tabla_Tipo_URetributivas tur       
 ON tur.Id = ur.Tipo_UR       
        
WHERE  ur.Id = @id       
 and ur.Documento = @documento       
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[PLA_Get_FormularioDDJJ]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PLA_Get_FormularioDDJJ]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[PLA_Get_FormularioDDJJ]  
 @Dependencia char(24)=null,  
 @area int=null,  
 @mes smallint=null,  
 @año int=null  
AS  
  
SELECT DP.Nro_Documento,  
 DP.Apellido +'', ''+ Nombre ApellidoyNombre,  
 CASE WHEN FD.Legajo IS NULL THEN  
  d.id_area  
 ELSE  
  FD.Area_Donde_Firma  
 END Area_Certifica,  
 d.id_area Area_Actual,  
 dbo.Fx_GET_DescPlanta_Fecha (dp.id_interna, getdate())  Tipo_Planta,  
 (select descripcion from dbo.tabla_areas where id = CASE WHEN FD.Legajo IS NULL THEN  
  d.id_area  
 ELSE  
  FD.Area_Donde_Firma  
 END) DescArea_Certifica,  
 (select descripcion from dbo.tabla_areas where id = D.id_Area) DescArea_Actual  
  
FROM dbo.Datos_Personales DP  
  
--PLANTA PERMANTENTE Y CONTRATADOS CON CONTRATO  
inner JOIN dbo.VW_Contratos_Activos VCA  
 on VCA.Nro_Documento = DP.Nro_Documento  
  
left JOIN dbo.CTR_Contratos C    --*
 on --C.Nro_Documento = dp.Nro_Documento     and 
	c.id_Contrato = (select max(id_Contrato) from dbo.CTR_Contratos where Nro_Documento = dp.Nro_Documento and (Aprobado = 1 OR Alta_Prov_Leg = 1))    
  
  
  
INNER JOIN dbo.VW_Desglose_Area D  
 on D.Id_Interna = DP.Id_Interna   
  
LEFT JOIN dbo.Legajo_Bajas LB   
 on LB.Id_Interna = DP.Id_Interna  
  
LEFT JOIN dbo.PLA_Firmantes_DDJJ FD --SI ES FIRMANDE DE DDJJ  
 on FD.Legajo = DP.Nro_Documento  
  
INNER JOIN dbo.Tabla_Areas TAA  
 on TAA.id = d.id_area  
  
  
WHERE ((LB.Id_Interna IS NULL) OR (month(lb.fecha_baja) = @Mes and year(lb.fecha_baja) = @año)) AND  
 (d.id_area = @Area or @Area is null) AND   
        (d.id_area in (select * from dbo.Fx_Listar_Areas_Dependencia (@Dependencia)) OR @Dependencia IS NULL)  
   
  
ORDER BY ApellidoyNombre  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[VIAT_GET_datosAgente]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[VIAT_GET_datosAgente]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[VIAT_GET_datosAgente]   
@Nro_documento int  
AS  
BEGIN  
SELECT  
 dp.apellido   Apellido,   
 UPPER(dp.nombre)  Nombre,   
 tdi.Descripcion  TDoc,  
 dp.Nro_documento  Nro_documento,   
 niv.nivel   Nivel_Funcion,  
 gra.grado   Grado_Rango,  
 UPPER(pla.descripcion)  TPlanta,  
 CONVERT(VARCHAR(10),dp.fecha_nacimiento,103)  FNacimiento,  
 UPPER(ta.descripcion)   Area  
FROM dbo.datos_personales dp  
inner join dbo.vw_desglose_area da on  
 dp.id_interna = da.id_interna  
inner join dbo.tabla_areas ta on  
 ta.id = da.id_area  
inner join dbo.vw_desglose_nivelGrado vwng on  
 dp.id_interna = vwng.id_interna  
inner join dbo.tabla_niveles niv on  
 niv.id = vwng.id_nivel  
inner join dbo.tabla_grados gra on  
 gra.id = vwng.id_grado  
inner join dbo.vw_desglose_planta vwdp on  
 dp.id_interna = vwdp.id_interna  
inner join dbo.tipo_de_planta pla on  
 vwdp.id_planta = pla.id  
inner join dbo.Tabla_DocIdentidad tdi  
 ON dp.tipo_documento = tdi.Id  
WHERE    
 dp.Nro_documento = @Nro_documento   
END  ' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_GET_Impresion_Anexos_Certificacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_GET_Impresion_Anexos_Certificacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[CTR_GET_Impresion_Anexos_Certificacion]          
 @Expediente varchar(30),          
 @Marca char(1)          
AS          
          
SELECT  dp.Apellido,           
 dp.nombre,          
 --DI.Descripcion + '' '' + cast(dp.Nro_Documento as varchar) Documento,          
 cast(dp.Nro_Documento as varchar) Documento,          
 CASE WHEN TN.Nivel IS NULL THEN          
  TFC.Descripcion          
 ELSE          
  TN.Nivel          
 END Nivel,          
 CASE WHEN TN.Nivel IS NULL THEN          
  Tr.Descripcion          
 ELSE          
  TG.Grado          
 END Grado,          
 CASE WHEN TN.Nivel IS NULL THEN          
  c.monto           
 ELSE          
--  TS.Remuneracion_Fija  --MLD:09/08/07: Modificaicon tabla SINAPA         
  dbo.Fx_Monto_Sinapa (tn.nivel, tg.grado, c.desde)      
      
 END MontoMensual,          
          
-- CASE WHEN TN.Nivel IS NULL THEN          
 -- c.monto * datediff(month,desde,hasta)          
-- ELSE          
 -- TS.Remuneracion_Fija * datediff(month,desde,hasta)          
-- END Monto,          
          
 convert(char(10),c.Desde,103) Desde,          
 convert(char(10),hasta,103) Hasta,          
 ttc.SendLegajos Tipo,          
           
 case when @marca=1 then          
  --AREA CONTRATO          
  isnull(Te2.descripcion,'''')           
 else          
  --AREA DESGLOSE          
  isnull(Te3.descripcion,'''')           
 end Secretaria ,

 NULL resolucion         
          
          
FROM dbo.Ctr_Contratos C          
          
INNER JOIN dbo.Datos_Personales Dp          
 on DP.Nro_Documento = C.Nro_Documento          
LEFT JOIN dbo.Tabla_Niveles TN          
 on TN.Id = c.Nivel          
LEFT JOIN dbo.Tabla_Grados TG          
 on TG.Id = c.Grado          
LEFT JOIN dbo.Tabla_Rangos TR          
 on TR.id = C.Rango          
LEFT JOIN dbo.Tabla_Funciones_Contratos TFC          
 on TFC.Id = C.Funcion          
          
INNER JOIN dbo.Tabla_DocIdentidad DI          
 on DI.Id = dp.Tipo_documento          
          
INNER JOIN dbo.Tabla_Resoluciones_Contratos TRC          
 on TRC.id = C.Tipo_Contrato          
          
Inner join dbo.Tabla_tipos_Contratos TTC          
 on TTC.id = TRC.Tipo_Contrato          
          
--LEFT JOIN dbo.Tabla_Sinapa TS     --MLD: 09/08/07 Modifiacion SINAPA      
-- on (TS.Nivel = tn.nivel) AND          
--    (TS.grado = tg.grado)            
          
LEFT JOIN dbo.CTR_Expedientes_Anexados EA          
 ON EA.Id_Contrato = C.Id_Contrato          
          
          
           
 LEFT JOIN dbo.tabla_areas_estructura TE          
  ON TE.id_area=c.id_area and right(te.codigo,5)<>''00000''          
           
 LEFT JOIN dbo.tabla_areas_estructura TE2          
  on te2.codigo=(left(te.codigo,10)+''00000000000000'')          
          
          
--LEFT join dbo.tabla_areas TA          
-- on TA.id = da.id_area          
           
 LEFT join dbo.vw_desglose_area da          
  on c.nro_documento = da.documento          
          
 LEFT join dbo.tabla_areas TA          
  on TA.id = da.id_area           
          
 LEFT JOIN dbo.tabla_areas_estructura TE4          
  ON TE4.id_area=da.id_area and right(te4.codigo,5)<>''00000''          
          
 LEFT JOIN dbo.tabla_areas_estructura TE3          
  on te3.codigo=(left(te4.codigo,10)+''00000000000000'')          
          
          
WHERE  rtrim(C.Exp_nro) = @Expediente --AND          
-- C.Baja = 0 AND          
-- C.Aprobado =0 AND          
-- EA.Id_Contrato IS NULL           
          
Order by apellido,nombre          
          
          
          
          
          
        
      
    
    
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[LEG_ADD_Recepcion_DDJJ_Domicilio]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LEG_ADD_Recepcion_DDJJ_Domicilio]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LEG_ADD_Recepcion_DDJJ_Domicilio]              
@nro_documento int,              
@fecha_codigo_barra smalldatetime,              
@usuario int,              
@folio char(10),              
@id_comprobante int              
as              
            
set nocount on        
        
DECLARE @tipo varchar(50)              
DECLARE @idInterna int              
Declare @Intervino varchar(15)        
              
DECLARE @Fecha_Comunicacion datetime              
DECLARE @Calle varchar (50)              
DECLARE @Número smallint              
DECLARE @Piso varchar (50)              
DECLARE @Dpto varchar (50)              
DECLARE @Casa varchar (10)              
DECLARE @Manzana varchar (10)              
DECLARE @Barrio varchar (20)              
DECLARE @Torre varchar (10)              
DECLARE @UF varchar (10)        
DECLARE @idLocalidad int      
DECLARE @Localidad varchar (50)              
DECLARE @Codigo_Postal varchar (50)              
DECLARE @Partido_Dpto varchar (50)              
DECLARE @Provincia varchar (50)              
DECLARE @Telefono varchar (20)              
DECLARE @Correo_Electronico varchar (50)              
DECLARE @Nro_Doc int               
DECLARE @Baja bit               
DECLARE @Correo_Electronico_MDS varchar (50)              
DECLARE @fecha_relevamiento smalldatetime  
  
  
SET @tipo = (select Descripcion from Tabla_Comprobante_Descripcion where ID = @id_comprobante)              
SET @idInterna = (Select id_interna FROM dbo.Datos_Personales where nro_documento = @nro_documento)              
SET @Intervino = (Select isnull(U.nombre,'''') FROM dbo.RH_Usuarios U WHERE id = @usuario)        
  

CREATE TABLE #tempo
(
Fecha_comunicacion	smalldatetime,
Documento	int,
Apellido	varchar(50),
Nombre	varchar(50),
Lugar_de_trabajo	varchar(8),
Telefono	varchar(26),
Email_mds	varchar(60),
Email_personal	varchar(60),
id	int,
Calle	varchar(50),
Numero	varchar(6),
Piso	varchar(3),
Depto	varchar(255),
Casa	varchar(20),
Manzana	varchar(20),
Torre	varchar(20),
Uf	varchar(20),
Codigo_postal	varchar(12),
Localidad	varchar(60),
Barrio	varchar(50),
IdLocalidad	int
)


--HISTORICA PERSONA
INSERT INTO #tempo 
select max(Fecha_comunicacion) Fecha_comunicacion,
Documento,
Apellido,
Nombre,
Lugar_de_trabajo,
Telefono,
Email_mds,
Email_personal,
NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL
from CRED_PersonasRelevadasHistorica 
where Documento = @nro_documento
	and Fecha_comunicacion <= @fecha_codigo_barra
group by Documento,Apellido,Nombre,Lugar_de_trabajo,Telefono,Email_mds,Email_personal

--HISTORICA DOMICILIO
UPDATE #tempo
SET id = h.id,
calle = h.Calle,
numero = h.Numero,
piso = h.Piso,
depto = h.Depto,
casa = h.Casa,
manzana = h.Manzana,
torre = h.Torre,
uf = h.Uf,
Codigo_postal = h.Codigo_postal,
Localidad = h.Localidad,
Barrio = h.Barrio,
IdLocalidad = 0
from CRED_DomiciliosHistorica h 
where h.Documento = @nro_documento
	and h.Fecha_ocurrencia = (select max(Fecha_ocurrencia) from CRED_DomiciliosHistorica a
							where a.Documento = @nro_documento)

--ACTUAL PERSONA Y DOMICILIO--
INSERT INTO #tempo
select 
pr2.Fecha_comunicacion,
pr2.Documento,
pr2.Apellido,
pr2.Nombre,
pr2.Lugar_de_trabajo,
pr2.Telefono,
pr2.Email_mds,
pr2.Email_personal,
d.id,  
d.Calle,  
d.Numero,  
d.Piso,  
d.Depto,  
d.Casa,  
d.Manzana,  
d.Torre,  
d.Uf,  
d.Codigo_postal,  
d.Localidad,  
d.Barrio,  
d.IdLocalidad  
from CRED_PersonasRelevadas pr2  
INNER JOIN CRED_Domicilios d              
 ON pr2.Documento = d.Documento  
where pr2.Documento = @nro_documento 


SET @fecha_relevamiento = (select max(fecha_comunicacion) 
							from #tempo
							where fecha_comunicacion <= @fecha_codigo_barra )  

--select * from #tempo
--select @fecha_relevamiento
--select @tipo , @idInterna , @Intervino

--COMPLETO LOS DATOS PARA INGRESAR EN LAS TABLAS
select               
@Fecha_Comunicacion = t.Fecha_comunicacion,              
@Calle = t.Calle,              
@Número = t.Numero,              
@Piso = t.Piso,              
@Dpto = t.Depto,              
@Casa = t.Casa,              
@Manzana = t.Manzana,              
@Barrio = t.Barrio,              
@Torre = t.Torre,              
@UF  = t.Uf,       
@idLocalidad = t.idLocalidad,              
@Localidad = t.Localidad,              
@Codigo_Postal = t.Codigo_postal,              
@Partido_Dpto = 0,              
@Provincia = 0,              
@Telefono = t.Telefono,              
@Correo_Electronico = t.Email_personal,              
@Baja = 0,              
@usuario = @usuario,              
@Correo_Electronico_MDS = t.Email_mds              
from #tempo t
where t.Fecha_comunicacion = @fecha_relevamiento              
      
      
If (@idLocalidad is null OR @idLocalidad = 0)      
BEGIN      
      
 select @Partido_Dpto = a.Descripcion,      
   @Provincia = p.nombreProvincia,      
   @idLocalidad = la.idLocalidad        
 from dbo.localidadesafip la      
  inner join Provincias p      
   on p.codAFIP = la.id_provincia      
  inner join Partidos a      
   on a.Partido = la.ID_Partido      
 where nombrelocalidad = @Localidad      
 and codigopostal = @Codigo_Postal      
      
END      
ELSE      
BEGIN      
      
 select @Partido_Dpto = a.Descripcion,      
   @Provincia = p.nombreProvincia         
 from dbo.localidadesafip la      
  inner join Provincias p      
   on p.codAFIP = la.id_provincia      
  inner join Partidos a      
   on a.Partido = la.ID_Partido      
 where la.idLocalidad = @idLocalidad      
 and la.codigopostal = @Codigo_Postal      
      
END      
             
--declare @fechahoy smalldatetime        
--set @fechahoy = (select getdate())        
              
BEGIN TRANSACTION               
              
EXEC dbo.LEG_ADD_Otros_Indice_Documentos              
''MDS'',                  
''MDS'',                  
@Tipo,                  
@folio,                  
@fecha_relevamiento,                  
@Intervino,                  
@fecha_relevamiento,                  
@Intervino,                  
@idInterna,                  
@nro_documento,              
0,                  
0              
              
if @@error <> 0                             
BEGIN                              
  ROLLBACK TRANSACTION                            
  raiserror 50000 ''ERROR en generar Otros Indice Documentos de credenciales''              
  insert into dbo.CTR_errores_Certificados values (getdate(),@nro_documento,''ERROR en generar Otros_Indice_Documentos de credenciales'')              
  select ''1'' mensaje              
  RETURN                      
END              
              
              
EXEC dbo.Alta_DomicilioPersonal              
@Fecha_Comunicacion,              
@Calle,              
@Número,              
@Piso,              
@Dpto,              
@Casa,              
@Manzana,              
@Barrio,              
@Torre,              
@UF,              
@idLocalidad,              
@Codigo_Postal,              
@Partido_Dpto,              
@Provincia,              
@Telefono,              
@Correo_Electronico,              
@folio,              
@idInterna,              
@nro_documento,              
@Baja,              
@usuario,              
@Correo_Electronico_MDS              
              
if @@error <> 0                             
BEGIN                              
  ROLLBACK TRANSACTION                            
  raiserror 50000 ''ERROR en generar Domicilio Personal de credenciales''              
  insert into dbo.CTR_errores_Certificados values (getdate(),@nro_documento,''ERROR en generar Domicilio Personal de credenciales'' )                                
 select ''2'' mensaje              
 RETURN                      
END              
              
COMMIT TRANSACTION              
              
select ''3'' mensaje' 
END
GO
/****** Object:  StoredProcedure [dbo].[LIQ_GET_Consul_X_NroExp]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[LIQ_GET_Consul_X_NroExp]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[LIQ_GET_Consul_X_NroExp]          
 @Exp varchar(30)=Null,      
 @Acto_Tipo int=null,      
 @Acto_Nro varchar(20)=null,      
 @Acto_Fecha smalldatetime=null      
as          
        
select           
TD.descripcion Tipo_Doc,          
DP.Nro_Documento,          
DP.Apellido,          
DP.Nombre,         
         
isnull(TN.Nivel,'''') Nivel,          
isnull(TG.Grado,'''') Grado,          
--ISNULL(TS.Remuneracion_Fija,0) Monto,   --MLD:09/08/07 Modifiacion tabla SINAPA    
ISNULL(dbo.Fx_Monto_Sinapa (tn.nivel, tg.grado, Cc.desde)  ,0) Monto,    
        
convert(char(10),CC.Desde,103) Desde,        
        
DP.Cuil_Nro,          
convert(char(10),DP.Fecha_Nacimiento,103) Fecha_Nacimiento ,        
EC.Descripcion Estado_Civil,        
        
isnull(NE.Descripcion,'''') Nivel_Estudios,          
isnull(ER.Titulo,'''')Titulo,        
        
case when DP.Regimen_Jubilatorio = 1 then        
  ''Reparto''        
 else        
  ''Capitalización''        
 end Regimen_Jubilatorio,        
isnull(TRJ.Descripcion,'''') AFJP,        
        
 isnull(NC.Sucur_Bco,'''') Sucur_Bco,  
 case NC.Tipo_Cta   
  when 1 then ''Cuenta Corriente''  
  when 2 then ''Caja de Ahorro''  
 end Tipo_Cta,  
 isnull(NC.Nro_Cta,'''') Nro_Cta,  
 NC.CBU,  
 NC.Fecha_Reci
        

from ctr_contratos CC          
          
inner join datos_personales DP          
 on DP.nro_documento=CC.nro_documento        
        
inner join Tabla_DocIdentidad TD          
 on TD.id=DP.Tipo_Documento          
          
LEFT join dbo.tabla_niveles TN              
 on TN.id = CC.nivel              
              
LEFT join dbo.tabla_grados TG              
 on TG.id = CC.grado              
          
--LEFT JOIN dbo.Tabla_Sinapa TS         --Modificaion SINAPA    
-- on (TS.Nivel = TN.nivel) AND            
--    (TS.grado = TG.grado)         
        
LEFT JOIN Tabla_Estado_Civil EC        
 on EC.id=DP.Estado_Civil        
        
LEFT JOIN Estudios_Realizados ER        
 on ER.Nro_Doc=DP.nro_documento and ER.Nivel=(select max(Nivel)       
      from Estudios_Realizados       
      where Nro_Doc=dp.nro_documento)       
        
LEFT JOIN Tabla_Nivel_Estudios NE        
 on NE.id=ER.nivel       
        
LEFT JOIN dbo.Tabla_Regimen_Jubilatorio TRJ        
 on TRJ.id=DP.Denominacion        
        
LEFT JOIN Liq_Nro_Cuenta NC        
 on NC.Documento=DP.nro_documento        
        
where  (CC.exp_nro=@exp or @exp is null)      
 AND (      
  (CC.acto_tipo=@acto_tipo or @acto_tipo is null)        
  and (CC.acto_tipo=@acto_tipo or @acto_tipo is null)        
  and (CC.acto_fecha=@acto_fecha or @acto_fecha is null)        
        )      
    
  




' 
END
GO
/****** Object:  StoredProcedure [dbo].[CTR_ADD_Contrato_Certificado_Automatico]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CTR_ADD_Contrato_Certificado_Automatico]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE Procedure [dbo].[CTR_ADD_Contrato_Certificado_Automatico]              
              
 (@Id_Domicilio_2  [int]=NULL,                    
  @Nro_Documento_3  [int]=NULL,                    
  @Tipo_Contrato_4  [smallint]=NULL,                    
  @Nro_Contrato_5  [char](11)=NULL,                    
  @Desde_6  [smalldatetime]=NULL,                    
  @Hasta_7  [smalldatetime]=NULL,                    
  @Nivel_8  [smallint]=NULL,                    
  @Grado_9  [smallint]=NULL,                    
  @Funcion_10  [smallint]=NULL,                    
  @Rango_11  [smallint]=NULL,                    
  @Monto_12  [money]=NULL,                    
  @Id_Area_13  [int]=NULL,                    
  @Contrato_Firmante_24  [smallint]=NULL,                    
  @Excepcion_26  [bit]=NULL,                    
  @Enmienda_27  [bit]=NULL,                    
  @Observacion_31  [varchar](200)=NULL,                    
  @Estado_32  [char](1)=NULL,                    
  @Conserva_Area bit=NULL,                    
  @Usuario smallint=NULL,                    
  @Salvado bit=0,          
  @Nro_Contrato_Ant [char](11)=NULL)                    
                    
-- @Documento int,              
-- @FechaCorte smalldatetime,              
-- @IdContrato int,              
-- @nivel int              
              
as              
            
set nocount on            
          
delete from dbo.CTR_Tempo_Renovacion      
      
          
--OBTENGO EL ID_CONTRATO CON EL CONTRATO ANTERIOR              
declare @IdContrato int             
select @IdContrato = id_contrato from dbo.ctr_contratos             
where nro_contrato= @Nro_Contrato_ant and nro_documento = @Nro_Documento_3            
            
--OBTENGO FECHA DE CORTE (DESDE -1)            
declare @FechaCorte smalldatetime            
SET @FechaCorte = @Desde_6 - 1            
            
            
IF (select  count(*)             
 from dbo.CTR_Antiguedad_Reconocida_Grado AR              
 inner join dbo.CTR_Antiguedad_Certificados AC              
  on ac.idcalculo = ar.id_calculo              
 WHEre ac.idContrato = @IdContrato ) = 0 BEGIN              
              
insert into dbo.CTR_Tempo_Renovacion values (-1)                     
insert into dbo.CTR_errores_Certificados values (getdate(),@IdContrato,''No Tiene Certificado'' )               
RETURN        
END              
              
              
create table #F              
 (id int identity(1,1),              
  Desde datetime,              
  Hasta datetime,              
  DesdeNuevo datetime,              
  HastaNuevo Datetime,              
  Meses int,              
 Orden int,          
 tipo char(1))              
              
insert into #f (desde,hasta, orden, tipo )               
select  ar.desde, ar.hasta , id_antiguedad , Tipo          
from dbo.CTR_Antiguedad_Reconocida_Grado AR              
inner join dbo.CTR_Antiguedad_Certificados AC              
 on ac.idcalculo = ar.id_calculo              
WHEre ac.idContrato = @IdContrato  and tipo <> ''X''              
              
          
union ALL              
              
select fecha_min Desde, @FechaCorte Hasta , 999999 id_antiguedad, ''X''           
from designaciones_fechas where nro_doc = @Nro_Documento_3              
order by desde, id_antiguedad              
              
declare @i int              
declare @Cantidad int              
set @Cantidad = (select count(*) from #f)              
set @i = 1              
              
--Primer registro va como esta              
update #f              
set desdenuevo = desde,              
    hastanuevo = hasta,              
   meses = datediff("d",desde,hasta)              
where id = @I              
              
declare @UltimoHasta datetime              
set @ultimohasta = (select Hasta from #f where id = @i)              
              
IF @UltimoHAsta > @FechaCorte BEGIN              
 Set @UltimoHasta = @FechaCorte              
END              
              
              
set @i = @i + 1              
WHILE @i <= @Cantidad BEGIN              
 IF (select desde from #f where id = @i) > @UltimoHasta begin              
  update #f              
     set desdenuevo = desde,              
         hastanuevo = case when hasta > @FechaCorte THEn @FechaCorte ELSE Hasta END,              
         meses = datediff("d",desde,case when hasta > @FechaCorte THEn @FechaCorte ELSE Hasta END)              
  where id = @I              
  /*              
  IF (select meses from #f where id = @i) < 1 and  (select meses from #f where id = @i) >= 15 BEGIN              
   update #f              
    set meses = 1              
   where id = @I              
  END               
  */               
 END              
 ELSE               
 BEGIN              
  update #f              
     set desdenuevo = dateadd("D",1,@UltimoHasta),              
         hastanuevo = case when hasta > @FechaCorte THEn @FechaCorte ELSE Hasta END,              
         meses = datediff("d",dateadd("D",1,@UltimoHasta),case when hasta > @FechaCorte THEn @FechaCorte ELSE Hasta END)              
  where id = @I              
  /*              
  IF (select meses from #f where id = @i) < 1 and  (select meses from #f where id = @i) >= 15 BEGIN              
   update #f              
      set meses = 1              
   where id = @I              
  END               
  */               
 END              
 IF (select Hasta from #f where id = @i) > @ultimohasta BEGIN              
  set @ultimohasta = (select Hasta from #f where id = @i)              
 END               
 IF @UltimoHAsta > @FechaCorte BEGIN              
  Set @UltimoHasta = @FechaCorte              
 END              
               
 set @i = @i + 1              
END              
              
Declare @Meses as int              
Declare @Grado as int              
              
              
              
set @Meses = (select sum(meses)  from #f where meses >= 0)              
              
IF round(@meses - (cast(@meses / (365.00/12.00) as int) * (365.00/12.00)),0) >= 15 BEGIN              
 set @Meses = @Meses + 30              
END              
              
set @meses = (@meses / (365.00/12.00))              
              
--select @meses  Meses              
--select *,@IdContrato  from #f              
--exec CTR_GET_Grado_Segun_AntFuncion @Nivel, @meses            
            
          
--OBTENGO EL MAXIMO IDCALCULO            
Declare @idcalculo int            
select @idcalculo = max(idcalculo) + 1 from dbo.CTR_Antiguedad_Certificados            
            
--OBTENGO LA FUNCION             
Declare @funcion varchar(200)            
SELECT @funcion = Descripcion              
FROM dbo.Tabla_Cargos TFC              
INNER JOIN dbo.Tabla_Relacion_Funcion_Nivel RFN              
 on RFN.IdFuncion = TFC.Id              
WHERE Baja =0 AND               
 RFN.IdNIvel = @Nivel_8              
            
--OBTENGO EL CERTIFICADO            
Declare @tipo_certificado int            
select @tipo_certificado = TipoCertificado             
from dbo.CTR_Antiguedad_Certificados            
where IdContrato = @IdContrato            
            
--OBTENGO EL GRADO            
set @grado = dbo.Fx_CTR_Grado_Segun_AntFuncion (@Nivel_8, @meses)             
set @grado = CONVERT(varchar(5),@grado)            
            
if @@error <> 0           
BEGIN                 
 raiserror 50000 ''ERROR en la Funcion''          
 insert into dbo.CTR_Tempo_Renovacion values (-2)                     
 insert into dbo.CTR_errores_Certificados values (getdate(),@IdContrato,''Error en la Funcion'' )                
 RETURN          
END             
        
          
declare @fecha smalldatetime,          
 @nivel_letra char(1),          
 @grado_letra char(1)          
set @fecha =  getdate()            
          
          
select @nivel_letra = nivel from dbo.tabla_niveles              
 where id = @Nivel_8    and baja = 0         
              
      
set @grado_letra = @grado       
      
select @grado = ID from dbo.tabla_grados TG              
where Grado = @grado_Letra  and baja = 0
      
        
declare @Error varchar(500)

----------------CONTROLO EL GRADO SI CORRESPONDE-----------------     
if (@grado < @Grado_9 or @grado > (@Grado_9 + 1))            
BEGIN            
set  @Error = ''ERROR No corresponde el grado'' + convert(char,@Grado)+ '' -- '' + convert(char,@grado_9)
 raiserror 50000  @error --''ERROR No corresponde el grado'' + convert(char,@Grado)+ '' -- '' + convert(char,@grado_9)
 insert into dbo.CTR_Tempo_Renovacion values (-2)                       
 insert into dbo.CTR_errores_Certificados values (getdate(),@IdContrato,''ERROR No corresponde el grado. NIVEL: ''+ @Nivel_8 +'' ''+ ''GRADO: ''+ @grado  )     
 RETURN    
END               
--------------------------------------------------------------------            
            
BEGIN TRANSACTION          
          
-----------------GENERO ANTIGUEDAD----------------------------------            
EXEC dbo.CTR_ADD_Antiguedad_Certificados            
 @IdCalculo,                
 @nivel_letra,                
 @grado_letra,            
 @Funcion,             
 @fecha,           
 @meses,              
 @tipo_certificado             
--------------------------------------------------------------------            
            
if @@error <> 0           
BEGIN            
  ROLLBACK TRANSACTION          
  raiserror 50000 ''ERROR en Generar la Antiguedad''          
 insert into dbo.CTR_Tempo_Renovacion values (-2)                         
 insert into dbo.CTR_errores_Certificados values (getdate(),@IdContrato,''ERROR en Generar la Antiguedad'')                        
 RETURN    
END          
          
          
-------------------ALTA DE CONTRATO---------------------------------            
EXEC dbo.CTR_ADD_Contratos                    
  @Id_Domicilio_2,              
  @Nro_Documento_3,            
  @Tipo_Contrato_4,            
  @Nro_Contrato_5 ,            
  @Desde_6  ,            
  @Hasta_7  ,            
  @Nivel_8  ,            
  @Grado  ,            
  @Funcion_10,              
  @Rango_11  ,            
  @Monto_12  ,            
  @Id_Area_13,            
  @Contrato_Firmante_24  ,            
  @Excepcion_26  ,            
  @Enmienda_27  ,            
  @Observacion_31,             
  @Estado_32  ,            
  @Conserva_Area ,            
  @Usuario ,            
  @Salvado             
--------------------------------------------------------------------            
            
if @@error <> 0           
BEGIN          
  ROLLBACK TRANSACTION          
  raiserror 50000 ''ERROR en Alta de Contrato''          
 insert into dbo.CTR_Tempo_Renovacion values (-2)                         
 insert into dbo.CTR_errores_Certificados values (getdate(),@IdContrato,''ERROR en alta de Contrato'' )                        
 RETURN  
END          
          
          
--OBTENGO EL MAXIMO ID_CONTRATO PARA LA PERSONA            
select @IdContrato = max(id_contrato) from dbo.ctr_contratos where nro_documento= @Nro_Documento_3            
            
--OBTENGO EL CERTIFICADO PARA ASIGNARLO AL CONTRATO            
declare @IdCertificado int            
SELECT @IdCertificado = IdCertificado FROM dbo.CTR_Antiguedad_Certificados where idcalculo = @idcalculo            
            
            
------------ASIGNO EL CONTRATO AL CERTIFICADO---------------------            
EXEC dbo.CTR_ADD_Antiguedad_Certificado_Asignacion            
 @Idcertificado,            
 @IdContrato,            
 @Usuario            
--------------------------------------------------------------------            
          
if @@error <> 0           
BEGIN          
  ROLLBACK TRANSACTION          
  raiserror 50000 ''ERROR en Asignación de Certificado''          
 insert into dbo.CTR_Tempo_Renovacion values (-2)                         
 insert into dbo.CTR_errores_Certificados values (getdate(),@IdContrato,''ERROR en Asignacion de Certificado'' )                        
 RETURN  
END          
            
          
------------ASIGNO ANTIGUEDAD GRADO---------------------            
insert into dbo.CTR_Antiguedad_Reconocida_Grado          
select @IdCalculo, @Nro_Documento_3, Tipo, orden, t.DesdeNuevo, t.HastaNuevo, @FechaCorte, @fecha, @Usuario              
from #f t          
--------------------------------------------------------------------            
           
if @@error <> 0           
BEGIN          
  ROLLBACK TRANSACTION          
  raiserror 50000 ''ERROR en Antiguedad Grado''          
 insert into dbo.CTR_Tempo_Renovacion values (-2)                         
 insert into dbo.CTR_errores_Certificados values (getdate(),@IdContrato,''ERROR en Antiguedad Grado'' )                                
 RETURN          
END          
          
          
drop table #f              
          
insert into dbo.CTR_Tempo_Renovacion values (1)                                 
  
COMMIT TRANSACTION          



' 
END
GO
/****** Object:  StoredProcedure [dbo].[RH_GetDotacionDeArea]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_GetDotacionDeArea]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE procedure [dbo].[RH_GetDotacionDeArea]    
as    
set nocount on    


 select  
  dp.nro_documento,  
  dp.apellido,  
  dp.nombre,  
  dp.id_interna,
  da.id_area,
  dpp.id_planta

from dbo.Datos_personales dp  

inner join vw_desglose_area da
	on da.id_interna = dp.id_interna
--inner join tabla_areas ta
--	on ta.id = da.id_area
  
 --quita las Altas en Tramite  
 left join dbo.Ctr_Contratos CTR  
  on ctr.id_contrato = (select max(id_contrato) from ctr_contratos where nro_documento = dp.nro_documento and aprobado = 0 and baja = 0 and left(nro_contrato,2) = ''01'')  
  
 --quita Contratos vencidos a la fecha  
 left join ctr_contratos CTR2  
  on ctr2.id_contrato =   
   (  
   select c.id_contrato   
   from ctr_contratos C  
   left join ctr_contratos c2  
    on c2.nro_documento = c.nro_documento  
    and c2.aprobado = 0 and c2.baja = 0  
   where c.aprobado = 1 and c.baja = 0 and c.hasta < getdate()  
    and c2.id_contrato is null    
   and c.nro_documento = dp.nro_documento  
   )  



inner join vw_desglose_planta dpp
	on dpp.id_interna = dp.id_interna
  

--inner join tipo_de_planta tp
--	on tp.id = dpp.id_planta

 where ((dp.bajalegajos = 0 and visiblelegajos = 1 )or (visiblecontratos = 1 and bajacontratos = 0))   
  and (ctr.id_contrato is null) -- Filtra Altas en Tramite  
  and (ctr2.id_contrato is null) -- Filtra Contratos vencidos  
  
  



/*

--TEMP Contratos    
select nro_documento    
into #C    
from ctr_contratos c    
where  id_contrato = (select max(id_contrato) from ctr_contratos where nro_documento = c.nro_documento and baja = 0 and aprobado = 1)    
group by nro_documento    
    
    
--TEMP legajos    
select d.nro_documento     
into #L    
from datos_personales d    
left join ctr_contratos c    
 on c.nro_documento = d.nro_documento     
 --and id_contrato = (select max(id_contrato) from ctr_contratos where nro_documento = c.nro_documento and baja = 1)    
where (c.nro_documento is null or d.bajacontratos = 1 and visiblelegajos = 1) and    
      d.bajalegajos = 0 and d.visiblelegajos = 1    
     
    
    
--Contratos 1184    
    
    
SELECT  C.Nro_Documento,    
 dp.apellido,    
 dp.nombre,    
 convert(char(10),dp.fecha_nacimiento,103) FNacimiento,    
 datediff(yy,fecha_nacimiento,getdate()) edad,    
 case when tn.nivel is null then    
  tfc.descripcion     
 else    
  TN.NIVEL    
 end Nivel_Funcion,    
 case when tg.grado is null then    
  tr.descripcion    
 else    
  tg.grado    
 end Grado_rango,    
    
 ttp.descripcion TPlanta,    
 ta.descripcion Area,    
    
    
 ta2.descripcion Dependencia,    
    
   --c.nro_documento Id_interna    
 dp.id_Interna Id_interna    
  
FROM #C C    
INNER JOIN Datos_Personales DP    
 on dp.nro_documento = C.Nro_Documento    
INNER JOIN Ctr_contratos CC    
 ON CC.Nro_documento = C.Nro_Documento AND    
     id_contrato = (Select max(id_contrato) from ctr_contratos where nro_documento = c.nro_documento and baja = 0 and aprobado = 1)     
left JOIN VW_desglose_area DA    
 on da.documento = dp.nro_documento    
left join vw_desglose_nivelgrado DNG    
 on DNG.documento = dp.Nro_documento    
LEFT JOIN vw_desglose_planta DPL    
 on DPL.documento = dp.Nro_documento    
LEFT join tabla_areas TA    
 on ta.id = da.id_area    
    
    
LEFT join tabla_areas TA2    
 on ta2.id = dbo.Fx_Primer_Nivel_Dependencia_Area(da.id_area)    
    
LEFT join tipo_de_planta ttp    
 on ttp.id = dpl.id_planta    
    
left join tabla_funciones_contratos tfc    
 on tfc.id = cc.funcion    
left join tabla_rangos tr    
 on tr.id = cc.rango    
    
LEFT JOIN tabla_niveles tn     
 on tn.id = dng.id_nivel    
left join tabla_grados tg    
 on tg.id = dng.id_grado    
    
    
    
    
UNION    
    
    
    
    
SELECT  L.Nro_Documento,    
 dp.apellido,    
 dp.nombre,    
 convert(char(10),dp.fecha_nacimiento,103) FNacimiento,    
 datediff(yy,fecha_nacimiento,getdate()) edad,    
 tn.nivel,    
 tg.grado,    
 ttp.descripcion TPlanta,    
 ta.descripcion Area,    
 ta2.descripcion,     
 dp.id_interna    
    
     
FROM #L L    
INNER JOIN Datos_Personales DP    
 on dp.nro_documento = L.Nro_Documento    
inner JOIN VW_desglose_area DA    
 on da.documento = l.nro_documento    
left join vw_desglose_nivelgrado DNG    
 on DNG.documento = L.Nro_documento    
    
LEFT JOIN vw_desglose_planta DPL    
 on DPL.documento = l.Nro_documento    
LEFT join tabla_areas TA    
 on ta.id = da.id_area    
LEFT join tabla_areas TA2    
 on ta2.id = dbo.Fx_Primer_Nivel_Dependencia_Area(da.id_area)    
LEFT join tabla_niveles tn    
 on tn.id = dng.id_nivel    
LEFT join  tabla_grados tg    
 on tg.id = dng.id_grado    
LEFT join tipo_de_planta ttp    
 on ttp.id = dpl.id_planta    
     
     
    
drop table #C    
drop table #L    
    

*/
    
GRANT  EXECUTE  ON [dbo].[RH_GET_Dotacion_Completa]  TO [RRHH_SIS_LEG_ADM]      
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_GET_Fecha_Exceso_Masivo]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/****** Object:  StoredProcedure [dbo].[RH_LEG_Incorporacion_UR]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RH_LEG_Incorporacion_UR]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'create procedure [dbo].[RH_LEG_Incorporacion_UR]  
(@Jurisdiccion_1 [varchar](50),    
  @Organismo_2  [varchar](50),    
  @Fecha_3  [datetime],    
  @Detalle_4  [varchar](250),    
  @Id_Interna_5  [int],    
  @doc_tit_6  [int],    
  @folio [char](10),    
  @motivo varchar(20)=null,    
  @datodebaja bit,    
  @datonoimprime bit,  
  @Usuario_RX int,  
  @Id int)   
  
AS  
  
  
  UPDATE dbo.RH_Traspaso_Documentacion              
  SET Usuario_Rx = @Usuario_RX,               
   Fecha_Rx = Getdate()              
  WHERE Id = @Id    
  
  
exec dbo.LEG_ADD_Otros_Datos    
 @Jurisdiccion_1,    
 @Organismo_2,    
 @Fecha_3,    
 @Detalle_4,    
 @Id_Interna_5,    
 @doc_tit_6,  
 @folio,  
 @motivo,  
 @datodebaja,  
 @datonoimprime  
    
  
  

' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[fx_calcular_proporcional]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[fx_calcular_proporcional]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: 10/12/2008
-- Description:	Devuelve el proporcional de vacaciones segun el tiempo trabajado este año
-- =============================================
CREATE FUNCTION [dbo].[fx_calcular_proporcional] 
(
	-- Add the parameters for the function here
	@ingreso_al_mds smalldatetime,
	@antiguedad char(8),
	@fecha_calculo smalldatetime
)
RETURNS int
AS
BEGIN
	declare @retu int
	set @retu = (select round((cast(dbo.fx_calcular_dias(@antiguedad)as float) / cast(12 as float))  * dbo.fx_meses_entre_fechas(@ingreso_al_mds, @fecha_calculo),0))
	return @retu

END
' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[fx_vacaciones_de]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[fx_vacaciones_de]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'-- =============================================		
-- Author:		Agustin
-- Create date: ''09/12/2008''		
-- Description:	''Devuelve los dias correspondientes a una persona''	
-- =============================================		

CREATE FUNCTION [dbo].[fx_vacaciones_de]		
(		
	@documento int,		
	@antiguedad_total char(8), 		
	@antiguedad_privada char(8),		
	@antiguedad_estado char(8),		
	@ingreso_al_mds smalldatetime,		
	@fecha_calculo smalldatetime		
)			
RETURNS int			
AS			
BEGIN			
	declare @dias int 
	set @dias = 
	(
	select
	case when dbo.fx_anios_entre_fechas(@ingreso_al_mds, @fecha_calculo) = 0 then	
		dbo.fx_calcular_proporcional	
		(	
			@ingreso_al_mds,
			dbo.fx_antiguedad_correspondiente
			(
				@ingreso_al_mds, 		
				''01/03/2006'',
				@antiguedad_total, 		
				@antiguedad_estado		
			),			
			@fecha_calculo	
		)				
	else
		dbo.fx_calcular_dias				
		(	
			dbo.fx_antiguedad_correspondiente
			(
				@ingreso_al_mds, 		
				''01/03/2006'',
				@antiguedad_total, 		
				@antiguedad_estado		
			)
		)				
	end			
	)
	return @dias
END						
' 
END
GO
/****** Object:  View [dbo].[VW_DATOS_CONTRATOS_VIGENTES]    Script Date: 07/19/2012 19:45:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_DATOS_CONTRATOS_VIGENTES]'))
EXEC dbo.sp_executesql @statement = N'
CREATE VIEW [dbo].[VW_DATOS_CONTRATOS_VIGENTES]
AS
SELECT     cc.legajo, cc.Id_Area, cc.Desde, cc.funcion
FROM         dbo.VW_CONTRATOS_VIGENTES cv INNER JOIN
                      dbo.CContrato cc ON cc.Legajo = cv.Legajo AND cc.Desde = cv.DESDE



'
GO
/****** Object:  StoredProcedure [dbo].[CON_GEST_Dotacion]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[CON_GEST_Dotacion]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[CON_GEST_Dotacion]
	@Fecha smalldatetime=NULL
AS
select MAX(ta.descripcion) Sector,  count(va.id_interna) Cantidad, CODIGO
from dbo.vw_desglose_area va
inner join dbo.tabla_areas_estructura ta
	on ta.id_area = va.id_area
LEFT join dbo.Legajo_Bajas LB 
	ON LB.Nro_Doc = VA.Documento
where LEFT(CODIGO,4) = ''0100''AND
	Lb.Nro_doc IS NULL
group by codigo

UNION

select MAX(ta.descripcion),  count(va.id_interna) , CODIGO
from dbo.vw_desglose_area va
inner join dbo.tabla_areas_estructura ta
	on ta.id_area = va.id_area
LEFT join dbo.Legajo_Bajas LB 
	ON LB.Nro_Doc = VA.Documento
where right(CODIGO,5) <> ''00000'' AND
	Lb.Nro_doc IS NULL
group by codigo

ORDER BY CODIGO


' 
END
GO
/****** Object:  StoredProcedure [dbo].[GEN_GET_Agente]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GEN_GET_Agente]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================  
-- Author:  <Agustin>  
-- Create date: <10/03/2008>  
-- Description: <Trae los datos de un agente evaluado>  
-- =============================================  
CREATE PROCEDURE [dbo].[GEN_GET_Agente]  
 @id_interna int  
AS  
BEGIN  
 SET NOCOUNT ON;  
  
 select dp.apellido, dp.nombre, ttp.id id_planta,   
  ttp.descripcion desc_planta, ttp.tipo t_planta,   
  ttp.baja baja_planta,
  dp.Nro_Documento
 from dbo.Datos_Personales dp  
 inner join dbo.vw_desglose_planta pl  
  on dp.id_interna = pl.id_interna  
 inner join dbo.tipo_de_planta ttp  
  on pl.id_planta = ttp.id  
 where dp.id_interna = @id_interna   
   
  
END  
  

' 
END
GO
/****** Object:  StoredProcedure [dbo].[ESTR_GET_Estructura_Libre]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ESTR_GET_Estructura_Libre]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'
CREATE procedure [dbo].[ESTR_GET_Estructura_Libre]    
	@area int    
AS
-- SELECT  count(da.id_interna) Cantidad comentado por FAML 21/10/09 PORQUE NO ME DEJABA BORRAR ESTRUCTURAS
SELECT  da.id_interna Cantidad    
FROM dbo.VW_Desglose_Area   DA
INNER JOIN dbo.Datos_Personales DP
	on DP.Id_interna = DA.Id_Interna
WHERE id_area in (select (codigo) from fx_Listar_Dependencias_Areas (@area)) AND
	((DP.VisibleLegajos = 1 and BajaLegajos = 0) OR (Dp.VisibleContratos = 1 and BajaContratos = 0))
' 
END
GO
/****** Object:  StoredProcedure [dbo].[Web_GetTipoDePlantaDePersona]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Web_GetTipoDePlantaDePersona]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustín
-- Create date: 14/04/2009
-- Description:	Devuelve el tipo de planta actual de un agente
-- =============================================
CREATE PROCEDURE [dbo].[Web_GetTipoDePlantaDePersona]
	@Documento int
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	select 
		id_Planta idPlanta 
	from 
		dbo.vw_desglose_planta 
	where id_interna = 
					(select 
						id_interna 
					from
						dbo.datos_personales
					where nro_documento = @documento
					)
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[RPT_EVAL_Formulario_Principal]    Script Date: 07/19/2012 19:45:10 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[RPT_EVAL_Formulario_Principal]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'


CREATE procedure [dbo].[RPT_EVAL_Formulario_Principal]
	@Id_Interna int
AS
select  Doc.Descripcion TipoDocAgente,
	DA.Nro_Documento DocumentoAgente,
	DA.Id_Interna LegajoAgente,
	DA.Apellido +'', ''+ DA.Nombre ApellidoAgente,
	TN.Nivel NivelAgente,
	TG.Grado GradoAgente,
	TA.Descripcion AgrupamientoAgente,
	Doce.Descripcion TipoDocEvaluador,
	DE.Nro_Documento DocumentoEvaluador,
	DE.Id_Interna LegajoEvaluador,
	DE.Apellido +'', ''+ DE.Nombre ApellidoEvaluador,
	TNe.Nivel NivelEvaluador,
	TGe.Grado GradoEvaluador,
	TAe.Descripcion AgrupamientoEvaluador	
FROM dbo.Datos_Personales DA
INNER JOIN dbo.Tabla_DocIdentidad Doc
	ON Doc.Id = DA.Tipo_Documento
INNER JOIN dbo.VW_Desglose_NivelGrado NG
	ON NG.Id_Interna = DA.Id_Interna

INNER JOIN dbo.Tabla_Niveles TN
	ON TN.id = NG.Id_Nivel
INNER JOIN dbo.Tabla_Grados TG
	ON TG.id = NG.Id_Grado

LEFT JOIN dbo.Carrera_Administrativa CA
	ON CA.Id_Interna = DA.Id_Interna AND
	   CA.Fecha_Desde = (select max(fecha_desde) from dbo.Carrera_Administrativa Where Id_Interna = @Id_Interna)

LEFT JOIN dbo.Tabla_Agrupamiento TA 
	ON TA.Id = CA.Id_Agrupamiento

--EVALUADORES
LEFT JOIN dbo.EVAL_Evaluadores_Agentes EAgente
	on EAgente.Id_Agente = DA.Id_Interna

INNER JOIN dbo.VW_Desglose_Area DsA
	ON Dsa.Id_Interna = DA.Id_Interna

LEFT JOIN dbo.EVAL_Evaluadores_Areas EArea
	on EArea.Id_Area = Dsa.Id_Area

INNER JOIN dbo.Datos_Personales DE
	ON DE.Id_Interna = EAgente.Id_Evaluador OR
	   DE.Id_Interna = EArea.Id_Evaluador	

INNER JOIN dbo.VW_Desglose_NivelGrado NGe
	ON NGe.Id_Interna = DE.Id_Interna

INNER JOIN dbo.Tabla_Niveles TNe
	ON TNe.id = NGe.Id_Nivel

INNER JOIN dbo.Tabla_Grados TGe
	ON TGe.id = NGe.Id_Grado

INNER JOIN dbo.Tabla_DocIdentidad Doce
	ON Doce.Id = DE.Tipo_Documento


LEFT JOIN dbo.Carrera_Administrativa CAe
	ON CAe.Id_Interna = DE.Id_Interna AND
	   CAe.Fecha_Desde = (select max(fecha_desde) from dbo.Carrera_Administrativa Where Id_Interna = DE.Id_Interna)

LEFT JOIN dbo.Tabla_Agrupamiento TAe
	ON TAe.Id = CAe.Id_Agrupamiento


WHERE DA.Id_Interna = @Id_Interna



' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[fx_get_meses_trabajados]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[fx_get_meses_trabajados]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: ''12/11/2008''
-- Description:	Devuelve los meses trabajados entre dos fechas
-- =============================================
CREATE FUNCTION [dbo].[fx_get_meses_trabajados]
(
	@fecha_1 smalldatetime, 
	@fecha_2 smalldatetime
)
RETURNS int
AS
BEGIN
return	dbo.fx_get_meses_de_antiguedad
		(
			db_rrhh.dbo.fx_calcula_antiguedad_asistencia
			(
				@fecha_1, @fecha_2
			)
		)
END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[GEN_GET_Ids_Dependencia]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[GEN_GET_Ids_Dependencia]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'-- =============================================
-- Author:		<Agustin>
-- Create date: <01/04/2008>
-- Description:	<Trae todos los ids de las dependencias de un area hacia arriva searados por punto y coma>
-- =============================================
CREATE PROCEDURE [dbo].[GEN_GET_Ids_Dependencia]
@id_area int
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	SELECT dbo.FxIds_Dependencia (@id_area) ids
END


' 
END
GO
/****** Object:  UserDefinedFunction [dbo].[fx_get_proporcional_vacaciones]    Script Date: 07/19/2012 19:45:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[fx_get_proporcional_vacaciones]') AND xtype in (N'FN', N'IF', N'TF'))
BEGIN
execute dbo.sp_executesql @statement = N'-- =============================================
-- Author:		Agustin
-- Create date: ''01/12/2008''
-- Description:	Devuelve la cantidad de dias proporcional de las vacaciones segun la antiguedad
-- =============================================
CREATE FUNCTION [dbo].[fx_get_proporcional_vacaciones]
(
	@fecha_min smalldatetime,
	@fecha_calculo smalldatetime,
	@antiguedad_anterior char(10)
)
RETURNS float
AS
BEGIN
return
	
	round	(
		convert
		(
			float,
			(
				(
					dbo.fx_get_dias_vacaciones(@fecha_min, @fecha_calculo, @antiguedad_anterior )
				)
				/ convert(float, 12)
			) 
			* cast (dbo.fx_get_meses_trabajados(@fecha_min, @fecha_calculo) as float)
		)
		, 0
	)

END
' 
END
GO
/****** Object:  StoredProcedure [dbo].[ASIS_CALCULO_DIAS_LICENCIAS]    Script Date: 07/19/2012 19:45:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ASIS_CALCULO_DIAS_LICENCIAS]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[ASIS_CALCULO_DIAS_LICENCIAS]

@año char(4)

AS

set nocount on
--declare @año varchar(20)
--set @año = ''2009''
declare @str_fecha_calculo char(10)
set @str_fecha_calculo = ''31/12/'' + @año

select 
df.id_interna, 
dp.nro_documento,
--dbo.fx_dame_antiguedad_anterior_correspondiente(df.fecha_min, ''01/03/2006'', a.ant_total, a.ant_total) antiguedad,
--aca esta funcionando mal, me devuelve todos false, no entra nunca a get_proporcional
case when dbo.fx_anios_entre_fechas(df.fecha_min, @str_fecha_calculo) = 0 THEN
	dbo.fx_get_proporcional_vacaciones(df.fecha_min, @str_fecha_calculo, dbo.fx_dame_antiguedad_anterior_correspondiente(df.fecha_min, ''01/03/2006'', a.ant_total, a.ant_total))
else
	dbo.fx_get_vacaciones_por_años_de_antiguedad(df.fecha_min, dbo. fx_dame_antiguedad_anterior_correspondiente(df.fecha_min, ''01/03/2006'', a.ant_total, a.ant_total), @str_fecha_calculo)
end
Dias_Autorizados
into #tmp_autorizaciones

from dbo.designaciones_fechas df
inner join dbo.antiguedad a on
	a.id_interna = df.id_interna
inner join datos_personales dp on 
	df.id_interna = dp.id_interna
left join dbo.ctr_contratos cont on
	cont.nro_documento = dp.nro_documento and
	cont.aprobado = 1 and cont.baja = 0
where 
	year(df.fecha_min) <= @año
	and (cont.id_contrato is null or cont.tipo_contrato <> 2)
order by df.id_interna




select tmp.id_interna, dp.apellido, dp.nombre, tmp.dias_autorizados, 
df.fecha_min fecha_ingreso,
dbo.Fx_Calcula_Antiguedad(df.fecha_min, @str_fecha_calculo) antiguedad_ministerio,
an.ant_total antiguedad_anterior
--into #tmp_vacaciones
from #tmp_autorizaciones tmp 
left join dbo.autorizaciones_licencias al on
	al.id_interna = tmp.id_interna
	and (al.periodo = @año OR al.periodo IS NULL)
	and (al.id_concepto_licencia = 1 OR al.id_concepto_licencia IS NULL)
inner join dbo.datos_personales dp on
	dp.id_interna = tmp.id_interna
inner join dbo.antiguedad an on 
	an.id_interna = dp.id_interna
inner join dbo.designaciones_fechas df on
	df.id_interna = dp.id_interna

WHERE al.id IS NULL
ORDER by tmp.id_interna


--select max (id) from dbo.autorizaciones_licencias

--insert into [DBO].[_TMP_DIAS]
--	(id_interna,
--	dias_autorizados,
--	id_concepto_licencia,
--	periodo,
--	dias_tomados)
--select [id_interna] ,
--	[dias_autorizados] ,
--	1,
--	2009,
--	0
--from #tmp_autorizaciones

drop table #tmp_autorizaciones


--select * from _tmp_dias' 
END
GO
/****** Object:  Default [DF_ASIS_Partes_Pendientes_Presentado]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_ASIS_Partes_Pendientes_Presentado]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Partes_Pendientes]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_ASIS_Partes_Pendientes_Presentado]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ASIS_Partes_Pendientes] ADD  CONSTRAINT [DF_ASIS_Partes_Pendientes_Presentado]  DEFAULT (0) FOR [Presentado]
END


End
GO
/****** Object:  Default [DF_ASIS_Planillas_Impresas_Recepciono]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_ASIS_Planillas_Impresas_Recepciono]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Planillas_Recibidas]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_ASIS_Planillas_Impresas_Recepciono]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[ASIS_Planillas_Recibidas] ADD  CONSTRAINT [DF_ASIS_Planillas_Impresas_Recepciono]  DEFAULT (0) FOR [Recepciono]
END


End
GO
/****** Object:  Default [DF_Carrera_Administrativa_Id_Tipo_Cargo]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Carrera_Administrativa_Id_Tipo_Cargo]') AND parent_object_id = OBJECT_ID(N'[dbo].[Carrera_Administrativa]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Carrera_Administrativa_Id_Tipo_Cargo]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Carrera_Administrativa] ADD  CONSTRAINT [DF_Carrera_Administrativa_Id_Tipo_Cargo]  DEFAULT (0) FOR [Id_Tipo_Cargo]
END


End
GO
/****** Object:  Default [DF_CContrato_Firmado]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CContrato_Firmado]') AND parent_object_id = OBJECT_ID(N'[dbo].[CContrato]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CContrato_Firmado]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CContrato] ADD  CONSTRAINT [DF_CContrato_Firmado]  DEFAULT (0) FOR [Firmado]
END


End
GO
/****** Object:  Default [DF_CContrato_Impreso]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CContrato_Impreso]') AND parent_object_id = OBJECT_ID(N'[dbo].[CContrato]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CContrato_Impreso]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CContrato] ADD  CONSTRAINT [DF_CContrato_Impreso]  DEFAULT (0) FOR [Impreso]
END


End
GO
/****** Object:  Default [DF_CContrato_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CContrato_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[CContrato]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CContrato_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CContrato] ADD  CONSTRAINT [DF_CContrato_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_CContrato_Aprobado]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CContrato_Aprobado]') AND parent_object_id = OBJECT_ID(N'[dbo].[CContrato]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CContrato_Aprobado]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CContrato] ADD  CONSTRAINT [DF_CContrato_Aprobado]  DEFAULT (0) FOR [Aprobado]
END


End
GO
/****** Object:  Default [DF_CContrato_Excepcion]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CContrato_Excepcion]') AND parent_object_id = OBJECT_ID(N'[dbo].[CContrato]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CContrato_Excepcion]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CContrato] ADD  CONSTRAINT [DF_CContrato_Excepcion]  DEFAULT (0) FOR [Excepcion]
END


End
GO
/****** Object:  Default [DF_CContrato_Enmienda]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CContrato_Enmienda]') AND parent_object_id = OBJECT_ID(N'[dbo].[CContrato]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CContrato_Enmienda]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CContrato] ADD  CONSTRAINT [DF_CContrato_Enmienda]  DEFAULT (0) FOR [Enmienda]
END


End
GO
/****** Object:  Default [DF_CContrato_Conserva_Area]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CContrato_Conserva_Area]') AND parent_object_id = OBJECT_ID(N'[dbo].[CContrato]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CContrato_Conserva_Area]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CContrato] ADD  CONSTRAINT [DF_CContrato_Conserva_Area]  DEFAULT (0) FOR [Conserva_Area]
END


End
GO
/****** Object:  Default [DF_CFacturas_Nro_pase]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CFacturas_Nro_pase]') AND parent_object_id = OBJECT_ID(N'[dbo].[CFacturas]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CFacturas_Nro_pase]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CFacturas] ADD  CONSTRAINT [DF_CFacturas_Nro_pase]  DEFAULT (0) FOR [Nro_pase]
END


End
GO
/****** Object:  Default [DF_CFacturas_Anulada]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CFacturas_Anulada]') AND parent_object_id = OBJECT_ID(N'[dbo].[CFacturas]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CFacturas_Anulada]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CFacturas] ADD  CONSTRAINT [DF_CFacturas_Anulada]  DEFAULT (0) FOR [Anulada]
END


End
GO
/****** Object:  Default [DF_CFirmantes_Contratos_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CFirmantes_Contratos_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[CFirmantes_Contratos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CFirmantes_Contratos_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CFirmantes_Contratos] ADD  CONSTRAINT [DF_CFirmantes_Contratos_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__Cred_Asig__IdUsu__218D7ED9]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Cred_Asig__IdUsu__218D7ED9]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Asignaciones]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Cred_Asig__IdUsu__218D7ED9]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CRED_Asignaciones] ADD  CONSTRAINT [DF__Cred_Asig__IdUsu__218D7ED9]  DEFAULT (0) FOR [IdUsuario]
END


End
GO
/****** Object:  Default [DF__Cred_Baja__IdUsu__1AE0814A]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Cred_Baja__IdUsu__1AE0814A]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Bajas]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Cred_Baja__IdUsu__1AE0814A]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CRED_Bajas] ADD  CONSTRAINT [DF__Cred_Baja__IdUsu__1AE0814A]  DEFAULT (0) FOR [IdUsuario]
END


End
GO
/****** Object:  Default [DF__Cred_docu__IdUsu__1CC8C9BC]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Cred_docu__IdUsu__1CC8C9BC]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Documentos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Cred_docu__IdUsu__1CC8C9BC]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CRED_Documentos] ADD  CONSTRAINT [DF__Cred_docu__IdUsu__1CC8C9BC]  DEFAULT (0) FOR [IdUsuario]
END


End
GO
/****** Object:  Default [DF__CRED_Pers__IdUsu__1FA53667]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__CRED_Pers__IdUsu__1FA53667]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_PersonasRelevadas]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__CRED_Pers__IdUsu__1FA53667]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CRED_PersonasRelevadas] ADD  CONSTRAINT [DF__CRED_Pers__IdUsu__1FA53667]  DEFAULT (0) FOR [IdUsuario]
END


End
GO
/****** Object:  Default [DF_CTR_Antiguedad_Certificados_Impreso]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CTR_Antiguedad_Certificados_Impreso]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Antiguedad_Certificados]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CTR_Antiguedad_Certificados_Impreso]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Antiguedad_Certificados] ADD  CONSTRAINT [DF_CTR_Antiguedad_Certificados_Impreso]  DEFAULT (0) FOR [Impreso]
END


End
GO
/****** Object:  Default [DF_CTR_Contratos_Firmado]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CTR_Contratos_Firmado]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Contratos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CTR_Contratos_Firmado]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Contratos] ADD  CONSTRAINT [DF_CTR_Contratos_Firmado]  DEFAULT (0) FOR [Firmado]
END


End
GO
/****** Object:  Default [DF_CTR_Contratos_Impreso]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CTR_Contratos_Impreso]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Contratos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CTR_Contratos_Impreso]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Contratos] ADD  CONSTRAINT [DF_CTR_Contratos_Impreso]  DEFAULT (0) FOR [Impreso]
END


End
GO
/****** Object:  Default [DF_CTR_Contratos_Aprobado]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CTR_Contratos_Aprobado]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Contratos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CTR_Contratos_Aprobado]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Contratos] ADD  CONSTRAINT [DF_CTR_Contratos_Aprobado]  DEFAULT (0) FOR [Aprobado]
END


End
GO
/****** Object:  Default [DF_CTR_Contratos_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CTR_Contratos_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Contratos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CTR_Contratos_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Contratos] ADD  CONSTRAINT [DF_CTR_Contratos_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_CTR_Contratos_Excepcion]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CTR_Contratos_Excepcion]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Contratos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CTR_Contratos_Excepcion]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Contratos] ADD  CONSTRAINT [DF_CTR_Contratos_Excepcion]  DEFAULT (0) FOR [Excepcion]
END


End
GO
/****** Object:  Default [DF_CTR_Contratos_Enmienda]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CTR_Contratos_Enmienda]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Contratos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CTR_Contratos_Enmienda]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Contratos] ADD  CONSTRAINT [DF_CTR_Contratos_Enmienda]  DEFAULT (0) FOR [Enmienda]
END


End
GO
/****** Object:  Default [DF_CTR_Contratos_Salvado]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CTR_Contratos_Salvado]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Contratos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CTR_Contratos_Salvado]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Contratos] ADD  CONSTRAINT [DF_CTR_Contratos_Salvado]  DEFAULT (0) FOR [Salvado]
END


End
GO
/****** Object:  Default [DF__ctr_contr__Reser__5FD3FEBE]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__ctr_contr__Reser__5FD3FEBE]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Contratos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__ctr_contr__Reser__5FD3FEBE]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Contratos] ADD  CONSTRAINT [DF__ctr_contr__Reser__5FD3FEBE]  DEFAULT (0) FOR [Reservado]
END


End
GO
/****** Object:  Default [DF__CTR_Contr__Firma__04115F34]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__CTR_Contr__Firma__04115F34]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Contratos_Tmp_Impresion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__CTR_Contr__Firma__04115F34]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Contratos_Tmp_Impresion] ADD  CONSTRAINT [DF__CTR_Contr__Firma__04115F34]  DEFAULT (0) FOR [Firmado]
END


End
GO
/****** Object:  Default [DF__CTR_Contr__Impre__0505836D]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__CTR_Contr__Impre__0505836D]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Contratos_Tmp_Impresion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__CTR_Contr__Impre__0505836D]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Contratos_Tmp_Impresion] ADD  CONSTRAINT [DF__CTR_Contr__Impre__0505836D]  DEFAULT (0) FOR [Impreso]
END


End
GO
/****** Object:  Default [DF__CTR_Contr__Aprob__05F9A7A6]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__CTR_Contr__Aprob__05F9A7A6]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Contratos_Tmp_Impresion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__CTR_Contr__Aprob__05F9A7A6]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Contratos_Tmp_Impresion] ADD  CONSTRAINT [DF__CTR_Contr__Aprob__05F9A7A6]  DEFAULT (0) FOR [Aprobado]
END


End
GO
/****** Object:  Default [DF__CTR_Contra__Baja__06EDCBDF]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__CTR_Contra__Baja__06EDCBDF]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Contratos_Tmp_Impresion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__CTR_Contra__Baja__06EDCBDF]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Contratos_Tmp_Impresion] ADD  CONSTRAINT [DF__CTR_Contra__Baja__06EDCBDF]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__CTR_Contr__Excep__07E1F018]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__CTR_Contr__Excep__07E1F018]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Contratos_Tmp_Impresion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__CTR_Contr__Excep__07E1F018]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Contratos_Tmp_Impresion] ADD  CONSTRAINT [DF__CTR_Contr__Excep__07E1F018]  DEFAULT (0) FOR [Excepcion]
END


End
GO
/****** Object:  Default [DF__CTR_Contr__Enmie__08D61451]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__CTR_Contr__Enmie__08D61451]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Contratos_Tmp_Impresion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__CTR_Contr__Enmie__08D61451]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Contratos_Tmp_Impresion] ADD  CONSTRAINT [DF__CTR_Contr__Enmie__08D61451]  DEFAULT (0) FOR [Enmienda]
END


End
GO
/****** Object:  Default [DF__CTR_Contr__Salva__09CA388A]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__CTR_Contr__Salva__09CA388A]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Contratos_Tmp_Impresion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__CTR_Contr__Salva__09CA388A]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Contratos_Tmp_Impresion] ADD  CONSTRAINT [DF__CTR_Contr__Salva__09CA388A]  DEFAULT (0) FOR [Salvado]
END


End
GO
/****** Object:  Default [DF__CTR_Contr__Reser__0ABE5CC3]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__CTR_Contr__Reser__0ABE5CC3]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Contratos_Tmp_Impresion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__CTR_Contr__Reser__0ABE5CC3]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Contratos_Tmp_Impresion] ADD  CONSTRAINT [DF__CTR_Contr__Reser__0ABE5CC3]  DEFAULT (0) FOR [Reservado]
END


End
GO
/****** Object:  Default [DF_FAC_Facturas_Anulada]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_FAC_Facturas_Anulada]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Facturas]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_FAC_Facturas_Anulada]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Facturas] ADD  CONSTRAINT [DF_FAC_Facturas_Anulada]  DEFAULT (0) FOR [Area]
END


End
GO
/****** Object:  Default [DF_CTR_Facturas_Anulada]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CTR_Facturas_Anulada]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Facturas]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CTR_Facturas_Anulada]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Facturas] ADD  CONSTRAINT [DF_CTR_Facturas_Anulada]  DEFAULT (0) FOR [Anulada]
END


End
GO
/****** Object:  Default [DF_CTR_Facturas_Detalle_Anulada]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_CTR_Facturas_Detalle_Anulada]') AND parent_object_id = OBJECT_ID(N'[dbo].[CTR_Facturas_Detalle]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_CTR_Facturas_Detalle_Anulada]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[CTR_Facturas_Detalle] ADD  CONSTRAINT [DF_CTR_Facturas_Detalle_Anulada]  DEFAULT (0) FOR [Anulada]
END


End
GO
/****** Object:  Default [DF_Datos_Familiares_discapacitado]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Datos_Familiares_discapacitado]') AND parent_object_id = OBJECT_ID(N'[dbo].[Datos_Familiares]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Datos_Familiares_discapacitado]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Datos_Familiares] ADD  CONSTRAINT [DF_Datos_Familiares_discapacitado]  DEFAULT (0) FOR [discapacitado]
END


End
GO
/****** Object:  Default [DF_Datos_Familiares_adoptado]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Datos_Familiares_adoptado]') AND parent_object_id = OBJECT_ID(N'[dbo].[Datos_Familiares]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Datos_Familiares_adoptado]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Datos_Familiares] ADD  CONSTRAINT [DF_Datos_Familiares_adoptado]  DEFAULT (0) FOR [adoptado]
END


End
GO
/****** Object:  Default [DF__datos_per__Visib__16300F6F]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__datos_per__Visib__16300F6F]') AND parent_object_id = OBJECT_ID(N'[dbo].[Datos_Personales]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__datos_per__Visib__16300F6F]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Datos_Personales] ADD  CONSTRAINT [DF__datos_per__Visib__16300F6F]  DEFAULT (0) FOR [VisibleLegajos]
END


End
GO
/****** Object:  Default [DF__datos_per__Visib__172433A8]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__datos_per__Visib__172433A8]') AND parent_object_id = OBJECT_ID(N'[dbo].[Datos_Personales]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__datos_per__Visib__172433A8]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Datos_Personales] ADD  CONSTRAINT [DF__datos_per__Visib__172433A8]  DEFAULT (0) FOR [VisibleContratos]
END


End
GO
/****** Object:  Default [DF_Datos_Personales_BajaLegajos]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Datos_Personales_BajaLegajos]') AND parent_object_id = OBJECT_ID(N'[dbo].[Datos_Personales]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Datos_Personales_BajaLegajos]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Datos_Personales] ADD  CONSTRAINT [DF_Datos_Personales_BajaLegajos]  DEFAULT (0) FOR [BajaLegajos]
END


End
GO
/****** Object:  Default [DF_Datos_Personales_BajaContratos]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Datos_Personales_BajaContratos]') AND parent_object_id = OBJECT_ID(N'[dbo].[Datos_Personales]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Datos_Personales_BajaContratos]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Datos_Personales] ADD  CONSTRAINT [DF_Datos_Personales_BajaContratos]  DEFAULT (0) FOR [BajaContratos]
END


End
GO
/****** Object:  Default [DF_Domicilio_Personal_DatoDeBaja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Domicilio_Personal_DatoDeBaja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Domicilio_Personal]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Domicilio_Personal_DatoDeBaja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Domicilio_Personal] ADD  CONSTRAINT [DF_Domicilio_Personal_DatoDeBaja]  DEFAULT (0) FOR [DatoDeBaja]
END


End
GO
/****** Object:  Default [DF_Embargos_Id_Embargo]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Embargos_Id_Embargo]') AND parent_object_id = OBJECT_ID(N'[dbo].[Embargos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Embargos_Id_Embargo]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Embargos] ADD  CONSTRAINT [DF_Embargos_Id_Embargo]  DEFAULT (1) FOR [Id_Embargo]
END


End
GO
/****** Object:  Default [DF_Estudios_Realizados_Completo]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Estudios_Realizados_Completo]') AND parent_object_id = OBJECT_ID(N'[dbo].[Estudios_Realizados]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Estudios_Realizados_Completo]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Estudios_Realizados] ADD  CONSTRAINT [DF_Estudios_Realizados_Completo]  DEFAULT (1) FOR [Completo]
END


End
GO
/****** Object:  Default [DF__GEN_ObraSo__Baja__7410CCEC]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__GEN_ObraSo__Baja__7410CCEC]') AND parent_object_id = OBJECT_ID(N'[dbo].[GEN_ObraSocial]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__GEN_ObraSo__Baja__7410CCEC]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[GEN_ObraSocial] ADD  CONSTRAINT [DF__GEN_ObraSo__Baja__7410CCEC]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_GU_Recibos_Haberes_Monto]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_GU_Recibos_Haberes_Monto]') AND parent_object_id = OBJECT_ID(N'[dbo].[GU_Recibos_Haberes]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_GU_Recibos_Haberes_Monto]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[GU_Recibos_Haberes] ADD  CONSTRAINT [DF_GU_Recibos_Haberes_Monto]  DEFAULT (0) FOR [Monto]
END


End
GO
/****** Object:  Default [DF_LEG_Administracion_Folios_Desglosado]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Administracion_Folios_Desglosado]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Administracion_Folios]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Administracion_Folios_Desglosado]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Administracion_Folios] ADD  CONSTRAINT [DF_LEG_Administracion_Folios_Desglosado]  DEFAULT (0) FOR [Desglosado]
END


End
GO
/****** Object:  Default [DF_LEG_Desglose_FE_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Desglose_FE_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_FE]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Desglose_FE_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Desglose_FE] ADD  CONSTRAINT [DF_LEG_Desglose_FE_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__leg_desgl__Trata__44EAFE58]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__leg_desgl__Trata__44EAFE58]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_FE]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__leg_desgl__Trata__44EAFE58]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Desglose_FE] ADD  CONSTRAINT [DF__leg_desgl__Trata__44EAFE58]  DEFAULT (0) FOR [Tratamiento]
END


End
GO
/****** Object:  Default [DF__leg_desgl__Id_Ar__45DF2291]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__leg_desgl__Id_Ar__45DF2291]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_FE]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__leg_desgl__Id_Ar__45DF2291]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Desglose_FE] ADD  CONSTRAINT [DF__leg_desgl__Id_Ar__45DF2291]  DEFAULT (0) FOR [Id_Area]
END


End
GO
/****** Object:  Default [DF_LEG_Desglose_UR_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Desglose_UR_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_UR]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Desglose_UR_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Desglose_UR] ADD  CONSTRAINT [DF_LEG_Desglose_UR_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_LEG_Documentacion_Legajo_Foto]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Documentacion_Legajo_Foto]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Documentacion_Legajo_Foto]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo] ADD  CONSTRAINT [DF_LEG_Documentacion_Legajo_Foto]  DEFAULT (0) FOR [Foto]
END


End
GO
/****** Object:  Default [DF_LEG_Documentacion_Legajo_Apto]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Documentacion_Legajo_Apto]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Documentacion_Legajo_Apto]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo] ADD  CONSTRAINT [DF_LEG_Documentacion_Legajo_Apto]  DEFAULT (0) FOR [PresentoAptoMedico]
END


End
GO
/****** Object:  Default [DF_LEG_Documentacion_Legajo_Decreto]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Documentacion_Legajo_Decreto]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Documentacion_Legajo_Decreto]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo] ADD  CONSTRAINT [DF_LEG_Documentacion_Legajo_Decreto]  DEFAULT (0) FOR [Decreto_894]
END


End
GO
/****** Object:  Default [DF_LEG_Documentacion_Legajo_Doc]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Documentacion_Legajo_Doc]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Documentacion_Legajo_Doc]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo] ADD  CONSTRAINT [DF_LEG_Documentacion_Legajo_Doc]  DEFAULT (0) FOR [FotocDNI]
END


End
GO
/****** Object:  Default [DF_LEG_Documentacion_Legajo_Titulo]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Documentacion_Legajo_Titulo]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Documentacion_Legajo_Titulo]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo] ADD  CONSTRAINT [DF_LEG_Documentacion_Legajo_Titulo]  DEFAULT (0) FOR [Titulo]
END


End
GO
/****** Object:  Default [DF_LEG_Documentacion_Legajo_Serv]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Documentacion_Legajo_Serv]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Documentacion_Legajo_Serv]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo] ADD  CONSTRAINT [DF_LEG_Documentacion_Legajo_Serv]  DEFAULT (0) FOR [CertifServAnt]
END


End
GO
/****** Object:  Default [DF_LEG_Documentacion_Legajo_Matrimonio]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Documentacion_Legajo_Matrimonio]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Documentacion_Legajo_Matrimonio]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo] ADD  CONSTRAINT [DF_LEG_Documentacion_Legajo_Matrimonio]  DEFAULT (0) FOR [AcreditEstadoCivil]
END


End
GO
/****** Object:  Default [DF_LEG_Documentacion_Legajo_OpcionJ]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Documentacion_Legajo_OpcionJ]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Documentacion_Legajo_OpcionJ]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo] ADD  CONSTRAINT [DF_LEG_Documentacion_Legajo_OpcionJ]  DEFAULT (0) FOR [OpcionJ]
END


End
GO
/****** Object:  Default [DF_LEG_Documentacion_Legajo_Resolucion]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Documentacion_Legajo_Resolucion]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Documentacion_Legajo_Resolucion]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo] ADD  CONSTRAINT [DF_LEG_Documentacion_Legajo_Resolucion]  DEFAULT (0) FOR [InfoSumaria]
END


End
GO
/****** Object:  Default [DF__LEG_Docum__DDJJC__24BE25E8]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__LEG_Docum__DDJJC__24BE25E8]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__LEG_Docum__DDJJC__24BE25E8]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo] ADD  CONSTRAINT [DF__LEG_Docum__DDJJC__24BE25E8]  DEFAULT (0) FOR [DDJJCtr1]
END


End
GO
/****** Object:  Default [DF__LEG_Docum__DDJJC__25B24A21]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__LEG_Docum__DDJJC__25B24A21]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__LEG_Docum__DDJJC__25B24A21]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo] ADD  CONSTRAINT [DF__LEG_Docum__DDJJC__25B24A21]  DEFAULT (0) FOR [DDJJCtr2]
END


End
GO
/****** Object:  Default [DF__LEG_Docum__DDJJC__26A66E5A]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__LEG_Docum__DDJJC__26A66E5A]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__LEG_Docum__DDJJC__26A66E5A]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo] ADD  CONSTRAINT [DF__LEG_Docum__DDJJC__26A66E5A]  DEFAULT (0) FOR [DDJJCtr3]
END


End
GO
/****** Object:  Default [DF__LEG_Docume__Foto__7B87062B]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__LEG_Docume__Foto__7B87062B]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo_Intimacion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__LEG_Docume__Foto__7B87062B]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo_Intimacion] ADD  CONSTRAINT [DF__LEG_Docume__Foto__7B87062B]  DEFAULT (0) FOR [Foto]
END


End
GO
/****** Object:  Default [DF__LEG_Docum__Prese__7C7B2A64]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__LEG_Docum__Prese__7C7B2A64]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo_Intimacion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__LEG_Docum__Prese__7C7B2A64]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo_Intimacion] ADD  CONSTRAINT [DF__LEG_Docum__Prese__7C7B2A64]  DEFAULT (0) FOR [PresentoAptoMedico]
END


End
GO
/****** Object:  Default [DF__LEG_Docum__Decre__7D6F4E9D]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__LEG_Docum__Decre__7D6F4E9D]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo_Intimacion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__LEG_Docum__Decre__7D6F4E9D]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo_Intimacion] ADD  CONSTRAINT [DF__LEG_Docum__Decre__7D6F4E9D]  DEFAULT (0) FOR [Decreto_894]
END


End
GO
/****** Object:  Default [DF__LEG_Docum__Fotoc__7E6372D6]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__LEG_Docum__Fotoc__7E6372D6]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo_Intimacion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__LEG_Docum__Fotoc__7E6372D6]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo_Intimacion] ADD  CONSTRAINT [DF__LEG_Docum__Fotoc__7E6372D6]  DEFAULT (0) FOR [FotocDNI]
END


End
GO
/****** Object:  Default [DF__LEG_Docum__Titul__7F57970F]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__LEG_Docum__Titul__7F57970F]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo_Intimacion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__LEG_Docum__Titul__7F57970F]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo_Intimacion] ADD  CONSTRAINT [DF__LEG_Docum__Titul__7F57970F]  DEFAULT (0) FOR [Titulo]
END


End
GO
/****** Object:  Default [DF__LEG_Docum__Certi__004BBB48]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__LEG_Docum__Certi__004BBB48]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo_Intimacion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__LEG_Docum__Certi__004BBB48]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo_Intimacion] ADD  CONSTRAINT [DF__LEG_Docum__Certi__004BBB48]  DEFAULT (0) FOR [CertifServAnt]
END


End
GO
/****** Object:  Default [DF__LEG_Docum__Acred__013FDF81]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__LEG_Docum__Acred__013FDF81]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo_Intimacion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__LEG_Docum__Acred__013FDF81]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo_Intimacion] ADD  CONSTRAINT [DF__LEG_Docum__Acred__013FDF81]  DEFAULT (0) FOR [AcreditEstadoCivil]
END


End
GO
/****** Object:  Default [DF__LEG_Docum__Opcio__023403BA]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__LEG_Docum__Opcio__023403BA]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo_Intimacion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__LEG_Docum__Opcio__023403BA]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo_Intimacion] ADD  CONSTRAINT [DF__LEG_Docum__Opcio__023403BA]  DEFAULT (0) FOR [OpcionJ]
END


End
GO
/****** Object:  Default [DF__LEG_Docum__InfoS__032827F3]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__LEG_Docum__InfoS__032827F3]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo_Intimacion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__LEG_Docum__InfoS__032827F3]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo_Intimacion] ADD  CONSTRAINT [DF__LEG_Docum__InfoS__032827F3]  DEFAULT (0) FOR [InfoSumaria]
END


End
GO
/****** Object:  Default [DF__LEG_Docum__DDJJC__041C4C2C]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__LEG_Docum__DDJJC__041C4C2C]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo_Intimacion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__LEG_Docum__DDJJC__041C4C2C]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo_Intimacion] ADD  CONSTRAINT [DF__LEG_Docum__DDJJC__041C4C2C]  DEFAULT (0) FOR [DDJJCtr1]
END


End
GO
/****** Object:  Default [DF__LEG_Docum__DDJJC__05107065]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__LEG_Docum__DDJJC__05107065]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo_Intimacion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__LEG_Docum__DDJJC__05107065]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo_Intimacion] ADD  CONSTRAINT [DF__LEG_Docum__DDJJC__05107065]  DEFAULT (0) FOR [DDJJCtr2]
END


End
GO
/****** Object:  Default [DF__LEG_Docum__DDJJC__0604949E]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__LEG_Docum__DDJJC__0604949E]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo_Intimacion]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__LEG_Docum__DDJJC__0604949E]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Documentacion_Legajo_Intimacion] ADD  CONSTRAINT [DF__LEG_Docum__DDJJC__0604949E]  DEFAULT (0) FOR [DDJJCtr3]
END


End
GO
/****** Object:  Default [DF_LEG_Estudios_Especialidades_DatoDeBaja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Estudios_Especialidades_DatoDeBaja]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Especialidades]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Estudios_Especialidades_DatoDeBaja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Estudios_Especialidades] ADD  CONSTRAINT [DF_LEG_Estudios_Especialidades_DatoDeBaja]  DEFAULT (0) FOR [DatoDeBaja]
END


End
GO
/****** Object:  Default [DF_LEG_Estudios_Especialidades_DatoNoImprime]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Estudios_Especialidades_DatoNoImprime]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Especialidades]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Estudios_Especialidades_DatoNoImprime]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Estudios_Especialidades] ADD  CONSTRAINT [DF_LEG_Estudios_Especialidades_DatoNoImprime]  DEFAULT (0) FOR [DatoNoImprime]
END


End
GO
/****** Object:  Default [DF_LEG_Estudios_Otros_Finalizado]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Estudios_Otros_Finalizado]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Otros]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Estudios_Otros_Finalizado]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Estudios_Otros] ADD  CONSTRAINT [DF_LEG_Estudios_Otros_Finalizado]  DEFAULT (0) FOR [Incompleto]
END


End
GO
/****** Object:  Default [DF_LEG_Estudios_Otros_DatoDeBaja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Estudios_Otros_DatoDeBaja]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Otros]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Estudios_Otros_DatoDeBaja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Estudios_Otros] ADD  CONSTRAINT [DF_LEG_Estudios_Otros_DatoDeBaja]  DEFAULT (0) FOR [DatoDeBaja]
END


End
GO
/****** Object:  Default [DF_LEG_Estudios_Otros_DatoNoImprime]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Estudios_Otros_DatoNoImprime]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Otros]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Estudios_Otros_DatoNoImprime]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Estudios_Otros] ADD  CONSTRAINT [DF_LEG_Estudios_Otros_DatoNoImprime]  DEFAULT (0) FOR [DatoNoImprime]
END


End
GO
/****** Object:  Default [DF__LEG_Estud__Compl__75EE2866]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__LEG_Estud__Compl__75EE2866]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Realizados]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__LEG_Estud__Compl__75EE2866]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Estudios_Realizados] ADD  CONSTRAINT [DF__LEG_Estud__Compl__75EE2866]  DEFAULT (0) FOR [Completo]
END


End
GO
/****** Object:  Default [DF_LEG_Estudios_Realizados_DatoDeBaja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Estudios_Realizados_DatoDeBaja]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Realizados]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Estudios_Realizados_DatoDeBaja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Estudios_Realizados] ADD  CONSTRAINT [DF_LEG_Estudios_Realizados_DatoDeBaja]  DEFAULT (0) FOR [DatoDeBaja]
END


End
GO
/****** Object:  Default [DF_LEG_Estudios_Realizados_DatoNoImprime]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Estudios_Realizados_DatoNoImprime]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Realizados]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Estudios_Realizados_DatoNoImprime]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Estudios_Realizados] ADD  CONSTRAINT [DF_LEG_Estudios_Realizados_DatoNoImprime]  DEFAULT (0) FOR [DatoNoImprime]
END


End
GO
/****** Object:  Default [DF_LEG_Estudios_Realizados_SinCertificado]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_LEG_Estudios_Realizados_SinCertificado]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Realizados]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_LEG_Estudios_Realizados_SinCertificado]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_Estudios_Realizados] ADD  CONSTRAINT [DF_LEG_Estudios_Realizados_SinCertificado]  DEFAULT (0) FOR [SinCertificado]
END


End
GO
/****** Object:  Default [DF__LEG_ObraS__Habil__75F9155E]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__LEG_ObraS__Habil__75F9155E]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_ObraSocial]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__LEG_ObraS__Habil__75F9155E]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_ObraSocial] ADD  CONSTRAINT [DF__LEG_ObraS__Habil__75F9155E]  DEFAULT (0) FOR [Habilitada_ReciboHaberes]
END


End
GO
/****** Object:  Default [DF__LEG_ObraS__bBaja__76ED3997]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__LEG_ObraS__bBaja__76ED3997]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_ObraSocial]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__LEG_ObraS__bBaja__76ED3997]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LEG_ObraSocial] ADD  CONSTRAINT [DF__LEG_ObraS__bBaja__76ED3997]  DEFAULT (0) FOR [bBaja]
END


End
GO
/****** Object:  Default [DF_localidadesafip22_baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_localidadesafip22_baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[LocalidadesAFIP]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_localidadesafip22_baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[LocalidadesAFIP] ADD  CONSTRAINT [DF_localidadesafip22_baja]  DEFAULT (0) FOR [baja]
END


End
GO
/****** Object:  Default [DF__MED_Apto_M__Baja__306FCFB6]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__MED_Apto_M__Baja__306FCFB6]') AND parent_object_id = OBJECT_ID(N'[dbo].[MED_Apto_Medico]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__MED_Apto_M__Baja__306FCFB6]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[MED_Apto_Medico] ADD  CONSTRAINT [DF__MED_Apto_M__Baja__306FCFB6]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__MED_Atenci__Baja__39F939F0]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__MED_Atenci__Baja__39F939F0]') AND parent_object_id = OBJECT_ID(N'[dbo].[MED_Atenciones]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__MED_Atenci__Baja__39F939F0]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[MED_Atenciones] ADD  CONSTRAINT [DF__MED_Atenci__Baja__39F939F0]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__MED_Atenc__Consu__3AED5E29]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__MED_Atenc__Consu__3AED5E29]') AND parent_object_id = OBJECT_ID(N'[dbo].[MED_Atenciones]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__MED_Atenc__Consu__3AED5E29]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[MED_Atenciones] ADD  CONSTRAINT [DF__MED_Atenc__Consu__3AED5E29]  DEFAULT (0) FOR [ConsultorioExterno]
END


End
GO
/****** Object:  Default [DF__MED_Atenci__Baja__3CD5A69B]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__MED_Atenci__Baja__3CD5A69B]') AND parent_object_id = OBJECT_ID(N'[dbo].[MED_Atenciones_Practicas]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__MED_Atenci__Baja__3CD5A69B]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[MED_Atenciones_Practicas] ADD  CONSTRAINT [DF__MED_Atenci__Baja__3CD5A69B]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__MED_Embara__Baja__3810F17E]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__MED_Embara__Baja__3810F17E]') AND parent_object_id = OBJECT_ID(N'[dbo].[MED_Embarazadas]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__MED_Embara__Baja__3810F17E]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[MED_Embarazadas] ADD  CONSTRAINT [DF__MED_Embara__Baja__3810F17E]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__mns_asign__VerTo__43ECB87E]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__mns_asign__VerTo__43ECB87E]') AND parent_object_id = OBJECT_ID(N'[dbo].[MNS_Asignables]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__mns_asign__VerTo__43ECB87E]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[MNS_Asignables] ADD  CONSTRAINT [DF__mns_asign__VerTo__43ECB87E]  DEFAULT (0) FOR [VerTodos]
END


End
GO
/****** Object:  Default [DF__PLA_Certi__Certi__36DCD623]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__PLA_Certi__Certi__36DCD623]') AND parent_object_id = OBJECT_ID(N'[dbo].[PLA_Certificantes_DDJJ]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__PLA_Certi__Certi__36DCD623]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[PLA_Certificantes_DDJJ] ADD  CONSTRAINT [DF__PLA_Certi__Certi__36DCD623]  DEFAULT (0) FOR [Certificante]
END


End
GO
/****** Object:  Default [DF__PLA_Certi__NoCer__37D0FA5C]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__PLA_Certi__NoCer__37D0FA5C]') AND parent_object_id = OBJECT_ID(N'[dbo].[PLA_Certificantes_DDJJ]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__PLA_Certi__NoCer__37D0FA5C]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[PLA_Certificantes_DDJJ] ADD  CONSTRAINT [DF__PLA_Certi__NoCer__37D0FA5C]  DEFAULT (0) FOR [NoCertificar]
END


End
GO
/****** Object:  Default [DF__PLA_Pases__Estad__1471E42F]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__PLA_Pases__Estad__1471E42F]') AND parent_object_id = OBJECT_ID(N'[dbo].[PLA_Pases_Solicitados]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__PLA_Pases__Estad__1471E42F]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[PLA_Pases_Solicitados] ADD  CONSTRAINT [DF__PLA_Pases__Estad__1471E42F]  DEFAULT (0) FOR [Estado]
END


End
GO
/****** Object:  Default [DF__PLA_Pases__Recha__0446695E]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__PLA_Pases__Recha__0446695E]') AND parent_object_id = OBJECT_ID(N'[dbo].[PLA_Pases_Solicitados]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__PLA_Pases__Recha__0446695E]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[PLA_Pases_Solicitados] ADD  CONSTRAINT [DF__PLA_Pases__Recha__0446695E]  DEFAULT (0) FOR [RechazoImpreso]
END


End
GO
/****** Object:  Default [DF__PLA_Recib__SBrut__32B80ADB]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__PLA_Recib__SBrut__32B80ADB]') AND parent_object_id = OBJECT_ID(N'[dbo].[PLA_Recibos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__PLA_Recib__SBrut__32B80ADB]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[PLA_Recibos] ADD  CONSTRAINT [DF__PLA_Recib__SBrut__32B80ADB]  DEFAULT (0) FOR [SBruto]
END


End
GO
/****** Object:  Default [DF__PLA_Recib__SNeto__33AC2F14]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__PLA_Recib__SNeto__33AC2F14]') AND parent_object_id = OBJECT_ID(N'[dbo].[PLA_Recibos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__PLA_Recib__SNeto__33AC2F14]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[PLA_Recibos] ADD  CONSTRAINT [DF__PLA_Recib__SNeto__33AC2F14]  DEFAULT (0) FOR [SNeto]
END


End
GO
/****** Object:  Default [DF__PLA_Recib__SDesc__34A0534D]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__PLA_Recib__SDesc__34A0534D]') AND parent_object_id = OBJECT_ID(N'[dbo].[PLA_Recibos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__PLA_Recib__SDesc__34A0534D]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[PLA_Recibos] ADD  CONSTRAINT [DF__PLA_Recib__SDesc__34A0534D]  DEFAULT (0) FOR [SDescuentos]
END


End
GO
/****** Object:  Default [DF_PLA_Recibos_Impreso]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_PLA_Recibos_Impreso]') AND parent_object_id = OBJECT_ID(N'[dbo].[PLA_Recibos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_PLA_Recibos_Impreso]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[PLA_Recibos] ADD  CONSTRAINT [DF_PLA_Recibos_Impreso]  DEFAULT (0) FOR [Impreso]
END


End
GO
/****** Object:  Default [DF_PLA_Recibos_Entregado]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_PLA_Recibos_Entregado]') AND parent_object_id = OBJECT_ID(N'[dbo].[PLA_Recibos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_PLA_Recibos_Entregado]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[PLA_Recibos] ADD  CONSTRAINT [DF_PLA_Recibos_Entregado]  DEFAULT (0) FOR [Entregado]
END


End
GO
/****** Object:  Default [DF_PLA_Recibos_Recibido]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_PLA_Recibos_Recibido]') AND parent_object_id = OBJECT_ID(N'[dbo].[PLA_Recibos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_PLA_Recibos_Recibido]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[PLA_Recibos] ADD  CONSTRAINT [DF_PLA_Recibos_Recibido]  DEFAULT (0) FOR [Recibido]
END


End
GO
/****** Object:  Default [DF__PLA_Recib__Aport__3965086A]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__PLA_Recib__Aport__3965086A]') AND parent_object_id = OBJECT_ID(N'[dbo].[PLA_Recibos_Detalle]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__PLA_Recib__Aport__3965086A]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[PLA_Recibos_Detalle] ADD  CONSTRAINT [DF__PLA_Recib__Aport__3965086A]  DEFAULT (0) FOR [Aporte]
END


End
GO
/****** Object:  Default [DF_PLA_Recibos_Detalle_Descuento]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_PLA_Recibos_Detalle_Descuento]') AND parent_object_id = OBJECT_ID(N'[dbo].[PLA_Recibos_Detalle]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_PLA_Recibos_Detalle_Descuento]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[PLA_Recibos_Detalle] ADD  CONSTRAINT [DF_PLA_Recibos_Detalle_Descuento]  DEFAULT (0) FOR [Descuento]
END


End
GO
/****** Object:  Default [DF__RH_Usuario__Baja__615232DC]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__RH_Usuario__Baja__615232DC]') AND parent_object_id = OBJECT_ID(N'[dbo].[RH_Usuarios]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__RH_Usuario__Baja__615232DC]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[RH_Usuarios] ADD  CONSTRAINT [DF__RH_Usuario__Baja__615232DC]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__RH_Usuari__Actua__62465715]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__RH_Usuari__Actua__62465715]') AND parent_object_id = OBJECT_ID(N'[dbo].[RH_Usuarios]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__RH_Usuari__Actua__62465715]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[RH_Usuarios] ADD  CONSTRAINT [DF__RH_Usuari__Actua__62465715]  DEFAULT (0) FOR [Actualizar_Passw]
END


End
GO
/****** Object:  Default [DF__RH_Usuari__Admin__633A7B4E]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__RH_Usuari__Admin__633A7B4E]') AND parent_object_id = OBJECT_ID(N'[dbo].[RH_Usuarios]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__RH_Usuari__Admin__633A7B4E]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[RH_Usuarios] ADD  CONSTRAINT [DF__RH_Usuari__Admin__633A7B4E]  DEFAULT (0) FOR [Administrador]
END


End
GO
/****** Object:  Default [DF_RH_Usuarios_Detalles_Leer_TMP]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_RH_Usuarios_Detalles_Leer_TMP]') AND parent_object_id = OBJECT_ID(N'[dbo].[RH_Usuarios_Detalles]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_RH_Usuarios_Detalles_Leer_TMP]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[RH_Usuarios_Detalles] ADD  CONSTRAINT [DF_RH_Usuarios_Detalles_Leer_TMP]  DEFAULT (0) FOR [Leer_TMP]
END


End
GO
/****** Object:  Default [DF_RH_Usuarios_Detalles_BloqueoLegajo]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_RH_Usuarios_Detalles_BloqueoLegajo]') AND parent_object_id = OBJECT_ID(N'[dbo].[RH_Usuarios_Detalles]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_RH_Usuarios_Detalles_BloqueoLegajo]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[RH_Usuarios_Detalles] ADD  CONSTRAINT [DF_RH_Usuarios_Detalles_BloqueoLegajo]  DEFAULT (0) FOR [BloqueoLegajo]
END


End
GO
/****** Object:  Default [DF_RH_Usuarios_Detalles_DesBloqueoLegajo]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_RH_Usuarios_Detalles_DesBloqueoLegajo]') AND parent_object_id = OBJECT_ID(N'[dbo].[RH_Usuarios_Detalles]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_RH_Usuarios_Detalles_DesBloqueoLegajo]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[RH_Usuarios_Detalles] ADD  CONSTRAINT [DF_RH_Usuarios_Detalles_DesBloqueoLegajo]  DEFAULT (0) FOR [DesBloqueoLegajo]
END


End
GO
/****** Object:  Default [DF__RH_Usuari__Acces__64CDBE05]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__RH_Usuari__Acces__64CDBE05]') AND parent_object_id = OBJECT_ID(N'[dbo].[RH_Usuarios_Detalles]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__RH_Usuari__Acces__64CDBE05]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[RH_Usuarios_Detalles] ADD  CONSTRAINT [DF__RH_Usuari__Acces__64CDBE05]  DEFAULT (0) FOR [Acceso_Web]
END


End
GO
/****** Object:  Default [DF_Setup_Actualizar]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Setup_Actualizar]') AND parent_object_id = OBJECT_ID(N'[dbo].[Setup]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Setup_Actualizar]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Setup] ADD  CONSTRAINT [DF_Setup_Actualizar]  DEFAULT (0) FOR [Actualizar]
END


End
GO
/****** Object:  Default [DF_Tabla_Agrupamiento_baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Agrupamiento_baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Agrupamiento]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Agrupamiento_baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Agrupamiento] ADD  CONSTRAINT [DF_Tabla_Agrupamiento_baja]  DEFAULT (0) FOR [baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Areas_Presenta_DDJJ]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Areas_Presenta_DDJJ]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Areas]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Areas_Presenta_DDJJ]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Areas] ADD  CONSTRAINT [DF_Tabla_Areas_Presenta_DDJJ]  DEFAULT (0) FOR [Presenta_DDJJ]
END


End
GO
/****** Object:  Default [DF_Tabla_Areas_Usuario]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Areas_Usuario]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Areas]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Areas_Usuario]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Areas] ADD  CONSTRAINT [DF_Tabla_Areas_Usuario]  DEFAULT (1) FOR [Usuario]
END


End
GO
/****** Object:  Default [DF_Estructura_codigo]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Estructura_codigo]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Areas_Estructura]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Estructura_codigo]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Areas_Estructura] ADD  CONSTRAINT [DF_Estructura_codigo]  DEFAULT (0) FOR [codigo]
END


End
GO
/****** Object:  Default [DF_Tabla_Areas_Estructura_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Areas_Estructura_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Areas_Estructura]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Areas_Estructura_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Areas_Estructura] ADD  CONSTRAINT [DF_Tabla_Areas_Estructura_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Bajas_Personas_baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Bajas_Personas_baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Bajas_Personas]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Bajas_Personas_baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Bajas_Personas] ADD  CONSTRAINT [DF_Tabla_Bajas_Personas_baja]  DEFAULT (0) FOR [baja]
END


End
GO
/****** Object:  Default [DF_tabla_Cargos_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_tabla_Cargos_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Cargos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_tabla_Cargos_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Cargos] ADD  CONSTRAINT [DF_tabla_Cargos_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__Tabla_Cert__Baja__296DCC6C]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Tabla_Cert__Baja__296DCC6C]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Certificados_Antiguedad]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Tabla_Cert__Baja__296DCC6C]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Certificados_Antiguedad] ADD  CONSTRAINT [DF__Tabla_Cert__Baja__296DCC6C]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Conceptos_Acumulativa]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Conceptos_Acumulativa]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Conceptos_Licencias]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Conceptos_Acumulativa]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Conceptos_Licencias] ADD  CONSTRAINT [DF_Tabla_Conceptos_Acumulativa]  DEFAULT (0) FOR [Acumulativa]
END


End
GO
/****** Object:  Default [DF_Tabla_Conceptos_Licencias_Regresa_Medica]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Conceptos_Licencias_Regresa_Medica]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Conceptos_Licencias]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Conceptos_Licencias_Regresa_Medica]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Conceptos_Licencias] ADD  CONSTRAINT [DF_Tabla_Conceptos_Licencias_Regresa_Medica]  DEFAULT (0) FOR [Regresa_Medica]
END


End
GO
/****** Object:  Default [DF_Tabla_Conceptos_Licencias_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Conceptos_Licencias_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Conceptos_Licencias]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Conceptos_Licencias_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Conceptos_Licencias] ADD  CONSTRAINT [DF_Tabla_Conceptos_Licencias_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Conceptos_Licencias_DiasMensuales]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Conceptos_Licencias_DiasMensuales]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Conceptos_Licencias]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Conceptos_Licencias_DiasMensuales]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Conceptos_Licencias] ADD  CONSTRAINT [DF_Tabla_Conceptos_Licencias_DiasMensuales]  DEFAULT (0) FOR [DiasMensuales]
END


End
GO
/****** Object:  Default [DF_Tabla_Conceptos_Licencias_DiasConsecutivos]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Conceptos_Licencias_DiasConsecutivos]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Conceptos_Licencias]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Conceptos_Licencias_DiasConsecutivos]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Conceptos_Licencias] ADD  CONSTRAINT [DF_Tabla_Conceptos_Licencias_DiasConsecutivos]  DEFAULT (0) FOR [DiasConsecutivos]
END


End
GO
/****** Object:  Default [DF_Tabla_Conceptos_Recibos_Aportes]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Conceptos_Recibos_Aportes]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Conceptos_Recibos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Conceptos_Recibos_Aportes]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Conceptos_Recibos] ADD  CONSTRAINT [DF_Tabla_Conceptos_Recibos_Aportes]  DEFAULT (0) FOR [Aportes]
END


End
GO
/****** Object:  Default [DF_Tabla_Conceptos_Recibos_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Conceptos_Recibos_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Conceptos_Recibos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Conceptos_Recibos_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Conceptos_Recibos] ADD  CONSTRAINT [DF_Tabla_Conceptos_Recibos_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_DistritosMilitares_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_DistritosMilitares_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_DistritosMilitares]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_DistritosMilitares_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_DistritosMilitares] ADD  CONSTRAINT [DF_Tabla_DistritosMilitares_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Doc_Presentados_Posicion]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Doc_Presentados_Posicion]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Doc_Presentados]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Doc_Presentados_Posicion]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Doc_Presentados] ADD  CONSTRAINT [DF_Tabla_Doc_Presentados_Posicion]  DEFAULT (0) FOR [Posicion]
END


End
GO
/****** Object:  Default [DF_Tabla_Doc_Presentados_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Doc_Presentados_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Doc_Presentados]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Doc_Presentados_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Doc_Presentados] ADD  CONSTRAINT [DF_Tabla_Doc_Presentados_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_DocIdentidad_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_DocIdentidad_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_DocIdentidad]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_DocIdentidad_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_DocIdentidad] ADD  CONSTRAINT [DF_Tabla_DocIdentidad_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Estado_Civil_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Estado_Civil_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estado_Civil]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Estado_Civil_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Estado_Civil] ADD  CONSTRAINT [DF_Tabla_Estado_Civil_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__Tabla_Estu__Baja__3667D4D7]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Tabla_Estu__Baja__3667D4D7]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Areas]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Tabla_Estu__Baja__3667D4D7]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Estudios_Areas] ADD  CONSTRAINT [DF__Tabla_Estu__Baja__3667D4D7]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__Tabla_Estu__Baja__3A3865BB]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Tabla_Estu__Baja__3A3865BB]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Especialidades]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Tabla_Estu__Baja__3A3865BB]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Estudios_Especialidades] ADD  CONSTRAINT [DF__Tabla_Estu__Baja__3A3865BB]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__Tabla_Estu__Baja__42CDABBC]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Tabla_Estu__Baja__42CDABBC]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Facultades]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Tabla_Estu__Baja__42CDABBC]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Estudios_Facultades] ADD  CONSTRAINT [DF__Tabla_Estu__Baja__42CDABBC]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__Tabla_Estu__Baja__469E3CA0]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Tabla_Estu__Baja__469E3CA0]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Instituciones]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Tabla_Estu__Baja__469E3CA0]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Estudios_Instituciones] ADD  CONSTRAINT [DF__Tabla_Estu__Baja__469E3CA0]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__Tabla_Estu__Baja__5FB4CE84]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Tabla_Estu__Baja__5FB4CE84]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Tipo_Maquina]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Tabla_Estu__Baja__5FB4CE84]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Estudios_Tipo_Maquina] ADD  CONSTRAINT [DF__Tabla_Estu__Baja__5FB4CE84]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__Tabla_Estu__Baja__38501D49]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Tabla_Estu__Baja__38501D49]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Titulos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Tabla_Estu__Baja__38501D49]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Estudios_Titulos] ADD  CONSTRAINT [DF__Tabla_Estu__Baja__38501D49]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__Tabla_Estu__Baja__44B5F42E]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Tabla_Estu__Baja__44B5F42E]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Uni_Facultad]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Tabla_Estu__Baja__44B5F42E]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Estudios_Uni_Facultad] ADD  CONSTRAINT [DF__Tabla_Estu__Baja__44B5F42E]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__Tabla_Estu__Baja__40E5634A]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Tabla_Estu__Baja__40E5634A]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Universidades]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Tabla_Estu__Baja__40E5634A]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Estudios_Universidades] ADD  CONSTRAINT [DF__Tabla_Estu__Baja__40E5634A]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Firmantes_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Firmantes_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Firmantes]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Firmantes_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Firmantes] ADD  CONSTRAINT [DF_Tabla_Firmantes_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__tabla_Firma__Ctr__42EDA74D]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__tabla_Firma__Ctr__42EDA74D]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Firmantes]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__tabla_Firma__Ctr__42EDA74D]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Firmantes] ADD  CONSTRAINT [DF__tabla_Firma__Ctr__42EDA74D]  DEFAULT (0) FOR [Ctr]
END


End
GO
/****** Object:  Default [DF__tabla_Firm__FacT__43E1CB86]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__tabla_Firm__FacT__43E1CB86]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Firmantes]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__tabla_Firm__FacT__43E1CB86]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Firmantes] ADD  CONSTRAINT [DF__tabla_Firm__FacT__43E1CB86]  DEFAULT (0) FOR [FacT]
END


End
GO
/****** Object:  Default [DF__tabla_Firm__AAdm__44D5EFBF]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__tabla_Firm__AAdm__44D5EFBF]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Firmantes]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__tabla_Firm__AAdm__44D5EFBF]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Firmantes] ADD  CONSTRAINT [DF__tabla_Firm__AAdm__44D5EFBF]  DEFAULT (0) FOR [AAdm]
END


End
GO
/****** Object:  Default [DF_Tabla_Funciones_importe]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Funciones_importe]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Funciones]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Funciones_importe]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Funciones] ADD  CONSTRAINT [DF_Tabla_Funciones_importe]  DEFAULT (0) FOR [importe]
END


End
GO
/****** Object:  Default [DF_Tabla_Funciones_baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Funciones_baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Funciones]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Funciones_baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Funciones] ADD  CONSTRAINT [DF_Tabla_Funciones_baja]  DEFAULT (0) FOR [baja]
END


End
GO
/****** Object:  Default [DF__Tabla_Func__Baja__58C7D9D3]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Tabla_Func__Baja__58C7D9D3]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Funciones_Cargos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Tabla_Func__Baja__58C7D9D3]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Funciones_Cargos] ADD  CONSTRAINT [DF__Tabla_Func__Baja__58C7D9D3]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__tabla_fun__Certi__26915FC1]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__tabla_fun__Certi__26915FC1]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Funciones_Cargos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__tabla_fun__Certi__26915FC1]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Funciones_Cargos] ADD  CONSTRAINT [DF__tabla_fun__Certi__26915FC1]  DEFAULT (0) FOR [CertificadoAntiguedad]
END


End
GO
/****** Object:  Default [DF_Tabla_Funciones_Contratos_baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Funciones_Contratos_baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Funciones_Contratos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Funciones_Contratos_baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Funciones_Contratos] ADD  CONSTRAINT [DF_Tabla_Funciones_Contratos_baja]  DEFAULT (0) FOR [baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Grados_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Grados_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Grados]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Grados_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Grados] ADD  CONSTRAINT [DF_Tabla_Grados_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Idiomas_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Idiomas_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Idiomas]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Idiomas_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Idiomas] ADD  CONSTRAINT [DF_Tabla_Idiomas_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Incremento_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Incremento_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Incremento]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Incremento_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Incremento] ADD  CONSTRAINT [DF_Tabla_Incremento_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__Tabla_Medi__Baja__4C4CF455]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Tabla_Medi__Baja__4C4CF455]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Medicos_Analisis]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Tabla_Medi__Baja__4C4CF455]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Medicos_Analisis] ADD  CONSTRAINT [DF__Tabla_Medi__Baja__4C4CF455]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__Tabla_Med__Oblig__1F4543B4]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Tabla_Med__Oblig__1F4543B4]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Medicos_Analisis]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Tabla_Med__Oblig__1F4543B4]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Medicos_Analisis] ADD  CONSTRAINT [DF__Tabla_Med__Oblig__1F4543B4]  DEFAULT (0) FOR [Obligatorio]
END


End
GO
/****** Object:  Default [DF__Tabla_Medi__Baja__5205CDAB]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Tabla_Medi__Baja__5205CDAB]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Medicos_Aptos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Tabla_Medi__Baja__5205CDAB]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Medicos_Aptos] ADD  CONSTRAINT [DF__Tabla_Medi__Baja__5205CDAB]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__Tabla_Med__DiasV__24FE1D0A]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Tabla_Med__DiasV__24FE1D0A]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Medicos_Aptos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Tabla_Med__DiasV__24FE1D0A]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Medicos_Aptos] ADD  CONSTRAINT [DF__Tabla_Med__DiasV__24FE1D0A]  DEFAULT (0) FOR [DiasValido]
END


End
GO
/****** Object:  Default [DF__Tabla_Medi__Baja__501D8539]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Tabla_Medi__Baja__501D8539]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Medicos_Diagnosticos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Tabla_Medi__Baja__501D8539]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Medicos_Diagnosticos] ADD  CONSTRAINT [DF__Tabla_Medi__Baja__501D8539]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__Tabla_Medi__Baja__4A64ABE3]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Tabla_Medi__Baja__4A64ABE3]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Medicos_Discapacidad]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Tabla_Medi__Baja__4A64ABE3]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Medicos_Discapacidad] ADD  CONSTRAINT [DF__Tabla_Medi__Baja__4A64ABE3]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__Tabla_Medi__Baja__4E353CC7]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Tabla_Medi__Baja__4E353CC7]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Medicos_Enfermedades_PreExistentes]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Tabla_Medi__Baja__4E353CC7]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Medicos_Enfermedades_PreExistentes] ADD  CONSTRAINT [DF__Tabla_Medi__Baja__4E353CC7]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__Tabla_Medi__Baja__487C6371]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Tabla_Medi__Baja__487C6371]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Medicos_Practicas]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Tabla_Medi__Baja__487C6371]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Medicos_Practicas] ADD  CONSTRAINT [DF__Tabla_Medi__Baja__487C6371]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Motivos_Baja_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Motivos_Baja_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Motivos_Baja]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Motivos_Baja_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Motivos_Baja] ADD  CONSTRAINT [DF_Tabla_Motivos_Baja_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Motivos_Causas_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Motivos_Causas_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Motivos_Causas]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Motivos_Causas_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Motivos_Causas] ADD  CONSTRAINT [DF_Tabla_Motivos_Causas_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF__Tabla_Moti__Baja__695D68F8]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF__Tabla_Moti__Baja__695D68F8]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Motivos_Reservas]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__Tabla_Moti__Baja__695D68F8]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Motivos_Reservas] ADD  CONSTRAINT [DF__Tabla_Moti__Baja__695D68F8]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Nacionalidad_Naturaliza]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Nacionalidad_Naturaliza]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Nacionalidad]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Nacionalidad_Naturaliza]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Nacionalidad] ADD  CONSTRAINT [DF_Tabla_Nacionalidad_Naturaliza]  DEFAULT (0) FOR [Naturaliza]
END


End
GO
/****** Object:  Default [DF_Tabla_Nacionalidad_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Nacionalidad_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Nacionalidad]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Nacionalidad_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Nacionalidad] ADD  CONSTRAINT [DF_Tabla_Nacionalidad_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Nivel_Estudios_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Nivel_Estudios_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Nivel_Estudios]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Nivel_Estudios_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Nivel_Estudios] ADD  CONSTRAINT [DF_Tabla_Nivel_Estudios_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Nivel_Idioma_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Nivel_Idioma_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Nivel_Idioma]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Nivel_Idioma_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Nivel_Idioma] ADD  CONSTRAINT [DF_Tabla_Nivel_Idioma_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Niveles_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Niveles_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Niveles]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Niveles_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Niveles] ADD  CONSTRAINT [DF_Tabla_Niveles_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Nomina_Bancos_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Nomina_Bancos_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Nomina_Bancos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Nomina_Bancos_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Nomina_Bancos] ADD  CONSTRAINT [DF_Tabla_Nomina_Bancos_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_ObraSocial_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_ObraSocial_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_ObraSocial]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_ObraSocial_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_ObraSocial] ADD  CONSTRAINT [DF_Tabla_ObraSocial_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Oficinas_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Oficinas_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Oficinas]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Oficinas_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Oficinas] ADD  CONSTRAINT [DF_Tabla_Oficinas_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Parentesco_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Parentesco_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Parentesco]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Parentesco_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Parentesco] ADD  CONSTRAINT [DF_Tabla_Parentesco_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Rangos_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Rangos_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Rangos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Rangos_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Rangos] ADD  CONSTRAINT [DF_Tabla_Rangos_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Regimen_Escalafonario_baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Regimen_Escalafonario_baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Regimen_Escalafonario]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Regimen_Escalafonario_baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Regimen_Escalafonario] ADD  CONSTRAINT [DF_Tabla_Regimen_Escalafonario_baja]  DEFAULT (0) FOR [baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Regimen_Jubilatorio_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Regimen_Jubilatorio_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Regimen_Jubilatorio]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Regimen_Jubilatorio_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Regimen_Jubilatorio] ADD  CONSTRAINT [DF_Tabla_Regimen_Jubilatorio_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Resoluciones_Contratos_Monto_Desde]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Resoluciones_Contratos_Monto_Desde]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Resoluciones_Contratos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Resoluciones_Contratos_Monto_Desde]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Resoluciones_Contratos] ADD  CONSTRAINT [DF_Tabla_Resoluciones_Contratos_Monto_Desde]  DEFAULT (0) FOR [Monto_Desde]
END


End
GO
/****** Object:  Default [DF_Tabla_Resoluciones_Contratos_Monto_Hasta0]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Resoluciones_Contratos_Monto_Hasta0]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Resoluciones_Contratos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Resoluciones_Contratos_Monto_Hasta0]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Resoluciones_Contratos] ADD  CONSTRAINT [DF_Tabla_Resoluciones_Contratos_Monto_Hasta0]  DEFAULT (0) FOR [Monto_Hasta]
END


End
GO
/****** Object:  Default [DF_Tabla_Resoluciones_Contratos_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Resoluciones_Contratos_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Resoluciones_Contratos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Resoluciones_Contratos_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Resoluciones_Contratos] ADD  CONSTRAINT [DF_Tabla_Resoluciones_Contratos_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Sinapa_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Sinapa_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Sinapa]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Sinapa_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Sinapa] ADD  CONSTRAINT [DF_Tabla_Sinapa_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Funciones_DDJJ_baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Funciones_DDJJ_baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Tarea_Desempeñada]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Funciones_DDJJ_baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Tarea_Desempeñada] ADD  CONSTRAINT [DF_Tabla_Funciones_DDJJ_baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Tipo_Expedientes_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Tipo_Expedientes_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Tipo_Expedientes]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Tipo_Expedientes_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Tipo_Expedientes] ADD  CONSTRAINT [DF_Tabla_Tipo_Expedientes_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Tipos_Contratos_SendLegajos]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Tipos_Contratos_SendLegajos]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Tipos_Contratos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Tipos_Contratos_SendLegajos]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Tipos_Contratos] ADD  CONSTRAINT [DF_Tabla_Tipos_Contratos_SendLegajos]  DEFAULT (0) FOR [SendLegajos]
END


End
GO
/****** Object:  Default [DF_Tabla_Tipo_Designaciones_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Tipo_Designaciones_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Tipos_Designaciones]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Tipo_Designaciones_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Tipos_Designaciones] ADD  CONSTRAINT [DF_Tabla_Tipo_Designaciones_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Tipos_Designaciones_Ingreso]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Tipos_Designaciones_Ingreso]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Tipos_Designaciones]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Tipos_Designaciones_Ingreso]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Tipos_Designaciones] ADD  CONSTRAINT [DF_Tabla_Tipos_Designaciones_Ingreso]  DEFAULT (0) FOR [EsIngreso]
END


End
GO
/****** Object:  Default [DF_Tabla_Tipos_Resoluciones_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Tipos_Resoluciones_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Tipos_Resoluciones]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Tipos_Resoluciones_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Tipos_Resoluciones] ADD  CONSTRAINT [DF_Tabla_Tipos_Resoluciones_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Tratamientos_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Tratamientos_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Tratamientos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Tratamientos_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Tratamientos] ADD  CONSTRAINT [DF_Tabla_Tratamientos_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_Tratamientos_Titulos_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_Tratamientos_Titulos_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Tratamientos_Titulos]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_Tratamientos_Titulos_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_Tratamientos_Titulos] ADD  CONSTRAINT [DF_Tabla_Tratamientos_Titulos_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tabla_URetributivas_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tabla_URetributivas_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_URetributivas]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tabla_URetributivas_Baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tabla_URetributivas] ADD  CONSTRAINT [DF_Tabla_URetributivas_Baja]  DEFAULT (0) FOR [Baja]
END


End
GO
/****** Object:  Default [DF_Tipo_de_Planta_baja]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_Tipo_de_Planta_baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tipo_de_Planta]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_Tipo_de_Planta_baja]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[Tipo_de_Planta] ADD  CONSTRAINT [DF_Tipo_de_Planta_baja]  DEFAULT (0) FOR [baja]
END


End
GO
/****** Object:  Default [DF_TMP_CONTRATOS_LEGAJOS_Aprobado]    Script Date: 07/19/2012 19:45:04 ******/
IF Not EXISTS (SELECT * FROM sys.default_constraints WHERE object_id = OBJECT_ID(N'[dbo].[DF_TMP_CONTRATOS_LEGAJOS_Aprobado]') AND parent_object_id = OBJECT_ID(N'[dbo].[TMP_CONTRATOS_LEGAJOS]'))
Begin
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF_TMP_CONTRATOS_LEGAJOS_Aprobado]') AND type = 'D')
BEGIN
ALTER TABLE [dbo].[TMP_CONTRATOS_LEGAJOS] ADD  CONSTRAINT [DF_TMP_CONTRATOS_LEGAJOS_Aprobado]  DEFAULT (0) FOR [Aprobado]
END


End
GO
/****** Object:  ForeignKey [FK_ASIS_Parte_Cabecera_RH_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Parte_Cabecera_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Parte_Cabecera]'))
ALTER TABLE [dbo].[ASIS_Parte_Cabecera]  WITH CHECK ADD  CONSTRAINT [FK_ASIS_Parte_Cabecera_RH_Usuarios] FOREIGN KEY([Id_Usuario])
REFERENCES [dbo].[RH_Usuarios] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Parte_Cabecera_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Parte_Cabecera]'))
ALTER TABLE [dbo].[ASIS_Parte_Cabecera] CHECK CONSTRAINT [FK_ASIS_Parte_Cabecera_RH_Usuarios]
GO
/****** Object:  ForeignKey [FK_ASIS_Parte_Cabecera_Tabla_Areas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Parte_Cabecera_Tabla_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Parte_Cabecera]'))
ALTER TABLE [dbo].[ASIS_Parte_Cabecera]  WITH NOCHECK ADD  CONSTRAINT [FK_ASIS_Parte_Cabecera_Tabla_Areas] FOREIGN KEY([Id_Area])
REFERENCES [dbo].[Tabla_Areas] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Parte_Cabecera_Tabla_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Parte_Cabecera]'))
ALTER TABLE [dbo].[ASIS_Parte_Cabecera] CHECK CONSTRAINT [FK_ASIS_Parte_Cabecera_Tabla_Areas]
GO
/****** Object:  ForeignKey [FK_ASIS_Parte_Plantillas_Fechas_Datos_Personales]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Parte_Plantillas_Fechas_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Parte_Plantillas_Fechas]'))
ALTER TABLE [dbo].[ASIS_Parte_Plantillas_Fechas]  WITH NOCHECK ADD  CONSTRAINT [FK_ASIS_Parte_Plantillas_Fechas_Datos_Personales] FOREIGN KEY([id_interna])
REFERENCES [dbo].[Datos_Personales] ([Id_Interna])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Parte_Plantillas_Fechas_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Parte_Plantillas_Fechas]'))
ALTER TABLE [dbo].[ASIS_Parte_Plantillas_Fechas] CHECK CONSTRAINT [FK_ASIS_Parte_Plantillas_Fechas_Datos_Personales]
GO
/****** Object:  ForeignKey [FK_ASIS_Parte_Plantillas_Fechas_Tabla_Conceptos_Licencias]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Parte_Plantillas_Fechas_Tabla_Conceptos_Licencias]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Parte_Plantillas_Fechas]'))
ALTER TABLE [dbo].[ASIS_Parte_Plantillas_Fechas]  WITH NOCHECK ADD  CONSTRAINT [FK_ASIS_Parte_Plantillas_Fechas_Tabla_Conceptos_Licencias] FOREIGN KEY([concepto])
REFERENCES [dbo].[Tabla_Conceptos_Licencias] ([id_Concepto])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Parte_Plantillas_Fechas_Tabla_Conceptos_Licencias]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Parte_Plantillas_Fechas]'))
ALTER TABLE [dbo].[ASIS_Parte_Plantillas_Fechas] CHECK CONSTRAINT [FK_ASIS_Parte_Plantillas_Fechas_Tabla_Conceptos_Licencias]
GO
/****** Object:  ForeignKey [FK_ASIS_Partes_recibidos_Tabla_Areas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Partes_recibidos_Tabla_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Partes_recibidos]'))
ALTER TABLE [dbo].[ASIS_Partes_recibidos]  WITH CHECK ADD  CONSTRAINT [FK_ASIS_Partes_recibidos_Tabla_Areas] FOREIGN KEY([id_area])
REFERENCES [dbo].[Tabla_Areas] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Partes_recibidos_Tabla_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Partes_recibidos]'))
ALTER TABLE [dbo].[ASIS_Partes_recibidos] CHECK CONSTRAINT [FK_ASIS_Partes_recibidos_Tabla_Areas]
GO
/****** Object:  ForeignKey [FK_ASIS_Solicitudes_Licencia_Web_Datos_Personales]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Solicitudes_Licencia_Web_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web]'))
ALTER TABLE [dbo].[ASIS_Solicitudes_Licencia_Web]  WITH NOCHECK ADD  CONSTRAINT [FK_ASIS_Solicitudes_Licencia_Web_Datos_Personales] FOREIGN KEY([id_interna])
REFERENCES [dbo].[Datos_Personales] ([Id_Interna])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Solicitudes_Licencia_Web_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web]'))
ALTER TABLE [dbo].[ASIS_Solicitudes_Licencia_Web] CHECK CONSTRAINT [FK_ASIS_Solicitudes_Licencia_Web_Datos_Personales]
GO
/****** Object:  ForeignKey [FK_ASIS_Solicitudes_Licencia_Web_RH_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Solicitudes_Licencia_Web_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web]'))
ALTER TABLE [dbo].[ASIS_Solicitudes_Licencia_Web]  WITH NOCHECK ADD  CONSTRAINT [FK_ASIS_Solicitudes_Licencia_Web_RH_Usuarios] FOREIGN KEY([usuario])
REFERENCES [dbo].[RH_Usuarios] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Solicitudes_Licencia_Web_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web]'))
ALTER TABLE [dbo].[ASIS_Solicitudes_Licencia_Web] CHECK CONSTRAINT [FK_ASIS_Solicitudes_Licencia_Web_RH_Usuarios]
GO
/****** Object:  ForeignKey [FK_ASIS_Solicitudes_Licencia_Web_Tabla_Areas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Solicitudes_Licencia_Web_Tabla_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web]'))
ALTER TABLE [dbo].[ASIS_Solicitudes_Licencia_Web]  WITH NOCHECK ADD  CONSTRAINT [FK_ASIS_Solicitudes_Licencia_Web_Tabla_Areas] FOREIGN KEY([id_area])
REFERENCES [dbo].[Tabla_Areas] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Solicitudes_Licencia_Web_Tabla_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web]'))
ALTER TABLE [dbo].[ASIS_Solicitudes_Licencia_Web] CHECK CONSTRAINT [FK_ASIS_Solicitudes_Licencia_Web_Tabla_Areas]
GO
/****** Object:  ForeignKey [FK_ASIS_Solicitudes_Licencia_Web_Tabla_Conceptos_Licencias]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Solicitudes_Licencia_Web_Tabla_Conceptos_Licencias]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web]'))
ALTER TABLE [dbo].[ASIS_Solicitudes_Licencia_Web]  WITH NOCHECK ADD  CONSTRAINT [FK_ASIS_Solicitudes_Licencia_Web_Tabla_Conceptos_Licencias] FOREIGN KEY([concepto])
REFERENCES [dbo].[Tabla_Conceptos_Licencias] ([id_Concepto])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Solicitudes_Licencia_Web_Tabla_Conceptos_Licencias]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web]'))
ALTER TABLE [dbo].[ASIS_Solicitudes_Licencia_Web] CHECK CONSTRAINT [FK_ASIS_Solicitudes_Licencia_Web_Tabla_Conceptos_Licencias]
GO
/****** Object:  ForeignKey [FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_Datos_Personales]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas]'))
ALTER TABLE [dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas]  WITH CHECK ADD  CONSTRAINT [FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_Datos_Personales] FOREIGN KEY([id_interna])
REFERENCES [dbo].[Datos_Personales] ([Id_Interna])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas]'))
ALTER TABLE [dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas] CHECK CONSTRAINT [FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_Datos_Personales]
GO
/****** Object:  ForeignKey [FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_RH_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas]'))
ALTER TABLE [dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas]  WITH CHECK ADD  CONSTRAINT [FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_RH_Usuarios] FOREIGN KEY([usuario])
REFERENCES [dbo].[RH_Usuarios] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas]'))
ALTER TABLE [dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas] CHECK CONSTRAINT [FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_RH_Usuarios]
GO
/****** Object:  ForeignKey [FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_Tabla_Areas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_Tabla_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas]'))
ALTER TABLE [dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas]  WITH CHECK ADD  CONSTRAINT [FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_Tabla_Areas] FOREIGN KEY([id_area])
REFERENCES [dbo].[Tabla_Areas] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_Tabla_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas]'))
ALTER TABLE [dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas] CHECK CONSTRAINT [FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_Tabla_Areas]
GO
/****** Object:  ForeignKey [FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_Tabla_Conceptos_Licencias]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_Tabla_Conceptos_Licencias]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas]'))
ALTER TABLE [dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas]  WITH NOCHECK ADD  CONSTRAINT [FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_Tabla_Conceptos_Licencias] FOREIGN KEY([concepto])
REFERENCES [dbo].[Tabla_Conceptos_Licencias] ([id_Concepto])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_Tabla_Conceptos_Licencias]') AND parent_object_id = OBJECT_ID(N'[dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas]'))
ALTER TABLE [dbo].[ASIS_Solicitudes_Licencia_Web_Rechazadas] CHECK CONSTRAINT [FK_ASIS_Solicitudes_Licencia_Web_Rechazadas_Tabla_Conceptos_Licencias]
GO
/****** Object:  ForeignKey [FK_Autorizaciones_Licencias_Datos_Personales]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Autorizaciones_Licencias_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[Autorizaciones_Licencias]'))
ALTER TABLE [dbo].[Autorizaciones_Licencias]  WITH CHECK ADD  CONSTRAINT [FK_Autorizaciones_Licencias_Datos_Personales] FOREIGN KEY([Id_Interna])
REFERENCES [dbo].[Datos_Personales] ([Id_Interna])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Autorizaciones_Licencias_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[Autorizaciones_Licencias]'))
ALTER TABLE [dbo].[Autorizaciones_Licencias] CHECK CONSTRAINT [FK_Autorizaciones_Licencias_Datos_Personales]
GO
/****** Object:  ForeignKey [FK_Autorizaciones_Licencias_Tabla_Conceptos_Licencias]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Autorizaciones_Licencias_Tabla_Conceptos_Licencias]') AND parent_object_id = OBJECT_ID(N'[dbo].[Autorizaciones_Licencias]'))
ALTER TABLE [dbo].[Autorizaciones_Licencias]  WITH NOCHECK ADD  CONSTRAINT [FK_Autorizaciones_Licencias_Tabla_Conceptos_Licencias] FOREIGN KEY([Id_Concepto_Licencia])
REFERENCES [dbo].[Tabla_Conceptos_Licencias] ([id_Concepto])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Autorizaciones_Licencias_Tabla_Conceptos_Licencias]') AND parent_object_id = OBJECT_ID(N'[dbo].[Autorizaciones_Licencias]'))
ALTER TABLE [dbo].[Autorizaciones_Licencias] CHECK CONSTRAINT [FK_Autorizaciones_Licencias_Tabla_Conceptos_Licencias]
GO
/****** Object:  ForeignKey [FK_Carrera_Administrativa_Tabla_Agrupamiento]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Carrera_Administrativa_Tabla_Agrupamiento]') AND parent_object_id = OBJECT_ID(N'[dbo].[Carrera_Administrativa]'))
ALTER TABLE [dbo].[Carrera_Administrativa]  WITH NOCHECK ADD  CONSTRAINT [FK_Carrera_Administrativa_Tabla_Agrupamiento] FOREIGN KEY([Id_agrupamiento])
REFERENCES [dbo].[Tabla_Agrupamiento] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Carrera_Administrativa_Tabla_Agrupamiento]') AND parent_object_id = OBJECT_ID(N'[dbo].[Carrera_Administrativa]'))
ALTER TABLE [dbo].[Carrera_Administrativa] NOCHECK CONSTRAINT [FK_Carrera_Administrativa_Tabla_Agrupamiento]
GO
/****** Object:  ForeignKey [FK_Carrera_Administrativa_tabla_Cargos]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Carrera_Administrativa_tabla_Cargos]') AND parent_object_id = OBJECT_ID(N'[dbo].[Carrera_Administrativa]'))
ALTER TABLE [dbo].[Carrera_Administrativa]  WITH NOCHECK ADD  CONSTRAINT [FK_Carrera_Administrativa_tabla_Cargos] FOREIGN KEY([Id_Cargos])
REFERENCES [dbo].[Tabla_Cargos] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Carrera_Administrativa_tabla_Cargos]') AND parent_object_id = OBJECT_ID(N'[dbo].[Carrera_Administrativa]'))
ALTER TABLE [dbo].[Carrera_Administrativa] NOCHECK CONSTRAINT [FK_Carrera_Administrativa_tabla_Cargos]
GO
/****** Object:  ForeignKey [FK_Carrera_Administrativa_Tabla_Grados]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Carrera_Administrativa_Tabla_Grados]') AND parent_object_id = OBJECT_ID(N'[dbo].[Carrera_Administrativa]'))
ALTER TABLE [dbo].[Carrera_Administrativa]  WITH NOCHECK ADD  CONSTRAINT [FK_Carrera_Administrativa_Tabla_Grados] FOREIGN KEY([Id_Grado])
REFERENCES [dbo].[Tabla_Grados] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Carrera_Administrativa_Tabla_Grados]') AND parent_object_id = OBJECT_ID(N'[dbo].[Carrera_Administrativa]'))
ALTER TABLE [dbo].[Carrera_Administrativa] NOCHECK CONSTRAINT [FK_Carrera_Administrativa_Tabla_Grados]
GO
/****** Object:  ForeignKey [FK_Carrera_Administrativa_Tabla_Niveles]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Carrera_Administrativa_Tabla_Niveles]') AND parent_object_id = OBJECT_ID(N'[dbo].[Carrera_Administrativa]'))
ALTER TABLE [dbo].[Carrera_Administrativa]  WITH NOCHECK ADD  CONSTRAINT [FK_Carrera_Administrativa_Tabla_Niveles] FOREIGN KEY([Id_Nivel])
REFERENCES [dbo].[Tabla_Niveles] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Carrera_Administrativa_Tabla_Niveles]') AND parent_object_id = OBJECT_ID(N'[dbo].[Carrera_Administrativa]'))
ALTER TABLE [dbo].[Carrera_Administrativa] NOCHECK CONSTRAINT [FK_Carrera_Administrativa_Tabla_Niveles]
GO
/****** Object:  ForeignKey [FK_Carrera_Administrativa_Tabla_Tipos_Resoluciones]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Carrera_Administrativa_Tabla_Tipos_Resoluciones]') AND parent_object_id = OBJECT_ID(N'[dbo].[Carrera_Administrativa]'))
ALTER TABLE [dbo].[Carrera_Administrativa]  WITH NOCHECK ADD  CONSTRAINT [FK_Carrera_Administrativa_Tabla_Tipos_Resoluciones] FOREIGN KEY([Acto_Tipo])
REFERENCES [dbo].[Tabla_Tipos_Resoluciones] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Carrera_Administrativa_Tabla_Tipos_Resoluciones]') AND parent_object_id = OBJECT_ID(N'[dbo].[Carrera_Administrativa]'))
ALTER TABLE [dbo].[Carrera_Administrativa] NOCHECK CONSTRAINT [FK_Carrera_Administrativa_Tabla_Tipos_Resoluciones]
GO
/****** Object:  ForeignKey [CRED_Fk_Asignaciones_Cred_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Fk_Asignaciones_Cred_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Asignaciones]'))
ALTER TABLE [dbo].[CRED_Asignaciones]  WITH CHECK ADD  CONSTRAINT [CRED_Fk_Asignaciones_Cred_Usuarios] FOREIGN KEY([IdUsuario])
REFERENCES [dbo].[CRED_Usuarios] ([IdUsuario])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Fk_Asignaciones_Cred_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Asignaciones]'))
ALTER TABLE [dbo].[CRED_Asignaciones] CHECK CONSTRAINT [CRED_Fk_Asignaciones_Cred_Usuarios]
GO
/****** Object:  ForeignKey [Fk_Asignaciones_Autorizantes]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Asignaciones_Autorizantes]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Asignaciones]'))
ALTER TABLE [dbo].[CRED_Asignaciones]  WITH CHECK ADD  CONSTRAINT [Fk_Asignaciones_Autorizantes] FOREIGN KEY([IdAutorizante])
REFERENCES [dbo].[CRED_Autorizantes] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Asignaciones_Autorizantes]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Asignaciones]'))
ALTER TABLE [dbo].[CRED_Asignaciones] CHECK CONSTRAINT [Fk_Asignaciones_Autorizantes]
GO
/****** Object:  ForeignKey [Fk_Asignaciones_Bajas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Asignaciones_Bajas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Asignaciones]'))
ALTER TABLE [dbo].[CRED_Asignaciones]  WITH CHECK ADD  CONSTRAINT [Fk_Asignaciones_Bajas] FOREIGN KEY([IdBaja])
REFERENCES [dbo].[CRED_Bajas] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Asignaciones_Bajas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Asignaciones]'))
ALTER TABLE [dbo].[CRED_Asignaciones] CHECK CONSTRAINT [Fk_Asignaciones_Bajas]
GO
/****** Object:  ForeignKey [Fk_Asignaciones_Credenciales]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Asignaciones_Credenciales]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Asignaciones]'))
ALTER TABLE [dbo].[CRED_Asignaciones]  WITH CHECK ADD  CONSTRAINT [Fk_Asignaciones_Credenciales] FOREIGN KEY([IdCredencial])
REFERENCES [dbo].[CRED_Credenciales] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Asignaciones_Credenciales]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Asignaciones]'))
ALTER TABLE [dbo].[CRED_Asignaciones] CHECK CONSTRAINT [Fk_Asignaciones_Credenciales]
GO
/****** Object:  ForeignKey [Fk_Asignaciones_Documentos]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Asignaciones_Documentos]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Asignaciones]'))
ALTER TABLE [dbo].[CRED_Asignaciones]  WITH CHECK ADD  CONSTRAINT [Fk_Asignaciones_Documentos] FOREIGN KEY([IdDocumento])
REFERENCES [dbo].[CRED_Documentos] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Asignaciones_Documentos]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Asignaciones]'))
ALTER TABLE [dbo].[CRED_Asignaciones] CHECK CONSTRAINT [Fk_Asignaciones_Documentos]
GO
/****** Object:  ForeignKey [Fk_Asignaciones_Organismos]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Asignaciones_Organismos]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Asignaciones]'))
ALTER TABLE [dbo].[CRED_Asignaciones]  WITH CHECK ADD  CONSTRAINT [Fk_Asignaciones_Organismos] FOREIGN KEY([IdOrganismo])
REFERENCES [dbo].[CRED_Organismos] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Asignaciones_Organismos]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Asignaciones]'))
ALTER TABLE [dbo].[CRED_Asignaciones] CHECK CONSTRAINT [Fk_Asignaciones_Organismos]
GO
/****** Object:  ForeignKey [Fk_Asignaciones_Personas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Asignaciones_Personas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Asignaciones]'))
ALTER TABLE [dbo].[CRED_Asignaciones]  WITH CHECK ADD  CONSTRAINT [Fk_Asignaciones_Personas] FOREIGN KEY([IdPersona])
REFERENCES [dbo].[CRED_Personas] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Asignaciones_Personas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Asignaciones]'))
ALTER TABLE [dbo].[CRED_Asignaciones] CHECK CONSTRAINT [Fk_Asignaciones_Personas]
GO
/****** Object:  ForeignKey [Fk_Autorizantes_Bajas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Autorizantes_Bajas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Autorizantes]'))
ALTER TABLE [dbo].[CRED_Autorizantes]  WITH CHECK ADD  CONSTRAINT [Fk_Autorizantes_Bajas] FOREIGN KEY([IdBaja])
REFERENCES [dbo].[CRED_Bajas] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Autorizantes_Bajas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Autorizantes]'))
ALTER TABLE [dbo].[CRED_Autorizantes] CHECK CONSTRAINT [Fk_Autorizantes_Bajas]
GO
/****** Object:  ForeignKey [Fk_Autorizantes_personas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Autorizantes_personas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Autorizantes]'))
ALTER TABLE [dbo].[CRED_Autorizantes]  WITH CHECK ADD  CONSTRAINT [Fk_Autorizantes_personas] FOREIGN KEY([IdPersona])
REFERENCES [dbo].[CRED_Personas] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Autorizantes_personas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Autorizantes]'))
ALTER TABLE [dbo].[CRED_Autorizantes] CHECK CONSTRAINT [Fk_Autorizantes_personas]
GO
/****** Object:  ForeignKey [CRED_Fk_Usuarios_Cred_Bajas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Fk_Usuarios_Cred_Bajas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Bajas]'))
ALTER TABLE [dbo].[CRED_Bajas]  WITH CHECK ADD  CONSTRAINT [CRED_Fk_Usuarios_Cred_Bajas] FOREIGN KEY([IdUsuario])
REFERENCES [dbo].[CRED_Usuarios] ([IdUsuario])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Fk_Usuarios_Cred_Bajas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Bajas]'))
ALTER TABLE [dbo].[CRED_Bajas] CHECK CONSTRAINT [CRED_Fk_Usuarios_Cred_Bajas]
GO
/****** Object:  ForeignKey [Fk_Documentos_Bajas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Documentos_Bajas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Bajas]'))
ALTER TABLE [dbo].[CRED_Bajas]  WITH CHECK ADD  CONSTRAINT [Fk_Documentos_Bajas] FOREIGN KEY([IdDocumento])
REFERENCES [dbo].[CRED_Documentos] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Documentos_Bajas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Bajas]'))
ALTER TABLE [dbo].[CRED_Bajas] CHECK CONSTRAINT [Fk_Documentos_Bajas]
GO
/****** Object:  ForeignKey [Cred_Fk_Credenciales_Cred_CodigoImpreso]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Cred_Fk_Credenciales_Cred_CodigoImpreso]') AND parent_object_id = OBJECT_ID(N'[dbo].[Cred_CodigoImpresoCredencial]'))
ALTER TABLE [dbo].[Cred_CodigoImpresoCredencial]  WITH CHECK ADD  CONSTRAINT [Cred_Fk_Credenciales_Cred_CodigoImpreso] FOREIGN KEY([IdCredencial])
REFERENCES [dbo].[CRED_Credenciales] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Cred_Fk_Credenciales_Cred_CodigoImpreso]') AND parent_object_id = OBJECT_ID(N'[dbo].[Cred_CodigoImpresoCredencial]'))
ALTER TABLE [dbo].[Cred_CodigoImpresoCredencial] CHECK CONSTRAINT [Cred_Fk_Credenciales_Cred_CodigoImpreso]
GO
/****** Object:  ForeignKey [Fk_Credenciales_Bajas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Credenciales_Bajas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Credenciales]'))
ALTER TABLE [dbo].[CRED_Credenciales]  WITH CHECK ADD  CONSTRAINT [Fk_Credenciales_Bajas] FOREIGN KEY([IdBaja])
REFERENCES [dbo].[CRED_Bajas] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Credenciales_Bajas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Credenciales]'))
ALTER TABLE [dbo].[CRED_Credenciales] CHECK CONSTRAINT [Fk_Credenciales_Bajas]
GO
/****** Object:  ForeignKey [Fk_Credenciales_TiposCredenciales]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Credenciales_TiposCredenciales]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Credenciales]'))
ALTER TABLE [dbo].[CRED_Credenciales]  WITH CHECK ADD  CONSTRAINT [Fk_Credenciales_TiposCredenciales] FOREIGN KEY([IdTipo])
REFERENCES [dbo].[CRED_TiposCredenciales] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Credenciales_TiposCredenciales]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Credenciales]'))
ALTER TABLE [dbo].[CRED_Credenciales] CHECK CONSTRAINT [Fk_Credenciales_TiposCredenciales]
GO
/****** Object:  ForeignKey [CRED_Fk_Asignables_Personas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Fk_Asignables_Personas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_CredencialesAsignablesAPersonas]'))
ALTER TABLE [dbo].[CRED_CredencialesAsignablesAPersonas]  WITH CHECK ADD  CONSTRAINT [CRED_Fk_Asignables_Personas] FOREIGN KEY([IdPersona])
REFERENCES [dbo].[CRED_Personas] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Fk_Asignables_Personas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_CredencialesAsignablesAPersonas]'))
ALTER TABLE [dbo].[CRED_CredencialesAsignablesAPersonas] CHECK CONSTRAINT [CRED_Fk_Asignables_Personas]
GO
/****** Object:  ForeignKey [CRED_Fk_Asignables_TiposCredencial]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Fk_Asignables_TiposCredencial]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_CredencialesAsignablesAPersonas]'))
ALTER TABLE [dbo].[CRED_CredencialesAsignablesAPersonas]  WITH CHECK ADD  CONSTRAINT [CRED_Fk_Asignables_TiposCredencial] FOREIGN KEY([IdTipoCredencial])
REFERENCES [dbo].[CRED_TiposCredenciales] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Fk_Asignables_TiposCredencial]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_CredencialesAsignablesAPersonas]'))
ALTER TABLE [dbo].[CRED_CredencialesAsignablesAPersonas] CHECK CONSTRAINT [CRED_Fk_Asignables_TiposCredencial]
GO
/****** Object:  ForeignKey [CRED_Fk_Documentos_Cred_Bajas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Fk_Documentos_Cred_Bajas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Documentos]'))
ALTER TABLE [dbo].[CRED_Documentos]  WITH CHECK ADD  CONSTRAINT [CRED_Fk_Documentos_Cred_Bajas] FOREIGN KEY([IdUsuario])
REFERENCES [dbo].[CRED_Usuarios] ([IdUsuario])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Fk_Documentos_Cred_Bajas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Documentos]'))
ALTER TABLE [dbo].[CRED_Documentos] CHECK CONSTRAINT [CRED_Fk_Documentos_Cred_Bajas]
GO
/****** Object:  ForeignKey [Fk_Documentos_TiposDocumentos]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Documentos_TiposDocumentos]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Documentos]'))
ALTER TABLE [dbo].[CRED_Documentos]  WITH CHECK ADD  CONSTRAINT [Fk_Documentos_TiposDocumentos] FOREIGN KEY([IdTipoDocumento])
REFERENCES [dbo].[CRED_TiposDocumentos] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Documentos_TiposDocumentos]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Documentos]'))
ALTER TABLE [dbo].[CRED_Documentos] CHECK CONSTRAINT [Fk_Documentos_TiposDocumentos]
GO
/****** Object:  ForeignKey [CRED_Fk_Domicilios_Personas_relevadas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Fk_Domicilios_Personas_relevadas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Domicilios]'))
ALTER TABLE [dbo].[CRED_Domicilios]  WITH CHECK ADD  CONSTRAINT [CRED_Fk_Domicilios_Personas_relevadas] FOREIGN KEY([Documento])
REFERENCES [dbo].[CRED_PersonasRelevadas] ([Documento])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Fk_Domicilios_Personas_relevadas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Domicilios]'))
ALTER TABLE [dbo].[CRED_Domicilios] CHECK CONSTRAINT [CRED_Fk_Domicilios_Personas_relevadas]
GO
/****** Object:  ForeignKey [FK_CRED_HistoricoBajasPersonas_CRED_Bajas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_CRED_HistoricoBajasPersonas_CRED_Bajas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_HistoricoBajasPersonas]'))
ALTER TABLE [dbo].[CRED_HistoricoBajasPersonas]  WITH CHECK ADD  CONSTRAINT [FK_CRED_HistoricoBajasPersonas_CRED_Bajas] FOREIGN KEY([IdBaja])
REFERENCES [dbo].[CRED_Bajas] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_CRED_HistoricoBajasPersonas_CRED_Bajas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_HistoricoBajasPersonas]'))
ALTER TABLE [dbo].[CRED_HistoricoBajasPersonas] CHECK CONSTRAINT [FK_CRED_HistoricoBajasPersonas_CRED_Bajas]
GO
/****** Object:  ForeignKey [FK_CRED_HistoricoBajasPersonas_CRED_Personas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_CRED_HistoricoBajasPersonas_CRED_Personas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_HistoricoBajasPersonas]'))
ALTER TABLE [dbo].[CRED_HistoricoBajasPersonas]  WITH CHECK ADD  CONSTRAINT [FK_CRED_HistoricoBajasPersonas_CRED_Personas] FOREIGN KEY([IdPersona])
REFERENCES [dbo].[CRED_Personas] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_CRED_HistoricoBajasPersonas_CRED_Personas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_HistoricoBajasPersonas]'))
ALTER TABLE [dbo].[CRED_HistoricoBajasPersonas] CHECK CONSTRAINT [FK_CRED_HistoricoBajasPersonas_CRED_Personas]
GO
/****** Object:  ForeignKey [Fk_PedidoAltaPersonas_Autorizantes]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_PedidoAltaPersonas_Autorizantes]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_PedidoAltaPersonas]'))
ALTER TABLE [dbo].[CRED_PedidoAltaPersonas]  WITH CHECK ADD  CONSTRAINT [Fk_PedidoAltaPersonas_Autorizantes] FOREIGN KEY([IdAutorizante])
REFERENCES [dbo].[CRED_Autorizantes] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_PedidoAltaPersonas_Autorizantes]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_PedidoAltaPersonas]'))
ALTER TABLE [dbo].[CRED_PedidoAltaPersonas] CHECK CONSTRAINT [Fk_PedidoAltaPersonas_Autorizantes]
GO
/****** Object:  ForeignKey [Fk_PedidoAltaPersonas_Documentos]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_PedidoAltaPersonas_Documentos]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_PedidoAltaPersonas]'))
ALTER TABLE [dbo].[CRED_PedidoAltaPersonas]  WITH CHECK ADD  CONSTRAINT [Fk_PedidoAltaPersonas_Documentos] FOREIGN KEY([IdDocumento])
REFERENCES [dbo].[CRED_Documentos] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_PedidoAltaPersonas_Documentos]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_PedidoAltaPersonas]'))
ALTER TABLE [dbo].[CRED_PedidoAltaPersonas] CHECK CONSTRAINT [Fk_PedidoAltaPersonas_Documentos]
GO
/****** Object:  ForeignKey [Fk_PedidoAltaPersonas_Organismos]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_PedidoAltaPersonas_Organismos]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_PedidoAltaPersonas]'))
ALTER TABLE [dbo].[CRED_PedidoAltaPersonas]  WITH CHECK ADD  CONSTRAINT [Fk_PedidoAltaPersonas_Organismos] FOREIGN KEY([IdOrganismo])
REFERENCES [dbo].[CRED_Organismos] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_PedidoAltaPersonas_Organismos]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_PedidoAltaPersonas]'))
ALTER TABLE [dbo].[CRED_PedidoAltaPersonas] CHECK CONSTRAINT [Fk_PedidoAltaPersonas_Organismos]
GO
/****** Object:  ForeignKey [Fk_PedidoAltaPersonas_Personas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_PedidoAltaPersonas_Personas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_PedidoAltaPersonas]'))
ALTER TABLE [dbo].[CRED_PedidoAltaPersonas]  WITH CHECK ADD  CONSTRAINT [Fk_PedidoAltaPersonas_Personas] FOREIGN KEY([IdPersona])
REFERENCES [dbo].[CRED_Personas] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_PedidoAltaPersonas_Personas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_PedidoAltaPersonas]'))
ALTER TABLE [dbo].[CRED_PedidoAltaPersonas] CHECK CONSTRAINT [Fk_PedidoAltaPersonas_Personas]
GO
/****** Object:  ForeignKey [Fk_PedidoAltaPersonas_Relacion]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_PedidoAltaPersonas_Relacion]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_PedidoAltaPersonas]'))
ALTER TABLE [dbo].[CRED_PedidoAltaPersonas]  WITH CHECK ADD  CONSTRAINT [Fk_PedidoAltaPersonas_Relacion] FOREIGN KEY([IdConceptoRelacion])
REFERENCES [dbo].[CRED_ConceptoRelacion] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_PedidoAltaPersonas_Relacion]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_PedidoAltaPersonas]'))
ALTER TABLE [dbo].[CRED_PedidoAltaPersonas] CHECK CONSTRAINT [Fk_PedidoAltaPersonas_Relacion]
GO
/****** Object:  ForeignKey [Fk_Personas_Bajas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Personas_Bajas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Personas]'))
ALTER TABLE [dbo].[CRED_Personas]  WITH CHECK ADD  CONSTRAINT [Fk_Personas_Bajas] FOREIGN KEY([IdBaja])
REFERENCES [dbo].[CRED_Bajas] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Fk_Personas_Bajas]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_Personas]'))
ALTER TABLE [dbo].[CRED_Personas] CHECK CONSTRAINT [Fk_Personas_Bajas]
GO
/****** Object:  ForeignKey [CRED_Fk_PersonasRelevadas_Cred_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Fk_PersonasRelevadas_Cred_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_PersonasRelevadas]'))
ALTER TABLE [dbo].[CRED_PersonasRelevadas]  WITH CHECK ADD  CONSTRAINT [CRED_Fk_PersonasRelevadas_Cred_Usuarios] FOREIGN KEY([IdUsuario])
REFERENCES [dbo].[CRED_Usuarios] ([IdUsuario])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Fk_PersonasRelevadas_Cred_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_PersonasRelevadas]'))
ALTER TABLE [dbo].[CRED_PersonasRelevadas] CHECK CONSTRAINT [CRED_Fk_PersonasRelevadas_Cred_Usuarios]
GO
/****** Object:  ForeignKey [CRED_Fk_Acceso]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Fk_Acceso]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_UsuariosAccesos]'))
ALTER TABLE [dbo].[CRED_UsuariosAccesos]  WITH CHECK ADD  CONSTRAINT [CRED_Fk_Acceso] FOREIGN KEY([IdAcceso])
REFERENCES [dbo].[CRED_Accesos] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Fk_Acceso]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_UsuariosAccesos]'))
ALTER TABLE [dbo].[CRED_UsuariosAccesos] CHECK CONSTRAINT [CRED_Fk_Acceso]
GO
/****** Object:  ForeignKey [CRED_Fk_Usuario]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Fk_Usuario]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_UsuariosAccesos]'))
ALTER TABLE [dbo].[CRED_UsuariosAccesos]  WITH CHECK ADD  CONSTRAINT [CRED_Fk_Usuario] FOREIGN KEY([IdUsuario])
REFERENCES [dbo].[CRED_Usuarios] ([IdUsuario])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[CRED_Fk_Usuario]') AND parent_object_id = OBJECT_ID(N'[dbo].[CRED_UsuariosAccesos]'))
ALTER TABLE [dbo].[CRED_UsuariosAccesos] CHECK CONSTRAINT [CRED_Fk_Usuario]
GO
/****** Object:  ForeignKey [Cred_Fk_Asignaciones_Vencimientos]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Cred_Fk_Asignaciones_Vencimientos]') AND parent_object_id = OBJECT_ID(N'[dbo].[Cred_Vencimientos_Asignaciones]'))
ALTER TABLE [dbo].[Cred_Vencimientos_Asignaciones]  WITH CHECK ADD  CONSTRAINT [Cred_Fk_Asignaciones_Vencimientos] FOREIGN KEY([IdAsignacion])
REFERENCES [dbo].[CRED_Asignaciones] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[Cred_Fk_Asignaciones_Vencimientos]') AND parent_object_id = OBJECT_ID(N'[dbo].[Cred_Vencimientos_Asignaciones]'))
ALTER TABLE [dbo].[Cred_Vencimientos_Asignaciones] CHECK CONSTRAINT [Cred_Fk_Asignaciones_Vencimientos]
GO
/****** Object:  ForeignKey [FK_Datos_Personales_RH_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Datos_Personales_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[Datos_Personales]'))
ALTER TABLE [dbo].[Datos_Personales]  WITH CHECK ADD  CONSTRAINT [FK_Datos_Personales_RH_Usuarios] FOREIGN KEY([Usuario])
REFERENCES [dbo].[RH_Usuarios] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Datos_Personales_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[Datos_Personales]'))
ALTER TABLE [dbo].[Datos_Personales] CHECK CONSTRAINT [FK_Datos_Personales_RH_Usuarios]
GO
/****** Object:  ForeignKey [FK_Datos_Personales_Tabla_DistritosMilitares]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Datos_Personales_Tabla_DistritosMilitares]') AND parent_object_id = OBJECT_ID(N'[dbo].[Datos_Personales]'))
ALTER TABLE [dbo].[Datos_Personales]  WITH NOCHECK ADD  CONSTRAINT [FK_Datos_Personales_Tabla_DistritosMilitares] FOREIGN KEY([Distrito_Militar])
REFERENCES [dbo].[Tabla_DistritosMilitares] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Datos_Personales_Tabla_DistritosMilitares]') AND parent_object_id = OBJECT_ID(N'[dbo].[Datos_Personales]'))
ALTER TABLE [dbo].[Datos_Personales] CHECK CONSTRAINT [FK_Datos_Personales_Tabla_DistritosMilitares]
GO

/****** Object:  ForeignKey [FK_Estudios_Idiomas_Tabla_Nivel_Idioma]    Script Date: 07/19/2012 19:45:04 ******/
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Estudios_Idiomas_Tabla_Nivel_Idioma]') AND parent_object_id = OBJECT_ID(N'[dbo].[Estudios_Idiomas]'))
ALTER TABLE [dbo].[Estudios_Idiomas] CHECK CONSTRAINT [FK_Estudios_Idiomas_Tabla_Nivel_Idioma]
GO
/****** Object:  ForeignKey [FK_Estudios_Idiomas_Tabla_Nivel_Idioma1]    Script Date: 07/19/2012 19:45:04 ******/

IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Estudios_Idiomas_Tabla_Nivel_Idioma1]') AND parent_object_id = OBJECT_ID(N'[dbo].[Estudios_Idiomas]'))
ALTER TABLE [dbo].[Estudios_Idiomas] CHECK CONSTRAINT [FK_Estudios_Idiomas_Tabla_Nivel_Idioma1]
GO
/****** Object:  ForeignKey [FK_Estudios_Idiomas_Tabla_Nivel_Idioma2]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Estudios_Idiomas_Tabla_Nivel_Idioma2]') AND parent_object_id = OBJECT_ID(N'[dbo].[Estudios_Idiomas]'))
ALTER TABLE [dbo].[Estudios_Idiomas]  WITH NOCHECK ADD  CONSTRAINT [FK_Estudios_Idiomas_Tabla_Nivel_Idioma2] FOREIGN KEY([Escribe])
REFERENCES [dbo].[Tabla_Nivel_Idioma] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Estudios_Idiomas_Tabla_Nivel_Idioma2]') AND parent_object_id = OBJECT_ID(N'[dbo].[Estudios_Idiomas]'))
ALTER TABLE [dbo].[Estudios_Idiomas] CHECK CONSTRAINT [FK_Estudios_Idiomas_Tabla_Nivel_Idioma2]
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_DDJJ_Cargos_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_DDJJ_Cargos]'))
ALTER TABLE [dbo].[LEG_DDJJ_Cargos] CHECK CONSTRAINT [FK_LEG_DDJJ_Cargos_Datos_Personales]
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Desglose_Area_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_Area]'))
ALTER TABLE [dbo].[LEG_Desglose_Area] CHECK CONSTRAINT [FK_LEG_Desglose_Area_Datos_Personales]
GO
/****** Object:  ForeignKey [FK_LEG_Desglose_Area_RH_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Desglose_Area_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_Area]'))
ALTER TABLE [dbo].[LEG_Desglose_Area]  WITH NOCHECK ADD  CONSTRAINT [FK_LEG_Desglose_Area_RH_Usuarios] FOREIGN KEY([Usuario])
REFERENCES [dbo].[RH_Usuarios] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Desglose_Area_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_Area]'))
ALTER TABLE [dbo].[LEG_Desglose_Area] CHECK CONSTRAINT [FK_LEG_Desglose_Area_RH_Usuarios]
GO
/****** Object:  ForeignKey [FK_LEG_Desglose_Area_Tabla_Areas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Desglose_Area_Tabla_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_Area]'))
ALTER TABLE [dbo].[LEG_Desglose_Area]  WITH NOCHECK ADD  CONSTRAINT [FK_LEG_Desglose_Area_Tabla_Areas] FOREIGN KEY([Id_area])
REFERENCES [dbo].[Tabla_Areas] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Desglose_Area_Tabla_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_Area]'))
ALTER TABLE [dbo].[LEG_Desglose_Area] CHECK CONSTRAINT [FK_LEG_Desglose_Area_Tabla_Areas]
GO
/****** Object:  ForeignKey [FK_LEG_Desglose_FE_Datos_Personales]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Desglose_FE_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_FE]'))
ALTER TABLE [dbo].[LEG_Desglose_FE]  WITH CHECK ADD  CONSTRAINT [FK_LEG_Desglose_FE_Datos_Personales] FOREIGN KEY([Id_interna])
REFERENCES [dbo].[Datos_Personales] ([Id_Interna])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Desglose_FE_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_FE]'))
ALTER TABLE [dbo].[LEG_Desglose_FE] CHECK CONSTRAINT [FK_LEG_Desglose_FE_Datos_Personales]
GO

IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Desglose_NivelGrado_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_NivelGrado]'))
ALTER TABLE [dbo].[LEG_Desglose_NivelGrado] CHECK CONSTRAINT [FK_LEG_Desglose_NivelGrado_RH_Usuarios]
GO
/****** Object:  ForeignKey [FK_LEG_Desglose_NivelGrado_Tabla_Grados]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Desglose_NivelGrado_Tabla_Grados]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_NivelGrado]'))
ALTER TABLE [dbo].[LEG_Desglose_NivelGrado]  WITH CHECK ADD  CONSTRAINT [FK_LEG_Desglose_NivelGrado_Tabla_Grados] FOREIGN KEY([Id_grado])
REFERENCES [dbo].[Tabla_Grados] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Desglose_NivelGrado_Tabla_Grados]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_NivelGrado]'))
ALTER TABLE [dbo].[LEG_Desglose_NivelGrado] CHECK CONSTRAINT [FK_LEG_Desglose_NivelGrado_Tabla_Grados]
GO
/****** Object:  ForeignKey [FK_LEG_Desglose_NivelGrado_Tabla_Niveles]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Desglose_NivelGrado_Tabla_Niveles]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_NivelGrado]'))
ALTER TABLE [dbo].[LEG_Desglose_NivelGrado]  WITH CHECK ADD  CONSTRAINT [FK_LEG_Desglose_NivelGrado_Tabla_Niveles] FOREIGN KEY([Id_nivel])
REFERENCES [dbo].[Tabla_Niveles] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Desglose_NivelGrado_Tabla_Niveles]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_NivelGrado]'))
ALTER TABLE [dbo].[LEG_Desglose_NivelGrado] CHECK CONSTRAINT [FK_LEG_Desglose_NivelGrado_Tabla_Niveles]
GO

IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Desglose_Planta_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_Planta]'))
ALTER TABLE [dbo].[LEG_Desglose_Planta] CHECK CONSTRAINT [FK_LEG_Desglose_Planta_Datos_Personales]
GO
/****** Object:  ForeignKey [FK_LEG_Desglose_Planta_RH_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Desglose_Planta_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_Planta]'))
ALTER TABLE [dbo].[LEG_Desglose_Planta]  WITH NOCHECK ADD  CONSTRAINT [FK_LEG_Desglose_Planta_RH_Usuarios] FOREIGN KEY([Usuario])
REFERENCES [dbo].[RH_Usuarios] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Desglose_Planta_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_Planta]'))
ALTER TABLE [dbo].[LEG_Desglose_Planta] CHECK CONSTRAINT [FK_LEG_Desglose_Planta_RH_Usuarios]
GO
/****** Object:  ForeignKey [FK_LEG_Desglose_Planta_Tipo_de_Planta]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Desglose_Planta_Tipo_de_Planta]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_Planta]'))
ALTER TABLE [dbo].[LEG_Desglose_Planta]  WITH NOCHECK ADD  CONSTRAINT [FK_LEG_Desglose_Planta_Tipo_de_Planta] FOREIGN KEY([Id_Planta])
REFERENCES [dbo].[Tipo_de_Planta] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Desglose_Planta_Tipo_de_Planta]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Desglose_Planta]'))
ALTER TABLE [dbo].[LEG_Desglose_Planta] CHECK CONSTRAINT [FK_LEG_Desglose_Planta_Tipo_de_Planta]
GO
/****** Object:  ForeignKey [FK_LEG_Documentacion_Legajo_Datos_Personales1]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Documentacion_Legajo_Datos_Personales1]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo]'))
ALTER TABLE [dbo].[LEG_Documentacion_Legajo]  WITH CHECK ADD  CONSTRAINT [FK_LEG_Documentacion_Legajo_Datos_Personales1] FOREIGN KEY([Id_interna])
REFERENCES [dbo].[Datos_Personales] ([Id_Interna])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Documentacion_Legajo_Datos_Personales1]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Documentacion_Legajo]'))
ALTER TABLE [dbo].[LEG_Documentacion_Legajo] CHECK CONSTRAINT [FK_LEG_Documentacion_Legajo_Datos_Personales1]
GO
/****** Object:  ForeignKey [FK_LEG_Estudios_Especialidades_RH_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Especialidades_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Especialidades]'))
ALTER TABLE [dbo].[LEG_Estudios_Especialidades]  WITH CHECK ADD  CONSTRAINT [FK_LEG_Estudios_Especialidades_RH_Usuarios] FOREIGN KEY([Usuario])
REFERENCES [dbo].[RH_Usuarios] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Especialidades_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Especialidades]'))
ALTER TABLE [dbo].[LEG_Estudios_Especialidades] CHECK CONSTRAINT [FK_LEG_Estudios_Especialidades_RH_Usuarios]
GO
/****** Object:  ForeignKey [FK_LEG_Estudios_Especialidades_Tabla_Estudios_Tipo_Maquina]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Especialidades_Tabla_Estudios_Tipo_Maquina]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Especialidades]'))
ALTER TABLE [dbo].[LEG_Estudios_Especialidades]  WITH CHECK ADD  CONSTRAINT [FK_LEG_Estudios_Especialidades_Tabla_Estudios_Tipo_Maquina] FOREIGN KEY([Tipo_maqui])
REFERENCES [dbo].[Tabla_Estudios_Tipo_Maquina] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Especialidades_Tabla_Estudios_Tipo_Maquina]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Especialidades]'))
ALTER TABLE [dbo].[LEG_Estudios_Especialidades] CHECK CONSTRAINT [FK_LEG_Estudios_Especialidades_Tabla_Estudios_Tipo_Maquina]
GO
/****** Object:  ForeignKey [FK_LEG_Estudios_Idiomas_RH_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Idiomas_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Idiomas]'))
ALTER TABLE [dbo].[LEG_Estudios_Idiomas]  WITH CHECK ADD  CONSTRAINT [FK_LEG_Estudios_Idiomas_RH_Usuarios] FOREIGN KEY([Usuario])
REFERENCES [dbo].[RH_Usuarios] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Idiomas_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Idiomas]'))
ALTER TABLE [dbo].[LEG_Estudios_Idiomas] CHECK CONSTRAINT [FK_LEG_Estudios_Idiomas_RH_Usuarios]
GO
/****** Object:  ForeignKey [FK_LEG_Estudios_Idiomas_Tabla_Idiomas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Idiomas_Tabla_Idiomas]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Idiomas]'))
ALTER TABLE [dbo].[LEG_Estudios_Idiomas]  WITH CHECK ADD  CONSTRAINT [FK_LEG_Estudios_Idiomas_Tabla_Idiomas] FOREIGN KEY([Id_Idioma])
REFERENCES [dbo].[Tabla_Idiomas] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Idiomas_Tabla_Idiomas]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Idiomas]'))
ALTER TABLE [dbo].[LEG_Estudios_Idiomas] CHECK CONSTRAINT [FK_LEG_Estudios_Idiomas_Tabla_Idiomas]
GO
/****** Object:  ForeignKey [FK_LEG_Estudios_Idiomas_Tabla_Nivel_Idioma]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Idiomas_Tabla_Nivel_Idioma]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Idiomas]'))
ALTER TABLE [dbo].[LEG_Estudios_Idiomas]  WITH CHECK ADD  CONSTRAINT [FK_LEG_Estudios_Idiomas_Tabla_Nivel_Idioma] FOREIGN KEY([Habla])
REFERENCES [dbo].[Tabla_Nivel_Idioma] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Idiomas_Tabla_Nivel_Idioma]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Idiomas]'))
ALTER TABLE [dbo].[LEG_Estudios_Idiomas] CHECK CONSTRAINT [FK_LEG_Estudios_Idiomas_Tabla_Nivel_Idioma]
GO
/****** Object:  ForeignKey [FK_LEG_Estudios_Idiomas_Tabla_Nivel_Idioma1]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Idiomas_Tabla_Nivel_Idioma1]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Idiomas]'))
ALTER TABLE [dbo].[LEG_Estudios_Idiomas]  WITH CHECK ADD  CONSTRAINT [FK_LEG_Estudios_Idiomas_Tabla_Nivel_Idioma1] FOREIGN KEY([Lee])
REFERENCES [dbo].[Tabla_Nivel_Idioma] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Idiomas_Tabla_Nivel_Idioma1]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Idiomas]'))
ALTER TABLE [dbo].[LEG_Estudios_Idiomas] CHECK CONSTRAINT [FK_LEG_Estudios_Idiomas_Tabla_Nivel_Idioma1]
GO
/****** Object:  ForeignKey [FK_LEG_Estudios_Idiomas_Tabla_Nivel_Idioma2]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Idiomas_Tabla_Nivel_Idioma2]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Idiomas]'))
ALTER TABLE [dbo].[LEG_Estudios_Idiomas]  WITH CHECK ADD  CONSTRAINT [FK_LEG_Estudios_Idiomas_Tabla_Nivel_Idioma2] FOREIGN KEY([Escribe])
REFERENCES [dbo].[Tabla_Nivel_Idioma] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Idiomas_Tabla_Nivel_Idioma2]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Idiomas]'))
ALTER TABLE [dbo].[LEG_Estudios_Idiomas] CHECK CONSTRAINT [FK_LEG_Estudios_Idiomas_Tabla_Nivel_Idioma2]
GO
/****** Object:  ForeignKey [FK_LEG_Estudios_Otros_RH_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Otros_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Otros]'))
ALTER TABLE [dbo].[LEG_Estudios_Otros]  WITH CHECK ADD  CONSTRAINT [FK_LEG_Estudios_Otros_RH_Usuarios] FOREIGN KEY([Usuario])
REFERENCES [dbo].[RH_Usuarios] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Otros_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Otros]'))
ALTER TABLE [dbo].[LEG_Estudios_Otros] CHECK CONSTRAINT [FK_LEG_Estudios_Otros_RH_Usuarios]
GO
/****** Object:  ForeignKey [FK_LEG_Estudios_Realizados_Tabla_Estudios_Especialidades]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Realizados_Tabla_Estudios_Especialidades]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Realizados]'))
ALTER TABLE [dbo].[LEG_Estudios_Realizados]  WITH NOCHECK ADD  CONSTRAINT [FK_LEG_Estudios_Realizados_Tabla_Estudios_Especialidades] FOREIGN KEY([Id_Especialidad])
REFERENCES [dbo].[Tabla_Estudios_Especialidades] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Realizados_Tabla_Estudios_Especialidades]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Realizados]'))
ALTER TABLE [dbo].[LEG_Estudios_Realizados] CHECK CONSTRAINT [FK_LEG_Estudios_Realizados_Tabla_Estudios_Especialidades]
GO
/****** Object:  ForeignKey [FK_LEG_Estudios_Realizados_Tabla_Estudios_Facultades]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Realizados_Tabla_Estudios_Facultades]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Realizados]'))
ALTER TABLE [dbo].[LEG_Estudios_Realizados]  WITH NOCHECK ADD  CONSTRAINT [FK_LEG_Estudios_Realizados_Tabla_Estudios_Facultades] FOREIGN KEY([Id_Facultad])
REFERENCES [dbo].[Tabla_Estudios_Facultades] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Realizados_Tabla_Estudios_Facultades]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Realizados]'))
ALTER TABLE [dbo].[LEG_Estudios_Realizados] CHECK CONSTRAINT [FK_LEG_Estudios_Realizados_Tabla_Estudios_Facultades]
GO
/****** Object:  ForeignKey [FK_LEG_Estudios_Realizados_Tabla_Estudios_Instituciones]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Realizados_Tabla_Estudios_Instituciones]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Realizados]'))
ALTER TABLE [dbo].[LEG_Estudios_Realizados]  WITH NOCHECK ADD  CONSTRAINT [FK_LEG_Estudios_Realizados_Tabla_Estudios_Instituciones] FOREIGN KEY([Id_Institucion])
REFERENCES [dbo].[Tabla_Estudios_Instituciones] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Realizados_Tabla_Estudios_Instituciones]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Realizados]'))
ALTER TABLE [dbo].[LEG_Estudios_Realizados] CHECK CONSTRAINT [FK_LEG_Estudios_Realizados_Tabla_Estudios_Instituciones]
GO
/****** Object:  ForeignKey [FK_LEG_Estudios_Realizados_Tabla_Estudios_Niveles]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Realizados_Tabla_Estudios_Niveles]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Realizados]'))
ALTER TABLE [dbo].[LEG_Estudios_Realizados]  WITH NOCHECK ADD  CONSTRAINT [FK_LEG_Estudios_Realizados_Tabla_Estudios_Niveles] FOREIGN KEY([Id_Nivel])
REFERENCES [dbo].[Tabla_Estudios_Niveles] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Realizados_Tabla_Estudios_Niveles]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Realizados]'))
ALTER TABLE [dbo].[LEG_Estudios_Realizados] CHECK CONSTRAINT [FK_LEG_Estudios_Realizados_Tabla_Estudios_Niveles]
GO
/****** Object:  ForeignKey [FK_LEG_Estudios_Realizados_Tabla_Estudios_Titulos]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Realizados_Tabla_Estudios_Titulos]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Realizados]'))
ALTER TABLE [dbo].[LEG_Estudios_Realizados]  WITH NOCHECK ADD  CONSTRAINT [FK_LEG_Estudios_Realizados_Tabla_Estudios_Titulos] FOREIGN KEY([Id_Titulo])
REFERENCES [dbo].[Tabla_Estudios_Titulos] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Realizados_Tabla_Estudios_Titulos]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Realizados]'))
ALTER TABLE [dbo].[LEG_Estudios_Realizados] CHECK CONSTRAINT [FK_LEG_Estudios_Realizados_Tabla_Estudios_Titulos]
GO
/****** Object:  ForeignKey [FK_LEG_Estudios_Realizados_Tabla_Estudios_Universidades]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Realizados_Tabla_Estudios_Universidades]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Realizados]'))
ALTER TABLE [dbo].[LEG_Estudios_Realizados]  WITH NOCHECK ADD  CONSTRAINT [FK_LEG_Estudios_Realizados_Tabla_Estudios_Universidades] FOREIGN KEY([Id_Universidad])
REFERENCES [dbo].[Tabla_Estudios_Universidades] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Estudios_Realizados_Tabla_Estudios_Universidades]') AND parent_object_id = OBJECT_ID(N'[dbo].[LEG_Estudios_Realizados]'))
ALTER TABLE [dbo].[LEG_Estudios_Realizados] CHECK CONSTRAINT [FK_LEG_Estudios_Realizados_Tabla_Estudios_Universidades]
GO
/****** Object:  ForeignKey [FK_Legajo_Bajas_Datos_Personales]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Legajo_Bajas_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[Legajo_Bajas]'))
ALTER TABLE [dbo].[Legajo_Bajas]  WITH NOCHECK ADD  CONSTRAINT [FK_Legajo_Bajas_Datos_Personales] FOREIGN KEY([Id_Interna])
REFERENCES [dbo].[Datos_Personales] ([Id_Interna])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Legajo_Bajas_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[Legajo_Bajas]'))
ALTER TABLE [dbo].[Legajo_Bajas] CHECK CONSTRAINT [FK_Legajo_Bajas_Datos_Personales]
GO
/****** Object:  ForeignKey [FK_Legajo_Bajas_RH_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Legajo_Bajas_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[Legajo_Bajas]'))
ALTER TABLE [dbo].[Legajo_Bajas]  WITH NOCHECK ADD  CONSTRAINT [FK_Legajo_Bajas_RH_Usuarios] FOREIGN KEY([Usuario])
REFERENCES [dbo].[RH_Usuarios] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Legajo_Bajas_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[Legajo_Bajas]'))
ALTER TABLE [dbo].[Legajo_Bajas] CHECK CONSTRAINT [FK_Legajo_Bajas_RH_Usuarios]
GO
/****** Object:  ForeignKey [FK_Legajo_Bajas_Tabla_Motivos_Baja]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Legajo_Bajas_Tabla_Motivos_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Legajo_Bajas]'))
ALTER TABLE [dbo].[Legajo_Bajas]  WITH CHECK ADD  CONSTRAINT [FK_Legajo_Bajas_Tabla_Motivos_Baja] FOREIGN KEY([Motivo_Baja])
REFERENCES [dbo].[Tabla_Motivos_Baja] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Legajo_Bajas_Tabla_Motivos_Baja]') AND parent_object_id = OBJECT_ID(N'[dbo].[Legajo_Bajas]'))
ALTER TABLE [dbo].[Legajo_Bajas] CHECK CONSTRAINT [FK_Legajo_Bajas_Tabla_Motivos_Baja]
GO
/****** Object:  ForeignKey [FK_Legajo_Bajas_Tabla_Tipos_Resoluciones]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Legajo_Bajas_Tabla_Tipos_Resoluciones]') AND parent_object_id = OBJECT_ID(N'[dbo].[Legajo_Bajas]'))
ALTER TABLE [dbo].[Legajo_Bajas]  WITH NOCHECK ADD  CONSTRAINT [FK_Legajo_Bajas_Tabla_Tipos_Resoluciones] FOREIGN KEY([Acto_Tipo])
REFERENCES [dbo].[Tabla_Tipos_Resoluciones] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Legajo_Bajas_Tabla_Tipos_Resoluciones]') AND parent_object_id = OBJECT_ID(N'[dbo].[Legajo_Bajas]'))
ALTER TABLE [dbo].[Legajo_Bajas] CHECK CONSTRAINT [FK_Legajo_Bajas_Tabla_Tipos_Resoluciones]
GO
/****** Object:  ForeignKey [FK_Licencias_Solicitadas_Autorizaciones_Licencias]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Licencias_Solicitadas_Autorizaciones_Licencias]') AND parent_object_id = OBJECT_ID(N'[dbo].[Licencias_Solicitadas]'))
ALTER TABLE [dbo].[Licencias_Solicitadas]  WITH NOCHECK ADD  CONSTRAINT [FK_Licencias_Solicitadas_Autorizaciones_Licencias] FOREIGN KEY([Id_Tabla_Autorizacion])
REFERENCES [dbo].[Autorizaciones_Licencias] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Licencias_Solicitadas_Autorizaciones_Licencias]') AND parent_object_id = OBJECT_ID(N'[dbo].[Licencias_Solicitadas]'))
ALTER TABLE [dbo].[Licencias_Solicitadas] CHECK CONSTRAINT [FK_Licencias_Solicitadas_Autorizaciones_Licencias]
GO
/****** Object:  ForeignKey [FK_Licencias_Solicitadas_RH_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Licencias_Solicitadas_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[Licencias_Solicitadas]'))
ALTER TABLE [dbo].[Licencias_Solicitadas]  WITH CHECK ADD  CONSTRAINT [FK_Licencias_Solicitadas_RH_Usuarios] FOREIGN KEY([Usuario])
REFERENCES [dbo].[RH_Usuarios] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Licencias_Solicitadas_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[Licencias_Solicitadas]'))
ALTER TABLE [dbo].[Licencias_Solicitadas] CHECK CONSTRAINT [FK_Licencias_Solicitadas_RH_Usuarios]
GO
/****** Object:  ForeignKey [FK_Licencias_Solicitadas_Tabla_Areas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Licencias_Solicitadas_Tabla_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[Licencias_Solicitadas]'))
ALTER TABLE [dbo].[Licencias_Solicitadas]  WITH NOCHECK ADD  CONSTRAINT [FK_Licencias_Solicitadas_Tabla_Areas] FOREIGN KEY([Id_Area])
REFERENCES [dbo].[Tabla_Areas] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Licencias_Solicitadas_Tabla_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[Licencias_Solicitadas]'))
ALTER TABLE [dbo].[Licencias_Solicitadas] CHECK CONSTRAINT [FK_Licencias_Solicitadas_Tabla_Areas]
GO
/****** Object:  ForeignKey [FK_Licencias_Solicitadas_Tabla_Conceptos_Licencias]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Licencias_Solicitadas_Tabla_Conceptos_Licencias]') AND parent_object_id = OBJECT_ID(N'[dbo].[Licencias_Solicitadas]'))
ALTER TABLE [dbo].[Licencias_Solicitadas]  WITH NOCHECK ADD  CONSTRAINT [FK_Licencias_Solicitadas_Tabla_Conceptos_Licencias] FOREIGN KEY([Concepto])
REFERENCES [dbo].[Tabla_Conceptos_Licencias] ([id_Concepto])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Licencias_Solicitadas_Tabla_Conceptos_Licencias]') AND parent_object_id = OBJECT_ID(N'[dbo].[Licencias_Solicitadas]'))
ALTER TABLE [dbo].[Licencias_Solicitadas] CHECK CONSTRAINT [FK_Licencias_Solicitadas_Tabla_Conceptos_Licencias]
GO
/****** Object:  ForeignKey [FK_MED_PACIENTES_Tabla_Areas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_MED_PACIENTES_Tabla_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[MED_Pacientes]'))
ALTER TABLE [dbo].[MED_Pacientes]  WITH NOCHECK ADD  CONSTRAINT [FK_MED_PACIENTES_Tabla_Areas] FOREIGN KEY([Area])
REFERENCES [dbo].[Tabla_Areas] ([id])
NOT FOR REPLICATION
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_MED_PACIENTES_Tabla_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[MED_Pacientes]'))
ALTER TABLE [dbo].[MED_Pacientes] NOCHECK CONSTRAINT [FK_MED_PACIENTES_Tabla_Areas]
GO
/****** Object:  ForeignKey [FK_MNS_Asignables_RH_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_MNS_Asignables_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[MNS_Asignables]'))
ALTER TABLE [dbo].[MNS_Asignables]  WITH CHECK ADD  CONSTRAINT [FK_MNS_Asignables_RH_Usuarios] FOREIGN KEY([Id_Usuario])
REFERENCES [dbo].[RH_Usuarios] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_MNS_Asignables_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[MNS_Asignables]'))
ALTER TABLE [dbo].[MNS_Asignables] CHECK CONSTRAINT [FK_MNS_Asignables_RH_Usuarios]
GO
/****** Object:  ForeignKey [FK_MNS_Notas_Respondidas_MNS_Notas_Ingresadas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_MNS_Notas_Respondidas_MNS_Notas_Ingresadas]') AND parent_object_id = OBJECT_ID(N'[dbo].[MNS_Notas_Respondidas]'))
ALTER TABLE [dbo].[MNS_Notas_Respondidas]  WITH CHECK ADD  CONSTRAINT [FK_MNS_Notas_Respondidas_MNS_Notas_Ingresadas] FOREIGN KEY([Id_Ingreso])
REFERENCES [dbo].[MNS_Notas_Ingresadas] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_MNS_Notas_Respondidas_MNS_Notas_Ingresadas]') AND parent_object_id = OBJECT_ID(N'[dbo].[MNS_Notas_Respondidas]'))
ALTER TABLE [dbo].[MNS_Notas_Respondidas] CHECK CONSTRAINT [FK_MNS_Notas_Respondidas_MNS_Notas_Ingresadas]
GO
/****** Object:  ForeignKey [FK_RH_Usuarios_Areas_RH_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_RH_Usuarios_Areas_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[RH_Usuarios_Areas]'))
ALTER TABLE [dbo].[RH_Usuarios_Areas]  WITH NOCHECK ADD  CONSTRAINT [FK_RH_Usuarios_Areas_RH_Usuarios] FOREIGN KEY([Id_Usuario])
REFERENCES [dbo].[RH_Usuarios] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_RH_Usuarios_Areas_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[RH_Usuarios_Areas]'))
ALTER TABLE [dbo].[RH_Usuarios_Areas] CHECK CONSTRAINT [FK_RH_Usuarios_Areas_RH_Usuarios]
GO
/****** Object:  ForeignKey [FK_RH_Usuarios_Areas_Tabla_Areas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_RH_Usuarios_Areas_Tabla_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[RH_Usuarios_Areas]'))
ALTER TABLE [dbo].[RH_Usuarios_Areas]  WITH NOCHECK ADD  CONSTRAINT [FK_RH_Usuarios_Areas_Tabla_Areas] FOREIGN KEY([Id_Area])
REFERENCES [dbo].[Tabla_Areas] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_RH_Usuarios_Areas_Tabla_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[RH_Usuarios_Areas]'))
ALTER TABLE [dbo].[RH_Usuarios_Areas] CHECK CONSTRAINT [FK_RH_Usuarios_Areas_Tabla_Areas]
GO
/****** Object:  ForeignKey [FK_RH_Usuarios_Areas_WEB_RH_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_RH_Usuarios_Areas_WEB_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[RH_Usuarios_Areas_WEB]'))
ALTER TABLE [dbo].[RH_Usuarios_Areas_WEB]  WITH NOCHECK ADD  CONSTRAINT [FK_RH_Usuarios_Areas_WEB_RH_Usuarios] FOREIGN KEY([Id_Usuario])
REFERENCES [dbo].[RH_Usuarios] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_RH_Usuarios_Areas_WEB_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[RH_Usuarios_Areas_WEB]'))
ALTER TABLE [dbo].[RH_Usuarios_Areas_WEB] CHECK CONSTRAINT [FK_RH_Usuarios_Areas_WEB_RH_Usuarios]
GO
/****** Object:  ForeignKey [FK_RH_Usuarios_Areas_WEB_Tabla_Areas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_RH_Usuarios_Areas_WEB_Tabla_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[RH_Usuarios_Areas_WEB]'))
ALTER TABLE [dbo].[RH_Usuarios_Areas_WEB]  WITH NOCHECK ADD  CONSTRAINT [FK_RH_Usuarios_Areas_WEB_Tabla_Areas] FOREIGN KEY([Id_Area])
REFERENCES [dbo].[Tabla_Areas] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_RH_Usuarios_Areas_WEB_Tabla_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[RH_Usuarios_Areas_WEB]'))
ALTER TABLE [dbo].[RH_Usuarios_Areas_WEB] CHECK CONSTRAINT [FK_RH_Usuarios_Areas_WEB_Tabla_Areas]
GO
/****** Object:  ForeignKey [FK_RH_Usuarios_Detalles_RH_Sectores]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_RH_Usuarios_Detalles_RH_Sectores]') AND parent_object_id = OBJECT_ID(N'[dbo].[RH_Usuarios_Detalles]'))
ALTER TABLE [dbo].[RH_Usuarios_Detalles]  WITH NOCHECK ADD  CONSTRAINT [FK_RH_Usuarios_Detalles_RH_Sectores] FOREIGN KEY([Id_Sector])
REFERENCES [dbo].[RH_Sectores] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_RH_Usuarios_Detalles_RH_Sectores]') AND parent_object_id = OBJECT_ID(N'[dbo].[RH_Usuarios_Detalles]'))
ALTER TABLE [dbo].[RH_Usuarios_Detalles] CHECK CONSTRAINT [FK_RH_Usuarios_Detalles_RH_Sectores]
GO
/****** Object:  ForeignKey [FK_RH_Usuarios_Detalles_RH_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_RH_Usuarios_Detalles_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[RH_Usuarios_Detalles]'))
ALTER TABLE [dbo].[RH_Usuarios_Detalles]  WITH NOCHECK ADD  CONSTRAINT [FK_RH_Usuarios_Detalles_RH_Usuarios] FOREIGN KEY([Id_Usuario])
REFERENCES [dbo].[RH_Usuarios] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_RH_Usuarios_Detalles_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[RH_Usuarios_Detalles]'))
ALTER TABLE [dbo].[RH_Usuarios_Detalles] CHECK CONSTRAINT [FK_RH_Usuarios_Detalles_RH_Usuarios]
GO
/****** Object:  ForeignKey [FK_Tabla_Areas_RH_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Areas_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Areas]'))
ALTER TABLE [dbo].[Tabla_Areas]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_Areas_RH_Usuarios] FOREIGN KEY([Usuario])
REFERENCES [dbo].[RH_Usuarios] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Areas_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Areas]'))
ALTER TABLE [dbo].[Tabla_Areas] CHECK CONSTRAINT [FK_Tabla_Areas_RH_Usuarios]
GO
/****** Object:  ForeignKey [FK_Tabla_Conceptos_Licencias_RH_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Conceptos_Licencias_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Conceptos_Licencias]'))
ALTER TABLE [dbo].[Tabla_Conceptos_Licencias]  WITH NOCHECK ADD  CONSTRAINT [FK_Tabla_Conceptos_Licencias_RH_Usuarios] FOREIGN KEY([Usuario])
REFERENCES [dbo].[RH_Usuarios] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Conceptos_Licencias_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Conceptos_Licencias]'))
ALTER TABLE [dbo].[Tabla_Conceptos_Licencias] CHECK CONSTRAINT [FK_Tabla_Conceptos_Licencias_RH_Usuarios]
GO
/****** Object:  ForeignKey [FK_Tabla_Conceptos_Licencias_Tabla_Articulos]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Conceptos_Licencias_Tabla_Articulos]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Conceptos_Licencias]'))
ALTER TABLE [dbo].[Tabla_Conceptos_Licencias]  WITH NOCHECK ADD  CONSTRAINT [FK_Tabla_Conceptos_Licencias_Tabla_Articulos] FOREIGN KEY([Nro_Articulo])
REFERENCES [dbo].[Tabla_Articulos] ([Nro_Articulo])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Conceptos_Licencias_Tabla_Articulos]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Conceptos_Licencias]'))
ALTER TABLE [dbo].[Tabla_Conceptos_Licencias] CHECK CONSTRAINT [FK_Tabla_Conceptos_Licencias_Tabla_Articulos]
GO
/****** Object:  ForeignKey [FK_Tabla_Estudios_Facultad_Areas_Tabla_Estudios_Areas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Estudios_Facultad_Areas_Tabla_Estudios_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Facultad_Areas]'))
ALTER TABLE [dbo].[Tabla_Estudios_Facultad_Areas]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_Estudios_Facultad_Areas_Tabla_Estudios_Areas] FOREIGN KEY([IdArea])
REFERENCES [dbo].[Tabla_Estudios_Areas] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Estudios_Facultad_Areas_Tabla_Estudios_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Facultad_Areas]'))
ALTER TABLE [dbo].[Tabla_Estudios_Facultad_Areas] CHECK CONSTRAINT [FK_Tabla_Estudios_Facultad_Areas_Tabla_Estudios_Areas]
GO
/****** Object:  ForeignKey [FK_Tabla_Estudios_Facultad_Areas_Tabla_Estudios_Facultades]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Estudios_Facultad_Areas_Tabla_Estudios_Facultades]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Facultad_Areas]'))
ALTER TABLE [dbo].[Tabla_Estudios_Facultad_Areas]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_Estudios_Facultad_Areas_Tabla_Estudios_Facultades] FOREIGN KEY([IdFacultad])
REFERENCES [dbo].[Tabla_Estudios_Facultades] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Estudios_Facultad_Areas_Tabla_Estudios_Facultades]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Facultad_Areas]'))
ALTER TABLE [dbo].[Tabla_Estudios_Facultad_Areas] CHECK CONSTRAINT [FK_Tabla_Estudios_Facultad_Areas_Tabla_Estudios_Facultades]
GO
/****** Object:  ForeignKey [FK_Tabla_Estudios_Instituciones_Tabla_Estudios_Niveles]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Estudios_Instituciones_Tabla_Estudios_Niveles]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Instituciones]'))
ALTER TABLE [dbo].[Tabla_Estudios_Instituciones]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_Estudios_Instituciones_Tabla_Estudios_Niveles] FOREIGN KEY([Nivel])
REFERENCES [dbo].[Tabla_Estudios_Niveles] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Estudios_Instituciones_Tabla_Estudios_Niveles]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Instituciones]'))
ALTER TABLE [dbo].[Tabla_Estudios_Instituciones] CHECK CONSTRAINT [FK_Tabla_Estudios_Instituciones_Tabla_Estudios_Niveles]
GO
/****** Object:  ForeignKey [FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Areas]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Relaciones]'))
ALTER TABLE [dbo].[Tabla_Estudios_Relaciones]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Areas] FOREIGN KEY([Area])
REFERENCES [dbo].[Tabla_Estudios_Areas] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Areas]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Relaciones]'))
ALTER TABLE [dbo].[Tabla_Estudios_Relaciones] CHECK CONSTRAINT [FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Areas]
GO
/****** Object:  ForeignKey [FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Especialidades]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Especialidades]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Relaciones]'))
ALTER TABLE [dbo].[Tabla_Estudios_Relaciones]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Especialidades] FOREIGN KEY([Especialidad])
REFERENCES [dbo].[Tabla_Estudios_Especialidades] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Especialidades]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Relaciones]'))
ALTER TABLE [dbo].[Tabla_Estudios_Relaciones] CHECK CONSTRAINT [FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Especialidades]
GO
/****** Object:  ForeignKey [FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Niveles]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Niveles]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Relaciones]'))
ALTER TABLE [dbo].[Tabla_Estudios_Relaciones]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Niveles] FOREIGN KEY([Nivel])
REFERENCES [dbo].[Tabla_Estudios_Niveles] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Niveles]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Relaciones]'))
ALTER TABLE [dbo].[Tabla_Estudios_Relaciones] CHECK CONSTRAINT [FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Niveles]
GO
/****** Object:  ForeignKey [FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Titulos]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Titulos]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Relaciones]'))
ALTER TABLE [dbo].[Tabla_Estudios_Relaciones]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Titulos] FOREIGN KEY([Titulo])
REFERENCES [dbo].[Tabla_Estudios_Titulos] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Titulos]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Relaciones]'))
ALTER TABLE [dbo].[Tabla_Estudios_Relaciones] CHECK CONSTRAINT [FK_Tabla_Estudios_Relaciones_Tabla_Estudios_Titulos]
GO
/****** Object:  ForeignKey [FK_Tabla_Estudios_Uni_Facultad_Tabla_Estudios_Facultades]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Estudios_Uni_Facultad_Tabla_Estudios_Facultades]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Uni_Facultad]'))
ALTER TABLE [dbo].[Tabla_Estudios_Uni_Facultad]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_Estudios_Uni_Facultad_Tabla_Estudios_Facultades] FOREIGN KEY([Universidad])
REFERENCES [dbo].[Tabla_Estudios_Facultades] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Estudios_Uni_Facultad_Tabla_Estudios_Facultades]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Uni_Facultad]'))
ALTER TABLE [dbo].[Tabla_Estudios_Uni_Facultad] CHECK CONSTRAINT [FK_Tabla_Estudios_Uni_Facultad_Tabla_Estudios_Facultades]
GO
/****** Object:  ForeignKey [FK_Tabla_Estudios_Uni_Facultad_Tabla_Estudios_Universidades]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Estudios_Uni_Facultad_Tabla_Estudios_Universidades]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Uni_Facultad]'))
ALTER TABLE [dbo].[Tabla_Estudios_Uni_Facultad]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_Estudios_Uni_Facultad_Tabla_Estudios_Universidades] FOREIGN KEY([Universidad])
REFERENCES [dbo].[Tabla_Estudios_Universidades] ([id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_Tabla_Estudios_Uni_Facultad_Tabla_Estudios_Universidades]') AND parent_object_id = OBJECT_ID(N'[dbo].[Tabla_Estudios_Uni_Facultad]'))
ALTER TABLE [dbo].[Tabla_Estudios_Uni_Facultad] CHECK CONSTRAINT [FK_Tabla_Estudios_Uni_Facultad_Tabla_Estudios_Universidades]
GO
/****** Object:  ForeignKey [FK_WEB_AgrupacionConceptosLicencia_WEB_AgrupacionConceptosLicencia]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_WEB_AgrupacionConceptosLicencia_WEB_AgrupacionConceptosLicencia]') AND parent_object_id = OBJECT_ID(N'[dbo].[WEB_AgrupacionConceptosLicencia]'))
ALTER TABLE [dbo].[WEB_AgrupacionConceptosLicencia]  WITH NOCHECK ADD  CONSTRAINT [FK_WEB_AgrupacionConceptosLicencia_WEB_AgrupacionConceptosLicencia] FOREIGN KEY([idConcepto])
REFERENCES [dbo].[Tabla_Conceptos_Licencias] ([id_Concepto])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_WEB_AgrupacionConceptosLicencia_WEB_AgrupacionConceptosLicencia]') AND parent_object_id = OBJECT_ID(N'[dbo].[WEB_AgrupacionConceptosLicencia]'))
ALTER TABLE [dbo].[WEB_AgrupacionConceptosLicencia] CHECK CONSTRAINT [FK_WEB_AgrupacionConceptosLicencia_WEB_AgrupacionConceptosLicencia]
GO
/****** Object:  ForeignKey [FK_WEB_AgrupacionConceptosLicencia_WEB_GruposConceptosLicencia]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_WEB_AgrupacionConceptosLicencia_WEB_GruposConceptosLicencia]') AND parent_object_id = OBJECT_ID(N'[dbo].[WEB_AgrupacionConceptosLicencia]'))
ALTER TABLE [dbo].[WEB_AgrupacionConceptosLicencia]  WITH NOCHECK ADD  CONSTRAINT [FK_WEB_AgrupacionConceptosLicencia_WEB_GruposConceptosLicencia] FOREIGN KEY([idGrupo])
REFERENCES [dbo].[WEB_GruposConceptosLicencia] ([idGrupo])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_WEB_AgrupacionConceptosLicencia_WEB_GruposConceptosLicencia]') AND parent_object_id = OBJECT_ID(N'[dbo].[WEB_AgrupacionConceptosLicencia]'))
ALTER TABLE [dbo].[WEB_AgrupacionConceptosLicencia] CHECK CONSTRAINT [FK_WEB_AgrupacionConceptosLicencia_WEB_GruposConceptosLicencia]
GO
/****** Object:  ForeignKey [FK_WEB_Passwords_RH_Usuarios]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_WEB_Passwords_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[WEB_Passwords]'))
ALTER TABLE [dbo].[WEB_Passwords]  WITH CHECK ADD  CONSTRAINT [FK_WEB_Passwords_RH_Usuarios] FOREIGN KEY([idUsuario])
REFERENCES [dbo].[RH_Usuarios] ([Id])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_WEB_Passwords_RH_Usuarios]') AND parent_object_id = OBJECT_ID(N'[dbo].[WEB_Passwords]'))
ALTER TABLE [dbo].[WEB_Passwords] CHECK CONSTRAINT [FK_WEB_Passwords_RH_Usuarios]
GO
/****** Object:  ForeignKey [FK_WEB_Sincronizacion_Conceptos_Licencias_Tabla_Conceptos_Licencias]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_WEB_Sincronizacion_Conceptos_Licencias_Tabla_Conceptos_Licencias]') AND parent_object_id = OBJECT_ID(N'[dbo].[WEB_Sincronizacion_Conceptos_Licencias]'))
ALTER TABLE [dbo].[WEB_Sincronizacion_Conceptos_Licencias]  WITH NOCHECK ADD  CONSTRAINT [FK_WEB_Sincronizacion_Conceptos_Licencias_Tabla_Conceptos_Licencias] FOREIGN KEY([id_concepto])
REFERENCES [dbo].[Tabla_Conceptos_Licencias] ([id_Concepto])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_WEB_Sincronizacion_Conceptos_Licencias_Tabla_Conceptos_Licencias]') AND parent_object_id = OBJECT_ID(N'[dbo].[WEB_Sincronizacion_Conceptos_Licencias]'))
ALTER TABLE [dbo].[WEB_Sincronizacion_Conceptos_Licencias] CHECK CONSTRAINT [FK_WEB_Sincronizacion_Conceptos_Licencias_Tabla_Conceptos_Licencias]
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_WEB_Sincronizacion_DatosPersonales_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[WEB_Sincronizacion_DatosPersonales]'))
ALTER TABLE [dbo].[WEB_Sincronizacion_DatosPersonales] CHECK CONSTRAINT [FK_WEB_Sincronizacion_DatosPersonales_Datos_Personales]
GO
/****** Object:  ForeignKey [FK_LEG_Documentacion_Legajo_Datos_Personales]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Documentacion_Legajo_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[WEB_Sincronizacion_SaldosLicencias]'))
ALTER TABLE [dbo].[WEB_Sincronizacion_SaldosLicencias]  WITH NOCHECK ADD  CONSTRAINT [FK_LEG_Documentacion_Legajo_Datos_Personales] FOREIGN KEY([Id_interna])
REFERENCES [dbo].[Datos_Personales] ([Id_Interna])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_LEG_Documentacion_Legajo_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[WEB_Sincronizacion_SaldosLicencias]'))
ALTER TABLE [dbo].[WEB_Sincronizacion_SaldosLicencias] CHECK CONSTRAINT [FK_LEG_Documentacion_Legajo_Datos_Personales]
GO
/****** Object:  ForeignKey [FK_WEB_Sincronizacion_SaldosLicencias_Datos_Personales]    Script Date: 07/19/2012 19:45:04 ******/
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_WEB_Sincronizacion_SaldosLicencias_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[WEB_Sincronizacion_SaldosLicencias]'))
ALTER TABLE [dbo].[WEB_Sincronizacion_SaldosLicencias]  WITH CHECK ADD  CONSTRAINT [FK_WEB_Sincronizacion_SaldosLicencias_Datos_Personales] FOREIGN KEY([Id_interna])
REFERENCES [dbo].[Datos_Personales] ([Id_Interna])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_WEB_Sincronizacion_SaldosLicencias_Datos_Personales]') AND parent_object_id = OBJECT_ID(N'[dbo].[WEB_Sincronizacion_SaldosLicencias]'))
ALTER TABLE [dbo].[WEB_Sincronizacion_SaldosLicencias] CHECK CONSTRAINT [FK_WEB_Sincronizacion_SaldosLicencias_Datos_Personales]
GO
